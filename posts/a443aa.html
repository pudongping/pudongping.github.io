<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Golang 使用 olivere/elastic 客户端操作 ElasticSearch, 技术博客 PHP Go Python Node.js Vue 编程爱好者"><meta name="description" content="致力于提供个人所学所想，为开源做一点贡献。"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="referrer" content="never"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Golang 使用 olivere/elastic 客户端操作 ElasticSearch | 热浪编程</title><link rel="icon" type="image/png" href="/medias/favicon.png"><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="热浪编程" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">热浪编程</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/menu" class="waves-effect waves-light"><i class="fas fa-bars" style="zoom:.6"></i> <span>文章目录</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于我</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">热浪编程</div><div class="logo-desc">致力于提供个人所学所想，为开源做一点贡献。</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/menu" class="waves-effect waves-light"><i class="fa-fw fas fa-bars"></i> Menu</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于我</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/pudongping" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i>Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/pudongping" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="/libs/cryptojs/crypto-js.min.js"></script><script></script><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/34.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Golang 使用 olivere/elastic 客户端操作 ElasticSearch</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{padding:35px 0 15px 17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{padding-bottom:30px;overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/ElasticSearch/"><span class="chip bg-color">ElasticSearch</span> </a><a href="/tags/Go/"><span class="chip bg-color">Go</span> </a><a href="/tags/Golang/"><span class="chip bg-color">Golang</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/ElasticSearch/" class="post-category">ElasticSearch</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2022-08-16</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 3.9k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 19 分钟</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="Golang-使用-olivere-elastic-客户端操作-ElasticSearch"><a href="#Golang-使用-olivere-elastic-客户端操作-ElasticSearch" class="headerlink" title="Golang 使用 olivere/elastic 客户端操作 ElasticSearch"></a>Golang 使用 olivere/elastic 客户端操作 ElasticSearch</h1><p><code>olivere/elastic</code> 插件包，算是 go 语言中比较通用的操作 ElasticSearch 的客户端了，这里使用的是 <code>v7</code> 版本。</p><h2 id="下载-olivere-elastic-包"><a href="#下载-olivere-elastic-包" class="headerlink" title="下载 olivere/elastic 包"></a>下载 <code>olivere/elastic</code> 包</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get github.com/olivere/elastic/v7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>这里直接以代码 demo 的形式呈现，具体含义，请见注释。若有错误，还望指正，感谢！</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">
<span class="token comment">/**
GitHub： https://github.com/olivere/elastic
官方文档示例： https://olivere.github.io/elastic/
下载：go get github.com/olivere/elastic/v7
*/</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"sync"</span>
	<span class="token string">"time"</span>

	<span class="token string">"github.com/olivere/elastic/v7"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	ESClient <span class="token operator">*</span>elastic<span class="token punctuation">.</span>Client
	once     sync<span class="token punctuation">.</span>Once
<span class="token punctuation">)</span>

<span class="token keyword">type</span> RcpGoodsImgChecksES <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	AppName     <span class="token builtin">int</span>    <span class="token string">`json:"app_name"`</span>
	GoodsId     <span class="token builtin">string</span> <span class="token string">`json:"goods_id"`</span>
	SiteId      <span class="token builtin">int</span>    <span class="token string">`json:"site_id"`</span>
	CheckStatus <span class="token builtin">int</span>    <span class="token string">`json:"check_status"`</span>
	CreatedAt   <span class="token builtin">int</span>    <span class="token string">`json:"created_at"`</span>
	UpdatedAt   <span class="token builtin">int</span>    <span class="token string">`json:"updated_at"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> RcpGoodsImgChecksESIndex <span class="token operator">=</span> <span class="token string">"rcp_goods_img_checks"</span>

<span class="token keyword">const</span> RcpGoodsImgChecksESMapping <span class="token operator">=</span> <span class="token string">`
{
	"mappings":{
		"properties":{
			"app_name":{
				"type": "integer"
			},
			"goods_id":{
				"type": "keyword"
			},
			"site_id":{
				"type": "keyword"
			},
			"check_status":{
				"type": "integer"
			},
			"created_at":{
				"type": "date"
			},
			"updated_at":{
				"type": "date"
			}
		}
	}
}`</span>

<span class="token keyword">const</span> esUrl <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:9200"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>

	<span class="token comment">// 创建 es 连接</span>
	<span class="token function">ConnectES</span><span class="token punctuation">(</span>
		<span class="token comment">// 如果 es 是通过 docker 安装，如果不设置 `elastic.SetSniff(false)` 那么则会报错</span>
		elastic<span class="token punctuation">.</span><span class="token function">SetSniff</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// 允许指定弹性是否应该定期检查集群，默认为 true, 会把请求 http://ip:port/_nodes/http，并将其返回的 publish_address 作为请求路径</span>
		elastic<span class="token punctuation">.</span><span class="token function">SetURL</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>esUrl<span class="token punctuation">}</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 服务地址</span>
		elastic<span class="token punctuation">.</span><span class="token function">SetBasicAuth</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">// 设置认证账号和密码</span>
		<span class="token comment">// elastic.SetHealthcheckInterval(time.Second*5), // 心跳检查，间隔时间</span>
		<span class="token comment">// elastic.SetGzip(true),                         // 启用 gzip 压缩</span>
	<span class="token punctuation">)</span>

	<span class="token comment">// Ping the Elasticsearch server to get e.g. the version number</span>
	info<span class="token punctuation">,</span> code<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">Ping</span><span class="token punctuation">(</span>esUrl<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// Handle error</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Elasticsearch returned with code 200 and version 7.9.3</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Elasticsearch returned with code %d and version %s\n"</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> info<span class="token punctuation">.</span>Version<span class="token punctuation">.</span>Number<span class="token punctuation">)</span>

	<span class="token comment">// 直接打印出 es 版本号</span>
	esVersion<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">ElasticsearchVersion</span><span class="token punctuation">(</span>esUrl<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Elasticsearch version 7.9.3</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Elasticsearch version %s\n"</span><span class="token punctuation">,</span> esVersion<span class="token punctuation">)</span>

	<span class="token comment">// 删除索引</span>
	<span class="token comment">// testDeleteIndex()</span>

	<span class="token comment">// 判断索引是否存在，如果不存在时，则创建</span>
	err <span class="token operator">=</span> <span class="token function">CreateIndexIfNotExists</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> RcpGoodsImgChecksESMapping<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="简单封装的一些常见方法"><a href="#简单封装的一些常见方法" class="headerlink" title="简单封装的一些常见方法"></a>简单封装的一些常见方法</h2><h3 id="创建-es-连接"><a href="#创建-es-连接" class="headerlink" title="创建 es 连接"></a>创建 es 连接</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ConnectES 创建 es 连接</span>
<span class="token keyword">func</span> <span class="token function">ConnectES</span><span class="token punctuation">(</span>options <span class="token operator">...</span>elastic<span class="token punctuation">.</span>ClientOptionFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	once<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// client, err := elastic.NewClient(elastic.SetSniff(false), elastic.SetURL("http://127.0.0.1:9200"))</span>
		<span class="token keyword">var</span> err <span class="token builtin">error</span>
		ESClient<span class="token punctuation">,</span> err <span class="token operator">=</span> elastic<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Ping</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>PingResult<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="索引不存在时，创建索引"><a href="#索引不存在时，创建索引" class="headerlink" title="索引不存在时，创建索引"></a>索引不存在时，创建索引</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// CreateIndexIfNotExists 索引不存在时，创建索引</span>
<span class="token comment">// index 索引名称</span>
<span class="token comment">// mapping 数据类型</span>
<span class="token keyword">func</span> <span class="token function">CreateIndexIfNotExists</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> mapping <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	exists<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">IndexExists</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> exists <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	info<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">CreateIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BodyString</span><span class="token punctuation">(</span>mapping<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token comment">// info, err := ESClient.CreateIndex(index).Do(ctx)  // 如果只是想创建索引时，那么就不需要 BodyString() 方法</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>info<span class="token punctuation">.</span>Acknowledged <span class="token punctuation">{</span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"ES 创建索引 [%s] 失败"</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// DeleteIndex 删除索引</span>
<span class="token comment">// index 索引名称</span>
<span class="token keyword">func</span> <span class="token function">DeleteIndex</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>IndicesDeleteResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	info<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">DeleteIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>info<span class="token punctuation">.</span>Acknowledged <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"ES 删除索引 [%s] 失败"</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> info<span class="token punctuation">,</span> err
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="单条添加"><a href="#单条添加" class="headerlink" title="单条添加"></a>单条添加</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// CreateDoc 单条添加</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// id 文档 id（可以直接为空字符串，当实参为空字符串时，es 会主动随机生成）</span>
<span class="token comment">// body 需要添加的内容</span>
<span class="token keyword">func</span> <span class="token function">CreateDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>IndexResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	client <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token string">""</span> <span class="token operator">!=</span> id <span class="token punctuation">{</span>
		client <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">BodyJson</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="单条更新"><a href="#单条更新" class="headerlink" title="单条更新"></a>单条更新</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// UpdateDoc 单条更新</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// id 记录 id</span>
<span class="token comment">// body 需要更新的内容 （建议只使用 map[string]interface{} 进行更新指定字段且需要注意 map 中的 key 需要和 es 中的 key 完全匹配，否则 es 会认为新增字段，不要使用 struct 否则会将某些值初始化零值）</span>
<span class="token keyword">func</span> <span class="token function">UpdateDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>UpdateResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// DeleteDoc 删除文档</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// id 需要删除的文档记录 id</span>
<span class="token keyword">func</span> <span class="token function">DeleteDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>DeleteResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="批量添加"><a href="#批量添加" class="headerlink" title="批量添加"></a>批量添加</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// CreateBulkDoc 批量添加</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// ids 需要新建的 id 数组（可以为空的字符串切片）</span>
<span class="token comment">// body 需要添加的内容</span>
<span class="token comment">// 需要注意：ids 和 body 的顺序要一一对应</span>
<span class="token keyword">func</span> <span class="token function">CreateBulkDoc</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">,</span> ids <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>BulkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	bulkRequest <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Bulk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> body <span class="token punctuation">{</span>
		tmp <span class="token operator">:=</span> v
		doc <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBulkIndexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			doc <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>ids<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		bulkRequest <span class="token operator">=</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="批量更新"><a href="#批量更新" class="headerlink" title="批量更新"></a>批量更新</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// UpdateBulkDoc 批量更新</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// ids 需要更新的 id 数组</span>
<span class="token comment">// body 需要更新的 id 对应的数据 （建议只使用 []map[string]interface{} 进行更新指定字段且需要注意 map 中的 key 需要和 es 中的 key 完全匹配，否则 es 会认为新增字段，不要使用 struct 否则会将某些值初始化零值）</span>
<span class="token comment">// 需要注意：ids 和 body 的顺序要一一对应</span>
<span class="token keyword">func</span> <span class="token function">UpdateBulkDoc</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">,</span> ids <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>BulkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	bulkRequest <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Bulk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> body <span class="token punctuation">{</span>
		tmp <span class="token operator">:=</span> v
		doc <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBulkUpdateRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>ids<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DocAsUpsert</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
		bulkRequest <span class="token operator">=</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// DeleteBulkDoc 批量删除</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// ids 需要删除的 id 数组</span>
<span class="token keyword">func</span> <span class="token function">DeleteBulkDoc</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">,</span> ids <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>BulkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	bulkRequest <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Bulk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> ids <span class="token punctuation">{</span>
		tmp <span class="token operator">:=</span> v
		req <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBulkDeleteRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
		bulkRequest <span class="token operator">=</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="通过文档-id-取出数据"><a href="#通过文档-id-取出数据" class="headerlink" title="通过文档 id 取出数据"></a>通过文档 id 取出数据</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// FirstDoc 通过 id 取出数据</span>
<span class="token comment">// index 索引</span>
<span class="token comment">// id 需要取的文档记录 id</span>
<span class="token keyword">func</span> <span class="token function">FirstDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>GetResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="打印出查询条件"><a href="#打印出查询条件" class="headerlink" title="打印出查询条件"></a>打印出查询条件</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">PrintQuery</span><span class="token punctuation">(</span>src <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"开始打印参数 ====&gt;"</span><span class="token punctuation">)</span>
	data<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打印参数结束 ====&gt;"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="查询出数据"><a href="#查询出数据" class="headerlink" title="查询出数据"></a>查询出数据</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">querySearch</span><span class="token punctuation">(</span>query elastic<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> querySrc<span class="token punctuation">,</span> err <span class="token operator">:=</span> query<span class="token punctuation">.</span><span class="token function">Source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">PrintQuery</span><span class="token punctuation">(</span>querySrc<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	queryRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"查询到的结果总数为 %v \n"</span><span class="token punctuation">,</span> queryRet<span class="token punctuation">.</span><span class="token function">TotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> queryRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span>
		<span class="token keyword">var</span> tmp RcpGoodsImgChecksES
		json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"已经命中查询的数据为 ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h3><h4 id="删除索引-1"><a href="#删除索引-1" class="headerlink" title="删除索引"></a>删除索引</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 删除索引</span>
	deleteIndexRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DeleteIndex</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// deleteIndexRet  ==&gt; &amp;{Acknowledged:true}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"deleteIndexRet  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteIndexRet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="创建文档"><a href="#创建文档" class="headerlink" title="创建文档"></a>创建文档</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testCreateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 创建文档</span>
	now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	createDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">,</span> RcpGoodsImgChecksES<span class="token punctuation">{</span>
		AppName<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
		GoodsId<span class="token punctuation">:</span>     <span class="token string">"alex111"</span><span class="token punctuation">,</span>
		SiteId<span class="token punctuation">:</span>      <span class="token number">18</span><span class="token punctuation">,</span>
		CheckStatus<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
		UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// CreateDoc ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:1 Result:created Shards:0xc00020c2c0 SeqNo:0 PrimaryTerm:1 Status:0 ForcedRefresh:false}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"CreateDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> createDocRet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="通过文档-id-的形式更新文档"><a href="#通过文档-id-的形式更新文档" class="headerlink" title="通过文档 id 的形式更新文档"></a>通过文档 id 的形式更新文档</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 通过文档 id 的形式更新文档</span>
	updateDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">UpdateDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token string">"check_status"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token string">"updated_at"</span><span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// UpdateDoc ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:2 Result:updated Shards:0xc0002bc280 SeqNo:1 PrimaryTerm:1 Status:0 ForcedRefresh:false GetResult:&lt;nil&gt;}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"UpdateDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateDocRet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="通过-Script-方式更新文档（单字段更新，借助文档-id-更新）"><a href="#通过-Script-方式更新文档（单字段更新，借助文档-id-更新）" class="headerlink" title="通过 Script 方式更新文档（单字段更新，借助文档 id 更新）"></a>通过 Script 方式更新文档（单字段更新，借助文档 id 更新）</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateDocScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 通过 Script 方式更新文档（单字段更新，借助文档 id 更新）</span>
	updateDocScript<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Id</span><span class="token punctuation">(</span><span class="token string">"2_18_alex111"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Script</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewScript</span><span class="token punctuation">(</span><span class="token string">"ctx._source.site_id=11"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// updateDocScript  ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:3 Result:updated Shards:0xc000098280 SeqNo:2 PrimaryTerm:1 Status:0 ForcedRefresh:false GetResult:&lt;nil&gt;}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"updateDocScript  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateDocScript<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="通过条件-Script-方式更新文档（单字段更新，根据查询条件批量更新字段）"><a href="#通过条件-Script-方式更新文档（单字段更新，根据查询条件批量更新字段）" class="headerlink" title="通过条件 Script 方式更新文档（单字段更新，根据查询条件批量更新字段）"></a>通过条件 Script 方式更新文档（单字段更新，根据查询条件批量更新字段）</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateDocScriptQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 通过条件 Script 方式更新文档（单字段更新，根据查询条件批量更新字段）</span>
	updateDocScriptQuery<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">UpdateByQuery</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Query</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"alex111"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Script</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewScript</span><span class="token punctuation">(</span><span class="token string">"ctx._source.check_status=23"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">ProceedOnVersionConflict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// updateDocScriptQuery  ==&gt; &amp;{Header:map[] Took:47 SliceId:&lt;nil&gt; TimedOut:false Total:2 Updated:2 Created:0 Deleted:0 Batches:1 VersionConflicts:0 Noops:0 Retries:{Bulk:0 Search:0} Throttled: ThrottledMillis:0 RequestsPerSecond:-1 Canceled: ThrottledUntil: ThrottledUntilMillis:0 Failures:[]}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"updateDocScriptQuery  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateDocScriptQuery<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="通过文档-id-查找文档"><a href="#通过文档-id-查找文档" class="headerlink" title="通过文档 id 查找文档"></a>通过文档 id 查找文档</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testFirstDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 通过文档 id 查找文档</span>
	firstDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">FirstDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> firstDocRet<span class="token punctuation">.</span>Found <span class="token punctuation">{</span> <span class="token comment">// 表示找到了数据</span>
		<span class="token comment">// FirstDoc ==&gt;  &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Uid: Routing: Parent: Version:0xc000282a10 SeqNo:0xc000282a18 PrimaryTerm:0xc000282a20 Source:[123 34 97 112 112 95 110 97 109 101 34 58 50 44 34 117 112 100 97 116 101 100 95 97 116 34 58 49 54 54 48 53 55 57 52 56 54 44 34 115 105 116 101 95 105 100 34 58 49 56 44 34 103 111 111 100 115 95 105 100 34 58 34 97 108 101 120 49 49 49 34 44 34 99 114 101 97 116 101 100 95 97 116 34 58 49 54 54 48 53 55 57 52 56 54 44 34 99 104 101 99 107 95 115 116 97 116 117 115 34 58 50 51 125] Found:true Fields:map[] Error:&lt;nil&gt;} Source: {"app_name":2,"updated_at":1660579486,"site_id":18,"goods_id":"alex111","created_at":1660579486,"check_status":23}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"FirstDoc ==&gt;  %+v Source: %+v \n\n"</span><span class="token punctuation">,</span> firstDocRet<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>firstDocRet<span class="token punctuation">.</span>Source<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="通过文档-id-删除文档"><a href="#通过文档-id-删除文档" class="headerlink" title="通过文档 id 删除文档"></a>通过文档 id 删除文档</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 通过文档 id 删除文档</span>
	deleteDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DeleteDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// DeleteDoc  ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:6 Result:deleted Shards:0xc00007e2c0 SeqNo:7 PrimaryTerm:1 Status:0 ForcedRefresh:false}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"DeleteDoc  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteDocRet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="批量创建"><a href="#批量创建" class="headerlink" title="批量创建"></a>批量创建</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testCreateBulkDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 批量创建</span>
	createBulkDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateBulkDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"h1"</span><span class="token punctuation">,</span> <span class="token string">"h2"</span><span class="token punctuation">,</span> <span class="token string">"h3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		RcpGoodsImgChecksES<span class="token punctuation">{</span>
			AppName<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
			GoodsId<span class="token punctuation">:</span>     <span class="token string">"h1_goods_id"</span><span class="token punctuation">,</span>
			SiteId<span class="token punctuation">:</span>      <span class="token number">17</span><span class="token punctuation">,</span>
			CheckStatus<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
			CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
			UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		RcpGoodsImgChecksES<span class="token punctuation">{</span>
			AppName<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span>
			GoodsId<span class="token punctuation">:</span>     <span class="token string">"h2_goods_id"</span><span class="token punctuation">,</span>
			SiteId<span class="token punctuation">:</span>      <span class="token number">19</span><span class="token punctuation">,</span>
			CheckStatus<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
			CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
			UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		RcpGoodsImgChecksES<span class="token punctuation">{</span>
			AppName<span class="token punctuation">:</span>     <span class="token number">3</span><span class="token punctuation">,</span>
			GoodsId<span class="token punctuation">:</span>     <span class="token string">"h3_goods_id"</span><span class="token punctuation">,</span>
			SiteId<span class="token punctuation">:</span>      <span class="token number">19</span><span class="token punctuation">,</span>
			CheckStatus<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
			CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
			UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// CreateBulkDoc ==&gt; &amp;{Took:5 Errors:false Items:[map[index:0xc00019c200] map[index:0xc00019c280] map[index:0xc00019c300]]}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"CreateBulkDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> createBulkDocRet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="批量更新-1"><a href="#批量更新-1" class="headerlink" title="批量更新"></a>批量更新</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateBulkDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 批量更新</span>
	updateBulkDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">UpdateBulkDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"h1"</span><span class="token punctuation">,</span> <span class="token string">"h3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
			<span class="token string">"check_status"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
			<span class="token string">"updated_at"</span><span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
			<span class="token string">"site_id"</span><span class="token punctuation">:</span>    <span class="token number">20</span><span class="token punctuation">,</span>
			<span class="token string">"updated_at"</span><span class="token punctuation">:</span> <span class="token function">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// UpdateBulkDoc ==&gt; &amp;{Took:6 Errors:false Items:[map[update:0xc0001e2080] map[update:0xc0001e2100]]}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"UpdateBulkDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateBulkDocRet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="通过文档-id-批量删除"><a href="#通过文档-id-批量删除" class="headerlink" title="通过文档 id 批量删除"></a>通过文档 id 批量删除</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteBulkDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 通过文档 id 批量删除</span>
	deleteBulkDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DeleteBulkDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"h2"</span><span class="token punctuation">,</span> <span class="token string">"h3_goods_id"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"DeleteBulkDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteBulkDocRet<span class="token punctuation">)</span>

	<span class="token comment">// DeleteBulkDoc ==&gt; &amp;{Took:36 Errors:false Items:[map[delete:0xc0000ea080] map[delete:0xc0000ea100]]}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="按照条件删除"><a href="#按照条件删除" class="headerlink" title="按照条件删除"></a>按照条件删除</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteByQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 按照条件删除</span>
	deleteDocByQuery<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">DeleteByQuery</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Query</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewRangeQuery</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lte</span><span class="token punctuation">(</span><span class="token number">1660579923</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"deleteDocByQuery ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteDocByQuery<span class="token punctuation">)</span>

	<span class="token comment">// deleteDocByQuery ==&gt; &amp;{Header:map[] Took:36 SliceId:&lt;nil&gt; TimedOut:false Total:3 Updated:0 Created:0 Deleted:3 Batches:1 VersionConflicts:0 Noops:0 Retries:{Bulk:0 Search:0} Throttled: ThrottledMillis:0 RequestsPerSecond:-1 Canceled: ThrottledUntil: ThrottledUntilMillis:0 Failures:[]}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="term"><a href="#term" class="headerlink" title="term"></a>term</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testTermQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// term</span>
	query1 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query1<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "term": {</span>
	<span class="token comment">//    "goods_id": "h2_goods_id"</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 1</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="terms"><a href="#terms" class="headerlink" title="terms"></a>terms</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testTermsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// terms [where goods_id in ('h3_goods_id', 'h2_goods_id')]</span>
	query2 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewTermsQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"h3_goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">}</span><span class="token operator">...</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query2<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "terms": {</span>
	<span class="token comment">//    "goods_id": [</span>
	<span class="token comment">//      "h3_goods_id",</span>
	<span class="token comment">//      "h2_goods_id"</span>
	<span class="token comment">//    ]</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 2</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="range-范围查找"><a href="#range-范围查找" class="headerlink" title="range 范围查找"></a>range 范围查找</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testRangeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 范围查找 [where updated_at &gt;= 0 and updated_at &lt;= 1659695758]</span>
	<span class="token comment">// Gt（大于）、Lt（小于）、Gte（大于等于）、Lte（小于等于）</span>
	query3 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewRangeQuery</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lte</span><span class="token punctuation">(</span><span class="token number">1659695758</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query3<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "range": {</span>
	<span class="token comment">//    "updated_at": {</span>
	<span class="token comment">//      "from": 0,</span>
	<span class="token comment">//      "include_lower": true,</span>
	<span class="token comment">//      "include_upper": true,</span>
	<span class="token comment">//      "to": 1659695758</span>
	<span class="token comment">//    }</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 0</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match-all"><a href="#match-all" class="headerlink" title="match_all"></a>match_all</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// match_all</span>
	query4 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query4<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "match_all": {}</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 4</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; 2_19_alex111</span>
	<span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:18 CheckStatus:23 CreatedAt:1660579517 UpdatedAt:1660579517}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h1</span>
	<span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match"><a href="#match" class="headerlink" title="match"></a>match</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// match</span>
	query5 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query5<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "match": {</span>
	<span class="token comment">//    "goods_id": {</span>
	<span class="token comment">//      "query": "h2_goods_id"</span>
	<span class="token comment">//    }</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 1</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match-phrase"><a href="#match-phrase" class="headerlink" title="match_phrase"></a>match_phrase</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchPhraseQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// match_phrase</span>
	query6 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchPhraseQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query6<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "match_phrase": {</span>
	<span class="token comment">//    "goods_id": {</span>
	<span class="token comment">//      "query": "h2_goods_id"</span>
	<span class="token comment">//    }</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 1</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match-phrase-prefix"><a href="#match-phrase-prefix" class="headerlink" title="match_phrase_prefix"></a>match_phrase_prefix</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchPhrasePrefixQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// match_phrase_prefix</span>
	<span class="token comment">// 这里因为类型不支持前缀匹配，可能会直接报错</span>
	query7 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchPhrasePrefixQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_"</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query7<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testRegexpQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// regexp</span>
	<span class="token comment">// 搜索 goods_id 字段对应的值以 `h` 开头的所有文档</span>
	query8 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewRegexpQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h.*"</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>query8<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "regexp": {</span>
	<span class="token comment">//    "goods_id": {</span>
	<span class="token comment">//      "value": "h.*"</span>
	<span class="token comment">//    }</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 3</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h1</span>
	<span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="bool-组合查询"><a href="#bool-组合查询" class="headerlink" title="bool 组合查询"></a>bool 组合查询</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testBoolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 组合查询</span>
	boolQuery <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBoolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// must</span>
	boolQuery<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"check_status"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// should</span>
	boolQuery<span class="token punctuation">.</span><span class="token function">Should</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"app_name"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// must_not</span>
	boolQuery<span class="token punctuation">.</span><span class="token function">MustNot</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"site_id"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// filter</span>
	boolQuery<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewRangeQuery</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lte</span><span class="token punctuation">(</span><span class="token number">1660579923</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token function">querySearch</span><span class="token punctuation">(</span>boolQuery<span class="token punctuation">)</span>

	<span class="token comment">// 开始打印参数 ====&gt;</span>
	<span class="token comment">// {</span>
	<span class="token comment">//  "bool": {</span>
	<span class="token comment">//    "filter": {</span>
	<span class="token comment">//      "range": {</span>
	<span class="token comment">//        "updated_at": {</span>
	<span class="token comment">//          "from": 0,</span>
	<span class="token comment">//          "include_lower": true,</span>
	<span class="token comment">//          "include_upper": true,</span>
	<span class="token comment">//          "to": 1660579923</span>
	<span class="token comment">//        }</span>
	<span class="token comment">//      }</span>
	<span class="token comment">//    },</span>
	<span class="token comment">//    "must": {</span>
	<span class="token comment">//      "term": {</span>
	<span class="token comment">//        "check_status": 2</span>
	<span class="token comment">//      }</span>
	<span class="token comment">//    },</span>
	<span class="token comment">//    "must_not": {</span>
	<span class="token comment">//      "term": {</span>
	<span class="token comment">//        "site_id": 18</span>
	<span class="token comment">//      }</span>
	<span class="token comment">//    },</span>
	<span class="token comment">//    "should": {</span>
	<span class="token comment">//      "term": {</span>
	<span class="token comment">//        "app_name": 20</span>
	<span class="token comment">//      }</span>
	<span class="token comment">//    }</span>
	<span class="token comment">//  }</span>
	<span class="token comment">// }</span>
	<span class="token comment">// 打印参数结束 ====&gt;</span>
	<span class="token comment">// 查询到的结果总数为 2</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h1</span>
	<span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="分页查询，并排序"><a href="#分页查询，并排序" class="headerlink" title="分页查询，并排序"></a>分页查询，并排序</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testPageSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 分页查询，并排序</span>
	<span class="token comment">// from 为起始偏移量（offset）默认为 0，size 为每页显示数（limit）默认为 10</span>
	<span class="token comment">// from 等于当前页码数减去一的商然后乘以每页显示数</span>
	<span class="token comment">// Sort() 第二个参数，true 为升序、false 为降序</span>
	pageRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> pageRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span>
		<span class="token keyword">var</span> tmp RcpGoodsImgChecksES
		json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"分页查询，已经命中查询的数据为 ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 分页查询，已经命中查询的数据为 ==&gt; h1</span>
	<span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 分页查询，已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 分页查询，已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 分页查询，已经命中查询的数据为 ==&gt; 2_19_alex111</span>
	<span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:18 CheckStatus:23 CreatedAt:1660579517 UpdatedAt:1660579517}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="多字段排序"><a href="#多字段排序" class="headerlink" title="多字段排序"></a>多字段排序</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMultiFieldSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 多字段排序</span>
	sortsBuilders <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>elastic<span class="token punctuation">.</span>Sorter<span class="token punctuation">{</span>
		elastic<span class="token punctuation">.</span><span class="token function">NewFieldSort</span><span class="token punctuation">(</span><span class="token string">"check_status"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 升序</span>
		elastic<span class="token punctuation">.</span><span class="token function">NewFieldSort</span><span class="token punctuation">(</span><span class="token string">"created_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 降序</span>
	<span class="token punctuation">}</span>
	sortRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SortBy</span><span class="token punctuation">(</span>sortsBuilders<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> sortRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span>
		<span class="token keyword">var</span> tmp RcpGoodsImgChecksES
		json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"多字段排序，已经命中查询的数据为 ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 多字段排序，已经命中查询的数据为 ==&gt; h1</span>
	<span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 多字段排序，已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 多字段排序，已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 多字段排序，已经命中查询的数据为 ==&gt; 2_19_alex111</span>
	<span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:18 CheckStatus:23 CreatedAt:1660579517 UpdatedAt:1660579517}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="返回指定字段（只查询指定字段）"><a href="#返回指定字段（只查询指定字段）" class="headerlink" title="返回指定字段（只查询指定字段）"></a>返回指定字段（只查询指定字段）</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testFetchSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 返回指定字段</span>
	includeFields <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewFetchSourceContext</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"app_name"</span><span class="token punctuation">,</span> <span class="token string">"goods_id"</span><span class="token punctuation">}</span><span class="token operator">...</span><span class="token punctuation">)</span>
	includeRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FetchSourceContext</span><span class="token punctuation">(</span>includeFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> includeRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span>
		<span class="token keyword">var</span> tmp RcpGoodsImgChecksES
		json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"返回指定字段，已经命中查询的数据为 ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 返回指定字段，已经命中查询的数据为 ==&gt; 2_19_alex111</span>
	<span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 返回指定字段，已经命中查询的数据为 ==&gt; h2</span>
	<span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 返回指定字段，已经命中查询的数据为 ==&gt; h1</span>
	<span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span>
	<span class="token comment">//</span>
	<span class="token comment">// 返回指定字段，已经命中查询的数据为 ==&gt; h3</span>
	<span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="查询数据总数"><a href="#查询数据总数" class="headerlink" title="查询数据总数"></a>查询数据总数</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 查询总命中计数</span>
	total<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 查询总命中计数，已经命中查询的数据为 ==&gt; 2</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"查询总命中计数，已经命中查询的数据为 ==&gt; %+v \n"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Alex</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://pudongping.github.io/posts/a443aa.html">https://pudongping.github.io/posts/a443aa.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Alex</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/ElasticSearch/"><span class="chip bg-color">ElasticSearch</span> </a><a href="/tags/Go/"><span class="chip bg-color">Go</span> </a><a href="/tags/Golang/"><span class="chip bg-color">Golang</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/my-gitalk.css"><div class="card gitalk-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container" class="card-content"></div></div><script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script><script>let gitalk=new Gitalk({clientID:"736ff0a6e49d2f9bb2ee",clientSecret:"3e2997df5da9ff995b6f0354a0e6d783cf579801",repo:"pudongping.github.io",owner:"pudongping",admin:["pudongping"],id:"2022-08-16T11-02-24",distractionFreeMode:!1});gitalk.render("gitalk-container")</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/posts/d0937fdd.html"><div class="card-image"><img src="/medias/featureimages/0.jpg" class="responsive-img" alt="Golang 时间操作大全"> <span class="card-title">Golang 时间操作大全</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2022-10-24 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Go/" class="post-category">Go</a></span></div></div><div class="card-action article-tags"><a href="/tags/Go/"><span class="chip bg-color">Go</span> </a><a href="/tags/Golang/"><span class="chip bg-color">Golang</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/2e9eaf3a.html"><div class="card-image"><img src="/medias/featureimages/3.jpg" class="responsive-img" alt="Docker 安装 ElasticSearch 和 Kibana"> <span class="card-title">Docker 安装 ElasticSearch 和 Kibana</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2022-08-06 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/ElasticSearch/" class="post-category">ElasticSearch</a></span></div></div><div class="card-action article-tags"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span> </a><a href="/tags/ElasticSearch/"><span class="chip bg-color">ElasticSearch</span> </a><a href="/tags/Kibana/"><span class="chip bg-color">Kibana</span></a></div></div></div></div></article></div><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff;overflow-y:scroll;height:400px"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4, h5"});let t=0,e="toc-heading-";$("#toc-content a").each(function(){$(this).attr("href","#"+e+ ++t)}),t=0,$("#articleContent").children("h1, h2, h3, h4, h5").each(function(){$(this).attr("id",e+ ++t)});let n=parseInt(.4*$(window).height()-64),o=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>n?o.addClass("toc-fixed"):o.removeClass("toc-fixed")});const i="expanded";let c=$("#toc-aside"),l=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){c.hasClass(i)?(c.removeClass(i).hide(),l.removeClass("l9")):(c.addClass(i).show(),l.addClass("l9")),function(t,e){let n=$("#"+t);if(0!==n.length){let t=n.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+e).width(t)}}("artDetail","prenext-posts")})})</script></main><script src="https://readmore.openwrite.cn/js/readmore-2.0.js" type="text/javascript"></script><script>const btw=new BTWPlugin;btw.init({id:"artDetail",blogId:"33149-1720714429832-433",name:"左诗右码",qrcode:"https://mmbiz.qpic.cn/sz_mmbiz_jpg/vQwlDq5Yfs1HQb8cN6e9TTwqBEYBfgJKuejrXaqS6VXAheLQfqnT99UpI0icS9aFPpIz0TFlwibibIibibwo0nxl4Dw/640?wx_fmt=jpeg",keyword:"666",btnText:"原创不易，完成人机检测，阅读全文",displayPercentage:.5,helloworld:"https://readmore.openwrite.cn/code/generate?blogId=33149-1720714429832-433"})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2018-2024</span> <a href="/about" target="_blank">Alex</a> |&nbsp;<span style="margin:0 5px;display:inline-block"><i class="fa fa-heart" style="color:#ff71a8"></i></span> Powered by <a href="/about" target="_blank">Alex</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">243.4k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次 </span><span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><span id="sitetime">载入运行时间...</span><script>function siteTime(){var e=36e5,t=24*e,n=new Date,o="2018",r=n.getFullYear(),a=n.getMonth()+1,i=n.getDate(),l=n.getHours(),m=n.getMinutes(),M=n.getSeconds(),n=Date.UTC(o,"5","20","0","0","0"),i=Date.UTC(r,a,i,l,m,M)-n,l=Math.floor(i/31536e6),m=Math.floor(i/t-365*l),M=Math.floor((i-(365*l+m)*t)/e),n=Math.floor((i-(365*l+m)*t-M*e)/6e4),e=Math.floor((i-(365*l+m)*t-M*e-6e4*n)/1e3);o==r?(document.getElementById("year").innerHTML=r,document.getElementById("sitetime").innerHTML="本站已安全运行 "+m+" 天 "+M+" 小时 "+n+" 分钟 "+e+" 秒"):(document.getElementById("year").innerHTML=o+" - "+r,document.getElementById("sitetime").innerHTML="本站已安全运行 "+l+" 年 "+m+" 天 "+M+" 小时 "+n+" 分钟 "+e+" 秒")}setInterval(siteTime,1e3)</script><br><span><a href="http://beian.miit.gov.cn/" target="_blank">鄂ICP备18004705号-2</a> </span>&nbsp; | &nbsp; <span id="icp"><img src="/medias/icp.png" style="vertical-align:text-bottom"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42052802000032" target="_blank">鄂公网安备 42052802000032号</a></span></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/pudongping" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:276558492@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1414818093" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1414818093" data-position="top" data-delay="50"><i class="fab fa-qq"></i> </a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,r,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(r),n=document.getElementById(s);t.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s=!0,i=t.title.trim().toLowerCase(),l=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),a=0===(a=t.url).indexOf("/")?t.url:"/"+a,c=-1,u=-1;""!==i&&""!==l&&h.forEach(function(t,e){n=i.indexOf(t),c=l.indexOf(t),n<0&&c<0?s=!1:(c<0&&(c=0),0===e&&(u=c))}),s&&(o+="<li><a href='"+a+"' class='search-result-title'>"+i+"</a>",e=t.content.trim().replace(/<[^>]+>/g,""),0<=u&&(a=u+80,(a=0===(t=(t=u-20)<0?0:t)?100:a)>e.length&&(a=e.length),r=e.substr(t,a),h.forEach(function(t){var e=new RegExp(t,"gi");r=r.replace(e,'<em class="search-keyword">'+t+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script><script src="https://cdn.bootcss.com/masonry/4.2.2/masonry.pkgd.min.js"></script><script src="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.js"></script><script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script><script src="https://cdn.bootcss.com/lightgallery/1.6.12/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script type="text/javascript">var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="看不见我🙈~看不见我🙈~",clearTimeout(st)):(document.title="(๑•̀ㅂ•́) ✧被发现了～",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script><script type="text/javascript">768<$(window).width()&&document.write('<script type="text/javascript" src="/js/wordfloat.js"><\/script>')</script><script type="text/javascript">768<$(window).width()&&document.write('<script type="text/javascript" src="/js/snow.js"><\/script>')</script><script type="text/javascript" color="0,0,255" pointcolor="0,0,255" opacity="0.8" zindex="-1" count="99" src="/libs/background/canvas-nest.js"></script><script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>