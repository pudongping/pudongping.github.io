---
title: å¦‚ä½•åˆ¤æ–­ä¸¤å¼ å›¾ç‰‡çš„ç›¸ä¼¼åº¦ï¼ŸåŸæ¥å›¾ç‰‡å¯¹æ¯”ä¹Ÿå¯ä»¥å¦‚æ­¤ç®€å•ï¼
author: Alex
top: false
hide: false
cover: false
toc: true
mathjax: false
categories: Go
tags:
  - Go
  - Golang
abbrlink: 5c16cd6d
date: 2025-06-10 11:10:01
img:
coverImg:
password:
summary:
---

åœ¨ä»‹ç»æŠ€æœ¯ç»†èŠ‚å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å›¾ç‰‡å¯¹æ¯”åœ¨å“ªäº›åœºæ™¯ä¸‹å¯ä»¥ç”¨å¾—åˆ°ï¼š

1. å›¾ç‰‡å»é‡ï¼šè‡ªåŠ¨åˆ é™¤é‡å¤å›¾ç‰‡ï¼Œä¸ºå­˜å‚¨ç©ºé—´"ç˜¦èº«"ã€‚æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªç¤¾äº¤åª’ä½“å¹³å°çš„è¿è¥ï¼Œæ¯å¤©è¦å¤„ç†æ•°ä¸‡å¼ å›¾ç‰‡ã€‚é‡å¤å›¾ç‰‡ä¸ä»…å ç”¨å­˜å‚¨ç©ºé—´ï¼Œè¿˜ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚
2. å†…å®¹å®¡æ ¸ï¼šä¸€äº›å¹³å°éœ€è¦ç­›é€‰ç›¸ä¼¼æˆ–é‡å¤çš„å†…å®¹ï¼Œé˜²æ­¢ç‰ˆæƒä¾µçŠ¯å’Œå†…å®¹åƒåœ¾ã€‚
3. ç‰ˆæƒç»´æƒï¼šæ£€æµ‹å›¾ç‰‡æœ‰æ— è¢«æœªç»æˆæƒä½¿ç”¨çš„æƒ…å†µï¼Œæ¯”å¦‚ï¼Œæ‘„å½±å¸ˆå’Œè®¾è®¡å¸ˆéœ€è¦çŸ¥é“è‡ªå·±çš„ä½œå“æ˜¯å¦è¢«æœªç»æˆæƒä½¿ç”¨ã€‚
4. ç›¸ä¼¼å›¾ç‰‡æœç´¢ï¼šç½‘ç›˜ã€äº‘å­˜å‚¨æœåŠ¡éœ€è¦å¸®åŠ©ç”¨æˆ·æ¸…ç†é‡å¤æ–‡ä»¶ã€‚

åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œå›¾ç‰‡å¯¹æ¯”æŠ€æœ¯å¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨åŒ–å¤„ç†å¤§é‡å›¾ç‰‡ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚

ä½†æ˜¯ï¼Œå›¾ç‰‡å¯¹æ¯”å¯ä¸åƒ**å­—ç¬¦**é‚£æ ·å¯ä»¥ç›´æ¥ä½¿ç”¨ç­‰äºå·`=`ç›´æ¥å¯¹æ¯”ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æœ‰å“ªäº›å¯¹æ¯”æ–¹å¼å‘¢ï¼Ÿ

## æ–¹æ³•ä¸€ï¼šMD5æŒ‡çº¹å¯¹æ¯” - ç²¾ç¡®åŒ¹é…

MD5 æ˜¯ä¸€ç§ä¿¡æ¯æ‘˜è¦ç®—æ³•ï¼Œå¯ä»¥å°†ä»»æ„é•¿åº¦çš„æ•°æ®æ˜ å°„ä¸ºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ã€‚å¯¹äºå›¾ç‰‡æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è®¡ç®—å‡ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ MD5 å€¼ï¼Œå°±åƒä¸€ä¸ªæ•°å­—æŒ‡çº¹ï¼Œå¯ä»¥ç”¨æ¥**ç²¾ç¡®æ¯”å¯¹**ä¸¤ä¸ªæ–‡ä»¶ï¼ˆä¸ä»…ä»…æ˜¯å›¾ç‰‡ï¼‰æ˜¯å¦å®Œå…¨ç›¸åŒã€‚

ä¸‹é¢æ˜¯ä½¿ç”¨ Go è¯­è¨€è®¡ç®—å›¾ç‰‡ MD5 å€¼çš„ç¤ºä¾‹ä»£ç ï¼š

```go
package main

import (
    "crypto/md5"
    "fmt"
    "io"
    "os"
)

// calculateMD5 è®¡ç®—æ–‡ä»¶çš„MD5å€¼
// ä¸ºå›¾ç‰‡é¢å‘ç‹¬ä¸€æ— äºŒçš„â€œèº«ä»½è¯â€
func calculateMD5(filePath string) (string, error) {
    // æ‰“å¼€æ–‡ä»¶
    file, err := os.Open(filePath)
    if err != nil {
        return "", fmt.Errorf("æ— æ³•æ‰“å¼€æ–‡ä»¶ï¼š%v", err)
    }
    defer file.Close()

    // åˆ›å»ºMD5å“ˆå¸Œå™¨
    hash := md5.New()

    // å°†æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°å“ˆå¸Œå™¨ä¸­
    if _, err := io.Copy(hash, file); err != nil {
        return "", fmt.Errorf("è®¡ç®—MD5æ—¶å‡ºé”™ï¼š%v", err)
    }

    // è¿”å›MD5å­—ç¬¦ä¸²
    return fmt.Sprintf("%x", hash.Sum(nil)), nil
}

func main() {
    // æ¯”è¾ƒä¸¤å¼ å›¾ç‰‡
    md51, err := calculateMD5("image1.jpg")
    if err != nil {
        fmt.Println("å›¾ç‰‡1å¤„ç†å¤±è´¥:", err)
        return
    }

    md52, err := calculateMD5("image2.jpg")
    if err != nil {
        fmt.Println("å›¾ç‰‡2å¤„ç†å¤±è´¥:", err)
        return
    }

    // å¯¹æ¯”ç»“æœ
    if md51 == md52 {
        fmt.Println("å›¾ç‰‡å®Œå…¨ç›¸åŒ")
    } else {
        fmt.Println("å›¾ç‰‡ä¸åŒ")
    }
}
```

ä»£ç è§£è¯»ï¼š

1. æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª `calculateMD5` å‡½æ•°ï¼Œä¼ å…¥æ–‡ä»¶è·¯å¾„ï¼Œè¿”å›è®¡ç®—å‡ºçš„ MD5 å­—ç¬¦ä¸²ã€‚
2. å‡½æ•°ä¸­å…ˆæ‰“å¼€æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª MD5 å“ˆå¸Œå™¨ `hash`ã€‚
3. é€šè¿‡`io.Copy`å°†æ–‡ä»¶å†…å®¹å†™å…¥å“ˆå¸Œå™¨ä¸­ï¼Œè®¡ç®—å‡º MD5 å€¼ã€‚
4. æœ€åå°† MD5 å­—èŠ‚æ•°ç»„æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚
5. åœ¨ `main` å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—ä¸¤ä¸ªå›¾ç‰‡æ–‡ä»¶çš„ MD5 å€¼ï¼Œæ¯”å¯¹å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œè¾“å‡ºç»“æœã€‚

MD5 æ¯”å¯¹çš„ç‰¹ç‚¹ï¼š

- âœ… é€Ÿåº¦å¿«ã€è®¡ç®—ç®€å•
- âœ… å¯**ç²¾ç¡®åˆ¤æ–­ä¸¤ä¸ªæ–‡ä»¶**æ˜¯å¦å®Œå…¨ç›¸åŒï¼ˆåªè¦æ˜¯æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸€æ ·ï¼‰
- âŒ æ— æ³•æ£€æµ‹å†…å®¹ç›¸ä¼¼ä½†ä¸å®Œå…¨ç›¸åŒçš„å›¾ç‰‡
- ğŸ å›¾ç‰‡ç¨æœ‰æ”¹åŠ¨(å¦‚æ·»åŠ æ°´å°)å°±ä¼šå¯¼è‡´ MD5 å€¼å®Œå…¨ä¸åŒ


æ‰€ä»¥ **MD5 æ¯”å¯¹é€‚åˆç”¨äºæ£€æµ‹å®Œå…¨ç›¸åŒçš„å›¾ç‰‡**ï¼Œå¦‚æ–‡ä»¶å»é‡ç­‰åœºæ™¯ã€‚å¦‚æœä¸¤å¼ å›¾ç‰‡åªæ˜¯ç¨ä½œä¿®æ”¹ï¼ˆå¦‚è°ƒæ•´äº®åº¦ã€æ—‹è½¬ç­‰ï¼‰ï¼ŒMD5 å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚

æ¯”å¦‚ä¸‹é¢è¿™ä¸¤å¼ å›¾ï¼Œæˆ‘åªæ˜¯ç¨å¾®è£å‰ªäº†ä¸€ä¸‹

![åŸå›¾](https://upload-images.jianshu.io/upload_images/14623749-773ea3949607c219.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![è£å‰ªåçš„](https://upload-images.jianshu.io/upload_images/14623749-75b1337ed12b3486.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è™½ç„¶ï¼Œè£å‰ªä¹‹åï¼Œç¡®å®å·²ç»ä¸æ˜¯**ä¸€æ‘¸ä¸€æ ·**çš„å›¾ç‰‡äº†ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è§‰å¾—è¿™ä¸¤å¼ å›¾ç‰‡å…¶å®å°±æ˜¯**é•¿å¾—éå¸¸åƒçš„ä¸¤å¼ å›¾**ï¼Œå…¶å®æˆ‘ä»¬è¿˜æ˜¯å¾—è®¤ä¸ºå®ƒä»¬å°±æ˜¯ä¸€å¼ å›¾ã€‚é‚£ä¹ˆåƒè¿™æ ·çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å¦‚ä½•åŒºåˆ†å‘¢ï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å›¾åƒå“ˆå¸Œç®—æ³•ã€‚


## æ–¹æ³•äºŒï¼šå›¾åƒå“ˆå¸Œå¯¹æ¯”

å›¾åƒå“ˆå¸Œ(Image Hashing)æ˜¯ä¸€ç±»å¯ä»¥æ¯”è¾ƒå›¾ç‰‡ç›¸ä¼¼ç¨‹åº¦çš„ç®—æ³•ã€‚å…¶åŸºæœ¬åŸç†æ˜¯ï¼šå°†å›¾ç‰‡ç¼©å°ã€ç®€åŒ–ä¸ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åæ¯”è¾ƒä¸åŒå›¾ç‰‡å“ˆå¸Œå€¼çš„å·®å¼‚åº¦ï¼Œæ¥åˆ¤æ–­å®ƒä»¬çš„ç›¸ä¼¼ç¨‹åº¦ã€‚

å¸¸è§çš„å›¾åƒå“ˆå¸Œç®—æ³•æœ‰ï¼š

1. å¹³å‡å“ˆå¸Œ(Average Hash)
2. æ„ŸçŸ¥å“ˆå¸Œ(Perceptual Hash)
3. å·®å¼‚å“ˆå¸Œ(Difference Hash)
4. å°æ³¢å“ˆå¸Œ(Wavelet Hash)

è¿™é‡Œæˆ‘ä»¬ä»¥ç¬¬ä¸‰æ–¹åŒ…ä¸ºä¾‹ï¼š

é¦–å…ˆå…ˆå®‰è£…è¿™ä¸ªåŒ…

```bash
go get github.com/corona10/goimagehash
```

ç„¶åæˆ‘ä»¬æ¥å°è¯•å®ç°ä¸€ä¸ªå›¾ç‰‡ç›¸ä¼¼åº¦æ¯”å¯¹ï¼š

```go
package main

import (
	"fmt"
	"image/png"
	"os"

	"github.com/corona10/goimagehash"
)

// compareImageSimilarity æ¯”è¾ƒå›¾ç‰‡ç›¸ä¼¼åº¦
func compareImageSimilarity(image1Path, image2Path string) error {
	file1, err := os.Open(image1Path)
	if err != nil {
		return fmt.Errorf("æ‰“å¼€å›¾ç‰‡1å¤±è´¥ï¼š%v", err)
	}
	defer file1.Close()

	file2, err := os.Open(image2Path)
	if err != nil {
		return fmt.Errorf("æ‰“å¼€å›¾ç‰‡2å¤±è´¥ï¼š%v", err)
	}
	defer file2.Close()

	// åŠ è½½å›¾ç‰‡
	img1, err := png.Decode(file1)
	if err != nil {
		return fmt.Errorf("åŠ è½½å›¾ç‰‡1å¤±è´¥ï¼š%v", err)
	}

	img2, err := png.Decode(file2)
	if err != nil {
		return fmt.Errorf("åŠ è½½å›¾ç‰‡2å¤±è´¥ï¼š%v", err)
	}

	// ç”Ÿæˆå¹³å‡å“ˆå¸Œ
	avgHash1, err := goimagehash.AverageHash(img1)
	if err != nil {
		return fmt.Errorf("ç”Ÿæˆå›¾ç‰‡1å“ˆå¸Œå¤±è´¥ï¼š%v", err)
	}

	avgHash2, err := goimagehash.AverageHash(img2)
	if err != nil {
		return fmt.Errorf("ç”Ÿæˆå›¾ç‰‡2å“ˆå¸Œå¤±è´¥ï¼š%v", err)
	}

	// è®¡ç®—å·®å¼‚å“ˆå¸Œ
	diffHash1, err := goimagehash.DifferenceHash(img1)
	if err != nil {
		return fmt.Errorf("ç”Ÿæˆå›¾ç‰‡1å·®å¼‚å“ˆå¸Œå¤±è´¥ï¼š%v", err)
	}

	diffHash2, err := goimagehash.DifferenceHash(img2)
	if err != nil {
		return fmt.Errorf("ç”Ÿæˆå›¾ç‰‡2å·®å¼‚å“ˆå¸Œå¤±è´¥ï¼š%v", err)
	}

	// è®¡ç®—æ±‰æ˜è·ç¦»
	avgDistance, err := avgHash1.Distance(avgHash2)
	if err != nil {
		return fmt.Errorf("è®¡ç®—å¹³å‡å“ˆå¸Œè·ç¦»å¤±è´¥ï¼š%v", err)
	}

	diffDistance, err := diffHash1.Distance(diffHash2)
	if err != nil {
		return fmt.Errorf("è®¡ç®—å·®å¼‚å“ˆå¸Œè·ç¦»å¤±è´¥ï¼š%v", err)
	}

	// æ‰“å°ç›¸ä¼¼åº¦
	fmt.Printf("å¹³å‡å“ˆå¸Œè·ç¦»ï¼š%d\n", avgDistance)
	fmt.Printf("å·®å¼‚å“ˆå¸Œè·ç¦»ï¼š%d\n", diffDistance)

	// åˆ¤æ–­ç›¸ä¼¼ç¨‹åº¦
	if avgDistance == 0 && diffDistance == 0 {
		fmt.Println("ä¸¤å¼ å›¾ä¸€æ ·")
	} else if avgDistance <= 5 || diffDistance <= 5 {
		fmt.Println("å›¾ç‰‡é«˜åº¦ç›¸ä¼¼")
	} else if avgDistance <= 10 || diffDistance <= 10 {
		fmt.Println("å›¾ç‰‡ç›¸ä¼¼")
	} else {
		fmt.Println("å›¾ç‰‡å·®å¼‚è¾ƒå¤§")
	}

	return nil
}

func main() {
	err := compareImageSimilarity("img.png", "img_1.png")
	if err != nil {
		fmt.Println("å›¾ç‰‡å¯¹æ¯”å‡ºé”™ï¼š", err)
	}
}

```

å›¾åƒå“ˆå¸Œçš„ç‰¹ç‚¹:

- âœ… å¯ä»¥æ¯”è¾ƒå›¾ç‰‡å†…å®¹çš„ç›¸ä¼¼ç¨‹åº¦
- âœ… å¯¹å›¾ç‰‡çš„ç¼©æ”¾ã€æ—‹è½¬ã€äº®åº¦å˜åŒ–ç­‰ç¨å¾®é²æ£’
- âœ… è®¡ç®—éš¾åº¦é€‚ä¸­,å¯åº”ç”¨äºç›¸ä¼¼å›¾ç‰‡æœç´¢ç­‰åœºæ™¯
- âŒ ä»æ— æ³•è¯†åˆ«å®Œå…¨ä¸åŒä½†è¯­ä¹‰ç›¸ä¼¼çš„å›¾ç‰‡(æ¯”å¦‚åŒä¸€ç‰©ä½“ä¸åŒè§’åº¦çš„ç…§ç‰‡)

å®ƒä»¬å„æœ‰ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼š

MD5æŒ‡çº¹ï¼šç®€å•å¿«é€Ÿï¼Œé€‚åˆç²¾ç¡®åŒ¹é…å®Œå…¨ç›¸åŒçš„å›¾ç‰‡ã€‚
å›¾åƒå“ˆå¸Œï¼šå¯ä»¥æ¯”è¾ƒå›¾ç‰‡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œåœ¨ç›¸ä¼¼å›¾ç‰‡æœç´¢ç­‰åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨ã€‚

å½“ç„¶ï¼Œè¿™åªæ˜¯å›¾åƒç›¸ä¼¼åº¦ç®—æ³•çš„å†°å±±ä¸€è§’ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æ€§èƒ½ã€ç²¾åº¦ã€å¤æ‚åº¦ç­‰å› ç´ ï¼Œé€‰æ‹©æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚

å›¾åƒè¯†åˆ«é¢†åŸŸåœ¨ä¸æ–­å‘å±•ï¼Œä¸€äº›å‰æ²¿æŠ€æœ¯å¦‚æœºå™¨å­¦ä¹ ã€æ·±åº¦ç¥ç»ç½‘ç»œç­‰ï¼Œä¸ºå›¾ç‰‡ç›¸ä¼¼åº¦åˆ¤æ–­å¸¦æ¥äº†æ›´å¤šçš„å¯èƒ½æ€§ï¼Œå€¼å¾—æˆ‘ä»¬å»å­¦ä¹ å’Œæ¢ç´¢ã€‚

> æºç æˆ‘æ”¾åœ¨è¿™é‡Œäº† `https://github.com/pudongping/golang-tutorial/tree/main/project/compare_image_similarity` æœ‰éœ€è¦çš„ç«¥é‹ï¼Œå¯ä»¥è‡ªå–ã€‚