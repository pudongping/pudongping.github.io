---
title: ä¸€æ–‡åƒé€ Promise ä¸ async/awaitï¼Œå¼‚æ­¥ç¼–ç¨‹ä¹Ÿèƒ½å¦‚æ­¤ç®€å•ï¼å»ºè®®æ”¶è—ï¼
author: Alex
top: false
hide: false
cover: false
toc: true
mathjax: false
categories: å‰ç«¯
tags:
  - å‰ç«¯
  - promise
  - å¼‚æ­¥ç¼–ç¨‹
abbrlink: da88494b
date: 2025-08-12 11:39:29
img:
coverImg:
password:
summary:
---

åœ¨ç°ä»£ç¼–ç¨‹å¼€å‘ä¸­ï¼Œâ€œå¼‚æ­¥â€ä¸¤ä¸ªå­—å‡ ä¹è´¯ç©¿å§‹ç»ˆï¼šä½ å†™çš„æ¥å£è¯·æ±‚ã€å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ã€åŠ¨ç”»æ§åˆ¶â€¦â€¦èƒŒåéƒ½ç»•ä¸å¼€å¼‚æ­¥ç¼–ç¨‹ã€‚

é‚£åˆ°åº•å•¥æ˜¯**å¼‚æ­¥**å‘¢ï¼Ÿè¯´åˆ°å¼‚æ­¥ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»“åˆ**åŒæ­¥**æ¥è®²è®²ï¼Œè¿™æ ·å°±æ›´åŠ æ¸…æ™°æ˜äº†ã€‚

ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ¥è®²è®²åœ¨å‰ç«¯ç¼–ç¨‹ä¸­çš„å¼‚æ­¥ã€‚

![](https://upload-images.jianshu.io/upload_images/14623749-10a759c049bf064e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç®€å•ç‚¹è¯´ï¼š

- **åŒæ­¥æ“ä½œ**ï¼šä»£ç ä¸€è¡Œä¸€è¡Œæ‰§è¡Œï¼Œä¸Šä¸€è¡Œæ²¡è·‘å®Œï¼Œä¸‹ä¸€è¡Œå°±å¾—ç­‰ç€ã€‚
- **å¼‚æ­¥æ“ä½œ**ï¼šæŸäº›ä»»åŠ¡ï¼ˆæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼‰å¯èƒ½éœ€è¦ç­‰ä¸€æ®µæ—¶é—´æ‰èƒ½å®Œæˆï¼Œè€Œç¨‹åºå¯ä»¥å…ˆä¸ç­‰å®ƒï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç­‰å®ƒå¥½äº†å†å›æ¥å¤„ç†ã€‚

ä¸¾ä¸ªæ —å­ğŸŒ°

```js
console.log("1. å¼€å§‹åšé¥­");

setTimeout(() => {
  console.log("2. é¥­åšå¥½äº†");
}, 3000);

console.log("3. ç©æ‰‹æœºä¸­...");
```

ä½ å°†çœ‹åˆ°çš„è¾“å‡ºå†…å®¹æ˜¯ï¼š

```markdown
1. å¼€å§‹åšé¥­
3. ç©æ‰‹æœºä¸­...
2. é¥­åšå¥½äº†ï¼ˆå¤§çº¦ 3 ç§’åï¼‰
```

è¿™å°±ä½“ç°äº†å¼‚æ­¥ï¼š**åšé¥­**è¿™ä»¶äº‹éœ€è¦ 3 ç§’æ—¶é—´ï¼Œä¸å½±å“ä½ â€œç©æ‰‹æœºâ€çš„ä¸‹ä¸€æ­¥æ“ä½œã€‚

---

## ğŸŒ± ä¸€ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ Promiseï¼Ÿ

æ—©æœŸå¤„ç†å¼‚æ­¥çš„æ–¹å¼æ˜¯**å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰**ã€‚

```js
function cook(callback) {
  setTimeout(() => {
    callback("ğŸ³ é¥­åšå¥½äº†");
  }, 3000);
}

cook((msg) => {
  console.log(msg);
});
```

ä¸Šé¢çš„ä»£ç ï¼Œè²Œä¼¼ä¹Ÿæ²¡å•¥å¤ªå¤§çš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ˜¯éœ€è¦**åšä¸‰é“èœ**å‘¢ï¼Ÿä»£ç å¯èƒ½å°±æ˜¯è¿™æ ·çš„äº†ï¼š

```js
cook((msg1) => {
  console.log(msg1);
  cook((msg2) => {
    console.log(msg2);
    cook((msg3) => {
      console.log(msg3);
      // ç»§ç»­åµŒå¥—â€¦â€¦
    });
  });
});
```

æ˜¯çš„ï¼Œè¿™å°±æ˜¯ææ€–çš„â€œ**å›è°ƒåœ°ç‹±**â€ï¼š

æ˜çœ¼äººéƒ½èƒ½å¤Ÿçœ‹å¾—å‡ºæ¥ï¼Œè¿™æ ·çš„ä»£ç å¤ªéš¾ç»´æŠ¤ï¼Œå¤ªå®¹æ˜“å‡º bugï¼Œäºæ˜¯ ES6 å°±æ¨å‡ºäº† Promise æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

---

## ğŸ” äºŒã€ä»€ä¹ˆæ˜¯ Promiseï¼Ÿ

ä¸€å¥è¯æ€»ç»“ï¼š

> Promise æ˜¯ JavaScript ä¸­å¤„ç†å¼‚æ­¥æ“ä½œçš„ä¸€ç§å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªè¿˜æ²¡å®Œæˆä½†å°†æ¥ä¸€å®šä¼šå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰çš„æ“ä½œç»“æœã€‚

å®ƒæœ‰ä¸‰ä¸ªçŠ¶æ€ï¼š

| çŠ¶æ€        | æ„ä¹‰       |
| --------- | -------- |
| pending   | åˆå§‹çŠ¶æ€ï¼Œè¿›è¡Œä¸­ |
| fulfilled | æ“ä½œæˆåŠŸ     |
| rejected  | æ“ä½œå¤±è´¥     |

çŠ¶æ€ä¸€æ—¦å˜åŒ–ï¼Œå°±ä¸å¯é€†ã€‚

---

## âœ¨ ä¸‰ã€Promise åŸºæœ¬ç”¨æ³•

æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæœ€ç®€å•çš„ Promiseï¼š

```js
const p = new Promise((resolve, reject) => {
  const success = true;

  if (success) {
    resolve("æˆåŠŸå•¦ï¼");
  } else {
    reject("å¤±è´¥äº†ï½");
  }
});

p.then((result) => {
  console.log("æˆåŠŸï¼š", result);
}).catch((err) => {
  console.error("å¤±è´¥ï¼š", err);
});
```

### ğŸ” è§£è¯»ä¸€ä¸‹ï¼š

* `resolve(value)` è¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡**æˆåŠŸ**ï¼Œä¼ å‡ºç»“æœã€‚
* `reject(error)` è¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡**å¤±è´¥**ã€‚
* `.then()` æ˜¯æˆåŠŸçš„å›è°ƒï¼Œ`.catch()` æ˜¯å¤±è´¥çš„å›è°ƒã€‚

---

## ğŸ”— å››ã€Promise é“¾å¼è°ƒç”¨

ä½ å¯ä»¥è¿ç»­ä½¿ç”¨ `.then()` æ¥å¤„ç†ä¸€ç³»åˆ—å¼‚æ­¥ä»»åŠ¡ï¼š

```js
new Promise((resolve) => {
  setTimeout(() => {
    console.log("1ï¸âƒ£ æ•°æ®åŠ è½½ä¸­...");
    resolve("åŸå§‹æ•°æ®");
  }, 1000);
})
  .then((data) => {
    console.log("2ï¸âƒ£ ç¬¬ä¸€æ¬¡å¤„ç†ï¼š", data);
    return data + " + æ­¥éª¤ä¸€å®Œæˆ";
  })
  .then((newData) => {
    console.log("3ï¸âƒ£ ç¬¬äºŒæ¬¡å¤„ç†ï¼š", newData);
  })
  .catch((err) => {
    console.error("å‘ç”Ÿé”™è¯¯ï¼š", err);
  });
```

æ¯ä¸ª `.then()` çš„è¿”å›å€¼ä¼šä¼ ç»™ä¸‹ä¸€ä¸ª `.then()`ã€‚

---

## âš™ï¸ äº”ã€å®æˆ˜ï¼šæ¥å£è¯·æ±‚åœºæ™¯

å®é™…å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸å†™è¿™ç§ï¼š

```javascript
fetch("https://api.example.com/user/123")
  .then((res) => {
    if (!res.ok) throw new Error("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼");
    return res.json(); // è½¬æˆ JSON
  })
  .then((user) => {
    console.log("ç”¨æˆ·ä¿¡æ¯ï¼š", user);
  })
  .catch((err) => {
    console.error("è¯·æ±‚å¤±è´¥ï¼š", err);
  });
```

è¿™é‡Œç”¨çš„ `fetch` å°±æ˜¯ä¸€ä¸ªè¿”å› Promise çš„ APIã€‚

---

## ğŸ­ å…­ã€async/await æ˜¯ä»€ä¹ˆï¼Ÿ

async/await æ˜¯ ES7 å¯¹ Promise çš„ä¸€ç§ **è¯­æ³•ç³–**ï¼Œè®©æˆ‘ä»¬ç”¨çœ‹èµ·æ¥æ˜¯**åŒæ­¥çš„å†™æ³•**æ¥å†™å¼‚æ­¥ä»£ç ï¼Œè¿™ä½¿å¾—ä»£ç å¯ä»¥æ›´æ¸…æ™°ã€å¯è¯»æ€§æ›´é«˜ã€‚

æ¥ï¼Œè®©æˆ‘ä»¬æ¥æ„Ÿå—ä¸€ä¸‹å·®è·ğŸ‘‡

### ğŸ‘€ Promise å†™æ³•

```js
fetch("/api/data")
  .then((res) => res.json())
  .then((data) => console.log("æ•°æ®ï¼š", data))
  .catch((err) => console.error("å‡ºé”™äº†", err));
```

### async/await å†™æ³•

```js
async function getData() {
  try {
    const res = await fetch("/api/data");
    const data = await res.json();
    console.log("æ•°æ®ï¼š", data);
  } catch (err) {
    console.error("å‡ºé”™äº†", err);
  }
}

getData();
```

å°†ä»£ç åšäº†ä¸€ä¸ªç®€å•çš„è°ƒæ•´ä¹‹åï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰ç¬é—´å°±æ¸…çˆ½å¤šäº†ï¼Ÿ

- **async** è¡¨ç¤ºè¿™ä¸ªå‡½æ•°é‡Œæœ‰å¼‚æ­¥é€»è¾‘
- **await** ç”¨æ¥â€œç­‰å¾…â€ä¸€ä¸ª Promise çš„ç»“æœ

---

## ğŸ“Œ ä¸ƒã€async/await çš„å‡ ä¸ªé‡ç‚¹è§„åˆ™

### âœ… 1. async å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª Promise

```js
async function hello() {
  return "ä½ å¥½";
}

hello().then((res) => console.log(res)); // è¾“å‡º "ä½ å¥½"
```

### âœ… 2. await åªèƒ½ç”¨åœ¨ async å‡½æ•°å†…éƒ¨

```js
await fetch("/api"); // âŒ è¯­æ³•é”™è¯¯

// æ­£ç¡®å†™æ³•ğŸ‘‡
async function load() {
  const res = await fetch("/api");
}
```

### âœ… 3. é”™è¯¯è¦ try/catch åŒ…è£¹ä½

```js
async function load() {
  try {
    const res = await fetch("/api/bad-url");
    const data = await res.json();
  } catch (err) {
    console.error("æ•è·é”™è¯¯ï¼š", err);
  }
}
```

---

## ğŸ§ª å…«ã€å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»„åˆ

### Promise.all

å¦‚æœåŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”éœ€è¦ç­‰å…¨éƒ¨æˆåŠŸåå†å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ï¼š

```js
const getUser = fetch("/api/user");
const getPosts = fetch("/api/posts");

const [userRes, postsRes] = await Promise.all([getUser, getPosts]);
```

### Promise.race

å¦‚æœæœ‰å¤šä¸ªå¼‚æ­¥ä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯åªéœ€è¦è°å…ˆæ‰§è¡Œå®Œæ¯•å°±ç”¨è°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ï¼š

```js
const res = await Promise.race([fetch("/a"), fetch("/b")]);
```

ä»¥ä¸Šçš„ä»£ç ï¼Œå¦‚æœ `/a` å…ˆæ‰§è¡Œå®Œï¼Œé‚£ä¹ˆå°± `res` å°±æ˜¯ `/a` çš„è¿”å›ç»“æœï¼Œå¦‚æœæ˜¯ `/b` å…ˆè¿”å›å®Œï¼Œé‚£ä¹ˆå°±æ˜¯ `/b` çš„è¿”å›ç»“æœã€‚æ€»ä¹‹ï¼Œè°æ‰§è¡Œçš„å¿«ï¼Œè°å…ˆæ‰§è¡Œå®Œæˆï¼Œ`res` å°±æ˜¯è°çš„ç»“æœã€‚


---

## ğŸ æ€»ç»“ä¸€ä¸‹

Promise æ˜¯å‰ç«¯å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œè€Œ async/await åˆ™å¯ä»¥è®©ä½ çš„ä»£ç æ›´åŠ ä¼˜é›…ï¼Œå¦‚æœä½ èƒ½å¤Ÿç†Ÿç»ƒæŒæ¡å®ƒä»¬ï¼š

* èƒ½è®©ä½ çš„ä»£ç æ›´æ¸…æ™°ï¼›
* èƒ½å†™å‡ºæ›´ä¼˜é›…ã€å¯ç»´æŠ¤çš„ä¸šåŠ¡é€»è¾‘ï¼›
* è¿˜èƒ½åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºï¼


