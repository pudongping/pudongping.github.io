<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Goè¯­è¨€ä¸­å¦‚ä½•æ‰«æRedisä¸­å¤§é‡çš„key</title>
      <link href="posts/9b127c3.html"/>
      <url>posts/9b127c3.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Redis ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦éå†å¤§é‡çš„é”®æ—¶ï¼Œç›´æ¥ä½¿ç”¨ <code>KEYS</code> å‘½ä»¤ä¼šé¢ä¸´æ€§èƒ½ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯åœ¨é”®æ•°é‡éå¸¸å¤šçš„æƒ…å†µä¸‹ã€‚</p><p><code>KEYS</code> å‘½ä»¤ä¼šä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰åŒ¹é…çš„é”®ï¼Œè¿™å¯èƒ½å¯¼è‡´ Redis é˜»å¡ï¼Œä¸¥é‡å½±å“çº¿ä¸ŠæœåŠ¡çš„ç¨³å®šæ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis æä¾›äº† <code>SCAN</code> å‘½ä»¤ï¼Œç”¨äºåˆ†æ‰¹æ¬¡è¿­ä»£é”®ï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰æ•°æ®ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸¤ä¸ªç¤ºä¾‹ä»£ç ï¼Œè¯¦ç»†è®²è§£å¦‚ä½•åœ¨ Go è¯­è¨€ä¸­ä½¿ç”¨ <code>SCAN</code> å‘½ä»¤éå† Redis é”®ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„æ˜¯ <code>github.com/go-redis/redis</code> åŒ…ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª redis é“¾æ¥</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> redis_demo<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"github.com/go-redis/redis"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">RDBClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>redis<span class="token punctuation">.</span>Client<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åˆ›å»ºä¸€ä¸ª Redis å®¢æˆ·ç«¯</span><span class="token comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®æºåç§°ï¼ˆDSNï¼‰æ¥åˆ›å»º</span><span class="token comment">// redis://&lt;user&gt;:&lt;pass&gt;@localhost:6379/&lt;db&gt;</span>opt<span class="token punctuation">,</span> err <span class="token operator">:=</span> redis<span class="token punctuation">.</span><span class="token function">ParseURL</span><span class="token punctuation">(</span><span class="token string">"redis://localhost:6379/0"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span>client <span class="token operator">:=</span> redis<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token comment">// é€šè¿‡ cient.Ping() æ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿æ¥åˆ°äº† redis æœåŠ¡å™¨</span><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> client<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»£ç ç¤ºä¾‹-1ï¼šä½¿ç”¨-SCAN-å‘½ä»¤çš„åŸºæœ¬è¿­ä»£æ–¹å¼"><a href="#ä»£ç ç¤ºä¾‹-1ï¼šä½¿ç”¨-SCAN-å‘½ä»¤çš„åŸºæœ¬è¿­ä»£æ–¹å¼" class="headerlink" title="ä»£ç ç¤ºä¾‹ 1ï¼šä½¿ç”¨ SCAN å‘½ä»¤çš„åŸºæœ¬è¿­ä»£æ–¹å¼"></a>ä»£ç ç¤ºä¾‹ 1ï¼šä½¿ç”¨ <code>SCAN</code> å‘½ä»¤çš„åŸºæœ¬è¿­ä»£æ–¹å¼</h2><p>é¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œè¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ <code>SCAN</code> å‘½ä»¤éå† Redis æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> redis_demo<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">scanKeysDemo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> cursor <span class="token builtin">uint64</span>rdb<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">RDBClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">{</span><span class="token keyword">var</span> keys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token keyword">var</span> err <span class="token builtin">error</span><span class="token comment">// Scan å‘½ä»¤ç”¨äºè¿­ä»£æ•°æ®åº“ä¸­çš„æ•°æ®åº“é”®ã€‚</span>keys<span class="token punctuation">,</span> cursor<span class="token punctuation">,</span> err <span class="token operator">=</span> rdb<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å¤„ç† keys</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> keys <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"key: %s\n"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å¦‚æœ cursor ä¸º 0ï¼Œè¯´æ˜å·²ç»éå†å®Œæˆï¼Œé€€å‡ºå¾ªç¯</span><span class="token keyword">if</span> cursor <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span><span class="token keyword">break</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»£ç è¯¦è§£ï¼š"><a href="#ä»£ç è¯¦è§£ï¼š" class="headerlink" title="ä»£ç è¯¦è§£ï¼š"></a>ä»£ç è¯¦è§£ï¼š</h3><ol><li><p><strong>RDBClient() å‡½æ•°</strong>: è¿™æ®µä»£ç å‡è®¾ <code>RDBClient()</code> æ˜¯ä¸€ä¸ªè¿”å› Redis å®¢æˆ·ç«¯å®ä¾‹çš„å‡½æ•°ï¼Œç”¨äºè¿æ¥ Redis æ•°æ®åº“ã€‚å¦‚æœè¿æ¥å¤±è´¥ï¼Œç¨‹åºä¼šç›´æ¥ panic ç»ˆæ­¢ã€‚</p></li><li><p><strong>Scan å‘½ä»¤</strong>: <code>rdb.Scan(cursor, "*", 0).Result()</code> æ˜¯ <code>SCAN</code> å‘½ä»¤çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚è¿™é‡Œçš„ <code>cursor</code> ç”¨äºè®°å½•å½“å‰æ‰«æçš„æ¸¸æ ‡ä½ç½®ï¼Œ<code>*</code> è¡¨ç¤ºåŒ¹é…æ‰€æœ‰é”®ï¼Œ<code>0</code> è¡¨ç¤ºæ¯æ¬¡æ‰«æè¿”å›æ‰€æœ‰åŒ¹é…é”®ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œ<code>cursor</code> å¿…é¡»ä¸º <code>0</code>ï¼Œä¹‹å Redis ä¼šè¿”å›æ–°çš„ <code>cursor</code>ï¼Œç›´åˆ° <code>cursor</code> å†æ¬¡ä¸º <code>0</code> è¡¨ç¤ºè¿­ä»£ç»“æŸã€‚</p></li><li><p><strong>å¾ªç¯æ‰«æ</strong>: ä½¿ç”¨ <code>for</code> å¾ªç¯ä¸æ–­è°ƒç”¨ <code>SCAN</code> å‘½ä»¤ï¼Œæ¯æ¬¡è¿”å›ä¸€æ‰¹é”®å¹¶æ›´æ–° <code>cursor</code>ã€‚å½“ <code>cursor</code> ä¸º <code>0</code> æ—¶ï¼Œé€€å‡ºå¾ªç¯ã€‚</p></li><li><p><strong>é”®å¤„ç†</strong>: <code>for _, key := range keys</code> ç”¨äºéå†å½“å‰æ‰¹æ¬¡çš„æ‰€æœ‰é”®ï¼Œå¹¶å¯¹æ¯ä¸ªé”®è¿›è¡Œå¤„ç†ï¼ˆå¦‚æ‰“å°å‡ºæ¥ï¼‰ã€‚</p></li></ol><p>è¿™ä¸ªæ–¹æ³•ç›¸å¯¹ç›´è§‚ï¼Œä½†å¦‚æœ Redis ä¸­çš„é”®æ•°é‡å·¨å¤§ï¼Œæ‰‹åŠ¨å¤„ç†æ¸¸æ ‡çš„æ–¹å¼å¯èƒ½æ˜¾å¾—ç¹çã€‚è¿™æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´ç®€ä¾¿çš„ <code>Iterator</code> æ–¹æ³•ã€‚</p><h2 id="ä»£ç ç¤ºä¾‹-2ï¼šä½¿ç”¨-Iterator-ç®€åŒ–è¿­ä»£è¿‡ç¨‹"><a href="#ä»£ç ç¤ºä¾‹-2ï¼šä½¿ç”¨-Iterator-ç®€åŒ–è¿­ä»£è¿‡ç¨‹" class="headerlink" title="ä»£ç ç¤ºä¾‹ 2ï¼šä½¿ç”¨ Iterator ç®€åŒ–è¿­ä»£è¿‡ç¨‹"></a>ä»£ç ç¤ºä¾‹ 2ï¼šä½¿ç”¨ <code>Iterator</code> ç®€åŒ–è¿­ä»£è¿‡ç¨‹</h2><p>æ¥ä¸‹æ¥æ˜¯ç¬¬äºŒä¸ªç¤ºä¾‹ä»£ç ï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>Iterator</code> æ–¹æ³•ç®€åŒ–é”®çš„éå†è¿‡ç¨‹ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> redis_demo<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">scanKeysDemo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>rdb<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">RDBClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// é’ˆå¯¹è¿™ç§éœ€è¦éå†å¤§é‡ key çš„åœºæ™¯ï¼Œgo-redis æä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³• Iterator</span>iter <span class="token operator">:=</span> rdb<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> iter<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"key: %s\n"</span><span class="token punctuation">,</span> iter<span class="token punctuation">.</span><span class="token function">Val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">:=</span> iter<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// æ­¤å¤–ï¼Œå¯¹äº redis ä¸­çš„ setã€hashã€zset ç­‰ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Iterator è¿›è¡Œéå†</span><span class="token comment">// ä¾‹å¦‚ï¼š</span><span class="token comment">// iter := rdb.SScan("set_key", 0, "*", 50).Iterator()</span><span class="token comment">// iter := rdb.HScan("hash_key", 0, "*", 50).Iterator()</span><span class="token comment">// iter := rdb.ZScan("zset_key", 0, "*", 50).Iterator()</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»£ç è¯¦è§£ï¼š-1"><a href="#ä»£ç è¯¦è§£ï¼š-1" class="headerlink" title="ä»£ç è¯¦è§£ï¼š"></a>ä»£ç è¯¦è§£ï¼š</h3><ol><li><p><strong>ä½¿ç”¨ Iterator</strong>: ä¸å‰ä¸€ä¸ªç¤ºä¾‹ä¸åŒï¼Œè¿™é‡Œä½¿ç”¨äº† <code>Iterator</code> è¿­ä»£å™¨ã€‚<code>rdb.Scan(0, "*", 50).Iterator()</code> åˆ›å»ºäº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ¯æ¬¡è¿”å› 50 ä¸ªåŒ¹é…çš„é”®ã€‚è¿™æ ·æ— éœ€æ‰‹åŠ¨å¤„ç† <code>cursor</code>ï¼Œç®€åŒ–äº†éå†è¿‡ç¨‹ã€‚</p></li><li><p><strong>è¿­ä»£ä¸å¤„ç†</strong>: <code>for iter.Next()</code> æ˜¯ä¸€ä¸ªç®€æ´çš„å¾ªç¯ï¼Œç”¨äºéå†æ‰€æœ‰åŒ¹é…çš„é”®ã€‚å½“ <code>iter.Next()</code> è¿”å› <code>false</code> æ—¶ï¼Œè¡¨ç¤ºéå†ç»“æŸã€‚<code>iter.Val()</code> è¿”å›å½“å‰é”®çš„å€¼ã€‚</p></li><li><p><strong>é”™è¯¯å¤„ç†</strong>: åœ¨å¾ªç¯ç»“æŸåï¼Œæ£€æŸ¥ <code>iter.Err()</code> æ˜¯å¦ä¸º <code>nil</code>ï¼Œä»¥ç¡®ä¿éå†è¿‡ç¨‹ä¸­æ²¡æœ‰å‡ºç°é”™è¯¯ã€‚</p></li><li><p><strong>æ‰©å±•åŠŸèƒ½</strong>: æ­¤å¤–ï¼Œ<code>Iterator</code> æ–¹æ³•ä¸ä»…é€‚ç”¨äºéå†é”®ï¼Œä¹Ÿå¯ç”¨äºéå† Redis ä¸­çš„é›†åˆï¼ˆ<code>Set</code>ï¼‰ã€å“ˆå¸Œï¼ˆ<code>Hash</code>ï¼‰ã€æœ‰åºé›†åˆï¼ˆ<code>ZSet</code>ï¼‰ç­‰æ•°æ®ç»“æ„ã€‚é€šè¿‡å°† <code>Scan</code> æ¢æˆ <code>SScan</code>ã€<code>HScan</code> æˆ– <code>ZScan</code>ï¼Œå°±èƒ½éå†å¯¹åº”çš„æ•°æ®ç»“æ„ã€‚</p></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨ Go è¯­è¨€ä¸­ä½¿ç”¨ <code>SCAN</code> å‘½ä»¤éå† Redis é”®ï¼Œå¹¶æ¯”è¾ƒäº†æ‰‹åŠ¨å¤„ç† <code>cursor</code> å’Œä½¿ç”¨ <code>Iterator</code> çš„ä¸¤ç§æ–¹å¼ã€‚å¯¹äº Redis æ–°æ‰‹æ¥è¯´ï¼Œäº†è§£ <code>SCAN</code> å‘½ä»¤çš„ç”¨æ³•éå¸¸é‡è¦ï¼Œå®ƒä¸ä»…å¸®åŠ©ä½ é¿å…äº†ä½¿ç”¨ <code>KEYS</code> å‘½ä»¤å¯èƒ½å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œè¿˜è®©ä½ èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°éå† Redis æ•°æ®ã€‚</p><p>å¦‚æœä½ è§‰å¾—æ–‡ç« æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€è½¬å‘ï¼Œè®©æ›´å¤šäººæŒæ¡ Redis çš„è¿™äº›å®ç”¨æŠ€å·§ï¼ğŸ˜Š</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­ä½¿ç”¨sqlxæ¥æ“ä½œäº‹åŠ¡</title>
      <link href="posts/1ffc0233.html"/>
      <url>posts/1ffc0233.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œæ•°æ®åº“äº‹åŠ¡çš„ä½¿ç”¨è‡³å…³é‡è¦ã€‚å®ƒå¯ä»¥ç¡®ä¿æ“ä½œçš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼ˆACIDï¼‰ã€‚<code>github.com/jmoiron/sqlx</code> åŒ…æä¾›äº†ä¸€ä¸ªä¾¿åˆ©çš„æ–¹æ³•æ¥ç®€åŒ–å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>sqlx</code> åŒ…æ¥ç®¡ç† MySQL æ•°æ®åº“äº‹åŠ¡ã€‚</p><h2 id="1-å®‰è£…-SQLX-åŒ…å’Œ-MySQL-é©±åŠ¨"><a href="#1-å®‰è£…-SQLX-åŒ…å’Œ-MySQL-é©±åŠ¨" class="headerlink" title="1. å®‰è£… SQLX åŒ…å’Œ MySQL é©±åŠ¨"></a>1. å®‰è£… SQLX åŒ…å’Œ MySQL é©±åŠ¨</h2><p>é¦–å…ˆï¼Œç¡®ä¿æˆ‘ä»¬å®‰è£…äº† <code>sqlx</code> å’Œ MySQL é©±åŠ¨ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get github.com/jmoiron/sqlxgo get github.com/go-sql-driver/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="2-å¯¼å…¥-SQLX-å’Œ-MySQL-é©±åŠ¨"><a href="#2-å¯¼å…¥-SQLX-å’Œ-MySQL-é©±åŠ¨" class="headerlink" title="2. å¯¼å…¥ SQLX å’Œ MySQL é©±åŠ¨"></a>2. å¯¼å…¥ SQLX å’Œ MySQL é©±åŠ¨</h2><p>åœ¨ä½ çš„ Go æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥ <code>sqlx</code> å’Œ MySQL é©±åŠ¨ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"github.com/jmoiron/sqlx"</span>    <span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span> <span class="token comment">// MySQL é©±åŠ¨</span>    <span class="token string">"log"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-åˆ›å»ºæ•°æ®åº“è¿æ¥"><a href="#3-åˆ›å»ºæ•°æ®åº“è¿æ¥" class="headerlink" title="3. åˆ›å»ºæ•°æ®åº“è¿æ¥"></a>3. åˆ›å»ºæ•°æ®åº“è¿æ¥</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæ•°æ®åº“çš„è¿æ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">createDBConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    dsn <span class="token operator">:=</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/mydb?parseTime=true"</span>    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sqlx<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err    <span class="token punctuation">}</span>    <span class="token keyword">return</span> db<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ ¹æ®ä½ çš„æ•°æ®åº“é…ç½®è°ƒæ•´ DSNï¼ˆæ•°æ®æºåç§°ï¼‰ã€‚</p><h2 id="4-ä½¿ç”¨äº‹åŠ¡"><a href="#4-ä½¿ç”¨äº‹åŠ¡" class="headerlink" title="4. ä½¿ç”¨äº‹åŠ¡"></a>4. ä½¿ç”¨äº‹åŠ¡</h2><p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>sqlx</code> è¿›è¡Œ MySQL çš„äº‹åŠ¡å¤„ç†ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"github.com/jmoiron/sqlx"</span>    <span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span> <span class="token comment">// MySQL driver</span>    <span class="token string">"log"</span><span class="token punctuation">)</span><span class="token comment">// createDBConnection åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ•°æ®åº“è¿æ¥</span><span class="token keyword">func</span> <span class="token function">createDBConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²</span>    dsn <span class="token operator">:=</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/mydb?parseTime=true"</span>    <span class="token keyword">return</span> sqlx<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨ sqlx è¿æ¥åˆ° MySQL æ•°æ®åº“</span><span class="token punctuation">}</span><span class="token comment">// performTransaction æ‰§è¡Œä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡</span><span class="token keyword">func</span> <span class="token function">performTransaction</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>    <span class="token comment">// å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡</span>    tx<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Beginx</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err <span class="token comment">// å¦‚æœå¼€å§‹äº‹åŠ¡å¤±è´¥ï¼Œè¿”å›é”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token comment">// ä½¿ç”¨ defer ç¡®ä¿åœ¨ç»“æŸæ—¶æ­£ç¡®å¤„ç†äº‹åŠ¡</span>    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> p <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            <span class="token comment">// å¦‚æœå‘ç”Ÿ panicï¼Œåˆ™å›æ»šäº‹åŠ¡</span>            tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token function">panic</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment">// é‡æ–°æŠ›å‡º panicï¼Œä»¥ä¾¿ä¸Šå±‚è°ƒç”¨å¤„ç†</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            <span class="token comment">// å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå›æ»šäº‹åŠ¡</span>            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Rollback due to error:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>            tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment">// å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæäº¤äº‹åŠ¡</span>            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Committing transaction"</span><span class="token punctuation">)</span>            err <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ç¤ºä¾‹ï¼šæ’å…¥ç”¨æˆ·</span>    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users(name) VALUES(?)"</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err <span class="token comment">// è®°å½•æ’å…¥å¤±è´¥ï¼Œè¿”å›é”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token comment">// ç¤ºä¾‹ï¼šæ’å…¥è®¢å•</span>    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO orders(user_id, amount) VALUES(?, ?)"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err <span class="token comment">// è®°å½•æ’å…¥å¤±è´¥ï¼Œè¿”å›é”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">nil</span> <span class="token comment">// å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¿”å› nil</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ›å»ºæ•°æ®åº“è¿æ¥</span>    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">createDBConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Failed to connect to database: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token comment">// è¿æ¥å¤±è´¥ï¼Œæ—¥å¿—è®°å½•å¹¶é€€å‡º</span>    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿åœ¨ä¸»å‡½æ•°ç»“æŸæ—¶å…³é—­æ•°æ®åº“è¿æ¥</span>    <span class="token comment">// æ‰§è¡Œäº‹åŠ¡å¹¶å¤„ç†ç»“æœ</span>    <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">performTransaction</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Transaction failed: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token comment">// äº‹åŠ¡å¤±è´¥ï¼Œè®°å½•é”™è¯¯</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Transaction succeeded!"</span><span class="token punctuation">)</span> <span class="token comment">// äº‹åŠ¡æˆåŠŸï¼Œæ—¥å¿—è®°å½•</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä½¿ç”¨ <code>github.com/jmoiron/sqlx</code>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ Go åº”ç”¨ç¨‹åºä¸­ç®¡ç† MySQL æ•°æ®åº“çš„äº‹åŠ¡ã€‚è‰¯å¥½çš„äº‹åŠ¡æ§åˆ¶å¯ä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> MySQL </tag>
            
            <tag> sqlx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­ä½¿ç”¨ sqlx æ¥æ“ä½œ MySQL</title>
      <link href="posts/4390abbe.html"/>
      <url>posts/4390abbe.html</url>
      
        <content type="html"><![CDATA[<p>Go è¯­è¨€ä»¥å…¶é«˜æ•ˆå’Œç®€æ´çš„è¯­æ³•é€æ¸å—åˆ°å¼€å‘è€…çš„é’çã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ•°æ®åº“æ“ä½œæ˜¯ä¸å¯é¿å…çš„ä»»åŠ¡ä¹‹ä¸€ã€‚è™½ç„¶æ ‡å‡†åº“æä¾›äº† <code>database/sql</code> åŒ…æ¥æ”¯æŒæ•°æ®åº“æ“ä½œï¼Œä½†ä½¿ç”¨èµ·æ¥ç•¥æ˜¾ç¹çã€‚</p><p><code>sqlx</code> åŒ…ä½œä¸ºä¸€ä¸ªæ‰©å±•åº“ï¼Œå®ƒåœ¨ <code>database/sql</code> çš„åŸºç¡€ä¸Šï¼Œæä¾›äº†æ›´é«˜çº§åˆ«çš„ä¾¿åˆ©ï¼Œæå¤§åœ°ç®€åŒ–äº†æ•°æ®åº“æ“ä½œã€‚æœ¬æ–‡ç« å°†ä»‹ç»å¦‚ä½•é€šè¿‡ <code>github.com/jmoiron/sqlx</code> åŒ…æ¥æ“ä½œ MySQL æ•°æ®åº“ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ Go ç¯å¢ƒå·²ç»æ­å»ºå®Œæ¯•ï¼Œå¹¶ä¸” MySQL æ•°æ®åº“å·²å®‰è£…å¹¶æ­£åœ¨è¿è¡Œã€‚æ¥ä¸‹æ¥ï¼Œå®‰è£… <code>sqlx</code> åŒ…åŠ MySQL é©±åŠ¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get github.com/jmoiron/sqlxgo get github.com/go-sql-driver/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="è¿æ¥-MySQL-æ•°æ®åº“"><a href="#è¿æ¥-MySQL-æ•°æ®åº“" class="headerlink" title="è¿æ¥ MySQL æ•°æ®åº“"></a>è¿æ¥ MySQL æ•°æ®åº“</h2><p>åœ¨ä½¿ç”¨æ•°æ®åº“ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸ MySQL çš„è¿æ¥ã€‚åœ¨ Go è¯­è¨€ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ä¸€ä¸ªè¿æ¥å­—ç¬¦ä¸²æ¥æŒ‡å®šæ•°æ®åº“çš„ä¸€äº›ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•è¿æ¥ MySQL æ•°æ®åº“ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span> <span class="token comment">// ä¸€å®šä¸èƒ½å¿˜è®°å¯¼å…¥æ•°æ®åº“é©±åŠ¨</span><span class="token string">"github.com/jmoiron/sqlx"</span><span class="token punctuation">)</span><span class="token keyword">var</span> db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>ID   <span class="token builtin">int64</span>  <span class="token string">`db:"id"`</span>Name <span class="token builtin">string</span> <span class="token string">`db:"name"`</span>Age  <span class="token builtin">int</span>    <span class="token string">`db:"age"`</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">initDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>dsn <span class="token operator">:=</span> <span class="token string">"root:123456@tcp(127.0.0.1:3306)/sql_test?charset=utf8mb4&amp;parseTime=True"</span><span class="token comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨ MustConnect è¿æ¥ä¸æˆåŠŸå°±ç›´æ¥ panic</span><span class="token comment">// db = sqlx.MustConnect("mysql", dsn)</span>db<span class="token punctuation">,</span> err <span class="token operator">=</span> sqlx<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"connect DB failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>db<span class="token punctuation">.</span><span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®æ•°æ®åº“è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°</span>db<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®æ•°æ®åº“è¿æ¥æ± çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°</span><span class="token keyword">return</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„MySQL é…ç½®ã€‚</p><h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><h3 id="1-åˆ›å»ºè¡¨"><a href="#1-åˆ›å»ºè¡¨" class="headerlink" title="1. åˆ›å»ºè¡¨"></a>1. åˆ›å»ºè¡¨</h3><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¤ºä¾‹è¡¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Exec</code> æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥æ¥åˆ›å»ºè¡¨ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">CreateTable</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å†™SQLè¯­å¥</span>sqlStr <span class="token operator">:=</span> <span class="token string">`create table if not exists users (id bigint primary key auto_increment,name varchar(20),age int default 1);`</span><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>sqlStr<span class="token punctuation">)</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ <code>main</code> å‡½æ•°ä¸­è°ƒç”¨ <code>CreateTable(db)</code>ï¼Œä»¥ç¡®ä¿åœ¨è¿æ¥ååˆ›å»ºè¡¨ã€‚</p><h3 id="2-æ’å…¥æ•°æ®"><a href="#2-æ’å…¥æ•°æ®" class="headerlink" title="2. æ’å…¥æ•°æ®"></a>2. æ’å…¥æ•°æ®</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æ’å…¥ç”¨æˆ·å¹¶è·å– ID</span><span class="token keyword">func</span> <span class="token function">insertUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users(name, age) VALUES(?, ?)"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span>id<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">LastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> id<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-æŸ¥è¯¢æ•°æ®"><a href="#3-æŸ¥è¯¢æ•°æ®" class="headerlink" title="3. æŸ¥è¯¢æ•°æ®"></a>3. æŸ¥è¯¢æ•°æ®</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æŸ¥è¯¢å•æ¡ç”¨æˆ·è®°å½•</span><span class="token keyword">func</span> <span class="token function">getUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> user Usererr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM users WHERE id=?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token comment">// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·è®°å½•</span><span class="token keyword">func</span> <span class="token function">getAllUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>Usererr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM users where id &gt; ?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> users<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-æ›´æ–°æ•°æ®"><a href="#4-æ›´æ–°æ•°æ®" class="headerlink" title="4. æ›´æ–°æ•°æ®"></a>4. æ›´æ–°æ•°æ®</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æ›´æ–°ç”¨æˆ·ä¿¡æ¯</span><span class="token keyword">func</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int64</span><span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"UPDATE users SET name=?, age=? WHERE id=?"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span>rowsAffected<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">RowsAffected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> rowsAffected<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-åˆ é™¤æ•°æ®"><a href="#5-åˆ é™¤æ•°æ®" class="headerlink" title="5. åˆ é™¤æ•°æ®"></a>5. åˆ é™¤æ•°æ®</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// åˆ é™¤ç”¨æˆ·è®°å½•</span><span class="token keyword">func</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"DELETE FROM users WHERE id=?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span>rowsAffected<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">RowsAffected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> rowsAffected<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-ä½¿ç”¨å‘½åå‚æ•°æ¥æ“ä½œ"><a href="#6-ä½¿ç”¨å‘½åå‚æ•°æ¥æ“ä½œ" class="headerlink" title="6. ä½¿ç”¨å‘½åå‚æ•°æ¥æ“ä½œ"></a>6. ä½¿ç”¨å‘½åå‚æ•°æ¥æ“ä½œ</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ä½¿ç”¨å‘½åå‚æ•°æ’å…¥ç”¨æˆ·</span><span class="token keyword">func</span> <span class="token function">insertUserNamed</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>query <span class="token operator">:=</span> <span class="token string">`INSERT INTO users(name, age) VALUES(:name, :age)`</span>result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">NamedExec</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span>  age<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span>id<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">LastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> id<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨å‘½åå‚æ•°æŸ¥è¯¢ç”¨æˆ·</span><span class="token keyword">func</span> <span class="token function">getUsersNamed</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sqlx<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>query <span class="token operator">:=</span> <span class="token string">`SELECT * FROM users WHERE name = :name`</span><span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>Userrows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">NamedQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> user Usererr <span class="token operator">:=</span> rows<span class="token punctuation">.</span><span class="token function">StructScan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"scan failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">continue</span><span class="token punctuation">}</span>users <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> users<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-æµ‹è¯•ä¸€ä¸‹ä»£ç "><a href="#7-æµ‹è¯•ä¸€ä¸‹ä»£ç " class="headerlink" title="7. æµ‹è¯•ä¸€ä¸‹ä»£ç "></a>7. æµ‹è¯•ä¸€ä¸‹ä»£ç </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åˆå§‹åŒ–æ•°æ®åº“</span>err <span class="token operator">:=</span> <span class="token function">initDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"init DB failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ³¨æ„è¿™è¡Œä»£ç è¦å†™åœ¨ä¸Šé¢erråˆ¤æ–­çš„ä¸‹é¢</span><span class="token comment">// åˆ›å»ºè¡¨</span>err <span class="token operator">=</span> <span class="token function">CreateTable</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"create table failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token comment">// æ’å…¥æ•°æ®</span>id<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">insertUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"insert user failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"insert success, the id is:"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token comment">// æŸ¥è¯¢å•æ¡æ•°æ®</span>user<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"get user failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"user:%#v\n"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token comment">// æŸ¥è¯¢å¤šæ¡æ•°æ®</span>users<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getAllUsers</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"get all users failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"users:%#v\n"</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span><span class="token comment">// æ›´æ–°æ•°æ®</span>rowsAffected<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"update user failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"update success, affected rows:"</span><span class="token punctuation">,</span> rowsAffected<span class="token punctuation">)</span><span class="token comment">// åˆ é™¤æ•°æ®</span>rowsAffected<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"delete user failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"delete success, affected rows:"</span><span class="token punctuation">,</span> rowsAffected<span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨å‘½åå‚æ•°æ’å…¥æ•°æ®</span>id<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">insertUserNamed</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"insert user named failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"insert named success, the id is:"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨å‘½åå‚æ•°æŸ¥è¯¢æ•°æ®</span>users<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">getUsersNamed</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"Alex"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"get users named failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"users named:%#v\n"</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"exec SQL success"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ <code>sqlx</code> è¿˜æ˜¯è¦æ¯” <code>database/sql</code> è¦ç®€æ´è®¸å¤šã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ <code>sqlx</code> åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æ›´ç®€å•åœ°åœ¨ Go ä¸­ä¸ MySQL æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œå‡å°‘äº†æ ·æ¿ä»£ç å¹¶æé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨ Go ä¸­ä½¿ç”¨ <code>sqlx</code> æ“ä½œ MySQL æ•°æ®åº“ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> MySQL </tag>
            
            <tag> sqlx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go è¯­è¨€ä¸­çš„ MySQL äº‹åŠ¡æ“ä½œ</title>
      <link href="posts/50c9af33.html"/>
      <url>posts/50c9af33.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£åº”ç”¨ç¨‹åºä¸­ï¼Œæ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§è‡³å…³é‡è¦ã€‚MySQL çš„äº‹åŠ¡åŠŸèƒ½æä¾›äº†ä¸€ç§ç¡®ä¿æ“ä½œå®‰å…¨ä¸”å¯é çš„æœºåˆ¶ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Œå¦‚ä½•åœ¨ Go è¯­è¨€ä¸­è¿›è¡Œ MySQL äº‹åŠ¡æ“ä½œã€‚</p><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h2><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª SQL æ“ä½œçš„é€»è¾‘å•å…ƒã€‚åœ¨ MySQL ä¸­ï¼Œäº‹åŠ¡ç¡®ä¿äº†è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆåœ¨å‘ç”Ÿé”™è¯¯æ—¶å…¨éƒ¨å›æ»šï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚äº‹åŠ¡çš„ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ï¼šäº‹åŠ¡ä¸­æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®çš„å®Œæ•´æ€§å¿…é¡»ä¿æŒä¸€è‡´ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼šå¤šä¸ªäº‹åŠ¡çš„æ‰§è¡Œäº’ä¸å½±å“ï¼Œå„è‡ªç‹¬ç«‹ã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶ç»“æœæ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul><h2 id="äºŒã€MySQL-äº‹åŠ¡æ“ä½œ"><a href="#äºŒã€MySQL-äº‹åŠ¡æ“ä½œ" class="headerlink" title="äºŒã€MySQL äº‹åŠ¡æ“ä½œ"></a>äºŒã€MySQL äº‹åŠ¡æ“ä½œ</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>database/sql</code> åŒ…æ¥å¤„ç† MySQL çš„äº‹åŠ¡æ“ä½œã€‚é¦–å…ˆï¼Œè¯·ç¡®ä¿é€šè¿‡ <code>go get</code> å®‰è£…äº† <code>github.com/go-sql-driver/mysql</code> é©±åŠ¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/go-sql-driver/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-å¼€å§‹ä¸€ä¸ªäº‹åŠ¡"><a href="#1-å¼€å§‹ä¸€ä¸ªäº‹åŠ¡" class="headerlink" title="1. å¼€å§‹ä¸€ä¸ªäº‹åŠ¡"></a>1. å¼€å§‹ä¸€ä¸ªäº‹åŠ¡</h3><p>ä½¿ç”¨ <code>db.Begin()</code> æ–¹æ³•å¯ä»¥å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªé“¶è¡Œè½¬è´¦çš„ç¤ºä¾‹æ¥æ¼”ç¤ºäº‹åŠ¡å¦‚ä½•ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h3 id="2-é“¶è¡Œè½¬è´¦ç¤ºä¾‹"><a href="#2-é“¶è¡Œè½¬è´¦ç¤ºä¾‹" class="headerlink" title="2. é“¶è¡Œè½¬è´¦ç¤ºä¾‹"></a>2. é“¶è¡Œè½¬è´¦ç¤ºä¾‹</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨æˆ· A å’Œ Bï¼ŒA æƒ³æŠŠ 100 å…ƒè½¬è´¦ç»™ Bã€‚è¿™ä¸ªæ“ä½œéœ€è¦ä¿è¯ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>ä»ç”¨æˆ· A çš„è´¦æˆ·ä¸­æ‰£é™¤ 100 å…ƒã€‚</li><li>å‘ç”¨æˆ· B çš„è´¦æˆ·ä¸­å¢åŠ  100 å…ƒã€‚</li></ol><p>è¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼Œä»¥ç¡®ä¿å¦‚æœå…¶ä¸­ä¸€æ­¥å¤±è´¥ï¼Œåˆ™ä¸ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„æ•°æ®ã€‚ä»¥ä¸‹æ˜¯å®ç°çš„ä»£ç ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"database/sql"</span>    <span class="token string">"fmt"</span>    <span class="token string">"log"</span>    <span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">transfer</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> fromUserID <span class="token builtin">int</span><span class="token punctuation">,</span> toUserID <span class="token builtin">int</span><span class="token punctuation">,</span> amount <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>    <span class="token comment">// å¼€å§‹ä¸€ä¸ªäº‹åŠ¡</span>    tx<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err    <span class="token punctuation">}</span>    <span class="token comment">// æ­¥éª¤ 1: æ£€æŸ¥ç”¨æˆ· A çš„ä½™é¢</span>    <span class="token keyword">var</span> balance <span class="token builtin">float64</span>    err <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span><span class="token string">"SELECT balance FROM accounts WHERE user_id = ?"</span><span class="token punctuation">,</span> fromUserID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>balance<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæŸ¥è¯¢ç”¨æˆ·ä½™é¢å‡ºé”™ï¼Œå›æ»šäº‹åŠ¡</span>        <span class="token keyword">return</span> err    <span class="token punctuation">}</span>    <span class="token keyword">if</span> balance <span class="token operator">&lt;</span> amount <span class="token punctuation">{</span>        tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœä½™é¢ä¸è¶³ï¼Œå›æ»šäº‹åŠ¡</span>        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ· %d ä½™é¢ä¸è¶³ï¼Œæ— æ³•è¿›è¡Œè½¬è´¦"</span><span class="token punctuation">,</span> fromUserID<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// æ­¥éª¤ 2: ä»ç”¨æˆ· A æ‰£æ¬¾</span>    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance - ? WHERE user_id = ?"</span><span class="token punctuation">,</span> amount<span class="token punctuation">,</span> fromUserID<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœå‡ºé”™ï¼Œå›æ»šäº‹åŠ¡</span>        <span class="token keyword">return</span> err    <span class="token punctuation">}</span>    <span class="token comment">// æ­¥éª¤ 3: å‘ç”¨æˆ· B å……å€¼</span>    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance + ? WHERE user_id = ?"</span><span class="token punctuation">,</span> amount<span class="token punctuation">,</span> toUserID<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœå‡ºé”™ï¼Œå›æ»šäº‹åŠ¡</span>        <span class="token keyword">return</span> err    <span class="token punctuation">}</span>    <span class="token comment">// æäº¤äº‹åŠ¡</span>    <span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    dsn <span class="token operator">:=</span> <span class="token string">"user:password@tcp(127.0.0.1:3306)/dbname"</span>    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// æ‰§è¡Œè½¬è´¦æ“ä½œ</span>    <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">transfer</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"Transaction failed:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Transfer completed successfully!"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>transfer</code> å‡½æ•°ï¼Œä½¿ç”¨äº‹åŠ¡ç¡®ä¿ä»ç”¨æˆ· A çš„è´¦æˆ·æ‰£æ¬¾å’Œå‘ç”¨æˆ· B çš„è´¦æˆ·å……å€¼è¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚å¦‚æœåœ¨ä»»æ„æ­¥éª¤å‡ºé”™ï¼Œäº‹åŠ¡å°†å›æ»šï¼Œç¡®ä¿è´¦æˆ·ä½™é¢çš„ä¸€è‡´æ€§ã€‚</p><h2 id="ä¸‰ã€äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#ä¸‰ã€äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="ä¸‰ã€äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>ä¸‰ã€äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h2><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®šä¹‰äº†å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶çš„ç›¸äº’å½±å“ç¨‹åº¦ã€‚MySQL æ”¯æŒä»¥ä¸‹å››ç§éš”ç¦»çº§åˆ«ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>å«ä¹‰</th><th>è¯´æ˜</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>Read Uncommitted</td><td>è¯»æœªæäº¤</td><td>å…è®¸ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚è¿™ä¼šå¯¼è‡´â€œè„è¯»â€ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å¯èƒ½è¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡å°šæœªæäº¤çš„æ›´æ”¹ã€‚</td><td>æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œæ€§èƒ½æœ€é«˜ï¼Œä½†æ•°æ®ä¸€è‡´æ€§æœ€å·®ã€‚</td></tr><tr><td>Read Committed</td><td>è¯»å·²æäº¤</td><td>ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²æäº¤çš„æ›´æ”¹ã€‚è¿™é¿å…äº†è„è¯»ï¼Œä½†ä»ç„¶ä¸èƒ½é˜²æ­¢â€œä¸å¯é‡å¤è¯»â€ï¼Œå³åœ¨åŒä¸€äº‹åŠ¡ä¸­ä¸¤æ¬¡è¯»å–ç›¸åŒçš„æ•°æ®å¯èƒ½å¾—åˆ°ä¸åŒçš„ç»“æœã€‚</td><td>é¿å…è„è¯»ï¼Œä½†åŒä¸€äº‹åŠ¡ä¸­è¯»å–ç›¸åŒæ•°æ®å¯èƒ½ç»“æœä¸åŒã€‚</td></tr><tr><td>Repeatable Read</td><td>å¯é‡å¤è¯»</td><td>åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»å–ç›¸åŒçš„æ•°æ®å°†å¾—åˆ°ä¸€è‡´çš„ç»“æœã€‚è¿™é¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»ç„¶å¯èƒ½å¯¼è‡´â€œå¹»è¯»â€ï¼Œå³åœ¨åŒä¸€äº‹åŠ¡ä¸­æ’å…¥æ–°è¡Œçš„æ“ä½œå¯èƒ½ä½¿è¯»å–ç»“æœå‘ç”Ÿå˜åŒ–ã€‚</td><td>è¯»å–ä¸€è‡´æ€§è¾ƒå¥½ï¼Œä½†å¯èƒ½å¯¼è‡´å¹»è¯»ã€‚</td></tr><tr><td>Serializable</td><td>åºåˆ—åŒ–</td><td>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡å®Œå…¨åºåˆ—åŒ–æ‰§è¡Œï¼Œç°åœ¨çš„äº‹åŠ¡åœ¨æ‰§è¡Œæ—¶ä¸ä¼šå—åˆ°å…¶ä»–äº‹åŠ¡çš„å½±å“ã€‚è¿™é¿å…äº†è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ï¼Œä½†æ€§èƒ½è¾ƒä½ï¼Œå› ä¸ºåœ¨è¿™ç§çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡çš„å¹¶å‘æ€§å¤§å¤§é™ä½ã€‚</td><td>æœ€å¼ºçš„éš”ç¦»çº§åˆ«ï¼Œæ•°æ®ä¸€è‡´æ€§å’Œå®‰å…¨æ€§æœ€ä½³ï¼Œä½†æ€§èƒ½æœ€ä½ã€‚</td></tr></tbody></table><h3 id="è¯´æ˜ï¼š"><a href="#è¯´æ˜ï¼š" class="headerlink" title="è¯´æ˜ï¼š"></a>è¯´æ˜ï¼š</h3><ul><li><strong>è„è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šåŒä¸€ä¸ªäº‹åŠ¡åœ¨å¤šæ¬¡è¯»å–ä¸­ï¼Œå¾—åˆ°ä¸åŒçš„ç»“æœã€‚</li><li><strong>å¹»è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€äº‹åŠ¡æ’å…¥äº†æ–°çš„æ•°æ®ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è¯»å–ç»“æœä¸åŒã€‚</li></ul><h2 id="å››ã€è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#å››ã€è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="å››ã€è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>å››ã€è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œå¯ä»¥é€šè¿‡ SQL è¯­å¥è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"SET TRANSACTION ISOLATION LEVEL REPEATABLE READ"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å¼€å¯äº‹åŠ¡ä¹‹å‰è®¾ç½®éš”ç¦»çº§åˆ«ï¼Œä»è€Œå†³å®šäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ã€‚</p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>åœ¨ Go è¯­è¨€ä¸­é€šè¿‡ <code>github.com/go-sql-driver/mysql</code> é©±åŠ¨è¿›è¡Œ MySQL äº‹åŠ¡æ“ä½œéå¸¸ç®€å•ã€‚é€šè¿‡æ˜ç¡®çš„äº‹åŠ¡æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚é“¶è¡Œè½¬è´¦çš„ç¤ºä¾‹æ¸…æ¥šåœ°å±•ç¤ºäº†äº‹åŠ¡åœ¨é˜²æ­¢æ•°æ®ä¸ä¸€è‡´æ–¹é¢çš„é‡è¦æ€§ã€‚äº†è§£å¹¶åˆç†è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯æå‡åº”ç”¨ç¨‹åºæ•°æ®å®‰å…¨æ€§çš„é‡è¦ç¯èŠ‚ã€‚</p><p>å¸Œæœ›æœ¬ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ MySQL çš„äº‹åŠ¡æœºåˆ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­è¿›è¡ŒMySQLé¢„å¤„ç†å’ŒSQLæ³¨å…¥é˜²æŠ¤</title>
      <link href="posts/cd962b5b.html"/>
      <url>posts/cd962b5b.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£ web åº”ç”¨å¼€å‘ä¸­ï¼Œå®‰å…¨æ€§æ˜¯æˆ‘ä»¬å¿…é¡»é‡è§†çš„ä¸€ä¸ªæ–¹é¢ã€‚SQL æ³¨å…¥æ˜¯å¸¸è§çš„æ”»å‡»æ‰‹æ³•ä¹‹ä¸€ï¼Œå®ƒå…è®¸æ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹æ®Šçš„ SQL æŸ¥è¯¢æ¥è®¿é—®ã€ä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åœ¨ Go è¯­è¨€ä¸­è¿›è¡Œ MySQL æ•°æ®åº“çš„é¢„å¤„ç†æ“ä½œï¼Œä»¥æœ‰æ•ˆé˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ã€‚</p><h2 id="ä¸€ã€SQL-æ³¨å…¥æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€SQL-æ³¨å…¥æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€SQL æ³¨å…¥æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€SQL æ³¨å…¥æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>SQL æ³¨å…¥æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡è¾“å…¥æ¶æ„ SQL ä»£ç ï¼Œä½¿å¾—åº”ç”¨æ‰§è¡Œéé¢„æœŸçš„æ•°æ®åº“æ“ä½œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœç”¨æˆ·è¾“å…¥ <code>admin' OR 1=1 --</code>ï¼Œåˆ™æŸ¥è¯¢å°†å˜ä¸ºï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'admin'</span> <span class="token operator">OR</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token comment">--';</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™å°†å¯¼è‡´æ•°æ®åº“è¿”å›æ‰€æœ‰ç”¨æˆ·çš„è®°å½•ï¼Œä»è€Œè®©æ”»å‡»è€…è®¿é—®æ•æ„Ÿæ•°æ®ã€‚</p><h2 id="äºŒã€é¢„å¤„ç†-SQL-è¯­å¥"><a href="#äºŒã€é¢„å¤„ç†-SQL-è¯­å¥" class="headerlink" title="äºŒã€é¢„å¤„ç† SQL è¯­å¥"></a>äºŒã€é¢„å¤„ç† SQL è¯­å¥</h2><h3 id="1-ä»€ä¹ˆæ˜¯é¢„å¤„ç†-SQL-è¯­å¥ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯é¢„å¤„ç†-SQL-è¯­å¥ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯é¢„å¤„ç† SQL è¯­å¥ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯é¢„å¤„ç† SQL è¯­å¥ï¼Ÿ</h3><p>é¢„å¤„ç† SQL è¯­å¥æ˜¯ä¸€ç§æå‰ç¼–è¯‘çš„ SQL è¯­å¥ï¼Œä½¿ç”¨å ä½ç¬¦ï¼ˆå¦‚ <code>?</code>ï¼‰æ¥ä»£æ›¿å®é™…å€¼ã€‚é¢„å¤„ç†å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥è¯­æ³•é”™è¯¯ï¼Œæ‰§è¡Œæ—¶å°†è¾“å…¥å€¼ä¼ å…¥ã€‚è¿™ç§æœºåˆ¶ä¸ä»…æé«˜äº†æ€§èƒ½ï¼Œè¿˜æœ‰åŠ©äºé˜²æ­¢ SQL æ³¨å…¥ã€‚</p><h3 id="2-é¢„å¤„ç†-SQL-è¯­å¥çš„ä¼˜ç¼ºç‚¹"><a href="#2-é¢„å¤„ç†-SQL-è¯­å¥çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="2. é¢„å¤„ç† SQL è¯­å¥çš„ä¼˜ç¼ºç‚¹"></a>2. é¢„å¤„ç† SQL è¯­å¥çš„ä¼˜ç¼ºç‚¹</h3><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ul><li><strong>å®‰å…¨æ€§</strong>ï¼šé€šè¿‡ä½¿ç”¨å ä½ç¬¦ï¼Œç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šç›´æ¥åµŒå…¥ SQL æŸ¥è¯¢ä¸­ï¼Œä»è€Œé¿å… SQL æ³¨å…¥æ”»å‡»ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šå¯¹äºç»å¸¸æ‰§è¡Œç›¸åŒæŸ¥è¯¢çš„æƒ…å†µï¼Œæ•°æ®åº“å¯ä»¥é‡ç”¨å·²ç¼–è¯‘çš„æŸ¥è¯¢è®¡åˆ’ï¼Œå‡å°‘äº†ç¼–è¯‘å¼€é”€ã€‚</li><li><strong>ç®€æ´æ€§</strong>ï¼šä»£ç æ›´æ˜“è¯»ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé¿å…äº†å­—ç¬¦ä¸²æ‹¼æ¥å¯¼è‡´çš„å¤æ‚æ€§ã€‚</li></ul><h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><ul><li><strong>å¤æ‚çš„æŸ¥è¯¢</strong>ï¼šåœ¨å¤„ç†åŠ¨æ€çš„å¤æ‚æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨é¢„å¤„ç†è¯­å¥ä¼šå¢åŠ ä»£ç å¤æ‚åº¦ã€‚</li><li><strong>å ä½ç¬¦é™åˆ¶</strong>ï¼šæŸäº›æ•°æ®åº“ç³»ç»Ÿå¯¹å ä½ç¬¦çš„ä½¿ç”¨æœ‰ç‰¹å®šé™åˆ¶ï¼Œæ¯”å¦‚ä¸èƒ½ç”¨äºè¡¨åã€åˆ—åç­‰ã€‚</li></ul><h2 id="ä¸‰ã€ä½¿ç”¨-Go-è¿æ¥-MySQL-æ•°æ®åº“"><a href="#ä¸‰ã€ä½¿ç”¨-Go-è¿æ¥-MySQL-æ•°æ®åº“" class="headerlink" title="ä¸‰ã€ä½¿ç”¨ Go è¿æ¥ MySQL æ•°æ®åº“"></a>ä¸‰ã€ä½¿ç”¨ Go è¿æ¥ MySQL æ•°æ®åº“</h2><p>åœ¨ Go ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>github.com/go-sql-driver/mysql</code> é©±åŠ¨è¿æ¥åˆ° MySQL æ•°æ®åº“ã€‚é¦–å…ˆï¼Œå®‰è£…è¿™ä¸ªé©±åŠ¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/go-sql-driver/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-åŸºæœ¬è¿æ¥"><a href="#1-åŸºæœ¬è¿æ¥" class="headerlink" title="1. åŸºæœ¬è¿æ¥"></a>1. åŸºæœ¬è¿æ¥</h3><p>ä»¥ä¸‹æ˜¯è¿æ¥åˆ° MySQL æ•°æ®åº“çš„åŸºæœ¬ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"database/sql"</span>    <span class="token string">"fmt"</span>    <span class="token string">"log"</span>    <span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    dsn <span class="token operator">:=</span> <span class="token string">"user:password@tcp(127.0.0.1:3306)/dbname"</span>    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// å¤„ç†è¿æ¥é”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿åœ¨æœ€åå…³é—­æ•°æ®åº“è¿æ¥</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Successfully connected to the database!"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·å°† <code>user</code>, <code>password</code>, <code>localhost</code>, å’Œ <code>dbname</code> æ›¿æ¢ä¸ºä½ çš„æ•°æ®åº“ä¿¡æ¯ã€‚</p><h2 id="å››ã€é¢„å¤„ç†-SQL-è¯­å¥çš„ä½¿ç”¨"><a href="#å››ã€é¢„å¤„ç†-SQL-è¯­å¥çš„ä½¿ç”¨" class="headerlink" title="å››ã€é¢„å¤„ç† SQL è¯­å¥çš„ä½¿ç”¨"></a>å››ã€é¢„å¤„ç† SQL è¯­å¥çš„ä½¿ç”¨</h2><h3 id="1-åˆ›å»ºé¢„å¤„ç†è¯­å¥"><a href="#1-åˆ›å»ºé¢„å¤„ç†è¯­å¥" class="headerlink" title="1. åˆ›å»ºé¢„å¤„ç†è¯­å¥"></a>1. åˆ›å»ºé¢„å¤„ç†è¯­å¥</h3><p>ä»¥ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºå¹¶æ‰§è¡Œé¢„å¤„ç†è¯­å¥çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">getUserByUsername</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ›å»ºé¢„å¤„ç†è¯­å¥</span>    stmt<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"SELECT id, username, email FROM users WHERE username = ?"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err <span class="token comment">// å¤„ç†åˆ›å»ºé”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> stmt<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿åœ¨æœ€åå…³é—­é¢„å¤„ç†è¯­å¥</span>    <span class="token keyword">var</span> user User    <span class="token comment">// æ‰§è¡ŒæŸ¥è¯¢å¹¶å°†ç»“æœæ‰«æåˆ° user å¯¹è±¡ä¸­</span>    err <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user<span class="token punctuation">.</span>Username<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err <span class="token comment">// å¤„ç†æŸ¥è¯¢é”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>?</code> æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼ŒGo ä¼šè‡ªåŠ¨å¤„ç†å‚æ•° <code>username</code> çš„è½¬ä¹‰ï¼Œä»è€Œé˜²æ­¢ SQL æ³¨å…¥ã€‚</p><h3 id="2-æ‰§è¡Œå¤šæ¡é¢„å¤„ç†è¯­å¥"><a href="#2-æ‰§è¡Œå¤šæ¡é¢„å¤„ç†è¯­å¥" class="headerlink" title="2. æ‰§è¡Œå¤šæ¡é¢„å¤„ç†è¯­å¥"></a>2. æ‰§è¡Œå¤šæ¡é¢„å¤„ç†è¯­å¥</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ’å…¥å¤šä¸ªç”¨æˆ·çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">insertUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> username <span class="token builtin">string</span><span class="token punctuation">,</span> email <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ›å»ºæ’å…¥ç”¨æˆ·çš„é¢„å¤„ç†è¯­å¥</span>    stmt<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users (username, email) VALUES (?, ?)"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err <span class="token comment">// å¤„ç†åˆ›å»ºé”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> stmt<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿åœ¨æœ€åå…³é—­é¢„å¤„ç†è¯­å¥</span>    <span class="token comment">// æ‰§è¡Œæ’å…¥æ“ä½œ</span>    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> email<span class="token punctuation">)</span>    <span class="token keyword">return</span> err <span class="token comment">// è¿”å›æ’å…¥ç»“æœçš„é”™è¯¯</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ’å…¥ç”¨æˆ·çš„å‡½æ•°ï¼ŒåŒæ ·ä½¿ç”¨äº†å ä½ç¬¦ï¼Œç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šå¯¼è‡´ SQL è°ƒç”¨çš„å¼‚å¸¸ã€‚</p><h3 id="3-æ‰§è¡Œæ‰¹é‡æ’å…¥"><a href="#3-æ‰§è¡Œæ‰¹é‡æ’å…¥" class="headerlink" title="3. æ‰§è¡Œæ‰¹é‡æ’å…¥"></a>3. æ‰§è¡Œæ‰¹é‡æ’å…¥</h3><p>åœ¨éœ€è¦æ’å…¥å¤šä¸ªè®°å½•çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥æ‰§è¡Œé¢„å¤„ç†è¯­å¥ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">insertMultipleUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>    stmt<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users (username, email) VALUES (?, ?)"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> err    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> stmt<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> user <span class="token operator">:=</span> <span class="token keyword">range</span> users <span class="token punctuation">{</span>        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> stmt<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Username<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span>        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> err <span class="token comment">// å¦‚æœæ’å…¥å¤±è´¥ï¼Œåˆ™è¿”å›é”™è¯¯</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”ã€å®‰å…¨æ€§æœ€ä½³å®è·µ"><a href="#äº”ã€å®‰å…¨æ€§æœ€ä½³å®è·µ" class="headerlink" title="äº”ã€å®‰å…¨æ€§æœ€ä½³å®è·µ"></a>äº”ã€å®‰å…¨æ€§æœ€ä½³å®è·µ</h2><p>é™¤äº†ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼Œå¼€å‘è€…è¿˜åº”éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µä»¥å¢å¼ºå®‰å…¨æ€§ï¼š</p><ol><li><strong>ä½¿ç”¨ ORM</strong>ï¼šä½¿ç”¨ Go çš„ ORM æ¡†æ¶ï¼ˆå¦‚ GORMï¼‰å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ– SQL æ“ä½œï¼ŒåŒæ—¶è‡ªåŠ¨å¤„ç† SQL æ³¨å…¥é—®é¢˜ã€‚</li><li><strong>é™åˆ¶æ•°æ®åº“ç”¨æˆ·æƒé™</strong>ï¼šé¿å…ç»™åº”ç”¨ç¨‹åºæ•°æ®åº“ç”¨æˆ·è¿‡é«˜çš„æƒé™ã€‚ç¡®ä¿åº”ç”¨ç¨‹åºä»…èƒ½æ‰§è¡Œå…¶æ‰€éœ€çš„æ“ä½œã€‚</li><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå§‹ç»ˆå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿å…¶ç¬¦åˆé¢„æœŸæ ¼å¼ã€‚</li><li><strong>å®šæœŸå®¡è®¡ä»£ç </strong>ï¼šå®šæœŸæ£€æŸ¥å’Œå®¡è®¡ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ½œåœ¨çš„ SQL æ³¨å…¥æ¼æ´ã€‚</li></ol><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>åœ¨ Go è¯­è¨€ä¸­ä½¿ç”¨ <code>github.com/go-sql-driver/mysql</code> é©±åŠ¨è¿›è¡Œ MySQL æ•°æ®åº“æ“ä½œæ—¶ï¼Œé¢„å¤„ç†è¯­å¥æ˜¯é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»çš„æœ‰æ•ˆæ‰‹æ®µã€‚é€šè¿‡ä½¿ç”¨å ä½ç¬¦ï¼ŒGo è¯­è¨€èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†è¾“å…¥æ•°æ®çš„è½¬ä¹‰ï¼Œå‡å°‘äº†å®‰å…¨éšæ‚£ã€‚åŒæ—¶ï¼ŒåŠ¡å¿…è¦ç»“åˆå…¶ä»–æœ€ä½³å®è·µï¼Œç¡®ä¿æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><p>æ€»ä¹‹ä¸€å®šè¦åˆ‡è®°ï¼š<strong>æ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥ï¼</strong></p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æ‘¸æ‰‹æ•™ä½ ï¼Œä»0åˆ°1å¼€å‘ä¸€ä¸ªChromeæµè§ˆå™¨æ’ä»¶</title>
      <link href="posts/2980e851.html"/>
      <url>posts/2980e851.html</url>
      
        <content type="html"><![CDATA[<p>å¼€å‘ Chrome æµè§ˆå™¨æ’ä»¶ï¼ˆä¹Ÿç§°ä¸ºæ‰©å±•ï¼‰æ˜¯ä¸€æ®µæœ‰è¶£ä¸”æœ‰æˆå°±æ„Ÿçš„è¿‡ç¨‹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å¼•å¯¼ä½ ä»é›¶å¼€å§‹ï¼Œé€æ­¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ Chrome æ’ä»¶ã€‚æ— è®ºä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹è¿˜æ˜¯æœ‰ä¸€å®šåŸºç¡€çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬éƒ½å°†ä»¥ç®€å•æ˜“æ‡‚çš„æ–¹å¼ä»‹ç»æ•´ä¸ªè¿‡ç¨‹ã€‚</p><h2 id="1-ä»€ä¹ˆæ˜¯-Chrome-æ’ä»¶ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-Chrome-æ’ä»¶ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ Chrome æ’ä»¶ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯ Chrome æ’ä»¶ï¼Ÿ</h2><p>Chrome æ’ä»¶æ˜¯å¯ä»¥æ·»åŠ åˆ° Google Chrome æµè§ˆå™¨ä¸­çš„å°ç¨‹åºï¼Œæ—¨åœ¨å¢å¼ºæµè§ˆå™¨çš„åŠŸèƒ½ã€‚å®ƒä»¬å¯ä»¥æ”¹å˜ç½‘é¡µçš„å¤–è§‚ã€å¢åŠ æ–°çš„åŠŸèƒ½ã€ä¸ç”¨æˆ·äº¤äº’ç­‰ã€‚</p><p>æˆ‘ä»¬å…ˆä»ä¸€ä¸ªæœ€ç®€å•çš„ Chrome æ‰©å±•å¼€å§‹ï¼Œä½ ä¹Ÿå¯ä»¥å‚ç…§æˆ‘å†™çš„è¿™ä¸ªå¾®ä¿¡å…¬ä¼—å·å°åŠ©æ‰‹æ’ä»¶ <code>https://github.com/pudongping/mp-vx-insight</code> æ¥å­¦ä¹ ï¼Œå¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€æ’¸ã€‚</p><h2 id="2-å‡†å¤‡å·¥ä½œ"><a href="#2-å‡†å¤‡å·¥ä½œ" class="headerlink" title="2. å‡†å¤‡å·¥ä½œ"></a>2. å‡†å¤‡å·¥ä½œ</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿ï¼š</p><ul><li>å·²å®‰è£… Google Chrome æµè§ˆå™¨ã€‚</li><li>æœ‰ä¸€ä¸ªç®€å•çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ Notepadã€VS Codeã€Sublime Textï¼‰ã€‚</li><li>å¯¹ HTMLã€CSS å’Œ JavaScript æœ‰åŸºæœ¬äº†è§£ã€‚</li></ul><h2 id="3-æ’ä»¶çš„åŸºæœ¬ç»“æ„"><a href="#3-æ’ä»¶çš„åŸºæœ¬ç»“æ„" class="headerlink" title="3. æ’ä»¶çš„åŸºæœ¬ç»“æ„"></a>3. æ’ä»¶çš„åŸºæœ¬ç»“æ„</h2><p>ä¸€ä¸ª Chrome æ’ä»¶é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªåŸºæœ¬æ–‡ä»¶ç»„æˆï¼š</p><ul><li><code>manifest.json</code>ï¼šæ’ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰æ’ä»¶çš„åŸºæœ¬ä¿¡æ¯å’Œæƒé™ã€‚</li><li><code>background.js</code>ï¼šæ’ä»¶çš„åå°è„šæœ¬ï¼Œè´Ÿè´£æ‰§è¡Œåå°ä»»åŠ¡ã€‚</li><li><code>popup.html</code>ï¼šç”¨æˆ·ç‚¹å‡»æ’ä»¶å›¾æ ‡æ—¶æ˜¾ç¤ºçš„ç•Œé¢ã€‚</li><li><code>style.css</code>ï¼šç”¨äºç¾åŒ–æ’ä»¶ç•Œé¢çš„æ ·å¼è¡¨ã€‚</li></ul><h2 id="4-åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶"><a href="#4-åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶" class="headerlink" title="4. åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶"></a>4. åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶</h2><h3 id="æ­¥éª¤-1ï¼šåˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹"><a href="#æ­¥éª¤-1ï¼šåˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹" class="headerlink" title="æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹"></a>æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹</h3><p>åœ¨ä½ çš„è®¡ç®—æœºä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ <code>my_first_extension</code>ã€‚</p><h3 id="æ­¥éª¤-2ï¼šåˆ›å»º-manifest-json-æ–‡ä»¶"><a href="#æ­¥éª¤-2ï¼šåˆ›å»º-manifest-json-æ–‡ä»¶" class="headerlink" title="æ­¥éª¤ 2ï¼šåˆ›å»º manifest.json æ–‡ä»¶"></a>æ­¥éª¤ 2ï¼šåˆ›å»º manifest.json æ–‡ä»¶</h3><p>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>manifest.json</code>ï¼Œå¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"manifest_version"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"My First Extension"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"This is my first Chrome extension!"</span><span class="token punctuation">,</span>  <span class="token property">"action"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"default_popup"</span><span class="token operator">:</span> <span class="token string">"popup.html"</span><span class="token punctuation">,</span>    <span class="token property">"default_icon"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"16"</span><span class="token operator">:</span> <span class="token string">"icon16.png"</span><span class="token punctuation">,</span>      <span class="token property">"48"</span><span class="token operator">:</span> <span class="token string">"icon48.png"</span><span class="token punctuation">,</span>      <span class="token property">"128"</span><span class="token operator">:</span> <span class="token string">"icon128.png"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"background"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"service_worker"</span><span class="token operator">:</span> <span class="token string">"background.js"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"activeTab"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-3ï¼šæ·»åŠ -Popup-ç•Œé¢"><a href="#æ­¥éª¤-3ï¼šæ·»åŠ -Popup-ç•Œé¢" class="headerlink" title="æ­¥éª¤ 3ï¼šæ·»åŠ  Popup ç•Œé¢"></a>æ­¥éª¤ 3ï¼šæ·»åŠ  Popup ç•Œé¢</h3><p>åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»º <code>popup.html</code> æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>My First Extension<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>style.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, Chrome!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clickMe<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Click Me!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>popup.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-4ï¼šåˆ›å»ºæ ·å¼æ–‡ä»¶"><a href="#æ­¥éª¤-4ï¼šåˆ›å»ºæ ·å¼æ–‡ä»¶" class="headerlink" title="æ­¥éª¤ 4ï¼šåˆ›å»ºæ ·å¼æ–‡ä»¶"></a>æ­¥éª¤ 4ï¼šåˆ›å»ºæ ·å¼æ–‡ä»¶</h3><p>åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»º <code>style.css</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">h1</span> <span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">button</span> <span class="token punctuation">{</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px 15px<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-5ï¼šæ·»åŠ -JavaScript-åŠŸèƒ½"><a href="#æ­¥éª¤-5ï¼šæ·»åŠ -JavaScript-åŠŸèƒ½" class="headerlink" title="æ­¥éª¤ 5ï¼šæ·»åŠ  JavaScript åŠŸèƒ½"></a>æ­¥éª¤ 5ï¼šæ·»åŠ  JavaScript åŠŸèƒ½</h3><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»º <code>popup.js</code> æ–‡ä»¶ï¼Œå®ç°æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'clickMe'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Button clicked!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-6ï¼šæ·»åŠ åå°è„šæœ¬"><a href="#æ­¥éª¤-6ï¼šæ·»åŠ åå°è„šæœ¬" class="headerlink" title="æ­¥éª¤ 6ï¼šæ·»åŠ åå°è„šæœ¬"></a>æ­¥éª¤ 6ï¼šæ·»åŠ åå°è„šæœ¬</h3><p>ä¸ºäº†å±•ç¤ºåå°åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ª <code>background.js</code> æ–‡ä»¶ï¼Œå†…å®¹å¯ä»¥æ˜¯ç®€å•çš„ console.logï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Background service worker running!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ­¥éª¤-7ï¼šæ·»åŠ å›¾æ ‡"><a href="#æ­¥éª¤-7ï¼šæ·»åŠ å›¾æ ‡" class="headerlink" title="æ­¥éª¤ 7ï¼šæ·»åŠ å›¾æ ‡"></a>æ­¥éª¤ 7ï¼šæ·»åŠ å›¾æ ‡</h3><p>ä¸ºäº†ä½¿ä½ çš„æ’ä»¶æ›´ç¾è§‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå…¶æ·»åŠ å›¾æ ‡ã€‚åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ·»åŠ ä¸‰ç§ä¸åŒå°ºå¯¸çš„å›¾æ ‡ï¼š<code>icon16.png</code>ã€<code>icon48.png</code> å’Œ <code>icon128.png</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨åœ¨çº¿å›¾æ ‡ç”Ÿæˆå™¨ç”Ÿæˆå›¾æ ‡ï¼Œæˆ–ä»ç½‘ç»œä¸‹è½½é€‚åˆçš„å›¾æ ‡ã€‚</p><h2 id="5-åœ¨-Chrome-ä¸­åŠ è½½æ‰©å±•"><a href="#5-åœ¨-Chrome-ä¸­åŠ è½½æ‰©å±•" class="headerlink" title="5. åœ¨ Chrome ä¸­åŠ è½½æ‰©å±•"></a>5. åœ¨ Chrome ä¸­åŠ è½½æ‰©å±•</h2><ol><li>æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¾“å…¥ <code>chrome://extensions/</code> å¹¶æŒ‰å›è½¦ã€‚</li><li>åœ¨å³ä¸Šè§’å¯ç”¨å¼€å‘è€…æ¨¡å¼ã€‚<strong>ä¸€å®šè¦å¼€å¯</strong></li><li>ç‚¹å‡» â€œåŠ è½½å·²è§£å‹çš„æ‰©å±•â€ï¼Œé€‰æ‹©ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼ˆ<code>my_first_extension</code>ï¼‰ã€‚</li><li>ä½ ä¼šåœ¨æ‰©å±•åˆ—è¡¨ä¸­çœ‹åˆ°ä½ çš„æ’ä»¶ã€‚</li></ol><h2 id="6-æµ‹è¯•æ’ä»¶"><a href="#6-æµ‹è¯•æ’ä»¶" class="headerlink" title="6. æµ‹è¯•æ’ä»¶"></a>6. æµ‹è¯•æ’ä»¶</h2><p>ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„æ’ä»¶å›¾æ ‡ï¼Œä¼šå¼¹å‡ºä½ å®šä¹‰çš„ Popup ç•Œé¢ã€‚ç‚¹å‡»æŒ‰é’®ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°æç¤ºæ¡†å¼¹å‡ºï¼Œæ˜¾ç¤º â€œButton clicked!â€ã€‚</p><p>ç°åœ¨ï¼Œä½ å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ Chrome æ’ä»¶ï¼æ˜¯ä¸æ˜¯éå¸¸ç®€å•å‘¢ï¼Ÿå½“ç„¶è¿˜æœ‰æ›´å¤šçš„ä¸€äº›ç‰¹æ€§ç”±äºç¯‡å¹…çš„åŸå› å°±ä¸ç»†è®²äº†ï¼Œå¼ºçƒˆå»ºè®®ä½ å¯ä»¥ç›´æ¥æ‰¾ä¸€ä¸ª Chrome æ’ä»¶æºç çœ‹çœ‹ï¼Œæ¯”å¦‚æˆ‘å†™çš„è¿™ä¸ªå¾®ä¿¡å…¬ä¼—å·å°åŠ©æ‰‹ Chrome æ‰©å±• <code>https://github.com/pudongping/mp-vx-insight</code> è¿™æ ·å¯ä»¥å­¦å¾—æ›´å¿«ï¼</p><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><p>é€šè¿‡è¿™ä¸ªç®€å•çš„æ•™ç¨‹ï¼Œä½ å·²ç»äº†è§£äº†å¦‚ä½•ä»é›¶å¼€å§‹å¼€å‘ä¸€ä¸ªåŸºæœ¬çš„ Chrome æ’ä»¶ã€‚æ’ä»¶çš„å¼€å‘ä¸ä»…èƒ½æå‡ä½ çš„ç¼–ç¨‹æŠ€èƒ½ï¼Œæ›´èƒ½è®©ä½ åœ¨æ—¥å¸¸æµè§ˆä¸­äº«å—åˆ°ä¾¿åˆ©ã€‚å¸Œæœ›ä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ„Ÿå—åˆ°ä¹è¶£ã€‚</p><p>å¦‚éœ€è¿›ä¸€æ­¥å­¦ä¹ ï¼Œå¯ä»¥å‚è€ƒ <a href="https://developer.chrome.com/docs/extensions/mv3/getstarted/">Chrome æ‰©å±•æ–‡æ¡£</a>ï¼Œæ·±å…¥äº†è§£ä¸åŒçš„ API å’ŒåŠŸèƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­å¦‚ä½•è¿æ¥ MySQLï¼ŒåŸºç¡€å¿…å¤‡ï¼</title>
      <link href="posts/48b3e862.html"/>
      <url>posts/48b3e862.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£åº”ç”¨ä¸­ï¼Œæ•°æ®åº“æ“ä½œæ˜¯å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ï¼Œè€Œ Go è¯­è¨€å‡­å€Ÿå…¶é«˜æ•ˆæ€§å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œæˆä¸ºäº†è¶Šæ¥è¶Šå¤šå¼€å‘è€…çš„é€‰æ‹©ã€‚</p><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Go è¯­è¨€ä¸ MySQL æ•°æ®åº“è¿›è¡ŒåŸºæœ¬çš„ CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ“ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ <code>database/sql</code> æ ‡å‡†åº“ä»¥åŠ <code>github.com/go-sql-driver/mysql</code> é©±åŠ¨æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="headerlink" title="ç¯å¢ƒè¦æ±‚"></a>ç¯å¢ƒè¦æ±‚</h3><ul><li>åˆ›å»ºä¸€ä¸ªåä¸º <code>test_db</code> çš„æ•°æ®åº“ã€‚</li><li>åˆ›å»ºä¸€ä¸ª <code>users</code> è¡¨ï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CREATE DATABASE test_db<span class="token punctuation">;</span>USE test_db<span class="token punctuation">;</span>CREATE TABLE <span class="token function">users</span> <span class="token punctuation">(</span>    <span class="token function">id</span> INT AUTO_INCREMENT PRIMARY KEY,    name VARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> NOT NULL,    age INT NOT NULL<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-MySQL-é©±åŠ¨"><a href="#å®‰è£…-MySQL-é©±åŠ¨" class="headerlink" title="å®‰è£… MySQL é©±åŠ¨"></a>å®‰è£… MySQL é©±åŠ¨</h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… MySQL é©±åŠ¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/go-sql-driver/mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Go ç¨‹åºï¼Œå±•ç¤ºå¦‚ä½•è¿›è¡ŒåŸºæœ¬çš„ CRUD æ“ä½œï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"database/sql"</span>    <span class="token string">"fmt"</span>    <span class="token string">"log"</span>    <span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²</span>    dsn <span class="token operator">:=</span> <span class="token string">"user:password@tcp(127.0.0.1:3306)/test_db"</span>    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// é˜²æ­¢ db ä¸º nilï¼Œå› æ­¤éœ€è¦å…ˆåˆ¤æ–­ err ä¹‹åæ‰èƒ½è°ƒç”¨ Close æ–¹æ³•å»é‡Šæ”¾ db</span>    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// æµ‹è¯•è¿æ¥</span>    <span class="token keyword">if</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æˆåŠŸè¿æ¥åˆ° MySQL æ•°æ®åº“ï¼"</span><span class="token punctuation">)</span>    <span class="token comment">// åˆ›å»ºç”¨æˆ·</span>    id <span class="token operator">:=</span> <span class="token function">createUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æ–°åˆ›å»ºçš„ç”¨æˆ· ID: %d\n"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>    <span class="token comment">// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span>    <span class="token function">getUsers</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>    <span class="token comment">// æŸ¥è¯¢å•ä¸ªç”¨æˆ·</span>    userId <span class="token operator">:=</span> <span class="token number">1</span>    <span class="token function">getUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>    <span class="token comment">// æ›´æ–°ç”¨æˆ·</span>    affectedRows <span class="token operator">:=</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Alice Smith"</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å—å½±å“çš„è¡Œæ•°: %d\n"</span><span class="token punctuation">,</span> affectedRows<span class="token punctuation">)</span>    <span class="token comment">// åˆ é™¤ç”¨æˆ·</span>    affectedRows <span class="token operator">=</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å—å½±å“çš„è¡Œæ•°: %d\n"</span><span class="token punctuation">,</span> affectedRows<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ›å»ºï¼ˆInsertï¼‰"><a href="#åˆ›å»ºï¼ˆInsertï¼‰" class="headerlink" title="åˆ›å»ºï¼ˆInsertï¼‰"></a>åˆ›å»ºï¼ˆInsertï¼‰</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// åˆ›å»ºç”¨æˆ·ï¼Œè¿”å›æ–°åˆ›å»ºç”¨æˆ·çš„ ID</span><span class="token keyword">func</span> <span class="token function">createUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>    query <span class="token operator">:=</span> <span class="token string">"INSERT INTO users (name, age) VALUES (?, ?)"</span>    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// è·å–æœ€åæ’å…¥çš„ ID</span>    lastInsertId<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">LastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">int</span><span class="token punctuation">(</span>lastInsertId<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æŸ¥è¯¢ï¼ˆSelectï¼‰"><a href="#æŸ¥è¯¢ï¼ˆSelectï¼‰" class="headerlink" title="æŸ¥è¯¢ï¼ˆSelectï¼‰"></a>æŸ¥è¯¢ï¼ˆSelectï¼‰</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span><span class="token keyword">func</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>    query <span class="token operator">:=</span> <span class="token string">"SELECT id, name, age FROM users"</span>    rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// ä¸€å®šè¦è®°å¾—å…³é—­èµ„æº</span>    <span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æ‰€æœ‰ç”¨æˆ·:"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> id <span class="token builtin">int</span>        <span class="token keyword">var</span> name <span class="token builtin">string</span>        <span class="token keyword">var</span> age <span class="token builtin">int</span>        <span class="token keyword">if</span> err <span class="token operator">:=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ID: %d, Name: %s, Age: %d\n"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// æŸ¥è¯¢å•ä¸ªç”¨æˆ·</span><span class="token keyword">func</span> <span class="token function">getUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    query <span class="token operator">:=</span> <span class="token string">"SELECT id, name, age FROM users WHERE id = ?"</span>    row <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> id<span class="token punctuation">)</span>    <span class="token keyword">var</span> name <span class="token builtin">string</span>    <span class="token keyword">var</span> age <span class="token builtin">int</span>    <span class="token comment">// è°ƒç”¨å®Œäº† QueryRow æ–¹æ³•ä¹‹åï¼Œä¸€å®šè¦è®°å¾—è°ƒç”¨ Scan æ–¹æ³•ï¼Œå¦åˆ™æŒæœ‰çš„æ•°æ®åº“è¿æ¥ä¸ä¼šè¢«é‡Šæ”¾</span>    <span class="token keyword">if</span> err <span class="token operator">:=</span> row<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> err <span class="token operator">==</span> sql<span class="token punctuation">.</span>ErrNoRows <span class="token punctuation">{</span>            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ· ID %d ä¸å­˜åœ¨\n"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ· ID: %d, Name: %s, Age: %d\n"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ›´æ–°ï¼ˆUpdateï¼‰"><a href="#æ›´æ–°ï¼ˆUpdateï¼‰" class="headerlink" title="æ›´æ–°ï¼ˆUpdateï¼‰"></a>æ›´æ–°ï¼ˆUpdateï¼‰</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æ›´æ–°ç”¨æˆ·ï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°</span><span class="token keyword">func</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int</span><span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>    query <span class="token operator">:=</span> <span class="token string">"UPDATE users SET name = ?, age = ? WHERE id = ?"</span>    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> id<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// è·å–å—å½±å“çš„è¡Œæ•°</span>    affectedRows<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">RowsAffected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">int</span><span class="token punctuation">(</span>affectedRows<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ é™¤ï¼ˆDeleteï¼‰"><a href="#åˆ é™¤ï¼ˆDeleteï¼‰" class="headerlink" title="åˆ é™¤ï¼ˆDeleteï¼‰"></a>åˆ é™¤ï¼ˆDeleteï¼‰</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// åˆ é™¤ç”¨æˆ·ï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°</span><span class="token keyword">func</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>    query <span class="token operator">:=</span> <span class="token string">"DELETE FROM users WHERE id = ?"</span>    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> id<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// è·å–å—å½±å“çš„è¡Œæ•°</span>    affectedRows<span class="token punctuation">,</span> err <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">RowsAffected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">int</span><span class="token punctuation">(</span>affectedRows<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»£ç è§£æ"><a href="#ä»£ç è§£æ" class="headerlink" title="ä»£ç è§£æ"></a>ä»£ç è§£æ</h2><h3 id="1-æ•°æ®åº“è¿æ¥"><a href="#1-æ•°æ®åº“è¿æ¥" class="headerlink" title="1. æ•°æ®åº“è¿æ¥"></a>1. æ•°æ®åº“è¿æ¥</h3><p>æˆ‘ä»¬ä½¿ç”¨ <code>sql.Open</code> æ–¹æ³•è¿æ¥åˆ° MySQL æ•°æ®åº“ï¼Œè¿æ¥å­—ç¬¦ä¸²æ ¼å¼ä¸º <code>user:password@tcp(host:port)/dbname</code>ã€‚åœ¨è¿æ¥åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>db.Ping()</code> æµ‹è¯•æ•°æ®åº“è¿æ¥æ˜¯å¦æˆåŠŸã€‚</p><h3 id="2-åˆ›å»ºç”¨æˆ·"><a href="#2-åˆ›å»ºç”¨æˆ·" class="headerlink" title="2. åˆ›å»ºç”¨æˆ·"></a>2. åˆ›å»ºç”¨æˆ·</h3><p><code>createUser</code> å‡½æ•°é€šè¿‡ <code>INSERT</code> è¯­å¥å‘ <code>users</code> è¡¨ä¸­æ·»åŠ æ–°ç”¨æˆ·ï¼Œå¹¶è¿”å›æ–°åˆ›å»ºç”¨æˆ·çš„ IDã€‚</p><h3 id="3-æŸ¥è¯¢ç”¨æˆ·"><a href="#3-æŸ¥è¯¢ç”¨æˆ·" class="headerlink" title="3. æŸ¥è¯¢ç”¨æˆ·"></a>3. æŸ¥è¯¢ç”¨æˆ·</h3><ul><li><code>getUsers</code> å‡½æ•°æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·å¹¶æ‰“å°æ¯ä¸ªç”¨æˆ·çš„ IDã€å§“åå’Œå¹´é¾„ã€‚</li><li><code>getUser</code> å‡½æ•°é€šè¿‡ç”¨æˆ· ID æŸ¥è¯¢å•ä¸ªç”¨æˆ·ï¼Œå¹¶å¤„ç†ç”¨æˆ·ä¸å­˜åœ¨çš„æƒ…å†µã€‚</li></ul><h3 id="4-æ›´æ–°ç”¨æˆ·"><a href="#4-æ›´æ–°ç”¨æˆ·" class="headerlink" title="4. æ›´æ–°ç”¨æˆ·"></a>4. æ›´æ–°ç”¨æˆ·</h3><p><code>updateUser</code> å‡½æ•°ç”¨äºæ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¿”å›å—å½±å“çš„è¡Œæ•°ï¼Œä»¥ç¡®è®¤æ“ä½œæ˜¯å¦æˆåŠŸã€‚</p><h3 id="5-åˆ é™¤ç”¨æˆ·"><a href="#5-åˆ é™¤ç”¨æˆ·" class="headerlink" title="5. åˆ é™¤ç”¨æˆ·"></a>5. åˆ é™¤ç”¨æˆ·</h3><p><code>deleteUser</code> å‡½æ•°ç”¨äºåˆ é™¤æŒ‡å®š ID çš„ç”¨æˆ·ï¼Œå¹¶åŒæ ·è¿”å›å—å½±å“çš„è¡Œæ•°ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Go è¯­è¨€ä¸ MySQL æ•°æ®åº“è¿›è¡ŒåŸºæœ¬çš„ CRUD æ“ä½œã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å¯ä»¥åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ç”¨æˆ·æ•°æ®ï¼Œè¿™ä¸ºæ‚¨åœ¨å¼€å‘åŸºäºæ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ—¶æ‰“ä¸‹äº†åŸºç¡€ã€‚</p><p>ç”¨è¿™ä¸ªåº“è¿˜æ˜¯æ¯”è¾ƒç´¯èµ˜çš„ï¼Œä»£ç å†™èµ·æ¥æ¯”è¾ƒç´¯ï¼Œå¹¶ä¸”ä¸€èˆ¬åœ¨å®é™…åº”ç”¨ä¸­å¾ˆå°‘ä¼šç›´æ¥æ‹¼æ¥ sql è¯­å¥ï¼Œä¼šé‡åˆ° SQL æ³¨å…¥çš„é£é™©ï¼Œåé¢ä¼šä»‹ç» sqlx æˆ–è€… gorm çš„ä½¿ç”¨ï¼Œè¿™é‡Œå…ˆäº†è§£ä¸ªåŸºç¡€çŸ¥è¯†ï¼Œä¸ºåæœŸåšåšå‡†å¤‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ–‡å¼„æ‡‚Goè¯­è¨€çš„ContextåŒ…ï¼Œå€¼å¾—æ”¶è—ï¼</title>
      <link href="posts/f5eba23a.html"/>
      <url>posts/f5eba23a.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¼€å‘é«˜æ•ˆä¸”å¯ç»´æŠ¤çš„ Go åº”ç”¨ç¨‹åºæ—¶ï¼Œå¤„ç†è¶…æ—¶ã€å–æ¶ˆæ“ä½œå’Œä¼ é€’è¯·æ±‚èŒƒå›´çš„æ•°æ®å˜å¾—è‡³å…³é‡è¦ã€‚</p><p>è¿™æ—¶ï¼ŒGo æ ‡å‡†åº“ä¸­çš„ <code>context</code> åŒ…å°±æ˜¾å¾—å°¤å…¶é‡è¦äº†ï¼Œå®ƒæä¾›äº†åœ¨ä¸åŒ API å±‚çº§ä¹‹é—´ä¼ é€’å–æ¶ˆä¿¡å·ã€è¶…æ—¶æ—¶é—´ã€æˆªæ­¢æ—¥æœŸï¼Œä»¥åŠå…¶ä»–ç‰¹å®šè¯·æ±‚çš„å€¼çš„èƒ½åŠ›ã€‚</p><p>è¿™ç¯‡æ–‡ç« å°±ä»‹ç» <code>context</code> åŒ…çš„åŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ ç†è§£å’Œä½¿ç”¨è¿™ä¸€å¼ºå¤§çš„å·¥å…·ã€‚</p><h2 id="Context-åŒ…çš„æ¦‚è¿°"><a href="#Context-åŒ…çš„æ¦‚è¿°" class="headerlink" title="Context åŒ…çš„æ¦‚è¿°"></a>Context åŒ…çš„æ¦‚è¿°</h2><p><code>context</code> åŒ…å…è®¸ä½ ä¼ é€’å¯å–æ¶ˆçš„ä¿¡å·ã€è¶…æ—¶æ—¶é—´ã€æˆªæ­¢æ—¥æœŸï¼Œä»¥åŠè·¨ API è¾¹ç•Œçš„è¯·æ±‚èŒƒå›´çš„æ•°æ®ã€‚åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå®ƒéå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å¤„ç†é‚£äº›å¯èƒ½éœ€è¦æå‰åœæ­¢çš„é•¿æ—¶é—´è¿è¡Œæ“ä½œã€‚</p><h2 id="å…³é”®ç‰¹æ€§"><a href="#å…³é”®ç‰¹æ€§" class="headerlink" title="å…³é”®ç‰¹æ€§"></a>å…³é”®ç‰¹æ€§</h2><p>Go è¯­è¨€çš„ <code>context</code> åŒ…æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ï¼Œè¿™äº›ä¸Šä¸‹æ–‡å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸã€å–æ¶ˆä¿¡å·ã€è¶…æ—¶ã€æˆªæ­¢æ—¥æœŸå’Œä¼ é€’è¯·æ±‚èŒƒå›´çš„æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ <code>context</code> åŒ…ä¸­çš„ä¸»è¦æ–¹æ³•åŠå…¶ç”¨é€”ï¼š</p><h3 id="1-Background"><a href="#1-Background" class="headerlink" title="1. Background()"></a>1. <code>Background()</code></h3><p><strong>ç”¨é€”</strong>ï¼šè¿”å›ä¸€ä¸ªç©ºçš„ä¸Šä¸‹æ–‡ï¼Œé€šå¸¸ç”¨äºç¨‹åºçš„é¡¶å±‚ï¼ˆä¾‹å¦‚ <code>main</code> å‡½æ•°ï¼‰ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºåˆå§‹åŒ–æ—¶æ²¡æœ‰ç‰¹å®šä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨ HTTP æœåŠ¡å™¨å¯åŠ¨æ—¶ã€‚</p><h3 id="2-TODO"><a href="#2-TODO" class="headerlink" title="2. TODO()"></a>2. <code>TODO()</code></h3><p><strong>ç”¨é€”</strong>ï¼šè¿”å›ä¸€ä¸ªç©ºçš„ä¸Šä¸‹æ–‡ï¼Œé€šå¸¸åœ¨æˆ‘ä»¬ä¸ç¡®å®šä½¿ç”¨å“ªä¸ªä¸Šä¸‹æ–‡æ—¶ä½¿ç”¨ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨ç¼–å†™ä»£ç æ—¶æœªå®Œæˆä¸Šä¸‹æ–‡å®šä¹‰ï¼Œä½œä¸ºå ä½ç¬¦ã€‚</p><h3 id="3-WithCancel-parent-Context"><a href="#3-WithCancel-parent-Context" class="headerlink" title="3. WithCancel(parent Context)"></a>3. <code>WithCancel(parent Context)</code></h3><p><strong>ç”¨é€”</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡å’Œå–æ¶ˆå‡½æ•°ã€‚å½“è°ƒç”¨å–æ¶ˆå‡½æ•°æ—¶ï¼Œæ‰€æœ‰æ´¾ç”Ÿè‡ªè¿™ä¸ªä¸Šä¸‹æ–‡çš„æ“ä½œå°†è¢«é€šçŸ¥å–æ¶ˆã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šå½“ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œéœ€è¦èƒ½å¤Ÿè¢«å–æ¶ˆæ—¶ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨ç½‘é¡µä¸­ç‚¹å‡»â€œå–æ¶ˆâ€æŒ‰é’®æ—¶ï¼Œç›¸å…³çš„æ•°æ®åº“æˆ– HTTP è¯·æ±‚åº”ç«‹å³åœæ­¢ã€‚</p><h3 id="4-WithDeadline-parent-Context-d-time-Time"><a href="#4-WithDeadline-parent-Context-d-time-Time" class="headerlink" title="4. WithDeadline(parent Context, d time.Time)"></a>4. <code>WithDeadline(parent Context, d time.Time)</code></h3><p><strong>ç”¨é€”</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œè¯¥ä¸Šä¸‹æ–‡åœ¨æŒ‡å®šçš„<strong>æ—¶é—´ç‚¹</strong>è‡ªåŠ¨å–æ¶ˆã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨è¯·æ±‚å¤„ç†æ—¶è®¾ç½®æœ€å¤§æ‰§è¡Œæ—¶é—´ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨å¤–éƒ¨ API æ—¶ï¼Œå¦‚æœå“åº”æ—¶é—´è¶…è¿‡é¢„æœŸï¼Œå°†è‡ªåŠ¨å–æ¶ˆè¯·æ±‚ï¼Œä»¥é¿å…æ— æ•ˆçš„ç­‰å¾…ã€‚</p><h3 id="5-WithTimeout-parent-Context-timeout-time-Duration"><a href="#5-WithTimeout-parent-Context-timeout-time-Duration" class="headerlink" title="5. WithTimeout(parent Context, timeout time.Duration)"></a>5. <code>WithTimeout(parent Context, timeout time.Duration)</code></h3><p><strong>ç”¨é€”</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå®ƒä¼šåœ¨<strong>æŒ‡å®šçš„æŒç»­æ—¶é—´å†…</strong>è‡ªåŠ¨å–æ¶ˆã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºè®¾ç½®æ“ä½œçš„è¶…æ—¶æ—¶é—´ï¼Œç¡®ä¿ç³»ç»Ÿä¸ä¼šåœ¨æŸä¸ªæ“ä½œä¸Šæ— ä¼‘æ­¢åœ°ç­‰å¾…ã€‚å¸¸ç”¨äºç½‘ç»œè¯·æ±‚æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚</p><h3 id="6-WithValue-parent-Context-key-val-interface"><a href="#6-WithValue-parent-Context-key-val-interface" class="headerlink" title="6. WithValue(parent Context, key, val interface{})"></a>6. <code>WithValue(parent Context, key, val interface{})</code></h3><p><strong>ç”¨é€”</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†é”®å€¼å¯¹å­˜å‚¨åœ¨è¯¥ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œå°†ç‰¹å®šçš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€RequestIDï¼‰åœ¨å¤„ç†é“¾ä¸­ä¼ é€’ï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªå‡½æ•°å‚æ•°ä¸­æ˜¾å¼ä¼ é€’ã€‚</p><h3 id="7-context-Done"><a href="#7-context-Done" class="headerlink" title="7. context.Done()"></a>7. <code>context.Done()</code></h3><p><strong>ç”¨é€”</strong>ï¼šé€šå¸¸ä¸ <code>context.WithDeadline</code> å’Œ <code>context.WithTimeout</code> ä¸€èµ·ä½¿ç”¨ã€‚<code>context.Done()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªé€šé“ (<code>&lt;-chan struct{}</code>)ï¼Œè¿™ä¸ªé€šé“åœ¨ä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶ä¼šè¢«å…³é—­ã€‚å®ƒé€šå¸¸ç”¨äº Goroutine ä¸­ï¼Œè®©ä»»åŠ¡èƒ½å¤Ÿåœ¨ä¸Šä¸‹æ–‡å–æ¶ˆæ—¶åŠæ—¶å“åº”ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ä»»åŠ¡æ§åˆ¶ï¼šå¯ä»¥ç”¨æ¥è®© goroutine çŸ¥é“ä½•æ—¶åº”è¯¥åœæ­¢æ‰§è¡Œï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œæ—¶ã€‚</li><li>å–æ¶ˆä¿¡å·ï¼šå½“è°ƒç”¨ <code>CancelFunc</code>ï¼ˆæ¥è‡ª <code>WithCancel</code>, <code>WithTimeout</code> æˆ– <code>WithDeadline</code> æ–¹æ³•ï¼‰æ¥æ‰‹åŠ¨å–æ¶ˆä¸Šä¸‹æ–‡æ—¶ï¼Œæ‰€æœ‰é€šè¿‡ <code>context.Done()</code> ç›‘å¬çš„ goroutines éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå¹¶ç›¸åº”åœ°åšå‡ºååº”ã€‚</li></ul><h2 id="åŸºç¡€ç”¨æ³•"><a href="#åŸºç¡€ç”¨æ³•" class="headerlink" title="åŸºç¡€ç”¨æ³•"></a>åŸºç¡€ç”¨æ³•</h2><h3 id="åˆ›å»º-Context"><a href="#åˆ›å»º-Context" class="headerlink" title="åˆ›å»º Context"></a>åˆ›å»º Context</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸¤ä¸ªæœ€åŸºæœ¬çš„ <code>context</code> åˆ›å»ºå‡½æ•°ï¼š<code>context.Background()</code> å’Œ <code>context.TODO()</code>ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æ ¹ Contextï¼Œé€šå¸¸åœ¨ main å‡½æ•°ã€åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨</span>ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“ä¸ç¡®å®šä½¿ç”¨å“ªç§ Context æˆ–æœªæ¥ä¼šæ·»åŠ  Context æ—¶ä½¿ç”¨</span>ctxTodo <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ´¾ç”Ÿ-Context"><a href="#æ´¾ç”Ÿ-Context" class="headerlink" title="æ´¾ç”Ÿ Context"></a>æ´¾ç”Ÿ Context</h3><p>æ›´å®ç”¨çš„åœºæ™¯æ˜¯åˆ›å»ºå­ Contextï¼Œè¿™å¯ä»¥é€šè¿‡ <code>context.WithCancel</code>ã€<code>context.WithDeadline</code>ã€<code>context.WithTimeout</code> å’Œ <code>context.WithValue</code> æ–¹æ³•å®Œæˆã€‚</p><h4 id="å–æ¶ˆæ“ä½œ"><a href="#å–æ¶ˆæ“ä½œ" class="headerlink" title="å–æ¶ˆæ“ä½œ"></a>å–æ¶ˆæ“ä½œ</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithCancel</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è°ƒç”¨ cancel æ—¶ï¼Œè¯¥ ctx ä»¥åŠæ‰€æœ‰ä»å®ƒæ´¾ç”Ÿçš„å­ context éƒ½ä¼šè¢«å–æ¶ˆ</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ¨¡æ‹Ÿä¸€ä¸ªä¼šè¢«å–æ¶ˆçš„æ“ä½œ</span>    <span class="token keyword">select</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Operation canceled"</span><span class="token punctuation">)</span>    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Finished operation"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¸»åŠ¨å‘é€å–æ¶ˆä¿¡å·</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è®¾ç½®è¶…æ—¶"><a href="#è®¾ç½®è¶…æ—¶" class="headerlink" title="è®¾ç½®è¶…æ—¶"></a>è®¾ç½®è¶…æ—¶</h4><p><code>context.WithTimeout</code> æ–¹æ³•å’Œ <code>context.WithDeadline</code> æ–¹æ³•éƒ½å¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬è®¾ç½®çš„è¶…æ—¶ç±»å‹çš„ä¸åŒã€‚</p><p><code>context.WithTimeout</code> æ–¹æ³•ç”¨äºè®¾ç½®<strong>ç›¸å¯¹çš„è¶…æ—¶æ—¶é—´</strong>ã€‚å®ƒæ¥å—ä¸€ä¸ª context å’Œä¸€ä¸ªæ—¶é—´é—´éš”ä½œä¸ºå‚æ•°ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¿è¯ä»¥æ¸…ç†èµ„æºçš„æ–¹å¼ç»“æŸ context</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> context<span class="token punctuation">.</span>DeadlineExceeded <span class="token punctuation">{</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Operation timed out"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>context.WithDeadline</code> æ–¹æ³•ç”¨äºè®¾ç½®<strong>ç»å¯¹çš„è¶…æ—¶æ—¶é—´ç‚¹</strong>ã€‚å®ƒæ¥å—ä¸€ä¸ª context å’Œä¸€ä¸ªæ—¶é—´ç‚¹ä½œä¸ºå‚æ•°ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// è®¾ç½®æˆªæ­¢æ—¶é—´å¹¶æ‰§è¡Œä»»åŠ¡</span>deadline <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithDeadline</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deadline<span class="token punctuation">)</span><span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿èµ„æºé‡Šæ”¾</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">select</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">// æ¨¡æ‹Ÿé•¿æ—¶é—´ä»»åŠ¡</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Task completed"</span><span class="token punctuation">)</span>    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">// å“åº”è¶…æ—¶å¯¼è‡´è¢«å–æ¶ˆ</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Task canceled:"</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">// ç­‰å¾…ä¸€æ®µæ—¶é—´</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Finished main function"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¸Šä¸‹æ–‡ä¼ å€¼"><a href="#ä¸Šä¸‹æ–‡ä¼ å€¼" class="headerlink" title="ä¸Šä¸‹æ–‡ä¼ å€¼"></a>ä¸Šä¸‹æ–‡ä¼ å€¼</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithValue</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"key"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span>value <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯"><a href="#å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯"></a>å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯</h2><h3 id="1-HTTP-å¤„ç†"><a href="#1-HTTP-å¤„ç†" class="headerlink" title="1. HTTP å¤„ç†"></a>1. HTTP å¤„ç†</h3><p>åœ¨ Web åº”ç”¨ä¸­ï¼Œæ¯å½“æ¥æ”¶åˆ°ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå°†å…¶ä¼ é€’ç»™æ‰€æœ‰çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¶…æ—¶æˆ–å–æ¶ˆä¿¡å·æ¥æ§åˆ¶è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">handler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>    <span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// åœ¨ ctx ä¸­æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢æˆ–å…¶ä»–æ“ä½œ</span>    <span class="token comment">// å¦‚æœæ“ä½œè¶…æ—¶ï¼Œåˆ™è‡ªåŠ¨å–æ¶ˆå’Œå¤„ç†</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-æ•°æ®åº“æ“ä½œ"><a href="#2-æ•°æ®åº“æ“ä½œ" class="headerlink" title="2. æ•°æ®åº“æ“ä½œ"></a>2. æ•°æ®åº“æ“ä½œ</h3><p>è®¸å¤šæ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚ <code>database/sql</code>ï¼‰æ”¯æŒ <code>context</code>ï¼Œå¯ä»¥åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶è®¾ç½®è¶…æ—¶ã€‚è¿™æœ‰åŠ©äºé¿å…å› ä¸ºæ•°æ®åº“å“åº”ç¼“æ…¢è€Œå¯¼è‡´çš„æ— ä¼‘æ­¢ç­‰å¾…ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>    <span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å‡è®¾ db æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥</span>    rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">QueryContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">"SELECT ..."</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token comment">// å¤„ç†é”™è¯¯</span>    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¤„ç†æŸ¥è¯¢ç»“æœ ...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-å¤–éƒ¨æœåŠ¡è°ƒç”¨"><a href="#3-å¤–éƒ¨æœåŠ¡è°ƒç”¨" class="headerlink" title="3. å¤–éƒ¨æœåŠ¡è°ƒç”¨"></a>3. å¤–éƒ¨æœåŠ¡è°ƒç”¨</h3><p>åœ¨ä¸å¤–éƒ¨ API é€šä¿¡æ—¶ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œä»¥é˜²æœåŠ¡æ— æ³•åŠæ—¶å“åº”ã€‚åˆ©ç”¨ <code>WithTimeout</code>ï¼Œå¯ä»¥ç¡®ä¿ç¨‹åºä¸ä¼šæ°¸ä¹…ç­‰å¾…å“åº”ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">callExternalAPI</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>    <span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// è¿›è¡Œå¤–éƒ¨ API è°ƒç”¨</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-Goroutine-ç®¡ç†"><a href="#4-Goroutine-ç®¡ç†" class="headerlink" title="4. Goroutine ç®¡ç†"></a>4. Goroutine ç®¡ç†</h3><p>åœ¨å¤šä¸ª Goroutine ä¸­å¹¶å‘æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œé€šè¿‡ <code>WithCancel</code> æ¥åè°ƒå„ä¸ª Goroutine çš„å–æ¶ˆæ“ä½œï¼Œæé«˜ç³»ç»Ÿçš„å¯æ§åˆ¶æ€§ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">concurrentTasks</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithCancel</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>    <span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// æ‰§è¡Œä¸€äº›é•¿æ—¶é—´å·¥ä½œ</span>        <span class="token keyword">select</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment">// å“åº”å–æ¶ˆ</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul><li><strong>é¿å…æŠŠé¢‘ç¹å˜åŒ–çš„å€¼å­˜å…¥ Context</strong>ï¼šè™½ç„¶ <code>context</code> æ”¯æŒé€šè¿‡ <code>WithValue</code> æ–¹æ³•ä¼ å€¼ï¼Œä½†åº”è¯¥å°½é‡é¿å…å°†<strong>é¢‘ç¹å˜åŒ–</strong>çš„æ•°æ®é€šè¿‡ context ä¼ é€’ã€‚</li><li><strong>Context æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼šå¯ä»¥æ”¾å¿ƒåœ°åœ¨å¤šä¸ª Goroutine ä¸­ä½¿ç”¨ã€‚</li><li><strong>æ­£ç¡®ä½¿ç”¨å–æ¶ˆå‡½æ•°</strong>ï¼šå½“ä½ é€šè¿‡ <code>context.WithCancel</code> åˆ›å»º context æ—¶ï¼Œä¸€å®šè¦è°ƒç”¨è¿”å›çš„å–æ¶ˆå‡½æ•°ï¼Œé¿å…èµ„æºæ³„éœ²ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼š<code>context.Done()</code> æ˜¯ä¸€ä¸ªéé˜»å¡çš„é€šé“ï¼Œä½¿ç”¨å®ƒæ¥ç›‘å¬å–æ¶ˆä¿¡å·ä¸ä¼šå¼•å…¥æ˜¾è‘—çš„æ€§èƒ½è´Ÿæ‹…ã€‚</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>ctx.Err()</code> æ¥è·å–å–æ¶ˆçš„åŸå› ï¼Œé€šå¸¸æ˜¯åœ¨ goroutine ä¸­å¤„ç†è¿™äº›ä¿¡æ¯æ—¶éå¸¸æœ‰ç”¨ã€‚</li></ul><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p><code>context</code> åŒ…æ˜¯ Go è¯­è¨€ä¸ºå¤„ç†å¹¶å‘ç¼–ç¨‹æä¾›çš„å¼ºå¤§å·¥å…·ï¼Œé€‚ç”¨äºå¤„ç†è¶…æ—¶ã€å–æ¶ˆä¿¡å·ä»¥åŠæ•°æ®ä¼ é€’ã€‚ç†è§£å¹¶æ­£ç¡®ä½¿ç”¨ context å¯¹äºç¼–å†™é«˜æ•ˆã€å¯ç»´æŠ¤çš„ Go ç¨‹åºè‡³å…³é‡è¦ã€‚</p><p>å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œä½ èƒ½å¤Ÿå¯¹ <code>context</code> åŒ…æœ‰ä¸€ä¸ªå…¨é¢çš„ç†è§£ï¼Œå¹¶åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> Context </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡IMAPåè®®ä½¿ç”¨Goè¯­è¨€è§£æé‚®ä»¶</title>
      <link href="posts/60016311.html"/>
      <url>posts/60016311.html</url>
      
        <content type="html"><![CDATA[<p>ç”µå­é‚®ä»¶åœ¨ç°ä»£é€šä¿¡ä¸­ä¾ç„¶æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚ä¸ºäº†æå‡é‚®ä»¶å¤„ç†çš„æ•ˆç‡ï¼Œä½¿ç”¨ç¼–ç¨‹è¯­è¨€è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†å˜å¾—å°¤ä¸ºé‡è¦ã€‚</p><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Go è¯­è¨€ä» IMAP æœåŠ¡å™¨è¯»å–é‚®ä»¶ï¼Œè§£æé‚®ä»¶å†…å®¹ï¼Œå¹¶å­˜å‚¨æˆ–å¤„ç†æ‰€éœ€ä¿¡æ¯ã€‚</p><p>è¯´åˆ°é‚®ä»¶æœåŠ¡ï¼Œæˆ‘ä»¬å°±å¾—å…ˆäº†è§£å‡ ä¸ªå’Œé‚®ä»¶ç›¸å…³çš„åè®®ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-POP3-IMAP-SMTP-æœåŠ¡"><a href="#ä»€ä¹ˆæ˜¯-POP3-IMAP-SMTP-æœåŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯ POP3/IMAP/SMTP æœåŠ¡"></a>ä»€ä¹ˆæ˜¯ POP3/IMAP/SMTP æœåŠ¡</h2><ul><li>POP3 ï¼ˆPost Office Protocol - Version 3ï¼‰åè®®ç”¨äºæ”¯æŒä½¿ç”¨ç”µå­é‚®ä»¶å®¢æˆ·ç«¯è·å–å¹¶åˆ é™¤åœ¨æœåŠ¡å™¨ä¸Šçš„ç”µå­é‚®ä»¶ã€‚</li><li>IMAP ï¼ˆInternet Message Access Protocolï¼‰åè®®ç”¨äºæ”¯æŒä½¿ç”¨ç”µå­é‚®ä»¶å®¢æˆ·ç«¯äº¤äº’å¼å­˜å–æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ã€‚</li><li>SMTP ï¼ˆSimple Mail Transfer Protocolï¼‰åè®®ç”¨äºæ”¯æŒä½¿ç”¨ç”µå­é‚®ä»¶å®¢æˆ·ç«¯å‘é€ç”µå­é‚®ä»¶ã€‚</li></ul><h2 id="IMAP-å’Œ-POP-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#IMAP-å’Œ-POP-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="IMAP å’Œ POP æœ‰ä»€ä¹ˆåŒºåˆ«"></a>IMAP å’Œ POP æœ‰ä»€ä¹ˆåŒºåˆ«</h2><p>SMTP åè®®å°±ä¸ç”¨å¤šè¯´äº†ï¼Œä¸“é—¨ç”¨äºå‘é€é‚®ä»¶ï¼Œè¿™ä¸ªåè®®ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹å¼€å‘ä¸­ç”¨çš„æœ€å¤šçš„åè®®ä¹‹ä¸€ã€‚</p><p>POP å…è®¸ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ä¸‹è½½æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ï¼Œä½†æ˜¯ä½ åœ¨ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ä¸Šçš„æ“ä½œï¼ˆå¦‚ï¼šç§»åŠ¨é‚®ä»¶ã€æ ‡è®°å·²è¯»ç­‰ï¼‰ä¸ä¼šåé¦ˆåˆ°æœåŠ¡å™¨ä¸Šçš„ï¼Œæ¯”å¦‚ï¼šä½ é€šè¿‡ç”µå­é‚®ä»¶å®¢æˆ·ç«¯æ”¶å–äº† QQ é‚®ç®±ä¸­çš„ 3 å°é‚®ä»¶å¹¶ç§»åŠ¨åˆ°äº†å…¶ä»–æ–‡ä»¶å¤¹ï¼Œè¿™äº›ç§»åŠ¨åŠ¨ä½œæ˜¯ä¸ä¼šåé¦ˆåˆ°æœåŠ¡å™¨ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒQQ é‚®ç®±æœåŠ¡å™¨ä¸Šçš„è¿™äº›é‚®ä»¶æ˜¯æ²¡æœ‰åŒæ—¶è¢«ç§»åŠ¨çš„ã€‚</p><p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯é€šè¿‡ POP æ”¶å–é‚®ä»¶æ—¶ï¼Œä¹Ÿæ˜¯æœ‰å¯èƒ½åŒæ­¥åˆ é™¤æœåŠ¡ç«¯é‚®ä»¶ã€‚åœ¨ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯è®¾ç½® POP æ—¶ï¼Œè¯·ç•™æ„æ˜¯å¦æœ‰ <strong>ä¿ç•™é‚®ä»¶å‰¯æœ¬/å¤‡ä»½</strong> ç›¸å…³é€‰é¡¹ã€‚<em>å¦‚æœ‰è¯¥é€‰é¡¹ï¼Œä¸”è¦ä¿ç•™æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ï¼Œè¯·å‹¾é€‰è¯¥é€‰é¡¹ã€‚</em></p><p>åœ¨ IMAP åè®®ä¸Šï¼Œç”µå­é‚®ä»¶å®¢æˆ·ç«¯çš„æ“ä½œéƒ½ä¼šåé¦ˆåˆ°æœåŠ¡å™¨ä¸Šï¼Œä½ å¯¹é‚®ä»¶è¿›è¡Œçš„æ“ä½œï¼ˆå¦‚ï¼šç§»åŠ¨é‚®ä»¶ã€æ ‡è®°å·²è¯»ã€åˆ é™¤é‚®ä»¶ç­‰ï¼‰æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ä¹Ÿä¼šåšç›¸åº”çš„åŠ¨ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒIMAP æ˜¯â€œåŒå‘â€çš„ã€‚åŒæ—¶ï¼ŒIMAP å¯ä»¥åªä¸‹è½½é‚®ä»¶çš„ä¸»é¢˜ï¼Œåªæœ‰å½“ä½ çœŸæ­£éœ€è¦çš„æ—¶å€™ï¼Œæ‰ä¼šä¸‹è½½é‚®ä»¶çš„æ‰€æœ‰å†…å®¹ã€‚<strong>åœ¨ POP3 å’Œ IMAP åè®®ä¸Šï¼ŒQQé‚®ç®±æ¨èä½ ä½¿ç”¨IMAPåè®®æ¥å­˜å–æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ã€‚</strong></p><h2 id="æˆæƒç "><a href="#æˆæƒç " class="headerlink" title="æˆæƒç "></a>æˆæƒç </h2><p>åœ¨æˆ‘ä»¬å¼€å‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡å¥½å¯¹åº”é‚®ç®±çš„<strong>æˆæƒç </strong>ï¼Œè¿™ä¸ªæˆæƒç æ˜¯é‚®ç®±ç”¨äºç™»å½•ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯/æœåŠ¡çš„ä¸“ç”¨å¯†ç ï¼Œé€‚ç”¨äºç™»å½•ä»¥ä¸‹æœåŠ¡ï¼šPOP3/IMAP/SMTP/Exchange/CardDAV/CalDAV æœåŠ¡ã€‚</p><p><strong>ä¸åŒçš„é‚®ç®±ä¼šæœ‰ä¸åŒçš„è·å–æ–¹å¼ï¼Œä½†æ˜¯ä¸€èˆ¬è·å–æ–¹å¼éƒ½éå¸¸ç®€å•</strong>ï¼Œå¯ä»¥è‡ªè¡Œé€šè¿‡æœç´¢å¼•æ“æ£€ç´¢ä¸€ä¸‹å³å¯ã€‚</p><p>æ¯”å¦‚ï¼šQQ é‚®ç®±çš„æˆæƒç çš„è·å–æ–¹å¼æ˜¯ï¼š</p><p>åœ¨é‚®ç®±**<a href="https://wx.mail.qq.com/account">å¸å·ä¸å®‰å…¨</a>**ç‚¹å‡»&nbsp;<strong>è®¾å¤‡ç®¡ç† &gt; æˆæƒç ç®¡ç†</strong>ï¼Œå¯¹æˆæƒç è¿›è¡Œç®¡ç†ï¼Œå³å¯è·å¾—ã€‚</p><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>ä»Šå¤©æˆ‘ä»¬å°±é€šè¿‡ Go è¯­è¨€æ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•è§£æé‚®ä»¶ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆä¸‹è½½ç¬¬ä¸‰æ–¹ imap åè®®çš„æ’ä»¶åŒ…ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-v</span> github.com/emersion/go-imap@v1.2.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥ä¸‹æ¥çš„å°±æ˜¯ç¤ºä¾‹ä»£ç ï¼Œå¾ˆå¤šé‡è¦ä¿¡æ¯ï¼Œåœ¨ä»£ç é‡Œéƒ½æœ‰æ³¨é‡Šä¿¡æ¯ï¼Œå› æ­¤è¯·å¤šç•™æ„æ³¨é‡Šï¼š</p><p>ä¸‹é¢çš„ä»£ç é€»è¾‘å¤§è‡´æ˜¯ï¼šè¯»å–æŒ‡å®šé‚®ç®±ä¸­çš„æ”¶ä»¶ç®±é‚®ä»¶ï¼Œæ¯æ¬¡è¯»å– 2 å°é‚®ä»¶ï¼Œå¹¶è§£æå‡ºé‚®ä»¶çš„ä¸»é¢˜ã€æ”¶ä»¶äººã€å‘ä»¶äººã€æ”¶ä»¶æ—¶é—´ã€é‚®ä»¶æ­£æ–‡ï¼Œè¯»å–å®Œæ¯•ä¹‹åï¼Œç»™æ¯å°é‚®ä»¶æ ‡è®°å·²è¯»ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> mail_parse<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"io"</span><span class="token string">"io/ioutil"</span><span class="token string">"log"</span><span class="token string">"strings"</span><span class="token string">"time"</span><span class="token string">"github.com/emersion/go-imap"</span><span class="token string">"github.com/emersion/go-imap/client"</span><span class="token string">"github.com/emersion/go-message/mail"</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">(</span>Addr          <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"imap.qq.com:993"</span>UserName      <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"123456789@qq.com"</span> <span class="token comment">// é‚®ç®±åœ°å€</span>Password      <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">""</span>                 <span class="token comment">// è¿™é‡Œçš„å¯†ç æ˜¯ä½¿ç”¨å¼€å¯ imap åè®®åå¯¹åº”çš„æœåŠ¡å•†ç»™åˆ°çš„å¯†ç ï¼Œä¸æ˜¯é‚®ç®±è´¦å·å¯†ç </span>Folder        <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"INBOX"</span>            <span class="token comment">// é‚®ç®±æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ï¼š INBOX æ”¶ä»¶ç®±ã€Sent Messages å‘ä»¶ç®±ã€Drafts è‰ç¨¿ç®±ã€Trashã€Junk åƒåœ¾ç®±</span>ReadBatchSize <span class="token builtin">int</span>    <span class="token operator">=</span> <span class="token number">2</span>                  <span class="token comment">// æ¯æ¬¡è¯»å–çš„é‚®ä»¶æ•°é‡</span><span class="token punctuation">)</span><span class="token comment">// IMAPï¼ˆInternet Message Access Protocolï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨äº’è”ç½‘ä¸Šè®¿é—®ç”µå­é‚®ä»¶çš„åè®®ã€‚</span><span class="token comment">// å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ Internet è®¿é—®ä»–ä»¬åœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„ç”µå­é‚®ä»¶ã€‚</span><span class="token comment">// Go è¯­è¨€çš„ go-imap åº“æ˜¯ä¸€ä¸ªç”¨äºä» IMAP æœåŠ¡å™¨è·å–ç”µå­é‚®ä»¶çš„åº“ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨ Go ä»£ç ä¸­è®¿é—® IMAP åè®®</span><span class="token keyword">func</span> <span class="token function">ReadEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹è¿æ¥æœåŠ¡å™¨"</span><span class="token punctuation">)</span><span class="token comment">// å»ºç«‹ä¸ IMAP æœåŠ¡å™¨çš„è¿æ¥</span>c<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">DialTLS</span><span class="token punctuation">(</span>Addr<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥ IMAP æœåŠ¡å™¨å¤±è´¥: %+v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token comment">// æœ€åä¸€å®šä¸è¦å¿˜è®°é€€å‡ºç™»å½•</span><span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// ç™»å½•</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Login</span><span class="token punctuation">(</span>UserName<span class="token punctuation">,</span> Password<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"é‚®ç®±[%s] ç™»å½•å¤±è´¥: %v \n"</span><span class="token punctuation">,</span> Addr<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"é‚®ç®±[%s] ç™»å½•æˆåŠŸï¼\n"</span><span class="token punctuation">,</span> UserName<span class="token punctuation">)</span><span class="token comment">// åˆ—å‡ºå½“å‰é‚®ç®±ä¸­çš„æ–‡ä»¶å¤¹</span>mailboxes <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token operator">*</span>imap<span class="token punctuation">.</span>MailboxInfo<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>done <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// è®°å½•é”™è¯¯çš„ chan</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>done <span class="token operator">&lt;-</span> c<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> mailboxes<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"--&gt;å½“å‰é‚®ç®±çš„æ–‡ä»¶å¤¹ Mailboxes:"</span><span class="token punctuation">)</span><span class="token keyword">var</span> folderExists <span class="token builtin">bool</span><span class="token keyword">for</span> m <span class="token operator">:=</span> <span class="token keyword">range</span> mailboxes <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"* "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token keyword">if</span> m<span class="token punctuation">.</span>Name <span class="token operator">==</span> Folder <span class="token punctuation">{</span>folderExists <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ—å‡ºé‚®ç®±åˆ—è¡¨æ—¶ï¼Œå‡ºç°é”™è¯¯ï¼š%v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"--&gt;åˆ—å‡ºé‚®ç®±åˆ—è¡¨å®Œæ¯•ï¼"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token operator">!</span>folderExists <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶å¤¹[%s] ä¸å­˜åœ¨ \n"</span><span class="token punctuation">,</span> Folder<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// é€‰æ‹©æŒ‡å®šçš„æ–‡ä»¶å¤¹</span>mbox<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>Folder<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"é€‰æ‹©é‚®ä»¶ç®±å¤±è´¥: %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"mbox %+v \n"</span><span class="token punctuation">,</span> mbox<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ–‡ä»¶å¤¹[%s]ä¸­ï¼Œæ€»å…±æœ‰ %d å°é‚®ä»¶ \n"</span><span class="token punctuation">,</span> Folder<span class="token punctuation">,</span> mbox<span class="token punctuation">.</span>Messages<span class="token punctuation">)</span><span class="token keyword">if</span> mbox<span class="token punctuation">.</span>Messages <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ–‡ä»¶å¤¹[%s]ä¸­æ²¡æœ‰é‚®ä»¶"</span><span class="token punctuation">,</span> Folder<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// åˆ›å»ºä¸€ä¸ªåºåˆ—é›†ï¼Œç”¨äºæ‰¹é‡è¯»å–é‚®ä»¶</span>seqset <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>imap<span class="token punctuation">.</span>SeqSet<span class="token punctuation">)</span><span class="token comment">// å‡è®¾éœ€è¦è·å–æœ€å4å°é‚®ä»¶æ—¶</span><span class="token comment">// from := uint32(1)</span><span class="token comment">// to := mbox.Messages // æ­¤æ–‡ä»¶ä¸‹çš„é‚®ä»¶æ€»æ•°</span><span class="token comment">// if mbox.Messages &gt; 3 {</span><span class="token comment">// from = mbox.Messages - 3</span><span class="token comment">// }</span><span class="token comment">// seqset.AddRange(from, to) // æ·»åŠ æŒ‡å®šèŒƒå›´å†…çš„é‚®ä»¶ç¼–å·</span><span class="token comment">// æœç´¢æŒ‡å®šçŠ¶æ€çš„é‚®ä»¶</span>criteria <span class="token operator">:=</span> imap<span class="token punctuation">.</span><span class="token function">NewSearchCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span>criteria<span class="token punctuation">.</span>WithoutFlags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>imap<span class="token punctuation">.</span>SeenFlag<span class="token punctuation">}</span> <span class="token comment">// æœªè¯»é‚®ä»¶æ ‡è®°</span><span class="token comment">// criteria.WithFlags = []string{imap.SeenFlag} // å·²è¯»é‚®ä»¶æ ‡è®°</span>uids<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token comment">// åœ¨è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ UidSearch æ–¹æ³•ï¼Œä½†æ˜¯ç”¨äº† UidSearch æ–¹æ³•åï¼Œä¸‹é¢çš„å¾ˆå¤šæ–¹æ³•éƒ½éœ€è¦ä½¿ç”¨ Uid å¼€å¤´çš„æ–¹æ³•</span><span class="token comment">// ä¹Ÿå°±æ˜¯è¯´ Fetch -&gt; UidFetchï¼ŒStore -&gt; UidStoreï¼ŒCopy -&gt; UidCopyï¼ŒMove -&gt; UidMoveï¼ŒSearch -&gt; UidSearch</span><span class="token comment">// uids, err := c.UidSearch(criteria)</span><span class="token comment">// å…³äº Store æ–¹æ³•å’Œ UidStore æ–¹æ³•</span><span class="token comment">// Store å’Œ UidStore æ–¹æ³•éƒ½æ˜¯ç”¨äºåœ¨ IMAP ä¸­æ›´æ–°é‚®ä»¶æ ‡å¿—çš„ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ï¼š</span><span class="token comment">//</span><span class="token comment">// Storeï¼šä½¿ç”¨çš„æ˜¯æ¶ˆæ¯åºåˆ—å·ï¼ˆmessage sequence numberï¼‰æ¥æ ‡è¯†é‚®ä»¶ã€‚åºåˆ—å·æ˜¯åŠ¨æ€çš„ï¼Œæ¯æ¬¡é‚®ä»¶åˆ é™¤æˆ–æ·»åŠ æ—¶ï¼Œåºåˆ—å·å¯èƒ½ä¼šæ”¹å˜ã€‚åºåˆ—å·ä»1å¼€å§‹ï¼ŒæŒ‰é‚®ä»¶åœ¨é‚®ç®±ä¸­çš„ä½ç½®è¿›è¡Œæ’åºã€‚</span><span class="token comment">// UidStoreï¼šä½¿ç”¨çš„æ˜¯æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUIDï¼‰æ¥æ ‡è¯†é‚®ä»¶ã€‚UID æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå› ä¸ºé‚®ä»¶çš„æ·»åŠ æˆ–åˆ é™¤è€Œæ”¹å˜ï¼Œé€‚åˆäºéœ€è¦ç¡®ä¿å”¯ä¸€æ ‡è¯†é‚®ä»¶çš„æ“ä½œã€‚</span><span class="token comment">// åœ¨æ ‡è®°ä¸ºå·²è¯»æ—¶ï¼Œä½¿ç”¨ UidStore æ–¹æ³•æ›´ä¸ºå®‰å…¨å’Œå¯é ï¼Œå› ä¸ºå®ƒä½¿ç”¨é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥é¿å…ç”±äºåºåˆ—å·å˜åŒ–å¯¼è‡´çš„æ½œåœ¨é—®é¢˜ã€‚</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"æœç´¢é‚®ä»¶æ—¶å‡ºç°é”™è¯¯ï¼š%v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æœç´¢åˆ°çš„é‚®ä»¶ uids: %+v \n"</span><span class="token punctuation">,</span> uids<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>uids<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰æœç´¢åˆ°é‚®ä»¶"</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æœç´¢åˆ°çš„é‚®ä»¶æ€»å…±æœ‰ %v å° %+v \n"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>uids<span class="token punctuation">)</span><span class="token punctuation">,</span> uids<span class="token punctuation">)</span><span class="token comment">// è·å–æ•´ä¸ªæ¶ˆæ¯æ­£æ–‡</span><span class="token comment">// imap.FetchEnvelopeï¼šè¯·æ±‚è·å–é‚®ä»¶çš„ä¿¡å°æ•°æ®ï¼ˆä¾‹å¦‚å‘ä»¶äººã€æ”¶ä»¶äººã€ä¸»é¢˜ç­‰å…ƒæ•°æ®ï¼‰ã€‚</span><span class="token comment">// imap.FetchRFC822ï¼šè¯·æ±‚è·å–å®Œæ•´çš„é‚®ä»¶å†…å®¹ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¤´éƒ¨å’Œæ­£æ–‡ã€‚</span>items <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>imap<span class="token punctuation">.</span>FetchItem<span class="token punctuation">{</span>imap<span class="token punctuation">.</span>FetchFlags<span class="token punctuation">,</span> imap<span class="token punctuation">.</span>FetchEnvelope<span class="token punctuation">,</span> imap<span class="token punctuation">.</span>FetchRFC822<span class="token punctuation">}</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> uidsCount <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>uids<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> uidsCount<span class="token punctuation">;</span> i <span class="token operator">+=</span> ReadBatchSize <span class="token punctuation">{</span><span class="token comment">// æ¸…ç©ºåºåˆ—é›†ä¸­çš„æ‰€æœ‰é‚®ä»¶ç¼–å·ï¼Œä»¥ä¾¿æ·»åŠ æ–°çš„é‚®ä»¶ç¼–å·ã€‚æ¯æ¬¡å¾ªç¯å¼€å§‹æ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œç¡®ä¿åºåˆ—é›†ä¸­åªæœ‰å½“å‰æ‰¹æ¬¡çš„é‚®ä»¶ç¼–å·</span>seqset<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// æ·»åŠ ä¸€æ‰¹é‚®ä»¶åˆ°åºåˆ—é›†ä¸­</span><span class="token keyword">if</span> i<span class="token operator">+</span>ReadBatchSize <span class="token operator">&lt;</span> uidsCount <span class="token punctuation">{</span>seqset<span class="token punctuation">.</span><span class="token function">AddNum</span><span class="token punctuation">(</span>uids<span class="token punctuation">[</span>i <span class="token punctuation">:</span> i<span class="token operator">+</span>ReadBatchSize<span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// æ·»åŠ æŒ‡å®šèŒƒå›´å†…çš„é‚®ä»¶ç¼–å·</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>seqset<span class="token punctuation">.</span><span class="token function">AddNum</span><span class="token punctuation">(</span>uids<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// æ·»åŠ å‰©ä½™çš„é‚®ä»¶ç¼–å·</span><span class="token punctuation">}</span><span class="token comment">// è·å–é‚®ä»¶å†…å®¹ Start</span>messages <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token operator">*</span>imap<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> ReadBatchSize<span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œç”¨äºæ¥æ”¶é‚®ä»¶æ¶ˆæ¯</span>fetchDone <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>                    <span class="token comment">// åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œç”¨äºæ¥æ”¶é”™è¯¯æ¶ˆæ¯</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// Fetchæ–¹æ³•ç”¨äºä»æœåŠ¡å™¨è·å–é‚®ä»¶æ•°æ®ï¼Œè¿™é‡Œè¯·æ±‚äº†é‚®ä»¶çš„ä¿¡å°å’Œå®Œæ•´å†…å®¹</span>fetchDone <span class="token operator">&lt;-</span> c<span class="token punctuation">.</span><span class="token function">Fetch</span><span class="token punctuation">(</span>seqset<span class="token punctuation">,</span> items<span class="token punctuation">,</span> messages<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹è¯»å–é‚®ä»¶å†…å®¹"</span><span class="token punctuation">)</span><span class="token keyword">for</span> msg <span class="token operator">:=</span> <span class="token keyword">range</span> messages <span class="token punctuation">{</span><span class="token function">readEveryMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>fetchDone<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è·å–é‚®ä»¶ä¿¡æ¯å‡ºç°é”™è¯¯ï¼š%v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// è·å–é‚®ä»¶å†…å®¹ End</span><span class="token comment">// ç»™é‚®ä»¶æ‰“æ ‡è®° Start</span>item <span class="token operator">:=</span> imap<span class="token punctuation">.</span><span class="token function">FormatFlagsOp</span><span class="token punctuation">(</span>imap<span class="token punctuation">.</span>AddFlags<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// æ ‡è®°ä¸ºå·²è¯»</span><span class="token comment">// item := imap.FormatFlagsOp(imap.RemoveFlags, true) // æ ‡è®°ä¸ºæœªè¯»</span>flags <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>imap<span class="token punctuation">.</span>SeenFlag<span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å³å°†ç»™è¿™äº›é‚®ä»¶ [%s] æ‰“æ ‡è®° \n"</span><span class="token punctuation">,</span> seqset<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span>seqset<span class="token punctuation">,</span> item<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"ç»™é‚®ä»¶æ‰“æ ‡è®°å¤±è´¥ï¼š%v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ç»™é‚®ä»¶æ‰“æ ‡è®° End</span>time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// ä¼‘çœ 10ç§’</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"è¯»å–äº†æ‰€æœ‰é‚®ä»¶ï¼Œå®Œæ¯•ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// document link: https://github.com/emersion/go-imap/wiki/Fetching-messages</span><span class="token keyword">func</span> <span class="token function">readEveryMsg</span><span class="token punctuation">(</span>msg <span class="token operator">*</span>imap<span class="token punctuation">.</span>Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æ¯ä¸€å°é‚®ä»¶çš„æ¶ˆæ¯åºåˆ—å· %+v \n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>SeqNum<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"-------------------------"</span><span class="token punctuation">)</span><span class="token comment">// è·å–é‚®ä»¶æ­£æ–‡</span>r <span class="token operator">:=</span> msg<span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>imap<span class="token punctuation">.</span>BodySectionName<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> r <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡å™¨æ²¡æœ‰è¿”å›æ¶ˆæ¯å†…å®¹"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>mr<span class="token punctuation">,</span> err <span class="token operator">:=</span> mail<span class="token punctuation">.</span><span class="token function">CreateReader</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"é‚®ä»¶è¯»å–æ—¶å‡ºç°é”™è¯¯ï¼š %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> date<span class="token punctuation">,</span> err <span class="token operator">:=</span> mr<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æ”¶ä»¶æ—¶é—´ Date:"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> from<span class="token punctuation">,</span> err <span class="token operator">:=</span> mr<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">AddressList</span><span class="token punctuation">(</span><span class="token string">"From"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"å‘ä»¶äºº From:"</span><span class="token punctuation">,</span> from<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> to<span class="token punctuation">,</span> err <span class="token operator">:=</span> mr<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">AddressList</span><span class="token punctuation">(</span><span class="token string">"To"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æ”¶ä»¶äºº To:"</span><span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> subject<span class="token punctuation">,</span> err <span class="token operator">:=</span> mr<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"é‚®ä»¶ä¸»é¢˜ Subject:"</span><span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æŠ„é€ Cc: %+v \n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Envelope<span class="token punctuation">.</span>Cc<span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">{</span>p<span class="token punctuation">,</span> err <span class="token operator">:=</span> mr<span class="token punctuation">.</span><span class="token function">NextPart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span><span class="token keyword">break</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è¯»å–é‚®ä»¶å†…å®¹æ—¶å‡ºç°é”™è¯¯ï¼š%v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">switch</span> h <span class="token operator">:=</span> p<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">case</span> <span class="token operator">*</span>mail<span class="token punctuation">.</span>InlineHeader<span class="token punctuation">:</span><span class="token comment">// è¿™æ˜¯æ¶ˆæ¯çš„æ–‡æœ¬ï¼ˆå¯ä»¥æ˜¯çº¯æ–‡æœ¬æˆ– HTMLï¼‰</span>contentType <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> <span class="token string">"text/plain"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å¾—åˆ°æ­£æ–‡ -&gt; TEXT: %v \n"</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> <span class="token string">"text/html"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å¾—åˆ°æ­£æ–‡ -&gt; HTML: %v \n"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">break</span><span class="token keyword">case</span> <span class="token operator">*</span>mail<span class="token punctuation">.</span>AttachmentHeader<span class="token punctuation">:</span><span class="token comment">// è¿™æ˜¯ä¸€ä¸ªé™„ä»¶</span>filename<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">Filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å¾—åˆ°é™„ä»¶: %v \n"</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">}</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ä¸€å°é‚®ä»¶è¯»å–å®Œæ¯•"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"------------------------- \n\n"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å€¼å¾—ä¸€æ"><a href="#å€¼å¾—ä¸€æ" class="headerlink" title="å€¼å¾—ä¸€æ"></a>å€¼å¾—ä¸€æ</h2><p>éœ€è¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç»™é‚®ä»¶æ ‡è®°å·²è¯»æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯ <code>Store</code> æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>UidStore</code> æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><h3 id="å…³äº-Store-æ–¹æ³•å’Œ-UidStore-æ–¹æ³•"><a href="#å…³äº-Store-æ–¹æ³•å’Œ-UidStore-æ–¹æ³•" class="headerlink" title="å…³äº Store æ–¹æ³•å’Œ UidStore æ–¹æ³•"></a>å…³äº Store æ–¹æ³•å’Œ UidStore æ–¹æ³•</h3><p><code>Store</code> å’Œ <code>UidStore</code> æ–¹æ³•éƒ½æ˜¯ç”¨äºåœ¨ IMAP ä¸­æ›´æ–°é‚®ä»¶æ ‡å¿—çš„ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ï¼š</p><p><strong>Store</strong>ï¼šä½¿ç”¨çš„æ˜¯æ¶ˆæ¯åºåˆ—å·ï¼ˆmessage sequence numberï¼‰æ¥æ ‡è¯†é‚®ä»¶ã€‚åºåˆ—å·æ˜¯åŠ¨æ€çš„ï¼Œæ¯æ¬¡é‚®ä»¶åˆ é™¤æˆ–æ·»åŠ æ—¶ï¼Œåºåˆ—å·å¯èƒ½ä¼šæ”¹å˜ã€‚åºåˆ—å·ä»1å¼€å§‹ï¼ŒæŒ‰é‚®ä»¶åœ¨é‚®ç®±ä¸­çš„ä½ç½®è¿›è¡Œæ’åºã€‚</p><p><strong>UidStore</strong>ï¼šä½¿ç”¨çš„æ˜¯æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUIDï¼‰æ¥æ ‡è¯†é‚®ä»¶ã€‚UID æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå› ä¸ºé‚®ä»¶çš„æ·»åŠ æˆ–åˆ é™¤è€Œæ”¹å˜ï¼Œé€‚åˆäºéœ€è¦ç¡®ä¿å”¯ä¸€æ ‡è¯†é‚®ä»¶çš„æ“ä½œã€‚</p><p>åœ¨æ ‡è®°ä¸ºå·²è¯»æ—¶ï¼Œä½¿ç”¨ <code>UidStore</code> æ–¹æ³•æ›´ä¸ºå®‰å…¨å’Œå¯é ï¼Œå› ä¸ºå®ƒä½¿ç”¨é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥é¿å…ç”±äºåºåˆ—å·å˜åŒ–å¯¼è‡´çš„æ½œåœ¨é—®é¢˜ã€‚ä½†æ˜¯ç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œå‘ç°ä½¿ç”¨ <code>Store</code> æ–¹æ³•ä¹Ÿæ²¡å•¥å¤ªå¤§çš„é—®é¢˜ï¼Œä½†æ˜¯<strong>ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦é…å¥—ä½¿ç”¨</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¦æ˜¯ä½ ä½¿ç”¨äº† <code>Uid</code> å¼€å¤´çš„æ–¹æ³•æ—¶ï¼Œå¾ˆå¤šæ–¹æ³•ä½ éƒ½éœ€è¦æ”¹æˆ <code>Uid</code> å¼€å¤´çš„æ–¹æ³•æ‰èƒ½æœ‰æ•ˆä½¿ç”¨</strong>ï¼Œæ¯”å¦‚ï¼š Fetch -&gt; UidFetchï¼ŒStore -&gt; UidStoreï¼ŒCopy -&gt; UidCopyï¼ŒMove -&gt; UidMoveï¼ŒSearch -&gt; UidSearchã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›æ„æ–™ä¹‹å¤–çš„äº‹æƒ…å‘ç”Ÿã€‚è¿™æ˜¯æˆ‘çœ‹æ–‡æ¡£ä»¥åŠè‡ªå·±æ‘¸ç´¢å¾—å‡ºæ¥çš„ç»“è®ºï¼Œå¦‚æœä½ è§‰å¾—æˆ‘ç†è§£çš„ä¸å¯¹ï¼Œä¹Ÿå¯ä»¥äºˆä»¥çº æ­£ã€‚</p><p>å¥½äº†ï¼ŒèŠåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå°±ç»“æŸäº†ã€‚æœ¬æ–‡ä¸»è¦è¿˜æ˜¯ä»¥ä»£ç ä¸ºä¸»ï¼Œæ¯•ç«Ÿæ²¡æœ‰ä»€ä¹ˆæ¯”å‡ è¡Œä»£ç æ¥å¾—å¹²è„†äº†ã€‚ä¸è¿‡ï¼Œå¯ä¸è¦å°†ä¸Šé¢çš„ä»£ç ç›´æ¥æ”¾åˆ°é¡¹ç›®ä¸­è·‘å‘€ï¼Œæ”¾åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­è¿˜æ˜¯éœ€è¦ç¨ä½œè°ƒæ•´çš„ï¼Œä¸Šé¢ä»£ç åªæ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘åœ¨æœ¬åœ°è°ƒè¯•ï¼Œå› æ­¤æ‰æœ‰å¤§æ‰¹é‡çš„ log è¾“å‡ºã€‚</p><p>å¦‚æœåˆšå¥½ä½ ä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥å¸®å¾—åˆ°ä½ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> IMAP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å€ŸåŠ©Rediså·§å¦™çš„ç®¡ç†ç”¨æˆ·ç­¾åˆ°ï¼Ÿâ€”â€”Bitmapç¯‡</title>
      <link href="posts/fe86d4b2.html"/>
      <url>posts/fe86d4b2.html</url>
      
        <content type="html"><![CDATA[<p>æ•°æ®ç®¡ç†å’Œåˆ†ææ˜¯ä»»ä½•å¤§å°é¡¹ç›®çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨ç®¡ç†å¦‚ç”¨æˆ·ç­¾åˆ°æ•°æ®è¿™ç±»ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸è¿½æ±‚çš„æ˜¯é«˜æ•ˆæ€§å’Œå­˜å‚¨èŠ‚çœã€‚</p><p>ä»Šå¤©ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ä¸€ç§æ—¢èŠ‚çœç©ºé—´åˆé«˜æ•ˆçš„æ•°æ®ç®¡ç†æ–¹æ³•â€”â€”Redis çš„ä½æ“ä½œï¼ˆBit operationsï¼‰ã€‚</p><h2 id="Redis-ä½æ“ä½œç®€ä»‹"><a href="#Redis-ä½æ“ä½œç®€ä»‹" class="headerlink" title="Redis ä½æ“ä½œç®€ä»‹"></a>Redis ä½æ“ä½œç®€ä»‹</h2><p>Redisï¼Œä½œä¸ºä¸€ç§é«˜æ€§èƒ½çš„é”®å€¼å¯¹å­˜å‚¨ç³»ç»Ÿï¼Œæä¾›äº†ä¸°å¯Œçš„æ•°æ®æ“ä½œæŒ‡ä»¤ï¼Œå…¶ä¸­ä½æ“ä½œæŒ‡ä»¤ï¼ˆBit operationsï¼‰å…è®¸æˆ‘ä»¬ç›´æ¥åœ¨å­—ç¬¦ä¸²ç±»å‹çš„å€¼ä¸Šæ‰§è¡Œä½çº§æ“ä½œï¼Œè¿™ç§æ–¹å¼éå¸¸é€‚åˆå¤„ç†å¦‚ç”¨æˆ·ç­¾åˆ°ç­‰åœºæ™¯ï¼Œå®ƒå¯ä»¥ä»¥æå°çš„å­˜å‚¨ç©ºé—´æ¥è¡¨ç¤ºå¤§é‡çš„ç”¨æˆ·ç­¾åˆ°ä¿¡æ¯ã€‚</p><h3 id="ç†è§£ä½æ“ä½œ"><a href="#ç†è§£ä½æ“ä½œ" class="headerlink" title="ç†è§£ä½æ“ä½œ"></a>ç†è§£ä½æ“ä½œ</h3><p>ä½ï¼ˆBitï¼‰æ˜¯è®¡ç®—æœºå­˜å‚¨çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªä½è¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆæ˜¯ 1ã€‚å½“æˆ‘ä»¬å°†ç”¨æˆ·çš„ç­¾åˆ°ä¿¡æ¯ä»¥ä½å½¢å¼å­˜å‚¨æ—¶ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ¯”ç‰¹ä½æ¥è¡¨ç¤ºç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°ï¼Œå…¶ä¸­ 1 è¡¨ç¤ºç­¾åˆ°ï¼Œ0 è¡¨ç¤ºæœªç­¾åˆ°ã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><h4 id="è®°å½•ç”¨æˆ·ç­¾åˆ°"><a href="#è®°å½•ç”¨æˆ·ç­¾åˆ°" class="headerlink" title="è®°å½•ç”¨æˆ·ç­¾åˆ°"></a>è®°å½•ç”¨æˆ·ç­¾åˆ°</h4><p>å‡è®¾æˆ‘ä»¬éœ€è¦è®°å½•ç”¨æˆ· 8 åœ¨æŸæœˆçš„ç­¾åˆ°æƒ…å†µï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™è¡¨ç¤ºæˆ‘ä»¬å°†ç”¨æˆ· 8 åœ¨è¿™ä¸ªæœˆçš„ç¬¬ä¸€å¤©æ ‡è®°ä¸ºç­¾åˆ°ã€‚åœ¨ Redis ä¸­ï¼Œ<code>setbit</code> å‘½ä»¤æ˜¯ç”¨æ¥åœ¨æŒ‡å®šçš„ä½ä¸Šè®¾ç½®å€¼çš„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½çš„åç§»é‡ï¼ˆè¡¨ç¤ºç¬¬å‡ å¤©ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦è®¾ç½®çš„å€¼ï¼ˆ1æˆ–0ï¼‰ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å†å†™å…¥ä¸€äº›æµ‹è¯•æ•°æ®ï¼Œæ–¹ä¾¿åé¢æˆ‘ä»¬æŸ¥è¯¢ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">2</span> <span class="token number">0</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">3</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">3</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">4</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">5</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">6</span> <span class="token number">1</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">7</span> <span class="token number">0</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:8:sign <span class="token number">8</span> <span class="token number">0</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit user:9:sign <span class="token number">1</span> <span class="token number">0</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æŸ¥è¯¢ç”¨æˆ·ç­¾åˆ°æƒ…å†µ"><a href="#æŸ¥è¯¢ç”¨æˆ·ç­¾åˆ°æƒ…å†µ" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·ç­¾åˆ°æƒ…å†µ"></a>æŸ¥è¯¢ç”¨æˆ·ç­¾åˆ°æƒ…å†µ</h4><p>å¦‚æœæˆ‘ä»¬æƒ³æŸ¥è¯¢ç”¨æˆ· 8 åœ¨è¿™ä¸ªæœˆçš„ç¬¬ 4 å¤©æ˜¯å¦ç­¾åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>getbit</code> å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getbit user:8:sign <span class="token number">4</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿”å›å€¼ <code>1</code> è¡¨æ˜ç”¨æˆ·åœ¨è¿™ä¸€å¤©ç­¾åˆ°äº†ã€‚</p><h4 id="ç»Ÿè®¡ç­¾åˆ°å¤©æ•°"><a href="#ç»Ÿè®¡ç­¾åˆ°å¤©æ•°" class="headerlink" title="ç»Ÿè®¡ç­¾åˆ°å¤©æ•°"></a>ç»Ÿè®¡ç­¾åˆ°å¤©æ•°</h4><p>è¦ç»Ÿè®¡æŸç”¨æˆ·åœ¨è¿™ä¸ªæœˆç­¾åˆ°äº†å‡ å¤©ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>bitcount</code> å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount user:8:sign<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™é‡Œè¿”å›çš„ <code>5</code> è¡¨ç¤ºç”¨æˆ· 8 åœ¨è¿™ä¸ªæœˆå·²ç»ç­¾åˆ°äº† 5 å¤©ã€‚</p><h2 id="ä¸€äº›æ³¨æ„äº‹é¡¹"><a href="#ä¸€äº›æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸€äº›æ³¨æ„äº‹é¡¹"></a>ä¸€äº›æ³¨æ„äº‹é¡¹</h2><ul><li><strong>å­˜å‚¨æ•ˆç‡</strong>ï¼šä½¿ç”¨ä½æ“ä½œå­˜å‚¨è¿™ç±»ä¿¡æ¯éå¸¸èŠ‚çœç©ºé—´ï¼Œæ¯ä¸ªæœˆçš„ç­¾åˆ°æ•°æ®åªéœ€è¦å‡ åä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</li><li><strong>æ“ä½œæ€§èƒ½</strong>ï¼šä½æ“ä½œå‘½ä»¤æ‰§è¡Œé€Ÿåº¦æå¿«ï¼Œé€‚åˆé«˜é¢‘æ¬¡çš„æ•°æ®æ›´æ–°å’ŒæŸ¥è¯¢æ“ä½œã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šé™¤äº† <code>setbit</code> å’Œ <code>getbit</code>ï¼ŒRedis è¿˜æä¾›äº†å¦‚ <code>bitop</code> è¿™æ ·çš„å‘½ä»¤ï¼Œç”¨äºå¯¹å¤šä¸ªé”®çš„ä½è¿›è¡Œé€»è¾‘æ“ä½œï¼Œéå¸¸çµæ´»ã€‚</li></ul><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>é™¤äº†ç”¨æˆ·ç­¾åˆ°å¤–ï¼ŒRedis çš„ä½æ“ä½œè¿˜å¯ä»¥ç”¨äºï¼š</p><ul><li>ç”¨æˆ·ç‰¹å¾æ ‡è®°ï¼Œå¦‚è®°å½•ç”¨æˆ·çš„å–œå¥½ã€è¡Œä¸ºç‰¹æ€§ç­‰ã€‚</li><li>ç³»ç»ŸåŠŸèƒ½çš„å¼€å…³çŠ¶æ€ï¼Œå¦‚åŠŸèƒ½æ˜¯å¦å¯ç”¨ã€æ˜¯å¦å…·æœ‰æŸç§æƒé™ç­‰ã€‚</li><li>åœ¨çº¿çŠ¶æ€è¿½è¸ªï¼Œå¦‚æ ‡è®°ç”¨æˆ·çš„åœ¨çº¿æˆ–ç¦»çº¿çŠ¶æ€ã€‚</li></ul><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Redis çš„ä½æ“ä½œæ˜¯å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ä¸­çš„äºŒè¿›åˆ¶æ•°æ®æ—¶çš„ä¸€ç§é«˜æ•ˆæ‰‹æ®µã€‚å®ƒä¸ä»…èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”æä¾›äº†æé«˜çš„æ•°æ®æ“ä½œæ€§èƒ½ã€‚å¯¹äºéœ€è¦å¤§é‡ä½çº§æ•°æ®ç®¡ç†çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚ç”¨æˆ·ç­¾åˆ°ã€åœ¨çº¿çŠ¶æ€è¿½è¸ªç­‰ï¼ŒRedis çš„ä½æ“ä½œæ— ç–‘æ˜¯ä¸€ä¸ªä¼˜ç§€çš„é€‰æ‹©ã€‚</p><p>å¸Œæœ›é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œä½ èƒ½å¯¹ Redis çš„ä½æ“ä½œæœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¹¶èƒ½åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­åŠ ä»¥åº”ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å€ŸåŠ©Redisæ›´é«˜æ•ˆç»Ÿè®¡UVï¼Ÿâ€”â€”Hyperloglogç¯‡</title>
      <link href="posts/ceb09f0b.html"/>
      <url>posts/ceb09f0b.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä»Šå¤©çš„äº’è”ç½‘æ—¶ä»£ï¼Œæ•°æ®å¦‚æ½®æ°´èˆ¬æ±¹æ¶Œè€Œæ¥ã€‚ä»ç”¨æˆ·è¡Œä¸ºæ•°æ®ã€ç³»ç»Ÿæ—¥å¿—åˆ°å®æ—¶äº¤äº’æ•°æ®ï¼Œå¦‚ä½•é«˜æ•ˆã€å‡†ç¡®åœ°ç»Ÿè®¡è¿™æµ·é‡æ•°æ®ä¸­çš„å”¯ä¸€å…ƒç´ æ•°é‡ï¼Œæˆä¸ºäº†ä¸€ä¸ªä¸å°çš„æŒ‘æˆ˜ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬è¦ä¸€èµ·æ¢ç´¢çš„æ˜¯ Redis ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§ä½†å¯èƒ½è¢«å¿½è§†çš„æ•°æ®ç±»å‹â€”â€”HyperLogLogï¼Œå®ƒå¦‚ä½•åœ¨ç‰ºç‰²æå°‘çš„å‡†ç¡®åº¦å‰æä¸‹ï¼Œå®ç°å¯¹å¤§è§„æ¨¡æ•°æ®é›†çš„å¿«é€Ÿå»é‡è®¡æ•°ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-HyperLogLogï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-HyperLogLogï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ HyperLogLogï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ HyperLogLogï¼Ÿ</h2><p>HyperLogLog æ˜¯ä¸€ç§ç”¨äºåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒåŸºæ•°æŒ‡çš„æ˜¯<strong>ä¸€ä¸ªé›†åˆä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡</strong>ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬é¢å¯¹æ•°äº¿çº§åˆ«çš„æ•°æ®æ—¶ï¼Œä¼ ç»Ÿçš„å»é‡ç»Ÿè®¡æ–¹æ³•ä¸ä»…è®¡ç®—é‡å¤§ï¼Œè€Œä¸”æ¶ˆè€—å¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚HyperLogLog åˆ™ä»¥ä¸€ç§éå¸¸èŠ‚çœç©ºé—´çš„æ–¹å¼ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®ƒçš„è®¡ç®—ç»“æœæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œä½†æ˜¯å‡†ç¡®ç‡éå¸¸é«˜ï¼Œé€šå¸¸**è¯¯å·®ç‡ä»…ä¸º 0.81%**ã€‚</p><h2 id="ä½¿ç”¨-Redis-çš„-HyperLogLog-å®ç°å»é‡è®¡æ•°"><a href="#ä½¿ç”¨-Redis-çš„-HyperLogLog-å®ç°å»é‡è®¡æ•°" class="headerlink" title="ä½¿ç”¨ Redis çš„ HyperLogLog å®ç°å»é‡è®¡æ•°"></a>ä½¿ç”¨ Redis çš„ HyperLogLog å®ç°å»é‡è®¡æ•°</h2><h3 id="æ·»åŠ å…ƒç´ ï¼špfadd"><a href="#æ·»åŠ å…ƒç´ ï¼špfadd" class="headerlink" title="æ·»åŠ å…ƒç´ ï¼špfadd"></a>æ·»åŠ å…ƒç´ ï¼špfadd</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å‘ HyperLogLog ä¸­æ·»åŠ å…ƒç´ ã€‚Redis æä¾›äº† <code>pfadd</code> å‘½ä»¤ç”¨äºæ·»åŠ å…ƒç´ åˆ° HyperLogLog ä¸­ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd p1 a b c d e f g<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸ƒä¸ªå…ƒç´ ï¼ˆa, b, c, d, e, f, gï¼‰åˆ° HyperLogLog p1 ä¸­ã€‚è¿”å›å€¼ <code>(integer) 1</code> è¡¨ç¤ºæ“ä½œæˆåŠŸã€‚</p><h3 id="ç»Ÿè®¡å…ƒç´ æ•°é‡ï¼špfcount"><a href="#ç»Ÿè®¡å…ƒç´ æ•°é‡ï¼špfcount" class="headerlink" title="ç»Ÿè®¡å…ƒç´ æ•°é‡ï¼špfcount"></a>ç»Ÿè®¡å…ƒç´ æ•°é‡ï¼špfcount</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>pfcount</code> å‘½ä»¤æ¥è·å– HyperLogLog ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount p1<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>pfcount p1</code>ï¼Œæˆ‘ä»¬å¾—çŸ¥ HyperLogLog p1 ä¸­æœ‰ä¸ƒä¸ªå”¯ä¸€å…ƒç´ ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰æ·»åŠ çš„å…ƒç´ æ•°é‡ä¸€è‡´ã€‚</p><h3 id="åˆå¹¶-HyperLogLogï¼špfmerge"><a href="#åˆå¹¶-HyperLogLogï¼špfmerge" class="headerlink" title="åˆå¹¶ HyperLogLogï¼špfmerge"></a>åˆå¹¶ HyperLogLogï¼špfmerge</h3><p>å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª HyperLogLogï¼Œæƒ³è¦åˆå¹¶å®ƒä»¬çš„ç»Ÿè®¡ç»“æœï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼ŸRedis çš„ <code>pfmerge</code> å‘½ä»¤èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç‚¹ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd p2 d e f g h i j k<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount p2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfmerge p3 p1 p2OK<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount p3<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä»¥ä¸Šä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>pfadd</code> å‘½ä»¤åˆ†åˆ«å‘ p1 å’Œ p2 ä¸­æ·»åŠ äº†ä¸åŒçš„å…ƒç´ ã€‚é€šè¿‡ <code>pfmerge p3 p1 p2</code>ï¼Œæˆ‘ä»¬å°† p1 å’Œ p2 åˆå¹¶åˆ°äº† p3 ä¸­ï¼Œå¹¶ç”¨ <code>pfcount p3</code> ç¡®è®¤äº†åˆå¹¶å HyperLogLog p3 ä¸­å…±æœ‰ 11 ä¸ªå”¯ä¸€å…ƒç´ ã€‚</p><h3 id="æ·»åŠ ç›¸åŒå…ƒç´ æ—¶"><a href="#æ·»åŠ ç›¸åŒå…ƒç´ æ—¶" class="headerlink" title="æ·»åŠ ç›¸åŒå…ƒç´ æ—¶"></a>æ·»åŠ ç›¸åŒå…ƒç´ æ—¶</h3><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•å†æ¬¡æ·»åŠ ç›¸åŒçš„å…ƒç´ åˆ° HyperLogLogï¼Œå®ƒå°†ä¸ä¼šå¢åŠ è®¡æ•°ï¼Œå› ä¸º HyperLogLog æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å»é‡è®¡æ•°å·¥å…·ã€‚</p><p>åˆšåˆšæˆ‘ä»¬å¾€ <code>p1</code> ä¸­æ·»åŠ äº† (a, b, c, d, e, f, g) ä¸ƒä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶æˆ‘ä»¬æ·»åŠ å‡ ä¸ªç›¸åŒçš„å…ƒç´ ä»¥åŠå°‘é‡çš„ä¸åŒå…ƒç´ ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd p1 a a b c h<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount p1<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>p1</code> åªä¼šç»Ÿè®¡ä¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ï¼Œä¼šè‡ªåŠ¨è¿‡æ»¤æ‰ç›¸åŒçš„å…ƒç´ ã€‚ä¾æ®è¿™ä¸ªç‰¹æ€§ï¼Œæ˜¯ä¸æ˜¯åœ¨è„‘æµ·ä¸­å°±é‡Œé¢æƒ³åˆ°äº†ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯äº†ï¼Ÿæ˜¯çš„ï¼Œä¾æ®è¿™ä¸ªå»é‡ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„åš UV ç»Ÿè®¡ã€‚</p><blockquote><p>UVï¼ˆUnique visitorï¼‰ï¼šæ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚è®¿é—®çš„ä¸€ä¸ªç”µè„‘å®¢æˆ·ç«¯ä¸ºä¸€ä¸ªè®¿å®¢ï¼Œä¸€å¤©å†…åŒä¸€ä¸ªè®¿å®¢ä»…è¢«è®¡ç®—ä¸€æ¬¡ã€‚</p></blockquote><p>ä¼ ç»Ÿçš„åšæ³•æ˜¯ä½¿ç”¨ set ä¿å­˜ç”¨æˆ·çš„ IDï¼Œç„¶åç»Ÿè®¡ set ä¸­å…ƒç´ çš„æ•°é‡ä½œä¸ºåˆ¤æ–­æ ‡å‡†ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¿å­˜äº†å¤§é‡çš„ç”¨æˆ· IDï¼Œç”¨æˆ· ID ä¸€èˆ¬æ¯”è¾ƒé•¿ï¼Œè¿™å°±å ç”¨ç©ºé—´ï¼Œè¿˜å¾ˆéº»çƒ¦ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯è®¡æ•°ï¼Œä¸æ˜¯ä¿å­˜æ•°æ®ï¼Œæ‰€ä»¥è¿™æ ·åšæœ‰å¼Šç«¯ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ hyperloglog å°±æ¯”è¾ƒåˆé€‚äº†ã€‚</p><p>hyperloglog çš„ä¼˜ç‚¹æ˜¯<strong>å ç”¨å†…å­˜å°</strong>ï¼Œå¹¶ä¸”æ˜¯<strong>å›ºå®šçš„</strong>ã€‚å­˜å‚¨ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ï¼Œåªéœ€è¦ 12 KB çš„ç©ºé—´ã€‚</p><h3 id="æ•°æ®ç±»å‹ï¼štype"><a href="#æ•°æ®ç±»å‹ï¼štype" class="headerlink" title="æ•°æ®ç±»å‹ï¼štype"></a>æ•°æ®ç±»å‹ï¼štype</h3><p>æœ€åï¼Œæˆ‘ä»¬æ¥ç¡®è®¤ä¸€ä¸‹ HyperLogLog çš„æ•°æ®ç±»å‹ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> p1string<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è™½ç„¶ <code>type p1</code> è¿”å›çš„æ˜¯ <code>string</code>ï¼Œä½†åœ¨ Redis ä¸­ï¼ŒHyperLogLog æ˜¯ä½œä¸ºä¸€ç§æ¦‚ç‡å‹æ•°æ®ç»“æ„å®ç°çš„ï¼Œå®ƒé€šè¿‡ä¸€ç§ç‰¹æ®Šçš„å­—ç¬¦ä¸²æ ¼å¼æ¥å­˜å‚¨æ•°æ®ã€‚å› æ­¤ï¼Œè™½ç„¶å®ƒåœ¨ Redis ä¸­è¡¨ç°ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä½†å®ƒç”¨äºå®ç°åŸºæ•°ç»Ÿè®¡çš„åŠŸèƒ½ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>HyperLogLog æä¾›äº†ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼æ¥å¯¹å¤§è§„æ¨¡æ•°æ®é›†è¿›è¡Œå»é‡è®¡æ•°ã€‚è™½ç„¶å…¶ç»“æœæ˜¯ä¼°è®¡å€¼ï¼Œä½†å…¶é«˜æ•ˆæ€§å’Œå‡†ç¡®åº¦ä½¿å…¶åœ¨å¤„ç†å¤§æ•°æ®ç»Ÿè®¡æ—¶è¡¨ç°å‡ºè‰²ã€‚</p><p>é€šè¿‡ä¸Šè¿°çš„ç®€å•ç¤ºä¾‹ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ Redis çš„ HyperLogLog æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚æ— è®ºæ˜¯å®æ—¶æ•°æ®åˆ†æã€æ—¥å¿—ç»Ÿè®¡è¿˜æ˜¯ç”¨æˆ·è¡Œä¸ºåˆ†æï¼ŒHyperLogLog éƒ½æ˜¯ä¸€ä¸ªå€¼å¾—å°è¯•çš„åˆ©å™¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨Redisä¸­å¿«é€Ÿæ¨ç®—ä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Ÿâ€”â€”Geoç¯‡</title>
      <link href="posts/9c96a9d2.html"/>
      <url>posts/9c96a9d2.html</url>
      
        <content type="html"><![CDATA[<p>å¤„ç†åœ°ç†ä½ç½®æ•°æ®å·²æˆä¸ºè®¸å¤šåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒéœ€æ±‚ã€‚æ— è®ºæ˜¯æ¨é€é™„è¿‘çš„é¤é¦†è¿˜æ˜¯å¯¹å…¨å›½èŒƒå›´å†…çš„æœåŠ¡ç‚¹è¿›è¡Œåˆ†æï¼Œå¿«é€Ÿè€Œå‡†ç¡®åœ°å¤„ç†å’Œæ£€ç´¢åœ°ç†ä½ç½®ä¿¡æ¯éƒ½è‡³å…³é‡è¦ã€‚Redisï¼Œä½œä¸ºä¸€ç§é«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·çš„è§£å†³æ–¹æ¡ˆã€‚</p><blockquote><p>Redis åœ¨ 3.2 æ¨å‡º Geo ç±»å‹ï¼Œè¯¥åŠŸèƒ½å¯ä»¥æ¨ç®—å‡ºåœ°ç†ä½ç½®ä¿¡æ¯ï¼Œä¸¤åœ°ä¹‹é—´çš„è·ç¦»ã€‚æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ï¼Œå¦‚æœè¶…è¿‡æ­¤èŒƒå›´ï¼Œredis ä¼šç›´æ¥æŠ¥é”™ã€‚</p></blockquote><p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥æ¢ç´¢ Redis å¦‚ä½•å¸®åŠ©æˆ‘ä»¬å¤„ç†åœ°ç†ä½ç½®æ•°æ®ï¼Œä¸ä»…é€‚åˆåˆå­¦è€…ï¼Œä¹Ÿèƒ½è®©æœ‰ç»éªŒçš„å¼€å‘è€…æœ‰æ‰€æ”¶è·ã€‚</p><h2 id="æ·»åŠ åœ°ç†ä½ç½®æ•°æ®"><a href="#æ·»åŠ åœ°ç†ä½ç½®æ•°æ®" class="headerlink" title="æ·»åŠ åœ°ç†ä½ç½®æ•°æ®"></a>æ·»åŠ åœ°ç†ä½ç½®æ•°æ®</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‘ Redis ä¸­æ·»åŠ ä¸€äº›ä¸­å›½åŸå¸‚çš„åœ°ç†ä½ç½®æ•°æ®ï¼š</p><blockquote><p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™ <code>http://www.jsons.cn/lngcode/</code> æ¥æŸ¥è¯¢ä¸€ä¸‹ä¸€äº›åŸå¸‚çš„ç»çº¬åº¦ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">116.40</span> <span class="token number">39.90</span> beijing<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">121.47</span> <span class="token number">31.23</span> shanghai<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">106.50</span> <span class="token number">29.53</span> chongqing <span class="token number">114.05</span> <span class="token number">22.52</span> shengzhen<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">120.16</span> <span class="token number">30.24</span> hangzhou <span class="token number">108.96</span> <span class="token number">34.26</span> xian<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œï¼Œ<code>geoadd</code> å‘½ä»¤ç”¨äºå‘æŒ‡å®šçš„ keyï¼ˆè¿™é‡Œæ˜¯ china:cityï¼‰ä¸­æ·»åŠ åœ°ç†ç©ºé—´ä½ç½®ä¿¡æ¯ã€‚æ¯æ¡è®°å½•åŒ…æ‹¬ç»åº¦ã€çº¬åº¦ä»¥åŠä½ç½®çš„åç§°ã€‚</p><p>ä½ æ˜¯å¦ä¼šå¥½å¥‡ geo æ˜¯é€šè¿‡ä»€ä¹ˆç±»å‹åœ¨ Redis ä¸­å­˜å‚¨çš„ï¼Ÿé‚£æˆ‘ä»¬ä¸å¦¨å¯ä»¥ä½¿ç”¨ type å‘½ä»¤æ¥è¿›è¡ŒæŸ¥çœ‹ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> china:cityzset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶å® **geo åº•å±‚å®ç°åŸç†å°±æ˜¯ zset ** ï¼Œè¿™è¡¨æ˜ Redis å†…éƒ¨ä½¿ç”¨äº†æœ‰åºé›†åˆå­˜å‚¨åœ°ç†ç©ºé—´ä¿¡æ¯ï¼Œæ¯ä¸ªåœ°ç‚¹çš„åç§°æ˜¯æœ‰åºé›†åˆçš„æˆå‘˜ï¼Œè€Œå…¶ç»çº¬åº¦åˆ™ç”¨äºè®¡ç®—åˆ†æ•°ï¼Œä»¥ç¡®ä¿æˆå‘˜çš„æœ‰åºæ€§ã€‚</p><h2 id="æŸ¥è¯¢åœ°ç†ç©ºé—´ä¿¡æ¯"><a href="#æŸ¥è¯¢åœ°ç†ç©ºé—´ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢åœ°ç†ç©ºé—´ä¿¡æ¯"></a>æŸ¥è¯¢åœ°ç†ç©ºé—´ä¿¡æ¯</h2><p>å½“ä¿¡æ¯å­˜å…¥æ•°æ®åº“åï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œå„ç§æŸ¥è¯¢ï¼š</p><h3 id="æŸ¥è¯¢å•ä¸ªåŸå¸‚ä½ç½®"><a href="#æŸ¥è¯¢å•ä¸ªåŸå¸‚ä½ç½®" class="headerlink" title="æŸ¥è¯¢å•ä¸ªåŸå¸‚ä½ç½®"></a>æŸ¥è¯¢å•ä¸ªåŸå¸‚ä½ç½®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city shanghai<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"121.47000163793563843"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"31.22999903975783553"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>geopos å‘½ä»¤ç”¨äºè·å–ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜çš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ï¼Œè¿™ä¸ªå‘½ä»¤è¿”å›ä¸Šæµ·çš„ç»çº¬åº¦ã€‚</p><h3 id="è®¡ç®—ä¸¤åŸå¸‚é—´è·ç¦»"><a href="#è®¡ç®—ä¸¤åŸå¸‚é—´è·ç¦»" class="headerlink" title="è®¡ç®—ä¸¤åŸå¸‚é—´è·ç¦»"></a>è®¡ç®—ä¸¤åŸå¸‚é—´è·ç¦»</h3><p>å•ä½ï¼š</p><ul><li><code>m</code> è¡¨ç¤ºå•ä½ä¸ºç±³ï¼Œä¹Ÿæ˜¯é»˜è®¤å•ä½ã€‚</li><li><code>km</code> è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚</li><li><code>mi</code> è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚</li><li><code>ft</code> è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city shanghai chongqing<span class="token string">"1447673.6920"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>geodist å‘½ä»¤ç”¨äºè®¡ç®—ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»ï¼Œé»˜è®¤å•ä½æ˜¯ç±³ã€‚ä¸Šé¢è¿”å›çš„æ˜¯ä¸Šæµ·åˆ°é‡åº†çš„è·ç¦»ã€‚</p><h3 id="æŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„åŸå¸‚"><a href="#æŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„åŸå¸‚" class="headerlink" title="æŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„åŸå¸‚"></a>æŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„åŸå¸‚</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">20</span> <span class="token number">1000</span> km<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"shengzhen"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ä»¥ï¼ˆ110,30ï¼‰ä¸ºä¸­å¿ƒï¼ŒåŠå¾„ 1000 å…¬é‡Œçš„èŒƒå›´å†…ï¼Œæœ‰å“ªäº›åŸå¸‚ã€‚</p><h2 id="å¸¦æœ‰é€‰é¡¹çš„åœ°ç†ä½ç½®æŸ¥è¯¢"><a href="#å¸¦æœ‰é€‰é¡¹çš„åœ°ç†ä½ç½®æŸ¥è¯¢" class="headerlink" title="å¸¦æœ‰é€‰é¡¹çš„åœ°ç†ä½ç½®æŸ¥è¯¢"></a>å¸¦æœ‰é€‰é¡¹çš„åœ°ç†ä½ç½®æŸ¥è¯¢</h2><p>Redis åœ°ç†ç©ºé—´æŸ¥è¯¢è¿˜æ”¯æŒå¤šç§é€‰é¡¹ï¼Œä¾‹å¦‚ï¼Œè¿”å›æœç´¢ç»“æœçš„åæ ‡å’Œè·ç¦»ï¼Œæˆ–è€…é™åˆ¶è¿”å›ç»“æœçš„æ•°é‡ï¼š</p><h3 id="æŸ¥è¯¢å¹¶è¿”å›åæ ‡"><a href="#æŸ¥è¯¢å¹¶è¿”å›åæ ‡" class="headerlink" title="æŸ¥è¯¢å¹¶è¿”å›åæ ‡"></a>æŸ¥è¯¢å¹¶è¿”å›åæ ‡</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km withcoord<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡æ·»åŠ  withcoord é€‰é¡¹ï¼Œgeoradius å‘½ä»¤å¯ä»¥è¿”å›ä½ç½®å…ƒç´ çš„åç§°å’Œå®ƒä»¬çš„åœ°ç†ä½ç½®ä¿¡æ¯ã€‚</p><h3 id="æŸ¥è¯¢å¹¶è¿”å›è·ç¦»"><a href="#æŸ¥è¯¢å¹¶è¿”å›è·ç¦»" class="headerlink" title="æŸ¥è¯¢å¹¶è¿”å›è·ç¦»"></a>æŸ¥è¯¢å¹¶è¿”å›è·ç¦»</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km withdist<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"341.9374"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xian"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"483.8340"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"shengzhen"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"924.6408"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"977.5143"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å›æ¯ä¸ªåŸå¸‚åˆ°æŸ¥è¯¢ä¸­å¿ƒçš„è·ç¦»ã€‚</p><h3 id="æŸ¥è¯¢å¹¶é™åˆ¶ç»“æœæ•°é‡"><a href="#æŸ¥è¯¢å¹¶é™åˆ¶ç»“æœæ•°é‡" class="headerlink" title="æŸ¥è¯¢å¹¶é™åˆ¶ç»“æœæ•°é‡"></a>æŸ¥è¯¢å¹¶é™åˆ¶ç»“æœæ•°é‡</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km withdist withcoord count <span class="token number">2</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"341.9374"</span>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xian"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"483.8340"</span>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"108.96000176668167114"</span>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"34.25999964418929977"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»…è¿”å›ä¸¤ä¸ªæœ€è¿‘çš„åŸå¸‚åŠå…¶åæ ‡å’Œè·ç¦»ã€‚</p><h2 id="æŸ¥è¯¢æŸä¸ªè·ç¦»èŒƒå›´å†…çš„å…ƒç´ "><a href="#æŸ¥è¯¢æŸä¸ªè·ç¦»èŒƒå›´å†…çš„å…ƒç´ " class="headerlink" title="æŸ¥è¯¢æŸä¸ªè·ç¦»èŒƒå›´å†…çš„å…ƒç´ "></a>æŸ¥è¯¢æŸä¸ªè·ç¦»èŒƒå›´å†…çš„å…ƒç´ </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadiusbymember china:city chongqing <span class="token number">1000000</span> m<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>georadiusbymember å‘½ä»¤æ ¹æ®æŒ‡å®šæˆå‘˜çš„ä½ç½®å’Œç»™å®šçš„è·ç¦»ï¼Œè¿”å›èŒƒå›´å†…çš„ä½ç½®å…ƒç´ ã€‚</p><p>ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ geo çš„åº•å±‚æ˜¯é€šè¿‡ zset æ¥å®ç°çš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ zset å‘½ä»¤æ¥æ“ä½œ geoã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange china:city <span class="token number">0</span> <span class="token parameter variable">-1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"shengzhen"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem china:city xian<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange china:city <span class="token number">0</span> <span class="token parameter variable">-1</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"shengzhen"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®è·µæ„ä¹‰"><a href="#å®è·µæ„ä¹‰" class="headerlink" title="å®è·µæ„ä¹‰"></a>å®è·µæ„ä¹‰</h2><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ Redis çš„åœ°ç†ç©ºé—´åŠŸèƒ½æ¥å®ç°å„ç§åŸºäºä½ç½®çš„æœåŠ¡ï¼Œå¦‚å•†å®¶å®šä½ã€é…é€èŒƒå›´ä¼°ç®—ã€æœ€è¿‘æœåŠ¡ç‚¹æŸ¥è¯¢ç­‰ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒRedis æä¾›çš„åœ°ç†ç©ºé—´åŠŸèƒ½æ—¢å¼ºå¤§åˆæ˜“äºä½¿ç”¨ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨æ„å»ºåœ°ç†ç©ºé—´æ•°æ®ç›¸å…³åº”ç”¨æ—¶ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œåº”ç”¨æ€§èƒ½ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>Redis çš„åœ°ç†ç©ºé—´æ•°æ®å¤„ç†æ¨¡å—ä¸ºå¤„ç†å’ŒæŸ¥è¯¢åœ°ç†ä¿¡æ¯æä¾›äº†å¼ºå¤§è€Œé«˜æ•ˆçš„æ–¹æ³•ã€‚æ— è®ºä½ æ˜¯åœ¨å¤„ç†ç®€å•çš„ä½ç½®æ•°æ®æŸ¥è¯¢è¿˜æ˜¯æ„å»ºå¤æ‚çš„åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰ï¼ŒRedis éƒ½èƒ½ä¸ºä½ æä¾›å¿…è¦çš„æ”¯æŒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­çš„mapä¸ºä»€ä¹ˆé»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Ÿ</title>
      <link href="posts/3761f660.html"/>
      <url>posts/3761f660.html</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬èŠä¸€ä¸ª Go è¯­è¨€ä¸­çš„ â€œçƒ­é—¨â€ è¯é¢˜â€”â€”ä¸ºä»€ä¹ˆ <strong>Go è¯­è¨€ä¸­çš„ map é»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨</strong>çš„å‘¢ï¼Ÿ</p><p>å¯¹äºå¹¿å¤§ Go ç¨‹åºå‘˜æ¥è¯´ï¼Œå°¤å…¶æ˜¯é‚£äº›åˆšè·¨å…¥ Go ä¸–ç•Œçš„æ–°æœ‹å‹ä»¬ï¼Œè¿™ä¸ªé—®é¢˜æˆ–è®¸è®©ä½ ä»¬æ‘¸ä¸ç€å¤´è„‘ã€‚åˆ«æ€¥ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ…¢æ…¢æ­å¼€è¿™å±‚ç¥ç§˜çš„é¢çº±ã€‚</p><h2 id="Go-è¯­è¨€ä¸­-map-çš„åŸºæœ¬ä½¿ç”¨"><a href="#Go-è¯­è¨€ä¸­-map-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Go è¯­è¨€ä¸­ map çš„åŸºæœ¬ä½¿ç”¨"></a>Go è¯­è¨€ä¸­ map çš„åŸºæœ¬ä½¿ç”¨</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—çŸ¥é“ map æ˜¯ä»€ä¹ˆã€‚åœ¨ Go ä¸­ï¼Œmap æ˜¯ä¸€ç§å†…ç½®çš„æ•°æ®ç»“æ„ï¼Œå®ƒæä¾›äº† â€œé”®å€¼å¯¹â€ï¼ˆKey-Valueï¼‰çš„å­˜å‚¨æœºåˆ¶ã€‚ä½¿ç”¨ mapï¼Œä½ å¯ä»¥é€šè¿‡ Key å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„ Valueï¼Œè¿™è®©æˆ‘ä»¬åœ¨å¤„ç†ä¸€äº›éœ€è¦å¿«é€ŸæŸ¥è¯¢çš„åœºæ™¯æ—¶å¦‚è™æ·»ç¿¼ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ map ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ›å»ºä¸€ä¸ªmap</span>    myMap <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>    <span class="token comment">// å‘mapä¸­æ·»åŠ é”®å€¼å¯¹</span>    myMap<span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    myMap<span class="token punctuation">[</span><span class="token string">"banana"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>    <span class="token comment">// ä»mapä¸­è·å–å€¼</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>myMap<span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// è¾“å‡º: 1</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é‚£ä¸ºä»€ä¹ˆ-map-é»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨çš„å‘¢ï¼Ÿ"><a href="#é‚£ä¸ºä»€ä¹ˆ-map-é»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨çš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¸ºä»€ä¹ˆ map é»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨çš„å‘¢ï¼Ÿ"></a>é‚£ä¸ºä»€ä¹ˆ map é»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨çš„å‘¢ï¼Ÿ</h2><p>éš¾ä¸æˆ Go å®˜æ–¹è§‰å¾—å¤ªå¤æ‚äº†ï¼Ÿæ€§èƒ½å¤ªå·®äº†ï¼Ÿè¿˜æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ</p><h3 id="å…¸å‹ä½¿ç”¨åœºæ™¯"><a href="#å…¸å‹ä½¿ç”¨åœºæ™¯" class="headerlink" title="å…¸å‹ä½¿ç”¨åœºæ™¯"></a>å…¸å‹ä½¿ç”¨åœºæ™¯</h3><p>Go å®˜æ–¹è®¤ä¸ºï¼Œmap çš„å…¸å‹ä½¿ç”¨åœºæ™¯å¹¶ä¸éœ€è¦ä»å¤šä¸ª goroutine ä¸­å®‰å…¨åœ°è®¿é—®ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘äº†æ€§èƒ½å’Œç®€å•æ€§ï¼Œè€Œæ²¡æœ‰å°†å¹¶å‘å®‰å…¨ä½œä¸ºé»˜è®¤ç‰¹æ€§ã€‚è¿™æ˜¯ä¸€ç§åŸºäºä½¿ç”¨æ¡ˆä¾‹è¿›è¡Œæƒè¡¡çš„ç»“æœã€‚</p><h3 id="æ€§èƒ½è€ƒé‡"><a href="#æ€§èƒ½è€ƒé‡" class="headerlink" title="æ€§èƒ½è€ƒé‡"></a>æ€§èƒ½è€ƒé‡</h3><p>å¼•å…¥å¹¶å‘å®‰å…¨æ„å‘³ç€æ¯æ¬¡æ“ä½œ map æ—¶éƒ½éœ€è¦è¿›è¡ŒåŠ é”å’Œè§£é”ï¼Œè¿™æ— ç–‘ä¼šå¢åŠ é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚ä¸ºäº†å¤§å¤šæ•°ç¨‹åºçš„æ€§èƒ½è€ƒè™‘ï¼ŒGo æ²¡æœ‰å°† map è®¾è®¡ä¸ºå¹¶å‘å®‰å…¨çš„ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´å³ä½¿åœ¨ä¸éœ€è¦å¹¶å‘è®¿é—®çš„åœºæ™¯ä¸‹ï¼Œä¹Ÿè¦ä»˜å‡ºä¸å¿…è¦çš„æ€§èƒ½ä»£ä»·ã€‚</p><h3 id="å®˜æ–¹æ–¹æ¡ˆ"><a href="#å®˜æ–¹æ–¹æ¡ˆ" class="headerlink" title="å®˜æ–¹æ–¹æ¡ˆ"></a>å®˜æ–¹æ–¹æ¡ˆ</h3><p>ä» <code>Go 1.6</code> å¼€å§‹ï¼Œå¼•å…¥äº†å¹¶å‘è®¿é—® map çš„æ£€æµ‹æœºåˆ¶ï¼Œå¦‚æœæ£€æµ‹åˆ°å¹¶å‘è¯»å†™ï¼Œç¨‹åºä¼šç›´æ¥å´©æºƒï¼Œè€Œä¸æ˜¯éšç’é—®é¢˜ã€‚Go å®˜æ–¹å€¾å‘äºè®©é—®é¢˜æ˜¾éœ²å‡ºæ¥ï¼ˆâ€let it crashâ€ï¼‰ï¼Œè¿™æ ·å¯ä»¥è¿«ä½¿å¼€å‘è€…æ­£è§†å¹¶å‘é—®é¢˜ï¼Œé‡‡å–æ­£ç¡®çš„æ–¹æ³•æ¥è§£å†³ã€‚</p><h2 id="å¦‚ä½•å®‰å…¨åœ°åœ¨å¤šä¸ª-goroutine-ä¸­æ“ä½œ-mapï¼Ÿ"><a href="#å¦‚ä½•å®‰å…¨åœ°åœ¨å¤šä¸ª-goroutine-ä¸­æ“ä½œ-mapï¼Ÿ" class="headerlink" title="å¦‚ä½•å®‰å…¨åœ°åœ¨å¤šä¸ª goroutine ä¸­æ“ä½œ mapï¼Ÿ"></a>å¦‚ä½•å®‰å…¨åœ°åœ¨å¤šä¸ª goroutine ä¸­æ“ä½œ mapï¼Ÿ</h2><p>è™½ç„¶åŸç”Ÿçš„ map ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œä½† Go æä¾›äº†å…¶ä»–æœºåˆ¶æ¥è§£å†³å¹¶å‘è®¿é—®çš„é—®é¢˜ã€‚æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨äº’æ–¥é” <code>sync.Mutex</code>ï¼Œæ¥ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® mapã€‚</p><blockquote><p>å½“ç„¶ç°åœ¨ä¸æ­¢è¿™ä¸€ä¸ªæ–¹æ³•ä¿è¯ map å¹¶å‘å®‰å…¨ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œä»…ä»¥æ­¤ä¸ºä¾‹ã€‚</p></blockquote><p>ä¾‹å­å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"sync"</span><span class="token punctuation">)</span><span class="token keyword">var</span> <span class="token punctuation">(</span>    myMap <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>    lock  sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// å¯åŠ¨ä¸€ä¸ª goroutine å†™å…¥æ•°æ®</span>    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">{</span>            lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            myMap<span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>            lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// åœ¨ä¸» goroutine ä¸­è¯»å–æ•°æ®</span>    <span class="token keyword">for</span> <span class="token punctuation">{</span>        lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>myMap<span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>é€šè¿‡ä»¥ä¸Šçš„æ¢è®¨ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸ºä»€ä¹ˆ Go è¯­è¨€ä¸­çš„ map é»˜è®¤ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå…¶å®å°±æ˜¯ä¸€å¥è¯æ¦‚æ‹¬ï¼š<strong>Go å®˜æ–¹è§‰å¾—å¤§éƒ¨åˆ†åœºæ™¯éƒ½ä¸éœ€è¦æ”¯æŒå¹¶å‘ï¼Œä»æ€§èƒ½ä¸Šåšçš„è€ƒè™‘</strong>ã€‚</p><p>Go è¯­è¨€çš„è®¾è®¡å“²å­¦ä¹‹ä¸€å°±æ˜¯ç®€å•è€Œæœ‰æ•ˆï¼Œé€šè¿‡è®©å¼€å‘è€…æ˜¾å¼åœ°å¤„ç†å¹¶å‘é—®é¢˜ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½ï¼Œä¹Ÿè®©ä»£ç çš„è¡Œä¸ºæ›´åŠ é€æ˜ã€‚</p><p>ä¹Ÿæœ‰ç½‘å‹è®¨è®ºè¯´ï¼Œå¯ä»¥åƒ Java é‚£æ ·æä¾›ä¸¤ä¸ª mapï¼Œä¸€ä¸ªæ”¯æŒå¹¶å‘ï¼Œæ€§èƒ½å·®äº›ï¼Œä¸€ä¸ªä¸æ”¯æŒå¹¶å‘ï¼Œæ€§èƒ½å¥½ã€‚ä½†æ˜¯ Go å®˜æ–¹ä¸ºä»€ä¹ˆä¸æä¾›ä¸¤ä¸ªï¼Œé‚£å°±ä¸å¾—è€ŒçŸ¥äº†ï¼Œå¯èƒ½æ˜¯ä¸ºäº†ç¬¦åˆ Go è¯­è¨€â€œå°‘å°±æ˜¯å¤šâ€çš„ç†å¿µï¼Ÿ</p><p>ä½ æœ‰ä»€ä¹ˆçœ‹æ³•å‘¢ï¼Ÿä¸€èµ·èŠèŠâ€¦â€¦</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€mapå¹¶å‘å®‰å…¨ï¼Œäº’æ–¥é”å’Œè¯»å†™é”è°æ›´ä¼˜ï¼Ÿ</title>
      <link href="posts/35885ddd.html"/>
      <url>posts/35885ddd.html</url>
      
        <content type="html"><![CDATA[<p>å¹¶å‘ç¼–ç¨‹æ˜¯ Go è¯­è¨€çš„ä¸€å¤§ç‰¹è‰²ï¼Œåˆç†åœ°ä½¿ç”¨é”å¯¹äºä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œæé«˜ç¨‹åºæ€§èƒ½è‡³å…³é‡è¦ã€‚</p><p>åœ¨å¤„ç†å¹¶å‘æ§åˆ¶æ—¶ï¼Œ<code>sync.Mutex</code>ï¼ˆäº’æ–¥é”ï¼‰å’Œ <code>sync.RWMutex</code>ï¼ˆè¯»å†™é”ï¼‰æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å·¥å…·ã€‚ç†è§£å®ƒä»¬å„è‡ªçš„ä¼˜åŠ£åŠæ“…é•¿çš„åœºæ™¯ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°è®¾è®¡é«˜æ•ˆä¸”ç¨³å®šçš„å¹¶å‘ç¨‹åºã€‚</p><h2 id="äº’æ–¥é”ï¼ˆMutexï¼‰"><a href="#äº’æ–¥é”ï¼ˆMutexï¼‰" class="headerlink" title="äº’æ–¥é”ï¼ˆMutexï¼‰"></a>äº’æ–¥é”ï¼ˆMutexï¼‰</h2><p>äº’æ–¥é”æ˜¯æœ€åŸºæœ¬ã€æœ€ç›´æ¥çš„å¹¶å‘åŸè¯­ä¹‹ä¸€ï¼Œå®ƒä¿è¯äº†åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œä»è€Œä¿è¯äº†å¹¶å‘å®‰å…¨ã€‚</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p><code>sync.Mutex</code> é€šè¿‡å†…éƒ¨è®¡æ•°å™¨ï¼ˆåªæœ‰ä¸¤ä¸ªå€¼ï¼Œé”å®šå’Œæœªé”å®šï¼‰å’Œç­‰å¾…é˜Ÿåˆ—ï¼ˆç­‰å¾…è·å–é”çš„ goroutines åˆ—è¡¨ï¼‰æ¥å®ç°é”çš„æœºåˆ¶ã€‚å½“ä¸€ä¸ª goroutine è¯·æ±‚é”æ—¶ï¼Œå¦‚æœé”å·²è¢«å ç”¨ï¼Œåˆ™è¯¥ goroutine ä¼šè¢«æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç›´è‡³é”è¢«é‡Šæ”¾ã€‚</p><h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><ul><li>å¯¹æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œçš„é¢‘ç‡å¤§è‡´ç›¸å½“ã€‚</li><li>éœ€è¦ç¡®ä¿æ•°æ®å†™æ“ä½œçš„ç»å¯¹å®‰å…¨ï¼Œä¸”è¯»æ“ä½œä¸è¿œè¿œé«˜äºå†™æ“ä½œã€‚</li></ul><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li>è¯»æ“ä½œå¤šäºå†™æ“ä½œæ—¶ï¼Œæ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºè¯»æ“ä½œä¹Ÿä¼šè¢«é˜»å¡ã€‚</li></ul><h2 id="è¯»å†™é”ï¼ˆRWMutexï¼‰"><a href="#è¯»å†™é”ï¼ˆRWMutexï¼‰" class="headerlink" title="è¯»å†™é”ï¼ˆRWMutexï¼‰"></a>è¯»å†™é”ï¼ˆRWMutexï¼‰</h2><p>è¯»å†™é”ç»´æŠ¤äº†ä¸¤ä¸ªçŠ¶æ€ï¼šè¯»é”çŠ¶æ€å’Œå†™é”çŠ¶æ€ã€‚å½“ä¸€ä¸ª goroutine è·å–è¯»é”æ—¶ï¼Œå…¶ä»– goroutine ä»ç„¶å¯ä»¥è·å–è¯»é”ï¼Œä½†æ˜¯å†™é”ä¼šè¢«é˜»å¡ï¼›å½“ä¸€ä¸ª goroutine è·å–å†™é”æ—¶ï¼Œåˆ™æ‰€æœ‰çš„è¯»é”å’Œå†™é”éƒ½ä¼šè¢«é˜»å¡ã€‚</p><h3 id="å®ç°åŸç†-1"><a href="#å®ç°åŸç†-1" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p><code>sync.RWMutex</code> é€šè¿‡åˆ†åˆ«ç»´æŠ¤è¯»è€…è®¡æ•°å’Œå†™è€…çŠ¶æ€ï¼Œè®©å¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œï¼Œè€Œå†™æ“ä½œä¿æŒæ’ä»–æ€§ã€‚è¯»é”çš„è¯·æ±‚ä¼šåœ¨æ²¡æœ‰å†™æ“ä½œæˆ–å†™è¯·æ±‚æ—¶è·å¾—æ»¡è¶³ï¼Œå†™é”çš„è¯·æ±‚åˆ™éœ€è¦ç­‰å¾…æ‰€æœ‰çš„è¯»é”å’Œå†™é”é‡Šæ”¾ã€‚</p><h3 id="é€‚ç”¨åœºæ™¯-1"><a href="#é€‚ç”¨åœºæ™¯-1" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><ul><li>è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œã€‚</li><li>è¯»æ“ä½œéœ€è¦è¾ƒé«˜æ€§èƒ½ï¼Œè€Œå†™æ“ä½œé¢‘ç‡è¾ƒä½ã€‚</li></ul><h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li>åœ¨è¯»æ“ä½œæå…¶é¢‘ç¹ï¼Œå†™æ“ä½œä¹Ÿè¾ƒå¤šçš„åœºæ™¯ä¸‹ï¼Œå†™æ“ä½œå¯èƒ½ä¼šé¢ä¸´è¾ƒé•¿æ—¶é—´çš„ç­‰å¾…ã€‚</li></ul><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="äº’æ–¥é”çš„ç¤ºä¾‹"><a href="#äº’æ–¥é”çš„ç¤ºä¾‹" class="headerlink" title="äº’æ–¥é”çš„ç¤ºä¾‹"></a>äº’æ–¥é”çš„ç¤ºä¾‹</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> mutex sync<span class="token punctuation">.</span>Mutex<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">Write</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    mutex<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    m<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value    mutex<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">Read</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>    mutex<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">defer</span> mutex<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> m<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯»å†™é”çš„ç¤ºä¾‹"><a href="#è¯»å†™é”çš„ç¤ºä¾‹" class="headerlink" title="è¯»å†™é”çš„ç¤ºä¾‹"></a>è¯»å†™é”çš„ç¤ºä¾‹</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> rwMutex sync<span class="token punctuation">.</span>RWMutex<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">Write</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    rwMutex<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    m<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value    rwMutex<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">Read</span><span class="token punctuation">(</span>key value<span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>    rwMutex<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">defer</span> rwMutex<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> m<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€‰æ‹© <code>sync.Mutex</code> è¿˜æ˜¯ <code>sync.RWMutex</code> éœ€è¦æ ¹æ®ä½ çš„å…·ä½“åœºæ™¯æ¥å†³å®šã€‚å¦‚æœä½ çš„åº”ç”¨ä¸­è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œï¼Œå¹¶ä¸”å¯¹è¯»æ“ä½œçš„å¹¶å‘æ€§è¦æ±‚é«˜ï¼Œé‚£ä¹ˆ <code>sync.RWMutex</code> æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚åä¹‹ï¼Œå¦‚æœè¯»å†™æ“ä½œé¢‘ç‡ç›¸ä¼¼ï¼Œæˆ–è€…å†™æ“ä½œçš„å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>sync.Mutex</code> ä¼šæ›´åŠ ç®€å•å’Œç›´æ¥ã€‚</p><p>ç†è§£æ¯ç§é”çš„å†…éƒ¨å®ç°å’Œç‰¹ç‚¹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶å¹¶å‘ï¼Œæå‡ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Go è¯­è¨€ä¸­çš„å¹¶å‘é”é€‰æ‹©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> äº’æ–¥é” </tag>
            
            <tag> é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€mapå¹¶å‘å®‰å…¨ä½¿ç”¨çš„æ­£ç¡®å§¿åŠ¿</title>
      <link href="posts/85f0ac00.html"/>
      <url>posts/85f0ac00.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¹¶å‘ç¼–ç¨‹çš„ä¸–ç•Œé‡Œï¼Œ<code>map</code> çš„ä½¿ç”¨éšå¤„å¯è§ã€‚ç„¶è€Œï¼Œå½“å¤šä¸ª goroutine åŒæ—¶è¯»å†™ map æ—¶ï¼Œå¦‚æœä¸åŠ ä»¥æ§åˆ¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰å‡ ç§æ–¹æ³•æ¥ä¿è¯å¯¹ map çš„å¹¶å‘å®‰å…¨è®¿é—®ã€‚ä»Šå¤©ï¼Œæˆ‘å°†å¸¦å¤§å®¶è¯¦ç»†äº†è§£å¦‚ä½•åœ¨ Go è¯­è¨€ä¸­å®‰å…¨åœ°ä½¿ç”¨ mapã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘å®‰å…¨çš„-mapï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘å®‰å…¨çš„-mapï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘å®‰å…¨çš„ mapï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘å®‰å…¨çš„ mapï¼Ÿ</h2><p>åœ¨ Go çš„å¹¶å‘æ¨¡å‹ä¸­ï¼Œgoroutine æ˜¯è½»é‡çº§çš„çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ›å»ºæˆåƒä¸Šä¸‡çš„ goroutineã€‚ä½†æ˜¯ï¼Œå½“è¿™äº› goroutine å°è¯•åŒæ—¶è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ª map æ—¶ï¼Œç”±äº map æœ¬èº«ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œè¿™å°±å¯èƒ½å¯¼è‡´<strong>æ•°æ®ç«æ€</strong>ï¼Œè¿›è€Œå½±å“æ•°æ®çš„å®Œæ•´æ€§ä¸ç¨‹åºçš„ç¨³å®šæ€§ã€‚</p><h2 id="ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼‰ä¿æŠ¤-map"><a href="#ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼‰ä¿æŠ¤-map" class="headerlink" title="ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼‰ä¿æŠ¤ map"></a>ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼‰ä¿æŠ¤ map</h2><p>æœ€ç®€å•ä¸”æš´åŠ›çš„æ–¹å¼å°±æ˜¯ï¼Œç›´æ¥ä½¿ç”¨äº’æ–¥é”ï¼ˆ<code>sync.Mutex</code>ï¼‰æ¥ä¿è¯åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ª goroutine èƒ½å¤Ÿè®¿é—® mapã€‚</p><p>æ¥çœ‹çœ‹å¦‚ä½•å®ç°ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"sync"</span><span class="token punctuation">)</span><span class="token comment">// å®šä¹‰ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ map</span><span class="token keyword">type</span> SafeMap <span class="token keyword">struct</span> <span class="token punctuation">{</span>    mu sync<span class="token punctuation">.</span>Mutex    m  <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">}</span><span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„å¹¶å‘å®‰å…¨çš„ map</span><span class="token keyword">func</span> <span class="token function">NewSafeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>SafeMap <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">&amp;</span>SafeMap<span class="token punctuation">{</span>        m<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// è®¾ç½®é”®å€¼å¯¹ï¼ŒåŠ é”ä¿æŠ¤</span><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SafeMap<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">defer</span> s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">}</span><span class="token comment">// æ ¹æ®é”®è·å–å€¼ï¼ŒåŠ é”ä¿æŠ¤</span><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SafeMap<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">defer</span> s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    val<span class="token punctuation">,</span> ok <span class="token operator">:=</span> s<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">return</span> val<span class="token punctuation">,</span> ok<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    sm <span class="token operator">:=</span> <span class="token function">NewSafeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// è®¾ç½®å€¼</span>    sm<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>    <span class="token comment">// è·å–å€¼</span>    <span class="token keyword">if</span> val<span class="token punctuation">,</span> ok <span class="token operator">:=</span> sm<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Value:"</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ¥ç»„åˆ <code>sync.Mutex</code> å’Œ mapï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ¯æ¬¡è®¿é—®æˆ–ä¿®æ”¹ map æ—¶éƒ½ä¼šé€šè¿‡äº’æ–¥é”è¿›è¡ŒåŒæ­¥ï¼Œä»è€Œä¿è¯å¹¶å‘å®‰å…¨ã€‚</p><h2 id="ä½¿ç”¨-sync-Map"><a href="#ä½¿ç”¨-sync-Map" class="headerlink" title="ä½¿ç”¨ sync.Map"></a>ä½¿ç”¨ sync.Map</h2><p>ä» Go 1.9 å¼€å§‹ï¼Œæ ‡å‡†åº“æä¾›äº† <code>sync.Map</code>ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†å¹¶å‘ç¯å¢ƒä¸‹çš„ map æ“ä½œã€‚</p><p><code>sync.Map</code> å†…ç½®äº†æ‰€æœ‰å¿…è¦çš„å¹¶å‘å®‰å…¨ä¿æŠ¤ï¼Œé€‚åˆåœ¨å¤šä¸ª goroutine é—´å…±äº«å’Œä¿®æ”¹ map æ•°æ®çš„åœºæ™¯ã€‚å®ƒæä¾›äº†å¦‚ä¸‹å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š<code>Load</code>ã€<code>Store</code>ã€<code>Delete</code> å’Œ <code>Range</code>ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>sync.Map</code> çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"sync"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> m sync<span class="token punctuation">.</span>Map        <span class="token comment">// å­˜å‚¨é”®å€¼å¯¹</span>    m<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"value1"</span><span class="token punctuation">)</span>        <span class="token comment">// ä» map ä¸­è·å–å€¼</span>    value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> ok <span class="token punctuation">{</span>        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Found value: %s\n"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>    <span class="token punctuation">}</span>        <span class="token comment">// åˆ é™¤é”®</span>    m<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span>        <span class="token comment">// ä½¿ç”¨ Range éå† map</span>    m<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v: %v\n"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// ç»§ç»­è¿­ä»£</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>sync.Map</code> è™½ç„¶æ–¹ä¾¿ï¼Œä½†å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ã€‚å®ƒåœ¨ç‰¹å®šåœºæ™¯ï¼ˆå¦‚å…ƒç´ é¢‘ç¹å˜åŒ–çš„åœºåˆï¼‰ä¸‹æ€§èƒ½å¹¶ä¸é«˜ã€‚æ‰€ä»¥ï¼Œæ˜¯å¦é€‰æ‹© <code>sync.Map</code>ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæƒè¡¡ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨ Go è¯­è¨€å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæ­£ç¡®åœ°ä½¿ç”¨ map æ˜¯ä¿è¯ç¨‹åºç¨³å®šè¿è¡Œçš„å…³é”®ã€‚é€šè¿‡äº’æ–¥é”å’Œ <code>sync.Map</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„åœºæ™¯ä¸­å®‰å…¨åœ°ä½¿ç”¨ mapã€‚æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯å’Œæ€§èƒ½ç‰¹ç‚¹ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚æ¥é€‰æ‹©ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©å¤§å®¶åœ¨ Go è¯­è¨€çš„å¹¶å‘ç¼–ç¨‹æ—…é€”ä¸Šæ›´åŠ é¡ºç•…ã€‚</p><p>å¥½äº†ï¼Œä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœä½ å¯¹å¹¶å‘å®‰å…¨çš„ map æœ‰æ›´å¤šæƒ³æ³•ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚è®°å¾—ç‚¹ä¸ªå…³æ³¨å“¦ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£ Nginx ä¸ Kong çš„é…ç½®ä¸å®è·µ</title>
      <link href="posts/52ffe35e.html"/>
      <url>posts/52ffe35e.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡å’Œè´Ÿè½½åæ ‡æˆä¸ºäº†å…³é”®ç¯èŠ‚ã€‚è¿™ç¯‡æ–‡ç« å°†æ·±å…¥æ¢è®¨å¦‚ä½•é€šè¿‡ Nginx é…ç½®å®ç°æœåŠ¡çš„è´Ÿè½½å‡è¡¡ï¼ŒåŒæ—¶å¦‚ä½•åˆ©ç”¨ Kong API ç½‘å…³ç®¡ç†å¾®æœåŠ¡ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæœåŠ¡å‘ç°ã€è·¯ç”±ã€å’Œè´Ÿè½½åæ ‡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å…·ä½“ä»£ç ç¤ºä¾‹ï¼Œç¡®ä¿å³ä¾¿æ˜¯ç¼–ç¨‹æ–°æ‰‹ä¹Ÿèƒ½è½»æ¾é¢†æ‚Ÿã€‚</p><h2 id="ä¸€ã€ç†è§£-Nginx-é…ç½®"><a href="#ä¸€ã€ç†è§£-Nginx-é…ç½®" class="headerlink" title="ä¸€ã€ç†è§£ Nginx é…ç½®"></a>ä¸€ã€ç†è§£ Nginx é…ç½®</h2><p>Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿè¢«å¹¿æ³›ç”¨äºè´Ÿè½½å‡è¡¡ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåŸºæœ¬çš„ Nginx é…ç½®ä¾‹å­ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬ç†è§£å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="Nginx-é…ç½®ç¤ºä¾‹"><a href="#Nginx-é…ç½®ç¤ºä¾‹" class="headerlink" title="Nginx é…ç½®ç¤ºä¾‹"></a>Nginx é…ç½®ç¤ºä¾‹</h3><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> pay-service</span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:5501 weight=2</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:5502 weight=4</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:5503 weight=8</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span> pay-service.xxx.com</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">location</span> /paymanger</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host             <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Real-IP        <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Forwarded-For  <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_cookie_path</span> / <span class="token string">"/; secure; HttpOnly; SameSite=strict"</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_pass</span>                 http://pay-service</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„é…ç½®å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>pay-service</code> çš„ upstreamï¼Œå®ƒåŒ…æ‹¬ä¸‰ä¸ªåç«¯æœåŠ¡èŠ‚ç‚¹ï¼Œé€šè¿‡ä¸åŒçš„æƒé‡åˆ†é…å¤„ç†è¯·æ±‚ã€‚è¿™é‡Œçš„æƒé‡æ„å‘³ç€ <code>127.0.0.1:5503</code> çš„è¯·æ±‚å¤„ç†èƒ½åŠ›æ˜¯ <code>127.0.0.1:5501</code> çš„å››å€ã€‚</p><h3 id="æ ¸å¿ƒæ¦‚å¿µè§£é‡Šï¼š"><a href="#æ ¸å¿ƒæ¦‚å¿µè§£é‡Šï¼š" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µè§£é‡Šï¼š"></a>æ ¸å¿ƒæ¦‚å¿µè§£é‡Šï¼š</h3><ul><li><strong>upstream</strong>: ç”¨æ¥å®šä¹‰ä¸€ç»„åç«¯æœåŠ¡èŠ‚ç‚¹ã€‚</li><li><strong>server</strong>: ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚çš„é…ç½®ã€‚</li><li><strong>location</strong>: åŒ¹é…è¯·æ±‚URIï¼Œå¹¶å®šä¹‰å¤„ç†è¯·æ±‚çš„é…ç½®ã€‚</li><li><strong>proxy_pass</strong>: æŒ‡å®šè¯·æ±‚è½¬å‘çš„åç«¯æœåŠ¡ç¾¤ç»„ã€‚</li></ul><table><thead><tr><th>Kong ç»„ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>service</td><td>service å¯¹åº”æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥æŒ‡å‘ä¸€ä¸ª API æœåŠ¡èŠ‚ç‚¹ï¼ˆhost å‚æ•°è®¾ç½®ä¸º ip + portï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ª upstream å®ç°è´Ÿè½½å‡è¡¡ã€‚ç®€å•æ¥è¯´ï¼ŒæœåŠ¡ç”¨äºæ˜ å°„è¢«è½¬å‘çš„åç«¯ API çš„èŠ‚ç‚¹é›†åˆã€‚ <strong>å¯¹åº”çš„å°±æ˜¯ä»¥ä¸Šçš„ proxy_pass <a href="http://pay-service/">http://pay-service</a>; è¿™ä¸€è¡Œé…ç½®</strong></td></tr><tr><td>route</td><td>route å¯¹åº”è·¯ç”±ï¼Œå®ƒè´Ÿè´£åŒ¹é…å®é™…çš„è¯·æ±‚ï¼Œæ˜ å°„åˆ° service ä¸­ã€‚ <strong>å¯¹åº”çš„å°±æ˜¯ä»¥ä¸Šçš„  /paymanger é…ç½®</strong></td></tr><tr><td>upstream</td><td>upstream å¯¹åº”ä¸€ç»„ API èŠ‚ç‚¹ï¼Œå®ç°è´Ÿè½½å‡è¡¡</td></tr><tr><td>target</td><td>target å¯¹åº”ä¸€ä¸ª API èŠ‚ç‚¹ <strong>å¯¹åº”çš„å°±æ˜¯ä»¥ä¸Šçš„ 127.0.0.1:5501 127.0.0.1:5502 127.0.0.1:5503 è¿™ä¸‰ä¸ªèŠ‚ç‚¹</strong></td></tr></tbody></table><hr><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d4fae85689ca7f09.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¯·æ±‚ç¤ºä¾‹å›¾"></p><h2 id="äºŒã€ä½¿ç”¨-Kong-è¿›è¡ŒæœåŠ¡ç®¡ç†"><a href="#äºŒã€ä½¿ç”¨-Kong-è¿›è¡ŒæœåŠ¡ç®¡ç†" class="headerlink" title="äºŒã€ä½¿ç”¨ Kong è¿›è¡ŒæœåŠ¡ç®¡ç†"></a>äºŒã€ä½¿ç”¨ Kong è¿›è¡ŒæœåŠ¡ç®¡ç†</h2><p>Kong æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿã€å¿«é€Ÿã€å¯æ‰©å±•çš„å¾®æœåŠ¡æŠ½è±¡å±‚ï¼ˆAPI ç½‘å…³ï¼‰ï¼Œç”¨äºç®¡ç†å¾®æœåŠ¡çš„è¯·æ±‚å¦‚è·¯ç”±ã€èº«ä»½éªŒè¯ã€ç›‘æ§ç­‰ã€‚</p><h3 id="Kong-ç»„ä»¶ç®€ä»‹"><a href="#Kong-ç»„ä»¶ç®€ä»‹" class="headerlink" title="Kong ç»„ä»¶ç®€ä»‹"></a>Kong ç»„ä»¶ç®€ä»‹</h3><ul><li><strong>service</strong>: æ˜ å°„åç«¯ API èŠ‚ç‚¹é›†åˆã€‚</li><li><strong>route</strong>: åŒ¹é…å¹¶æ˜ å°„åˆ° serviceã€‚</li><li><strong>upstream</strong>: ä¸€ç»„ API èŠ‚ç‚¹ï¼Œç”¨äºè´Ÿè½½å‡è¡¡ã€‚</li><li><strong>target</strong>: ä¸€ä¸ª API èŠ‚ç‚¹ã€‚</li></ul><h3 id="åˆ›å»º-upstream-å’Œ-target"><a href="#åˆ›å»º-upstream-å’Œ-target" class="headerlink" title="åˆ›å»º upstream å’Œ target"></a>åˆ›å»º upstream å’Œ target</h3><h4 id="åˆ›å»º-upstream"><a href="#åˆ›å»º-upstream" class="headerlink" title="åˆ›å»º upstream"></a>åˆ›å»º upstream</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8001/upstreams  <span class="token parameter variable">--data</span> <span class="token string">"name=pay-service"</span><span class="token function">curl</span> http://127.0.0.1:8001/upstreams<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="åˆ›å»º-target"><a href="#åˆ›å»º-target" class="headerlink" title="åˆ›å»º target"></a>åˆ›å»º target</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8001/upstreams/pay-service/targets  <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"target=127.0.0.1:5501"</span> <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"weight=2"</span><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8001/upstreams/pay-service/targets  <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"target=127.0.0.1:5502"</span> <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"weight=4"</span><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8001/upstreams/pay-service/targets  <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"target=127.0.0.1:5503"</span> <span class="token punctuation">\</span>--d<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šå‘½ä»¤å°†åˆ›å»ºä¸‰ä¸ªå¸¦æœ‰ä¸åŒæƒé‡çš„ targetï¼Œå¯¹åº”åˆ°ä¹‹å‰çš„ Nginx é…ç½®çš„ä¸‰ä¸ªæœåŠ¡èŠ‚ç‚¹ã€‚</p><h3 id="åˆ›å»º-service-å’Œ-route"><a href="#åˆ›å»º-service-å’Œ-route" class="headerlink" title="åˆ›å»º service å’Œ route"></a>åˆ›å»º service å’Œ route</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»º service</span><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8001/services  <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"name=payment-service"</span> <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"host=pay-service"</span><span class="token comment"># åˆ›å»º service å¯¹åº”çš„ route</span><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8001/services/payment-service/routes  <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"name=payment-service-route"</span> <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">"paths[]=/paymanger"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä¸Šè¿°é…ç½®ï¼Œå½“ç”¨æˆ·è¯·æ±‚ <code>/paymanger</code> æ—¶ï¼ŒKong ä¼šæ˜ å°„è¿™ä¸ªè¯·æ±‚åˆ° <code>payment-service</code>ï¼Œå¹¶é€šè¿‡ upstream <code>pay-service</code> å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>Nginx å’Œ Kong åœ¨ç°ä»£å¾®æœåŠ¡æ¶æ„ä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„è§’è‰²ã€‚Nginx æ“…é•¿å¤„ç†é™æ€å†…å®¹ã€è´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†ï¼Œè€Œ Kong æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ API ç®¡ç†å¹³å°ï¼Œè®©ä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç®¡ç†å’Œç›‘æ§ä½ çš„ APIã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ·±å…¥ç†è§£å®ƒä»¬çš„å·¥ä½œåŸç†å’Œé…ç½®æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KONG </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker å®‰è£… KONG å¸¦ä½ ç©è½¬ API ç½‘å…³</title>
      <link href="posts/b8eafe4f.html"/>
      <url>posts/b8eafe4f.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å½“ä»Šçš„è½¯ä»¶å¼€å‘ä¸­ï¼ŒAPI ç½‘å…³å·²æˆä¸ºå¾®æœåŠ¡æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚å®ƒä¸ä»…ç®€åŒ–äº†æœåŠ¡é—´çš„é€šä¿¡ã€æä¾›äº†ç»Ÿä¸€çš„å…¥å£ï¼Œè¿˜èƒ½åœ¨å®‰å…¨ã€ç›‘æ§ã€é™æµç­‰æ–¹é¢å‘æŒ¥å·¨å¤§ä½œç”¨ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠå¦‚ä½•é€šè¿‡ Docker å¿«é€Ÿéƒ¨ç½² KONG â€”â€” ä¸€ä¸ªæµè¡Œçš„å¼€æº API ç½‘å…³ã€‚</p><h2 id="KONG-ç®€ä»‹"><a href="#KONG-ç®€ä»‹" class="headerlink" title="KONG ç®€ä»‹"></a>KONG ç®€ä»‹</h2><p>KONG æ˜¯åŸºäº <a href="nginx.org">Nginx</a> å’Œ <a href="https://openresty.org/cn/">OpenResty</a> ï¼ˆNginx + Luaï¼‰çš„äº‘åŸç”Ÿã€é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„å¾®æœåŠ¡ API ç½‘å…³ã€‚å®ƒä»¥æ’ä»¶å½¢å¼æä¾›ä¸°å¯Œçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>èº«ä»½è®¤è¯ï¼ˆå¦‚ JWTã€basic-authï¼‰</li><li>å®‰å…¨æ€§ï¼ˆå¦‚ IP é»‘ç™½åå•ï¼‰</li><li>ç›‘æ§</li><li>æµé‡æ§åˆ¶</li></ul><h2 id="KONG-ä¸-Nginx-å’Œ-OpenResty-çš„å…³ç³»"><a href="#KONG-ä¸-Nginx-å’Œ-OpenResty-çš„å…³ç³»" class="headerlink" title="KONG ä¸ Nginx å’Œ OpenResty çš„å…³ç³»"></a>KONG ä¸ Nginx å’Œ OpenResty çš„å…³ç³»</h2><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ KONGï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ˜ç™½å®ƒä¸ Nginxã€OpenResty çš„å…³ç³»ï¼š</p><ul><li><strong>Nginx</strong>ï¼šæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP æœåŠ¡å™¨å’Œåå‘ä»£ç†ï¼Œä»¥åŠä¸€ä¸ª IMAP/POP3 ä»£ç†æœåŠ¡å™¨ã€‚</li><li><strong>OpenResty</strong>ï¼šæ˜¯åœ¨ Nginx ä¸Šé›†æˆäº† Lua-nginx-moduleï¼Œå…è®¸ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€æ‰©å±• Nginx çš„èƒ½åŠ›ã€‚</li><li><strong>KONG</strong>ï¼šåˆ™æ˜¯åœ¨ OpenResty åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†è‡ªå®šä¹‰æ¡†æ¶å’Œä¸€ç³»åˆ—ä¼ä¸šçº§åŠŸèƒ½å®ç°çš„ API ç½‘å…³ã€‚</li></ul><h2 id="Docker-å®‰è£…-KONG"><a href="#Docker-å®‰è£…-KONG" class="headerlink" title="Docker å®‰è£… KONG"></a>Docker å®‰è£… KONG</h2><p>å®‰è£… KONG çš„ä¸€ç§ä¾¿æ·æ–¹å¼æ˜¯ä½¿ç”¨ Dockerã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡ Docker è¿›è¡Œå®‰è£…ã€‚</p><h3 id="æ­¥éª¤-1ï¼šåˆ›å»ºå®¹å™¨ç½‘ç»œ"><a href="#æ­¥éª¤-1ï¼šåˆ›å»ºå®¹å™¨ç½‘ç»œ" class="headerlink" title="æ­¥éª¤ 1ï¼šåˆ›å»ºå®¹å™¨ç½‘ç»œ"></a>æ­¥éª¤ 1ï¼šåˆ›å»ºå®¹å™¨ç½‘ç»œ</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Docker ç½‘ç»œï¼Œä»¥ä¾¿å®¹å™¨é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> network create kong-net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ­¥éª¤-2ï¼šæ­å»ºæ•°æ®åº“"><a href="#æ­¥éª¤-2ï¼šæ­å»ºæ•°æ®åº“" class="headerlink" title="æ­¥éª¤ 2ï¼šæ­å»ºæ•°æ®åº“"></a>æ­¥éª¤ 2ï¼šæ­å»ºæ•°æ®åº“</h3><p>KONG æ”¯æŒ Cassandra å’Œ PostgreSQL æ•°æ®åº“ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥ PostgreSQL ä¸ºä¾‹ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºä¸€ä¸ªæ•°æ®å·</span><span class="token function">docker</span> volume create kong-volume<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®å·</span><span class="token function">docker</span> volume <span class="token function">ls</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> kong-database <span class="token punctuation">\</span><span class="token parameter variable">--network</span><span class="token operator">=</span>kong-net <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">5432</span>:5432 <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"POSTGRES_USER=konguser"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"POSTGRES_DB=kong"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"POSTGRES_PASSWORD=kongpwd"</span> <span class="token punctuation">\</span><span class="token comment"># æŒ‚è½½å·ä»¥ä¾¿æŒä¹…åŒ–æ•°æ®åˆ°å®¿ä¸»æœº</span><span class="token parameter variable">-v</span> kong-volume:/var/lib/postgresql/data <span class="token punctuation">\</span>postgres:9.6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-3ï¼šæ•°æ®åº“åˆå§‹åŒ–"><a href="#æ­¥éª¤-3ï¼šæ•°æ®åº“åˆå§‹åŒ–" class="headerlink" title="æ­¥éª¤ 3ï¼šæ•°æ®åº“åˆå§‹åŒ–"></a>æ­¥éª¤ 3ï¼šæ•°æ®åº“åˆå§‹åŒ–</h3><p>ä½¿ç”¨ <code>docker run --rm</code> æ¥åˆå§‹åŒ–æ•°æ®åº“ï¼Œè¯¥å‘½ä»¤æ‰§è¡Œåä¼šé€€å‡ºå®¹å™¨è€Œä¿ç•™å†…éƒ¨çš„æ•°æ®å·ã€‚å¹¶ä¸”ï¼Œè¦æ³¨æ„ï¼š<strong>ä¸€å®šè¦è·Ÿä½ å£°æ˜çš„ç½‘ç»œã€æ•°æ®åº“ç±»å‹ã€host åç§°ä¸€è‡´ã€‚</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--network</span><span class="token operator">=</span>kong-net <span class="token punctuation">\</span><span class="token comment"># å¦‚æœä½¿ç”¨çš„æ˜¯ Cassandra æ—¶ï¼Œåˆ™éœ€è¦è®¾å®šä¸º cassandra æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ PostgreSQL å› æ­¤åˆ™è®¾å®šä¸º postgres</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_DATABASE=postgres"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PG_HOST=kong-database"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PG_USER=konguser"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PG_PASSWORD=kongpwd"</span> <span class="token punctuation">\</span><span class="token comment"># ä¼ä¸šç‰ˆæ‰ä¼šç”¨åˆ°è¿™ä¸ªé…ç½®ï¼Œéä¼ä¸šç‰ˆè®¾å®šæ­¤å‚æ•°ä¹Ÿæ— æ‰€è°“</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PASSWORD=test"</span> <span class="token punctuation">\</span>kong/kong-gateway:3.4.1.1 kong migrations bootstrap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-4ï¼šå¯åŠ¨-KONG"><a href="#æ­¥éª¤-4ï¼šå¯åŠ¨-KONG" class="headerlink" title="æ­¥éª¤ 4ï¼šå¯åŠ¨ KONG"></a>æ­¥éª¤ 4ï¼šå¯åŠ¨ KONG</h3><p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨ KONG å®¹å™¨äº†ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> kong-gateway <span class="token punctuation">\</span><span class="token parameter variable">--network</span><span class="token operator">=</span>kong-net <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_DATABASE=postgres"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PG_HOST=kong-database"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PG_USER=konguser"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PG_PASSWORD=kongpwd"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PROXY_ACCESS_LOG=/dev/stdout"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_ADMIN_ACCESS_LOG=/dev/stdout"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_PROXY_ERROR_LOG=/dev/stderr"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_ADMIN_ERROR_LOG=/dev/stderr"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_ADMIN_LISTEN=0.0.0.0:8001"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"KONG_ADMIN_GUI_URL=http://localhost:8002"</span> <span class="token punctuation">\</span><span class="token comment"># ä»…ä»…ä¼ä¸šç‰ˆéœ€è¦è®¾å®šè¯ä¹¦</span><span class="token parameter variable">-e</span> KONG_LICENSE_DATA <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8443</span>:8443 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8001</span>:8001 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8444</span>:8444 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8002</span>:8002 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8445</span>:8445 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8003</span>:8003 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">8004</span>:8004 <span class="token punctuation">\</span>kong/kong-gateway:3.4.1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­¥éª¤-5ï¼šæ£€æŸ¥-KONG-æ˜¯å¦è¿è¡Œæ­£å¸¸"><a href="#æ­¥éª¤-5ï¼šæ£€æŸ¥-KONG-æ˜¯å¦è¿è¡Œæ­£å¸¸" class="headerlink" title="æ­¥éª¤ 5ï¼šæ£€æŸ¥ KONG æ˜¯å¦è¿è¡Œæ­£å¸¸"></a>æ­¥éª¤ 5ï¼šæ£€æŸ¥ KONG æ˜¯å¦è¿è¡Œæ­£å¸¸</h3><p>æœ€åï¼Œæˆ‘ä»¬æ¥æ£€æŸ¥ KONG æ˜¯å¦æˆåŠŸè¿è¡Œã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-X</span> GET <span class="token parameter variable">--url</span> http://<span class="token punctuation">{</span>YOUR_SERVER_IP<span class="token punctuation">}</span>:8001/services<span class="token comment"># ä½ ä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹ KONG ç®¡ç†ç•Œé¢</span>http://<span class="token punctuation">{</span>YOUR_SERVER_IP<span class="token punctuation">}</span>:8002<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼Œä½ å·²ç»æˆåŠŸåœ°åœ¨ Docker ä¸Šéƒ¨ç½²äº† KONGã€‚</p><h2 id="å®‰è£…-Konga"><a href="#å®‰è£…-Konga" class="headerlink" title="å®‰è£… Konga"></a>å®‰è£… Konga</h2><p>Konga æ˜¯ä¸€ä¸ªå¼€æºçš„ KONG ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°ç®¡ç†å’Œç›‘æ§ KONGã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„ Konga</span><span class="token function">docker</span> pull pantsel/konga<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤é¢„è£… Konga æ‰€éœ€çš„æ•°æ®åº“ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™é‡Œçš„ 172.18.0.2 è¦æ˜¯ kong-database å®¹å™¨çš„ IP åœ°å€</span><span class="token comment"># konguser å’Œ kongpwd æ˜¯å‰é¢å®‰è£… PostgreSQL æ˜¯ç”¨åˆ°çš„è´¦å·å’Œå¯†ç ï¼Œkonga æ•°æ®åº“ä¸“é—¨ä¸º Konga è®¾å®šï¼ˆæ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼Œå¦‚æœ konga æ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰</span><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> pantsel/konga <span class="token punctuation">\</span><span class="token parameter variable">--network</span><span class="token operator">=</span>kong-net <span class="token punctuation">\</span><span class="token parameter variable">-c</span> prepare <span class="token punctuation">\</span><span class="token parameter variable">-a</span> postgres <span class="token punctuation">\</span><span class="token parameter variable">-u</span> postgresql://konguser:kongpwd@172.18.0.2:5432/konga<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®‰è£… Kongaï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> konga <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">1337</span>:1337 <span class="token punctuation">\</span><span class="token parameter variable">--network</span> kong-net <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"NODE_ENV=production"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"DB_ADAPTER=postgres"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"DB_HOST=kong-database"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"DB_PORT=5432"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"DB_USER=konguser"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"DB_PASSWORD=kongpwd"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"DB_DATABASE=konga"</span> <span class="token punctuation">\</span>pantsel/konga<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://{YOUR_SERVER_IP}:1337</code> æ¥æ£€æµ‹å®‰è£…æ˜¯å¦æˆåŠŸã€‚ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œéœ€è¦æ³¨å†Œç®¡ç†å‘˜è´¦å·ï¼Œé€šè¿‡æ³¨å†Œä¹‹åï¼Œç„¶ååœ¨ CONNECTIONS ä¸­æ·»åŠ  Kong æœåŠ¡çš„ç®¡ç†è·¯å¾„ <code>http://kong-gateway:8001</code> ï¼ˆå› ä¸ºè¿™å‡ ä¸ªå®¹å™¨éƒ½è¿æ¥äº† kong-net ç½‘ç»œï¼Œå› æ­¤è¿™é‡Œå¯ä»¥é€šè¿‡å®¹å™¨åç§°ä½œä¸º IP åœ°å€ï¼Œäº¦å³è¿™é‡Œçš„ <code>kong-gateway</code>ï¼‰ å³å¯ç®¡ç† Kongã€‚</p><h2 id="å¦‚æœéœ€è¦æ¸…é™¤æ‰€æœ‰å®¹å™¨æ—¶"><a href="#å¦‚æœéœ€è¦æ¸…é™¤æ‰€æœ‰å®¹å™¨æ—¶" class="headerlink" title="å¦‚æœéœ€è¦æ¸…é™¤æ‰€æœ‰å®¹å™¨æ—¶"></a>å¦‚æœéœ€è¦æ¸…é™¤æ‰€æœ‰å®¹å™¨æ—¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">kill</span> kong-gateway<span class="token function">docker</span> <span class="token function">kill</span> kong-database<span class="token function">docker</span> <span class="token function">kill</span> konga<span class="token function">docker</span> container <span class="token function">rm</span> kong-gateway<span class="token function">docker</span> container <span class="token function">rm</span> kong-database<span class="token function">docker</span> container <span class="token function">rm</span> konga<span class="token function">docker</span> network <span class="token function">rm</span> kong-net<span class="token function">docker</span> volume <span class="token function">rm</span> kong-volume<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡æœ¬æ–‡çš„æ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ°åœ¨ Docker ä¸­å®‰è£…å’Œè¿è¡Œ KONG API ç½‘å…³ä»¥åŠ Konga ç®¡ç†ç•Œé¢ã€‚KONG æä¾›äº†å¼ºå¤§çš„ API ç®¡ç†åŠŸèƒ½ï¼Œè€Œ Konga åˆ™æä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢æ¥ç®¡ç† KONG çš„å„ä¸ªæ–¹é¢ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨ KONGï¼Œèµ¶å¿«åŠ¨æ‰‹è¯•è¯•å§ï¼</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> KONG </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Protobuf å®ç°é«˜æ•ˆæ•°æ®äº¤æ¢</title>
      <link href="posts/7940debf.html"/>
      <url>posts/7940debf.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å½“ä»Šçš„è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œæ•°æ®ä¼ è¾“çš„æ•ˆç‡å’Œæ ¼å¼åŒ–æ–¹å¼å°¤ä¸ºå…³é”®ã€‚Google å¼€å‘çš„ <strong>Protocol Buffers(Protobuf)</strong> æ˜¯ä¸€ç§è¯­è¨€æ— å…³çš„ã€å¹³å°æ— å…³çš„ã€é«˜æ•ˆã€å¯æ‰©å±•çš„åºåˆ—åŒ–æ ¼å¼ã€‚</p><p>å®ƒæä¾›äº†ä¸€ç§çµæ´»ã€é«˜æ•ˆã€è‡ªåŠ¨åŒ–çš„æ–¹å¼æ¥åºåˆ—åŒ–æ•°æ®ï¼Œè¢«å¹¿æ³›åº”ç”¨äºç½‘ç»œä¼ è¾“ã€é€šä¿¡åè®®å’Œæ•°æ®å­˜å‚¨ç­‰åœºæ™¯ã€‚</p><p>æœ¬æ–‡æ—¨åœ¨ä»‹ç» Protobuf çš„åŸºæœ¬æ¦‚å¿µã€ç±»å‹æ˜ å°„ã€åŸºæœ¬è¯­æ³•ï¼Œä»¥åŠä¸ RESTful API çš„å¯¹æ¯”ç­‰æ–¹é¢ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°äº†è§£å¹¶ä½¿ç”¨è¿™ä¸€æŠ€æœ¯ã€‚</p><h2 id="Protobuf-ç®€ä»‹"><a href="#Protobuf-ç®€ä»‹" class="headerlink" title="Protobuf ç®€ä»‹"></a>Protobuf ç®€ä»‹</h2><p>å®ƒä¸ä»…æ”¯æŒå¸¸è§çš„æ•°æ®ç±»å‹ï¼Œå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²ã€å­—èŠ‚åºåˆ—ç­‰ï¼Œè¿˜æ”¯æŒæšä¸¾ã€æ•°ç»„ï¼ˆé‡å¤å­—æ®µï¼‰ã€åµŒå¥—æ¶ˆæ¯ç­‰å¤æ‚ç±»å‹ã€‚Protobuf æ•°æ®æ˜¯ç»“æ„åŒ–çš„æ•°æ®ï¼Œç±»ä¼¼ JSONï¼Œä½†æ¯” JSON æ›´å°ã€æ›´å¿«ã€æ›´ç®€å•ã€‚</p><h2 id="å¸¸è§çš„-Protobuf-ç±»å‹æ˜ å°„"><a href="#å¸¸è§çš„-Protobuf-ç±»å‹æ˜ å°„" class="headerlink" title="å¸¸è§çš„ Protobuf ç±»å‹æ˜ å°„"></a>å¸¸è§çš„ Protobuf ç±»å‹æ˜ å°„</h2><p>ä¸ºäº†æ›´å¥½åœ°åœ¨ä¸åŒè¯­è¨€ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢ï¼ŒProtobuf å®šä¹‰äº†ä¸€å¥—ç±»å‹ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥æ˜ å°„åˆ°ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­çš„ç±»å‹ã€‚å¸¸è§çš„ç±»å‹æ˜ å°„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>.proto Type</th><th>Go Type</th><th>PHP Type</th></tr></thead><tbody><tr><td>double</td><td>float64</td><td>float</td></tr><tr><td>float</td><td>float32</td><td>float</td></tr><tr><td>int32</td><td>int32</td><td>integer</td></tr><tr><td>int64</td><td>int64</td><td>integer/string</td></tr><tr><td>uint32</td><td>uint32</td><td>integer</td></tr><tr><td>uint64</td><td>uint64</td><td>integer/string</td></tr><tr><td>sint32</td><td>int32</td><td>integer</td></tr><tr><td>sint64</td><td>int64</td><td>integer/string</td></tr><tr><td>fixed32</td><td>uint32</td><td>integer</td></tr><tr><td>fixed64</td><td>uint64</td><td>integer/string</td></tr><tr><td>sfixed32</td><td>int32</td><td>integer</td></tr><tr><td>sfixed64</td><td>int64</td><td>integer/string</td></tr><tr><td>bool</td><td>bool</td><td>boolean</td></tr><tr><td>string</td><td>string</td><td>string</td></tr><tr><td>bytes</td><td>[]byte</td><td>string</td></tr></tbody></table><h2 id="Protobuf-åŸºæœ¬è¯­æ³•"><a href="#Protobuf-åŸºæœ¬è¯­æ³•" class="headerlink" title="Protobuf åŸºæœ¬è¯­æ³•"></a>Protobuf åŸºæœ¬è¯­æ³•</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ª Protobuf æ–‡ä»¶çš„åŸºæœ¬ç»“æ„ç¤ºä¾‹ï¼Œå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ <code>HelloWorld</code> æœåŠ¡ï¼ŒåŒ…å«äº†å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ ¼å¼ã€‚</p><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token comment">// å£°æ˜ä½¿ç”¨ proto3 è¯­æ³•ï¼Œç›®å‰ä¸»æµæ¨èä½¿ç”¨ã€‚</span><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">"proto3"</span><span class="token punctuation">;</span><span class="token comment">// å£°æ˜åŒ…åï¼Œç”¨äºé¿å…å‘½åå†²çªã€‚</span><span class="token keyword">package</span> helloworld<span class="token punctuation">;</span><span class="token comment">// å®šä¹‰ä¸€ä¸ªæœåŠ¡ã€‚</span><span class="token keyword">service</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>    <span class="token comment">// å®šä¹‰ rpc æ–¹æ³•ï¼Œæ³¨æ„è¯·æ±‚å’Œå“åº”æ¶ˆæ¯çš„ç±»å‹ã€‚</span>    <span class="token keyword">rpc</span> <span class="token function">SayHello</span> <span class="token punctuation">(</span><span class="token class-name">HelloRequest</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token class-name">HelloReply</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// å®šä¹‰è¯·æ±‚æ¶ˆæ¯ã€‚</span><span class="token keyword">message</span> <span class="token class-name">HelloRequest</span> <span class="token punctuation">{</span>    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å­—æ®µåºå·ä¸º 1ã€‚</span><span class="token punctuation">}</span><span class="token comment">// å®šä¹‰å“åº”æ¶ˆæ¯ã€‚</span><span class="token keyword">message</span> <span class="token class-name">HelloReply</span> <span class="token punctuation">{</span>    <span class="token builtin">string</span> message <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å­—æ®µåºå·ä¸º 1ã€‚</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§å®šä¹‰æ–¹å¼éå¸¸ç±»ä¼¼äºç¼–ç¨‹è¯­è¨€ä¸­çš„æ¥å£å®šä¹‰ï¼Œä½†å®ƒæ›´å…³æ³¨äºæ•°æ®çš„ç»“æ„è€Œéå…·ä½“é€»è¾‘å¤„ç†ã€‚</p><h2 id="gRPC-ä¸-RESTful-API-å¯¹æ¯”"><a href="#gRPC-ä¸-RESTful-API-å¯¹æ¯”" class="headerlink" title="gRPC ä¸ RESTful API å¯¹æ¯”"></a>gRPC ä¸ RESTful API å¯¹æ¯”</h2><p>åœ¨ç°ä»£å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒgRPC å’Œ RESTful API æ˜¯ä¸¤ç§æµè¡Œçš„æœåŠ¡é—´é€šä¿¡æ–¹å¼ã€‚å®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>gRPC</th><th>RESTful API</th></tr></thead><tbody><tr><td>è§„èŒƒ</td><td>å¿…é¡»ä½¿ç”¨ .proto</td><td>å¯é€‰ OpenAPI</td></tr><tr><td>åè®®</td><td>HTTP/2</td><td>ä»»æ„ç‰ˆæœ¬çš„ HTTP åè®®</td></tr><tr><td>æœ‰æ•ˆè½½è·</td><td>Protobufï¼ˆå°ã€äºŒè¿›åˆ¶ï¼‰</td><td>JSONï¼ˆå¤§ã€æ˜“è¯»ï¼‰</td></tr><tr><td>æµè§ˆå™¨æ”¯æŒ</td><td>éœ€è¦ grpc-web</td><td>æ˜¯</td></tr><tr><td>æµä¼ è¾“</td><td>å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€åŒå‘</td><td>å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯</td></tr><tr><td>ä»£ç ç”Ÿæˆ</td><td>æ˜¯</td><td>OpenAPI+ ç¬¬ä¸‰æ–¹å·¥å…·</td></tr></tbody></table><h2 id="ç‰¹æ®Šç±»å‹å¤„ç†"><a href="#ç‰¹æ®Šç±»å‹å¤„ç†" class="headerlink" title="ç‰¹æ®Šç±»å‹å¤„ç†"></a>ç‰¹æ®Šç±»å‹å¤„ç†</h2><p>åœ¨ Protobuf ä¸­ï¼Œæä¾›äº† <code>oneof</code>, <code>enum</code>, å’Œ <code>map</code> ç­‰ç‰¹æ®Šç±»å‹ï¼Œä»¥æ”¯æŒæ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p><ul><li><strong>oneof</strong>ï¼šä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œç¡®ä¿æ¶ˆæ¯ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªå­—æ®µè¢«è®¾ç½®ã€‚</li></ul><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token keyword">message</span> <span class="token class-name">HelloRequest</span> <span class="token punctuation">{</span>    <span class="token keyword">oneof</span> name <span class="token punctuation">{</span>        <span class="token builtin">string</span> nick_name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token builtin">string</span> true_name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>enum</strong>ï¼šæšä¸¾ç±»å‹ï¼Œç”¨æ¥é™å®šå­—æ®µå¯ä»¥æ¥æ”¶çš„é¢„å®šä¹‰çš„å€¼ã€‚</li></ul><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token comment">// å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»å‹ NameTypeã€‚</span><span class="token keyword">enum</span> <span class="token class-name">NameType</span> <span class="token punctuation">{</span>    NickName <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    TrueName <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// åœ¨æ¶ˆæ¯ä¸­ä½¿ç”¨æšä¸¾ç±»å‹ã€‚</span><span class="token keyword">message</span> <span class="token class-name">HelloRequest</span> <span class="token punctuation">{</span>    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// æ™®é€šå­—æ®µã€‚</span>    <span class="token positional-class-name class-name">NameType</span> nameType <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// æšä¸¾å­—æ®µã€‚</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>map</strong>ï¼šç”¨æ¥å®šä¹‰é”®å€¼å¯¹çš„é›†åˆï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„å­—å…¸æˆ–æ˜ å°„ç±»å‹ã€‚</li></ul><pre class="line-numbers language-protobuf" data-language="protobuf"><code class="language-protobuf"><span class="token keyword">message</span> <span class="token class-name">HelloRequest</span> <span class="token punctuation">{</span>    <span class="token map class-name">map<span class="token punctuation">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¸€ä¸ªé”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ mapã€‚</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Protobuf æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå°¤å…¶é€‚åˆåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚é€šè¿‡æ˜ç¡®çš„ç±»å‹å®šä¹‰å’Œè§„èŒƒçš„æ•°æ®ç»“æ„ï¼ŒProtobuf èƒ½å¤Ÿç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åŒæ—¶ï¼Œé€šè¿‡ gRPC è¿™æ ·çš„ RPC æ¡†æ¶ï¼ŒProtobuf èƒ½å¤Ÿå‘æŒ¥æ›´å¤§çš„ä½œç”¨ï¼Œå®ç°é«˜æ€§èƒ½çš„è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚</p><p>å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œä½ èƒ½å¤Ÿåˆæ­¥æŒæ¡ Protobuf çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¸ºä½ çš„é¡¹ç›®å¸¦æ¥æ€§èƒ½ä¸Šçš„é£è·ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Protobuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€è®¾è®¡æ¨¡å¼ï¼šä½¿ç”¨Optionæ¨¡å¼ç®€åŒ–ç±»çš„åˆå§‹åŒ–</title>
      <link href="posts/d24ea952.html"/>
      <url>posts/d24ea952.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ„é€ å‚æ•°ä¼—å¤šçš„ç±»æ—¶ï¼Œä¸ä»…ä½¿å¾—ä»£ç éš¾ä»¥é˜…è¯»ï¼Œè€Œä¸”åœ¨å‚æ•°è¾ƒå¤šæ—¶ï¼Œè°ƒç”¨è€…éœ€è¦è®°ä½æ¯ä¸ªå‚æ•°çš„é¡ºåºå’Œç±»å‹ï¼Œè¿™æ— ç–‘å¢åŠ äº†ä½¿ç”¨çš„å¤æ‚æ€§ï¼Œä»£ç å¾€å¾€å˜å¾—éš¾ä»¥ç®¡ç†ã€‚</p><p>Go è¯­è¨€è™½ç„¶ä¸æ”¯æŒä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç±»ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç»“æ„ä½“å’Œå‡½æ•°æ¥æ¨¡æ‹Ÿé¢å‘å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸€ç§ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆâ€”â€”Option æ¨¡å¼ã€‚</p><h2 id="ä¼ ç»Ÿçš„æ„é€ å‡½æ•°æ–¹æ³•"><a href="#ä¼ ç»Ÿçš„æ„é€ å‡½æ•°æ–¹æ³•" class="headerlink" title="ä¼ ç»Ÿçš„æ„é€ å‡½æ•°æ–¹æ³•"></a>ä¼ ç»Ÿçš„æ„é€ å‡½æ•°æ–¹æ³•</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼Œåœ¨ Go è¯­è¨€ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>Foo</code> ç±»ï¼Œå®ƒæœ‰å››ä¸ªå­—æ®µï¼š<code>name</code>ã€<code>id</code>ã€<code>age</code> å’Œ <code>db</code>ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> newdemo<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>   name <span class="token builtin">string</span>   id <span class="token builtin">int</span>   age <span class="token builtin">int</span>   db <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">NewFoo</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> id <span class="token builtin">int</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">,</span> db <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">*</span>Foo <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token operator">&amp;</span>Foo<span class="token punctuation">{</span>      name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>      id<span class="token punctuation">:</span>   id<span class="token punctuation">,</span>      age<span class="token punctuation">:</span>  age<span class="token punctuation">,</span>      db<span class="token punctuation">:</span>   db<span class="token punctuation">,</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    foo <span class="token operator">:=</span> <span class="token function">NewFoo</span><span class="token punctuation">(</span><span class="token string">"jianfengye"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// éœ€è¦è®°ä½æ¯ä¸ªå‚æ•°çš„é¡ºåºå’Œç±»å‹</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹æ³•åœ¨å‚æ•°è¾ƒå°‘æ—¶å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†éšç€å‚æ•°æ•°é‡çš„å¢åŠ ï¼Œå…¶å±€é™æ€§ä¹Ÿè¶Šæ¥è¶Šæ˜æ˜¾ã€‚</p><h2 id="å¼•å…¥-Option-æ¨¡å¼"><a href="#å¼•å…¥-Option-æ¨¡å¼" class="headerlink" title="å¼•å…¥ Option æ¨¡å¼"></a>å¼•å…¥ Option æ¨¡å¼</h2><p>Option æ¨¡å¼é€šè¿‡ä½¿ç”¨å‡½æ•°é€‰é¡¹æ¥æ„å»ºå¯¹è±¡ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æ›´ä¸ºçµæ´»å’Œå¯æ‰©å±•çš„æ–¹å¼æ¥é…ç½®ç±»çš„å®ä¾‹ã€‚è¿™ç§æ¨¡å¼å…è®¸æˆ‘ä»¬åœ¨ä¸æ”¹å˜æ„é€ å‡½æ•°ç­¾åçš„æƒ…å†µä¸‹ï¼Œçµæ´»åœ°æ·»åŠ æ›´å¤šçš„é…ç½®é€‰é¡¹ã€‚</p><p>æ”¹é€ åçš„ <code>Foo</code> ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> newdemo<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span> name <span class="token builtin">string</span> id <span class="token builtin">int</span> age <span class="token builtin">int</span> db <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// FooOption ä»£è¡¨å¯é€‰å‚æ•°</span><span class="token keyword">type</span> FooOption <span class="token keyword">func</span><span class="token punctuation">(</span>foo <span class="token operator">*</span>Foo<span class="token punctuation">)</span><span class="token comment">// WithName ä¸º name å­—æ®µæä¾›ä¸€ä¸ªè®¾ç½®å™¨</span><span class="token keyword">func</span> <span class="token function">WithName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> FooOption <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>foo <span class="token operator">*</span>Foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>      foo<span class="token punctuation">.</span>name <span class="token operator">=</span> name   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// WithAge ä¸º age å­—æ®µæä¾›ä¸€ä¸ªè®¾ç½®å™¨</span><span class="token keyword">func</span> <span class="token function">WithAge</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> FooOption <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>foo <span class="token operator">*</span>Foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>      foo<span class="token punctuation">.</span>age <span class="token operator">=</span> age   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// WithDB ä¸º db å­—æ®µæä¾›ä¸€ä¸ªè®¾ç½®å™¨</span><span class="token keyword">func</span> <span class="token function">WithDB</span><span class="token punctuation">(</span>db <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> FooOption <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>foo <span class="token operator">*</span>Foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>      foo<span class="token punctuation">.</span>db <span class="token operator">=</span> db   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// NewFoo åˆ›å»º Foo å®ä¾‹çš„æ„é€ å‡½æ•°ï¼Œidä¸ºå¿…ä¼ å‚æ•°ï¼Œå…¶ä»–ä¸ºå¯é€‰</span><span class="token keyword">func</span> <span class="token function">NewFoo</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> options <span class="token operator">...</span>FooOption<span class="token punctuation">)</span> <span class="token operator">*</span>Foo <span class="token punctuation">{</span>   foo <span class="token operator">:=</span> <span class="token operator">&amp;</span>Foo<span class="token punctuation">{</span>      name<span class="token punctuation">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>      id<span class="token punctuation">:</span>   id<span class="token punctuation">,</span>      age<span class="token punctuation">:</span>  <span class="token number">10</span><span class="token punctuation">,</span>      db<span class="token punctuation">:</span>   <span class="token boolean">nil</span><span class="token punctuation">,</span>   <span class="token punctuation">}</span>   <span class="token comment">// éå†æ¯ä¸ªé€‰é¡¹å¹¶åº”ç”¨å®ƒä»¬</span>   <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> option <span class="token operator">:=</span> <span class="token keyword">range</span> options <span class="token punctuation">{</span>      <span class="token function">option</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>   <span class="token punctuation">}</span>   <span class="token keyword">return</span> foo<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// ä½¿ç”¨ Option æ¨¡å¼ï¼Œä»…ä¼ é€’éœ€è¦è®¾ç½®çš„å­—æ®µ</span>    foo <span class="token operator">:=</span> <span class="token function">NewFoo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">WithAge</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WithName</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h2><ol><li><strong>çµæ´»æ€§å’Œå¯è¯»æ€§</strong>ï¼šè°ƒç”¨è€…åªéœ€è¦å…³æ³¨ä»–ä»¬å…³å¿ƒçš„é€‰é¡¹ï¼Œå¿½ç•¥å…¶ä»–é»˜è®¤é…ç½®ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šæ–°å¢é€‰é¡¹ä¸éœ€è¦æ›´æ”¹æ„é€ å‡½æ•°çš„ç­¾åï¼Œå¯¹æ—§ä»£ç æ— å½±å“ã€‚</li><li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šä½¿ç”¨é€‰é¡¹å‡½æ•°æ„å‘³ç€æ‰€æœ‰çš„è®¾ç½®é€»è¾‘è¢«å°è£…èµ·æ¥ï¼Œæ˜“äºç®¡ç†å’Œç»´æŠ¤ã€‚</li></ol><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Option æ¨¡å¼æ˜¯ä¸€ç§å¼ºå¤§ä¸”çµæ´»çš„æ–¹å¼ï¼Œç”¨äºåœ¨ Go è¯­è¨€ä¸­åˆå§‹åŒ–å¤æ‚å¯¹è±¡ï¼Œç‰¹åˆ«é€‚åˆäºæœ‰å¤šä¸ªé…ç½®é€‰é¡¹çš„æƒ…å†µã€‚é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ·»åŠ æˆ–è€…ä¿®æ”¹å®ä¾‹çš„é…ç½®ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§ã€‚å°½ç®¡åˆšå¼€å§‹å¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„å·¥ä½œæ¥å®ç°ï¼Œä½†é•¿è¿œæ¥çœ‹ï¼Œå®ƒå°†æå¤§åœ°æå‡æˆ‘ä»¬ä»£ç çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go è¯­è¨€æ€§èƒ½ä¼˜åŒ–æŠ€å·§</title>
      <link href="posts/2a37659b.html"/>
      <url>posts/2a37659b.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæ€§èƒ½å¾€å¾€æ˜¯æˆ‘ä»¬éœ€è¦ç‰¹åˆ«å…³æ³¨çš„æ–¹é¢ä¹‹ä¸€ã€‚å¯¹äºä½¿ç”¨ Go è¯­è¨€çš„å¼€å‘è€…è€Œè¨€ï¼Œå¦‚ä½•ç¼–å†™é«˜æ€§èƒ½çš„ä»£ç æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘ç‚¹ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘å°†åˆ†äº«ä¸€äº›åœ¨ Go è¯­è¨€å¼€å‘ä¸­å¯ä»¥é‡‡å–çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶å†™å‡ºæ›´é«˜æ•ˆçš„ç¨‹åºã€‚</p><h2 id="æ•°å­—ä¸å­—ç¬¦ä¸²çš„è½¬æ¢"><a href="#æ•°å­—ä¸å­—ç¬¦ä¸²çš„è½¬æ¢" class="headerlink" title="æ•°å­—ä¸å­—ç¬¦ä¸²çš„è½¬æ¢"></a>æ•°å­—ä¸å­—ç¬¦ä¸²çš„è½¬æ¢</h2><p>åœ¨å¤„ç†æ•°å­—å’Œå­—ç¬¦ä¸²çš„è½¬æ¢æ—¶ï¼Œ<code>strconv.Itoa()</code> é€šå¸¸æ¯” <code>fmt.Sprintf()</code> æ›´åŠ é«˜æ•ˆã€‚</p><h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"strconv"</span><span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨ strconv.Itoa() è¿›è¡Œè½¬æ¢</span>num <span class="token operator">:=</span> <span class="token number">123</span>str <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨ fmt.Sprintf() è¿›è¡Œè½¬æ¢</span>str2 <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>strconv.Itoa()</code> çš„é€Ÿåº¦å¤§çº¦æ˜¯ <code>fmt.Sprintf()</code> çš„ä¸¤å€ï¼Œå› ä¸ºåè€…éœ€è¦è§£ææ ¼å¼å­—ç¬¦ä¸²ï¼Œè€Œå‰è€…ç›´æ¥è¿›è¡Œè½¬æ¢ã€‚</p><h2 id="å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡çš„è½¬æ¢"><a href="#å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡çš„è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡çš„è½¬æ¢"></a>å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡çš„è½¬æ¢</h2><p>å°½å¯èƒ½é¿å…å°† <code>string</code> è½¬æ¢ä¸º <code>[]byte</code>ã€‚è¿™ä¸ªæ“ä½œä¼šå¢åŠ é¢å¤–çš„å†…å­˜æ‹·è´ï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚</p><h2 id="å¤„ç†åˆ‡ç‰‡æ—¶çš„æ€§èƒ½ä¼˜åŒ–"><a href="#å¤„ç†åˆ‡ç‰‡æ—¶çš„æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="å¤„ç†åˆ‡ç‰‡æ—¶çš„æ€§èƒ½ä¼˜åŒ–"></a>å¤„ç†åˆ‡ç‰‡æ—¶çš„æ€§èƒ½ä¼˜åŒ–</h2><p>åœ¨ä½¿ç”¨ <code>for-loop</code> å¯¹ <code>Slice</code> è¿›è¡Œ <code>append</code> æ“ä½œæ—¶ï¼Œè¯·å…ˆåˆ†é…è¶³å¤Ÿçš„å®¹é‡ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -1"><a href="#ç¤ºä¾‹ä»£ç -1" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ä¸æ¨èçš„åšæ³•</span><span class="token keyword">var</span> nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>    nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// æ¨èçš„åšæ³•</span>nums <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// é¢„åˆ†é…è¶³å¤Ÿçš„å®¹é‡</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>    nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å®¹é‡ï¼Œå¯ä»¥é¿å…åœ¨ <code>append</code> è¿‡ç¨‹ä¸­å‘ç”Ÿå†…å­˜é‡æ–°åˆ†é…ã€‚</p><h2 id="å­—ç¬¦ä¸²çš„æ‹¼æ¥"><a href="#å­—ç¬¦ä¸²çš„æ‹¼æ¥" class="headerlink" title="å­—ç¬¦ä¸²çš„æ‹¼æ¥"></a>å­—ç¬¦ä¸²çš„æ‹¼æ¥</h2><p>ä½¿ç”¨ <code>strings.Builder</code> å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œæ€§èƒ½è¿œé«˜äºä½¿ç”¨ <code>+</code> æˆ– <code>+=</code>ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -2"><a href="#ç¤ºä¾‹ä»£ç -2" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"strings"</span><span class="token comment">// ä½¿ç”¨ strings.Builder è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥</span><span class="token keyword">var</span> builder strings<span class="token punctuation">.</span>Builder<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>    builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>result <span class="token operator">:=</span> builder<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h2><p>åˆ©ç”¨ Go è¯­è¨€çš„å¼ºå¤§å¹¶å‘ç‰¹æ€§ã€‚ä½¿ç”¨å¹¶å‘çš„ <code>goroutine</code> å¹¶é…åˆ <code>sync.WaitGroup</code> è¿›è¡ŒåŒæ­¥ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -3"><a href="#ç¤ºä¾‹ä»£ç -3" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"sync"</span><span class="token punctuation">)</span><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>    wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// ä½ çš„ä»£ç é€»è¾‘</span>    <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span>wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ…ç”¨å†…å­˜åˆ†é…"><a href="#æ…ç”¨å†…å­˜åˆ†é…" class="headerlink" title="æ…ç”¨å†…å­˜åˆ†é…"></a>æ…ç”¨å†…å­˜åˆ†é…</h2><p>é¿å…åœ¨æ€§èƒ½æ•æ„Ÿçš„ä»£ç ï¼ˆçƒ­ä»£ç ï¼‰ä¸­é¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…ï¼Œä»¥å‡å°‘åƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚</p><h2 id="å¯¹è±¡é‡ç”¨"><a href="#å¯¹è±¡é‡ç”¨" class="headerlink" title="å¯¹è±¡é‡ç”¨"></a>å¯¹è±¡é‡ç”¨</h2><p>ä½¿ç”¨ <code>sync.Pool</code> æ¥é‡ç”¨å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½å†…å­˜åˆ†é…çš„é¢‘ç‡å’Œåƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">pool <span class="token operator">:=</span> sync<span class="token punctuation">.</span>Pool<span class="token punctuation">{</span>    New<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>MyStruct<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span>myVar <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>MyStruct<span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨ myVar åï¼Œè®°å¾—æ”¾å›æ± ä¸­</span>pool<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>myVar<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ— é”ç¼–ç¨‹"><a href="#æ— é”ç¼–ç¨‹" class="headerlink" title="æ— é”ç¼–ç¨‹"></a>æ— é”ç¼–ç¨‹</h2><p>å°½å¯èƒ½é‡‡ç”¨æ— é”æ“ä½œï¼Œæ¯”å¦‚ä½¿ç”¨ <code>sync/atomic</code> åŒ…ä¸­çš„åŸå­æ“ä½œï¼Œä»¥é¿å…é”çš„å¼€é”€ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ä½¿ç”¨ Atomic åŒ…è¿›è¡ŒåŸå­æ“ä½œ</span><span class="token keyword">var</span> counter <span class="token builtin">int64</span>sync<span class="token operator">/</span>atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>counter<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="I-O-ç¼“å†²"><a href="#I-O-ç¼“å†²" class="headerlink" title="I/O ç¼“å†²"></a>I/O ç¼“å†²</h2><p>I/O æ“ä½œæ˜¯éå¸¸æ…¢çš„ï¼Œä½¿ç”¨ç¼“å†² I/Oï¼ˆå¦‚ <code>bufio.NewWriter()</code> å’Œ <code>bufio.NewReader()</code>ï¼‰å¯ä»¥æ˜¾è‘—æå‡ I/O æ€§èƒ½ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ä½¿ç”¨ bufio åŒ…è¿›è¡Œ I/O ç¼“å†²</span>writer <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token keyword">defer</span> writer<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"Hello, World"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–"><a href="#æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–"></a>æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–</h2><p>åœ¨å¾ªç¯å†…éƒ¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œåº”å…ˆç”¨ <code>regexp.Compile()</code> å°†å…¶ç¼–è¯‘ï¼Œä»¥æå‡æ€§èƒ½ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">re <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">"some-regex-pattern"</span><span class="token punctuation">)</span>matches <span class="token operator">:=</span> re<span class="token punctuation">.</span><span class="token function">FindAllString</span><span class="token punctuation">(</span><span class="token string">"some string"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="åºåˆ—åŒ–æ€§èƒ½é€‰æ‹©"><a href="#åºåˆ—åŒ–æ€§èƒ½é€‰æ‹©" class="headerlink" title="åºåˆ—åŒ–æ€§èƒ½é€‰æ‹©"></a>åºåˆ—åŒ–æ€§èƒ½é€‰æ‹©</h2><p>å¦‚æœå¯¹æ€§èƒ½æœ‰é«˜è¦æ±‚ï¼Œè€ƒè™‘ä½¿ç”¨ <code>protobuf</code> æˆ– <code>msgp</code> ç­‰åºåˆ—åŒ–æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯ <code>json</code>ï¼Œå› ä¸º <code>json</code> åºåˆ—åŒ–æ¶‰åŠåå°„ï¼Œæ€§èƒ½è¾ƒä½ã€‚</p><h2 id="Map-ä½¿ç”¨æŠ€å·§"><a href="#Map-ä½¿ç”¨æŠ€å·§" class="headerlink" title="Map ä½¿ç”¨æŠ€å·§"></a>Map ä½¿ç”¨æŠ€å·§</h2><p>åœ¨ä½¿ç”¨ <code>map</code> æ—¶ï¼Œæ•´å‹ä½œä¸ºé”®çš„æ€§èƒ½ä¼šæ¯”å­—ç¬¦ä¸²é«˜ï¼Œè¿™æ˜¯å› ä¸ºæ•´å‹çš„æ¯”è¾ƒæ“ä½œæ¯”å­—ç¬¦ä¸²æ¯”è¾ƒè¦å¿«ã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ä½¿ç”¨æ•´å‹ä½œä¸º Map çš„ key</span>mapInt <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"two"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>å¦‚æœéœ€è¦æŠŠæ•°å­—è½¬æ¢æˆå®‡ç¬¦ä¸²ï¼Œä½¿ç”¨ <code>strconv.ltoa()</code> æ¯” <code>fmt.Sprintf()</code> è¦å¿«ä¸€å€å·¦å³ã€‚</li><li>å°½å¯èƒ½é¿å…æŠŠ <code>String</code> è½¬æˆ <code>[]Byte</code>ï¼Œè¿™ä¸ªè½¬æ¢ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li><li>å¦‚æœåœ¨ <code>for-loop</code> é‡Œå¯¹æŸä¸ª <code>Slice</code> ä½¿ç”¨ <code>append()</code>ï¼Œè¯·å…ˆæŠŠ <code>Slice</code> çš„å®¹é‡æ‰©å……åˆ°ä½ï¼Œè¿™æ ·å¯ä»¥é¿å…å†…å­˜é‡æ–°åˆ†é…ä»¥åŠç³»ç»Ÿè‡ªåŠ¨æŒ‰ 2 çš„ N æ¬¡æ–¹å¹‚è¿›è¡Œæ‰©å±•ä½†åˆç”¨ä¸åˆ°çš„æƒ…å†µï¼Œä»è€Œé¿å…æµªè´¹å†…å­˜ã€‚</li><li>ä½¿ç”¨ <code>StringBuffer</code> æˆ–æ˜¯ <code>StringBuild</code> æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ€§èƒ½ä¼šæ¯”ä½¿ç”¨ <code>+</code> æˆ– <code>+=</code> é«˜ä¸‰åˆ°å››ä¸ªæ•°é‡çº§ã€‚</li><li>å°½å¯èƒ½ä½¿ç”¨å¹¶å‘çš„ <code>goroutine</code> ç„¶åä½¿ç”¨ <code>sync.WaitGroup</code> æ¥åŒæ­¥åˆ†ç‰‡æ“ä½œã€‚</li><li>é¿å…åœ¨çƒ­ä»£ç ä¸­è¿›è¡Œå†…å­˜åˆ†é…ï¼Œè¿™æ ·ä¼šå¯¼è‡´ <code>gc</code> å¾ˆå¿™ã€‚</li><li>å°½å¯èƒ½ä½¿ç”¨ <code>sync.Pool</code> æ¥é‡ç”¨å¯¹è±¡ã€‚</li><li>ä½¿ç”¨ <code>lock-free</code> çš„æ“ä½œï¼Œé¿å…ä½¿ç”¨ <code>mutex</code>ï¼Œå°½å¯èƒ½ä½¿ç”¨ <code>sync/Atomic</code> åŒ…ã€‚</li><li>ä½¿ç”¨ <code>I/O</code> ç¼“å†²ï¼Œ<code>I/O</code> æ˜¯ä¸ªéå¸¸éå¸¸æ…¢çš„æ“ä½œï¼Œä½¿ç”¨ <code>bufio.NewWrite()</code> å’Œ <code>bufio.NewReader()</code> å¯ä»¥å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚</li><li>å¯¹äºåœ¨ <code>for-loop</code> é‡Œçš„å›ºå®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€å®šè¦ä½¿ç”¨ <code>regexp.Compile()</code> ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ã€‚æ€§èƒ½ä¼šæå‡ä¸¤ä¸ªæ•°é‡çº§ã€‚</li><li>å¦‚æœä½ éœ€è¦æ›´é«˜æ€§èƒ½çš„åè®®ï¼Œå°±è¦è€ƒè™‘ä½¿ç”¨ <code>protobuf</code> æˆ– <code>msgp</code> è€Œä¸æ˜¯ <code>json</code>ï¼Œå› ä¸º <code>json</code> çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–é‡Œä½¿ç”¨äº†åå°„ã€‚</li><li>ä½ åœ¨ä½¿ç”¨ <code>Map</code> çš„æ—¶å€™ï¼Œä½¿ç”¨æ•´å‹çš„ <code>key</code> ä¼šæ¯”å­—ç¬¦ä¸²çš„è¦å¿«ï¼Œå› ä¸ºæ•´å‹æ¯”è¾ƒæ¯”å­—ç¬¦ä¸²æ¯”è¾ƒè¦å¿«ã€‚</li></ul><p>é€šè¿‡ä¸Šè¿°çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–å†™ Go ç¨‹åºæ—¶æ›´åŠ æ³¨é‡æ€§èƒ½ã€‚ä»å­—ç¬¦ä¸²å¤„ç†åˆ°å¹¶å‘æ§åˆ¶ï¼Œå†åˆ°å†…å­˜ç®¡ç†ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½æœ‰æå‡æ•ˆç‡çš„ç©ºé—´ã€‚å¸Œæœ›è¿™äº›æŠ€å·§èƒ½å¤Ÿå¸®åŠ©ä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­å†™å‡ºæ›´é«˜æ•ˆã€æ›´ä¼˜åŒ–çš„ä»£ç ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èŠèŠ Go ä¸­çš„å•ä¾‹æ¨¡å¼</title>
      <link href="posts/1b8de6f.html"/>
      <url>posts/1b8de6f.html</url>
      
        <content type="html"><![CDATA[<p>å•ä¾‹æ¨¡å¼åœ¨è½¯ä»¶å¼€å‘ä¸­æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç¡®ä¿ä¸€ä¸ªç±»åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚</p><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œå®ç°å•ä¾‹æ¨¡å¼é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š<strong>é¥¿æ±‰å¼</strong> å’Œ <strong>æ‡’æ±‰å¼</strong>ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†äº†è§£è¿™ä¸¤ç§å®ç°æ–¹å¼ï¼Œå¹¶é€šè¿‡ç®€å•æ˜“æ‡‚çš„ä»£ç ç¤ºä¾‹è§£é‡Šç›¸å…³æ¦‚å¿µã€‚</p><h2 id="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼"><a href="#é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼" class="headerlink" title="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼"></a>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</h2><p>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ã€‚ç”±äº Go è¯­è¨€ä¸åŒäº Javaï¼Œæ²¡æœ‰æ˜¾å¼çš„ç±»æ¦‚å¿µï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç»“æ„ä½“æ¥æ¨¡æ‹Ÿç±»çš„è¡Œä¸ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„å®ç°ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</span><span class="token keyword">package</span> main<span class="token keyword">type</span> singleton <span class="token keyword">struct</span> <span class="token punctuation">{</span>    count <span class="token builtin">int</span><span class="token punctuation">}</span><span class="token comment">// é¥¿æ±‰å¼å•ä¾‹ï¼Œç¨‹åºå¯åŠ¨å³åˆå§‹åŒ–</span><span class="token keyword">var</span> Instance <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>singleton<span class="token punctuation">)</span><span class="token comment">// Add æ–¹æ³•ç”¨äºç´¯åŠ å¹¶è¿”å›è®¡æ•°å€¼</span><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>singleton<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>    s<span class="token punctuation">.</span>count<span class="token operator">++</span>    <span class="token keyword">return</span> s<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>singleton</code> ç»“æ„ä½“ï¼Œå¹¶åœ¨ç¨‹åºå¯åŠ¨æ—¶é€šè¿‡ <code>var</code> å£°æ˜å³åˆå§‹åŒ–äº† <code>Instance</code>ã€‚è¿™æ ·å°±ä¿è¯äº† <code>Instance</code> æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¹¶ä¸”åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰å°±å·²ç»å‡†å¤‡å¥½äº†ã€‚</p><h2 id="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼"><a href="#æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼" class="headerlink" title="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼"></a>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼</h2><p>ä¸é¥¿æ±‰å¼ç›¸æ¯”ï¼Œæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼åœ¨ç¬¬ä¸€æ¬¡éœ€è¦æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œå¯ä»¥å»¶è¿Ÿåˆå§‹åŒ–èµ„æºã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥èŠ‚çœèµ„æºï¼Œä½†éœ€è¦è€ƒè™‘å¹¶å‘ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://zh.wikipedia.org/wiki/%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E6%A8%A1%E5%BC%8F">åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼</a> ï¼ˆDouble-checked Lockingï¼‰æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>ä¸‹é¢æ˜¯æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„å®ç°ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼</span><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"sync"</span><span class="token punctuation">)</span><span class="token keyword">type</span> singleton <span class="token keyword">struct</span> <span class="token punctuation">{</span>count <span class="token builtin">int</span><span class="token punctuation">}</span><span class="token keyword">var</span> <span class="token punctuation">(</span>instance <span class="token operator">*</span>singletonmutex    sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">)</span><span class="token comment">// New å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡</span><span class="token comment">// è¿™é‡Œé‡‡ç”¨äº†ã€åŒé‡æ£€æŸ¥ã€‘</span><span class="token comment">// å‡è®¾ goroutine X å’Œ Y å‡ ä¹åŒæ—¶è°ƒç”¨ New å‡½æ•°</span><span class="token comment">// å½“å®ƒä»¬åŒæ—¶è¿›å…¥æ­¤å‡½æ•°æ—¶ï¼Œinstance å˜é‡å€¼æ˜¯ nil å› æ­¤ goroutine X å’Œ Y ä¼šåŒæ—¶åˆ°è¾¾ã€ä½ç½®1ã€‘</span><span class="token comment">// å‡è®¾ goroutine X ä¼šå…ˆåˆ°è¾¾ã€ä½ç½®2ã€‘ï¼Œå¹¶è¿›å…¥ mutex.Lock() åˆ°è¾¾ã€ä½ç½®3ã€‘ï¼Œè¿™æ—¶ï¼Œç”±äº mutex.Lock() çš„åŒæ­¥é™åˆ¶</span><span class="token comment">// goroutine Y æ— æ³•åˆ°è¾¾ã€ä½ç½®3ã€‘åªèƒ½åœ¨ã€ä½ç½®2ã€‘ç­‰å€™</span><span class="token comment">// goroutine X æ‰§è¡Œ instance = new(singleton) è¯­å¥ï¼Œä½¿å¾— instance å˜é‡å¾—åˆ°ä¸€ä¸ªå€¼ï¼Œæ­¤æ—¶ goroutine Y è¿˜æ˜¯åªèƒ½åœ¨ã€ä½ç½®2ã€‘ç­‰å€™</span><span class="token comment">// goroutine X é‡Šæ”¾é”ï¼Œè¿”å› instance å˜é‡ï¼Œé€€å‡º New å‡½æ•°</span><span class="token comment">// goroutine Y è¿›å…¥ mutex.Lock() åˆ°è¾¾ã€ä½ç½®3ã€‘ï¼Œè¿›è€Œåˆ°è¾¾ã€ä½ç½®4ã€‘ã€‚ç”±äºæ­¤æ—¶ instance å˜é‡å·²ç»ä¸æ˜¯ nilï¼Œå› æ­¤ goroutine Y é‡Šæ”¾é”</span><span class="token comment">// å¯è§ï¼Œé”ä»…ç”¨æ¥é¿å…å¤šä¸ª goroutine åŒæ—¶å®ä¾‹åŒ– singleton</span><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>singleton <span class="token punctuation">{</span><span class="token keyword">if</span> instance <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment">// ã€ä½ç½®1ã€‘</span><span class="token comment">// è¿™é‡Œå¯èƒ½æœ‰å¤šäºä¸€ä¸ª goroutine åŒæ—¶åˆ°è¾¾ ã€ä½ç½®2ã€‘</span>mutex<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// è¿™é‡Œæ¯ä¸ªæ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ª goroutine åˆ°è¾¾  ã€ä½ç½®3ã€‘</span><span class="token keyword">if</span> instance <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment">// ã€ä½ç½®4ã€‘</span>instance <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>singleton<span class="token punctuation">)</span><span class="token punctuation">}</span>mutex<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> instance<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>singleton<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>mutex</code> æ¥ä¿æŠ¤ <code>instance</code> çš„åˆ›å»ºè¿‡ç¨‹ï¼Œç¡®ä¿å³ä½¿åœ¨å¤šä¸ª goroutine åŒæ—¶è°ƒç”¨ <code>New()</code> æ—¶ï¼Œå®ä¾‹ä¹Ÿåªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºâ€œåŒé‡æ£€æŸ¥â€ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨ <code>New()</code> æ—¶ä¼šè¿›è¡Œä¸¤æ¬¡ <code>instance</code> æ˜¯å¦ä¸º <code>nil</code> çš„æ£€æŸ¥ï¼šä¸€æ¬¡åœ¨åŠ é”å‰ï¼Œä¸€æ¬¡åœ¨åŠ é”åã€‚</p><h2 id="åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼"><a href="#åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼" class="headerlink" title="åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼"></a>åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼</h2><p>åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå®ƒé¿å…äº†åœ¨æ¯æ¬¡è®¿é—®å®ä¾‹æ—¶éƒ½è¦è¿›è¡ŒåŒæ­¥æ“ä½œçš„å¼€é”€ã€‚è¿™ç§æ¨¡å¼é¦–å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å·²ç»åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿›è¡ŒåŒæ­¥ã€‚åœ¨åŒæ­¥å—å†…éƒ¨ï¼Œå†æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦åˆ›å»ºï¼Œä»¥ç¡®ä¿å³ä½¿å¤šä¸ª goroutine åŒæ—¶è¿›å…¥åŒæ­¥å—ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªèƒ½å¤Ÿåˆ›å»ºå®ä¾‹ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å•ä¾‹æ¨¡å¼åœ¨éœ€è¦å…¨å±€è®¿é—®ç‚¹ä¸”åªå¸Œæœ›åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ç®€å•ä½†å¯èƒ½é€ æˆèµ„æºæµªè´¹ï¼Œè€Œæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼åˆ™æ›´åŠ çµæ´»ï¼Œä½†éœ€è¦å¤„ç†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚Go è¯­è¨€çš„å¹¶å‘ç‰¹æ€§ä½¿å¾—å®ç°æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼æ—¶ï¼ŒåŒé‡æ£€æŸ¥é”å®šæ¨¡å¼æˆä¸ºäº†ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é€šè¿‡ä»¥ä¸Šçš„ä»‹ç»å’Œä»£ç ç¤ºä¾‹ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼æœ‰äº†åŸºæœ¬çš„äº†è§£å’Œè®¤è¯†ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ ¹æ®å…·ä½“æƒ…å†µé€‰ç”¨é€‚å½“çš„å®ç°æ–¹å¼ï¼Œæ˜¯æ¯ä¸ª Go å¼€å‘è€…éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go é¡¹ç›®è‡ªåŠ¨é‡è½½è§£å†³æ–¹æ¡ˆ â€”â€” Air ä½¿ç”¨å…¥é—¨</title>
      <link href="posts/2968883c.html"/>
      <url>posts/2968883c.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¼€å‘ Go åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦é‡å¯åº”ç”¨æ¥åŠ è½½æœ€æ–°çš„ä»£ç æ›´æ”¹ã€‚è¿™ä¸ªè¿‡ç¨‹è™½ç„¶ç®€å•ï¼Œä½†é‡å¤çš„æ“ä½œä¼šé™ä½æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬è¦ä»‹ç»çš„å·¥å…· â€”â€” <strong>Air</strong>ï¼Œ å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥ä»‹ç»å¦‚ä½•ä½¿ç”¨ Air æ¥å®ç° Go é¡¹ç›®çš„è‡ªåŠ¨é‡è½½ï¼Œè®©ä½ çš„å¼€å‘è¿‡ç¨‹æ›´åŠ é¡ºç•…ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Airï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Airï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Airï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Airï¼Ÿ</h2><p><a href="https://github.com/cosmtrek/air">Air</a> æ˜¯ä¸€ä¸ªä¸º Go é¡¹ç›®æä¾›è‡ªåŠ¨é‡è½½åŠŸèƒ½çš„å·¥å…·ã€‚é€šè¿‡ç›‘å¬é¡¹ç›®ä¸­æ–‡ä»¶çš„å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œä½ çš„åº”ç”¨ï¼Œä»è€Œè¾¾åˆ°çƒ­é‡è½½çš„æ•ˆæœï¼Œæå¤§åœ°æå‡å¼€å‘æ•ˆç‡ã€‚Air çš„ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼Œä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡å‡ ä¸ªæ­¥éª¤æ¥è¯¦ç»†ä»‹ç»ã€‚</p><h2 id="å®‰è£…-Air"><a href="#å®‰è£…-Air" class="headerlink" title="å®‰è£… Air"></a>å®‰è£… Air</h2><p>å®‰è£… Air çš„ç¬¬ä¸€æ­¥æ˜¯ç¡®ä¿ä½ çš„ç¯å¢ƒä¸­å®‰è£…äº† Goï¼Œå¹¶ä¸”å¯ç”¨äº† Go Moduleã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†é¡¹ç›®çš„ä¾èµ–ã€‚ä¸‹é¢æ˜¯å®‰è£… Air çš„å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æœ€å‰é¢çš„ GO111MODULE=on æ˜¯åªä¸ºå½“å‰å‘½ä»¤å¯ç”¨ Go Module</span><span class="token comment"># å¼€å¯ä»¥åæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨ Go Proxy è¿›è¡ŒåŠ é€Ÿï¼Œä»¥ä¸‹å‘½ä»¤ä¼šå…¨å±€å®‰è£… Air</span><span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on  go <span class="token function">install</span> github.com/cosmtrek/air@latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°å‘½ä»¤ä¼šé€šè¿‡ Go çš„åŒ…ç®¡ç†å·¥å…·ä¸‹è½½å¹¶å®‰è£… Air åˆ°ä½ çš„ <code>$GOPATH/bin</code> ç›®å½•ä¸‹ï¼Œå› æ­¤è¯·ç¡®ä¿è¿™ä¸ªç›®å½•åŒ…å«åœ¨ä½ çš„ç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­ã€‚</p><h2 id="æ£€æŸ¥å®‰è£…æƒ…å†µ"><a href="#æ£€æŸ¥å®‰è£…æƒ…å†µ" class="headerlink" title="æ£€æŸ¥å®‰è£…æƒ…å†µ"></a>æ£€æŸ¥å®‰è£…æƒ…å†µ</h2><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥ Air æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">air <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœå®‰è£…æˆåŠŸï¼Œæ­¤å‘½ä»¤å°†æ˜¾ç¤º Air çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™è¯´æ˜ Air å·²ç»å‡†å¤‡å¥½å¯ä»¥åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†ã€‚</p><h2 id="ä½¿ç”¨-Air"><a href="#ä½¿ç”¨-Air" class="headerlink" title="ä½¿ç”¨ Air"></a>ä½¿ç”¨ Air</h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ Air æ¥å®ç°è‡ªåŠ¨é‡è½½åŠŸèƒ½ã€‚</p><ol><li><strong>å¯åŠ¨ Air</strong></li></ol><p>åœ¨ä½ çš„ Go é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿è¡Œ Air</span>air<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre><code>è¿™ä¸ªå‘½ä»¤ä¼šå¯åŠ¨ Airï¼Œå¹¶æ ¹æ® `air.toml` é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼ŒAir ä¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼‰æ¥ç›‘å¬æ–‡ä»¶å˜åŒ–ã€‚ä¸€æ—¦æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ”¹ï¼ŒAir ä¼šè‡ªåŠ¨ç¼–è¯‘å¹¶é‡å¯ä½ çš„åº”ç”¨ã€‚</code></pre><ol start="2"><li><strong>å¿½ç•¥ä¸´æ—¶æ–‡ä»¶</strong></li></ol><p>å¯åŠ¨ Air ä¹‹åï¼Œä½ ä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª <code>tmp</code> æ–‡ä»¶å¤¹ï¼ŒAir ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤¹æ¥å­˜æ”¾ç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ã€‚å› ä¸ºè¿™äº›æ–‡ä»¶é€šå¸¸ä¸éœ€è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥ä½ åº”è¯¥å°† <code>tmp/</code> æ·»åŠ åˆ°ä½ çš„ <code>.gitignore</code> æ–‡ä»¶ä¸­ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># .gitignore</span>tmp/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>air é€šè¿‡ç›‘è§†é¡¹ç›®æ–‡ä»¶çš„æ”¹åŠ¨æ¥å·¥ä½œã€‚å½“å®ƒæ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–æ—¶ï¼Œair ä¼šè§¦å‘æ„å»ºè¿‡ç¨‹ï¼Œå¹¶åœ¨æ„å»ºæˆåŠŸåé‡å¯ä½ çš„åº”ç”¨ç¨‹åºã€‚è¿™æ ·ï¼Œä½ å°±ä¸éœ€è¦æ¯æ¬¡ä¿®æ”¹ä»£ç åéƒ½æ‰‹åŠ¨é‡æ–°ç¼–è¯‘å’Œè¿è¡Œäº†ã€‚</p><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>ä½¿ç”¨ Airï¼Œä½ çš„ Go é¡¹ç›®å¼€å‘è¿‡ç¨‹å°†å˜å¾—æ›´åŠ é¡ºç•…ï¼Œä¸å†éœ€è¦æ‰‹åŠ¨é‡å¯åº”ç”¨æ¥åŠ è½½æ›´æ”¹ã€‚é€šè¿‡è‡ªåŠ¨é‡è½½ï¼Œä½ å¯ä»¥æ›´ä¸“æ³¨äºä»£ç çš„ç¼–å†™å’Œè°ƒè¯•ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ Air æ˜¯ä¸€ä¸ªå¼ºå¤§æ–¹ä¾¿çš„å·¥å…·ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹è¿˜æ˜¯åº”è¯¥å…³é—­è‡ªåŠ¨é‡è½½åŠŸèƒ½ï¼Œä»¥ä¿è¯åº”ç”¨çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£å’Œä½¿ç”¨ Airï¼Œè®©ä½ çš„ Go é¡¹ç›®å¼€å‘å˜å¾—æ›´åŠ è½»æ¾å’Œæ„‰å¿«ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Makefile ç®¡ç†å’Œéƒ¨ç½² Go é¡¹ç›®</title>
      <link href="posts/926b9d4b.html"/>
      <url>posts/926b9d4b.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨è½¯ä»¶å¼€å‘çš„ä¸–ç•Œé‡Œï¼Œè‡ªåŠ¨åŒ–æ˜¯æå‡æ•ˆç‡çš„å…³é”®ã€‚<code>Makefile</code> å°½ç®¡æ˜¯ä¸€ä¸ªå†å²æ‚ ä¹…çš„å·¥å…·ï¼Œä½†å®ƒåœ¨ä»»åŠ¡ç®¡ç†å’Œè‡ªåŠ¨åŒ–æ–¹é¢çš„èƒ½åŠ›ä¾ç„¶ä¸å¯å°è§‘ã€‚</p><p>å¯¹äº <code>Go</code> è¯­è¨€é¡¹ç›®æ¥è¯´ï¼Œåˆ©ç”¨ <code>Makefile</code> æ¥ç®¡ç†å’Œè‡ªåŠ¨åŒ–æ„å»ºã€éƒ¨ç½²è¿‡ç¨‹èƒ½æå¤§åœ°ç®€åŒ–å¼€å‘æµç¨‹ã€‚æœ¬æ–‡å°†å¼•å¯¼ä½ å¦‚ä½•ä½¿ç”¨ <code>Makefile</code> åœ¨æœ¬åœ°å¼€å‘ <code>Go</code> é¡¹ç›®åï¼Œå°†å…¶æ›´æ–°åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-Makefileï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-Makefileï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ Makefileï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ Makefileï¼Ÿ</h2><p><code>Makefile</code> æä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„è„šæœ¬é›†åˆï¼Œç”¨äºè‡ªåŠ¨åŒ–æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œå¦‚ç¼–è¯‘æºä»£ç ã€æ‰“åŒ…è½¯ä»¶ã€æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€éƒ¨ç½²åˆ°æœåŠ¡å™¨ç­‰ã€‚ä½¿ç”¨ <code>Makefile</code> å¯ä»¥è®©å¤æ‚çš„ä»»åŠ¡åºåˆ—åŒ–ã€ä¸€é”®åŒ–ï¼Œä»è€Œå‡å°‘äººä¸ºé”™è¯¯ï¼Œæå‡å·¥ä½œæ•ˆç‡ã€‚</p><h2 id="Makefile-åŸºç¡€"><a href="#Makefile-åŸºç¡€" class="headerlink" title="Makefile åŸºç¡€"></a>Makefile åŸºç¡€</h2><p>Makefile æ˜¯ä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„æ–‡ä»¶ï¼Œå®ƒè¢« make å·¥å…·ä½¿ç”¨æ¥ç®¡ç†å’Œè‡ªåŠ¨åŒ–è½¯ä»¶çš„æ„å»ºè¿‡ç¨‹ã€‚æ¯ä¸ª Makefile åŒ…å«ä¸€ç³»åˆ—çš„è§„åˆ™å’Œä¾èµ–ï¼Œmake æ ¹æ®è¿™äº›è§„åˆ™æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p><h2 id="åˆ›å»º-Makefile"><a href="#åˆ›å»º-Makefile" class="headerlink" title="åˆ›å»º Makefile"></a>åˆ›å»º Makefile</h2><p>é¦–å…ˆï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>Makefile</code> æ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> Makefile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ç³»åˆ—çš„ä»»åŠ¡æ¥ç®¡ç†å’Œéƒ¨ç½²æˆ‘ä»¬çš„ Go é¡¹ç›®ã€‚</p><h3 id="ä»»åŠ¡è„šæœ¬è§£æ"><a href="#ä»»åŠ¡è„šæœ¬è§£æ" class="headerlink" title="ä»»åŠ¡è„šæœ¬è§£æ"></a>ä»»åŠ¡è„šæœ¬è§£æ</h3><p>ä»¥ä¸‹æ˜¯ <code>Makefile</code> çš„å†…å®¹ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é¢„å®šä¹‰å˜é‡</span><span class="token assign-left variable">REMOTE</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1<span class="token assign-left variable">APPNAME</span><span class="token operator">=</span>alex-blog<span class="token comment"># å£°æ˜ .PHONY ç›®æ ‡</span>.PHONY: deploy-dev<span class="token comment"># deploy-dev ä»»åŠ¡</span>deploy-dev:    @echo <span class="token string">"<span class="token entity" title="\n">\n</span>--- å¼€å§‹æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ ---"</span>    <span class="token comment"># è®¾ç½®ç›®æ ‡æ“ä½œç³»ç»Ÿä¸º linuxï¼Œæ¶æ„ä¸º amd64ï¼Œå¹¶æ„å»ºé¡¹ç›®</span>    <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token parameter variable">-ldflags</span><span class="token operator">=</span><span class="token string">"-s -w"</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-o</span> tmp/<span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span>_tmp    @echo <span class="token string">"<span class="token entity" title="\n">\n</span>--- ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶ ---"</span>    <span class="token comment"># å°†æ„å»ºçš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</span>    <span class="token function">scp</span> tmp/<span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span>_tmp root@<span class="token variable"><span class="token variable">$(</span>REMOTE<span class="token variable">)</span></span>:/data/www/blog.com/    @echo <span class="token string">"<span class="token entity" title="\n">\n</span>--- åœæ­¢æœåŠ¡ ---"</span>    <span class="token comment"># ä½¿ç”¨ SSH æ‰§è¡Œå‘½ä»¤ï¼Œåœæ­¢æœåŠ¡</span>    <span class="token function">ssh</span> root@<span class="token variable"><span class="token variable">$(</span>REMOTE<span class="token variable">)</span></span> <span class="token string">"supervisorctl stop <span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span>"</span>    @echo <span class="token string">"<span class="token entity" title="\n">\n</span>--- æ›¿æ¢æ–°æ–‡ä»¶ ---"</span>    <span class="token comment"># ä½¿ç”¨ SSH æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼Œæ›´æ–°åº”ç”¨ç¨‹åº</span>    <span class="token function">ssh</span> root@<span class="token variable"><span class="token variable">$(</span>REMOTE<span class="token variable">)</span></span> <span class="token string">"cd /data/www/blog.com/ \                            &amp;&amp; rm <span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span> \                            &amp;&amp; mv <span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span>_tmp <span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span> \                            &amp;&amp; chown www-data:www-data <span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span>"</span>    @echo <span class="token string">"<span class="token entity" title="\n">\n</span>--- å¼€å§‹æœåŠ¡ ---"</span>    <span class="token comment"># ä½¿ç”¨ SSH æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨æœåŠ¡</span>    <span class="token function">ssh</span> root@<span class="token variable"><span class="token variable">$(</span>REMOTE<span class="token variable">)</span></span> <span class="token string">"supervisorctl start <span class="token variable"><span class="token variable">$(</span>APPNAME<span class="token variable">)</span></span>"</span>    @echo <span class="token string">"<span class="token entity" title="\n">\n</span>--- éƒ¨ç½²å®Œæ¯• ---<span class="token entity" title="\n">\n</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="PHONY"><a href="#PHONY" class="headerlink" title=".PHONY: <ä»»åŠ¡åç§°>"></a><code>.PHONY: &lt;ä»»åŠ¡åç§°&gt;</code></h3><p><code>.PHONY</code> ç”¨äºå£°æ˜ä¸€ä¸ªç›®æ ‡æ˜¯â€œä¼ªç›®æ ‡â€ï¼Œè€Œéæ–‡ä»¶åã€‚è¿™æ„å‘¤ç€å³ä½¿åœ¨å½“å‰ç›®å½•ä¸‹å­˜åœ¨ä¸ä»»åŠ¡åŒåçš„æ–‡ä»¶ï¼Œæ‰§è¡Œ <code>make &lt;ä»»åŠ¡åç§°&gt;</code> æ—¶ï¼Œä»ä¼šæ‰§è¡Œè¯¥ä»»åŠ¡ã€‚è¿™ä¸ªå£°æ˜å¯ä»¥é¿å…ç”±äºå­˜åœ¨åŒåæ–‡ä»¶è€Œå¯¼è‡´çš„ä»»åŠ¡ä¸è¢«æ‰§è¡Œã€‚</p><h2 id="æ‰§è¡Œä»»åŠ¡"><a href="#æ‰§è¡Œä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä»»åŠ¡"></a>æ‰§è¡Œä»»åŠ¡</h2><p>è¦è¿è¡Œä¸Šé¢å®šä¹‰çš„ <code>deploy-dev</code> ä»»åŠ¡ï¼Œåªéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> deploy-dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ¡å‘½ä»¤ä¼šä¾æ¬¡æ‰§è¡Œæ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€ä¸Šä¼ è‡³æœåŠ¡å™¨ã€åœæ­¢æœåŠ¡ã€æ›¿æ¢æ–°æ–‡ä»¶å¹¶é‡æ–°å¯åŠ¨æœåŠ¡ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œæå¤§åœ°ç®€åŒ–äº†æ‰‹åŠ¨éƒ¨ç½²çš„è¿‡ç¨‹ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä½¿ç”¨ <code>Makefile</code> ç®¡ç†å’Œè‡ªåŠ¨åŒ– <code>Go</code> é¡¹ç›®çš„æ„å»ºå’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ï¼Œé¿å…åœ¨é‡å¤æ€§æ“ä½œä¸­å‡ºé”™ã€‚</p><p>æœ¬æ–‡ä»‹ç»çš„ <code>Makefile</code> ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨è¿™ç§å¼ºå¤§å·¥å…·ç®€åŒ–å¼€å‘å·¥ä½œï¼Œä½† <code>Makefile</code> çš„æ½œåŠ›è¿œä¸æ­¢äºæ­¤ã€‚éšç€ä½ å¯¹ <code>Makefile</code> æ›´æ·±å…¥çš„ç†è§£å’ŒæŒæ¡ï¼Œä½ å°†èƒ½å¤Ÿåˆ›å»ºæ›´åŠ å¤æ‚å’Œå¼ºå¤§çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä½¿ä½ çš„å¼€å‘æµç¨‹æ›´åŠ é«˜æ•ˆã€ä¸“ä¸šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> Makefile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æœ‰æ•ˆæå‡ API æ¥å£çš„å®‰å…¨æ€§ï¼Ÿ</title>
      <link href="posts/5edede5c.html"/>
      <url>posts/5edede5c.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¦‚ä»Šçš„äº’è”ç½‘åº”ç”¨ä¸­ï¼ŒAPI æ¥å£çš„å®‰å…¨æ€§å·²ç»æˆä¸ºäº†å¼€å‘è¿‡ç¨‹ä¸­ä¸å¯å¿½è§†çš„ä¸€ç¯ã€‚è¶Šæ¥è¶Šå¤šçš„åº”ç”¨æœåŠ¡é€šè¿‡ API è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œè€Œ API çš„å®‰å…¨æ€§ç›´æ¥å…³ç³»åˆ°åº”ç”¨çš„æ•°æ®å®‰å…¨ä¸ç”¨æˆ·éšç§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ä¸€ç³»åˆ—æªæ–½æ¥ç¡®ä¿ API çš„å®‰å…¨ã€‚</p><p>æœ¬æ–‡å°†æ•™ä½ å¦‚ä½•é€šè¿‡ API æ¥å£éªŒè¯è§„åˆ™å’Œæ¥å£é˜²åˆ·æ¥æå‡ API çš„å®‰å…¨æ€§ã€‚</p><h2 id="API-æ¥å£éªŒè¯è§„åˆ™"><a href="#API-æ¥å£éªŒè¯è§„åˆ™" class="headerlink" title="API æ¥å£éªŒè¯è§„åˆ™"></a>API æ¥å£éªŒè¯è§„åˆ™</h2><p>API æ¥å£éªŒè¯æ˜¯ API å®‰å…¨çš„åŸºç¡€ã€‚æœ‰æ•ˆçš„éªŒè¯æœºåˆ¶å¯ä»¥é˜»æ­¢æœªæˆæƒçš„è®¿é—®å°è¯•ï¼Œå¹¶ç¡®ä¿åªæœ‰æ‹¥æœ‰æ­£ç¡®å‡­æ®çš„è¯·æ±‚æ‰èƒ½æˆåŠŸæ‰§è¡Œã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ç§å¸¸è§ä¸”æœ‰æ•ˆçš„ API æ¥å£éªŒè¯æ–¹æ³•ï¼š</p><ol><li><p><strong>è¯·æ±‚å‚æ•°æ’åº</strong>ï¼šå°†æ‰€æœ‰è¯·æ±‚å‚æ•°æŒ‰ <code>ASCII</code> ç çš„é¡ºåºè¿›è¡Œæ’åºã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿å‘é€åˆ°æœåŠ¡ç«¯çš„å‚æ•°åœ¨å‰åç«¯ä¿æŒä¸€è‡´æ€§ï¼Œä»¥ä¾¿äºç”Ÿæˆå¯éªŒè¯çš„ç­¾å(<code>sign</code>)ã€‚</p></li><li><p><strong>ç”ŸæˆæŸ¥è¯¢å­—ç¬¦ä¸²</strong>ï¼šå°†æ’åºåçš„è¯·æ±‚å‚æ•°è½¬æ¢æˆ <code>key=value</code> çš„å½¢å¼ï¼Œå¹¶ä½¿ç”¨ <code>&amp;</code> è¿æ¥ï¼Œå½¢æˆæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚å¦‚ <code>a=111&amp;b=222</code>ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜å¯ä»¥åŠ ä¸Šä¸€ä¸ªä¸åç«¯å¼€å‘äººå‘˜åå®šå¥½çš„å¯†é’¥(<code>key</code>)ï¼Œä»¥å¢åŠ éªŒè¯çš„å¤æ‚åº¦ã€‚</p></li></ol><p>æ¯”å¦‚ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GET /api/data?a<span class="token operator">=</span><span class="token number">111</span><span class="token operator">&amp;</span><span class="token assign-left variable">b</span><span class="token operator">=</span><span class="token number">222</span><span class="token operator">&amp;</span><span class="token assign-left variable">key</span><span class="token operator">=</span>secret<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li><strong>MD5 åŠ å¯†</strong>ï¼šå¯¹æ­¥éª¤ 2 ç”Ÿæˆçš„æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œ MD5 åŠ å¯†ï¼Œç”Ÿæˆç­¾å(<code>sign</code>)ã€‚</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sign</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a=111&amp;b=222&amp;key=secret"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li><p><strong>å®¢æˆ·ç«¯æºå¸¦ç­¾åè¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œå°†åŠ å¯†åçš„ç­¾å(<code>sign</code>)ä¸€åŒæºå¸¦å‘é€ã€‚</p></li><li><p><strong>æœåŠ¡ç«¯éªŒè¯</strong>ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒæŒ‰ç…§ç›¸åŒçš„è§„åˆ™ï¼ˆæ­¥éª¤ 1 - 3ï¼‰å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†å¹¶ç”Ÿæˆæ–°çš„ <code>sign</code>ï¼Œç„¶åä¸å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ <code>sign</code> è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœä¸¤è€…ä¸€è‡´ï¼Œåˆ™éªŒè¯é€šè¿‡ï¼Œå¦åˆ™è¯·æ±‚æ— æ•ˆã€‚</p></li></ol><p>PHP ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// ç¤ºä¾‹ä»£ç ï¼Œå‡è®¾è¯·æ±‚å‚æ•°æ˜¯ä¸€ä¸ªå…³è”æ•°ç»„</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'b'</span> <span class="token operator">=&gt;</span> <span class="token number">222</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'a'</span> <span class="token operator">=&gt;</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 1. å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œ ASCII æ’åº</span><span class="token function">ksort</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. è½¬æˆ `a=111&amp;b=222` è¿™æ ·çš„ç»“æ„</span><span class="token variable">$queryString</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. è¿›è¡Œ MD5 åŠ å¯†ï¼Œç”Ÿæˆ sign</span><span class="token variable">$secretKey</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'your_secret_key'</span><span class="token punctuation">;</span> <span class="token comment">// ä¸åç«¯åå®šå¥½çš„ key</span><span class="token variable">$sign</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$queryString</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&amp;key='</span> <span class="token operator">.</span> <span class="token variable">$secretKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4. å®¢æˆ·ç«¯è¯·æ±‚æºå¸¦å‚æ•°ä»¥åŠ sign</span><span class="token comment">// å‡è®¾è¿™æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚</span><span class="token variable">$request</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'params'</span> <span class="token operator">=&gt;</span> <span class="token variable">$params</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'sign'</span> <span class="token operator">=&gt;</span> <span class="token variable">$sign</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// åç«¯éªŒè¯é€»è¾‘ç¤ºä¾‹</span><span class="token keyword">function</span> <span class="token function-definition function">verifyRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$secretKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è·å–å‚æ•°å’Œ sign</span>    <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'params'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$clientSign</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// 1. å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œ ASCII æ’åº</span>    <span class="token function">ksort</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2. è½¬æˆ `a=111&amp;b=222` è¿™æ ·çš„ç»“æ„</span>    <span class="token variable">$queryString</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3. è¿›è¡Œ MD5 åŠ å¯†ï¼Œç”Ÿæˆæ–°çš„ sign</span>    <span class="token variable">$serverSign</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$queryString</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&amp;key='</span> <span class="token operator">.</span> <span class="token variable">$secretKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 4. æ¯”è¾ƒä¸¤ä¸ª sign</span>    <span class="token keyword">return</span> <span class="token variable">$clientSign</span> <span class="token operator">===</span> <span class="token variable">$serverSign</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$secretKey</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'your_secret_key'</span><span class="token punctuation">;</span> <span class="token comment">// ä¸å‰ç«¯åå®šå¥½çš„ key</span><span class="token variable">$isRequestValid</span> <span class="token operator">=</span> <span class="token function">verifyRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$secretKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isRequestValid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"è¯·æ±‚åˆæ³•"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"è¯·æ±‚éæ³•"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¥å£é˜²åˆ·"><a href="#æ¥å£é˜²åˆ·" class="headerlink" title="æ¥å£é˜²åˆ·"></a>æ¥å£é˜²åˆ·</h2><p>æ¥å£è¢«æ¶æ„åˆ·å–ä¸ä»…ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œè¿˜å¯èƒ½å¯¼è‡´æ•°æ®è¢«ä¸å½“è·å–ã€‚ä¸ºäº†é˜²æ­¢æ¥å£è¢«æ¶æ„è°ƒç”¨ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä¸€äº›é˜²åˆ·ç­–ç•¥ï¼Œæ¯”å¦‚é™åˆ¶è¯·æ±‚é¢‘ç‡ã€ä½¿ç”¨éªŒè¯ç ç­‰ã€‚</p><p>å…¶ä¸­ï¼Œä¸€ç§ç®€å•æœ‰æ•ˆçš„é˜²åˆ·ç­–ç•¥æ˜¯åˆ©ç”¨ Redis è®¾ç½®è¯·æ±‚æŒ‡çº¹çš„è¿‡æœŸæ—¶é—´ï¼Œé™åˆ¶åŒä¸€ç­¾åï¼ˆ<code>sign</code>ï¼‰æˆ–åŒä¸€ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…çš„è¯·æ±‚é¢‘ç‡ã€‚</p><p>å½“ä¸€ä¸ªè¯·æ±‚è¢«å¤„ç†åï¼Œå¯ä»¥å°†è¯¥è¯·æ±‚çš„ç­¾åå­˜å…¥ Redisï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¾‹å¦‚ 1 å°æ—¶ã€‚å¦‚æœåœ¨ 1 å°æ—¶å†…å†æ¬¡æ”¶åˆ°ç›¸åŒçš„ç­¾åè¯·æ±‚ï¼Œåˆ™å¯ä»¥è®¤ä¸ºæ˜¯é‡å¤è¯·æ±‚ï¼Œæ‹’ç»å¤„ç†ã€‚<del>è¿™é‡Œçš„æ—¶é—´å¯ä»¥æŒ‰ç…§å…·ä½“æƒ…å†µè®¾ç½®çŸ­ä¸€ç‚¹å„¿ä¹Ÿè¡Œã€‚</del></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// å‡è®¾å·²ç»è¿æ¥åˆ° Redis æœåŠ¡å™¨</span><span class="token variable">$redis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ signï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨è¯·æ±‚å‚æ•°çš„å“ˆå¸Œå€¼</span><span class="token variable">$sign</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&amp;key='</span> <span class="token operator">.</span> <span class="token variable">$secretKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²ç»å­˜åœ¨äº Redis ä¸­</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token variable">$sign</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// è®¾ç½® Redis é”®å€¼å¯¹ï¼Œå¸¦è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span>    <span class="token variable">$expirationTime</span> <span class="token operator">=</span> <span class="token number">3600</span><span class="token punctuation">;</span> <span class="token comment">// 1 å°æ—¶</span>    <span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token variable">$sign</span><span class="token punctuation">,</span> <span class="token variable">$expirationTime</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'alex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å¤„ç†æ­£å¸¸è¯·æ±‚é€»è¾‘</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Redis çš„ <code>setex</code> æ–¹æ³•å°†è¯·æ±‚çš„ <code>sign</code> ä½œä¸ºé”®ï¼Œå€¼è®¾ç½®ä¸º <code>alex</code>ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 1 å°æ—¶ã€‚</p><p>æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œå…ˆæ£€æŸ¥è¯¥ <code>sign</code> æ˜¯å¦å­˜åœ¨äº Redis ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è®¤ä¸ºè¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œæ‹’ç»å¤„ç†ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†ç­¾åå­˜å…¥ Redisï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 1 å°æ—¶ã€‚è¿™æ ·ï¼Œå³ä½¿åŒä¸€ä¸ªç­¾åçš„è¯·æ±‚åœ¨ 1 å°æ—¶å†…é‡å¤å‘é€ï¼ŒæœåŠ¡å™¨ä¹Ÿèƒ½æ­£ç¡®åœ°æ‹’ç»å¤„ç†ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>API æ¥å£çš„å®‰å…¨é˜²æŠ¤æ˜¯ç¡®ä¿æ•°æ®å®‰å…¨å’ŒæœåŠ¡è´¨é‡çš„å…³é”®ã€‚é€šè¿‡å®ç°ä¸¥æ ¼çš„éªŒè¯è§„åˆ™å’Œé‡‡ç”¨æ¥å£é˜²åˆ·æªæ–½ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°ä¿æŠ¤æˆ‘ä»¬çš„ API å…å—æ¶æ„æ”»å‡»å’Œæ»¥ç”¨ã€‚</p><p>é€šè¿‡ä¸Šè¿°ä»‹ç»ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•é€šè¿‡ API æ¥å£éªŒè¯ä¸æ¥å£é˜²åˆ·ä¸¤ç§æ–¹å¼æ¥å¢å¼ºæˆ‘ä»¬ API çš„å®‰å…¨æ€§ã€‚è¿™ä¸¤ç§æ–¹æ³•åœ¨å®é™…å¼€å‘ä¸­éå¸¸å®ç”¨ï¼Œèƒ½æœ‰æ•ˆé˜²æ­¢ API è¢«æ»¥ç”¨ï¼Œä¿æŠ¤æ•°æ®å®‰å…¨ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ åœ¨æ—¥åçš„å¼€å‘å·¥ä½œä¸­æ›´å¥½åœ°ä¿æŠ¤ APIã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç§‘æ™® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬ Nginx é…ç½®</title>
      <link href="posts/40e3643a.html"/>
      <url>posts/40e3643a.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£çš„äº’è”ç½‘åº”ç”¨ä¸­ï¼ŒNginx å·²ç»æˆä¸ºäº†ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨åˆ†ã€‚æ— è®ºæ˜¯ä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ã€è¿˜æ˜¯è´Ÿè½½å‡è¡¡å™¨ï¼ŒNginx çš„é«˜æ€§èƒ½å’Œçµæ´»é…ç½®éƒ½è®©å®ƒå¤‡å—é’çã€‚</p><p>æœ¬æ–‡å°†ä»¥ç®€å•ã€æ˜“æ‡‚çš„è¯­è¨€å’Œå®ä¾‹ï¼Œè¯¦ç»†ä»‹ç»å‡ ç§å¸¸è§çš„ Nginx é…ç½®åœºæ™¯ï¼Œæ—¨åœ¨å¸®åŠ©åˆå­¦è€…å’Œæœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…èƒ½æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Nginxã€‚</p><h2 id="ä¸€ã€ç®€å•é…ç½®"><a href="#ä¸€ã€ç®€å•é…ç½®" class="headerlink" title="ä¸€ã€ç®€å•é…ç½®"></a>ä¸€ã€ç®€å•é…ç½®</h2><p>è®©æˆ‘ä»¬ä»æœ€åŸºæœ¬çš„ Nginx é…ç½®è®²èµ·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„é™æ€ç½‘ç«™é…ç½®ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>     alex.com</span><span class="token punctuation">;</span> <span class="token comment"># å¡«å†™ä½ çš„åŸŸå</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>         <span class="token directive"><span class="token keyword">root</span> /var/www/wwwroot/myblog</span><span class="token punctuation">;</span> <span class="token comment"># é™æ€æ–‡ä»¶å­˜æ”¾ç›®å½•</span>        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>  <span class="token comment"># é»˜è®¤é¡µé¢</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³é”®ç‚¹è§£æï¼š"><a href="#å…³é”®ç‚¹è§£æï¼š" class="headerlink" title="å…³é”®ç‚¹è§£æï¼š"></a>å…³é”®ç‚¹è§£æï¼š</h3><ul><li><code>listen 80;</code>ï¼šæ­¤è¡Œé…ç½® Nginx ç›‘å¬ 80 ç«¯å£ï¼Œå³ HTTP æ ‡å‡†ç«¯å£ã€‚</li><li><code>server_name</code>ï¼šæŒ‡å®šå½“å‰æœåŠ¡å™¨å—å¤„ç†çš„åŸŸåã€‚</li><li><code>location /</code>ï¼šå¤„ç†æ ¹ URL çš„è¯·æ±‚ã€‚åœ¨è¿™ä¸ªä½ç½®å—é‡Œï¼Œä½ å®šä¹‰äº†è¯·æ±‚ <code>/</code> æ—¶çš„è¡Œä¸ºã€‚</li><li><code>root</code>ï¼šæŒ‡å®šé™æ€æ–‡ä»¶çš„å­˜æ”¾ç›®å½•ã€‚</li><li><code>index</code>ï¼šå½“è¯·æ±‚ç›®å½•æ—¶ï¼Œé»˜è®¤è¿”å›çš„æ–‡ä»¶åã€‚</li></ul><h2 id="äºŒã€é…ç½®-SSL-ä»-80-ç«¯å£è½¬å‘åˆ°-443"><a href="#äºŒã€é…ç½®-SSL-ä»-80-ç«¯å£è½¬å‘åˆ°-443" class="headerlink" title="äºŒã€é…ç½® SSL - ä» 80 ç«¯å£è½¬å‘åˆ° 443"></a>äºŒã€é…ç½® SSL - ä» 80 ç«¯å£è½¬å‘åˆ° 443</h2><p>éšç€ç½‘ç»œå®‰å…¨çš„æ—¥ç›Šé‡è¦ï¼Œä¸ºç½‘ç«™é…ç½® SSLï¼Œå³åœ¨ HTTP ä¸Šå®æ–½ TLS/SSL æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå·²æˆä¸ºä¸€é¡¹æ ‡å‡†å®è·µã€‚ä¸‹é¢çš„é…ç½®å±•ç¤ºäº†å¦‚ä½•å°† http æµé‡ï¼ˆ80ç«¯å£ï¼‰é‡å®šå‘åˆ° httpsï¼ˆ443ç«¯å£ï¼‰ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># 80 ç«¯å£é…ç½®ï¼Œç”¨äºé‡å®šå‘åˆ° https</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>     alex.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">rewrite</span> ^ https://<span class="token variable">$http_host</span><span class="token variable">$request_uri?</span> permanent</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment"># https é…ç½®</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span> alex.com</span><span class="token punctuation">;</span>     <span class="token comment"># ç»‘å®šè¯ä¹¦çš„åŸŸå</span>    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/cert/alex_blog.crt</span><span class="token punctuation">;</span>      <span class="token comment"># è¯ä¹¦è·¯å¾„</span>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/cert/alex_blog.key</span><span class="token punctuation">;</span>  <span class="token comment"># ç§é’¥è·¯å¾„</span>    <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">5m</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span>  <span class="token comment"># ä½¿ç”¨çš„åè®®</span>    <span class="token directive"><span class="token keyword">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span> /var/www/wwwroot/myblog</span><span class="token punctuation">;</span>    <span class="token comment"># ç«™ç‚¹ç›®å½•</span>        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³é”®ç‚¹è§£æï¼š-1"><a href="#å…³é”®ç‚¹è§£æï¼š-1" class="headerlink" title="å…³é”®ç‚¹è§£æï¼š"></a>å…³é”®ç‚¹è§£æï¼š</h3><ul><li>ç¬¬ä¸€ä¸ª <code>server</code> å—ç›¸å½“äºä¸€ä¸ªè·³æ¿ï¼Œæ¥å— 80 ç«¯å£çš„è¯·æ±‚å¹¶é€šè¿‡ 301 æ°¸ä¹…é‡å®šå‘åˆ° httpsã€‚</li><li>ç¬¬äºŒä¸ª <code>server</code> å—åˆ™æ˜¯çœŸæ­£å¤„ç† https è¯·æ±‚çš„ã€‚</li><li><code>ssl_certificate</code> å’Œ <code>ssl_certificate_key</code> åˆ†åˆ«æŒ‡å‘äº† SSL è¯ä¹¦å’Œç§é’¥çš„è·¯å¾„ï¼Œè¿™å¯¹äºå¯ç”¨ https æ˜¯å¿…é¡»çš„ã€‚</li></ul><h2 id="ä¸‰ã€åå‘ä»£ç†é…ç½®"><a href="#ä¸‰ã€åå‘ä»£ç†é…ç½®" class="headerlink" title="ä¸‰ã€åå‘ä»£ç†é…ç½®"></a>ä¸‰ã€åå‘ä»£ç†é…ç½®</h2><p>åå‘ä»£ç†æ˜¯ Nginx çš„å¦ä¸€ä¸ªå¸¸ç”¨åŠŸèƒ½ï¼Œå®ƒèƒ½è®©ä½ å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶å°†å…¶å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™æ ·åšçš„å¥½å¤„åŒ…æ‹¬éšè—æœåŠ¡å™¨çœŸå® IPã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜é™æ€å†…å®¹ç­‰ã€‚ä»¥ä¸‹ç¤ºä¾‹é…ç½®æè¿°äº†å¦‚ä½•å°†å¯¹ <code>api.alex.com</code> çš„è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token comment"># è®¿é—® api.alex.com å®é™…è®¿é—®åˆ° https://www.alex.com:5200 </span>    <span class="token directive"><span class="token keyword">server_name</span>  api.alex.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">proxy_pass</span> https://www.alex.com:5200</span><span class="token punctuation">;</span> <span class="token comment">#åå‘ä»£ç†çš„åœ°å€</span>        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span> <span class="token comment">#é…ç½®å‚æ•°ï¼ˆé‡è¦ï¼‰</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">"upgrade"</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³é”®ç‚¹è§£æï¼š-2"><a href="#å…³é”®ç‚¹è§£æï¼š-2" class="headerlink" title="å…³é”®ç‚¹è§£æï¼š"></a>å…³é”®ç‚¹è§£æï¼š</h3><ul><li><code>proxy_pass</code> æŒ‡æ˜äº†è¢«ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚</li><li><code>proxy_set_header</code> ç”¨äºè®¾ç½® HTTP å¤´ä¿¡æ¯ï¼Œä»¥ç¡®ä¿æ­£å¸¸çš„ WebSocket é€šä¿¡ã€‚</li></ul><h2 id="å››ã€é…ç½®å›¾ç‰‡æœåŠ¡å™¨"><a href="#å››ã€é…ç½®å›¾ç‰‡æœåŠ¡å™¨" class="headerlink" title="å››ã€é…ç½®å›¾ç‰‡æœåŠ¡å™¨"></a>å››ã€é…ç½®å›¾ç‰‡æœåŠ¡å™¨</h2><p>å½“ä½ éœ€è¦ä¸“é—¨å¤„ç†å›¾ç‰‡æˆ–å…¶ä»–é™æ€èµ„æºæ—¶ï¼ŒNginx å¯ä»¥é…ç½®æˆä¸€ä¸ªé«˜æ•ˆçš„å›¾ç‰‡æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼Œç”¨äºå¤„ç†ç‰¹å®šè·¯å¾„ä¸‹çš„å›¾ç‰‡æ–‡ä»¶è¯·æ±‚ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># æ­£åˆ™è¡¨è¾¾å¼ï¼Œè®¿é—® /home/alex/images/ è·¯å¾„ä¸‹çš„æ–‡ä»¶</span><span class="token directive"><span class="token keyword">location</span> ~ (images/).+(gif|jpg|jpeg|png)$</span> <span class="token punctuation">{</span>                 <span class="token directive"><span class="token keyword">expires</span> <span class="token number">24h</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">root</span> /home/alex/</span><span class="token punctuation">;</span><span class="token comment">#æŒ‡å®šå›¾ç‰‡å­˜æ”¾è·¯å¾„</span>                <span class="token directive"><span class="token keyword">access_log</span> /home/alex/log/images.log</span><span class="token punctuation">;</span><span class="token comment">#æ—¥å¿—å­˜æ”¾è·¯å¾„</span>                <span class="token directive"><span class="token keyword">proxy_store</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_store_access</span> user:rw group:rw all:rw</span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_temp_path</span>     /home/alex/</span><span class="token punctuation">;</span><span class="token comment">#å›¾ç‰‡è®¿é—®è·¯å¾„</span>                <span class="token directive"><span class="token keyword">proxy_redirect</span>     <span class="token boolean">off</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_set_header</span>    Host 127.0.0.1</span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">client_max_body_size</span>  <span class="token number">10m</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">client_body_buffer_size</span> <span class="token number">1280k</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>  <span class="token number">900</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_send_timeout</span>   <span class="token number">900</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_read_timeout</span>   <span class="token number">900</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_buffer_size</span>    <span class="token number">40k</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_buffers</span>      <span class="token number">40</span> <span class="token number">320k</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span> <span class="token number">640k</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">640k</span></span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">if</span> ( !-e <span class="token variable">$request_filename</span>)</span>                <span class="token punctuation">{</span>                        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1</span><span class="token punctuation">;</span><span class="token comment">#é»˜è®¤80ç«¯å£ </span>                <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³é”®ç‚¹è§£æï¼š-3"><a href="#å…³é”®ç‚¹è§£æï¼š-3" class="headerlink" title="å…³é”®ç‚¹è§£æï¼š"></a>å…³é”®ç‚¹è§£æï¼š</h3><ul><li>è¿™ä¸ªä½ç½®åŒ¹é…äº†ä»¥ <code>images/</code> å¼€å¤´ï¼Œå¹¶ä»¥ <code>gif</code>ã€<code>jpg</code>ã€<code>jpeg</code>ã€<code>png</code> ç»“å°¾çš„è¯·æ±‚è·¯å¾„ï¼Œç„¶åå¯¹è¿™äº›èµ„æºè¿›è¡Œäº†ç¼“å­˜å’Œæ—¥å¿—è®°å½•çš„é…ç½®ã€‚</li></ul><h2 id="äº”ã€Vue-åº”ç”¨çš„-Nginx-é…ç½®"><a href="#äº”ã€Vue-åº”ç”¨çš„-Nginx-é…ç½®" class="headerlink" title="äº”ã€Vue åº”ç”¨çš„ Nginx é…ç½®"></a>äº”ã€Vue åº”ç”¨çš„ Nginx é…ç½®</h2><p>å°†å‰ç«¯é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œä½ é€šå¸¸éœ€è¦é…ç½®ä¸€ä¸ª Web æœåŠ¡å™¨æ¥æ‰˜ç®¡å®ƒä»¬ã€‚Vue åº”ç”¨å°±æ˜¯è¿™æ ·ä¸€ä¸ªæ¡ˆä¾‹ã€‚ä¸‹é¢çš„ Nginx é…ç½®é€‚ç”¨äº Vue åº”ç”¨çš„éƒ¨ç½²ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span> h5.alex.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/frontend-h5.err</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/frontend-h5.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>   /opt/h5</span><span class="token punctuation">;</span><span class="token comment">#        rewrite ^/article/([0-9]+)$ /index.html?id=$1 last;</span>             <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">location</span> /dapi/</span> <span class="token punctuation">{</span>           <span class="token directive"><span class="token keyword">proxy_pass</span> http://172.19.0.23:8502/</span><span class="token punctuation">;</span>            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>           <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$http_x_real_ip</span></span><span class="token punctuation">;</span>           <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token comment">#</span>    <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³é”®ç‚¹è§£æï¼š-4"><a href="#å…³é”®ç‚¹è§£æï¼š-4" class="headerlink" title="å…³é”®ç‚¹è§£æï¼š"></a>å…³é”®ç‚¹è§£æï¼š</h3><ul><li><code>try_files</code> å‘½ä»¤ç”¨äºå°è¯•æŒ‰é¡ºåºè®¿é—®æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œæœ€åä¼šé‡å®šå‘åˆ° <code>/index.html</code> æ–‡ä»¶ã€‚è¿™å¯¹äºå•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºå‰ç«¯è·¯ç”±ã€‚</li></ul><h2 id="å…­ã€Go-Gin-åº”ç”¨çš„é…ç½®ä¸è´Ÿè½½å‡è¡¡"><a href="#å…­ã€Go-Gin-åº”ç”¨çš„é…ç½®ä¸è´Ÿè½½å‡è¡¡" class="headerlink" title="å…­ã€Go Gin åº”ç”¨çš„é…ç½®ä¸è´Ÿè½½å‡è¡¡"></a>å…­ã€Go Gin åº”ç”¨çš„é…ç½®ä¸è´Ÿè½½å‡è¡¡</h2><p>Go-Gin æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æ¡†æ¶ï¼Œé€‚ç”¨äºæ„å»ºé«˜æ•ˆçš„ Web åº”ç”¨ã€‚éƒ¨ç½²è‡³ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œä½ å¯èƒ½éœ€è¦ Nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ä»¥æé«˜åº”ç”¨çš„å¯ç”¨æ€§å’Œå“åº”é€Ÿåº¦ã€‚ä»¥ä¸‹é…ç½®å±•ç¤ºäº†å¦‚ä½•è®¾ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">8081</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">server_name</span>  api.blog.com</span><span class="token punctuation">;</span>        <span class="token comment"># å°†æ‰€æœ‰è·¯å¾„è½¬å‘åˆ° http://127.0.0.1:8000/ ä¸‹</span>        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>            <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:8000/</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®è´Ÿè½½å‡è¡¡</p><blockquote><p>ä½¿ç”¨ gin å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«ç›‘å¬ 8001 ç«¯å£å’Œ 8002 ç«¯å£</p></blockquote><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>    <span class="token comment"># è®¾ç½®å…¶å¯¹åº”çš„ 2 ä¸ªåç«¯æœåŠ¡</span>    <span class="token directive"><span class="token keyword">upstream</span> api.blog.com</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8001</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8002</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">8081</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">server_name</span>  api.blog.com</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>            <span class="token comment"># æ ¼å¼ä¸º http:// + upstream çš„èŠ‚ç‚¹åç§°</span>            <span class="token directive"><span class="token keyword">proxy_pass</span> http://api.blog.com/</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…³é”®ç‚¹è§£æï¼š-5"><a href="#å…³é”®ç‚¹è§£æï¼š-5" class="headerlink" title="å…³é”®ç‚¹è§£æï¼š"></a>å…³é”®ç‚¹è§£æï¼š</h3><ul><li><code>upstream</code> æŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡å™¨ç»„ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸¤ä¸ª Gin åº”ç”¨å®ä¾‹åˆ†åˆ«è¿è¡Œåœ¨ 8001 å’Œ 8002 ç«¯å£ã€‚</li><li>å½“è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒNginx ä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥ï¼ˆé»˜è®¤ä¸ºè½®è¯¢ï¼‰å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</li></ul><h2 id="ä¸ƒã€æŒ‰ç›®å½•åˆ’åˆ†é¡¹ç›®"><a href="#ä¸ƒã€æŒ‰ç›®å½•åˆ’åˆ†é¡¹ç›®" class="headerlink" title="ä¸ƒã€æŒ‰ç›®å½•åˆ’åˆ†é¡¹ç›®"></a>ä¸ƒã€æŒ‰ç›®å½•åˆ’åˆ†é¡¹ç›®</h2><ul><li><a href="http://www.blog.com/">www.blog.com</a> è®¿é—®é™æ€æ–‡æ¡£é¡¹ç›®</li><li><a href="http://www.blog.com/frontend">www.blog.com/frontend</a> è®¿é—®é—¨æˆ·é¡µé¢</li><li><a href="http://www.blog.com/backend">www.blog.com/backend</a> è®¿é—®åå°é¡µé¢</li></ul><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>  www.blog.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html/www</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">location</span> /frontend</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">alias</span>   /usr/share/nginx/html/frontend</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">location</span> /backend</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">alias</span>   /usr/share/nginx/html/backend</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…«ã€ä¸€äº›åˆ¤æ–­"><a href="#å…«ã€ä¸€äº›åˆ¤æ–­" class="headerlink" title="å…«ã€ä¸€äº›åˆ¤æ–­"></a>å…«ã€ä¸€äº›åˆ¤æ–­</h2><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>    <span class="token comment"># æ²¡æœ‰åç¼€çš„è¯·æ±‚æ‰ä¼šè½¬å‘ </span>    <span class="token directive"><span class="token keyword">if</span> (!-e <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:8080</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">break</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ç®€è¦ä»‹ç»äº† Nginx çš„å‡ ç§å¸¸è§é…ç½®åœºæ™¯ï¼Œå¹¶æä¾›äº†è¯¦ç»†çš„ä»£ç ç¤ºä¾‹å’Œè§£é‡Šã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œè¿ç”¨ Nginxã€‚æ— è®ºä½ æ˜¯å®Œå…¨çš„æ–°æ‰‹è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼ŒæŒæ¡è¿™æ ·ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·éƒ½å°†æå¤§åœ°æå‡ä½ çš„å¼€å‘å’Œéƒ¨ç½²æ•ˆç‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šæœºéƒ¨ç½²ï¼šæ‰“é€ å†…ç½‘æœåŠ¡å™¨é›†ç¾¤</title>
      <link href="posts/9a124193.html"/>
      <url>posts/9a124193.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨å½“ä»Šè¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œå¤šæœºéƒ¨ç½²å·²ç»æˆä¸ºè®¸å¤šå¤§å‹åº”ç”¨ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¾ˆå¤šåˆšåˆšæ¥è§¦æœåŠ¡å™¨ç®¡ç†å’Œç½‘ç»œéƒ¨ç½²çš„æ–°æ‰‹æ¥è¯´ï¼Œå¤šæœºéƒ¨ç½²å¯èƒ½å¬èµ·æ¥å°±åƒæ˜¯ä¸€é—¨æ·±ä¸å¯æµ‹çš„æŠ€æœ¯ã€‚</p><p>åˆ«æ‹…å¿ƒï¼Œä»Šå¤©å°±è®©æˆ‘å¸¦ä½ ä¸€èµ·è½»æ¾å­¦ä¹ å¦‚ä½•åœ¨åŒä¸€å†…ç½‘çš„ä¸åŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œè¿æ¥ã€‚</p><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œä½ ä¸ä»…èƒ½å¤ŸæŒæ¡åŸºæœ¬çš„å¤šæœºéƒ¨ç½²æ–¹æ³•ï¼Œè¿˜èƒ½ç†è§£å…¶èƒŒåçš„é€»è¾‘ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>åœ¨æˆ‘ä»¬è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œéœ€è¦æ˜ç¡®ä¸€ä¸ªéå¸¸é‡è¦çš„å‰æï¼šä¸ºäº†ä¿æŒç”¨æˆ·ç™»å½•çŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œåœ¨è¿›è¡Œå¤šæœºéƒ¨ç½²æ—¶ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èä½ å°† Laravel é¡¹ç›®çš„ <code>.env</code> é…ç½®æ–‡ä»¶ä¸­çš„ <code>CACHE_DRIVER</code> å’Œ <code>SESSION_DRIVER</code> æ”¹æˆ <code>redis</code>ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œå½“åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚è¢«éšæœºåˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä½¿ç”¨ Redis å¯ä»¥æœ‰æ•ˆåœ°ç»´æŠ¤ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå®ç°æ•°æ®çš„å…±äº«å’ŒçŠ¶æ€çš„åŒæ­¥ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥æ­£é¢˜ï¼Œåˆ†åˆ«æ¥çœ‹ä¸€ä¸‹å¦‚ä½•é…ç½® MySQLã€Redis å’Œ Elasticsearch çš„å†…ç½‘é€šä¿¡ã€‚</p><h2 id="ä¿®æ”¹-MySQL-ç›‘å¬-IP"><a href="#ä¿®æ”¹-MySQL-ç›‘å¬-IP" class="headerlink" title="ä¿®æ”¹ MySQL ç›‘å¬ IP"></a>ä¿®æ”¹ MySQL ç›‘å¬ IP</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æœåŠ¡å™¨çš„å†…ç½‘ IP åœ°å€ï¼Œè¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ifconfig</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'inet addr'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ°å†…ç½‘ IP åœ°å€åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦ä¿®æ”¹ MySQL çš„é…ç½®æ–‡ä»¶äº†ã€‚æˆ‘ä»¬éœ€è¦å°† <code>bind-address</code> æ”¹ä¸ºåˆšæ‰æŸ¥åˆ°çš„å†…ç½‘ IP åœ°å€ã€‚</p><p>æ‰“å¼€ MySQL çš„é…ç½®æ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/mysql/mysql.conf.d/mysqld.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ° <code>bind-address</code> é¡¹ï¼Œå¹¶ä¿®æ”¹å®ƒï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">bind-address = {äº‘æœåŠ¡å™¨çš„å†…ç½‘ ip åœ°å€}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹å®Œæˆåï¼Œåˆ«å¿˜äº†é‡å¯ MySQL æœåŠ¡ä»¥åº”ç”¨æ›´æ”¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart mysql.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸ºäº†éªŒè¯ MySQL æœåŠ¡æ˜¯å¦æ­£ç¡®å¼€å¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> -anp<span class="token operator">|</span><span class="token function">grep</span> <span class="token number">3306</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¿®æ”¹-Redis-ç›‘å¬-IP"><a href="#ä¿®æ”¹-Redis-ç›‘å¬-IP" class="headerlink" title="ä¿®æ”¹ Redis ç›‘å¬ IP"></a>ä¿®æ”¹ Redis ç›‘å¬ IP</h2><p>ä¸ MySQL ç±»ä¼¼ï¼Œä¿®æ”¹ Redis çš„ç›‘å¬ IP ä¹Ÿæ˜¯å¿…è¦æ­¥éª¤ã€‚æ‰“å¼€ Redis çš„é…ç½®æ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/redis/redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰¾åˆ° <code>bind</code> é…ç½®é¡¹ï¼Œæ›¿æ¢ä¸ºå†…ç½‘ IP åœ°å€ï¼š</p><pre class="line-numbers language-redis" data-language="redis"><code class="language-redis">bind {äº‘æœåŠ¡å™¨çš„å†…ç½‘ ip åœ°å€}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹å®Œæˆåï¼ŒåŒæ ·éœ€è¦é‡å¯ Redis æœåŠ¡ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart redis.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸ºäº†ç¡®è®¤ Redis æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç«¯å£å·æ¥éªŒè¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> -anp<span class="token operator">|</span><span class="token function">grep</span> <span class="token number">6379</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¿®æ”¹-Elasticsearch-ç›‘å¬-IP"><a href="#ä¿®æ”¹-Elasticsearch-ç›‘å¬-IP" class="headerlink" title="ä¿®æ”¹ Elasticsearch ç›‘å¬ IP"></a>ä¿®æ”¹ Elasticsearch ç›‘å¬ IP</h2><p>æœ€åï¼Œè®©æˆ‘ä»¬æ¥è°ƒæ•´ Elasticsearch çš„é…ç½®ã€‚æ‰“å¼€ Elasticsearch çš„é…ç½®æ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/elasticsearch/elasticsearch.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ° <code>network.host</code> å’Œ <code>discovery.seed_hosts</code>ï¼Œå¹¶å»æ‰è¿™ä¸¤é¡¹å‰é¢çš„æ³¨é‡Šç¬¦å·ï¼ˆ<code>#</code>ï¼‰ï¼Œç„¶åå°†å…¶å€¼åˆ†åˆ«è®¾ç½®ä¸ºå†…ç½‘ IP åœ°å€ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">network.host</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>äº‘æœåŠ¡å™¨çš„å†…ç½‘ ip åœ°å€<span class="token punctuation">}</span><span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"{äº‘æœåŠ¡å™¨çš„å†…ç½‘ ip åœ°å€}"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¿®æ”¹å®Œæˆåï¼ŒåŒæ ·ä¸è¦å¿˜è®°é‡å¯ Elasticsearch æœåŠ¡ä»¥åº”ç”¨ä¿®æ”¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart elasticsearch.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€åï¼Œé€šè¿‡æ£€æŸ¥ç«¯å£ä¿¡æ¯æ¥ç¡®è®¤ Elasticsearch æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> -anp<span class="token operator">|</span><span class="token function">grep</span> <span class="token number">9200</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­å–œä½ ï¼Œé€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œä½ ä¸ä»…å­¦ä¼šäº†å¦‚ä½•è®¾ç½®ä¸åŒæœåŠ¡å™¨ä¹‹é—´çš„å†…ç½‘è¿æ¥ï¼Œè¿˜å®Œæˆäº†å¯¹ MySQLã€Redis å’Œ Elasticsearch ä¸‰å¤§å¸¸ç”¨æœåŠ¡çš„é…ç½®è°ƒæ•´ã€‚</p><p>å¤šæœºéƒ¨ç½²è™½ç„¶å¬èµ·æ¥å¤æ‚ï¼Œä½†åªè¦æŒ‰ç…§æ­£ç¡®çš„æ­¥éª¤æ“ä½œï¼Œå°±å¯ä»¥è½»æ¾å®ç°ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œç†è§£å…¶ä¸­çš„åŸç†å’Œé€»è¾‘ï¼Œè¿™å°†å¯¹ä½ æœªæ¥å¤„ç†æ›´å¤æ‚çš„éƒ¨ç½²åœºæ™¯å¤§æœ‰å¸®åŠ©ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ è¿ˆå‡ºå¤šæœºéƒ¨ç½²çš„ç¬¬ä¸€æ­¥ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç§‘æ™® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡å™¨é›†ç¾¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tmux å¿«é€Ÿå…¥é—¨ï¼šæé«˜ç»ˆç«¯ç®¡ç†æ•ˆç‡çš„å¿…å¤‡æŠ€èƒ½</title>
      <link href="posts/bb0f40eb.html"/>
      <url>posts/bb0f40eb.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„è½¯ä»¶å¼€å‘è¿‡ç¨‹å½“ä¸­ï¼Œç¨‹åºå‘˜ç»å¸¸éœ€è¦åŒæ—¶æ“ä½œå¤šä¸ªç»ˆç«¯çª—å£ã€‚ä¸è®ºæ˜¯ç¼–å†™ä»£ç ã€è¿è¡Œæµ‹è¯•ã€ç›‘æ§æ—¥å¿—ï¼Œè¿˜æ˜¯è¿œç¨‹ç™»å½•æœåŠ¡å™¨ï¼Œå¤šä¸ªçª—å£çš„åˆ‡æ¢ä¸ä»…ç¹çï¼Œè€Œä¸”é™ä½äº†å·¥ä½œæ•ˆç‡ã€‚</p><p>æ­¤æ—¶ï¼Œä¸€ä¸ªå«ä½œ <strong>Tmux</strong>ï¼ˆterminal multiplexerï¼‰çš„å·¥å…·å°±èƒ½å¤§æ˜¾èº«æ‰‹äº†ã€‚Tmux å…è®¸ä½ åœ¨ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­ï¼Œé€šè¿‡å¤šä¸ªçª—æ ¼ï¼ˆpaneï¼‰å’Œçª—å£ï¼ˆwindowï¼‰åŒæ—¶è¿›è¡Œå¤šé¡¹æ“ä½œï¼Œæå¤§åœ°æé«˜äº†ä½¿ç”¨ç»ˆç«¯çš„æ•ˆç‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€ä»‹ç»ä¸€ä¸‹ Tmux çš„åŸºç¡€ä½¿ç”¨æ–¹æ³•ï¼Œè®©ä½ è¿…é€Ÿä¸Šæ‰‹è¿™ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p><hr><h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><p>å¿«æ·é”®æ˜¯ Tmux æ“ä½œçš„æ ¸å¿ƒï¼Œé€šè¿‡å®ƒä»¬ï¼Œä½ å¯ä»¥å¿«é€Ÿå®ç°ä¼šè¯ç®¡ç†ã€çª—æ ¼å’Œçª—å£çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºç¡€ä¸”å¸¸ç”¨çš„å¿«æ·é”®åˆ—è¡¨ã€‚</p><h3 id="ä¼šè¯ç®¡ç†"><a href="#ä¼šè¯ç®¡ç†" class="headerlink" title="ä¼šè¯ç®¡ç†"></a>ä¼šè¯ç®¡ç†</h3><p>ä¼šè¯ï¼ˆSessionï¼‰æ˜¯ Tmux çš„é¡¶å±‚ç»„ç»‡å•ä½ï¼Œæ¯ä¸ªä¼šè¯å¯ä»¥åŒ…å«å¤šä¸ªçª—å£ã€‚</p><ul><li>åˆ†ç¦»å½“å‰ä¼šè¯ï¼š Ctrl+b d</li><li>åˆ—å‡ºæ‰€æœ‰ä¼šè¯ï¼š Ctrl+b s</li><li>é‡å‘½åå½“å‰ä¼šè¯ï¼š Ctrl+b $</li></ul><h3 id="çª—æ ¼æ“ä½œ"><a href="#çª—æ ¼æ“ä½œ" class="headerlink" title="çª—æ ¼æ“ä½œ"></a>çª—æ ¼æ“ä½œ</h3><p>çª—æ ¼æ˜¯åˆ†å±çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªçª—å£å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçª—æ ¼ã€‚</p><ul><li>åˆ’åˆ†å·¦å³ä¸¤ä¸ªçª—æ ¼ï¼š Ctrl+b %</li><li>åˆ’åˆ†ä¸Šä¸‹ä¸¤ä¸ªçª—æ ¼ï¼š Ctrl+b â€œ ï¼ˆå·¦åŒå¼•å·ï¼‰</li><li>ä¸Šä¸‹-å·¦å³çª—æ ¼äº’åˆ‡ï¼š Ctrl+b <space>  ï¼ˆç©ºæ ¼ï¼‰</space></li><li>å…‰æ ‡åˆ‡æ¢åˆ°å…¶ä»–çª—æ ¼ï¼š Ctrl+b <arrow key=""> ï¼ˆæ–¹å‘é”®ï¼‰</arrow></li><li>å½“å‰çª—æ ¼ä¸ä¸Šä¸€ä¸ªçª—æ ¼äº’æ¢ä½ç½®ï¼š Ctrl+b {</li><li>å½“å‰çª—æ ¼ä¸ä¸‹ä¸€ä¸ªçª—æ ¼äº’æ¢ä½ç½®ï¼š Ctrl+b }</li><li>å…³é—­å½“å‰çª—æ ¼ï¼š Ctrl+b x</li><li>å°†å½“å‰çª—æ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªç‹¬ç«‹çª—å£ï¼š Ctrl+b !</li><li>å½“å‰çª—æ ¼å…¨å±æ˜¾ç¤ºï¼š Ctrl+b z ï¼ˆå†æ¬¡ä½¿ç”¨æ¢å¤åŸæ¥å¤§å°ï¼‰</li><li>è°ƒæ•´çª—æ ¼å¤§å°ï¼š Ctrl+b Ctrl+<arrow key="">  ï¼ˆä»¥ 1 ä¸ªå•å…ƒæ ¼ä¸ºå•ä½è°ƒæ•´ï¼‰</arrow></li><li>è°ƒæ•´çª—æ ¼å¤§å°ï¼š Ctrl+b Alt+<arrow key="">  ï¼ˆä»¥ 5 ä¸ªå•å…ƒæ ¼ä¸ºå•ä½è°ƒæ•´ï¼‰</arrow></li><li>æ˜¾ç¤ºçª—æ ¼ç¼–å·ï¼š Ctrl+b q</li><li>é¡ºæ—¶é’ˆæ—‹è½¬å½“å‰çª—å£çš„çª—æ ¼ï¼š Ctrl+b Ctrl+o  ï¼ˆå­—æ¯ oï¼‰</li><li>é€†æ—¶é’ˆæ—‹è½¬å½“å‰çª—å£çš„çª—æ ¼ï¼š  Ctrl+b Alt+o</li><li>æ˜¾ç¤ºæ—¶é’Ÿï¼šCtrl+b t</li></ul><h3 id="çª—å£æ“ä½œ"><a href="#çª—å£æ“ä½œ" class="headerlink" title="çª—å£æ“ä½œ"></a>çª—å£æ“ä½œ</h3><p>çª—å£å¯ä»¥è§†ä¸ºå¤šä¸ªå·¥ä½œç©ºé—´ï¼Œæ¯ä¸ªçª—å£å¯ä»¥åŒ…å«å¤šä¸ªçª—æ ¼ã€‚</p><ul><li>åˆ›å»ºæ–°çª—å£ï¼š Ctrl+b c</li><li>åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—å£ï¼š Ctrl+b p</li><li>åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£ï¼š Ctrl+b n</li><li>åˆ‡æ¢åˆ°æŒ‡å®šç¼–å·çš„çª—å£: Ctrl+b <number></number></li><li>ä»åˆ—è¡¨ä¸­é€‰æ‹©çª—å£ï¼š Ctrl+b w</li><li>çª—å£é‡å‘½åï¼š Ctrl+b ,</li></ul><hr><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£… Tmux çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Ubuntu æˆ– Debian</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> tmux<span class="token comment"># CentOS æˆ– Fedora</span><span class="token function">sudo</span> yum <span class="token function">install</span> tmux<span class="token comment"># Mac</span>brew <span class="token function">install</span> tmux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯åŠ¨ä¸é€€å‡º"><a href="#å¯åŠ¨ä¸é€€å‡º" class="headerlink" title="å¯åŠ¨ä¸é€€å‡º"></a>å¯åŠ¨ä¸é€€å‡º</h2><p>è¦å¼€å§‹ä½¿ç”¨ Tmuxï¼Œåªéœ€æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ <code>tmux</code> æ¥å¯åŠ¨ã€‚</p><ul><li><strong>å¯åŠ¨</strong>ï¼šç›´æ¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>tmux</code>ã€‚</li><li><strong>é€€å‡º</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>Ctrl + d</code> æˆ–è€…è¾“å…¥ <code>exit</code> å‘½ä»¤ã€‚</li></ul><h2 id="ä¼šè¯ç®¡ç†-1"><a href="#ä¼šè¯ç®¡ç†-1" class="headerlink" title="ä¼šè¯ç®¡ç†"></a>ä¼šè¯ç®¡ç†</h2><p>ä¼šè¯è®©ä½ èƒ½åœ¨å•ä¸€çª—å£ä¸­ç®¡ç†å¤šä¸ªé¡¹ç›®æˆ–ä»»åŠ¡ï¼Œéå¸¸é€‚åˆå¤šä»»åŠ¡æ“ä½œã€‚</p><ol><li><strong>æ–°å»ºä¼šè¯</strong></li></ol><p>æ–°å»ºä¸€ä¸ªé»˜è®¤åç§°çš„ä¼šè¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tmux<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–æ–°å»ºä¸€ä¸ªæŒ‡å®šåç§°çš„ä¼šè¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tmux new <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>session-name<span class="token operator">&gt;</span>  <span class="token comment"># æ–°å»ºä¸€ä¸ªåç§°å«åš alex çš„ä¼šè¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li><strong>åˆ†ç¦»ä¼šè¯</strong></li></ol><p>è®©å½“å‰ä¼šè¯åœ¨åå°è¿è¡Œï¼Œä½ å¯ä»¥å®‰å…¨åœ°å…³é—­ç»ˆç«¯è¿æ¥ï¼Œä¹‹åå†é‡æ–°æ¥å…¥ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Ctrl + b d  <span class="token comment"># æˆ–è€… tmux detach</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li><strong>æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„ tmux ä¼šè¯</strong></li></ol><p>æŸ¥çœ‹æœ‰å“ªäº›ä¼šè¯æ­£åœ¨è¿è¡Œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tmux <span class="token function">ls</span>  <span class="token comment"># æˆ–è€… tmux list-session</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="é…ç½®ç›¸å…³"><a href="#é…ç½®ç›¸å…³" class="headerlink" title="é…ç½®ç›¸å…³"></a>é…ç½®ç›¸å…³</h2><ul><li>ç³»ç»Ÿé…ç½®æ–‡ä»¶ <code>/etc/tmux.conf</code></li><li>ç”¨æˆ·çº§é…ç½®æ–‡ä»¶ <code>~/.tmux.conf</code></li></ul><p>é…ç½®æ–‡ä»¶å®é™…ä¸Šå°±æ˜¯ <code>tmux</code> çš„å‘½ä»¤é›†åˆï¼Œä¹Ÿå°±æ˜¯è¯´æ¯è¡Œé…ç½®å‡å¯åœ¨è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼åè¾“å…¥ç”Ÿæ•ˆ</p><ul><li>å°† <code>Ctrl + r</code> è®¾ç½®ä¸ºåŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤º <code>Refresh configure!</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">bind</span> C-r source-file ~/.tmux.conf <span class="token punctuation">\</span><span class="token punctuation">;</span> display <span class="token string">"Refresh configure!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å°† <code>prefix</code> å¿«æ·é”®å‰ç¼€ç”± <code>Ctrl+b</code> æ›´æ”¹ä¸º <code>Ctrl+a</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Send prefix</span>set-option <span class="token parameter variable">-g</span> prefix C-aunbind-key C-abind-key C-a send-prefix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¸ç”¨æŒ‰å¿«æ·é”®å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ <code>alt + æ–¹å‘é”®</code> åœ¨ pane ä¹‹é—´ switch</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Use Alt-arrow keys to switch panes</span><span class="token builtin class-name">bind</span> <span class="token parameter variable">-n</span> M-Left select-pane <span class="token parameter variable">-L</span><span class="token builtin class-name">bind</span> <span class="token parameter variable">-n</span> M-Right select-pane <span class="token parameter variable">-R</span><span class="token builtin class-name">bind</span> <span class="token parameter variable">-n</span> M-Up select-pane <span class="token parameter variable">-U</span><span class="token builtin class-name">bind</span> <span class="token parameter variable">-n</span> M-Down select-pane <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¸ç”¨æŒ‰å¿«æ·é”®å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ <code>shift + æ–¹å‘é”®</code> åœ¨ window ä¹‹é—´ switch</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Shift arrow to switch windows</span><span class="token builtin class-name">bind</span> <span class="token parameter variable">-n</span> S-Left previous-window<span class="token builtin class-name">bind</span> <span class="token parameter variable">-n</span> S-Right next-window<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¼€å¯é¼ æ ‡æ¨¡å¼ï¼Œç”¨é¼ æ ‡å°±èƒ½åˆ‡æ¢ window ã€ paneã€è¿˜èƒ½è°ƒæ•´ pane çš„å¤§å°</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Mouse mode</span><span class="token builtin class-name">set</span> <span class="token parameter variable">-g</span> mouse on<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><code>Ctrl+b v</code> ç«–ç€åˆ†å±ï¼Œ <code>Ctrl+b h</code> æ¨ªç€åˆ†å±</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Set easier window split keys</span>bind-key <span class="token function">v</span> split-window <span class="token parameter variable">-h</span>bind-key h split-window <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>tmux æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç»ˆç«¯å¤ç”¨å™¨ï¼Œå®ƒé€šè¿‡ä¸°å¯Œçš„å¿«æ·é”®å’Œçµæ´»çš„é…ç½®é€‰é¡¹ï¼Œæå¤§åœ°æå‡äº†æˆ‘ä»¬ä½¿ç”¨ç»ˆç«¯çš„æ•ˆç‡ã€‚æ— è®ºä½ æ˜¯å¼€å‘è€…ã€ç³»ç»Ÿç®¡ç†å‘˜è¿˜æ˜¯æ™®é€šç”¨æˆ·ï¼ŒæŒæ¡ tmux éƒ½èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†ç»ˆç«¯ä¼šè¯ã€‚</p><p>æ“ä½œ Tmux çš„ç²¾é«“åœ¨äºçµæ´»åœ°ç®¡ç†å’Œåˆ‡æ¢ä¼šè¯ã€çª—å£å’Œçª—æ ¼ã€‚æŒæ¡ä»¥ä¸ŠåŸºæœ¬å‘½ä»¤ï¼Œå°±å¯ä»¥è®©ä½ çš„ç»ˆç«¯æ“ä½œæ•ˆç‡å¤§å¤§æé«˜ã€‚ç»§ç»­æ¢ç´¢ Tmuxï¼Œä½ ä¼šå‘ç°æ›´å¤šå¼ºå¤§åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰å¿«æ·é”®ã€è„šæœ¬è‡ªåŠ¨åŒ–ç­‰ï¼Œè®©ä½ çš„å·¥ä½œæ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç§‘æ™® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tmux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ç®¡ç†è¿œç¨‹ä¼šè¯ screenï¼šæŒæ¡ç»ˆç«¯çš„å¤šä»»åŠ¡æ“ä½œ</title>
      <link href="posts/1330f742.html"/>
      <url>posts/1330f742.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘å’ŒæœåŠ¡å™¨ç®¡ç†å·¥ä½œä¸­ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬é€šè¿‡ SSH è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œé€šå¸¸éœ€è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</p><p>Linux çš„ <code>screen</code> å‘½ä»¤ä¸ºæ­¤æä¾›äº†ä¸€ç§ç®€ä¾¿çš„è§£å†³æ–¹æ¡ˆã€‚<code>screen</code> å…è®¸ç”¨æˆ·åˆ›å»ºå¤šä¸ªä¼šè¯çª—å£ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´è‡ªç”±åˆ‡æ¢ï¼Œå³ä¾¿ä¸è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€ï¼Œè¿™äº›ä¼šè¯ä»ç„¶ä¼šåœ¨åå°è¿è¡Œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€ï¼Œæ¢ç´¢å¦‚ä½•é€šè¿‡ <code>screen</code> æé«˜æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚</p><h2 id="åˆè¯†-Screen"><a href="#åˆè¯†-Screen" class="headerlink" title="åˆè¯† Screen"></a>åˆè¯† Screen</h2><h3 id="åˆ›å»ºæ–°çš„ä¼šè¯çª—å£"><a href="#åˆ›å»ºæ–°çš„ä¼šè¯çª—å£" class="headerlink" title="åˆ›å»ºæ–°çš„ä¼šè¯çª—å£"></a>åˆ›å»ºæ–°çš„ä¼šè¯çª—å£</h3><p>å¦‚æœä½ æƒ³è¿è¡Œä¸€ä¸ªé•¿æ—¶é—´æ‰§è¡Œçš„å‘½ä»¤ï¼ˆæ¯”å¦‚å¤‡ä»½æ“ä½œï¼‰ï¼Œå¹¶ä¸å¸Œæœ›å› ä¸ºç½‘ç»œé—®é¢˜è€Œå¯¼è‡´å‘½ä»¤ä¸­æ–­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>screen</code> ä¼šè¯çª—å£ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-S</span> backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œ <code>-S</code> å‚æ•°åé¢è·Ÿç€çš„æ˜¯æˆ‘ä»¬ç»™è¿™ä¸ªä¼šè¯çª—å£çš„åå­—ï¼Œè¿™é‡Œåå­—æ˜¯ <code>backup</code>ã€‚</p><h3 id="æŸ¥çœ‹å½“å‰æ‰€æœ‰ä¼šè¯çª—å£"><a href="#æŸ¥çœ‹å½“å‰æ‰€æœ‰ä¼šè¯çª—å£" class="headerlink" title="æŸ¥çœ‹å½“å‰æ‰€æœ‰ä¼šè¯çª—å£"></a>æŸ¥çœ‹å½“å‰æ‰€æœ‰ä¼šè¯çª—å£</h3><p>å¦‚æœæƒ³è¦æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„ <code>screen</code> ä¼šè¯çª—å£ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼äº <code>session_id</code> çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†ä¼šè¯çš„åç§°å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œå¸®åŠ©ä½ è¯†åˆ«å’Œç®¡ç†å¤šä¸ªä¼šè¯ã€‚</p><h3 id="é€€å‡ºä¼šè¯çª—å£"><a href="#é€€å‡ºä¼šè¯çª—å£" class="headerlink" title="é€€å‡ºä¼šè¯çª—å£"></a>é€€å‡ºä¼šè¯çª—å£</h3><p>å½“ä½ å®Œæˆå·¥ä½œï¼Œæƒ³è¦é€€å‡ºæŸä¸ª <code>screen</code> ä¼šè¯æ—¶ï¼Œå¯ä»¥ç®€å•åœ°è¾“å…¥ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¼šç»“æŸå½“å‰çš„ä¼šè¯ï¼Œå¹¶å…³é—­ç›¸å…³çš„çª—å£ã€‚</p><h2 id="é«˜çº§æ“ä½œ"><a href="#é«˜çº§æ“ä½œ" class="headerlink" title="é«˜çº§æ“ä½œ"></a>é«˜çº§æ“ä½œ</h2><h3 id="åœ¨-screen-ä¸­è¿è¡Œå‘½ä»¤"><a href="#åœ¨-screen-ä¸­è¿è¡Œå‘½ä»¤" class="headerlink" title="åœ¨ screen ä¸­è¿è¡Œå‘½ä»¤"></a>åœ¨ screen ä¸­è¿è¡Œå‘½ä»¤</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ç›´æ¥åœ¨åˆ›å»º <code>screen</code> ä¼šè¯çš„åŒæ—¶æ‰§è¡ŒæŸä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”åœ¨è¯¥å‘½ä»¤æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨ç»“æŸä¼šè¯ã€‚å¯ä»¥è¿™æ ·åšï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token function">vim</span> memo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ä¸€ä¸ªæ–°çš„ <code>screen</code> ä¼šè¯ä¸­æ‰“å¼€ <code>vim</code> ç¼–è¾‘å™¨ç¼–è¾‘ <code>memo.txt</code> æ–‡ä»¶ï¼Œå½“ä½ é€€å‡º <code>vim</code> æ—¶ï¼Œè¯¥ <code>screen</code> ä¼šè¯ä¹Ÿä¼šè‡ªåŠ¨ç»“æŸã€‚</p><h3 id="ä¼šè¯å…±äº«åŠŸèƒ½"><a href="#ä¼šè¯å…±äº«åŠŸèƒ½" class="headerlink" title="ä¼šè¯å…±äº«åŠŸèƒ½"></a>ä¼šè¯å…±äº«åŠŸèƒ½</h3><p><code>screen</code> çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½æ˜¯æ”¯æŒä¼šè¯å…±äº«ï¼Œæ„å‘³ç€å¤šä¸ªç”¨æˆ·å¯ä»¥å®æ—¶å…±äº«å’Œæ“ä½œåŒä¸€ä¸ªä¼šè¯è§†å›¾ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç»ˆç«¯ Aï¼šåˆ›å»ºä¼šè¯</span><span class="token function">screen</span> <span class="token parameter variable">-S</span> backup<span class="token comment"># ç»ˆç«¯ Bï¼šåŒæ­¥ç»ˆç«¯ä¿¡æ¯</span><span class="token function">screen</span> <span class="token parameter variable">-x</span><span class="token comment"># æˆ–è€…é€šè¿‡æŒ‡å®šå…·ä½“çš„ session-id æ¥å…±äº«ä¼šè¯</span><span class="token function">screen</span> <span class="token parameter variable">-x</span> <span class="token operator">&lt;</span>screen-session-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚</span><span class="token function">screen</span> <span class="token parameter variable">-x</span> <span class="token number">364490</span>.backup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™å¯¹äºåä½œè°ƒè¯•å’Œæ•™å­¦éå¸¸æœ‰ç”¨ã€‚</p><h3 id="é‡æ–°è¿æ¥æ–­å¼€çš„ä¼šè¯"><a href="#é‡æ–°è¿æ¥æ–­å¼€çš„ä¼šè¯" class="headerlink" title="é‡æ–°è¿æ¥æ–­å¼€çš„ä¼šè¯"></a>é‡æ–°è¿æ¥æ–­å¼€çš„ä¼šè¯</h3><p>å½“ <code>screen</code> ä¼šè¯å› ä¸ºç½‘ç»œé—®é¢˜æˆ–å…¶å®ƒåŸå› æ–­å¼€æ—¶ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°é‡æ–°è¿æ¥åˆ°è¿™ä¸ªä¼šè¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-r</span> backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœ <code>screen</code> æç¤ºä¼šè¯çŠ¶æ€ä¸º Attachedï¼Œè¯´æ˜ä¼šè¯ä»è¢«å¦ä¸€ä¸ªè¿æ¥å ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¼ºåˆ¶å›æ”¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-r</span> backup<span class="token comment"># æˆ–</span><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>screen-session-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚</span><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-r</span> backup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><code>screen</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šé«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªä¼šè¯ï¼Œä¿è¯å…³é”®ä»»åŠ¡çš„æŒç»­è¿è¡Œï¼Œç”šè‡³åœ¨ä¸åŒç”¨æˆ·ä¹‹é—´å…±äº«ä¼šè¯ï¼Œä»¥ä¾¿äºåä½œå’Œæ•™å­¦ã€‚</p><p>ä½¿ç”¨ç®€å•çš„æ“ä½œï¼Œå´èƒ½æå¤§åœ°æå‡æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡å’Œåä½œèƒ½åŠ›ã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ å…¥é—¨å¹¶å®è·µä½¿ç”¨ <code>screen</code>ï¼Œè®©ä½ çš„ Linux ç»éªŒæ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> screen </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>expectè‡ªåŠ¨äº¤äº’è„šæœ¬ï¼šç®€åŒ–ä½ çš„è‡ªåŠ¨åŒ–ä»»åŠ¡</title>
      <link href="posts/9f8553ef.html"/>
      <url>posts/9f8553ef.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„ Linux ç³»ç»Ÿç®¡ç†å’Œè‡ªåŠ¨åŒ–ä»»åŠ¡å¤„ç†ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦è‡ªåŠ¨ç™»å½•åˆ°æœåŠ¡å™¨å¹¶æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤çš„æƒ…å†µï¼Œä¾‹å¦‚æ‰¹é‡éƒ¨ç½²æ›´æ–°ã€ç›‘æ§æ—¥å¿—ç­‰ã€‚æ‰‹åŠ¨æ“ä½œä¸ä»…è€—æ—¶è€—åŠ›ï¼Œè€Œä¸”æ•ˆç‡ä½ä¸‹ï¼Œç‰¹åˆ«æ˜¯å½“æ¶‰åŠåˆ°å¤šå°æœåŠ¡å™¨æ—¶ã€‚</p><p><code>expect</code> å·¥å…·å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜è€Œç”Ÿã€‚å®ƒå¯ä»¥æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ï¼Œè‡ªåŠ¨åŒ–æ§åˆ¶äº¤äº’å¼åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><p>æœ¬æ–‡å°†ä»åˆå­¦è€…çš„è§’åº¦å‡ºå‘ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>expect</code> æ¥ç®€åŒ–æ—¥å¸¸çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p><h2 id="å®‰è£…-expect"><a href="#å®‰è£…-expect" class="headerlink" title="å®‰è£… expect"></a>å®‰è£… expect</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿ä½ çš„ç³»ç»Ÿä¸­å·²å®‰è£… <code>expect</code>ã€‚å®‰è£… <code>expect</code> çš„æ­¥éª¤éå¸¸ç®€å•ï¼š</p><h3 id="CentOS-ç³»ç»Ÿ"><a href="#CentOS-ç³»ç»Ÿ" class="headerlink" title="CentOS ç³»ç»Ÿ"></a>CentOS ç³»ç»Ÿ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…ä¾èµ–åŒ…</span>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> tcl<span class="token comment"># å®‰è£… expect</span>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">expect</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Ubuntu-ç³»ç»Ÿ"><a href="#Ubuntu-ç³»ç»Ÿ" class="headerlink" title="Ubuntu ç³»ç»Ÿ"></a>Ubuntu ç³»ç»Ÿ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">expect</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="è‡ªåŠ¨ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œè„šæœ¬"><a href="#è‡ªåŠ¨ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œè„šæœ¬" class="headerlink" title="è‡ªåŠ¨ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œè„šæœ¬"></a>è‡ªåŠ¨ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œè„šæœ¬</h2><h3 id="åŸºç¡€ç¤ºä¾‹"><a href="#åŸºç¡€ç¤ºä¾‹" class="headerlink" title="åŸºç¡€ç¤ºä¾‹"></a>åŸºç¡€ç¤ºä¾‹</h3><p>ä»¥è‡ªåŠ¨ç™»å½•æœåŠ¡å™¨å¹¶éƒ¨ç½€é¡¹ç›®çš„è„šæœ¬ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹å¦‚ä½•ä½¿ç”¨ <code>expect</code>ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/expect -f</span><span class="token builtin class-name">set</span> user root <span class="token comment"># è¿™é‡Œå¡«å†™è´¦æˆ·åç§°</span><span class="token builtin class-name">set</span> <span class="token function">host</span> <span class="token number">127.0</span>.0.1 <span class="token comment"># è¿™é‡Œå¡«å†™æœåŠ¡å™¨ IP åœ°å€</span><span class="token builtin class-name">set</span> password <span class="token number">123456</span> <span class="token comment"># è¿™é‡Œå¡«å†™å¯†ç </span><span class="token builtin class-name">set</span> <span class="token function">timeout</span> <span class="token parameter variable">-1</span> <span class="token comment"># è®¾ç½®è¶…æ—¶æ—¶é—´æ°¸ä¸è¶…æ—¶ï¼Œé»˜è®¤ä¸º 10 ç§’</span><span class="token comment"># å¯åŠ¨ ssh å‘½ä»¤</span>spawn <span class="token function">ssh</span> <span class="token variable">$user</span>@<span class="token variable">$host</span><span class="token function">expect</span> <span class="token string">"password:*"</span>send <span class="token string">"<span class="token variable">$password</span><span class="token entity" title="\r">\r</span>"</span><span class="token comment"># æ‰§è¡Œç›®æ ‡å‘½ä»¤</span><span class="token function">expect</span> <span class="token string">"#"</span>send <span class="token string">"cd /data/portal_api_dfo_hyperf<span class="token entity" title="\r">\r</span>"</span><span class="token function">expect</span> <span class="token string">"#"</span>send <span class="token string">"./deploy.sh<span class="token entity" title="\r">\r</span>"</span><span class="token function">expect</span> <span class="token string">"#"</span><span class="token comment"># è¯»å–åˆ°æ–‡ä»¶ç»“æŸç¬¦ï¼Œè¡¨ç¤º expect æ‰§è¡Œç»“æŸ</span><span class="token function">expect</span> eof<span class="token comment"># è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œç”¨æˆ·å°†åœç•™åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Š</span>interact<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µè„šæœ¬ç®€æ´ç›´è§‚åœ°å±•ç¤ºäº†å¦‚ä½•è‡ªåŠ¨ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œç®€å•å‘½ä»¤ã€‚</p><h3 id="è·å–-IP-åœ°å€"><a href="#è·å–-IP-åœ°å€" class="headerlink" title="è·å– IP åœ°å€"></a>è·å– IP åœ°å€</h3><p><code>expect</code> ä¹Ÿå¯ä»¥é…åˆå…¶ä»–å‘½ä»¤ä½¿ç”¨ï¼Œä¾‹å¦‚è·å–æœåŠ¡å™¨çš„ IP åœ°å€ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> idcid <span class="token punctuation">[</span>exec <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token punctuation">{</span>ifconfig eth0 <span class="token operator">|</span> <span class="token function">grep</span> Mask <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f2</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡æ‰§è¡Œ shell å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‘½ä»¤çš„è¾“å‡ºèµ‹å€¼ç»™ <code>expect</code> è„šæœ¬ä¸­çš„å˜é‡ã€‚</p><h3 id="è¿›é˜¶ç¤ºä¾‹"><a href="#è¿›é˜¶ç¤ºä¾‹" class="headerlink" title="è¿›é˜¶ç¤ºä¾‹"></a>è¿›é˜¶ç¤ºä¾‹</h3><p>è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ›´å¤æ‚çš„ <code>expect</code> è„šæœ¬æ¥å®ç°è‡ªåŠ¨è¿æ¥æœåŠ¡å™¨å¹¶è¿›å…¥ MySQL æ•°æ®åº“ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/expect -f</span><span class="token builtin class-name">set</span> <span class="token function">timeout</span> <span class="token parameter variable">-1</span>spawn <span class="token function">ssh</span> root@127.0.0.1<span class="token function">expect</span> <span class="token parameter variable">-re</span> <span class="token string">"password"</span> <span class="token punctuation">{</span> send <span class="token string">"userpwd123<span class="token entity" title="\r">\r</span>"</span> <span class="token punctuation">}</span><span class="token function">expect</span> <span class="token parameter variable">-re</span> <span class="token string">":~#"</span> <span class="token punctuation">{</span> send <span class="token string">"mysql -uroot -p123456<span class="token entity" title="\r">\r</span>"</span> <span class="token punctuation">}</span><span class="token function">expect</span> <span class="token parameter variable">-re</span> <span class="token string">"mysql&gt;"</span> <span class="token punctuation">{</span> send <span class="token string">"show databases;<span class="token entity" title="\r">\r</span>"</span> <span class="token punctuation">}</span><span class="token function">expect</span> <span class="token parameter variable">-re</span> <span class="token string">"mysql&gt;"</span> <span class="token punctuation">{</span> <span class="token builtin class-name">exit</span> <span class="token punctuation">}</span><span class="token function">expect</span> eof<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•ä¸€äº›å…¶ä»–çš„å‚æ•°"><a href="#æµ‹è¯•ä¸€äº›å…¶ä»–çš„å‚æ•°" class="headerlink" title="æµ‹è¯•ä¸€äº›å…¶ä»–çš„å‚æ•°"></a>æµ‹è¯•ä¸€äº›å…¶ä»–çš„å‚æ•°</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/usr/bin/expect -f</span><span class="token builtin class-name">set</span> user root<span class="token builtin class-name">set</span> <span class="token function">host</span> <span class="token number">127.0</span>.0.1<span class="token builtin class-name">set</span> password <span class="token number">123456</span><span class="token builtin class-name">set</span> <span class="token function">timeout</span> <span class="token parameter variable">-1</span>spawn <span class="token function">ssh</span> <span class="token variable">$user</span>@<span class="token variable">$host</span><span class="token function">expect</span> <span class="token string">"password:*"</span>send <span class="token string">"<span class="token variable">$password</span><span class="token entity" title="\r">\r</span>"</span>send_user <span class="token string">"Now! we will deploy the project of portal_api_dfo_hyperf<span class="token entity" title="\r">\r</span>"</span>  <span class="token comment"># æ‰“å°ä¿¡æ¯ï¼Œç±»ä¼¼ echo</span><span class="token builtin class-name">set</span> tt <span class="token punctuation">[</span>exec <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token punctuation">{</span>echo <span class="token number">1212123</span><span class="token punctuation">}</span><span class="token punctuation">]</span>  <span class="token comment">#   æ‰§è¡Œ shell è¯­å¥</span>puts <span class="token string">"<span class="token variable">$tt</span>"</span>  <span class="token comment"># æ‰“å°ä¿¡æ¯ï¼Œç±»ä¼¼ echo</span><span class="token function">expect</span> <span class="token string">"#"</span>send <span class="token string">"cd /data/portal_api_dfo_hyperf<span class="token entity" title="\r">\r</span>"</span><span class="token function">expect</span> <span class="token string">"#"</span>send <span class="token string">"./deploy.sh<span class="token entity" title="\r">\r</span>"</span><span class="token function">expect</span> <span class="token string">"Detected an available cache, skip the vendor scan process"</span><span class="token function">sleep</span> <span class="token number">10</span>  <span class="token comment"># è„šæœ¬è¿›å…¥ç¡çœ </span>send <span class="token string">"<span class="token entity" title="\003">\003</span>"</span> <span class="token comment"># å¦‚æœæƒ³å‘è¿œç«¯å‘é€ Ctrl-C ç»“æŸè¿œç«¯è¿›ç¨‹</span><span class="token builtin class-name">exit</span>  <span class="token comment"># é€€å‡º</span><span class="token comment">#interact</span><span class="token function">expect</span> eof<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ”¯æŒç™»å½•å¤šå°æœåŠ¡å™¨çš„è„šæœ¬"><a href="#æ”¯æŒç™»å½•å¤šå°æœåŠ¡å™¨çš„è„šæœ¬" class="headerlink" title="æ”¯æŒç™»å½•å¤šå°æœåŠ¡å™¨çš„è„šæœ¬"></a>æ”¯æŒç™»å½•å¤šå°æœåŠ¡å™¨çš„è„šæœ¬</h2><p>åœ¨ç®¡ç†å¤šå°æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥é€‰æ‹©æ€§ç™»å½•ä¸åŒçš„æœåŠ¡å™¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">echo</span> <span class="token string">"1. é˜¿é‡Œäº‘"</span><span class="token builtin class-name">echo</span> <span class="token string">"2. ç™¾åº¦äº‘"</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"é€‰æ‹©è¦ç™»å½•çš„æœåŠ¡å™¨: "</span><span class="token builtin class-name">read</span> choose<span class="token keyword">case</span> <span class="token variable">$choose</span> <span class="token keyword">in</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token function">expect</span> <span class="token parameter variable">-c</span> <span class="token string">'  set timeout -1  spawn ssh root@æœåŠ¡å™¨IPåœ°å€  expect {          "yes/no"  {send "yes\r"; exp_continue}          "*assword"  {send "æœåŠ¡å™¨å¯†ç \r"}      }  interact  expect eof  '</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µè„šæœ¬ä½¿ç”¨äº† bash å’Œ <code>expect</code> çš„æ··åˆç¼–ç¨‹ï¼Œä½¿å¾—æ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œè‡ªåŠ¨é€‰æ‹©å¹¶ç™»å½•åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>expect</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·çš„é”®ç›˜è¾“å…¥æ“ä½œï¼Œå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åŒ–æ‰§è¡Œå„ç§äº¤äº’å¼å‘½ä»¤ã€‚é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œä½ åº”è¯¥å·²ç»å¯¹å¦‚ä½•ä½¿ç”¨ <code>expect</code> æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚</p><p>å®é™…ä¸Šï¼Œ<code>expect</code> çš„åº”ç”¨åœºæ™¯éå¸¸ä¸°å¯Œï¼ŒæŒæ¡äº†è¿™ä¸ªå·¥å…·ï¼Œä½ å°†èƒ½å¤Ÿå¤§å¤§æå‡ä½ çš„å·¥ä½œæ•ˆç‡ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> expect </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSHå®‰å…¨è¿œç¨‹ç™»å½•ä¸ç«¯å£è½¬å‘</title>
      <link href="posts/af7eff68.html"/>
      <url>posts/af7eff68.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä»Šå¤©è¿™ä¸ªäº‘è®¡ç®—ç››è¡Œçš„æ—¶ä»£ï¼ŒSSHï¼ˆSecure Shellï¼‰å‡ ä¹æˆäº†æ¯ä¸ªå¼€å‘è€…å¿…å¤‡æŠ€èƒ½ä¹‹ä¸€ã€‚SSH ä¸ä»…å¯ä»¥è®©æˆ‘ä»¬å®‰å…¨åœ°è¿œç¨‹ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œæ‰§è¡Œæ“ä½œï¼Œè¿˜æ”¯æŒå¦‚æ–‡ä»¶ä¼ è¾“ã€ç«¯å£è½¬å‘ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><p>æœ¬æ–‡å°†ç”¨æµ…æ˜¾æ˜“æ‡‚çš„è¯­è¨€ï¼Œå¸¦ä½ æ·±å…¥äº†è§£ SSH çš„ä¸¤ä¸ªå¸¸ç”¨åŠŸèƒ½ï¼š<strong>ä½¿ç”¨å¯†é’¥ç™»å½•</strong>å’Œ<strong>é€šè¿‡ SSH å®ç°ç«¯å£è½¬å‘</strong>ã€‚</p><h2 id="ä½¿ç”¨å¯†é’¥ç™»å½•"><a href="#ä½¿ç”¨å¯†é’¥ç™»å½•" class="headerlink" title="ä½¿ç”¨å¯†é’¥ç™»å½•"></a>ä½¿ç”¨å¯†é’¥ç™»å½•</h2><p>ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œ SSH ç™»å½•ã€‚ä½†åœ¨å®‰å…¨æ€§è¦æ±‚æ›´é«˜çš„ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨å¯†é’¥ç™»å½•æ˜¯æ›´æ¨èçš„é€‰æ‹©ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®¢æˆ·ç«¯ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆä¸€ä¸ªå…¬å¼€çš„ã€Œå…¬é’¥ã€å’Œä¸€ä¸ªç§æœ‰çš„ã€Œç§é’¥ã€ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œå°†å…¬é’¥é…ç½®åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶ååˆ©ç”¨å®¢æˆ·ç«¯çš„ç§é’¥è¿›è¡Œè®¤è¯ç™»å½•ã€‚è¿™æ ·ï¼Œå³ä½¿æœ‰äººçŸ¥é“äº†æˆ‘ä»¬çš„æœåŠ¡å™¨ IP å’Œç”¨æˆ·ï¼Œæ²¡æœ‰ç§é’¥ä¹Ÿæ— æ³•ç™»å½•ã€‚</p><h3 id="é¦–æ¬¡è®¾ç½®å’Œç™»å½•"><a href="#é¦–æ¬¡è®¾ç½®å’Œç™»å½•" class="headerlink" title="é¦–æ¬¡è®¾ç½®å’Œç™»å½•"></a>é¦–æ¬¡è®¾ç½®å’Œç™»å½•</h3><ol><li><p><strong>ç”Ÿæˆå¯†é’¥å¯¹</strong> (å¦‚æœå·²æœ‰å¯†é’¥å¯¹å¯è·³è¿‡æ­¤æ­¥éª¤)ã€‚</p><p>æ‰“å¼€ç»ˆç«¯è¿è¡Œï¼š</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-keygen<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li><p><strong>ç™»å½•åˆ°ä½ çš„æœåŠ¡å™¨</strong> ï¼Œå¹¶å°†å…¬é’¥å†…å®¹æ·»åŠ åˆ° <code>~/.ssh/authorized_keys</code> ä¸­ã€‚</p></li><li><p><strong>ä½¿ç”¨å¯†é’¥ç™»å½•</strong>ï¼š</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> root@<span class="token punctuation">{</span>ä½ çš„æœåŠ¡å™¨å…¬ç½‘ IP<span class="token punctuation">}</span> <span class="token parameter variable">-i</span> ~/.ssh/<span class="token operator">&lt;</span>your-pem-name<span class="token operator">&gt;</span>.pem<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„  <code>-i</code> å‚æ•°ç”¨äºæŒ‡å®šç§é’¥æ–‡ä»¶çš„è·¯å¾„ã€‚</p><p>ä¸ºç®€åŒ–ç™»å½•è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ ssh é…ç½®æ–‡ä»¶ï¼š</p><p>åœ¨å®¢æˆ·ç«¯ç¼–è¾‘ <code>vim ~/.ssh/config</code> æ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># PubkeyAuthentication yes ä»£è¡¨ä½¿ç”¨å¯†é’¥æ–¹å¼ç™»å½•</span><span class="token comment"># IdentityFile ç”¨äºæŒ‡å®šå¯†é’¥æ–‡ä»¶è·¯å¾„</span>Host <span class="token punctuation">{</span>ä½ çš„äº‘æœåŠ¡å™¨å…¬ç½‘ IP<span class="token punctuation">}</span>    PubkeySerialization <span class="token function">yes</span>    IdentificationFile ~/.ssh/<span class="token operator">&lt;</span>your-pem-name<span class="token operator">&gt;</span>.pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®åï¼Œç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç™»å½•ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> root@<span class="token punctuation">{</span>ä½ çš„äº‘æœåŠ¡å™¨å…¬ç½‘ IP<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="é€šè¿‡-SSH-å®ç°ç«¯å£è½¬å‘"><a href="#é€šè¿‡-SSH-å®ç°ç«¯å£è½¬å‘" class="headerlink" title="é€šè¿‡ SSH å®ç°ç«¯å£è½¬å‘"></a>é€šè¿‡ SSH å®ç°ç«¯å£è½¬å‘</h2><p>åœ¨è¿›è¡Œæ•°æ®åˆ†æã€Web å¼€å‘ç­‰åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æœåŠ¡ç«¯å£æ˜ å°„åˆ°æœ¬åœ°ç«¯å£ï¼Œä»¥ä¾¿æœ¬åœ°è®¿é—®ã€‚SSH çš„ç«¯å£è½¬å‘åŠŸèƒ½è®©è¿™ä¸€éœ€æ±‚å¾—ä»¥ç®€å•å®ç°ã€‚</p><h3 id="ç«¯å£è½¬å‘çš„åŸºæœ¬ç”¨æ³•"><a href="#ç«¯å£è½¬å‘çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="ç«¯å£è½¬å‘çš„åŸºæœ¬ç”¨æ³•"></a>ç«¯å£è½¬å‘çš„åŸºæœ¬ç”¨æ³•</h3><p>å‡è®¾ä½ æƒ³è¦è®¿é—®ä½äº <code>192.168.0.101</code> æœåŠ¡å™¨ä¸Šçš„ <code>9200</code> ç«¯å£çš„æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ SSH å°†è¯¥ç«¯å£æ˜ å°„åˆ°æœ¬åœ°æœºå™¨çš„ <code>9201</code> ç«¯å£ä¸Šï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-N</span> <span class="token number">9201</span>:0.0.0.0:9200 alex@192.168.0.101<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„ <code>-L</code> å‚æ•°æŒ‡å®šäº†æœ¬åœ°ç«¯å£è½¬å‘ï¼Œ<code>-N</code> å‚æ•°è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚</p><h3 id="ç«¯å£è½¬å‘çš„é«˜çº§ç”¨æ³•"><a href="#ç«¯å£è½¬å‘çš„é«˜çº§ç”¨æ³•" class="headerlink" title="ç«¯å£è½¬å‘çš„é«˜çº§ç”¨æ³•"></a>ç«¯å£è½¬å‘çš„é«˜çº§ç”¨æ³•</h3><p>å¦‚æœ SSH æœåŠ¡çš„é»˜è®¤ç«¯å£ <code>22</code> è¢«æ›´æ”¹äº†ï¼Œæ¯”å¦‚æ”¹ä¸ºäº† <code>2202</code>ï¼Œä½ å¯ä»¥é€šè¿‡ <code>-p</code> å‚æ•°æŒ‡å®š SSH è¿æ¥çš„ç«¯å£ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-N</span> <span class="token number">9201</span>:0.0.0.0:9200 <span class="token parameter variable">-p</span> <span class="token number">2202</span> alex@192.168.0.101<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ç«¯å£è½¬å‘çš„åº”ç”¨åœºæ™¯"><a href="#ç«¯å£è½¬å‘çš„åº”ç”¨åœºæ™¯" class="headerlink" title="ç«¯å£è½¬å‘çš„åº”ç”¨åœºæ™¯"></a>ç«¯å£è½¬å‘çš„åº”ç”¨åœºæ™¯</h3><p>ç«¯å£è½¬å‘å¯ä»¥ç”¨äºå¤šç§åœºæ™¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>è®¿é—®ä½äºå†…ç½‘ä¸­çš„æ•°æ®åº“æˆ– Web æœåŠ¡ã€‚</li><li>ç»•è¿‡é˜²ç«å¢™è®¿é—®æŸäº›æœåŠ¡ã€‚</li><li>ä¸ºè¿œç¨‹æœåŠ¡æä¾›ä¸€ä¸ªå®‰å…¨çš„æœ¬åœ°è®¿é—®ç‚¹ã€‚</li></ul><p>é€šè¿‡ä¸Šé¢çš„åˆ†äº«ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ SSH çš„å¯†é’¥ç™»å½•å’Œç«¯å£è½¬å‘åŠŸèƒ½æœ‰äº†åˆæ­¥çš„äº†è§£ã€‚è¿™ä¸¤ä¸ªåŠŸèƒ½åœ¨æ—¥å¸¸å¼€å‘ä¸­éå¸¸æœ‰ç”¨ï¼ŒæŒæ¡å®ƒä»¬å°†å¤§å¤§æé«˜ä½ çš„å·¥ä½œæ•ˆç‡ã€‚</p><p>è®°ä½ï¼Œå®è·µæ˜¯å­¦ä¹ çš„æ·å¾„ã€‚ä¸å¦¨äº²è‡ªåŠ¨æ‰‹å°è¯•ä¸€ä¸‹ï¼Œå®æ“ä¸­ä½ ä¼šæœ‰æ›´æ·±çš„é¢†æ‚Ÿã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŸ¥é“è¿™å‡ ä¸ªLinuxç»„åˆå‘½ä»¤ï¼Œæ•ˆç‡å¤§å¤§æå‡ï¼</title>
      <link href="posts/d9e9c80b.html"/>
      <url>posts/d9e9c80b.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„æœåŠ¡å™¨ç®¡ç†å’Œé—®é¢˜è¯Šæ–­è¿‡ç¨‹ä¸­ï¼ŒLinux å‘½ä»¤è¡Œå·¥å…·æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚æœ¬æ–‡é€šè¿‡å‡ ä¸ªå¸¸ç”¨çš„ç¤ºä¾‹ï¼Œä»‹ç»å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜ã€ç›‘æ§æœåŠ¡å™¨æ€§èƒ½ã€‚</p><p>æ— è®ºä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼Œç†è§£å’ŒæŒæ¡è¿™äº›å‘½ä»¤ï¼Œéƒ½å°†åœ¨ä½ çš„å·¥ä½œä¸­å¤§æ”¾å¼‚å½©ã€‚</p><h2 id="ç›‘æ§ç½‘ç»œè¯·æ±‚"><a href="#ç›‘æ§ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç›‘æ§ç½‘ç»œè¯·æ±‚"></a>ç›‘æ§ç½‘ç»œè¯·æ±‚</h2><h3 id="æŸ¥æ‰¾-80-ç«¯å£è¯·æ±‚æ•°æœ€é«˜çš„å‰-20-ä¸ª-IP"><a href="#æŸ¥æ‰¾-80-ç«¯å£è¯·æ±‚æ•°æœ€é«˜çš„å‰-20-ä¸ª-IP" class="headerlink" title="æŸ¥æ‰¾ 80 ç«¯å£è¯·æ±‚æ•°æœ€é«˜çš„å‰ 20 ä¸ª IP"></a>æŸ¥æ‰¾ 80 ç«¯å£è¯·æ±‚æ•°æœ€é«˜çš„å‰ 20 ä¸ª IP</h3><p>å½“æˆ‘ä»¬çš„æœåŠ¡å™¨å“åº”æ…¢æˆ–è€…ç½‘ç»œæµé‡å¼‚å¸¸æ—¶ï¼Œç¬¬ä¸€æ­¥å¾€å¾€æ˜¯æ£€æŸ¥å“ªäº›å®¢æˆ·ç«¯æ­£åœ¨é¢‘ç¹è®¿é—®æˆ‘ä»¬çš„æœåŠ¡ã€‚ä»¥ä¸‹å‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿…é€Ÿå®šä½åˆ°è¯·æ±‚æ•°æœ€é«˜çš„å‰ 20 ä¸ª IP åœ°å€ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> -anlp<span class="token operator">|</span><span class="token function">grep</span> <span class="token number">80</span><span class="token operator">|</span><span class="token function">grep</span> tcp<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $5}'</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print $1}'</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>netstat -anlp</code> æ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰è¿æ¥çš„çŠ¶æ€ã€‚</li><li><code>grep 80</code> ç­›é€‰å‡ºä¸ 80 ç«¯å£ç›¸å…³çš„è¿æ¥ã€‚</li><li><code>awk '{print $5}'</code> è·å–è¿œç¨‹åœ°å€å’Œç«¯å£ã€‚</li><li><code>sort|uniq -c|sort -nr</code> å¯¹ IP åœ°å€è®¡æ•°å¹¶é™åºæ’åˆ—ã€‚</li></ul><p>è¿™ä¸ªå‘½ä»¤å¯¹äºå‘ç°æ½œåœ¨çš„ DDoS æ”»å‡»å°è¯•æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><h2 id="åˆ†æ-TCP-è¿æ¥çŠ¶æ€"><a href="#åˆ†æ-TCP-è¿æ¥çŠ¶æ€" class="headerlink" title="åˆ†æ TCP è¿æ¥çŠ¶æ€"></a>åˆ†æ TCP è¿æ¥çŠ¶æ€</h2><h3 id="æŸ¥çœ‹-TCP-è¿æ¥çŠ¶æ€"><a href="#æŸ¥çœ‹-TCP-è¿æ¥çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ TCP è¿æ¥çŠ¶æ€"></a>æŸ¥çœ‹ TCP è¿æ¥çŠ¶æ€</h3><p>ç†è§£æœåŠ¡å™¨ä¸Šå½“å‰ TCP è¿æ¥çš„çŠ¶æ€å¯¹äºæ’æŸ¥ç½‘ç»œé—®é¢˜æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-nat</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $6}'</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-rn</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯¥å‘½ä»¤ç”¨äºç»Ÿè®¡æ¯ç§è¿æ¥çŠ¶æ€çš„æ•°é‡ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿäº†è§£æœåŠ¡å™¨ç½‘ç»œè¿æ¥çš„çŠ¶å†µã€‚</p><h2 id="CPU-å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#CPU-å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ"></a>CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ</h2><h3 id="æ‰¾å‡ºå½“å‰ç³»ç»Ÿ-CPU-ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹"><a href="#æ‰¾å‡ºå½“å‰ç³»ç»Ÿ-CPU-ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹" class="headerlink" title="æ‰¾å‡ºå½“å‰ç³»ç»Ÿ CPU ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹"></a>æ‰¾å‡ºå½“å‰ç³»ç»Ÿ CPU ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹</h3><p>å½“ä½ å‘ç°æœåŠ¡å™¨ååº”æ…¢æˆ–è€…è´Ÿè½½é«˜æ—¶ï¼Œç¬¬ä¸€æ­¥å¾€å¾€æ˜¯æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨å¤§é‡ CPU èµ„æºã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-rnk</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯¥å‘½ä»¤ä¼šåˆ—å‡º CPU ä½¿ç”¨é‡æœ€é«˜çš„å‰ 20 ä¸ªè¿›ç¨‹ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®šä½é—®é¢˜è¿›ç¨‹ã€‚</p><h3 id="æ‰¾å‡ºå½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹"><a href="#æ‰¾å‡ºå½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹" class="headerlink" title="æ‰¾å‡ºå½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹"></a>æ‰¾å‡ºå½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡è¾ƒé«˜çš„è¿›ç¨‹</h3><p>ç±»ä¼¼äº CPU ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥çœ‹å†…å­˜ä½¿ç”¨æœ€é«˜çš„è¿›ç¨‹ä¹ŸåŒæ ·é‡è¦ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-rnk</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ¡å‘½ä»¤èƒ½å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°å†…å­˜â€œå¤§æˆ·â€ã€‚</p><h2 id="æ–‡ä»¶æŸ¥æ‰¾å’Œæ‰“åŒ…"><a href="#æ–‡ä»¶æŸ¥æ‰¾å’Œæ‰“åŒ…" class="headerlink" title="æ–‡ä»¶æŸ¥æ‰¾å’Œæ‰“åŒ…"></a>æ–‡ä»¶æŸ¥æ‰¾å’Œæ‰“åŒ…</h2><h3 id="æ‰¾å‡ºå½“å‰æœºå™¨ä¸Šæ‰€æœ‰ä»¥-conf-ç»“å°¾çš„æ–‡ä»¶ï¼Œå¹¶å‹ç¼©æ‰“åŒ…"><a href="#æ‰¾å‡ºå½“å‰æœºå™¨ä¸Šæ‰€æœ‰ä»¥-conf-ç»“å°¾çš„æ–‡ä»¶ï¼Œå¹¶å‹ç¼©æ‰“åŒ…" class="headerlink" title="æ‰¾å‡ºå½“å‰æœºå™¨ä¸Šæ‰€æœ‰ä»¥ .conf ç»“å°¾çš„æ–‡ä»¶ï¼Œå¹¶å‹ç¼©æ‰“åŒ…"></a>æ‰¾å‡ºå½“å‰æœºå™¨ä¸Šæ‰€æœ‰ä»¥ .conf ç»“å°¾çš„æ–‡ä»¶ï¼Œå¹¶å‹ç¼©æ‰“åŒ…</h3><p>å¯¹é…ç½®æ–‡ä»¶çš„ç®¡ç†æ˜¯æœåŠ¡å™¨ç»´æŠ¤å·¥ä½œä¸­çš„ä¸€ä¸ªé‡è¦æ–¹é¢ã€‚ä»¥ä¸‹å‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°æ‰€æœ‰çš„ <code>.conf</code> é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ‰“åŒ…å¤‡ä»½ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-name</span> *.conf <span class="token parameter variable">-type</span> f <span class="token parameter variable">-print</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">tar</span> cjf test.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>find / -name *.conf -type f</code> åœ¨æ•´ä¸ªæ ¹ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰ä»¥ <code>.conf</code> ç»“å°¾çš„æ–‡ä»¶ã€‚</li><li><code>xargs tar cjf test.tar.gz</code> å°†æ‰¾åˆ°çš„æ–‡ä»¶æ‰“åŒ…å¹¶å‹ç¼©ä¸º <code>test.tar.gz</code>ã€‚</li></ul><p>ä»¥ä¸Šå‘½ä»¤ï¼Œæ— è®ºå¯¹åˆå­¦è€…è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…ï¼Œéƒ½æ˜¯æå…¶æœ‰ç”¨çš„æ—¥å¸¸å·¥å…·ã€‚ç†è§£å¹¶ç†Ÿç»ƒè¿ç”¨å®ƒä»¬ï¼Œå°†æœ‰åŠ©äºä½ é«˜æ•ˆåœ°è§£å†³æœåŠ¡å™¨è¿ç»´ä¸­çš„å„ç§é—®é¢˜ã€‚</p><p>å¸Œæœ›æœ¬æ–‡çš„å†…å®¹èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ï¼Œè®©ä½ åœ¨ Linux ç³»ç»Ÿçš„ä½¿ç”¨è¿‡ç¨‹ä¸­å¦‚é±¼å¾—æ°´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼</title>
      <link href="posts/e0806fd7.html"/>
      <url>posts/e0806fd7.html</url>
      
        <content type="html"><![CDATA[<ol><li>åˆ›å»ºå‹æ¨¡å¼<br>å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€ç®€å•å·¥å‚æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼</li><li>ç»“æ„å‹æ¨¡å¼<br>é€‚é…å™¨æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€äº«å…ƒæ¨¡å¼</li><li>è¡Œä¸ºå‹æ¨¡å¼<br>è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€æ³¨å†Œæ¨¡å¼</li></ol><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ<br>å•ä¾‹æ¨¡å¼é€šä¿—å®šä¹‰ï¼Œä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚è€Œä¸”æ˜¯å†…éƒ¨è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿå…¨å±€åœ°æä¾›è¿™ä¸ªå®ä¾‹ã€‚å®ƒä¸ä¼šåˆ›å»ºå®ä¾‹å‰¯æœ¬ï¼Œè€Œæ˜¯è¿”å›å•ä¾‹ç±»å†…éƒ¨å­˜å‚¨çš„å®ä¾‹ä¸€ä¸ªå¼•ç”¨ã€‚</li></ul><blockquote><p>ä¸Šé¢çš„ä»£ç ç”¨é™æ€å˜é‡ å®ç°äº†å•ä¾‹æ¨¡å¼å’Œåˆ›å»ºå•ä¾‹çš„é™æ€æ–¹æ³• getInstance(). è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ„é€ å‡½æ•° __construct() è¢«å£°æ˜ä¸º protected æ˜¯ä¸ºäº†é˜²æ­¢ç”¨ new æ“ä½œç¬¦åœ¨è¿™ä¸ªç±»ä¹‹å¤–åˆ›å»ºæ–°çš„å®ä¾‹ã€‚</li><li>é­”æœ¯æ–¹æ³• __clone() è¢«å£°æ˜ä¸º private æ˜¯ä¸ºäº†é˜²æ­¢ç”¨ clone æ“ä½œç¬¦å…‹éš†å‡ºæ–°çš„å®ä¾‹.</li><li>é­”æœ¯æ–¹æ³• __wakeup() è¢«å£°æ˜ä¸º private æ˜¯ä¸ºäº†é˜²æ­¢é€šè¿‡å…¨å±€å‡½æ•° unserialize() ååºåˆ—åŒ–è¿™ä¸ªç±»çš„å®ä¾‹ã€‚</li><li>æ–°çš„å®ä¾‹æ˜¯ç”¨è¿‡é™æ€æ–¹æ³• getInstance() ä½¿ç”¨åæœŸé™æ€ç»‘å®šç”Ÿæˆçš„ã€‚è¿™å…è®¸æˆ‘ä»¬å¯¹ Singleton ç±»è¿›è¡Œç»§æ‰¿ï¼Œå¹¶ä¸”åœ¨å–å¾— SingletonChild çš„å•ä¾‹æ—¶ä¸ä¼šå‡ºç°é—®é¢˜ã€‚<br>  å•ä¾‹æ¨¡å¼æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨æ•´ä¸ªè¯·æ±‚çš„å£°æ˜å‘¨æœŸå†…åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡ï¼ˆæ¯”å¦‚é…ç½®ç±»ï¼‰æˆ–ä¸€ä¸ªå…±äº«çš„èµ„æºï¼ˆæ¯”å¦‚äº‹ä»¶é˜Ÿåˆ—ï¼‰æ—¶ã€‚</li></ul><p>ä½ åº”è¯¥éå¸¸å°å¿ƒåœ°ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºå®ƒéå¸¸è‡ªç„¶åœ°å¼•å…¥äº†å…¨å±€çŠ¶æ€åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œé™ä½äº†å¯æµ‹è¯•æ€§ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¾èµ–æ³¨å…¥å¯ä»¥ï¼ˆå¹¶ä¸”åº”è¯¥ï¼‰ä»£æ›¿å•ä¾‹ç±»ã€‚ ä½¿ç”¨ä¾èµ–æ³¨å…¥æ„å‘³ç€æˆ‘ä»¬ä¸ä¼šåœ¨è®¾è®¡åº”ç”¨æ—¶å¼•å…¥ä¸å¿…è¦çš„è€¦åˆï¼Œå› ä¸ºå¯¹è±¡ä½¿ç”¨å…±äº«çš„æˆ–å…¨å±€çš„èµ„æºï¼Œä¸å†éœ€è¦è€¦åˆå…·ä½“çš„ç±»ã€‚</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** *  æˆ‘ä»¬å¦‚ä½•æ¥å†™ä¸€ä¸ªå±äºè‡ªå·±çš„å•ä¾‹ç±»å‘¢ï¼Ÿ *  å†™ä¸€ä¸ªå•ä¾‹ç±»æ˜¯å¦æœ‰ä»€ä¹ˆè§„åˆ™å¯å¯»ï¼Ÿ *  1.æœ‰ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡æ¥ä¿å­˜ç±»çš„å”¯ä¸€å®ä¾‹ *  2.æ„é€ å‡½æ•°å’Œå…‹éš†å‡½æ•°å¿…é¡»ç”³æ˜ä¸ºç§æœ‰çš„ï¼ˆé˜²æ­¢å¤–éƒ¨ç¨‹åºèƒ½é€šè¿‡ new å…³é”®å­—è¿›è¡Œåˆ›å»ºå¯¹è±¡ï¼‰ *  3.å…¬å…±çš„é™æ€æ–¹æ³•å¯ä»¥è®¿é—®ç±»çš„å®ä¾‹ä½œä¸ºä¸€ä¸ªå¼•ç”¨è¿”å› *  4.åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡ */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Obj</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token variable">$_Ins</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">str</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$_Ins</span> <span class="token keyword">instanceof</span> <span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$_Ins</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$_Ins</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token class-name static-context">Obj</span><span class="token operator">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token class-name static-context">Obj</span><span class="token operator">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/&gt;&lt;hr/&gt;'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/&gt;&lt;hr/&gt;'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">===</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>æˆ–è€…é‡‡ç”¨ ci æ¡†æ¶æ¯”è¾ƒå¤è€çš„å•ä¾‹æ–¹æ³•<span class="token operator">&lt;</span><span class="token operator">?</span>php<span class="token keyword">class</span> <span class="token class-name-definition class-name">ClassName</span><span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$instance</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// è¿ç”¨äº† $this å› æ­¤ä¸‹é¢è°ƒç”¨çš„æ—¶å€™å¿…é¡»å…ˆå®ä¾‹åŒ–</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$this</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token operator">&amp;</span><span class="token function">get_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$aa</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassName</span><span class="token punctuation">;</span><span class="token variable">$bb</span> <span class="token operator">=</span> <span class="token class-name static-context">ClassName</span><span class="token operator">::</span><span class="token function">get_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cc</span> <span class="token operator">=</span> <span class="token class-name static-context">ClassName</span><span class="token operator">::</span><span class="token function">get_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;pre&gt;'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;pre&gt;'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$bb</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;pre&gt;'</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$cc</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ<br>å®šä¹‰äº†ç®—æ³•å®¶æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ã€‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥å®ç° Iocã€ä¾èµ–å€’ç½®ã€æ§åˆ¶åè½¬<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * ç­–ç•¥æ¨¡å¼ * éœ€æ±‚ï¼šåŒæ ·ä¸€ä»½æ•°æ®éœ€è¦å¯¼å‡ºä¸åŒçš„æ ¼å¼ */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DataModel</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$writer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">writer</span> <span class="token operator">=</span> <span class="token variable">$writer</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'This is first'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'This is second'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'This is third'</span><span class="token punctuation">]</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">writer</span><span class="token operator">-&gt;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Writer</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$_file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å¼ºåˆ¶è¦æ±‚å­ç±»å®šä¹‰ write æ–¹æ³•</span>    <span class="token keyword">abstract</span> <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * ä»¥ CSV æ ¼å¼å†™å…¥æ•°æ® */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CsvWriter</span> <span class="token keyword">extends</span> <span class="token class-name">Writer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">fputcsv</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/** * ä»¥ Html æ ¼å¼å†™å…¥æ•°æ® */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HtmlWriter</span> <span class="token keyword">extends</span> <span class="token class-name">Writer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">_file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;table&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;tr&gt;&lt;td&gt;'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;/td&gt;&lt;td&gt;'</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/td&gt;&lt;/tr&gt;\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;/table&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$model</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataModel</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CsvWriter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'D:\test.csv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php">/** * * éœ€æ±‚ï¼šå‡å¦‚ä¸€ä¸ªç”µå•†ç½‘ç«™ç³»ç»Ÿï¼Œé’ˆå¯¹ç”·æ€§å¥³æ€§ç”¨æˆ·è¦å„è‡ªè·³è½¬åˆ°ä¸åŒçš„å•†å“ç±»ç›®ï¼Œå¹¶ä¸”æ‰€æœ‰å¹¿å‘Šä½å±•ç¤ºä¸åŒçš„å¹¿å‘Š */  // UserStrategy.php  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name-definition class-name">UserStrategy</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">showAd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">showCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// FemaleUserStrategy.php</span><span class="token operator">&lt;</span><span class="token operator">?</span>php<span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FemaleUserStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">UserStrategy</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">showAd</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'2014æ–°æ¬¾å¥³è£…'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">showCategory</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'å¥³è£…'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// MaleUserStrategy.php</span><span class="token operator">&lt;</span><span class="token operator">?</span>php<span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">MaleUserStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">UserStrategy</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">showAd</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'2014ç”·è£…ç§€'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">showCategory</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'ç”·è£…'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// è°ƒç”¨</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Page</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$strategy</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">index</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'AD:'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">strategy</span><span class="token operator">-&gt;</span><span class="token function">showAd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/&gt;'</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Category:'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">strategy</span><span class="token operator">-&gt;</span><span class="token function">showCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">setStrategy</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified type-declaration"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>UserStrategy</span> <span class="token variable">$strategy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">strategy</span> <span class="token operator">=</span> <span class="token variable">$strategy</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$page</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'female'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$strategy</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>FemaleUserStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$strategy</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>MaleUserStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$page</span><span class="token operator">-&gt;</span><span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token variable">$strategy</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$page</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ<br>å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚</li></ul><p>åº”ç”¨åœºæ™¯ï¼šä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåï¼Œè¦æ‰§è¡Œä¸€è¿ä¸²æ›´æ–°æ“ä½œã€‚ä¼ ç»Ÿçš„ç¼–ç¨‹æ–¹å¼ï¼Œå°±æ˜¯åœ¨äº‹ä»¶çš„ä»£ç ä¹‹åç›´æ¥åŠ å…¥å¤„ç†é€»è¾‘ã€‚å½“æ›´æ–°çš„é€»è¾‘å¢å¤šä¹‹åï¼Œä»£ç ä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚è¿™ç§æ–¹å¼æ˜¯è€¦åˆçš„ï¼Œä¾µå…¥å¼çš„ï¼Œå¢åŠ æ–°çš„é€»è¾‘éœ€è¦ä¿®æ”¹äº‹ä»¶ä¸»ä½“çš„ä»£ç ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">// EventGenerator.php ä¸­<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">EventGenerator</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$observers</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ·»åŠ è§‚å¯Ÿè€…</span>    <span class="token keyword">function</span> <span class="token function-definition function">addObserver</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Observer</span> <span class="token variable">$observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">observers</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$observer</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è°ƒç”¨æ¯ä¸€ä¸ªè§‚å¯Ÿè€…çš„ update æ–¹æ³•</span>    <span class="token keyword">function</span> <span class="token function-definition function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">observers</span> <span class="token keyword">as</span> <span class="token variable">$observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$observer</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Observer.php ä¸­</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name-definition class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">update</span> <span class="token punctuation">(</span><span class="token variable">$envent_info</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨è§‚å¯Ÿè€…</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Event</span> <span class="token keyword">extends</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>EventGenerator</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">trigger</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// è§‚å¯Ÿè€…1</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Observer1</span> <span class="token keyword">implements</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">update</span> <span class="token punctuation">(</span><span class="token variable">$event_info</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"é€»è¾‘1&lt;br /&gt; \n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// è§‚å¯Ÿè€…2</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Observer2</span> <span class="token keyword">implements</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">update</span> <span class="token punctuation">(</span><span class="token variable">$event_info</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"é€»è¾‘2&lt;br /&gt; \n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$event</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Observer1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Observer2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼ï¼Ÿ<br>å·¥å‚æ–¹æ³•æˆ–è€…ç±»ç”Ÿæˆå¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä¸­ç›´æ¥ newï¼Œå¥½å¤„åœ¨äºæ”¹åŠ¨ä¸€ä¸ªç±»çš„åç§°æˆ–è€…å‚æ•°æ—¶ï¼Œåªéœ€è¦æ”¹åŠ¨ä¸€ä¸ªåœ°æ–¹<pre class="line-numbers language-php" data-language="php"><code class="language-php">// Factory.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Factory</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">createDatabase</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// åœ¨è¿™é‡Œ å®ä¾‹åŒ–éœ€è¦ç”¨åˆ°çš„å¯¹è±¡</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>å¤–éƒ¨è°ƒç”¨æ—¶</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">IMooc<span class="token punctuation">\</span>Factory</span><span class="token operator">::</span><span class="token function">createDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æ³¨å†Œæ ‘æ¨¡å¼"><a href="#æ³¨å†Œæ ‘æ¨¡å¼" class="headerlink" title="æ³¨å†Œæ ‘æ¨¡å¼"></a>æ³¨å†Œæ ‘æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯æ³¨å†Œæ ‘æ¨¡å¼ï¼Ÿ<br>è§£å†³å…¨å±€å…±äº«å’Œäº¤æ¢å¯¹è±¡</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php">// Register.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Register</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token variable">$objects</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ³¨å†Œå®ä¾‹     * @param [type] $alias  å®ä¾‹åˆ«å     * @param [type] $object å®ä¾‹å¯¹è±¡     */</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">set</span> <span class="token punctuation">(</span><span class="token variable">$alias</span><span class="token punctuation">,</span> <span class="token variable">$object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$objects</span><span class="token punctuation">[</span><span class="token variable">$alias</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$object</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è·å–å¯¹è±¡å®ä¾‹</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">get</span> <span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$objects</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// åˆ é™¤å¯¹è±¡å®ä¾‹</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">_unset</span> <span class="token punctuation">(</span><span class="token variable">$alias</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$objects</span><span class="token punctuation">[</span><span class="token variable">$alias</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥æ”¾åœ¨å·¥å‚æ–‡ä»¶ä¸­ä¹‹åå†åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// Factory.php ä¸­è®¾ç½®</span><span class="token class-name static-context">Register</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'db'</span><span class="token punctuation">,</span> <span class="token class-name static-context">Database</span><span class="token operator">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å…¶å®ƒæ–‡ä»¶ä¸­è°ƒç”¨</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>Register</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼ï¼Ÿ</li></ul><ol><li>é€‚é…å™¨æ¨¡å¼ï¼Œå¯ä»¥å°†æˆªç„¶ä¸åŒçš„å‡½æ•°æ¥å£å°è£…æˆç»Ÿä¸€çš„APIï¼›</li><li>å®é™…åº”ç”¨ä¸¾ä¾‹ï¼ŒPHPçš„æ•°æ®åº“æ“ä½œæœ‰mysqlï¼Œmysqliï¼Œpdo 3ç§ï¼Œå¯ä»¥ç”¨é€‚é…å™¨æ¨¡å¼ç»Ÿä¸€æˆä¸€è‡´ã€‚ç±»ä¼¼çš„åœºæ™¯è¿˜æœ‰ cache é€‚é…å™¨ï¼Œå°† memcacheï¼Œredisï¼Œfileï¼Œapcç­‰ä¸åŒçš„ç¼“å­˜å‡½æ•°ï¼Œç»Ÿä¸€æˆä¸€è‡´ã€‚<pre class="line-numbers language-php" data-language="php"><code class="language-php">// Database.php æ–‡ä»¶ä¸­<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name-definition class-name">IDatabase</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">connect</span> <span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$passwd</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Database</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–å¯¹è±¡å®ä¾‹</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$db</span> <span class="token keyword">instanceof</span> <span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">__clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">order</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">limit</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>IMooc\Database\PDO.php æ–‡ä»¶ä¸­<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc<span class="token punctuation">\</span>Database</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">IMooc<span class="token punctuation">\</span>IDatabase</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">PDO</span> <span class="token keyword">implements</span> <span class="token class-name">IDatabase</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$conn</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">connect</span> <span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$passwd</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>PDO</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"mysql:host=<span class="token interpolation"><span class="token variable">$host</span></span>;dbname=<span class="token interpolation"><span class="token variable">$dbname</span></span>"</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$passwd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">query</span> <span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">close</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>è°ƒç”¨<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">IMooc<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>PDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'123456'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'show databases'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="æ•°æ®å¯¹è±¡æ˜ å°„æ¨¡å¼"><a href="#æ•°æ®å¯¹è±¡æ˜ å°„æ¨¡å¼" class="headerlink" title="æ•°æ®å¯¹è±¡æ˜ å°„æ¨¡å¼"></a>æ•°æ®å¯¹è±¡æ˜ å°„æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯æ•°æ®å¯¹è±¡æ˜ å°„æ¨¡å¼ï¼Ÿ</li></ul><ol><li>æ•°æ®å¯¹è±¡æ˜ å°„æ¨¡å¼ï¼Œæ˜¯å°†å¯¹è±¡å’Œæ•°æ®å­˜å‚¨æ˜ å°„èµ·æ¥ï¼Œå¯¹ä¸€ä¸ªå¯¹è±¡çš„æ“ä½œä¼šæ˜ å°„ä¸ºå¯¹æ•°æ®å­˜å‚¨çš„æ“ä½œã€‚</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$phone</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$regtime</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>MySQLi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'123456'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select * from user limit 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">id</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">phone</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">regtime</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'regtime'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è¿ç”¨ææ„å‡½æ•°çš„ç‰¹æ€§å®ç°æ›´æ–°æ“ä½œ</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"update user set name = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">}</span></span>',            phone = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">phone</span><span class="token punctuation">}</span></span>',regtime = '<span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">regtime</span></span>'              where id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">}</span></span>' limit 1 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">phone</span> <span class="token operator">=</span> <span class="token number">18502728040</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'å¼ ä¸‰'</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">regtime</span> <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h3><ul><li>ä»€ä¹ˆæ˜¯åŸå‹æ¨¡å¼ï¼Ÿ</li></ul><ol><li>ä¸å·¥å‚æ¨¡å¼ä½œç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡ã€‚</li><li>ä¸å·¥å‚æ¨¡å¼çš„å®ç°ä¸åŒï¼ŒåŸå‹æ¨¡å¼æ˜¯å…ˆåˆ›å»ºå¥½ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œç„¶åé€šè¿‡ clone åŸå‹å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚è¿™æ ·å°±å…å»äº†ç±»åˆ›å»ºæ—¶é‡å¤çš„åˆå§‹åŒ–æ“ä½œã€‚</li><li>åŸå‹æ¨¡å¼é€‚ç”¨äºå¤§å¯¹è±¡çš„åˆ›å»ºã€‚åˆ›å»ºä¸€ä¸ªå¤§å¯¹è±¡éœ€è¦å¾ˆå¤§çš„å¼€é”€ï¼Œå¦‚æœæ¯æ¬¡ new å°±ä¼šæ¶ˆè€—å¾ˆå¤§ï¼ŒåŸå‹æ¨¡å¼ä»…éœ€å†…å­˜æ‹·è´å³å¯ã€‚</li></ol><p>ä¼ ç»Ÿå†™æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// å®ä¾‹åŒ–ç”»å¸ƒå¯¹è±¡</span><span class="token variable">$canvas1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">IMooc<span class="token punctuation">\</span>Canvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹åŒ–ç”»å¸ƒæ“ä½œ</span><span class="token variable">$canvas1</span><span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯¹ç”»å¸ƒ1è¿›è¡Œç»˜åˆ¶</span><span class="token variable">$canvas1</span><span class="token operator">-&gt;</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas1</span><span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å®ä¾‹åŒ–ç”»å¸ƒå¯¹è±¡</span><span class="token variable">$canvas2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">IMooc<span class="token punctuation">\</span>Canvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹åŒ–ç”»å¸ƒæ“ä½œ</span><span class="token variable">$canvas2</span><span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯¹ç”»å¸ƒ2è¿›è¡Œç»˜åˆ¶</span><span class="token variable">$canvas1</span><span class="token operator">-&gt;</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas2</span><span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨åŸå‹æ¨¡å¼</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// å®ä¾‹åŒ–ç”»å¸ƒå¯¹è±¡</span><span class="token variable">$prototype</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">IMooc<span class="token punctuation">\</span>Canvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹åŒ–ç”»å¸ƒæ“ä½œ</span><span class="token variable">$prototype</span><span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas1</span> <span class="token operator">=</span> <span class="token keyword">clone</span> <span class="token variable">$prototype</span><span class="token punctuation">;</span><span class="token comment">// å¯¹ç”»å¸ƒ1è¿›è¡Œç»˜åˆ¶</span><span class="token variable">$canvas1</span><span class="token operator">-&gt;</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas1</span><span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas2</span> <span class="token operator">=</span> <span class="token keyword">clone</span> <span class="token variable">$prototype</span><span class="token punctuation">;</span><span class="token comment">// å¯¹ç”»å¸ƒ2è¿›è¡Œç»˜åˆ¶</span><span class="token variable">$canvas2</span><span class="token operator">-&gt;</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas2</span><span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è£…é¥°å™¨æ¨¡å¼"><a href="#è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼"></a>è£…é¥°å™¨æ¨¡å¼</h3><ol><li>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰ï¼Œå¯ä»¥åŠ¨æ€åœ°æ·»åŠ ä¿®æ”¹ç±»çš„åŠŸèƒ½ã€‚</li><li>ä¸€ä¸ªç±»æä¾›äº†ä¸€é¡¹åŠŸèƒ½ï¼Œå¦‚æœè¦åœ¨ä¿®æ”¹å¹¶æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä¼ ç»Ÿçš„ç¼–ç¨‹æ¨¡å¼ï¼Œéœ€è¦å†™ä¸€ä¸ªå­ç±»ç»§æ‰¿å®ƒï¼Œå¹¶é‡æ–°å®ç°ç±»çš„æ–¹æ³•ã€‚</li><li>ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œä»…éœ€è¦åœ¨è¿è¡Œæ—¶æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨å¯¹è±¡å³å¯å®ç°ï¼Œå¯ä»¥å®ç°æœ€å¤§çš„çµæ´»æ€§ã€‚</li></ol><p>IMooc\Canvas.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Canvas</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ä¿å­˜è£…é¥°å™¨     *     * @var array     */</span>    <span class="token keyword">protected</span> <span class="token variable">$decorators</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * åˆå§‹åŒ–ç”»å¸ƒ     *     * @param int $width     * @param int $height     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">init</span><span class="token punctuation">(</span><span class="token variable">$width</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token variable">$height</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$height</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token variable">$width</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'*'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">data</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ·»åŠ è£…é¥°å™¨     *     * @param DrawDecorator $decorator     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">addDecorator</span><span class="token punctuation">(</span><span class="token class-name type-declaration">DrawDecorator</span> <span class="token variable">$decorator</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">decorators</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$decorator</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç”»ç”»å‰çš„è°ƒç”¨æ–¹æ³•     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">beforeDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">decorators</span> <span class="token keyword">as</span> <span class="token variable">$decorator</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$decorator</span><span class="token operator">-&gt;</span><span class="token function">beforeDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç”»ç”»åçš„è°ƒç”¨æ–¹æ³•     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">afterDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// éœ€è¦è¿›è¡Œåè½¬ï¼ŒbeforeDraw æ–¹æ³•æ˜¯å…ˆè¿›ï¼ŒafterDraw æ–¹æ³•æ˜¯å…ˆå‡º  ï¼ˆå…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºï¼‰</span>        <span class="token variable">$decorators</span> <span class="token operator">=</span> <span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">decorators</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$decorators</span> <span class="token keyword">as</span> <span class="token variable">$decorator</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$decorator</span><span class="token operator">-&gt;</span><span class="token function">afterDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç”»ç”»     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">beforeDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">data</span> <span class="token keyword">as</span> <span class="token variable">$line</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$line</span> <span class="token keyword">as</span> <span class="token variable">$char</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token variable">$char</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br /&gt;\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">afterDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">rect</span><span class="token punctuation">(</span><span class="token variable">$a1</span><span class="token punctuation">,</span> <span class="token variable">$a2</span><span class="token punctuation">,</span> <span class="token variable">$b1</span><span class="token punctuation">,</span> <span class="token variable">$b2</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">data</span> <span class="token keyword">as</span> <span class="token variable">$k1</span> <span class="token operator">=&gt;</span> <span class="token variable">$line</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$k1</span> <span class="token operator">&lt;</span> <span class="token variable">$a1</span> <span class="token keyword">or</span> <span class="token variable">$k1</span> <span class="token operator">&gt;</span> <span class="token variable">$a2</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$line</span> <span class="token keyword">as</span> <span class="token variable">$k2</span> <span class="token operator">=&gt;</span> <span class="token variable">$char</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$k2</span> <span class="token operator">&lt;</span> <span class="token variable">$b1</span> <span class="token keyword">or</span> <span class="token variable">$k2</span> <span class="token operator">&gt;</span> <span class="token variable">$b2</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">data</span><span class="token punctuation">[</span><span class="token variable">$k1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&amp;nbsp;'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>IMooc\DrawDecorator.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name-definition class-name">DrawDecorator</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">beforeDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">afterDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>IMooc\ColorDrawDecorator.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ColorDrawDecorator</span> <span class="token keyword">implements</span> <span class="token class-name">DrawDecorator</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$color</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$color</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'red'</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">color</span> <span class="token operator">=</span> <span class="token variable">$color</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">beforeDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;div style='color: <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">color</span><span class="token punctuation">}</span></span>;'&gt;"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">afterDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/div&gt;"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>IMooc\SizeDrawDecorator.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">SizeDrawDecorator</span> <span class="token keyword">implements</span> <span class="token class-name">DrawDecorator</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$size</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'14px'</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">size</span> <span class="token operator">=</span> <span class="token variable">$size</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">beforeDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;div style='font-size: <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">size</span><span class="token punctuation">}</span></span>;'&gt;"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">afterDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/div&gt;"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$canvas</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>Canvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas</span><span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas</span><span class="token operator">-&gt;</span><span class="token function">addDecorator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>ColorDrawDecorator</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// $canvas-&gt;addDecorator(new \IMooc\SizeDrawDecorator('10px'));</span><span class="token variable">$canvas</span><span class="token operator">-&gt;</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$canvas</span><span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h3><ol><li>è¿­ä»£å™¨æ¨¡å¼ï¼Œåœ¨ä¸éœ€è¦äº†è§£å†…éƒ¨å®ç°çš„å‰æä¸‹ï¼Œéå†ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…éƒ¨å…ƒç´ ã€‚</li><li>ç›¸æ¯”äºä¼ ç»Ÿçš„ç¼–ç¨‹æ¨¡å¼ï¼Œè¿­ä»£å™¨æ¨¡å¼å¯ä»¥éšè—éå†å…ƒç´ çš„æ‰€éœ€çš„æ“ä½œã€‚</li></ol><p>IMooc\AllUser.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">AllUser</span> <span class="token keyword">implements</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Iterator</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$ids</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$index</span><span class="token punctuation">;</span>  <span class="token comment">// è¿­ä»£å™¨çš„å½“å‰ä½ç½®</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select id from user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">ids</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">fetch_all</span><span class="token punctuation">(</span><span class="token constant">MYSQLI_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å½“å‰å…ƒç´ </span>    <span class="token keyword">function</span> <span class="token function-definition function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">ids</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–æŒ‡å®š id çš„ç”¨æˆ·ä¿¡æ¯</span>        <span class="token keyword">return</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// ä¸‹ä¸€ä¸ªå…ƒç´ </span>    <span class="token keyword">function</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">index</span> <span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span>    <span class="token keyword">function</span> <span class="token function-definition function">valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">index</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">ids</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// é‡ç½®è¿­ä»£å™¨</span>    <span class="token keyword">function</span> <span class="token function-definition function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">index</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è·å–å½“å‰çš„ä½ç½®</span>    <span class="token keyword">function</span> <span class="token function-definition function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">index</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯</span><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>AllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$users</span> <span class="token keyword">as</span> <span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><ol><li>åœ¨å®¢æˆ·ç«¯ä¸å®ä½“ä¹‹é—´å»ºç«‹ä¸€ä¸ªä»£ç†å¯¹è±¡ ï¼ˆproxyï¼‰ï¼Œå®¢æˆ·ç«¯å¯¹å®ä½“è¿›è¡Œæ“ä½œå…¨éƒ¨å§”æ´¾ç»™ä»£ç†å¯¹è±¡ï¼Œéšè—å®ä½“çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</li><li>proxy è¿˜å¯ä»¥ä¸ä¸šåŠ¡ä»£ç åˆ†ç¦»ï¼Œéƒ¨ç½²åˆ°å¦å¤–çš„æœåŠ¡å™¨ã€‚ä¸šåŠ¡ä»£ç ä¸­é€šè¿‡ RPC æ¥å§”æ´¾ä»»åŠ¡ã€‚</li></ol><p>IMooc\Proxy.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">IUserProxy</span><span class="token punctuation">{</span>    <span class="token comment">// ä»æ•°æ®åº“ç”¨äº è¯»å– æ“ä½œ</span>    <span class="token keyword">function</span> <span class="token function-definition function">getUserName</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'slave'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select name from user where id =<span class="token interpolation"><span class="token variable">$id</span></span> limit 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// ä¸»æ•°æ®åº“ç”¨äº æ›´æ–° æ“ä½œ</span>    <span class="token keyword">function</span> <span class="token function-definition function">setUserName</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'master'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"update user set name = <span class="token interpolation"><span class="token variable">$name</span></span> where id =<span class="token interpolation"><span class="token variable">$id</span></span> limit 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>IMooc\IUserProxy.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">IMooc</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name-definition class-name">IUserProxy</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function-definition function">getUserName</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">setUserName</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$proxy</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>IMooc<span class="token punctuation">\</span>Proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$proxy</span><span class="token operator">-&gt;</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$proxy</span><span class="token operator">-&gt;</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP ä¹‹é“ç¬”è®°æ•´ç†ï¼šæœ€ä½³å®è·µä¸å®‰å…¨æŒ‡å—</title>
      <link href="posts/33277937.html"/>
      <url>posts/33277937.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥ç®€æ˜æ˜“æ‡‚çš„è¯­è¨€æ¢è®¨ PHP æœ€ä½³å®è·µä¸­çš„ä¸€äº›å…³é”®ä¸»é¢˜ï¼ŒåŒ…æ‹¬ä½¿ç”¨å½“å‰ç¨³å®šç‰ˆæœ¬ã€æ—¥æœŸå’Œæ—¶é—´å¤„ç†ã€UTF-8 ç¼–ç ä»¥åŠç¡®ä¿ Web åº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚</p><p>è¿™ç¯‡æ–‡ç« æ—¨åœ¨ä¸ºåˆšå…¥é—¨çš„å¼€å‘è€…æä¾›æŒ‡å—ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿå¸®åŠ©æœ‰ä¸€å®šç¼–ç¨‹ç»éªŒçš„å¼€å‘è€…å›é¡¾å’Œå·©å›ºçŸ¥è¯†ã€‚</p><h2 id="ä½¿ç”¨-PHP-å½“å‰ç¨³å®šç‰ˆæœ¬ï¼ˆ8-3ï¼‰"><a href="#ä½¿ç”¨-PHP-å½“å‰ç¨³å®šç‰ˆæœ¬ï¼ˆ8-3ï¼‰" class="headerlink" title="ä½¿ç”¨ PHP å½“å‰ç¨³å®šç‰ˆæœ¬ï¼ˆ8.3ï¼‰"></a>ä½¿ç”¨ PHP å½“å‰ç¨³å®šç‰ˆæœ¬ï¼ˆ8.3ï¼‰</h2><p>é¦–å…ˆï¼Œä¸ä»»ä½•æŠ€æœ¯æ ˆä¸€æ ·ï¼Œä½¿ç”¨å½“å‰çš„ç¨³å®šç‰ˆæœ¬æ˜¯éå¸¸é‡è¦çš„ã€‚æˆªè‡³æœ¬æ–‡å†™ä½œæ—¶ï¼ŒPHP çš„å½“å‰ç¨³å®šç‰ˆæœ¬æ˜¯ 8.3ã€‚PHP 8.3 ç›¸è¾ƒäºè€æ—§ç‰ˆæœ¬ï¼ˆæ¯”å¦‚ï¼ŒPHP 5.6ï¼‰åœ¨æ€§èƒ½ä¸Šæœ‰äº†æ˜¾è‘—çš„æå‡ï¼Œå¹¶ä¸”åŠ å…¥äº†å¾ˆå¤šæ–°çš„ç‰¹æ€§å’Œè¯­æ³•ç³–ï¼ŒåŒæ—¶åšäº†å‘ä¸‹å…¼å®¹å¤„ç†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒPHP 5.6 å°†åœ¨ 2018 å¹´åœæ­¢æ¥æ”¶å®‰å…¨æ›´æ–°ã€‚å¼ºçƒˆå»ºè®®å°½å¿«å‡çº§åˆ° PHP 8.3ï¼Œä»¥äº«å—æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥æ¢è®¨æ›´å¤šå…³é”®ä¸»é¢˜ã€‚</p><h2 id="æ—¥æœŸå’Œæ—¶é—´"><a href="#æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="æ—¥æœŸå’Œæ—¶é—´"></a>æ—¥æœŸå’Œæ—¶é—´</h2><p>åœ¨ PHP å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦å¤„ç†æ—¥æœŸå’Œæ—¶é—´ã€‚PHP çš„ <code>DateTime</code> ç±»æä¾›äº†ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ¥å£ï¼Œè®©æ—¥æœŸå’Œæ—¶é—´çš„è¯»å–ã€å†™å…¥ã€æ¯”è¾ƒå’Œè®¡ç®—å˜å¾—æ›´åŠ ç®€å•ã€‚æ­¤å¤–ï¼ŒCarbon æ˜¯ä¸€ä¸ªè‘—åçš„æ—¥æœŸæ—¶é—´ API æ‰©å±•ï¼Œå®ƒåŸºäº PHP çš„ <code>DateTime</code> ç±»å¹¶æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªç„¶è¯­è¨€æ—¶é—´å¤„ç†ã€å›½é™…åŒ–æ”¯æŒç­‰ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// ä½¿ç”¨ DateTime åˆ›å»ºä¸€ä¸ªæ—¥æœŸ</span><span class="token variable">$date</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'now'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$date</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨ Carbon å¤„ç†æ›´å¤æ‚çš„æ—¥æœŸæ—¶é—´æ“ä½œ</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'vendor/autoload.php'</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Right now is %s"</span><span class="token punctuation">,</span> <span class="token class-name static-context">Carbon</span><span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">toDateTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Right now in Vancouver is %s"</span><span class="token punctuation">,</span> <span class="token class-name static-context">Carbon</span><span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'America/Vancouver'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åˆ©ç”¨ Carbon è®¾å®šæ—¶åŒº</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨-UTF-8-ç¼–ç "><a href="#ä½¿ç”¨-UTF-8-ç¼–ç " class="headerlink" title="ä½¿ç”¨ UTF-8 ç¼–ç "></a>ä½¿ç”¨ UTF-8 ç¼–ç </h2><p>åœ¨å¤„ç†å¤šè¯­è¨€åº”ç”¨æ—¶ï¼Œä½¿ç”¨åˆé€‚çš„å­—ç¬¦ç¼–ç æ˜¯éå¸¸å…³é”®çš„ã€‚å°½ç®¡ PHP åº•å±‚è¿˜æœªå®Œå…¨æ”¯æŒ Unicodeï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ UTF-8 ç¼–ç æ¥å¤„ç†å¤§å¤šæ•°çš„å­—ç¬¦ç¼–ç éœ€æ±‚ã€‚</p><h3 id="1-PHP-å±‚é¢çš„-UTF-8"><a href="#1-PHP-å±‚é¢çš„-UTF-8" class="headerlink" title="1. PHP å±‚é¢çš„ UTF-8"></a>1. PHP å±‚é¢çš„ UTF-8</h3><p>ä¸ºäº†æ­£ç¡®å¤„ç† UTF-8 å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>mb_*</code> å‡½æ•°æ›¿ä»£ä¼ ç»Ÿçš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>mb_substr()</code> æ›¿ä»£ <code>substr()</code> æ¥é¿å…æ½œåœ¨çš„ä¹±ç é—®é¢˜ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å­—ç¬¦ä¸²'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯èƒ½ä¼šä¹±ç </span><span class="token keyword">echo</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­£ç¡®çš„åšæ³•</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è®°ä½ï¼Œåœ¨å¤„ç† UTF-8 å­—ç¬¦ä¸²æ—¶ä½¿ç”¨ <code>mb_*</code> å‡½æ•°ï¼Œæ˜¯ä¿éšœæ•°æ®å®Œæ•´æ€§å’Œé¿å…ä¹±ç çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p><h3 id="2-æ•°æ®åº“å±‚é¢çš„-UTF-8"><a href="#2-æ•°æ®åº“å±‚é¢çš„-UTF-8" class="headerlink" title="2. æ•°æ®åº“å±‚é¢çš„ UTF-8"></a>2. æ•°æ®åº“å±‚é¢çš„ UTF-8</h3><p>ä¸ºäº†åœ¨æ•°æ®åº“å±‚é¢å®Œæ•´æ”¯æŒ UTF-8ï¼Œåº”ä½¿ç”¨ <code>utf8mb4</code> å­—ç¬¦é›†è€Œä¸æ˜¯ç®€å•çš„ <code>utf8</code>ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_table <span class="token punctuation">(</span>    my_column <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Web-åº”ç”¨ç¨‹åºå®‰å…¨"><a href="#Web-åº”ç”¨ç¨‹åºå®‰å…¨" class="headerlink" title="Web åº”ç”¨ç¨‹åºå®‰å…¨"></a>Web åº”ç”¨ç¨‹åºå®‰å…¨</h2><p>åœ¨ Web å¼€å‘ä¸­ï¼Œå®‰å…¨å§‹ç»ˆæ˜¯æœ€é‡è¦çš„è®®é¢˜ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¿éšœ Web åº”ç”¨ç¨‹åºå®‰å…¨çš„å®è·µã€‚</p><h3 id="å¯†ç å“ˆå¸Œ"><a href="#å¯†ç å“ˆå¸Œ" class="headerlink" title="å¯†ç å“ˆå¸Œ"></a>å¯†ç å“ˆå¸Œ</h3><p>ä½¿ç”¨ <code>password_hash</code> å‡½æ•°å¯¹ç”¨æˆ·å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†æ˜¯ä¸€ç§æ¨èçš„åšæ³•ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'mypassword'</span><span class="token punctuation">;</span><span class="token variable">$hash</span> <span class="token operator">=</span> <span class="token function">password_hash</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token constant">PASSWORD_DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$hash</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°æ®è¿‡æ»¤"><a href="#æ•°æ®è¿‡æ»¤" class="headerlink" title="æ•°æ®è¿‡æ»¤"></a>æ•°æ®è¿‡æ»¤</h3><ol><li><p><strong>å¤–éƒ¨è¾“å…¥è¿‡æ»¤</strong>ï¼šæ°¸è¿œä¸è¦ä¿¡ä»»å¤–éƒ¨è¾“å…¥ã€‚åœ¨ä½¿ç”¨ä¹‹å‰åº”å¯¹å…¶è¿›è¡Œè¿‡æ»¤å’ŒéªŒè¯ã€‚<code>filter_var()</code> å’Œ <code>filter_input()</code> å‡½æ•°å¯ç”¨äºè¿‡æ»¤æ–‡æœ¬å¹¶è¿›è¡Œæ ¼å¼æ ¡éªŒã€‚</p></li><li><p><strong>é˜²æ­¢ XSS æ”»å‡»</strong>ï¼šé€šè¿‡å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæˆçš„æ•°æ®è¿›è¡Œæ¸…ç†ï¼Œä½¿ç”¨ <code>strip_tags()</code> å‡½æ•°å»é™¤ HTML æ ‡ç­¾æˆ–ä½¿ç”¨ <code>htmlentities()</code> æˆ– <code>htmlspecialchars()</code> å‡½æ•°å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œä»¥é¿å…è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€‚</p></li><li><p><strong>å‘½ä»¤è¡Œæ³¨å…¥é˜²å¾¡</strong>ï¼šä½¿ç”¨ <code>escapeshellarg()</code> å‡½æ•°è¿‡æ»¤æ‰§è¡Œå‘½ä»¤çš„å‚æ•°ï¼Œä»¥é˜»æ­¢æ½œåœ¨çš„æ³¨å…¥æ”»å‡»ã€‚</p></li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$email</span> <span class="token operator">=</span> <span class="token function">filter_var</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_EMAIL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$email</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Invalid email"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Valid email"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PHP çš„å­¦ä¹ å’Œä½¿ç”¨æ˜¯ä¸€ä¸ªä¸æ–­è¿›åŒ–çš„è¿‡ç¨‹ã€‚å§‹ç»ˆä¿æŒå¯¹æœ€æ–°ç‰ˆæœ¬çš„å…³æ³¨ï¼Œé‡‡ç”¨æœ€ä½³å®è·µå’Œå®‰å…¨æªæ–½ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ„å»ºæ›´é«˜æ•ˆã€æ›´å®‰å…¨çš„ Web åº”ç”¨ã€‚</p><p>å¸Œæœ›è¿™ç¯‡ç¬”è®°æ•´ç†èƒ½å¤Ÿå¸®åŠ©ä½ å›é¡¾å’ŒæŒæ¡ PHP å¼€å‘çš„å…³é”®çŸ¥è¯†ç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux æ–‡ä»¶ä¼ è¾“åˆ©å™¨ï¼šSCP å’Œ LRZSZ</title>
      <link href="posts/65525c46.html"/>
      <url>posts/65525c46.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„è½¯ä»¶å¼€å‘å’ŒæœåŠ¡å™¨ç®¡ç†å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨æœ¬æœºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚</p><p>æœ¬æ–‡å°†å‘æ‚¨ä»‹ç»ä¸¤ç§é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼š<code>scp</code> å’Œ <code>lrzsz</code>ï¼Œå¹¶æä¾›ç®€å•æ˜“æ‡‚çš„ä½¿ç”¨æŒ‡å—ã€‚</p><h2 id="ä½¿ç”¨-scp-è¿›è¡Œè¿œç¨‹æ‹·è´"><a href="#ä½¿ç”¨-scp-è¿›è¡Œè¿œç¨‹æ‹·è´" class="headerlink" title="ä½¿ç”¨ scp è¿›è¡Œè¿œç¨‹æ‹·è´"></a>ä½¿ç”¨ scp è¿›è¡Œè¿œç¨‹æ‹·è´</h2><p><code>scp</code> å‘½ä»¤æ˜¯ Secure Copy Protocol çš„ç¼©å†™ï¼Œå®ƒåŸºäº SSH (Secure Shell) åè®®ä¸ºç”¨æˆ·æä¾›åœ¨æœ¬åœ°å’Œè¿œç¨‹æœºå™¨ä¹‹é—´å®‰å…¨ä¼ è¾“æ–‡ä»¶çš„èƒ½åŠ›ã€‚</p><h3 id="1-ä»è¿œç¨‹æ‹·è´åˆ°æœ¬åœ°"><a href="#1-ä»è¿œç¨‹æ‹·è´åˆ°æœ¬åœ°" class="headerlink" title="1. ä»è¿œç¨‹æ‹·è´åˆ°æœ¬åœ°"></a>1. ä»è¿œç¨‹æ‹·è´åˆ°æœ¬åœ°</h3><p>å½“æˆ‘ä»¬éœ€è¦å°†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æ‹·è´åˆ°æœ¬åœ°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ ¼å¼ï¼š</p><ul><li><strong>æ‹·è´æ–‡ä»¶</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†è¿œç¨‹ /root/alex.sql æ–‡ä»¶æ‹·è´åˆ°æœ¬æœº /home/hello/ ç›®å½•ä¸‹</span><span class="token function">scp</span> root@192.168.0.102:/root/alex.sql /home/hello/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><strong>æ‹·è´æ–‡ä»¶å¤¹</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†è¿œç¨‹ /root/test æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬ test æ–‡ä»¶å¤¹æœ¬èº«ï¼‰æ‹·è´åˆ°æœ¬æœº /home/hello/ ç›®å½•ä¸‹</span><span class="token function">scp</span> <span class="token parameter variable">-r</span> root@192.168.0.102:/root/test /home/hello/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-ä»æœ¬åœ°æ‹·è´åˆ°è¿œç¨‹"><a href="#2-ä»æœ¬åœ°æ‹·è´åˆ°è¿œç¨‹" class="headerlink" title="2. ä»æœ¬åœ°æ‹·è´åˆ°è¿œç¨‹"></a>2. ä»æœ¬åœ°æ‹·è´åˆ°è¿œç¨‹</h3><p>ç›¸ååœ°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠæœ¬åœ°çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å‘½ä»¤æ ¼å¼æ“ä½œï¼š</p><ul><li><strong>æ‹·è´æ–‡ä»¶</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†æœ¬åœ°æ–‡ä»¶ /home/hello/test.php æ‹·è´åˆ°è¿œç¨‹æœº /root/ ç›®å½•ä¸‹</span><span class="token function">scp</span> /home/hello/test.php root@192.168.0.102:/root/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><strong>æ‹·è´æ–‡ä»¶å¤¹</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†æœ¬åœ° /home/hello/test ç›®å½•ï¼ˆå’Œç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼‰æ‹·è´åˆ°è¿œç¨‹ /root/ ç›®å½•ä¸‹</span><span class="token function">scp</span> <span class="token parameter variable">-r</span> /home/hello/test root@192.168.0.102:/root/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3><ul><li>è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼Œç³»ç»Ÿä¼šè¦æ±‚è¾“å…¥è¿œç¨‹æœåŠ¡å™¨çš„å¯†ç ã€‚</li><li>ç¡®ä¿ä½ å…·å¤‡è¿œç¨‹æœåŠ¡å™¨ä¸Šç›¸åº”ç›®å½•çš„è¯»å†™æƒé™ã€‚</li><li><code>-r</code> é€‰é¡¹è¡¨ç¤ºé€’å½’åœ°æ‹·è´æ–‡ä»¶å¤¹ï¼Œä¸åŠ æ­¤é€‰é¡¹æ—¶åªèƒ½æ‹·è´å•ä¸ªæ–‡ä»¶ã€‚</li></ul><h2 id="ä½¿ç”¨-lrzsz-è¿›è¡Œæ–‡ä»¶ä¼ è¾“"><a href="#ä½¿ç”¨-lrzsz-è¿›è¡Œæ–‡ä»¶ä¼ è¾“" class="headerlink" title="ä½¿ç”¨ lrzsz è¿›è¡Œæ–‡ä»¶ä¼ è¾“"></a>ä½¿ç”¨ lrzsz è¿›è¡Œæ–‡ä»¶ä¼ è¾“</h2><p><code>lrzsz</code> æ˜¯ Linux/Unix ç¯å¢ƒä¸‹çš„ä¸€ä¸ªå…è´¹æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬é€šè¿‡ä¸²è¡Œç«¯å£æˆ–å®‰å…¨å£³ï¼ˆSSHï¼‰è¿æ¥è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½æ“ä½œã€‚</p><p>lrzsz æ˜¯ rz å’Œ sz ä¸¤ä¸ªå‘½ä»¤çš„é›†åˆï¼Œåˆ†åˆ«ç”¨äºä»æœ¬åœ°åˆ°è¿œç¨‹çš„æ–‡ä»¶ä¸Šä¼ å’Œä»è¿œç¨‹åˆ°æœ¬åœ°çš„æ–‡ä»¶ä¸‹è½½ã€‚</p><h3 id="å®‰è£…-lrzsz"><a href="#å®‰è£…-lrzsz" class="headerlink" title="å®‰è£… lrzsz"></a>å®‰è£… lrzsz</h3><ul><li><strong>Ubuntu/Debian ç³»ç»Ÿ</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> lrzsz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>CentOS/RHEL ç³»ç»Ÿ</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> lrzsy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶"><a href="#ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶"></a>ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶</h3><ul><li><strong>ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨</strong></li></ul><p>åœ¨è¿œç¨‹æœåŠ¡å™¨çš„ç»ˆç«¯è¾“å…¥ <code>rz</code> å‘½ä»¤åï¼Œä¸€ä¸ªæ–‡ä»¶é€‰æ‹©çª—å£ä¼šå‡ºç°åœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œé€‰æ‹©ä½ å¸Œæœ›ä¸Šä¼ çš„æ–‡ä»¶å³å¯å¼€å§‹ä¸Šä¼ è¿‡ç¨‹ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>ä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶</strong></li></ul><p>åœ¨è¿œç¨‹æœåŠ¡å™¨çš„ç»ˆç«¯è¾“å…¥ <code>sz æ–‡ä»¶å</code> å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¼€å§‹å°†æŒ‡å®šçš„æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°æœºå™¨ä¸Šã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sz filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹-1"><a href="#ä½¿ç”¨æ³¨æ„äº‹é¡¹-1" class="headerlink" title="ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3><ul><li>ä½¿ç”¨ <code>lrzsz</code> è¿›è¡Œæ–‡ä»¶ä¼ è¾“æ—¶ï¼Œç¡®ä¿ä½ çš„ SSH å®¢æˆ·ç«¯æ”¯æŒ ZModem åè®®ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ SecureCRT æˆ–è€… iTerm2 ä½œä¸ºç»ˆç«¯å·¥å…·æ—¶ï¼Œè¿™äº›éƒ½åŸç”Ÿæ”¯æŒ <code>lrzsz</code> å‘½ä»¤ã€‚</li><li><code>rz</code> å‘½ä»¤é€‚ç”¨äºä¸Šä¼ æ–‡ä»¶ï¼Œè€Œ <code>sz</code> å‘½ä»¤ç”¨äºä¸‹è½½æ–‡ä»¶ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>scp å’Œ lrzsz æ˜¯ Linux ç³»ç»Ÿä¸­ä¸¤ä¸ªéå¸¸æœ‰ç”¨çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚scp æä¾›äº†åŠ å¯†çš„æ–‡ä»¶ä¼ è¾“èƒ½åŠ›ï¼Œé€‚åˆåœ¨ä¸åŒæœåŠ¡å™¨é—´å®‰å…¨åœ°ä¼ è¾“æ–‡ä»¶ã€‚è€Œ lrzsz åˆ™ä»¥å…¶ç®€å•çš„æ“ä½œï¼Œæ–¹ä¾¿äº†æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ã€‚</p><p>éšç€ <code>scp</code> å’Œ <code>lrzsz</code> çš„å¸®åŠ©ï¼Œæ— è®ºæ˜¯ä»æœ¬åœ°å‘è¿œç¨‹æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ï¼Œè¿˜æ˜¯ä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œéƒ½å˜å¾—ç®€å•å¿«æ·ã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©å¤§å®¶æ›´é«˜æ•ˆåœ°è¿›è¡Œæ–‡ä»¶ä¼ è¾“æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ä¸‰å‰‘å®¢ grepã€sedã€awk</title>
      <link href="posts/5ffd9f1c.html"/>
      <url>posts/5ffd9f1c.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Linux çš„å‘½ä»¤è¡Œä¸–ç•Œé‡Œï¼Œæœ‰ä¸‰ä¸ªå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ï¼š<code>grep</code>ã€<code>sed</code> å’Œ <code>awk</code>ã€‚å®ƒä»¬è¢«ç»Ÿç§°ä¸º â€œLinux ä¸‰å‰‘å®¢â€ï¼Œå®ƒä»¬å„è‡ªæ‹¥æœ‰ç‹¬ç‰¹çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é«˜æ•ˆåœ°è¿›è¡Œå„ç§æ–‡æœ¬å¤„ç†ä»»åŠ¡ã€‚è®©æˆ‘ä»¬ä¸€ä¸€äº†è§£å®ƒä»¬ã€‚</p><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p><code>grep</code> çš„å…¨ç§°ä¸º â€œglobal regular expression printâ€ï¼Œæ„å‘³ç€å®ƒå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥æœç´¢æ–‡æœ¬ï¼Œå¹¶æŠŠåŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥ã€‚</p><h3 id="grep-å‘½ä»¤å¸¸ç”¨é€‰é¡¹åŠå«ä¹‰"><a href="#grep-å‘½ä»¤å¸¸ç”¨é€‰é¡¹åŠå«ä¹‰" class="headerlink" title="grep å‘½ä»¤å¸¸ç”¨é€‰é¡¹åŠå«ä¹‰"></a>grep å‘½ä»¤å¸¸ç”¨é€‰é¡¹åŠå«ä¹‰</h3><table><thead><tr><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-c</td><td>ä»…åˆ—å‡ºæ–‡ä»¶ä¸­åŒ…å«åŒ¹é…æ¨¡å¼çš„è¡Œæ•°</td></tr><tr><td>-i</td><td>å¿½ç•¥æ¨¡å¼ä¸­çš„å­—æ¯å¤§å°å†™</td></tr><tr><td>-l</td><td>åˆ—å‡ºåŒ…å«åŒ¹é…è¡Œçš„æ–‡ä»¶å</td></tr><tr><td>-n</td><td>åœ¨æ¯ä¸€è¡Œçš„æœ€å‰é¢åˆ—å‡ºè¡Œå·</td></tr><tr><td>-v</td><td>åˆ—å‡ºä¸åŒ¹é…æ¨¡å¼çš„è¡Œ</td></tr><tr><td>-w</td><td>ä»…åŒ¹é…æ•´ä¸ªå•è¯ï¼Œå¿½ç•¥éƒ¨åˆ†åŒ¹é…çš„è¡Œ</td></tr></tbody></table><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥æ‰¾ demo.txt æ–‡ä»¶ä¸­å«æœ‰ "alex" å­—ç¬¦ä¸²çš„è¡Œ</span><span class="token function">grep</span> <span class="token string">"alex"</span> demo.txt<span class="token comment"># æŸ¥æ‰¾ demo.txt æ–‡ä»¶ä¸­æœ‰å¤šå°‘è¡Œå‡ºç°äº† "alex" å­—ç¬¦ä¸²</span><span class="token function">grep</span> <span class="token parameter variable">-c</span> <span class="token string">"alex"</span> demo.txt<span class="token comment"># å‡è®¾è¾“å‡ºæ˜¯ 50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><p><code>sed</code>ï¼ˆstream editorï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„æµå¼æ–‡æœ¬ç¼–è¾‘å™¨ã€‚å®ƒå¯ä»¥æ ¹æ®è„šæœ¬å‘½ä»¤æ¥å¤„ç†æ–‡æœ¬æ–‡ä»¶ä¸­çš„æ•°æ®ã€‚è¿™äº›å‘½ä»¤å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ä¸­ã€‚</p><h3 id="sed-ä½¿ç”¨æ–¹å¼"><a href="#sed-ä½¿ç”¨æ–¹å¼" class="headerlink" title="sed ä½¿ç”¨æ–¹å¼"></a>sed ä½¿ç”¨æ–¹å¼</h3><ol><li>æ¯æ¬¡ä»…è¯»å–ä¸€è¡Œå†…å®¹ï¼›</li><li>æ ¹æ®æä¾›çš„è§„åˆ™å‘½ä»¤åŒ¹é…å¹¶ä¿®æ”¹æ•°æ®ã€‚æ³¨æ„ï¼Œ<code>sed</code> é»˜è®¤ä¸ä¼šç›´æ¥ä¿®æ”¹æºæ–‡ä»¶æ•°æ®ï¼Œè€Œæ˜¯ä¼šå°†æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­ï¼Œä¿®æ”¹ä¹Ÿä»…åœ¨ç¼“å†²åŒºä¸­è¿›è¡Œï¼›</li><li>è¾“å‡ºæ‰§è¡Œç»“æœã€‚</li></ol><p>å½“ä¸€è¡Œæ•°æ®åŒ¹é…å¹¶å¤„ç†å®Œæˆåï¼Œ<code>sed</code> ä¼šç»§ç»­è¯»å–ä¸‹ä¸€è¡Œæ•°æ®ï¼Œå¹¶é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å°†æ–‡ä»¶ä¸­æ‰€æœ‰æ•°æ®å¤„ç†å®Œæ¯•ã€‚</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="æ¸…ç©ºæ‰æ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹"><a href="#æ¸…ç©ºæ‰æ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹" class="headerlink" title="æ¸…ç©ºæ‰æ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹"></a>æ¸…ç©ºæ‰æ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸ä¼šç›´æ¥ä¿®æ”¹æºæ–‡ä»¶ demo.txtï¼Œè€Œæ˜¯åœ¨ç»ˆç«¯æ˜¾ç¤ºä¿®æ”¹åçš„ç»“æœï¼Œå³ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œå› ä¸ºæ‰€æœ‰è¡Œéƒ½è¢«åˆ é™¤äº†</span><span class="token function">sed</span> <span class="token string">'d'</span> demo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><p><code>awk</code> æ˜¯ä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ†æçš„ç¼–ç¨‹è¯­è¨€å’Œå·¥å…·ã€‚å®ƒéå¸¸æ“…é•¿åˆ—å‡ºæ•°æ®å’ŒæŠ¥è¡¨ï¼Œè€Œä¸”å®ƒçš„è¯­æ³•ååˆ†çµæ´»ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</p><h3 id="awk-çš„åŸºæœ¬ä½¿ç”¨"><a href="#awk-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="awk çš„åŸºæœ¬ä½¿ç”¨"></a>awk çš„åŸºæœ¬ä½¿ç”¨</h3><p><code>awk</code> é€šè¿‡å¯¹æ•°æ®è¿›è¡Œæ¨¡å¼æ‰«æå’Œå¤„ç†æ¥è¾¾åˆ°æ–‡æœ¬å¤„ç†çš„ç›®çš„ã€‚å®ƒé»˜è®¤ä»¥ç©ºæ ¼ä¸ºå­—æ®µåˆ†éš”ç¬¦ï¼Œå°†ä¸€è¡Œåˆ’åˆ†ä¸ºå¤šä¸ªå­—æ®µã€‚</p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="è¾“å‡ºæ–‡ä»¶çš„æ¯ä¸€è¡Œçš„ç¬¬äºŒä¸ªå­—æ®µ"><a href="#è¾“å‡ºæ–‡ä»¶çš„æ¯ä¸€è¡Œçš„ç¬¬äºŒä¸ªå­—æ®µ" class="headerlink" title="è¾“å‡ºæ–‡ä»¶çš„æ¯ä¸€è¡Œçš„ç¬¬äºŒä¸ªå­—æ®µ"></a>è¾“å‡ºæ–‡ä»¶çš„æ¯ä¸€è¡Œçš„ç¬¬äºŒä¸ªå­—æ®µ</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‡è®¾ demo.txt æ˜¯ä»¥ç©ºæ ¼åˆ†éš”çš„å­—æ®µçš„æ–‡æœ¬æ–‡ä»¶</span><span class="token function">awk</span> <span class="token string">'{print $2}'</span> demo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="åˆ†ææ—¥å¿—æ–‡ä»¶å¹¶æ±‡æ€»ä¿¡æ¯"><a href="#åˆ†ææ—¥å¿—æ–‡ä»¶å¹¶æ±‡æ€»ä¿¡æ¯" class="headerlink" title="åˆ†ææ—¥å¿—æ–‡ä»¶å¹¶æ±‡æ€»ä¿¡æ¯"></a>åˆ†ææ—¥å¿—æ–‡ä»¶å¹¶æ±‡æ€»ä¿¡æ¯</h4><p>å‡è®¾æœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ <code>access.log</code>ï¼Œè®°å½•äº†ç½‘ç«™çš„è®¿é—®ä¿¡æ¯ã€‚æˆ‘ä»¬æƒ³è¦ç»Ÿè®¡å‡ºç°æ¬¡æ•°æœ€å¤šçš„ IP åœ°å€ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'{print $1}'</span> access.log <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§£é‡Šï¼š</p><ul><li><code>awk '{print $1}' access.log</code>ï¼šä½¿ç”¨ awk æ‰“å°å‡ºæ—¥å¿—ä¸­æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆä¸€èˆ¬æ˜¯ IP åœ°å€ï¼‰ã€‚</li><li><code>sort</code>ï¼šå¯¹ IP åœ°å€è¿›è¡Œæ’åºã€‚</li><li><code>uniq -c</code>ï¼šå‹ç¼©è¿ç»­é‡å¤çš„è¡Œå¹¶è®¡æ•°ã€‚</li><li><code>sort -nr</code>ï¼šæ ¹æ®æ¬¡æ•°é€†åºæ’åºã€‚</li><li><code>head -n 10</code>ï¼šå±•ç¤ºå‰ 10 è¡Œã€‚</li></ul><p>grepã€sed å’Œ awk æ˜¯ Linux ç³»ç»Ÿä¸­æ–‡æœ¬å¤„ç†çš„ä¸‰å¤§æ³•å®ã€‚grep ç”¨äºæœç´¢æ–‡æœ¬ï¼Œsed ç”¨äºç¼–è¾‘æ–‡æœ¬ï¼Œè€Œ awk åˆ™ç”¨äºæ›´å¤æ‚çš„æ–‡æœ¬åˆ†æå’Œå¤„ç†ã€‚</p><p>é€šè¿‡ç»„åˆä½¿ç”¨ <code>grep</code>ã€<code>sed</code> å’Œ <code>awk</code>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å¤„ç†å¤æ‚çš„æ–‡æœ¬æ•°æ®ï¼Œæœ‰æ•ˆæé«˜æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ å…¥é—¨å¹¶ç†Ÿç»ƒæŒæ¡è¿™äº›å·¥å…·ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>curl ä½¿ç”¨ï¼šå‘½ä»¤è¡Œä¸­çš„ HTTP å®¢æˆ·ç«¯</title>
      <link href="posts/9f801236.html"/>
      <url>posts/9f801236.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„è½¯ä»¶å¼€å‘å’Œç½‘ç»œç®¡ç†å·¥ä½œä¸­ï¼Œ<code>curl</code> æ˜¯ä¸€ä¸ªæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæ”¯æŒå¤šç§åè®®ï¼ŒåŒ…æ‹¬ HTTPã€HTTPSã€FTP ç­‰ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p><p>æœ¬æ–‡å°†é€šè¿‡ç®€å•æ˜“æ‡‚çš„è¯­è¨€ï¼Œå¸¦ä½ å¿«é€ŸæŒæ¡ curl åœ¨å‘é€å„ç§ç±»å‹è¯·æ±‚æ—¶çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><h2 id="curl-åŸºæœ¬æ¦‚å¿µ"><a href="#curl-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="curl åŸºæœ¬æ¦‚å¿µ"></a>curl åŸºæœ¬æ¦‚å¿µ</h2><p><code>curl</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œæˆ–è€…è„šæœ¬ä¸­ä¸æœåŠ¡å™¨äº¤äº’ã€‚å®ƒæ”¯æŒå¤šç§åè®®ï¼Œèƒ½å¤Ÿé€šè¿‡ URL ç­‰å‚æ•°å‘é€è¯·æ±‚ï¼Œå¹¶è·å–æˆ–å‘é€æ•°æ®ã€‚é€‚åˆç”¨äºæµ‹è¯• APIã€è‡ªåŠ¨åŒ–ä»»åŠ¡ã€æ•°æ®æ£€ç´¢ç­‰åœºæ™¯ã€‚</p><h2 id="å‘é€-POST-è¯·æ±‚"><a href="#å‘é€-POST-è¯·æ±‚" class="headerlink" title="å‘é€ POST è¯·æ±‚"></a>å‘é€ POST è¯·æ±‚</h2><p>åœ¨ä½¿ç”¨ <code>curl</code> å‘é€ POST è¯·æ±‚æ—¶ï¼Œå¸¸ç”¨ <code>-d</code> æˆ– <code>--data</code> å‚æ•°æ¥æŒ‡å®šè¯·æ±‚ä½“çš„å†…å®¹ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‘é€ POST è¯·æ±‚ï¼ŒåŠ å…¥ -d å‚æ•°åï¼Œä¼šè‡ªåŠ¨è½¬ä¸º POST æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥çœç•¥ -X POST å‚æ•°</span><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST www.baidu.com <span class="token parameter variable">-d</span> <span class="token string">'a=1&amp;b=2'</span><span class="token comment"># æˆ–è€…ç›´æ¥ä½¿ç”¨ curl www.baidu.com -d 'a=1&amp;b=2'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œ <code>-d</code> å‚æ•°åè·Ÿç€çš„æ˜¯æˆ‘ä»¬è¦å‘é€çš„æ•°æ®ã€‚è¿™ç§æ–¹å¼ç®€æ´æ˜äº†ï¼Œéå¸¸é€‚åˆæµ‹è¯•ç®€å•çš„è¡¨å•æ•°æ®æˆ– API æ¥å£ã€‚</p><h2 id="å‘é€-GET-è¯·æ±‚"><a href="#å‘é€-GET-è¯·æ±‚" class="headerlink" title="å‘é€ GET è¯·æ±‚"></a>å‘é€ GET è¯·æ±‚</h2><p>å‘é€ GET è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ URL åç›´æ¥åŠ æŸ¥è¯¢å­—ç¬¦ä¸²æˆ–ä½¿ç”¨ <code>-G</code> å‚æ•°é…åˆ <code>-d</code> æ¥æ„é€ æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‘é€ GET è¯·æ±‚ï¼Œ-G å‚æ•°ç”¨æ¥æ„é€  URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²</span><span class="token function">curl</span> https://google.com/search  <span class="token parameter variable">-G</span> <span class="token parameter variable">-d</span> <span class="token string">'q=kitties&amp;count=20'</span><span class="token comment"># æˆ–è€…ç›´æ¥ä½¿ç”¨å®Œæ•´çš„ URL</span><span class="token function">curl</span> <span class="token string">'https://google.com/search?q=kitties&amp;count=20'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸¤ç§æ–¹å¼å¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½å’Œåœºæ™¯éœ€æ±‚æ¥é€‰æ‹©ä½¿ç”¨ï¼Œæ•ˆæœæ˜¯ç›¸åŒçš„ã€‚</p><h2 id="å‘é€-JSON-è¯·æ±‚"><a href="#å‘é€-JSON-è¯·æ±‚" class="headerlink" title="å‘é€ JSON è¯·æ±‚"></a>å‘é€ JSON è¯·æ±‚</h2><p>åœ¨ç°ä»£çš„ Web å¼€å‘ä¸­ï¼ŒJSON æ˜¯æœ€å¸¸è§çš„æ•°æ®äº¤æ¢æ ¼å¼ä¹‹ä¸€ã€‚<code>curl</code> é€šè¿‡ <code>-H</code> å‚æ•°æ·»åŠ  HTTP å¤´ï¼Œå…¶ä¸­ <code>Content-Type: application/json</code> è¡¨æ˜å‘é€çš„æ•°æ®ç±»å‹ä¸º JSONã€‚</p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> <span class="token parameter variable">-X</span> POST https://api.weixin.qq.com/datacube/getweanalysisappiddailyvisittrend<span class="token punctuation">\</span>?access_token<span class="token punctuation">\</span><span class="token operator">=</span>ACCESS_TOKEN  <span class="token parameter variable">-d</span> <span class="token string">'{  "begin_date" : "20210328",  "end_date" : "20210328"}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä½¿ç”¨ <code>-H</code> æ·»åŠ äº†è¯·æ±‚å¤´ï¼Œ<code>-X POST</code> æŒ‡å®šäº†è¯·æ±‚æ–¹æ³•ï¼Œè™½ç„¶åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œç”±äºä½¿ç”¨äº† <code>-d</code> å‚æ•°ï¼Œ<code>-X POST</code> å¯ä»¥çœç•¥ã€‚</p><h2 id="ä¸Šä¼ æ–‡ä»¶"><a href="#ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶"></a>ä¸Šä¼ æ–‡ä»¶</h2><p><code>curl</code> ä¹Ÿæ”¯æŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œå¸¸é€šè¿‡ <code>-F</code> å‚æ•°å®ç°ã€‚</p><h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ³¨æ„æ–‡ä»¶è·¯å¾„å‰éœ€è¦åŠ ä¸Š @ ç¬¦å·</span><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://127.0.0.1:8000/upload/file  <span class="token parameter variable">-F</span> <span class="token assign-left variable">file</span><span class="token operator">=</span>@/path/to/your/file/img1.jpeg <span class="token parameter variable">-F</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>-F</code> å‚æ•°æŒ‡å®šäº†æˆ‘ä»¬æƒ³è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„å‰å¿…é¡»åŠ ä¸Š <code>@</code> ç¬¦å·ï¼Œè¡¨ç¤ºè¿™åé¢æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚</p><h2 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h2><p>ä½¿ç”¨ curl å¯ä»¥æ–¹ä¾¿åœ°ä¸‹è½½ç½‘ç»œä¸Šçš„å›¾ç‰‡æˆ–æ–‡ä»¶ï¼š</p><h3 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">'https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=abc'</span> <span class="token punctuation">\</span><span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> <span class="token parameter variable">-H</span> <span class="token string">'accept: image/jpeg'</span> <span class="token punctuation">\</span>--data-raw <span class="token string">'{    "scene": "userId=2&amp;activityId=5",    "page": "pages/index/index"}'</span> <span class="token operator">&gt;</span> abc.jpeg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ <code>curl</code> çš„ç”¨æ³•æœ‰äº†åˆæ­¥çš„äº†è§£ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„å·¥å…·ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯ã€‚æŒæ¡äº† <code>curl</code>ï¼Œä½ ä¾¿èƒ½åœ¨å‘½ä»¤è¡Œä¸‹è½»æ¾ä¸ä¸–ç•Œå„åœ°çš„æœåŠ¡å™¨äº¤æµï¼Œå®ç°æ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚</p><p>ä¸å¦¨ç°åœ¨å°±å¼€å§‹å°è¯•ä½¿ç”¨å®ƒï¼Œè§£é”æ›´å¤šå¯èƒ½å§ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux è½¯ä»¶å®‰è£…ä¸å¸è½½</title>
      <link href="posts/dc4fc28a.html"/>
      <url>posts/dc4fc28a.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Linux çš„ä¸–ç•Œé‡Œï¼Œå®‰è£…å’Œå¸è½½è½¯ä»¶æ˜¯æ¯ä¸ªä½¿ç”¨è€…éƒ½éœ€æŒæ¡çš„åŸºæœ¬æŠ€èƒ½ã€‚</p><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä»¥ç®€æ˜æ˜“æ‡‚çš„è¯­è¨€é£æ ¼ï¼Œä¸€æ­¥æ­¥å¼•å¯¼ä½ å­¦ä¼šå¦‚ä½•åœ¨ Linux ä¸Šå®‰è£…å’Œå¸è½½è½¯ä»¶ã€‚</p><h2 id="ä»¥-iftop-çš„å®‰è£…ä¸ºä¾‹å­"><a href="#ä»¥-iftop-çš„å®‰è£…ä¸ºä¾‹å­" class="headerlink" title="ä»¥ iftop çš„å®‰è£…ä¸ºä¾‹å­"></a>ä»¥ iftop çš„å®‰è£…ä¸ºä¾‹å­</h2><h3 id="ä»€ä¹ˆæ˜¯-iftopï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-iftopï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ iftopï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ iftopï¼Ÿ</h3><p><code>iftop</code> æ˜¯ä¸€ä¸ªç”¨äºå®æ—¶ç›‘æ§ç½‘ç»œæµé‡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå¯ä»¥å¸®ä½ ç›‘æµ‹é€šè¿‡ç‰¹å®šæ¥å£çš„æ•°æ®æµé‡ï¼Œå…·ä½“åˆ°æ¯ä¸ª IP çš„æµé‡ã€‚</p><h3 id="å¦‚ä½•å®‰è£…-iftopï¼Ÿ"><a href="#å¦‚ä½•å®‰è£…-iftopï¼Ÿ" class="headerlink" title="å¦‚ä½•å®‰è£… iftopï¼Ÿ"></a>å¦‚ä½•å®‰è£… iftopï¼Ÿ</h3><ol><li><strong>è®¿é—®å®˜ç½‘ä¸‹è½½</strong>: iftop çš„å®˜ç½‘æ˜¯ <a href="http://www.ex-parrot.com/~pdw/iftop/">http://www.ex-parrot.com/~pdw/iftop/</a>ã€‚æˆ‘ä»¬éœ€è¦åœ¨ Download éƒ¨åˆ†æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„ä¸‹è½½é“¾æ¥ã€‚</li><li><strong>å¤åˆ¶ä¸‹è½½é“¾æ¥åœ°å€</strong>: å½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º 0.17ï¼Œä¸‹è½½é“¾æ¥åœ°å€ä¸º <a href="http://www.ex-parrot.com/~pdw/iftop/download/iftop-0.17.tar.gz">http://www.ex-parrot.com/~pdw/iftop/download/iftop-0.17.tar.gz</a>ã€‚</li><li><strong>ä½¿ç”¨ wget å‘½ä»¤ä¸‹è½½è½¯ä»¶åŒ…</strong>: åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åä½¿ç”¨ <code>wget</code> å‘½ä»¤ä¸‹è½½ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> iftop_download<span class="token builtin class-name">cd</span> iftop_download<span class="token function">wget</span> http://www.ex-parrot.com/~pdw/iftop/download/iftop-0.17.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="4"><li><p><strong>æŸ¥çœ‹ä¸‹è½½çš„æ–‡ä»¶</strong>: ä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨ <code>ls</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸‹è½½çš„æ–‡ä»¶ã€‚</p></li><li><p><strong>è§£å‹ç¼©æ–‡ä»¶</strong>: ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤è§£å‹ç¼© <code>iftop</code>ï¼š</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zxf</span> iftop-0.17.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li><p><strong>æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶å¤¹</strong>: å†æ¬¡ä½¿ç”¨ <code>ls</code> å‘½ä»¤ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªåä¸º <code>iftop-0.17</code> çš„æ–‡ä»¶å¤¹ã€‚</p></li><li><p><strong>åˆ‡æ¢åˆ° iftop ç›®å½•</strong>: ä½¿ç”¨ <code>cd</code> å‘½ä»¤è¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ï¼š</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> iftop-0.17<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="8"><li><strong>å¼€å§‹å®‰è£…</strong>: åœ¨å®‰è£…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºæºä»£ç ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚ç›´æ¥è¾“å…¥ <code>./configure</code> ç„¶åå›è½¦ã€‚æœ‰å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œæç¤ºä½ æ²¡æœ‰å®‰è£… <code>libpcap</code> åŒ…ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å®ƒã€‚</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum search libpcap<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰¾åˆ° <code>libpcap</code> ç›¸å…³çš„åŒ…ä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> libpcap-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="9"><li><strong>å†æ¬¡è¿è¡Œé…ç½®å‘½ä»¤</strong>:</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./configure<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="10"><li><strong>ç¼–è¯‘å®‰è£…</strong>:</li></ol><p>å®Œæˆé…ç½®åï¼Œæ¥ä¸‹æ¥æ˜¯ç¼–è¯‘å’Œå®‰è£…è¿‡ç¨‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼–è¯‘</span><span class="token function">make</span><span class="token comment"># å®‰è£…</span><span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æºä»£ç ç¼–è¯‘çš„æ–¹å¼"><a href="#æºä»£ç ç¼–è¯‘çš„æ–¹å¼" class="headerlink" title="æºä»£ç ç¼–è¯‘çš„æ–¹å¼"></a>æºä»£ç ç¼–è¯‘çš„æ–¹å¼</h3><p>åœ¨ Linux ä¸‹ï¼Œä»æºä»£ç ç¼–è¯‘å®‰è£…æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„å®‰è£…æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„æ­¥éª¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®ï¼ˆç”ŸæˆMakefileï¼‰</span>./configure<span class="token comment"># æ‰§è¡Œ make å‘½ä»¤è¿›è¡Œç¼–è¯‘å·¥ä½œ</span><span class="token function">make</span><span class="token comment"># å®‰è£…</span><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment"># å¸è½½</span><span class="token function">sudo</span> <span class="token function">make</span> uninstall<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="rpm-çš„æ–¹å¼"><a href="#rpm-çš„æ–¹å¼" class="headerlink" title="rpm çš„æ–¹å¼"></a>rpm çš„æ–¹å¼</h3><p>RPMï¼ˆRed Hat Package Managerï¼‰æ˜¯ Red Hat ç³» Linux å‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å™¨ï¼Œå¯¹äºåŸºäº RPM çš„å‘è¡Œç‰ˆï¼ˆå¦‚ Fedoraã€CentOS ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>rpm</code> å‘½ä»¤æ¥ç®¡ç†è½¯ä»¶åŒ…ã€‚åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>rpm -ivh filename.rpm</td><td>å®‰è£…è½¯ä»¶</td></tr><tr><td>rpm -Uvh filename.rpm</td><td>å‡çº§è½¯ä»¶</td></tr><tr><td>rpm -e filename.rpm</td><td>å¸è½½è½¯ä»¶</td></tr><tr><td>rpm -qa | grep filename</td><td>æ¨¡ç³ŠæŸ¥æ‰¾è½¯ä»¶åŒ…</td></tr><tr><td>rpm -qpi filename.rpm</td><td>æŸ¥è¯¢è½¯ä»¶æè¿°ä¿¡æ¯</td></tr><tr><td>rpm -qpl filename.rpm</td><td>åˆ—å‡ºè½¯ä»¶æ–‡ä»¶ä¿¡æ¯</td></tr><tr><td>rpm -qf filename</td><td>æŸ¥è¯¢æ–‡ä»¶å±äºå“ªä¸ª RPM åŒ…</td></tr></tbody></table><h3 id="CentOS-ä¸‹ä½¿ç”¨-yum-çš„å®‰è£…æ–¹å¼"><a href="#CentOS-ä¸‹ä½¿ç”¨-yum-çš„å®‰è£…æ–¹å¼" class="headerlink" title="CentOS ä¸‹ä½¿ç”¨ yum çš„å®‰è£…æ–¹å¼"></a>CentOS ä¸‹ä½¿ç”¨ yum çš„å®‰è£…æ–¹å¼</h3><p>åœ¨ CentOS ç­‰åŸºäº Red Hat çš„å‘è¡Œç‰ˆä¸­ï¼Œ<code>yum</code> æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„åŒ…ç®¡ç†å™¨ã€‚è¿‘å¹´æ¥ï¼Œ<code>yum</code> å·²é€æ¸è¢«æ–°çš„ <code>dnf</code> å‘½ä»¤æ‰€å–ä»£ï¼Œä½†åœ¨å¾ˆå¤šç³»ç»Ÿä¸­ <code>yum</code> ä¾ç„¶å¹¿æ³›ä½¿ç”¨ã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>yum repolist all</td><td>åˆ—å‡ºæ‰€æœ‰ä»“åº“</td></tr><tr><td>yum list all</td><td>åˆ—å‡ºä»“åº“ä¸­æ‰€æœ‰è½¯ä»¶åŒ…</td></tr><tr><td>yum info è½¯ä»¶åŒ…åç§°</td><td>æŸ¥çœ‹è½¯ä»¶åŒ…ä¿¡æ¯</td></tr><tr><td>yum search è½¯ä»¶åŒ…åç§°</td><td>æœç´¢è½¯ä»¶åŒ…ä¿¡æ¯</td></tr><tr><td>yum install è½¯ä»¶åŒ…åç§°</td><td>å®‰è£…è½¯ä»¶åŒ…</td></tr><tr><td>yum reinstall è½¯ä»¶åŒ…åç§°</td><td>é‡æ–°å®‰è£…è½¯ä»¶åŒ…</td></tr><tr><td>yum update è½¯ä»¶åŒ…åç§°</td><td>å‡çº§è½¯ä»¶åŒ…</td></tr><tr><td>yum remove è½¯ä»¶åŒ…åç§°</td><td>ç§»é™¤è½¯ä»¶åŒ…</td></tr><tr><td>yum clean all</td><td>æ¸…é™¤æ‰€æœ‰ä»“åº“ç¼“å­˜</td></tr><tr><td>yum check-update</td><td>æ£€æŸ¥å¯æ›´æ–°çš„è½¯ä»¶åŒ…</td></tr><tr><td>yum grouplist</td><td>æŸ¥çœ‹ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„è½¯ä»¶åŒ…ç»„</td></tr><tr><td>yum groupinstall è½¯ä»¶åŒ…ç»„</td><td>å®‰è£…æŒ‡å®šçš„è½¯ä»¶åŒ…ç»„</td></tr><tr><td>yum groupremove è½¯ä»¶åŒ…ç»„</td><td>ç§»é™¤æŒ‡å®šçš„è½¯ä»¶åŒ…ç»„</td></tr><tr><td>yum groupinfo è½¯ä»¶åŒ…ç»„</td><td>æŸ¥è¯¢æŒ‡å®šçš„è½¯ä»¶åŒ…ç»„ä¿¡æ¯</td></tr></tbody></table><p>æœ¬æ–‡ä»‹ç»äº† Linux ä¸‹å‡ ç§å¸¸è§çš„è½¯ä»¶å®‰è£…å’Œå¸è½½æ–¹æ³•ï¼ŒåŒ…æ‹¬æºä»£ç ç¼–è¯‘å®‰è£…ã€rpm å’Œ yumã€‚ä¸åŒçš„å®‰è£…æ–¹æ³•æœ‰å„è‡ªçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚ç†è§£è¿™äº›åŸºæœ¬çš„å®‰è£…æ­¥éª¤å’Œå‘½ä»¤ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ç®¡ç†å’Œç»´æŠ¤ä½ çš„ Linux ç³»ç»Ÿã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°æŒæ¡ Linux è½¯ä»¶çš„å®‰è£…ä¸å¸è½½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªåŠ¨åŒ–è„šæœ¬ï¼šæå‡è¿ç»´æ•ˆç‡çš„ç§˜è¯€</title>
      <link href="posts/19ab69b8.html"/>
      <url>posts/19ab69b8.html</url>
      
        <content type="html"><![CDATA[<p>å½“æˆ‘ä»¬è°ˆè®ºæœåŠ¡å™¨ç®¡ç†æ—¶ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬å°±åƒæ˜¯ä¸€ä½æ— å£°çš„è‹±é›„ï¼Œå®ƒé»˜é»˜åœ¨å¹•åä¿æŒç€æˆ‘ä»¬çš„æœåŠ¡å™¨è¿è¡Œé¡ºç•…ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼ŒåŒæ—¶è¿˜èƒ½æœ‰æ•ˆé˜²èŒƒç½‘ç»œæ”»å‡»ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘å°†å’Œå¤§å®¶åˆ†äº«å‡ ä¸ªå®ç”¨çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ¶µç›–äº†æ•°æ®åº“å¤‡ä»½ã€é˜²èŒƒDosæ”»å‡»ã€ç›‘æ§ç½‘å¡æµé‡ã€å‘é€ç³»ç»Ÿå‘Šè­¦ä»¥åŠæ—¥å¿—ç®¡ç†ç­‰æ–¹é¢ã€‚æ— è®ºä½ æ˜¯åˆå­¦è€…è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼Œç›¸ä¿¡è¿™ç¯‡æ–‡ç« éƒ½èƒ½å¸¦ç»™ä½ ä¸€äº›å¯å‘ã€‚</p><h2 id="ä¸€ã€è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“çš„è„šæœ¬"><a href="#ä¸€ã€è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“çš„è„šæœ¬" class="headerlink" title="ä¸€ã€è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“çš„è„šæœ¬"></a>ä¸€ã€è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“çš„è„šæœ¬</h2><h3 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>æ•°æ®åº“æ˜¯ä»»ä½•åœ¨çº¿æœåŠ¡çš„å¿ƒè„ã€‚æ— è®ºæ˜¯ç”¨æˆ·ä¿¡æ¯ã€äº¤æ˜“æ•°æ®è¿˜æ˜¯å…¶ä»–é‡è¦ä¿¡æ¯ï¼Œéƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ä¸€æ—¦æ•°æ®ä¸¢å¤±æˆ–æŸåï¼Œå¯èƒ½ä¼šé€ æˆä¸å¯æŒ½å›çš„æŸå¤±ã€‚å› æ­¤ï¼Œå®šæœŸå¤‡ä»½æ•°æ®åº“æ˜¯ä¸€é¡¹éå¸¸å…³é”®çš„å·¥ä½œã€‚</p><h3 id="è„šæœ¬æ¦‚è¿°"><a href="#è„šæœ¬æ¦‚è¿°" class="headerlink" title="è„šæœ¬æ¦‚è¿°"></a>è„šæœ¬æ¦‚è¿°</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„shellè„šæœ¬ï¼Œç”¨äºå¤‡ä»½æŒ‡å®šçš„æ•°æ®åº“è¡¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment">#å¤‡ä»½æŒ‡å®šè¡¨æ•°æ®ï¼Œå› ä¸ºåŠ äº† -t å‚æ•°ï¼Œå¦‚æœéœ€è¦å¤‡ä»½è¡¨å­—æ®µç›´æ¥å»æ‰ -t å‚æ•°å³å¯ã€‚</span><span class="token comment"># æ•°æ®åº“ç›¸å…³é…ç½®ä¿¡æ¯</span><span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span><span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">'password'</span><span class="token assign-left variable">database</span><span class="token operator">=</span><span class="token string">'sample_api'</span><span class="token assign-left variable">tables</span><span class="token operator">=</span><span class="token string">'menus users'</span><span class="token comment"># å½“å‰æ—¶é—´</span><span class="token assign-left variable">current_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">"%Y-%m-%d_%H:%M:%S"</span><span class="token variable">)</span></span><span class="token comment"># sql å¤‡ä»½ç›®å½•</span><span class="token assign-left variable">sql_backup_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> `dirname $0`<span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">)</span></span><span class="token comment"># sql æ–‡ä»¶</span><span class="token assign-left variable">file_name</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${sql_backup_path}</span>/back_up_<span class="token variable">${current_gmtime}</span>.sql"</span><span class="token comment"># ç›®å½•å­˜åœ¨ï¼Œåˆ é™¤ä¿®æ”¹æ—¶é—´ä¸º 7 å¤©å‰çš„æ–‡ä»¶</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">${sql_backup_path}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token function">find</span> <span class="token string">"<span class="token variable">${sql_backup_path}</span>"</span>/* <span class="token parameter variable">-name</span> <span class="token string">'*.sql'</span> <span class="token parameter variable">-mtime</span> +1 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span class="token keyword">fi</span><span class="token comment"># æ‰§è¡Œ sql å¤‡ä»½</span>mysqldump <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token variable">${host}</span> <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token variable">${port}</span> <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token variable">${username}</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token variable">${password}</span> <span class="token parameter variable">-t</span> <span class="token variable">${database}</span> <span class="token variable">${tables}</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${file_name}</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤è„šæœ¬é€šè¿‡mysqldumpå·¥å…·å¤‡ä»½æŒ‡å®šçš„æ•°æ®åº“ä¸­çš„è¡¨ï¼Œå¹¶æ ¹æ®å½“å‰æ—¶é—´ä¸ºå¤‡ä»½æ–‡ä»¶å‘½åï¼Œè‡ªåŠ¨åˆ é™¤7å¤©å‰çš„å¤‡ä»½æ–‡ä»¶ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚</p><h2 id="äºŒã€Dosæ”»å‡»é˜²èŒƒï¼ˆè‡ªåŠ¨å±è”½æ”»å‡»IPï¼‰"><a href="#äºŒã€Dosæ”»å‡»é˜²èŒƒï¼ˆè‡ªåŠ¨å±è”½æ”»å‡»IPï¼‰" class="headerlink" title="äºŒã€Dosæ”»å‡»é˜²èŒƒï¼ˆè‡ªåŠ¨å±è”½æ”»å‡»IPï¼‰"></a>äºŒã€Dosæ”»å‡»é˜²èŒƒï¼ˆè‡ªåŠ¨å±è”½æ”»å‡»IPï¼‰</h2><h3 id="èƒŒæ™¯ä»‹ç»-1"><a href="#èƒŒæ™¯ä»‹ç»-1" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>Dosæ”»å‡»æ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œæ”»å‡»æ–¹å¼ï¼Œé€šè¿‡å¤§é‡çš„è¯·æ±‚æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚å¯¹äºè¿™ç±»æ”»å‡»ï¼Œä¸€ç§æœ‰æ•ˆçš„åº”å¯¹ç­–ç•¥æ˜¯æ£€æµ‹å¼‚å¸¸IPå¹¶åŠæ—¶å°†å…¶å±è”½ã€‚</p><h3 id="è„šæœ¬æ¦‚è¿°-1"><a href="#è„šæœ¬æ¦‚è¿°-1" class="headerlink" title="è„šæœ¬æ¦‚è¿°"></a>è„šæœ¬æ¦‚è¿°</h3><p>ä»¥ä¸‹è„šæœ¬å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¼‚å¸¸IPå¹¶å±è”½ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%d/%b/%Y:%H:%M<span class="token variable">)</span></span><span class="token assign-left variable">LOG_FILE</span><span class="token operator">=</span>/usr/local/nginx/logs/demo2.access.log<span class="token assign-left variable">ABNORMAL_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">tail</span> <span class="token parameter variable">-n5000</span> $LOG_FILE <span class="token operator">|</span> <span class="token function">grep</span> $DATE <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{a[$1]++} END{for(i in a) if(a[i]&gt;10) print i}'</span><span class="token variable">)</span></span><span class="token keyword">for</span> <span class="token for-or-select variable">IP</span> <span class="token keyword">in</span> <span class="token variable">$ABNORMAL_IP</span><span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span>iptables <span class="token parameter variable">-vnL</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-c</span> <span class="token string">"<span class="token variable">$IP</span>"</span><span class="token variable">)</span></span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token variable">$IP</span> <span class="token parameter variable">-j</span> DROP        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%F_%T'</span><span class="token variable">)</span></span> <span class="token variable">$IP</span>"</span> <span class="token operator">&gt;&gt;</span> /tmp/drop_ip.log    <span class="token keyword">fi</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¥è„šæœ¬é€šè¿‡åˆ†æNginxçš„è®¿é—®æ—¥å¿—ï¼ŒæŸ¥æ‰¾åœ¨çŸ­æ—¶é—´å†…è®¿é—®é¢‘ç‡å¼‚å¸¸é«˜çš„IPåœ°å€ï¼Œå¹¶ä½¿ç”¨iptableså‘½ä»¤å±è”½è¿™äº›IPã€‚</p><h2 id="ä¸‰ã€æŸ¥çœ‹ç½‘å¡å®æ—¶æµé‡è„šæœ¬"><a href="#ä¸‰ã€æŸ¥çœ‹ç½‘å¡å®æ—¶æµé‡è„šæœ¬" class="headerlink" title="ä¸‰ã€æŸ¥çœ‹ç½‘å¡å®æ—¶æµé‡è„šæœ¬"></a>ä¸‰ã€æŸ¥çœ‹ç½‘å¡å®æ—¶æµé‡è„šæœ¬</h2><h3 id="èƒŒæ™¯ä»‹ç»-2"><a href="#èƒŒæ™¯ä»‹ç»-2" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>äº†è§£æœåŠ¡å™¨çš„å®æ—¶æµé‡æ˜¯ç›‘æ§æœåŠ¡å™¨çŠ¶æ€çš„é‡è¦ä¸€ç¯ã€‚é€šè¿‡å®æ—¶ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥åŠæ—¶å‘ç°å¼‚å¸¸æµé‡ï¼Œåšå‡ºç›¸åº”çš„å¤„ç†ã€‚</p><h3 id="è„šæœ¬æ¦‚è¿°-2"><a href="#è„šæœ¬æ¦‚è¿°-2" class="headerlink" title="è„šæœ¬æ¦‚è¿°"></a>è„šæœ¬æ¦‚è¿°</h3><p>ä»¥ä¸‹è„šæœ¬å¯ä»¥å®æ—¶æ˜¾ç¤ºæŒ‡å®šç½‘å¡çš„æµå…¥å’Œæµå‡ºæµé‡ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">NIC</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">" In ------ Out"</span><span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token assign-left variable">OLD_IN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'$0~"'</span>$NIC<span class="token string">'"{print $2}'</span> /proc/net/dev<span class="token variable">)</span></span>    <span class="token assign-left variable">OLD_OUT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'$0~"'</span>$NIC<span class="token string">'"{print $10}'</span> /proc/net/dev<span class="token variable">)</span></span>    <span class="token function">sleep</span> <span class="token number">1</span>    <span class="token assign-left variable">NEW_IN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span>  <span class="token string">'$0~"'</span>$NIC<span class="token string">'"{print $2}'</span> /proc/net/dev<span class="token variable">)</span></span>    <span class="token assign-left variable">NEW_OUT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'$0~"'</span>$NIC<span class="token string">'"{print $10}'</span> /proc/net/dev<span class="token variable">)</span></span>    <span class="token assign-left variable">IN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">"%.1f%s"</span> "<span class="token punctuation">$((</span><span class="token punctuation">(</span>$NEW_IN-$OLD_IN<span class="token punctuation">)</span>/1024<span class="token variable">)</span></span><span class="token punctuation">)</span><span class="token string">" "</span>KB/s<span class="token string">")    OUT=<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">"%.1f%s"</span> "<span class="token punctuation">$((</span><span class="token punctuation">(</span>$NEW_OUT-$OLD_OUT<span class="token punctuation">)</span>/1024<span class="token variable">)</span></span>)"</span> <span class="token string">"KB/s"</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$IN</span> <span class="token variable">$OUT</span>"</span>    <span class="token function">sleep</span> <span class="token number">1</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡è¯»å– <code>/proc/net/dev</code> æ–‡ä»¶ï¼Œè¯¥è„šæœ¬è®¡ç®—äº†ç½‘å¡åœ¨ä¸€ç§’é’Ÿå†…çš„æ•°æ®æµå…¥å’Œæµå‡ºé‡ï¼Œå¹¶ä»¥KB/sä¸ºå•ä½å±•ç¤ºã€‚</p><h2 id="å››ã€Linuxç³»ç»Ÿå‘é€å‘Šè­¦è„šæœ¬"><a href="#å››ã€Linuxç³»ç»Ÿå‘é€å‘Šè­¦è„šæœ¬" class="headerlink" title="å››ã€Linuxç³»ç»Ÿå‘é€å‘Šè­¦è„šæœ¬"></a>å››ã€Linuxç³»ç»Ÿå‘é€å‘Šè­¦è„šæœ¬</h2><h3 id="èƒŒæ™¯ä»‹ç»-3"><a href="#èƒŒæ™¯ä»‹ç»-3" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>å½“æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œèƒ½å¦åŠæ—¶æ”¶åˆ°å‘Šè­¦ï¼Œç›´æ¥å…³ç³»åˆ°é—®é¢˜å¤„ç†çš„æ—¶æ•ˆæ€§ã€‚é…ç½®ä¸€ä¸ªèƒ½è‡ªåŠ¨å‘é€å‘Šè­¦é‚®ä»¶çš„è„šæœ¬ï¼Œå¯¹äºè¿ç»´äººå‘˜è€Œè¨€æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p><h3 id="é…ç½®é‚®ä»¶å‘é€ç¯å¢ƒ"><a href="#é…ç½®é‚®ä»¶å‘é€ç¯å¢ƒ" class="headerlink" title="é…ç½®é‚®ä»¶å‘é€ç¯å¢ƒ"></a>é…ç½®é‚®ä»¶å‘é€ç¯å¢ƒ</h3><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mailxå‘½ä»¤å‘é€é‚®ä»¶ã€‚é¦–å…ˆï¼Œéœ€è¦å®‰è£…mailxå¹¶é…ç½®é‚®ä»¶å‘é€å‚æ•°ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># yum install mailx</span><span class="token comment"># vi /etc/mail.rc</span><span class="token builtin class-name">set</span> <span class="token assign-left variable">from</span><span class="token operator">=</span>baojingtongzhi@163.com <span class="token assign-left variable">smtp</span><span class="token operator">=</span>smtp.163.com<span class="token builtin class-name">set</span> smtp-auth-user<span class="token operator">=</span>baojingtongzhi@163.com smtp-auth-password<span class="token operator">=</span><span class="token number">123456</span><span class="token builtin class-name">set</span> smtp-auth<span class="token operator">=</span>login<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡é…ç½® <code>/etc/mail.rc</code> æ–‡ä»¶ï¼Œè®¾ç½®å‘ä»¶äººé‚®ç®±ã€SMTPæœåŠ¡å™¨ã€è®¤è¯ç”¨æˆ·ç­‰ä¿¡æ¯ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨mailxå‘½ä»¤å‘é€é‚®ä»¶äº†ã€‚</p><h2 id="äº”ã€Nginxè®¿é—®æ—¥å¿—æŒ‰å¤©åˆ‡å‰²ä¸åˆ†æ"><a href="#äº”ã€Nginxè®¿é—®æ—¥å¿—æŒ‰å¤©åˆ‡å‰²ä¸åˆ†æ" class="headerlink" title="äº”ã€Nginxè®¿é—®æ—¥å¿—æŒ‰å¤©åˆ‡å‰²ä¸åˆ†æ"></a>äº”ã€Nginxè®¿é—®æ—¥å¿—æŒ‰å¤©åˆ‡å‰²ä¸åˆ†æ</h2><h3 id="èƒŒæ™¯ä»‹ç»-4"><a href="#èƒŒæ™¯ä»‹ç»-4" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>å¯¹äºä»»ä½•åœ¨çº¿æœåŠ¡è€Œè¨€ï¼Œæ—¥å¿—æ–‡ä»¶éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚å®ƒä»¬è®°å½•äº†æœåŠ¡çš„è¿è¡ŒçŠ¶å†µå’Œç”¨æˆ·çš„è¡Œä¸ºã€‚ç„¶è€Œï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼Œä¸ä»…å ç”¨ç£ç›˜ç©ºé—´ï¼Œè€Œä¸”è¿˜ä¼šå½±å“æ—¥å¿—æŸ¥æ‰¾çš„æ•ˆç‡ã€‚å› æ­¤ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ‡å‰²å’Œåˆ†ææ—¥å¿—æ–‡ä»¶æ˜¯éå¸¸å¿…è¦çš„ã€‚</p><h3 id="æ—¥å¿—åˆ‡å‰²è„šæœ¬"><a href="#æ—¥å¿—åˆ‡å‰²è„šæœ¬" class="headerlink" title="æ—¥å¿—åˆ‡å‰²è„šæœ¬"></a>æ—¥å¿—åˆ‡å‰²è„šæœ¬</h3><p>é€šè¿‡ä»¥ä¸‹è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°Nginxè®¿é—®æ—¥å¿—çš„æŒ‰å¤©åˆ‡å‰²ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">LOG_DIR</span><span class="token operator">=</span>/usr/local/nginx/logs<span class="token assign-left variable">YESTERDAY_TIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"yesterday"</span> +%F<span class="token variable">)</span></span><span class="token assign-left variable">LOG_MONTH_DIR</span><span class="token operator">=</span><span class="token variable">$LOG_DIR</span>/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">"%Y-%m"</span><span class="token variable">)</span></span><span class="token assign-left variable">LOG_FILE_LIST</span><span class="token operator">=</span><span class="token string">"default.access.log"</span><span class="token keyword">for</span> <span class="token for-or-select variable">LOG_FILE</span> <span class="token keyword">in</span> <span class="token variable">$LOG_FILE_LIST</span><span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$LOG_MONTH_DIR</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$LOG_MONTH_DIR</span>    <span class="token function">mv</span> <span class="token variable">$LOG_DIR</span>/<span class="token variable">$LOG_FILE</span> <span class="token variable">$LOG_MONTH_DIR</span>/<span class="token variable">${LOG_FILE}</span>_<span class="token variable">${YESTERDAY_TIME}</span><span class="token keyword">done</span><span class="token function">kill</span> <span class="token parameter variable">-USR1</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /var/run/nginx.pid<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¥è„šæœ¬ä¼šå°†æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‰æœˆåˆ†ç±»çš„ç›®å½•ä¸­ï¼Œå¹¶ä»¥æ˜¨å¤©çš„æ—¥æœŸä¸ºæ–‡ä»¶ååç¼€ï¼Œç„¶åé€šè¿‡å‘é€USR1ä¿¡å·ç»™Nginxä¸»è¿›ç¨‹ï¼Œæ— éœ€é‡æ–°å¯åŠ¨Nginxå³å¯ç”Ÿæ•ˆã€‚</p><h3 id="æ—¥å¿—åˆ†æè„šæœ¬"><a href="#æ—¥å¿—åˆ†æè„šæœ¬" class="headerlink" title="æ—¥å¿—åˆ†æè„šæœ¬"></a>æ—¥å¿—åˆ†æè„šæœ¬</h3><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è®¿é—®æ¨¡å¼ï¼Œä»¥ä¸‹è„šæœ¬æä¾›äº†ä¸€ç§Nginxæ—¥å¿—çš„åˆ†ææ–¹æ³•ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># æ—¥å¿—æ ¼å¼: $remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"</span><span class="token assign-left variable">LOG_FILE</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token builtin class-name">echo</span> <span class="token string">"ç»Ÿè®¡è®¿é—®æœ€å¤šçš„10ä¸ªIP"</span><span class="token function">awk</span> <span class="token string">'{a[$1]++}END{print "UV:",length(a);for(v in a)print v,a[v]}'</span> <span class="token variable">$LOG_FILE</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k2</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-10</span><span class="token builtin class-name">echo</span> <span class="token string">"----------------------"</span><span class="token builtin class-name">echo</span> <span class="token string">"ç»Ÿè®¡æ—¶é—´æ®µè®¿é—®æœ€å¤šçš„IP"</span><span class="token function">awk</span> <span class="token string">'$4&gt;="[01/Dec/2018:13:20:25" &amp;&amp; $4&lt;="[27/Nov/2018:16:20:49"{a[$1]++}END{for(v in a)print v,a[v]}'</span> <span class="token variable">$LOG_FILE</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k2</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-10</span><span class="token builtin class-name">echo</span> <span class="token string">"----------------------"</span><span class="token builtin class-name">echo</span> <span class="token string">"ç»Ÿè®¡è®¿é—®æœ€å¤šçš„10ä¸ªé¡µé¢"</span><span class="token function">awk</span> <span class="token string">'{a[$7]++}END{print "PV:",length(a);for(v in a){if(a[v]&gt;10)print v,a[v]}}'</span> <span class="token variable">$LOG_FILE</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k2</span> <span class="token parameter variable">-nr</span><span class="token builtin class-name">echo</span> <span class="token string">"----------------------"</span><span class="token builtin class-name">echo</span> <span class="token string">"ç»Ÿè®¡è®¿é—®é¡µé¢çŠ¶æ€ç æ•°é‡"</span><span class="token function">awk</span> <span class="token string">'{a[$7" "$9]++}END{for(v in a){if(a[v]&gt;5)print v,a[v]}}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªè„šæœ¬å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿä»æ—¥å¿—ä¸­æŒ–æ˜å‡ºè®¿é—®é‡æœ€å¤šçš„IPã€é«˜é¢‘æ—¶é—´æ®µã€çƒ­é—¨é¡µé¢ä»¥åŠçŠ¶æ€ç åˆ†å¸ƒç­‰å…³é”®ä¿¡æ¯ï¼Œå¯¹äºåˆ†æå’Œä¼˜åŒ–ç½‘ç«™æ€§èƒ½å…·æœ‰é‡è¦å‚è€ƒä»·å€¼ã€‚</p><p>é€šè¿‡è¿™äº›è„šæœ¬ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æé«˜æ•°æ®å®‰å…¨å’ŒæœåŠ¡ç¨³å®šæ€§ï¼Œè¿˜å¯ä»¥æœ‰æ•ˆç®¡ç†æ—¥å¿—æ–‡ä»¶ï¼ŒåŠæ—¶å‘ç°å¹¶å¤„ç†é—®é¢˜ã€‚å¸Œæœ›è¿™äº›å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim ç¼–è¾‘å™¨ï¼šé«˜æ•ˆæ–‡æœ¬ç¼–è¾‘çš„ç‘å£«å†›åˆ€</title>
      <link href="posts/3325b0d1.html"/>
      <url>posts/3325b0d1.html</url>
      
        <content type="html"><![CDATA[<p>Vimï¼Œä½œä¸ºç¼–ç¨‹å’Œç³»ç»Ÿç®¡ç†ä¸­çš„å¼ºå¤§å·¥å…·ï¼Œä»¥å…¶ä¸°å¯Œçš„åŠŸèƒ½å’Œé«˜åº¦å¯å®šåˆ¶æ€§è‘—ç§°ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ Vim çš„ä¸€äº›é«˜æ•ˆä½¿ç”¨æŠ€å·§ï¼Œä»æ‰“å¼€æ–‡ä»¶çš„å¿«æ·æ–¹æ³•åˆ°æ–‡æœ¬ç¼–è¾‘ã€æŸ¥æ‰¾ã€æ›¿æ¢ã€åˆ é™¤å’Œå¤åˆ¶çš„é«˜çº§æŠ€å·§ï¼Œå†åˆ° Vim é…ç½®å’Œæ’ä»¶å®‰è£…ï¼Œå¸®åŠ©ä½ æå‡ Vim ä½¿ç”¨æŠ€èƒ½ã€‚</p><h2 id="vim-æ‰“å¼€æ–‡ä»¶çš„å¿«æ·æ–¹æ³•"><a href="#vim-æ‰“å¼€æ–‡ä»¶çš„å¿«æ·æ–¹æ³•" class="headerlink" title="vim æ‰“å¼€æ–‡ä»¶çš„å¿«æ·æ–¹æ³•"></a>vim æ‰“å¼€æ–‡ä»¶çš„å¿«æ·æ–¹æ³•</h2><p>Vim æä¾›äº†å¤šç§æ‰“å¼€æ–‡ä»¶çš„é€‰é¡¹ï¼Œè®©ä½ çš„å·¥ä½œæ›´åŠ é«˜æ•ˆï¼š</p><table><thead><tr><th>vim ä½¿ç”¨çš„é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>vim -r filename</td><td>æ¢å¤ä¸Šæ¬¡ vim æ‰“å¼€æ—¶å´©æºƒçš„æ–‡ä»¶</td></tr><tr><td>vim + filename</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç½®äºæœ€åä¸€è¡Œçš„é¦–éƒ¨</td></tr><tr><td>vim +n filename</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç½®äºç¬¬ n è¡Œçš„é¦–éƒ¨</td></tr><tr><td>vim +/pattern filename</td><td>æ‰“å¹µæ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç½®äºç¬¬ä¸€ä¸ªä¸ pattern åŒ¹é…çš„ä½ç½®</td></tr><tr><td>vim -c command filename</td><td>åœ¨å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¾‘å‰ï¼Œå…ˆæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤</td></tr></tbody></table><h2 id="å‘½ä»¤è¡Œæ¨¡å¼ä¸‹çš„å¸¸ç”¨å‘½ä»¤"><a href="#å‘½ä»¤è¡Œæ¨¡å¼ä¸‹çš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å‘½ä»¤è¡Œæ¨¡å¼ä¸‹çš„å¸¸ç”¨å‘½ä»¤"></a>å‘½ä»¤è¡Œæ¨¡å¼ä¸‹çš„å¸¸ç”¨å‘½ä»¤</h2><p>Vim çš„å‘½ä»¤è¡Œæ¨¡å¼æä¾›äº†ä¸°å¯Œçš„å¿«æ·å‘½ä»¤ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>set nu</td><td>æ˜¾ç¤ºè¡Œå·</td></tr><tr><td>set nonu</td><td>å–æ¶ˆæ˜¾ç¤ºè¡Œå·</td></tr><tr><td>set ic</td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td>set noic</td><td>å–æ¶ˆå¿½ç•¥å¤§å°å†™</td></tr><tr><td>yy</td><td>å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œ</td></tr><tr><td>p</td><td>ç²˜è´´</td></tr><tr><td>u</td><td>æ’¤é”€</td></tr><tr><td>ctrl + r</td><td>åæ’¤é”€ï¼ˆæ¢å¤æ’¤é”€ï¼‰</td></tr><tr><td>ctrl+d</td><td>ç¿»é¡µ å‘ä¸‹ç¿»</td></tr><tr><td>ctrl+b</td><td>ç¿»é¡µ å‘ä¸Šç¿»</td></tr><tr><td>/å…³é”®å­—</td><td>æŸ¥æ‰¾</td></tr><tr><td>dd</td><td>åˆ é™¤å½“å‰è¡Œ</td></tr><tr><td>x</td><td>åˆ é™¤å•ä¸ªå­—ç¬¦</td></tr><tr><td>o ï¼ˆå°å†™ï¼‰</td><td>ä¸‹è¡Œæ’å…¥</td></tr><tr><td>O ï¼ˆå¤§å†™ shift +oï¼‰</td><td>ä¸Šè¡Œæ’å…¥</td></tr><tr><td>a</td><td>å­—ç¬¦åæ’å…¥</td></tr><tr><td>A</td><td>è¡Œæœ«æ’å…¥</td></tr><tr><td>æ•°å­— 0 æˆ–è€… ^</td><td>å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œé¦–</td></tr><tr><td>$</td><td>å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œå°¾</td></tr><tr><td>gg</td><td>å…‰æ ‡ç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´</td></tr><tr><td>G</td><td>å…‰æ ‡ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾</td></tr></tbody></table><h3 id="vim-æŸ¥æ‰¾æ–‡æœ¬"><a href="#vim-æŸ¥æ‰¾æ–‡æœ¬" class="headerlink" title="vim æŸ¥æ‰¾æ–‡æœ¬"></a>vim æŸ¥æ‰¾æ–‡æœ¬</h3><p>è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²æ˜¯ä¸¥æ ¼åŒºåˆ†å¤§å°å†™çš„ï¼Œæ¯”å¦‚éœ€è¦æŸ¥æ‰¾ <code>alex</code> å’Œ <code>Alex</code> ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ</p><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>/abc</td><td>ä»å…‰æ ‡æ‰€åœ¨ä½ç½®å‘å‰æŸ¥æ‰¾å­—ç¬¦ä¸² abc</td></tr><tr><td>/^abc</td><td>æŸ¥æ‰¾ä»¥ abc ä¸ºè¡Œé¦–çš„è¡Œ</td></tr><tr><td>/abc$</td><td>æŸ¥æ‰¾ä»¥ abc ä¸ºè¡Œå°¾çš„è¡Œ</td></tr><tr><td>?abc</td><td>ä»å…‰æ ‡æ‰€åœ¨ä¸ºä¸»å‘åæŸ¥æ‰¾å­—ç¬¦ä¸² abc</td></tr><tr><td>n</td><td>å‘åŒä¸€æ–¹å‘é‡å¤ä¸Šæ¬¡çš„æŸ¥æ‰¾æŒ‡ä»¤</td></tr><tr><td>N</td><td>å‘ç›¸åæ–¹å‘é‡å¤ä¸Šæ¬¡çš„æŸ¥æ‰¾æŒ‡å®š</td></tr></tbody></table><h3 id="vim-æ›¿æ¢æ–‡æœ¬"><a href="#vim-æ›¿æ¢æ–‡æœ¬" class="headerlink" title="vim æ›¿æ¢æ–‡æœ¬"></a>vim æ›¿æ¢æ–‡æœ¬</h3><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>r</td><td>æ›¿æ¢å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦</td></tr><tr><td>R</td><td>ä»å…‰æ ‡æ‰€åœ¨ä½ç½®å¼€å§‹æ›¿æ¢å­—ç¬¦ï¼Œå…¶è¾“å…¥å†…å®¹ä¼šè¦†ç›–æ‰åé¢ç­‰é•¿çš„æ–‡æœ¬å†…å®¹ï¼ŒæŒ‰â€œEscâ€å¯ä»¥ç»“æŸ</td></tr><tr><td>:s/a1/a2/g</td><td>å°†å½“å‰å…‰æ ‡æ‰€åœ¨è¡Œä¸­çš„æ‰€æœ‰ a1 ç”¨ a2 æ›¿æ¢</td></tr><tr><td>:n1,n2s/a1/a2/g</td><td>å°†æ–‡ä»¶ä¸­ n1 åˆ° n2 è¡Œä¸­æ‰€æœ‰ a1 éƒ½ç”¨ a2 æ›¿æ¢</td></tr><tr><td>:g/a1/a2/g</td><td>å°†æ–‡ä»¶ä¸­æ‰€æœ‰çš„ a1 éƒ½ç”¨ a2 æ›¿æ¢</td></tr></tbody></table><h3 id="vim-åˆ é™¤æ–‡æœ¬"><a href="#vim-åˆ é™¤æ–‡æœ¬" class="headerlink" title="vim åˆ é™¤æ–‡æœ¬"></a>vim åˆ é™¤æ–‡æœ¬</h3><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>x</td><td>åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦</td></tr><tr><td>dd</td><td>åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œ</td></tr><tr><td>ndd</td><td>åˆ é™¤å½“å‰è¡Œï¼ˆåŒ…æ‹¬æ­¤è¡Œï¼‰å n è¡Œæ–‡æœ¬</td></tr><tr><td>dG</td><td>åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œä¸€ç›´åˆ°æ–‡ä»¶æœ«å°¾çš„æ‰€æœ‰å†…å®¹</td></tr><tr><td>D</td><td>åˆ é™¤å…‰æ ‡ä½ç½®åˆ°è¡Œå°¾çš„å†…å®¹</td></tr></tbody></table><h3 id="å¤åˆ¶æ–‡æœ¬"><a href="#å¤åˆ¶æ–‡æœ¬" class="headerlink" title="å¤åˆ¶æ–‡æœ¬"></a>å¤åˆ¶æ–‡æœ¬</h3><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>p</td><td>å°†å‰ªè´´æ¿ä¸­çš„å†…å®¹ç²˜è´´åˆ°å…‰æ ‡å</td></tr><tr><td>Pï¼ˆå¤§å†™ï¼‰</td><td>å°†å‰ªè´´æ¿ä¸­çš„å†…å®¹ç²˜è´´åˆ°å…‰æ ‡å‰</td></tr><tr><td>y</td><td>å¤åˆ¶å·²é€‰ä¸­çš„æ–‡æœ¬åˆ°å‰ªè´´æ¿</td></tr><tr><td>yy</td><td>å°†å…‰æ ‡æ‰€åœ¨è¡Œå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œæ­¤å‘½ä»¤å‰å¯ä»¥åŠ æ•°å­— nï¼Œå¯å¤åˆ¶å¤šè¡Œ</td></tr><tr><td>yw</td><td>å°†å…‰æ ‡ä½ç½®çš„å•è¯å¤åˆ¶åˆ°å‰ªè´´æ¿</td></tr></tbody></table><h2 id="é…ç½®é…ç½®æ–‡ä»¶-vim-vimrc"><a href="#é…ç½®é…ç½®æ–‡ä»¶-vim-vimrc" class="headerlink" title="é…ç½®é…ç½®æ–‡ä»¶ ~/.vim/vimrc"></a>é…ç½®é…ç½®æ–‡ä»¶ <code>~/.vim/vimrc</code></h2><pre class="line-numbers language-none"><code class="language-none"># å°† leader é”®æ›´æ”¹ä¸ºç©ºæ ¼é”®let mapleader=" "# å¢åŠ å…¼å®¹æ€§çš„å¸¸è§„è®¾ç½®set nocompatiblefiletype onfiletype indent onfiletype plugin onfiletype plugin indent on# è®© vim ç¼–è¾‘å™¨å¯ä»¥ä½¿ç”¨é¼ æ ‡set mouse=a# è®¾ç½®ç¼–ç æ ¼å¼# set encoding=utf-8# æœ‰äº›ç»ˆç«¯é¢œè‰²å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼ŒåŠ ä¸Šè¿™ä¸€è¡Œä¹‹åå°±ä¼šå¥½å¾ˆå¤šlet &amp;t_ut=''# æŒ‰ä¸€ä¸‹ tab é”®ï¼Œç¼©è¿›ä¸º 4 ä¸ªç©ºæ ¼set expandtabset tabstop=4set shiftwidth=4set softtabstop=4# æ˜¾ç¤ºé«˜äº®syntax on# æ˜¾ç¤ºè¡Œå·set number# æ˜¾ç¤ºå½“å‰æ´»åŠ¨è¡Œå·set relativenumber# å½“å‰å…‰æ ‡å¤„ï¼Œæ˜¾ç¤ºä¸€æ¡æ¨ªçº¿set cursorline# å½“å‰è¡Œä¸ä¼šè¶…å‡ºå½“å‰çª—å£ï¼Œè‡ªåŠ¨æ¢è¡Œset wrap# æ˜¾ç¤ºæŒ‰é”®è¾“å‡ºset showcmd# æç¤ºset wildmenu# æœç´¢è¯é«˜äº® high light searchset hlsearch# è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆé«˜äº®exec "nohlsearch"# è¾¹è¾“å…¥ï¼Œè¾¹é«˜äº®set incsearch# æœç´¢æ—¶ï¼Œå¿½ç•¥å¤§å°å†™set ignorecase# æ™ºèƒ½å¤§å°å†™set smartcase# è®¾ç½®é”®ç›˜æ˜ å°„# å°† n é”®æ˜ å°„ä¸º h ä¹Ÿå°±æ˜¯è¯´å½“æŒ‰äº† n é”®ï¼Œç›¸å½“äºæŒ‰äº† h é”®noremap n h# è®¾ç½®å¿«æ·æŒ‡ä»¤# åˆ é™¤å°å†™ s é”®å¯¹åº”çš„åŠŸèƒ½map s &lt;nop&gt;# æŒ‰äº†å¤§å†™ s é”®ï¼Œç›¸å½“äº `:w å›è½¦` å³ä¸ºå¿«æ·ä¿å­˜æ–‡ä»¶æŒ‡ä»¤map S :w&lt;CR&gt;# é€€å‡ºmap Q :q&lt;CR&gt;# é‡æ–°åŠ è½½ vim é…ç½®æ–‡ä»¶map R :source $MYVIMRC&lt;CR&gt;# å‘å³åˆ†å±map sl :set splitright&lt;CR&gt;:vsplit&lt;CR&gt;# å‘å·¦åˆ†å±map sh :set nosplitright&lt;CR&gt;:vsplit&lt;CR&gt;# å‘ä¸Šåˆ†å±map sk :set nosplitbelow&lt;CR&gt;:split&lt;CR&gt;# å‘ä¸‹åˆ†å±map sj :set splitbelow&lt;CR&gt;:split&lt;CR&gt;# å½“å‰å±ï¼Œçºµå‘åˆ†å±map sv &lt;C-w&gt;t&lt;C-w&gt;H# å½“å‰å±ï¼Œæ¨ªå‘åˆ†å±map sb &lt;C-w&gt;t&lt;C-w&gt;K# å½“å‰é…ç½®æ–‡ä»¶æœ€ä¸Šæ–¹å·²ç»å°† leader é”®æ›´æ”¹ä¸ºç©ºæ ¼é”®ï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ˜¯ ç©ºæ ¼+k ä»£æ›¿äº† Ctrl+w# åˆ†å±ä¹‹åï¼Œå…‰æ ‡å‘ä¸Šç§»åŠ¨map &lt;LEADER&gt;k &lt;C-w&gt;k# åˆ†å±ä¹‹åï¼Œå…‰æ ‡å‘ä¸‹ç§»åŠ¨map &lt;LEADER&gt;j &lt;C-w&gt;j# åˆ†å±ä¹‹åï¼Œå…‰æ ‡å‘å·¦ç§»åŠ¨map &lt;LEADER&gt;h &lt;C-w&gt;h# åˆ†å±ä¹‹åï¼Œå…‰æ ‡å‘å³ç§»åŠ¨map &lt;LEADER&gt;l &lt;C-w&gt;l# æ¨ªå‘çš„åˆ†å±å¾€ä¸ŠåŠ  5map &lt;up&gt; :res +5&lt;CR&gt;# æ¨ªå‘çš„åˆ†å±å¾€ä¸‹å‡ 5map &lt;down&gt; :res -5&lt;CR&gt;# çºµå‘çš„åˆ†å±å®½åº¦å‡ 5map &lt;left&gt; :vertical resize-5&lt;CR&gt;# çºµå‘çš„åˆ†å±å®½åº¦åŠ  5map &lt;right&gt; :vertical resize+5&lt;CR&gt;# æ–°å»ºæ ‡ç­¾é¡µmap tn :tabe&lt;CR&gt;# æŸ¥çœ‹å·¦è¾¹çš„æ ‡ç­¾é¡µmap tl :-tabnext&lt;CR&gt;# æŸ¥çœ‹å³è¾¹çš„æ ‡ç­¾é¡µmap tr :+tabnext&lt;CR&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h2><p>åœ¨ <code>~/.vim/vimrc</code> é…ç½®æ–‡ä»¶ä¸­</p><pre class="line-numbers language-none"><code class="language-none">call plug#begin('~/.vim/plugged')# å®‰è£… vim-airline æ’ä»¶Plug 'vim-airline/vim-airline'# å®‰è£…é…è‰²Plug 'connorholyday/vim-snazzy'call plug#end()# è¯¦è§ https://github.com/connorholyday/vim-snazzy# è®¾ç½®é…è‰²color snazzy# è®¾ç½®é€æ˜èƒŒæ™¯let g:SnazzyTransparent = 1# ç„¶ååœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¾“å…¥# :PlugInstall<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Vim æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé€šè¿‡ç†Ÿç»ƒæŒæ¡å…¶å¿«æ·é”®å’Œé…ç½®ï¼Œä½ å¯ä»¥æå¤§æå‡ç¼–è¾‘æ•ˆç‡ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨ Vimï¼Œæˆä¸ºæ–‡æœ¬ç¼–è¾‘çš„é«˜æ‰‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell é‡å®šå‘ï¼šæ§åˆ¶æ•°æ®æµå‘çš„è‰ºæœ¯</title>
      <link href="posts/8af44f1b.html"/>
      <url>posts/8af44f1b.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Unix æˆ– Linux ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ Shell æ¥ä¸æ“ä½œç³»ç»Ÿäº¤äº’ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºæ˜¯ä¸¤ä¸ªéå¸¸åŸºç¡€ä¸”é‡è¦çš„æ“ä½œã€‚</p><p>ç†è§£å’ŒæŒæ¡è¾“å…¥è¾“å‡ºé‡å®šå‘æ˜¯æé«˜ Shell ä½¿ç”¨æ•ˆç‡çš„å…³é”®ã€‚æœ¬æ–‡æ—¨åœ¨ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€ï¼Œä¸ºä½ æ­å¼€ Shell é‡å®šå‘çš„ç¥ç§˜é¢çº±ã€‚</p><h2 id="æ ‡å‡†çš„è¾“å…¥ä¸è¾“å‡º"><a href="#æ ‡å‡†çš„è¾“å…¥ä¸è¾“å‡º" class="headerlink" title="æ ‡å‡†çš„è¾“å…¥ä¸è¾“å‡º"></a>æ ‡å‡†çš„è¾“å…¥ä¸è¾“å‡º</h2><p>åœ¨ Shell ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºçš„è¾“å…¥æ¥æºäºé”®ç›˜ï¼Œè¾“å‡ºåˆ™æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚è¿™ç§é»˜è®¤çš„è¡Œä¸ºå¯¹æˆ‘ä»¬æ—¥å¸¸çš„ä½¿ç”¨æ¥è¯´æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ›´çµæ´»åœ°æ§åˆ¶æ•°æ®çš„æµå‘ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°è¾“å…¥è¾“å‡ºé‡å®šå‘çš„æŠ€æœ¯äº†ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºé‡å®šå‘ç®€ä»‹"><a href="#è¾“å…¥è¾“å‡ºé‡å®šå‘ç®€ä»‹" class="headerlink" title="è¾“å…¥è¾“å‡ºé‡å®šå‘ç®€ä»‹"></a>è¾“å…¥è¾“å‡ºé‡å®šå‘ç®€ä»‹</h2><h3 id="è¾“å…¥é‡å®šå‘"><a href="#è¾“å…¥é‡å®šå‘" class="headerlink" title="è¾“å…¥é‡å®šå‘"></a>è¾“å…¥é‡å®šå‘</h3><p>è¾“å…¥é‡å®šå‘å…è®¸æˆ‘ä»¬å°†ç¨‹åºçš„è¾“å…¥ä»é”®ç›˜æ”¹ä¸ºæ¥è‡ªäºæ–‡ä»¶æˆ–å…¶ä»–æ•°æ®æºã€‚è¿™æ„å‘³ç€ç¨‹åºä¼šä»æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–è¾“å…¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…æˆ‘ä»¬é€šè¿‡é”®ç›˜è¾“å…¥ã€‚</p><h3 id="è¾“å‡ºé‡å®šå‘"><a href="#è¾“å‡ºé‡å®šå‘" class="headerlink" title="è¾“å‡ºé‡å®šå‘"></a>è¾“å‡ºé‡å®šå‘</h3><p>ä¸è¾“å…¥é‡å®šå‘ç›¸åï¼Œè¾“å‡ºé‡å®šå‘è®©æˆ‘ä»¬å¯ä»¥å°†ç¨‹åºçš„è¾“å‡ºå‘é€åˆ°é™¤äº†ç»ˆç«¯æ˜¾ç¤ºå™¨å¤–çš„å…¶ä»–ä½ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸­ã€‚è¿™åœ¨æˆ‘ä»¬éœ€è¦ä¿å­˜è¾“å‡ºç»“æœä»¥ä¾›åç»­å¤„ç†æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h2 id="ä¸è¾“å…¥è¾“å‡ºæœ‰å…³çš„æ–‡ä»¶æè¿°ç¬¦"><a href="#ä¸è¾“å…¥è¾“å‡ºæœ‰å…³çš„æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="ä¸è¾“å…¥è¾“å‡ºæœ‰å…³çš„æ–‡ä»¶æè¿°ç¬¦"></a>ä¸è¾“å…¥è¾“å‡ºæœ‰å…³çš„æ–‡ä»¶æè¿°ç¬¦</h2><p>åœ¨æ·±å…¥ç†è§£è¾“å…¥è¾“å‡ºé‡å®šå‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå®ƒä»£è¡¨ç€ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶çš„å¼•ç”¨ã€‚åœ¨ Shell ä¸­ï¼Œæœ‰ä¸‰ä¸ªåŸºæœ¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼š</p><ul><li><strong>0</strong> - æ ‡å‡†è¾“å…¥ï¼ˆ<code>stdin</code>ï¼‰ï¼Œé»˜è®¤ä»é”®ç›˜è¯»å–</li><li><strong>1</strong> - æ ‡å‡†è¾“å‡ºï¼ˆ<code>stdout</code>ï¼‰ï¼Œé»˜è®¤è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨</li><li><strong>2</strong> - æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆ<code>stderr</code>ï¼‰ï¼Œé»˜è®¤ä¹Ÿæ˜¯è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨</li></ul><p>äº†è§£è¿™ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹äºç†è§£æ¥ä¸‹æ¥çš„å†…å®¹è‡³å…³é‡è¦ã€‚</p><h2 id="è¾“å‡ºé‡å®šå‘-1"><a href="#è¾“å‡ºé‡å®šå‘-1" class="headerlink" title="è¾“å‡ºé‡å®šå‘"></a>è¾“å‡ºé‡å®šå‘</h2><p>è¾“å‡ºé‡å®šå‘å…è®¸æˆ‘ä»¬å°†å‘½ä»¤çš„è¾“å‡ºç»“æœä»æ ‡å‡†è¾“å‡ºï¼ˆé€šå¸¸æ˜¯å±å¹•ï¼‰é‡å®šå‘åˆ°æ–‡ä»¶ä¸­ã€‚è¿™å¯¹äºä¿å­˜å‘½ä»¤çš„æ‰§è¡Œç»“æœéå¸¸æœ‰ç”¨ã€‚</p><h3 id="Bash-æ”¯æŒçš„è¾“å‡ºé‡å®šå‘ç¬¦å·"><a href="#Bash-æ”¯æŒçš„è¾“å‡ºé‡å®šå‘ç¬¦å·" class="headerlink" title="Bash æ”¯æŒçš„è¾“å‡ºé‡å®šå‘ç¬¦å·"></a>Bash æ”¯æŒçš„è¾“å‡ºé‡å®šå‘ç¬¦å·</h3><h4 id="æ ‡å‡†è¾“å‡ºé‡å®šå‘"><a href="#æ ‡å‡†è¾“å‡ºé‡å®šå‘" class="headerlink" title="æ ‡å‡†è¾“å‡ºé‡å®šå‘"></a>æ ‡å‡†è¾“å‡ºé‡å®šå‘</h4><ul><li><code>&gt;</code> ç”¨äºå°†å‘½ä»¤çš„æ­£ç¡®è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™è¦†ç›–ã€‚</li><li><code>&gt;&gt;</code> ç”¨äºå°†å‘½ä»¤çš„æ­£ç¡®è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™è¿½åŠ ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå°† <code>echo</code> å‘½ä»¤çš„è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token operator">&gt;</span> output.txt<span class="token comment"># è¿½åŠ åˆ°æ–‡ä»¶</span><span class="token builtin class-name">echo</span> <span class="token string">"è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾"</span> <span class="token operator">&gt;&gt;</span> output.txt<span class="token comment"># é”™è¯¯è¾“å‡ºé‡å®šå‘</span><span class="token function">ls</span> not_exists <span class="token operator"><span class="token file-descriptor important">2</span>&gt;&gt;</span> error.log<span class="token comment"># åŒæ—¶ä¿å­˜è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯</span>./your_script.sh <span class="token operator">&gt;</span> output.txt <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token builtin class-name">echo</span> <span class="token string">"Hello, World!"</span> <span class="token operator">&gt;</span> hello.txt  <span class="token comment"># åˆ›å»ºæˆ–è¦†ç›– hello.txt æ–‡ä»¶</span><span class="token builtin class-name">echo</span> <span class="token string">"Another line."</span> <span class="token operator">&gt;&gt;</span> hello.txt  <span class="token comment"># è¿½åŠ å†…å®¹åˆ° hello.txt æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘"><a href="#æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘" class="headerlink" title="æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘"></a>æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘</h4><ul><li><code>2&gt;</code> ç”¨äºå°†å‘½ä»¤çš„é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™è¦†ç›–ã€‚</li><li><code>2&gt;&gt;</code> ç”¨äºå°†å‘½ä»¤çš„é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™è¿½åŠ ã€‚</li></ul><h4 id="æ­£ç¡®è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯åŒæ—¶ä¿å­˜"><a href="#æ­£ç¡®è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯åŒæ—¶ä¿å­˜" class="headerlink" title="æ­£ç¡®è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯åŒæ—¶ä¿å­˜"></a>æ­£ç¡®è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯åŒæ—¶ä¿å­˜</h4><ul><li><code>command &gt;file 2&gt;&amp;1</code> å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºéƒ½é‡å®šå‘åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¦†ç›–æ¨¡å¼ã€‚</li><li><code>command &gt;&gt;file 2&gt;&amp;1</code> åŒä¸Šï¼Œè¿½åŠ æ¨¡å¼ã€‚</li><li><code>command &gt;file1 2&gt;file2</code> å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºåˆ†åˆ«é‡å®šå‘åˆ°ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œè¦†ç›–æ¨¡å¼ã€‚</li></ul><h3 id="è¾“å…¥é‡å®šå‘-1"><a href="#è¾“å…¥é‡å®šå‘-1" class="headerlink" title="è¾“å…¥é‡å®šå‘"></a>è¾“å…¥é‡å®šå‘</h3><p>è¾“å…¥é‡å®šå‘ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ”¹å˜å‘½ä»¤çš„è¾“å…¥æ¥æºï¼Œä¸å†é™äºé”®ç›˜è¾“å…¥ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–è¾“å…¥ã€‚</p><h4 id="Bash-æ”¯æŒçš„è¾“å…¥é‡å®šå‘ç¬¦å·"><a href="#Bash-æ”¯æŒçš„è¾“å…¥é‡å®šå‘ç¬¦å·" class="headerlink" title="Bash æ”¯æŒçš„è¾“å…¥é‡å®šå‘ç¬¦å·"></a>Bash æ”¯æŒçš„è¾“å…¥é‡å®šå‘ç¬¦å·</h4><ul><li><code>&lt;</code> ç”¨äºå°†æ–‡ä»¶å†…å®¹ä½œä¸ºå‘½ä»¤çš„è¾“å…¥ã€‚</li><li><code>&lt;&lt;END</code> ä»æ ‡å‡†è¾“å…¥ï¼ˆé”®ç›˜ï¼‰è¯»å–æ•°æ®ï¼Œç›´åˆ°é‡åˆ°<code>END</code>æ ‡è®°ä¸ºæ­¢ï¼Œ<code>END</code>æ˜¯è‡ªå®šä¹‰çš„ç»ˆæ­¢å­—ç¬¦ä¸²ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>cat</code> å‘½ä»¤è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># ä½¿ç”¨è‡ªå®šä¹‰çš„åˆ†ç•Œç¬¦è¿›è¡Œè¾“å…¥</span><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">ENDè¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ–‡æœ¬è¾“å…¥ç¤ºä¾‹ã€‚END</span><span class="token function">cat</span> <span class="token operator">&lt;</span> hello.txt  <span class="token comment"># ä½¿ç”¨æ–‡ä»¶ hello.txt çš„å†…å®¹ä½œä¸º cat å‘½ä»¤çš„è¾“å…¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨è¾“å…¥è¾“å‡ºé‡å®šå‘ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ•°æ®åœ¨ç¨‹åºã€æ–‡ä»¶å’Œç»ˆç«¯ä¹‹é—´çµæ´»æµåŠ¨ã€‚æŒæ¡è¿™äº›æŠ€å·§åï¼Œä½ å°±å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°ä½¿ç”¨ Shell è¿›è¡Œå„ç§ä»»åŠ¡å¤„ç†äº†ã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ ç†è§£å’Œåº”ç”¨ Shell è¾“å…¥è¾“å‡ºé‡å®šå‘çš„åŸºæœ¬æ¦‚å¿µå’ŒæŠ€å·§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell å†…å»ºå‘½ä»¤ï¼šShell çš„å†…åœ¨é­”åŠ›</title>
      <link href="posts/a915d50b.html"/>
      <url>posts/a915d50b.html</url>
      
        <content type="html"><![CDATA[<h1 id="shell-å†…å»ºå‘½ä»¤ï¼ˆå†…ç½®å‘½ä»¤ï¼‰"><a href="#shell-å†…å»ºå‘½ä»¤ï¼ˆå†…ç½®å‘½ä»¤ï¼‰" class="headerlink" title="shell å†…å»ºå‘½ä»¤ï¼ˆå†…ç½®å‘½ä»¤ï¼‰"></a>shell å†…å»ºå‘½ä»¤ï¼ˆå†…ç½®å‘½ä»¤ï¼‰</h1><p>ä»Šå¤©æˆ‘ä»¬æ¥æ·±å…¥æŒ–æ˜ä¸€ä¸‹ Shell çš„å†…åœ¨é­”åŠ›â€”â€”å†…å»ºå‘½ä»¤ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œå†…å»ºå‘½ä»¤ä¼šæ¯”å¤–éƒ¨å‘½ä»¤æ‰§è¡Œå¾—æ›´å¿«ï¼Œæ‰§è¡Œå¤–éƒ¨å‘½ä»¤æ—¶ä¸ä½†ä¼šè§¦å‘ç£ç›˜ I/Oï¼Œè¿˜éœ€è¦ fork å‡ºä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æ¥æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåå†é€€å‡ºã€‚è€Œæ‰§è¡Œå†…å»ºå‘½ä»¤ç›¸å½“äºè°ƒç”¨å½“å‰ Shell è¿›ç¨‹çš„ä¸€ä¸ªå‡½æ•°ã€‚</p><h2 id="æ£€æŸ¥ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ˜¯å†…å»ºå‘½ä»¤"><a href="#æ£€æŸ¥ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ˜¯å†…å»ºå‘½ä»¤" class="headerlink" title="æ£€æŸ¥ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ˜¯å†…å»ºå‘½ä»¤"></a>æ£€æŸ¥ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ˜¯å†…å»ºå‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cd æ˜¯ä¸€ä¸ªå†…å»ºå‘½ä»¤</span><span class="token builtin class-name">type</span> <span class="token builtin class-name">cd</span><span class="token comment"># cd is a shell builtin</span><span class="token comment"># å¯è§ ifconfig æ˜¯ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ï¼Œå®ƒçš„ä½ç½®æ—¶ /sbin/ifconfig</span><span class="token builtin class-name">type</span> <span class="token function">ifconfig</span><span class="token comment"># ifconfig is /sbin/ifconfig</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Bash-Shell-å†…å»ºå‘½ä»¤"><a href="#Bash-Shell-å†…å»ºå‘½ä»¤" class="headerlink" title="Bash Shell å†…å»ºå‘½ä»¤"></a>Bash Shell å†…å»ºå‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>:</td><td>æ‰©å±•å‚æ•°åˆ—è¡¨ï¼Œæ‰§è¡Œé‡å®šå‘æ“ä½œ</td></tr><tr><td>.</td><td>è¯»å–å¹¶æ‰§è¡ŒæŒ‡å®šæ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼ˆåœ¨å½“å‰ shell ç¯å¢ƒä¸­ï¼‰</td></tr><tr><td>alias</td><td>ä¸ºæŒ‡å®šå‘½ä»¤å®šä¹‰ä¸€ä¸ªåˆ«å</td></tr><tr><td>bg</td><td>å°†ä½œä¸šä»¥åå°æ¨¡å¼è¿è¡Œ</td></tr><tr><td>bind</td><td>å°†é”®ç›˜åºåˆ—ç»‘å®šåˆ°ä¸€ä¸ª readline å‡½æ•°æˆ–å®</td></tr><tr><td>break</td><td>é€€å‡º forã€whileã€select æˆ– until å¾ªç¯</td></tr><tr><td>builtin</td><td>æ‰§è¡ŒæŒ‡å®šçš„ shell å†…å»ºå‘½ä»¤</td></tr><tr><td>caller</td><td>è¿”å›æ´»åŠ¨å­å‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡</td></tr><tr><td>cd</td><td>å°†å½“å‰ç›®å½•åˆ‡æ¢ä¸ºæŒ‡å®šçš„ç›®å½•</td></tr><tr><td>command</td><td>æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œæ— éœ€è¿›è¡Œé€šå¸¸çš„ shell æŸ¥æ‰¾</td></tr><tr><td>compgen</td><td>ä¸ºæŒ‡å®šå•è¯ç”Ÿæˆå¯èƒ½çš„è¡¥å…¨åŒ¹é…</td></tr><tr><td>complete</td><td>æ˜¾ç¤ºæŒ‡å®šçš„å•è¯æ˜¯å¦‚ä½•è¡¥å…¨çš„</td></tr><tr><td>compopt</td><td>ä¿®æ”¹æŒ‡å®šå•è¯çš„è¡¥å…¨é€‰é¡¹</td></tr><tr><td>continue</td><td>ç»§ç»­æ‰§è¡Œ forã€whileã€select æˆ– until å¾ªç¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£</td></tr><tr><td>declare</td><td>å£°æ˜ä¸€ä¸ªå˜é‡æˆ–å˜é‡ç±»å‹ã€‚</td></tr><tr><td>dirs</td><td>æ˜¾ç¤ºå½“å‰å­˜å‚¨ç›®å½•çš„åˆ—è¡¨</td></tr><tr><td>disown</td><td>ä»è¿›ç¨‹ä½œä¸šè¡¨ä¸­åˆªé™¤æŒ‡å®šçš„ä½œä¸š</td></tr><tr><td>echo</td><td>å°†æŒ‡å®šå­—ç¬¦ä¸²è¾“å‡ºåˆ° STDOUT</td></tr><tr><td>enable</td><td>å¯ç”¨æˆ–ç¦ç”¨æŒ‡å®šçš„å†…å»ºshellå‘½ä»¤</td></tr><tr><td>eval</td><td>å°†æŒ‡å®šçš„å‚æ•°æ‹¼æ¥æˆä¸€ä¸ªå‘½ä»¤ï¼Œç„¶åæ‰§è¡Œè¯¥å‘½ä»¤</td></tr><tr><td>exec</td><td>ç”¨æŒ‡å®šå‘½ä»¤æ›¿æ¢ shell è¿›ç¨‹</td></tr><tr><td>exit</td><td>å¼ºåˆ¶ shell ä»¥æŒ‡å®šçš„é€€å‡ºçŠ¶æ€ç é€€å‡º</td></tr><tr><td>export</td><td>è®¾ç½®å­ shell è¿›ç¨‹å¯ç”¨çš„å˜é‡</td></tr><tr><td>fc</td><td>ä»å†å²è®°å½•ä¸­é€‰æ‹©å‘½ä»¤åˆ—è¡¨</td></tr><tr><td>fg</td><td>å°†ä½œä¸šä»¥å‰å°æ¨¡å¼è¿è¡Œ</td></tr><tr><td>getopts</td><td>åˆ†ææŒ‡å®šçš„ä½ç½®å‚æ•°</td></tr><tr><td>hash</td><td>æŸ¥æ‰¾å¹¶è®°ä½æŒ‡å®šå‘½ä»¤çš„å…¨è·¯å¾„å</td></tr><tr><td>help</td><td>æ˜¾ç¤ºå¸®åŠ©æ–‡ä»¶</td></tr><tr><td>history</td><td>æ˜¾ç¤ºå‘½ä»¤å†å²è®°å½•</td></tr><tr><td>jobs</td><td>åˆ—å‡ºæ´»åŠ¨ä½œä¸š</td></tr><tr><td>kill</td><td>å‘æŒ‡å®šçš„è¿›ç¨‹ ID(PID) å‘é€ä¸€ä¸ªç³»ç»Ÿä¿¡å·</td></tr><tr><td>let</td><td>è®¡ç®—ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªå‚æ•°</td></tr><tr><td>local</td><td>åœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸå—é™çš„å˜é‡</td></tr><tr><td>logout</td><td>é€€å‡ºç™»å½• shell</td></tr><tr><td>mapfile</td><td>ä» STDIN è¯»å–æ•°æ®è¡Œï¼Œå¹¶å°†å…¶åŠ å…¥ç´¢å¼•æ•°ç»„</td></tr><tr><td>popd</td><td>ä»ç›®å½•æ ˆä¸­åˆ é™¤è®°å½•</td></tr><tr><td>printf</td><td>ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ˜¾ç¤ºæ–‡æœ¬</td></tr><tr><td>pushd</td><td>å‘ç›®å½•æ ˆæ·»åŠ ä¸€ä¸ªç›®å½•</td></tr><tr><td>pwd</td><td>æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„å</td></tr><tr><td>read</td><td>ä» STDIN è¯»å–ä¸€è¡Œæ•°æ®å¹¶å°†å…¶èµ‹ç»™ä¸€ä¸ªå˜é‡</td></tr><tr><td>readarray</td><td>ä» STDIN è¯»å–æ•°æ®è¡Œå¹¶å°†å…¶æ”¾å…¥ç´¢å¼•æ•°ç»„</td></tr><tr><td>readonly</td><td>ä» STDIN è¯»å–ä¸€è¡Œæ•°æ®å¹¶å°†å…¶èµ‹ç»™ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„å˜é‡</td></tr><tr><td>return</td><td>å¼ºåˆ¶å‡½æ•°ä»¥æŸä¸ªå€¼é€€å‡ºï¼Œè¿™ä¸ªå€¼å¯ä»¥è¢«è°ƒç”¨è„šæœ¬æå–</td></tr><tr><td>set</td><td>è®¾ç½®å¹¶æ˜¾ç¤ºç¯å¢ƒå˜é‡çš„å€¼å’Œ shell å±æ€§</td></tr><tr><td>shift</td><td>å°†ä½ç½®å‚æ•°ä¾æ¬¡å‘ä¸‹é™ä¸€ä¸ªä½ç½®</td></tr><tr><td>shopt</td><td>æ‰“å¼€/å…³é—­æ§åˆ¶ shell å¯é€‰è¡Œä¸ºçš„å˜é‡å€¼</td></tr><tr><td>source</td><td>è¯»å–å¹¶æ‰§è¡ŒæŒ‡å®šæ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼ˆåœ¨å½“å‰ shell ç¯å¢ƒä¸­ï¼‰</td></tr><tr><td>suspend</td><td>æš‚åœ Shell çš„æ‰§è¡Œï¼Œç›´åˆ°æ”¶åˆ°ä¸€ä¸ª SIGCONT ä¿¡å·</td></tr><tr><td>test</td><td>åŸºäºæŒ‡å®šæ¡ä»¶è¿”å›é€€å‡ºçŠ¶æ€ç  0 æˆ– 1</td></tr><tr><td>times</td><td>æ˜¾ç¤ºç´¯è®¡çš„ç”¨æˆ·å’Œç³»ç»Ÿæ—¶é—´</td></tr><tr><td>trap</td><td>å¦‚æœæ”¶åˆ°äº†æŒ‡å®šçš„ç³»ç»Ÿä¿¡å·ï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤</td></tr><tr><td>type</td><td>æ˜¾ç¤ºæŒ‡å®šçš„å•è¯å¦‚æœä½œä¸ºå‘½ä»¤å°†ä¼šå¦‚ä½•è¢«è§£é‡Š</td></tr><tr><td>typeset</td><td>å£°æ˜ä¸€ä¸ªå˜é‡æˆ–å˜é‡ç±»å‹ã€‚</td></tr><tr><td>ulimit</td><td>ä¸ºç³»ç»Ÿç”¨æˆ·è®¾ç½®æŒ‡å®šçš„èµ„æºçš„ä¸Šé™</td></tr><tr><td>umask</td><td>ä¸ºæ–°å»ºçš„æ–‡ä»¶å’Œç›®å½•è®¾ç½®é»˜è®¤æƒé™</td></tr><tr><td>unalias</td><td>åˆªé™¤æŒ‡å®šçš„åˆ«å</td></tr><tr><td>unset</td><td>åˆªé™¤æŒ‡å®šçš„ç¯å¢ƒå˜é‡æˆ– shell å±æ€§</td></tr><tr><td>wait</td><td>ç­‰å¾…æŒ‡å®šçš„è¿›ç¨‹å®Œæˆï¼Œå¹¶è¿”å›é€€å‡ºçŠ¶æ€ç </td></tr></tbody></table><h2 id="alias-ç»™å‘½ä»¤åˆ›å»ºåˆ«å"><a href="#alias-ç»™å‘½ä»¤åˆ›å»ºåˆ«å" class="headerlink" title="alias ç»™å‘½ä»¤åˆ›å»ºåˆ«å"></a>alias ç»™å‘½ä»¤åˆ›å»ºåˆ«å</h2><h3 id="æŸ¥çœ‹æ‰€æœ‰åˆ«å"><a href="#æŸ¥çœ‹æ‰€æœ‰åˆ«å" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰åˆ«å"></a>æŸ¥çœ‹æ‰€æœ‰åˆ«å</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œåˆ™åˆ—å‡ºå½“å‰ shell è¿›ç¨‹ä¸­æ‰€æœ‰åˆ«å</span><span class="token builtin class-name">alias</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="è®¾ç½®åˆ«å"><a href="#è®¾ç½®åˆ«å" class="headerlink" title="è®¾ç½®åˆ«å"></a>è®¾ç½®åˆ«å</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸ºè·å–å½“å‰çš„ unix æ—¶é—´æˆ³è®¾ç½®åˆ«å timestamp</span><span class="token builtin class-name">alias</span> <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token string">'date +%s'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åˆ é™¤åˆ«å"><a href="#åˆ é™¤åˆ«å" class="headerlink" title="åˆ é™¤åˆ«å"></a>åˆ é™¤åˆ«å</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ é™¤ timestamp åˆ«å</span><span class="token builtin class-name">unalias</span> timestamp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="echo-ç”¨äºåœ¨ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²"><a href="#echo-ç”¨äºåœ¨ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²" class="headerlink" title="echo ç”¨äºåœ¨ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²"></a>echo ç”¨äºåœ¨ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²</h2><p>é»˜è®¤åœ¨æœ«å°¾åŠ ä¸Šäº†æ¢è¡Œç¬¦</p><h3 id="ä¸æ¢è¡Œ"><a href="#ä¸æ¢è¡Œ" class="headerlink" title="ä¸æ¢è¡Œ"></a>ä¸æ¢è¡Œ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Alex"</span><span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">26</span><span class="token assign-left variable">height</span><span class="token operator">=</span><span class="token number">168</span><span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">62</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">${name}</span> is <span class="token variable">${age}</span> years old, "</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">${height}</span>cm in height "</span><span class="token builtin class-name">echo</span> <span class="token string">"and <span class="token variable">${weight}</span>kg in weight."</span><span class="token builtin class-name">echo</span> <span class="token string">"Thank you!"</span><span class="token comment"># Alex is 26 years old, 168cm in height and 62kg in weight.</span><span class="token comment"># Thank you!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¾“å‡ºè½¬ä¹‰å­—ç¬¦"><a href="#è¾“å‡ºè½¬ä¹‰å­—ç¬¦" class="headerlink" title="è¾“å‡ºè½¬ä¹‰å­—ç¬¦"></a>è¾“å‡ºè½¬ä¹‰å­—ç¬¦</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Alex"</span><span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">26</span><span class="token assign-left variable">height</span><span class="token operator">=</span><span class="token number">168</span><span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">62</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">${name}</span> is <span class="token variable">${age}</span> years old,<span class="token entity" title="\n">\n</span> "</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">${height}</span>cm in height "</span><span class="token builtin class-name">echo</span> <span class="token string">"and <span class="token variable">${weight}</span>kg in weight."</span><span class="token builtin class-name">echo</span> <span class="token string">"Thank you!"</span><span class="token comment"># Alex is 26 years old,</span><span class="token comment">#</span><span class="token comment"># 168cm in height and 62kg in weight.</span><span class="token comment"># Thank you!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¼ºåˆ¶ä¸æ¢è¡Œ"><a href="#å¼ºåˆ¶ä¸æ¢è¡Œ" class="headerlink" title="å¼ºåˆ¶ä¸æ¢è¡Œ"></a>å¼ºåˆ¶ä¸æ¢è¡Œ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Alex"</span><span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">26</span><span class="token assign-left variable">height</span><span class="token operator">=</span><span class="token number">168</span><span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">62</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">${name}</span> is <span class="token variable">${age}</span> years old,<span class="token entity" title="\c">\c</span> "</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">${height}</span>cm in height "</span><span class="token builtin class-name">echo</span> <span class="token string">"and <span class="token variable">${weight}</span>kg in weight."</span><span class="token builtin class-name">echo</span> <span class="token string">"Thank you!"</span><span class="token comment"># Alex is 26 years old,168cm in height</span><span class="token comment"># and 62kg in weight.</span><span class="token comment"># Thank you!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h2><table><thead><tr><th>æ ¼å¼æ›¿ä»£ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>%s</td><td>è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>%d</td><td>è¾“å‡ºä¸€ä¸ªæ•´å‹</td></tr><tr><td>%c</td><td>è¾“å‡ºä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>%f</td><td>è¾“å‡ºä¸€ä¸ªå°æ•°</td></tr><tr><td>%-10s</td><td>æŒ‡ä¸€ä¸ªå®½åº¦ä¸º 10 ä¸ªå­—ç¬¦ï¼ˆ-è¡¨ç¤ºå·¦å¯¹é½ï¼Œæ²¡æœ‰åˆ™è¡¨ç¤ºå³å¯¹é½ï¼‰ï¼Œä»»ä½•å­—ç¬¦éƒ½ä¼šè¢«æ˜¾ç¤ºåœ¨ 10 ä¸ªå­—ç¬¦å®½çš„å­—ç¬¦å†…ï¼Œå¦‚æœä¸è¶³åˆ™è‡ªåŠ¨ä»¥ç©ºæ ¼å¡«å……ï¼Œè¶…è¿‡ä¹Ÿä¼šå°†å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ã€‚</td></tr><tr><td>%-4.2f</td><td>æ ¼å¼åŒ–ä¸ºå°æ•°ï¼Œå…¶ä¸­ <code>.2</code> æŒ‡ä¿ç•™ 2 ä½å°æ•°</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token builtin class-name">printf</span> <span class="token string">"%-10s %-8s %-4s<span class="token entity" title="\n">\n</span>"</span> å§“å æ€§åˆ« ä½“é‡kg<span class="token builtin class-name">printf</span> <span class="token string">"%-10s %-8s %-4.2f<span class="token entity" title="\n">\n</span>"</span> alex ç”· <span class="token number">62.3452</span><span class="token comment"># å§“å     æ€§åˆ«   ä½“é‡kg</span><span class="token comment"># alex       ç”·      62.35</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="read-ç”¨æ¥ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®å¹¶èµ‹å€¼ç»™å˜é‡"><a href="#read-ç”¨æ¥ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®å¹¶èµ‹å€¼ç»™å˜é‡" class="headerlink" title="read ç”¨æ¥ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®å¹¶èµ‹å€¼ç»™å˜é‡"></a>read ç”¨æ¥ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®å¹¶èµ‹å€¼ç»™å˜é‡</h2><blockquote><p>å¦‚æœæ²¡æœ‰è¿›è¡Œé‡å®šå‘ï¼Œé»˜è®¤å°±æ˜¯ä»é”®ç›˜è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼›å¦‚æœè¿›è¡Œäº†é‡å®šå‘ï¼Œé‚£ä¹ˆå¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</p></blockquote><p>read å‘½ä»¤çš„ç”¨æ³•ä¸ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># options è¡¨ç¤ºé€‰é¡¹</span><span class="token comment"># variables è¡¨ç¤ºç”¨æ¥å­˜å‚¨æ•°æ®çš„å˜é‡ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ª</span><span class="token builtin class-name">read</span> <span class="token punctuation">[</span>-options<span class="token punctuation">]</span> <span class="token punctuation">[</span>variables<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>options æ”¯æŒçš„é€‰é¡¹æœ‰ï¼š</p><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-a new_array</td><td>æŠŠè¯»å–çš„æ•°æ®èµ‹å€¼ç»™æ•°ç»„ new_arrayï¼Œä»ä¸‹æ ‡ 0 å¼€å§‹ã€‚</td></tr><tr><td>-d delimiter</td><td>ç”¨å­—ç¬¦ä¸² delimiter æŒ‡å®šè¯»å–ç»“æŸçš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆè¯»å–åˆ°çš„æ•°æ®ä¸åŒ…æ‹¬ delimiterï¼‰ã€‚</td></tr><tr><td>-e</td><td>åœ¨è·å–ç”¨æˆ·è¾“å…¥çš„æ—¶å€™ï¼Œå¯¹åŠŸèƒ½é”®è¿›è¡Œç¼–ç è½¬æ¢ï¼Œä¸ä¼šç›´æ¥æ˜¾å¼åŠŸèƒ½é”®å¯¹åº”çš„å­—ç¬¦ã€‚</td></tr><tr><td>-n num</td><td>è¯»å– num ä¸ªå­—ç¬¦ï¼Œè€Œä¸æ˜¯æ•´è¡Œå­—ç¬¦ã€‚</td></tr><tr><td>-p prompt</td><td>æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼Œæç¤ºå†…å®¹ä¸º promptã€‚</td></tr><tr><td>-r</td><td>åŸæ ·è¯»å–ï¼ˆRaw modeï¼‰ï¼Œä¸æŠŠåæ–œæ å­—ç¬¦è§£é‡Šä¸ºè½¬ä¹‰å­—ç¬¦ã€‚</td></tr><tr><td>-s</td><td>é™é»˜æ¨¡å¼ï¼ˆSilent modeï¼‰ï¼Œä¸ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºè¾“å…¥çš„å­—ç¬¦ã€‚å½“è¾“å…¥å¯†ç å’Œå…¶å®ƒç¡®è®¤ä¿¡æ¯çš„æ—¶å€™ï¼Œè¿™æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</td></tr><tr><td>-t seconds</td><td>è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰åœ¨æŒ‡å®šæ—¶é—´å†…è¾“å…¥å®Œæˆï¼Œé‚£ä¹ˆ read å°†ä¼šè¿”å›ä¸€ä¸ªé 0 çš„é€€å‡ºçŠ¶æ€ï¼Œè¡¨ç¤ºè¯»å–å¤±è´¥ã€‚</td></tr><tr><td>-u fd</td><td>ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ fd ä½œä¸ºè¾“å…¥æºï¼Œè€Œä¸æ˜¯æ ‡å‡†è¾“å…¥ï¼Œç±»ä¼¼äºé‡å®šå‘ã€‚</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token comment"># ä½¿ç”¨ read å‘½ä»¤ç»™å¤šä¸ªå˜é‡èµ‹å€¼</span><span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter your name, age and city ===&gt; "</span> name age city<span class="token builtin class-name">echo</span> <span class="token string">"ä½ çš„åå­—ä¸ºï¼š<span class="token variable">${name}</span>"</span><span class="token builtin class-name">echo</span> <span class="token string">"ä½ çš„å¹´é¾„ä¸ºï¼š<span class="token variable">${age}</span>"</span><span class="token builtin class-name">echo</span> <span class="token string">"ä½ æ‰€åœ¨çš„åŸå¸‚ä¸ºï¼š<span class="token variable">${city}</span>"</span><span class="token comment"># Enter your name, age and city ===&gt; alex 26 Shanghai</span><span class="token comment"># ä½ çš„åå­—ä¸ºï¼šalex</span><span class="token comment"># ä½ çš„å¹´é¾„ä¸ºï¼š26</span><span class="token comment"># ä½ æ‰€åœ¨çš„åŸå¸‚ä¸ºï¼šShanghai</span><span class="token comment">#########################################################</span><span class="token comment">#!/bin/bash</span><span class="token comment"># åœ¨æŒ‡å®šæ—¶é—´å†…è¾“å…¥å¯†ç </span><span class="token keyword">if</span>    <span class="token builtin class-name">read</span> <span class="token parameter variable">-t</span> <span class="token number">20</span> <span class="token parameter variable">-sp</span> <span class="token string">"Enter password in 20 seconds(once) ====&gt; "</span> pass1 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token entity" title="\n">\n</span>"</span> <span class="token operator">&amp;&amp;</span> <span class="token comment"># ç¬¬ä¸€æ¬¡è¾“å…¥å¯†ç </span>    <span class="token builtin class-name">read</span> <span class="token parameter variable">-t</span> <span class="token number">20</span> <span class="token parameter variable">-sp</span> <span class="token string">"Please confirm your password again in 20 seconds ====&gt; "</span> pass2 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token entity" title="\n">\n</span>"</span> <span class="token operator">&amp;&amp;</span> <span class="token comment"># ç¡®è®¤å¯†ç </span>    <span class="token punctuation">[</span> <span class="token variable">$pass1</span> <span class="token operator">==</span> <span class="token variable">$pass2</span> <span class="token punctuation">]</span>  <span class="token comment"># åˆ¤æ–­ä¸¤æ¬¡è¾“å…¥çš„å¯†ç æ˜¯å¦ç›¸ç­‰</span><span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"your password is ok!"</span><span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Invalid password"</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="exit-ç”¨æ¥é€€å‡ºå½“å‰-shell-è¿›ç¨‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªé€€å‡ºçŠ¶æ€"><a href="#exit-ç”¨æ¥é€€å‡ºå½“å‰-shell-è¿›ç¨‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªé€€å‡ºçŠ¶æ€" class="headerlink" title="exit ç”¨æ¥é€€å‡ºå½“å‰ shell è¿›ç¨‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªé€€å‡ºçŠ¶æ€"></a>exit ç”¨æ¥é€€å‡ºå½“å‰ shell è¿›ç¨‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªé€€å‡ºçŠ¶æ€</h2><ul><li>å¯ä»¥ä½¿ç”¨ <code>$?</code> æ¥æ”¶è¿™ä¸ªé€€å‡ºçŠ¶æ€</li><li>å¯ä»¥æ¥å—ä¸€ä¸ªæ•´æ•°å€¼ä½œä¸ºå‚æ•°ï¼Œä»£è¡¨é€€å‡ºçŠ¶æ€ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤çŠ¶æ€å€¼æ˜¯ 0</li><li>é€€å‡ºçŠ¶æ€ä¸º 0 è¡¨ç¤ºæˆåŠŸï¼Œé€€å‡ºçŠ¶æ€é 0 è¡¨ç¤ºæ‰§è¡Œå‡ºé”™æˆ–å¤±è´¥</li><li>é€€å‡ºçŠ¶æ€åªèƒ½æ˜¯ä¸€ä¸ªä»‹äº <code>0~255</code> ä¹‹é—´çš„æ•´æ•°ï¼Œå…¶ä¸­åªæœ‰ 0 è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–å€¼éƒ½è¡¨ç¤ºå¤±è´¥</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token builtin class-name">echo</span> <span class="token string">"before exit"</span>  <span class="token comment"># åªä¼šè¾“å‡º before exit</span><span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token builtin class-name">echo</span> <span class="token string">"after exit"</span>  <span class="token comment"># ä¸ä¼šè¾“å‡º</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="declare-å’Œ-typeset-ç”¨æ¥è®¾ç½®å˜é‡å±æ€§"><a href="#declare-å’Œ-typeset-ç”¨æ¥è®¾ç½®å˜é‡å±æ€§" class="headerlink" title="declare å’Œ typeset ç”¨æ¥è®¾ç½®å˜é‡å±æ€§"></a>declare å’Œ typeset ç”¨æ¥è®¾ç½®å˜é‡å±æ€§</h2><blockquote><p>typeset å·²ç»è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ declare</p></blockquote><p>declare çš„ç”¨æ³•ä¸ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># - è¡¨ç¤ºè®¾ç½®å±æ€§</span><span class="token comment"># + è¡¨ç¤ºå–æ¶ˆå±æ€§</span><span class="token comment"># aAfFgilprtux è¡¨ç¤ºå…·ä½“çš„é€‰é¡¹</span><span class="token builtin class-name">declare</span> <span class="token punctuation">[</span>+/-<span class="token punctuation">]</span> <span class="token punctuation">[</span>aAfFgilprtux<span class="token punctuation">]</span> <span class="token punctuation">[</span>å˜é‡å<span class="token operator">=</span>å˜é‡å€¼<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>aAfFgilprtux æ”¯æŒçš„é€‰é¡¹æœ‰ï¼š</p><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-f [name]</td><td>åˆ—å‡ºä¹‹å‰ç”±ç”¨æˆ·åœ¨è„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°åç§°å’Œå‡½æ•°ä½“ã€‚</td></tr><tr><td>-F [name]</td><td>ä»…åˆ—å‡ºè‡ªå®šä¹‰å‡½æ•°åç§°ã€‚</td></tr><tr><td>-g name</td><td>åœ¨ Shell å‡½æ•°å†…éƒ¨åˆ›å»ºå…¨å±€å˜é‡ã€‚</td></tr><tr><td>-p [name]</td><td>æ˜¾ç¤ºæŒ‡å®šå˜é‡çš„å±æ€§å’Œå€¼ã€‚</td></tr><tr><td>-a name</td><td>å£°æ˜å˜é‡ä¸ºæ™®é€šæ•°ç»„ã€‚</td></tr><tr><td>-A name</td><td>å£°æ˜å˜é‡ä¸ºå…³è”æ•°ç»„ï¼ˆæ”¯æŒç´¢å¼•ä¸‹æ ‡ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚</td></tr><tr><td>-i name</td><td>å°†å˜é‡å®šä¹‰ä¸ºæ•´æ•°å‹ã€‚</td></tr><tr><td>-r name[=value]</td><td>å°†å˜é‡å®šä¹‰ä¸ºåªè¯»ï¼ˆä¸å¯ä¿®æ”¹å’Œåˆ é™¤ï¼‰ï¼Œç­‰ä»·äº readonly nameã€‚</td></tr><tr><td>-x name[=value]</td><td>å°†å˜é‡è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œç­‰ä»·äº export name[=value]ã€‚</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token comment"># å°†å˜é‡å£°æ˜ä¸ºæ•´æ•°å¹¶è¿›è¡Œè®¡ç®—</span><span class="token builtin class-name">declare</span> <span class="token parameter variable">-i</span> x y ret<span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token number">11</span><span class="token assign-left variable">y</span><span class="token operator">=</span><span class="token number">22</span><span class="token assign-left variable">ret</span><span class="token operator">=</span><span class="token variable">$x</span>+<span class="token variable">$y</span><span class="token builtin class-name">echo</span> <span class="token variable">$ret</span>  <span class="token comment"># 33</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†…å»ºå‘½ä»¤æ˜¯ Shell çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒä»¬æä¾›äº†å¿«é€Ÿä¸”å¼ºå¤§çš„å·¥å…·æ¥å¤„ç†æ—¥å¸¸ä»»åŠ¡ã€‚æŒæ¡è¿™äº›å†…å»ºå‘½ä»¤ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°ç¼–å†™ Shell è„šæœ¬å’Œå‘½ä»¤è¡Œç¨‹åºã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Shell å†…å»ºå‘½ä»¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell å‡½æ•°æ·±å…¥è§£æä¸å®è·µ</title>
      <link href="posts/9d11e5.html"/>
      <url>posts/9d11e5.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Shell å‡½æ•°çš„å®šä¹‰ã€å‚æ•°ä¼ é€’ã€ä»¥åŠå¦‚ä½•æ­£ç¡®è·å–å‡½æ•°è¿ç®—ç»“æœã€‚</p><p>æœ¬æ•™ç¨‹æ—¨åœ¨ä¸ºåˆšå…¥é—¨çš„æ–°æ‰‹æä¾›æ˜æ™°çš„æŒ‡å—ï¼ŒåŒæ—¶ä¹Ÿä¸ºæœ‰ä¸€å®šç¼–ç¨‹åŸºç¡€çš„å¼€å‘è€…æä¾›æ·±å…¥ç†è§£ shell å‡½æ•°çš„æœºä¼šã€‚æˆ‘ä»¬å°†é€šè¿‡å®é™…ä»£ç ç¤ºä¾‹ï¼Œé€æ­¥å±•å¼€è®¨è®ºï¼Œä»¥ç¡®ä¿æ¦‚å¿µçš„æ¸…æ™°ä¼ è¾¾å’Œç†è§£ã€‚</p><h2 id="å®šä¹‰å‡½æ•°"><a href="#å®šä¹‰å‡½æ•°" class="headerlink" title="å®šä¹‰å‡½æ•°"></a>å®šä¹‰å‡½æ•°</h2><p>åœ¨ Shell è„šæœ¬ä¸­ï¼Œå®šä¹‰å‡½æ•°çš„è¯­æ³•æœ‰å‡ ç§å½¢å¼ï¼Œå°½ç®¡å®ƒä»¬åœ¨è¡¨ç°å½¢å¼ä¸Šç•¥æœ‰ä¸åŒï¼Œä½†å®é™…ä¸Šæ˜¯ç­‰ä»·çš„ã€‚ä»¥ä¸‹æ˜¯å®šä¹‰å‡½æ•°çš„ä¸‰ç§åŸºæœ¬æ–¹å¼ï¼š</p><blockquote><p>å®šä¹‰ shell å‡½æ•°æ—¶ <strong>ä¸èƒ½</strong> æŒ‡æ˜å‚æ•°ï¼Œä½†æ˜¯åœ¨è°ƒç”¨æ—¶å´å¯ä»¥ä¼ é€’å‚æ•°ï¼Œå¹¶ä¸”ç»™å®ƒä¼ é€’ä»€ä¹ˆå‚æ•°å®ƒå°±æ¥æ”¶ä»€ä¹ˆå‚æ•°ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ ‡å‡†çš„å‡½æ•°å†™æ³•</span><span class="token keyword">function</span> <span class="token function-name function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">return</span> <span class="token string">'demo-test'</span>  <span class="token comment"># å¯ä»¥å†™ return è¯­å¥ï¼Œä¹Ÿå¯ä»¥ä¸å†™</span><span class="token punctuation">}</span><span class="token comment"># ä¹Ÿå¯ä»¥ä¸å†™ function å…³é”®å­—</span><span class="token function-name function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">return</span> <span class="token string">'demo-test'</span><span class="token punctuation">}</span><span class="token comment"># è¿˜å¯ä»¥ç›´æ¥çœç•¥æ‰å‡½æ•°ååé¢çš„å°æ‹¬å·</span><span class="token keyword">function</span> <span class="token function-name function">func</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">return</span> <span class="token string">'demo-test'</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>æ³¨æ„</strong>ï¼šåœ¨ Shell ä¸­ï¼Œ<code>return</code> è¯­å¥ç”¨äºè¿”å›å‡½æ•°çš„é€€å‡ºçŠ¶æ€ç ï¼Œè€Œéè¿”å›æ•°æ®å€¼ã€‚å¦‚æœéœ€è¦è¿”å›æ•°æ®å€¼ï¼Œé€šå¸¸æ˜¯é€šè¿‡ <code>echo</code> æˆ–è€…å…¨å±€å˜é‡çš„æ–¹å¼ã€‚</p></blockquote><h2 id="ç»™å‡½æ•°ä¼ é€’ä½ç½®å‚æ•°"><a href="#ç»™å‡½æ•°ä¼ é€’ä½ç½®å‚æ•°" class="headerlink" title="ç»™å‡½æ•°ä¼ é€’ä½ç½®å‚æ•°"></a>ç»™å‡½æ•°ä¼ é€’ä½ç½®å‚æ•°</h2><p>å½“æˆ‘ä»¬è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¯ä»¥å‘å…¶ä¼ é€’ä½ç½®å‚æ•°ã€‚åœ¨ Shell å‡½æ•°å†…éƒ¨ï¼Œè¿™äº›å‚æ•°å¯ä»¥é€šè¿‡ <code>$1</code>, <code>$2</code>, <code>$3</code> ç­‰ç‰¹æ®€å˜é‡è®¿é—®ã€‚å¦‚æœå‚æ•°æ•°é‡è¶…è¿‡ 9 ä¸ªï¼Œéœ€è¦ä½¿ç”¨èŠ±æ‹¬å·ï¼Œä¾‹å¦‚ <code>${10}</code>, <code>${11}</code>ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># å®šä¹‰å‡½æ•°</span><span class="token keyword">function</span> <span class="token function-name function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$1</span>"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$2</span>"</span>  <span class="token comment"># æ¥æ”¶ä½ç½®å‚æ•°å¹¶æ‰“å°</span><span class="token punctuation">}</span><span class="token comment"># è°ƒç”¨å‡½æ•°ï¼Œä¼ é€’ä¸¤ä¸ªå‚æ•°</span>func name alex <span class="token comment"># è¾“å‡º: name alex</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è®¡ç®—å‡½æ•°å‚æ•°çš„å’Œ"><a href="#è®¡ç®—å‡½æ•°å‚æ•°çš„å’Œ" class="headerlink" title="è®¡ç®—å‡½æ•°å‚æ•°çš„å’Œ"></a>è®¡ç®—å‡½æ•°å‚æ•°çš„å’Œ</h2><p>æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥è®¡ç®—ä¼ å…¥å‚æ•°çš„å’Œã€‚é€šè¿‡ä½¿ç”¨ç‰¹æ®Šå˜é‡ <code>$@</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ”¶å‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">100</span>  <span class="token comment"># å…¨å±€å˜é‡</span><span class="token keyword">function</span> <span class="token function-name function">cal_sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token builtin class-name">local</span> <span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">0</span>  <span class="token comment"># ä½¿ç”¨ local å…³é”®å­—å®šä¹‰å±€éƒ¨å˜é‡</span>  <span class="token keyword">for</span> <span class="token for-or-select variable">n</span> <span class="token keyword">in</span> <span class="token variable">$@</span>  <span class="token comment"># éå†æ‰€æœ‰å‚æ•°</span>  <span class="token keyword">do</span>    <span class="token variable"><span class="token punctuation">((</span>sum<span class="token operator">+=</span>n<span class="token punctuation">))</span></span>  <span class="token comment"># ç´¯åŠ å‚æ•°å€¼</span>  <span class="token keyword">done</span>  <span class="token builtin class-name">echo</span> <span class="token variable">$sum</span>  <span class="token comment"># æ‰“å°å±€éƒ¨å˜é‡ sum çš„å€¼</span>  <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token assign-left variable">total</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>cal_sum <span class="token number">10</span> <span class="token number">20</span> <span class="token number">30</span> <span class="token number">40</span><span class="token variable">)</span></span><span class="token builtin class-name">echo</span> <span class="token variable">$total</span>  <span class="token comment"># è¾“å‡º: 100</span><span class="token comment"># è¿”å›å‡½æ•°çš„é€€å‡ºçŠ¶æ€</span><span class="token builtin class-name">echo</span> <span class="token variable">$?</span>  <span class="token comment"># è¾“å‡º: 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–å‡½æ•°çš„è¿”å›å€¼"><a href="#è·å–å‡½æ•°çš„è¿”å›å€¼" class="headerlink" title="è·å–å‡½æ•°çš„è¿”å›å€¼"></a>è·å–å‡½æ•°çš„è¿”å›å€¼</h2><p>åœ¨ Shell ä¸­ï¼Œä½¿ç”¨ç‰¹æ®Šå˜é‡ <code>$?</code> å¯ä»¥è·å–ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ <code>return</code> è¿”å›å¤§äº 255 çš„æ•°å€¼æ—¶ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯ä¸€ä¸ª 8 ä½çš„æ•°ï¼ŒèŒƒå›´ä» 0 åˆ° 255ã€‚</p><p><code>$?</code> å¯ä»¥ç”¨æ¥è·å–ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œä½†ä½¿ç”¨å®ƒæ¥è·å–å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ç§é”™è¯¯çš„æ–¹å¼ã€‚è¿™æ˜¯å› ä¸º <code>$?</code> åªèƒ½æ•è·å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„ <code>return</code> è¯­å¥çš„å€¼ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">function</span> <span class="token function-name function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token builtin class-name">return</span> <span class="token variable"><span class="token variable">`</span><span class="token function">expr</span> $1 + $2<span class="token variable">`</span></span><span class="token punctuation">}</span><span class="token function">add</span> <span class="token number">11</span> <span class="token number">22</span>  <span class="token comment"># è°ƒç”¨å‡½æ•°</span><span class="token builtin class-name">echo</span> <span class="token variable">$?</span>  <span class="token comment"># è¾“å‡ºå¯èƒ½æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„è¿”å›å€¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>é‡è¦æç¤º</strong>ï¼šåœ¨ Shell ç¼–ç¨‹ä¸­ï¼Œå°† <code>$?</code> ç”¨äºè·å–å‡½æ•°çš„â€œè¿”å›å€¼â€ï¼ˆåœ¨è¿™é‡Œå®è´¨ä¸Šæ˜¯é€€å‡ºçŠ¶æ€ç ï¼‰é€šå¸¸ä¸æ˜¯è·å–å‡½æ•°æ‰§è¡Œç»“æœçš„æ­£ç¡®æ–¹æ³•ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ æƒ³è¦è·å–çš„æ˜¯å‡½æ•°å¤„ç†çš„å…·ä½“æ•°æ®ç»“æœã€‚ç›¸åï¼Œåº”è¯¥é€šè¿‡ <code>echo</code> ç­‰å‘½ä»¤å°†ç»“æœè¾“å‡ºï¼Œå¹¶åœ¨å‡½æ•°å¤–éƒ¨é€šè¿‡å‘½ä»¤æ›¿æ¢çš„æ–¹å¼å°†å…¶æ•è·åˆ°å˜é‡ä¸­ã€‚</p></blockquote><h2 id="æ­£ç¡®çš„è¿”å›å€¼è·å–æ–¹å¼"><a href="#æ­£ç¡®çš„è¿”å›å€¼è·å–æ–¹å¼" class="headerlink" title="æ­£ç¡®çš„è¿”å›å€¼è·å–æ–¹å¼"></a>æ­£ç¡®çš„è¿”å›å€¼è·å–æ–¹å¼</h2><p>è¦æ­£ç¡®è·å–å‡½æ•°çš„è¿”å›å€¼ï¼Œåº”è¯¥ä½¿ç”¨å‡½æ•°çš„ return è¯­å¥ï¼Œå¹¶åœ¨å‡½æ•°è°ƒç”¨åç«‹å³æ£€æŸ¥ <code>$?</code>ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">function</span> <span class="token function-name function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token builtin class-name">return</span> <span class="token variable"><span class="token variable">$((</span>$<span class="token number">1</span> <span class="token operator">+</span> $<span class="token number">2</span><span class="token variable">))</span></span>  <span class="token comment"># ä½¿ç”¨ $(( )) è¿›è¡Œç®—æœ¯è¿ç®—</span><span class="token punctuation">}</span><span class="token function">add</span> <span class="token number">11</span> <span class="token number">22</span>  <span class="token comment"># è°ƒç”¨å‡½æ•°</span><span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable">$?</span>  <span class="token comment"># æ­£ç¡®è·å–å‡½æ•°çš„è¿”å›å€¼</span><span class="token builtin class-name">echo</span> <span class="token variable">$result</span>  <span class="token comment"># è¾“å‡ºï¼š33</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œå¸Œæœ›ä½ èƒ½å¯¹ Shell å‡½æ•°çš„ç›¸å…³æ¦‚å¿µæœ‰äº†æ›´æ·±å…¥çš„ç†è§£ï¼Œå¹¶èƒ½åœ¨å®é™…çš„è„šæœ¬ç¼–å†™ä¸­è¿ç”¨è¿™äº›çŸ¥è¯†ã€‚è®°ä½ï¼Œå®è·µæ˜¯å­¦ä¹ çš„å…³é”®ï¼Œä¸è¦å®³æ€•å°è¯•å’ŒçŠ¯é”™ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell å˜é‡è¯¦è§£ï¼šå¦‚ä½•å®šä¹‰ã€ä½¿ç”¨å’Œç®¡ç†</title>
      <link href="posts/c60e5e2c.html"/>
      <url>posts/c60e5e2c.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç¼–å†™ Shell è„šæœ¬æ—¶ï¼Œå˜é‡æ‰®æ¼”ç€æä¸ºé‡è¦çš„è§’è‰²ã€‚å®ƒä»¬ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸´æ—¶ä¿å­˜æ•°æ®ï¼Œä»¥ä¾¿åœ¨è„šæœ¬çš„å…¶ä»–éƒ¨åˆ†ä¸­ä½¿ç”¨ã€‚</p><p>æœ¬æ–‡å°†é€šè¿‡ç®€å•çš„è¯­è¨€å’Œæ¸…æ™°çš„ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŒæ¡ Shell å˜é‡çš„åŸºç¡€çŸ¥è¯€ï¼Œæ— è®ºä½ æ˜¯åˆå­¦è€…è¿˜æ˜¯å…·å¤‡ä¸€å®šç¼–ç¨‹ç»éªŒçš„å¼€å‘è€…ï¼Œéƒ½èƒ½ä»ä¸­è·ç›Šã€‚</p><h2 id="å˜é‡çš„åŸºæœ¬è§„åˆ™"><a href="#å˜é‡çš„åŸºæœ¬è§„åˆ™" class="headerlink" title="å˜é‡çš„åŸºæœ¬è§„åˆ™"></a>å˜é‡çš„åŸºæœ¬è§„åˆ™</h2><p>åœ¨ Bash Shell ä¸­ï¼Œå˜é‡çš„å€¼é»˜è®¤ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä¸”åœ¨è¿›è¡Œå˜é‡èµ‹å€¼æ—¶ï¼Œç­‰å·<code>=</code>ä¸¤ä¾§ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</p><h3 id="å˜é‡å‘½åè§„èŒƒ"><a href="#å˜é‡å‘½åè§„èŒƒ" class="headerlink" title="å˜é‡å‘½åè§„èŒƒ"></a>å˜é‡å‘½åè§„èŒƒ</h3><ol><li>å˜é‡åå¯ç”±æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿æ„æˆï¼›</li><li>å¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼›</li><li>ä¸èƒ½ä½¿ç”¨ Shell ä¸­çš„å…³é”®å­—ï¼ˆå¯é€šè¿‡ <code>help</code> å‘½ä»¤æŸ¥çœ‹ä¿ç•™å…³é”®å­—åˆ—è¡¨ï¼‰ã€‚</li></ol><h3 id="ç‰¹æ®Šå˜é‡ä¸€è§ˆ"><a href="#ç‰¹æ®Šå˜é‡ä¸€è§ˆ" class="headerlink" title="ç‰¹æ®Šå˜é‡ä¸€è§ˆ"></a>ç‰¹æ®Šå˜é‡ä¸€è§ˆ</h3><p>ä¸‹é¢çš„è¡¨æ ¼ç®€è¦ä»‹ç»äº†å‡ ä¸ªå¸¸ç”¨çš„ç‰¹æ®Šå˜é‡åŠå…¶å«ä¹‰ï¼š</p><table><thead><tr><th>å˜é‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>$0</code></td><td>å½“å‰è„šæœ¬çš„æ–‡ä»¶å</td></tr><tr><td><code>$n</code></td><td>è„šæœ¬æˆ–å‡½æ•°çš„ç¬¬ n ä¸ªå‚æ•°ã€‚æ³¨æ„ï¼šå½“ nâ‰¥10 æ—¶ï¼Œåº”ä½¿ç”¨ <code>${n}</code> çš„æ ¼å¼</td></tr><tr><td><code>$#</code></td><td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°</td></tr><tr><td><code>$*</code></td><td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼ˆä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼‰</td></tr><tr><td><code>$@</code></td><td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼ˆä½œä¸ºç‹¬ç«‹çš„å¤šä¸ªå€¼ï¼‰</td></tr><tr><td><code>$?</code></td><td>ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€æˆ–å‡½æ•°çš„è¿”å›å€¼</td></tr><tr><td><code>$$</code></td><td>å½“å‰ Shell è¿›ç¨‹çš„ PID</td></tr><tr><td><code>$!</code></td><td>åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„ PID</td></tr></tbody></table><h2 id="å¦‚ä½•å®šä¹‰å˜é‡"><a href="#å¦‚ä½•å®šä¹‰å˜é‡" class="headerlink" title="å¦‚ä½•å®šä¹‰å˜é‡"></a>å¦‚ä½•å®šä¹‰å˜é‡</h2><p>å®šä¹‰å˜é‡çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼šä¸åŠ å¼•å·ã€å•å¼•å·å’ŒåŒå¼•å·ã€‚é€‰æ‹©å“ªç§æ–¹å¼å–å†³äºä½ å¸Œæœ›å¦‚ä½•å¤„ç†å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦å’Œå˜é‡ã€‚</p><h3 id="å•å¼•å·åŒ…å›´"><a href="#å•å¼•å·åŒ…å›´" class="headerlink" title="å•å¼•å·åŒ…å›´"></a>å•å¼•å·åŒ…å›´</h3><p>å•å¼•å·å†…çš„å†…å®¹å°†å®Œå…¨æŒ‰å­—é¢æ„ä¹‰å¤„ç†ï¼Œä¸è§£æå˜é‡æˆ–æ‰§è¡Œå‘½ä»¤ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">word</span><span class="token operator">=</span><span class="token string">'Hello $USER'</span><span class="token builtin class-name">echo</span> <span class="token variable">$word</span>  <span class="token comment"># è¾“å‡º Hello $USER å­—ç¬¦ä¸²æœ¬èº«</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŒå¼•å·åŒ…å›´"><a href="#åŒå¼•å·åŒ…å›´" class="headerlink" title="åŒå¼•å·åŒ…å›´"></a>åŒå¼•å·åŒ…å›´</h3><p>åŒå¼•å·å†…çš„å†…å®¹å¯ä»¥è§£æå˜é‡ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">word</span><span class="token operator">=</span><span class="token string">"Hello <span class="token environment constant">$USER</span>"</span><span class="token builtin class-name">echo</span> <span class="token variable">$word</span>  <span class="token comment"># è¾“å‡º Hello åè·Ÿå½“å‰ç”¨æˆ·å</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸åŠ å¼•å·"><a href="#ä¸åŠ å¼•å·" class="headerlink" title="ä¸åŠ å¼•å·"></a>ä¸åŠ å¼•å·</h3><p>ä¸åŠ å¼•å·æ—¶ï¼Œå¦‚æœå€¼ä¸­åŒ…å«ç©ºæ ¼ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå› ä¸º Shell ä¼šå°†ç©ºæ ¼åçš„å†…å®¹è§†ä¸ºå¦ä¸€ä¸ªå‘½ä»¤æˆ–å‚æ•°ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">variable</span><span class="token operator">=</span>value<span class="token builtin class-name">echo</span> <span class="token variable">${variable}</span>  <span class="token comment"># è¾“å‡º value</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨å˜é‡"><a href="#ä½¿ç”¨å˜é‡" class="headerlink" title="ä½¿ç”¨å˜é‡"></a>ä½¿ç”¨å˜é‡</h2><p>åœ¨ä½¿ç”¨å˜é‡æ—¶ï¼Œå¼ºçƒˆæ¨èå°†å˜é‡ååŒ…å›´åœ¨èŠ±æ‹¬å·<code>{}</code>ä¸­ã€‚è¿™ä¸ä»…æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œè€Œä¸”æœ‰åŠ©äºæ˜ç¡®å˜é‡çš„è¾¹ç•Œã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"alex"</span><span class="token builtin class-name">echo</span> <span class="token string">"My name is <span class="token variable">${name}</span>."</span>  <span class="token comment"># è¾“å‡º My name is alex.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¿®æ”¹å˜é‡çš„å€¼"><a href="#ä¿®æ”¹å˜é‡çš„å€¼" class="headerlink" title="ä¿®æ”¹å˜é‡çš„å€¼"></a>ä¿®æ”¹å˜é‡çš„å€¼</h2><p>å˜é‡ä¸€æ—¦å®šä¹‰åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰éœ€æ›´æ”¹å…¶å€¼ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"alex"</span><span class="token builtin class-name">echo</span> <span class="token variable">${name}</span>  <span class="token comment"># è¾“å‡º alex</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"harry"</span><span class="token builtin class-name">echo</span> <span class="token variable">${name}</span>  <span class="token comment"># è¾“å‡º harry</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å°†å‘½ä»¤çš„è¾“å‡ºèµ‹å€¼ç»™å˜é‡"><a href="#å°†å‘½ä»¤çš„è¾“å‡ºèµ‹å€¼ç»™å˜é‡" class="headerlink" title="å°†å‘½ä»¤çš„è¾“å‡ºèµ‹å€¼ç»™å˜é‡"></a>å°†å‘½ä»¤çš„è¾“å‡ºèµ‹å€¼ç»™å˜é‡</h2><p>å¯ä»¥é€šè¿‡åå¼•å·<code>`</code>æˆ– <code>$()</code> å°†å‘½ä»¤çš„è¾“å‡ºç»“æœèµ‹å€¼ç»™å˜é‡ï¼Œ<code>$()</code> æ–¹å¼å…·æœ‰å¯åµŒå¥—çš„ç‰¹æ€§ä¸”å¯è¯»æ€§æ›´å¼ºã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span><span class="token builtin class-name">echo</span> <span class="token variable">${path}</span>  <span class="token comment"># è¾“å‡ºå½“å‰ç›®å½•è·¯å¾„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¤ºä¾‹ï¼šè®¡ç®—è„šæœ¬çš„è¿è¡Œæ—¶é—´</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token assign-left variable">begin_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%s<span class="token variable">`</span></span>    <span class="token comment">#å¼€å§‹æ—¶é—´ï¼Œä½¿ç”¨``æ›¿æ¢</span><span class="token function">sleep</span> 20s                <span class="token comment">#ä¼‘çœ 20ç§’</span><span class="token assign-left variable">finish_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>  <span class="token comment">#ç»“æŸæ—¶é—´ï¼Œä½¿ç”¨$()æ›¿æ¢</span><span class="token assign-left variable">run_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>finish_time <span class="token operator">-</span> begin_time<span class="token variable">))</span></span>  <span class="token comment">#æ—¶é—´å·®</span><span class="token builtin class-name">echo</span> <span class="token string">"begin time: <span class="token variable">$begin_time</span>"</span><span class="token builtin class-name">echo</span> <span class="token string">"finish time: <span class="token variable">$finish_time</span>"</span><span class="token builtin class-name">echo</span> <span class="token string">"run time: <span class="token variable">${run_time}</span>s"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åªè¯»å˜é‡"><a href="#åªè¯»å˜é‡" class="headerlink" title="åªè¯»å˜é‡"></a>åªè¯»å˜é‡</h2><p>ä½¿ç”¨ <code>readonly</code> å‘½ä»¤å¯ä»¥å°†å˜é‡è®¾ç½®ä¸ºåªè¯»ï¼Œå°è¯•æ›´æ”¹è¿™äº›å˜é‡çš„å€¼å°†å¯¼è‡´é”™è¯¯ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"alex"</span><span class="token builtin class-name">readonly</span> name<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"ben"</span>  <span class="token comment"># å°è¯•æ‰§è¡Œå°†å¼•å‘é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ é™¤å˜é‡"><a href="#åˆ é™¤å˜é‡" class="headerlink" title="åˆ é™¤å˜é‡"></a>åˆ é™¤å˜é‡</h2><p>ä½¿ç”¨ <code>unset</code> å‘½ä»¤å¯ä»¥åˆ é™¤å˜é‡ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå‘½ä»¤ä¸èƒ½åˆ é™¤åªè¯»å˜é‡ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span><span class="token builtin class-name">unset</span> path<span class="token builtin class-name">echo</span> <span class="token variable">${path}</span>  <span class="token comment"># æ­¤æ—¶æ²¡æœ‰ä»»ä½•è¾“å‡º</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯¹ Shell å˜é‡çš„å®šä¹‰ã€ä½¿ç”¨å’Œç®¡ç†æ–¹æ³•æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨ä½ çš„è„šæœ¬ä¸­æ›´çµæ´»åœ°ä½¿ç”¨å˜é‡æ¥å­˜å‚¨å’Œä¿®æ”¹æ•°æ®äº†ã€‚</p><p>è®°å¾—å®è·µæ˜¯å­¦ä¹ çš„æœ€ä½³æ–¹å¼ï¼Œæ‰€ä»¥ä¸å¦¨åŠ¨æ‰‹å°è¯•ä¸€ä¸‹å§ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell å¾ªç¯è¯­å¥ï¼šé‡å¤ä»»åŠ¡çš„è‡ªåŠ¨åŒ–åˆ©å™¨</title>
      <link href="posts/33c4223c.html"/>
      <url>posts/33c4223c.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¤ä¸€æ—¥çš„è„šæœ¬ç¼–ç¨‹ä¸­ï¼Œå¾ªç¯è¯­å¥æ— ç–‘æ˜¯æˆ‘ä»¬æœ€å¥½çš„æœ‹å‹ã€‚é€šè¿‡å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œé‡å¤çš„ä»»åŠ¡ï¼Œæ— è®ºæ˜¯éå†æ–‡ä»¶åˆ—è¡¨ï¼Œå¤„ç†æ–‡æœ¬æ•°æ®ï¼Œè¿˜æ˜¯ç®€å•çš„æ•°å­¦è¿ç®—ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠ shell è„šæœ¬ä¸­çš„å‡ ç§å¾ªç¯è¯­å¥ï¼Œå®ƒä»¬å°†å¦‚ä½•å¸®åŠ©æˆ‘ä»¬ç®€åŒ–ç¼–ç¨‹ä»»åŠ¡ã€‚</p><h2 id="while-å¾ªç¯ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶å¾ªç¯"><a href="#while-å¾ªç¯ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶å¾ªç¯" class="headerlink" title="while å¾ªç¯ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶å¾ªç¯"></a>while å¾ªç¯ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶å¾ªç¯</h2><p><code>while</code> å¾ªç¯éå¸¸æœ‰ç”¨ï¼ŒåŸºæœ¬è¯­æ³•æ˜¯å½“æ¡ä»¶ä¸ºçœŸï¼ˆå³è¿”å›å€¼ä¸º 0ï¼‰æ—¶ï¼Œå°±æ‰§è¡Œå¾ªç¯ä½“å†…çš„è¯­å¥ã€‚ä½¿ç”¨å®ƒå¯ä»¥æ‰§è¡Œè¯¸å¦‚ä» 1 åŠ åˆ° 100 è¿™æ ·ç®€å•ä½†æœ‰è¶£çš„ä»»åŠ¡ã€‚</p><p><strong>ä¾‹å­ï¼šå®ç° 1 åˆ° 100 çš„æ±‚å’Œ</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">0</span><span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">))</span></span><span class="token keyword">do</span>  <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> i<span class="token punctuation">))</span></span>  <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token string">"The sum is ===&gt; <span class="token variable">$sum</span>"</span><span class="token comment"># è¾“å‡ºï¼šThe sum is ===&gt; 5050</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¾‹å­ï¼šå®ç°ä¸€ä¸ªç®€å•çš„åŠ æ³•è®¡ç®—å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">0</span><span class="token builtin class-name">echo</span> <span class="token string">'è¾“å…¥æ•°å­—ï¼Œè¿›è¡ŒåŠ æ³•è®¡ç®—ï¼ˆæŒ‰ä½ Ctrl + D ç»„åˆé”®è·å–ç»“æœï¼‰'</span><span class="token keyword">while</span> <span class="token builtin class-name">read</span> n<span class="token keyword">do</span>  <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> n<span class="token punctuation">))</span></span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token string">"The sum is ====&gt; <span class="token variable">$sum</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>while</code> å¾ªç¯å¦‚ä½•åœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹åå¤æ‰§è¡Œï¼Œç›´åˆ°æ¡ä»¶ä¸å†æˆç«‹ã€‚ç‰¹åˆ«æ˜¯åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† <code>read</code> å‘½ä»¤è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œè¿™åœ¨è„šæœ¬äº¤äº’ä¸­éå¸¸å¸¸è§ã€‚</p><h2 id="for-in-å¾ªç¯ï¼šéå†åˆ—è¡¨å…ƒç´ "><a href="#for-in-å¾ªç¯ï¼šéå†åˆ—è¡¨å…ƒç´ " class="headerlink" title="for-in å¾ªç¯ï¼šéå†åˆ—è¡¨å…ƒç´ "></a>for-in å¾ªç¯ï¼šéå†åˆ—è¡¨å…ƒç´ </h2><p><code>for-in</code> å¾ªç¯çš„ç”¨æ³•ä¸ Python ä¸­çš„éå¸¸ç›¸ä¼¼ï¼Œç”¨äºéå†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚è¿™ç§æ–¹å¼ç¼–å†™çš„ä»£ç å¯è¯»æ€§å¼ºï¼Œæ˜“äºç†è§£ã€‚</p><p><strong>ç›´æ¥ç»™å‡ºå…·ä½“çš„å€¼ä½œä¸ºåˆ—è¡¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> <span class="token for-or-select variable">n</span> <span class="token keyword">in</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span><span class="token keyword">do</span>  <span class="token builtin class-name">echo</span> <span class="token variable">$n</span>  <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> n<span class="token punctuation">))</span></span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token string">'The sum is '</span><span class="token variable">$sum</span><span class="token comment"># è¾“å‡ºåˆ†åˆ«ä¸º 1 2 3 4 5 6 å’Œ The sum is 21</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç»™å‡ºä¸€ä¸ªå–å€¼èŒƒå›´ä½œä¸ºåˆ—è¡¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> <span class="token for-or-select variable">n</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token keyword">do</span>  <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> n<span class="token punctuation">))</span></span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token string">"The result is <span class="token variable">${sum}</span>"</span><span class="token comment"># è¾“å‡ºï¼šThe result is 5050</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä½¿ç”¨å‘½ä»¤çš„æ‰§è¡Œç»“æœä½œä¸ºåˆ—è¡¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">for</span> <span class="token for-or-select variable">filename</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> *.sh<span class="token variable">)</span></span><span class="token keyword">do</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ä»¥ .sh ä¸ºåç¼€çš„æ–‡ä»¶ä¸º ==&gt; <span class="token variable">${filename}</span>"</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° <code>for-in</code> å¾ªç¯å¦‚ä½•é€šè¿‡ç›´æ¥åˆ—å‡ºå…ƒç´ ã€æŒ‡å®šèŒƒå›¹ã€ç”šè‡³ä½¿ç”¨å‘½ä»¤çš„è¾“å‡ºä½œä¸ºåˆ—è¡¨æ¥å®ç°å¼ºå¤§çš„éå†åŠŸèƒ½ã€‚</p><h2 id="select-in-å¾ªç¯ï¼šå¢å¼ºè„šæœ¬äº¤äº’æ€§"><a href="#select-in-å¾ªç¯ï¼šå¢å¼ºè„šæœ¬äº¤äº’æ€§" class="headerlink" title="select-in å¾ªç¯ï¼šå¢å¼ºè„šæœ¬äº¤äº’æ€§"></a>select-in å¾ªç¯ï¼šå¢å¼ºè„šæœ¬äº¤äº’æ€§</h2><p><code>select-in</code> å¾ªç¯æ˜¯è„šæœ¬ä¸­ç”¨äºäº¤äº’çš„å¼ºå¤§å·¥å…·ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªå¸¦ç¼–å·çš„èœå•ï¼Œç”¨æˆ·é€šè¿‡è¾“å…¥ç¼–å·æ¥è¿›è¡Œé€‰æ‹©ï¼Œè¿›è€Œæ‰§è¡Œä¸åŒçš„åŠŸèƒ½ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">echo</span> <span class="token string">'ä½ å–œæ¬¢å“ªç§è¿åŠ¨ï¼Ÿ'</span><span class="token keyword">select</span> <span class="token for-or-select variable">sport</span> <span class="token keyword">in</span> <span class="token string">'è¶³çƒ'</span> <span class="token string">'ç¯®çƒ'</span> <span class="token string">'ä¹’ä¹“çƒ'</span> <span class="token string">'çœ‹ç”µè§†'</span><span class="token keyword">do</span>  <span class="token builtin class-name">echo</span> <span class="token string">"ä½ é€‰æ‹©äº† <span class="token variable">$sport</span>"</span>  <span class="token builtin class-name">break</span> <span class="token comment"># åŠ ä¸Š break é€€å‡ºå¾ªç¯</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>select-in</code> å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ„å»ºç”¨æˆ·å‹å¥½çš„èœå•ç³»ç»Ÿï¼Œä½¿å¾—è„šæœ¬çš„äº¤äº’æ€§å¤§å¤§å¢å¼ºã€‚</p><p>åœ¨ç¼–å†™ shell è„šæœ¬æ—¶ï¼Œæ­£ç¡®é€‰æ‹©å¾ªç¯ç±»å‹å¯¹äºæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éå¸¸é‡è¦ã€‚</p><p>é€šè¿‡è¿™ç¯‡æ–‡ç« çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ä¸‰ç§ä¸åŒçš„å¾ªç¯æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œå¹¶èƒ½å¤Ÿåœ¨å®é™…ç¼–ç¨‹ä¸­çµæ´»åº”ç”¨å®ƒä»¬ã€‚æ¥ä¸‹æ¥ï¼Œå°±æ˜¯åœ¨ä½ è‡ªå·±çš„è„šæœ¬é¡¹ç›®ä¸­å®è·µå’Œæ¢ç´¢çš„æ—¶å€™äº†ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell åˆ¤æ–­è¯­å¥ï¼šå†³ç­–çš„è‰ºæœ¯</title>
      <link href="posts/43dbd7ab.html"/>
      <url>posts/43dbd7ab.html</url>
      
        <content type="html"><![CDATA[<p>ç¼–å†™ Shell è„šæœ¬æ—¶ï¼Œäº†è§£å¦‚ä½•æ ¹æ®ä¸åŒæ¡ä»¶æ‰§è¡Œä¸åŒçš„å‘½ä»¤æ˜¯è‡³å…³é‡è¦çš„ã€‚æœ¬æ–‡æ—¨åœ¨ä»¥ç®€å•æ˜“æ‡‚çš„è¯­è¨€ï¼Œä»‹ç» Shell è„šæœ¬ä¸­çš„é€‰æ‹©ç»“æ„â€”â€”if è¯­å¥å’Œ case in è¯­å¥ï¼Œå¸®åŠ©åˆå­¦è€…å’Œæœ‰ç»éªŒçš„å¼€å‘è€…æ·±å…¥ç†è§£ã€‚</p><h2 id="if-è¯­å¥"><a href="#if-è¯­å¥" class="headerlink" title="if è¯­å¥"></a>if è¯­å¥</h2><p>if è¯­å¥ç”¨äºåŸºäºæ¡ä»¶çš„æ‰§è¡Œã€‚åœ¨ shell ä¸­ï¼Œif è¯­å¥çš„åŸºç¡€è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> condition<span class="token keyword">then</span>  statement<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">fi</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°éœ€è¦ç›´æ¥åœ¨ if è¯­å¥åç´§æ¥ç€å†™ then çš„æƒ…å†µã€‚è¿™æ—¶ï¼Œåº”è¯¥ä½¿ç”¨åˆ†å·åˆ†éš”ï¼Œå¦åˆ™ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># åˆ†å·æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¼šå‡ºç°è¯­æ³•é”™è¯¯</span><span class="token keyword">if</span> condition<span class="token punctuation">;</span> <span class="token keyword">then</span>  statement<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="if-else-è¯­å¥"><a href="#if-else-è¯­å¥" class="headerlink" title="if else è¯­å¥"></a>if else è¯­å¥</h3><p>å½“ if è¯­å¥çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œelse éƒ¨åˆ†çš„ä»£ç å°†ä¼šè¢«æ‰§è¡Œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> condition<span class="token keyword">then</span>   statement1<span class="token keyword">else</span>   statement2<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="if-elif-else-è¯­å¥"><a href="#if-elif-else-è¯­å¥" class="headerlink" title="if elif else è¯­å¥"></a>if elif else è¯­å¥</h3><p>å¯¹äºå¤šæ¡ä»¶åˆ¤æ–­ï¼Œå¯ä»¥ä½¿ç”¨ if, elif, else ç»“æ„æ¥å®ç°ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> condition1<span class="token keyword">then</span>   statement1<span class="token keyword">elif</span> condition2<span class="token keyword">then</span>    statement2<span class="token keyword">elif</span> condition3<span class="token keyword">then</span>    statement3<span class="token comment"># å¯ä»¥æœ‰æ›´å¤šçš„ elif åˆ†æ”¯</span><span class="token keyword">else</span>   statementn<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¾“å‡ºè¯¥æ•´æ•°å¯¹åº”çš„æ˜ŸæœŸå‡ çš„è‹±æ–‡è¡¨ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">printf</span> <span class="token string">"Input integer number: "</span><span class="token builtin class-name">read</span> num<span class="token keyword">if</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Monday"</span><span class="token keyword">elif</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Tuesday"</span><span class="token keyword">elif</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Wednesday"</span><span class="token keyword">elif</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Thursday"</span><span class="token keyword">elif</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Friday"</span><span class="token keyword">elif</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">6</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Saturday"</span><span class="token keyword">elif</span> <span class="token variable"><span class="token punctuation">((</span>num<span class="token operator">==</span><span class="token number">7</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Sunday"</span><span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"error"</span><span class="token keyword">fi</span><span class="token comment"># Input integer number: 5</span><span class="token comment"># Friday</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="case-in-è¯­å¥"><a href="#case-in-è¯­å¥" class="headerlink" title="case in è¯­å¥"></a>case in è¯­å¥</h2><p>case in è¯­å¥æ˜¯ä¸€ç§æ›´ä¸ºçµæ´»çš„æ¡ä»¶åˆ†æ”¯è¯­å¥ï¼Œå®ƒèƒ½å¤ŸåŒ¹é…å…·ä½“çš„å€¼æˆ–è€…æ¨¡å¼ã€‚åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">printf</span> <span class="token string">"Input integer number: "</span><span class="token builtin class-name">read</span> num<span class="token keyword">case</span> <span class="token variable">$num</span> <span class="token keyword">in</span>  <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Monday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Tuesday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Wednesday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token number">4</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Thursday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token number">5</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Friday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Saturday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token number">7</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'Sunday'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  *<span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'error'</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="case-in-æ”¯æŒçš„ç®€å•æ­£åˆ™è¡¨è¾¾å¼"><a href="#case-in-æ”¯æŒçš„ç®€å•æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="case in æ”¯æŒçš„ç®€å•æ­£åˆ™è¡¨è¾¾å¼"></a>case in æ”¯æŒçš„ç®€å•æ­£åˆ™è¡¨è¾¾å¼</h3><ul><li><code>*</code> è¡¨ç¤ºä»»æ„å­—ç¬¦ä¸²ã€‚</li><li><code>[abc]</code> è¡¨ç¤º aã€bã€c ä¸‰ä¸ªå­—ç¬¦ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚æ¯”å¦‚ï¼Œ[15ZH] è¡¨ç¤º 1ã€5ã€Zã€H å››ä¸ªå­—ç¬¦ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</li><li><code>[m-n]</code> è¡¨ç¤ºä» m åˆ° n çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ï¼Œ[0-9] è¡¨ç¤ºä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œ[0-9a-zA-Z] è¡¨ç¤ºå­—æ¯æˆ–æ•°å­—ã€‚</li><li><code>|</code> è¡¨ç¤ºå¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼é€»è¾‘è¿ç®—ä¸­çš„æˆ–è¿ç®—ã€‚æ¯”å¦‚ï¼Œabc | xyz è¡¨ç¤ºåŒ¹é…å­—ç¬¦ä¸² â€œabcâ€ æˆ–è€… â€œxyzâ€ã€‚</li></ul><p>ä¸€ä¸ªå®é™…ä¾‹å­å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">printf</span> <span class="token string">'Input a character: '</span><span class="token builtin class-name">read</span> char<span class="token keyword">case</span> <span class="token variable">$char</span> <span class="token keyword">in</span>  <span class="token punctuation">[</span>abc<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'abc ä¸­ä»»æ„ä¸€ä¸ª'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'æ•°å­—'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  abc<span class="token operator">|</span>xyz<span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'ä¸æ˜¯ abc å°±æ˜¯ xyz'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token punctuation">[</span>,.?<span class="token operator">!</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'ç‰¹æ®Šç¬¦å·'</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span>  *<span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">'å…¶ä»–'</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€‰æ‹©ç»“æ„æ˜¯è„šæœ¬ç¼–ç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç ã€‚Shell æä¾›çš„ if è¯­å¥å’Œ case è¯­å¥å„æœ‰åƒç§‹ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦é€‰æ‹©ä½¿ç”¨ã€‚</p><p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œä½ åº”è¯¥å¯¹ Shell è„šæœ¬ä¸­çš„åˆ¤æ–­è¯­å¥æœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚æ— è®ºä½ æ˜¯åˆšå¼€å§‹å­¦ä¹ ç¼–ç¨‹ï¼Œè¿˜æ˜¯å·²ç»æœ‰ä¸€å®šçš„ç»éªŒï¼Œå¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Shell è„šæœ¬ä¸­çš„æ¡ä»¶åˆ¤æ–­åŠŸèƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell &quot;[[]]&quot; å‘½ä»¤ï¼šæ¡ä»¶åˆ¤æ–­çš„å‡çº§ç‰ˆ</title>
      <link href="posts/adfce4b0.html"/>
      <url>posts/adfce4b0.html</url>
      
        <content type="html"><![CDATA[<p>å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ Shell è„šæœ¬ä¸­çš„æ¡ä»¶åˆ¤æ–­åŠ å¼ºç‰ˆâ€”â€”<code>[[ ]]</code> å‘½ä»¤ã€‚å¦‚æœä½ å¯¹åŸºæœ¬çš„ <code>[]</code> å‘½ä»¤å·²ç»ç†Ÿæ‚‰ï¼Œé‚£ä¹ˆ <code>[[ ]]</code> å°†æ˜¯ä½ çš„ä¸‹ä¸€ä¸ªå‡çº§æŠ€èƒ½ç‚¹ã€‚</p><h2 id="å‘½ä»¤ç®€ä»‹"><a href="#å‘½ä»¤ç®€ä»‹" class="headerlink" title="[[ ]] å‘½ä»¤ç®€ä»‹"></a>[[ ]] å‘½ä»¤ç®€ä»‹</h2><p><code>[[ ]]</code> å‘½ä»¤ä¸ <code>test</code> æˆ– <code>[]</code> å‘½ä»¤ç›¸ä¼¼ï¼Œç”¨æ¥æ£€æµ‹æŸä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚ä½†å®ƒæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å­—ç¬¦ä¸²å’Œæ–‡ä»¶æ—¶ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å½“ expression æ¡ä»¶æˆç«‹æ—¶ï¼Œé€€å‡ºçŠ¶æ€ä¸º 0ï¼Œå¦åˆ™ä¸ºé 0 å€¼</span><span class="token punctuation">[</span><span class="token punctuation">[</span> expression <span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># è¡¨è¾¾å¼å·¦å³å„æœ‰ä¸€ä¸ªç©ºæ ¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="çš„ä¼˜åŠ¿"><a href="#çš„ä¼˜åŠ¿" class="headerlink" title="[[ ]] çš„ä¼˜åŠ¿"></a>[[ ]] çš„ä¼˜åŠ¿</h2><p>ç›¸æ¯”ä¼ ç»Ÿçš„ <code>[]</code>ï¼Œ<code>[[ ]]</code> æœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜åŠ¿ï¼š</p><ul><li>ä¸éœ€è¦å¯¹å˜é‡åŠ åŒå¼•å·ï¼Œå³ä½¿å˜é‡ä¸ºç©ºä¹Ÿä¸ä¼šå¯¼è‡´é”™è¯¯ã€‚</li><li>æ”¯æŒå­—ç¬¦ä¸²çš„ç›´æ¥æ¯”è¾ƒï¼Œä¸éœ€è¦å¯¹ <code>&lt;</code> æˆ– <code>&gt;</code> è¿›è¡Œè½¬ä¹‰ã€‚</li><li>æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</li></ul><h2 id="ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å’Œé€»è¾‘è¿ç®—"><a href="#ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å’Œé€»è¾‘è¿ç®—" class="headerlink" title="ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å’Œé€»è¾‘è¿ç®—"></a>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å’Œé€»è¾‘è¿ç®—</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>[[ ]]</code> è¿›è¡Œå­—ç¬¦ä¸²åˆ¤æ–­å’Œé€»è¾‘è¿ç®—çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">read</span> str1<span class="token builtin class-name">read</span> str2<span class="token comment"># æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸éœ€è¦å¯¹å˜é‡ååŠ åŒå¼•å·</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$str1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$str2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©º"</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token comment"># ç›´æ¥ä½¿ç”¨ &lt; æ¯”è¾ƒï¼Œä¸éœ€è¦è½¬ä¹‰</span><span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$str1</span> <span class="token operator">&lt;</span> <span class="token variable">$str2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">'$str1 &lt; $str2'</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">'$str1 &gt;= $str2'</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¹Ÿæ”¯æŒé€»è¾‘è¿ç®—"><a href="#ä¹Ÿæ”¯æŒé€»è¾‘è¿ç®—" class="headerlink" title="[[]] ä¹Ÿæ”¯æŒé€»è¾‘è¿ç®—"></a>[[]] ä¹Ÿæ”¯æŒé€»è¾‘è¿ç®—</h2><p>[] å’Œ [[]] å†™æ³•å¯¹æ¯”</p><table><thead><tr><th>test æˆ– []</th><th align="left">å†™æ³•æ˜¯å¦å¯¹é”™</th><th>[[]]</th><th align="left">å†™æ³•æ˜¯å¦å¯¹é”™</th></tr></thead><tbody><tr><td>[ -z â€œ$str1â€ ] || [ -z â€œ$str2â€ ]</td><td align="left">å¯¹</td><td>[[ -z $str1 ]]  || [[ -z $str2 ]]</td><td align="left">å¯¹</td></tr><tr><td>[ -z â€œ$str1â€ -o -z â€œ$str2â€ ]</td><td align="left">å¯¹</td><td>[[ -z $str1 -o -z $str2 ]]</td><td align="left">é”™ ï¼ˆ[[]] ä¸èƒ½ä½¿ç”¨ <code>-o</code> å’Œ <code>-a</code> é€‰é¡¹ï¼‰</td></tr><tr><td>[ -z $str1 || -z $str2 ]</td><td align="left">é”™ï¼ˆ[] ä¸èƒ½åœ¨å†…éƒ¨è¿›è¡Œé€»è¾‘è¿ç®—ï¼‰</td><td>[[ -z $str1 || -z $str2 ]]</td><td align="left">å¯¹</td></tr></tbody></table><h2 id="ä¸é€»è¾‘è¿ç®—"><a href="#ä¸é€»è¾‘è¿ç®—" class="headerlink" title="[[ ]] ä¸é€»è¾‘è¿ç®—"></a>[[ ]] ä¸é€»è¾‘è¿ç®—</h2><p><code>[[ ]]</code> æ”¯æŒé€»è¾‘è¿ç®—ï¼Œä½†æœ‰ä¸€äº›é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå®ƒä¸æ”¯æŒ <code>-a</code> å’Œ <code>-o</code> é€‰é¡¹ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>&amp;&amp;</code> å’Œ <code>||</code> è¿›è¡Œé€»è¾‘ä¸å’Œé€»è¾‘æˆ–ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é”™è¯¯çš„å†™æ³•ï¼Œ[[]] ä¸èƒ½ä½¿ç”¨ -o å’Œ -a é€‰é¡¹</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$str1</span> <span class="token parameter variable">-o</span> <span class="token parameter variable">-z</span> <span class="token variable">$str2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment"># æ­£ç¡®çš„å†™æ³•ï¼Œä½¿ç”¨ || ä»£æ›¿ -o</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$str1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$str2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼"><a href="#æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="[[ ]] æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼"></a>[[ ]] æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</h2><p><code>[[ ]]</code> çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§æ˜¯æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚è¿™å¯¹äºå­—ç¬¦ä¸²çš„å¤æ‚éªŒè¯éå¸¸æœ‰ç”¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç”¨æ³•</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token assign-left variable">str</span><span class="token operator">=~</span> regex <span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç¤ºä¾‹ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ‰‹æœºå·"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ‰‹æœºå·" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ‰‹æœºå·"></a>ç¤ºä¾‹ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ‰‹æœºå·</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ‰‹æœºå·çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">read</span> phone<span class="token comment"># æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…ä»¥1å¼€å¤´ï¼Œåè·Ÿ10ä¸ªæ•°å­—çš„æ‰‹æœºå·</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$phone</span> <span class="token operator">=~</span> ^1<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">'æ˜¯æ‰‹æœºå·'</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">'ä¸æ˜¯æ‰‹æœºå·'</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>[[ ]]</code> å‘½ä»¤æ˜¯ Shell è„šæœ¬ä¸­è¿›è¡Œæ¡ä»¶åˆ¤æ–­çš„æœ‰åŠ›å·¥å…·ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å­—ç¬¦ä¸²å’Œæ–‡ä»¶æ—¶ã€‚å®ƒæä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œå¼ºå¤§çš„åŠŸèƒ½ï¼Œå¦‚æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ä»Šå¤©çš„å†…å®¹ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ <code>[[ ]]</code> å‘½ä»¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell test [] å‘½ä»¤ï¼šæ¡ä»¶åˆ¤æ–­çš„è‰ºæœ¯</title>
      <link href="posts/8deddbf7.html"/>
      <url>posts/8deddbf7.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œ<code>shell</code> è„šæœ¬æ˜¯ä¸€ç§å¼ºå¤§è€Œåˆçµæ´»çš„æ–¹å¼ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ä»¥åŠè¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Shell è„šæœ¬ä¸­çš„ <code>test</code> å‘½ä»¤ï¼Œè¿™æ˜¯ä¸€ç§ç”¨æ¥æ£€æµ‹ä¸åŒæ¡ä»¶ï¼ˆå¦‚æ•°å€¼æ¯”è¾ƒã€å­—ç¬¦ä¸²æ¯”è¾ƒå’Œæ–‡ä»¶å­˜åœ¨æ€§æ£€æµ‹ï¼‰æ˜¯å¦æˆç«‹çš„å‘½ä»¤ã€‚</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>test</code> å‘½ä»¤ç”¨ä»¥åˆ¤æ–­ä¸€ç³»åˆ—è¡¨è¾¾å¼æ˜¯å¦æˆç«‹ï¼Œæ ¹æ®æ¡ä»¶çš„æˆç«‹ä¸å¦ï¼Œå®ƒä¼šè¿”å›ç›¸åº”çš„é€€å‡ºçŠ¶æ€ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼Œé€€å‡ºçŠ¶æ€ç ä¸º 0ï¼›å¦‚æœæ¡ä»¶ä¸æˆç«‹ï¼Œé€€å‡ºçŠ¶æ€ä¸ºé 0 å€¼ã€‚</p><p>è¯­æ³•æ€»è§ˆï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ ‡å‡†è¯­æ³•ï¼Œåˆ¤æ–­ expression æˆç«‹æ—¶ï¼Œé€€å‡ºçŠ¶æ€ä¸º 0ï¼Œå¦åˆ™ä¸ºé 0 å€¼</span><span class="token builtin class-name">test</span> expression<span class="token comment"># ç®€å†™å½¢å¼ï¼Œæ¨èä½¿ç”¨ï¼Œå› ä¸ºæ›´åŠ ç›´è§‚</span><span class="token punctuation">[</span> expression <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°å€¼æ¯”è¾ƒ"><a href="#æ•°å€¼æ¯”è¾ƒ" class="headerlink" title="æ•°å€¼æ¯”è¾ƒ"></a>æ•°å€¼æ¯”è¾ƒ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ <code>test</code> è¿›è¡Œæ•°å€¼æ¯”è¾ƒã€‚</p><h3 id="ç¤ºä¾‹ï¼šåˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰"><a href="#ç¤ºä¾‹ï¼šåˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰" class="headerlink" title="ç¤ºä¾‹ï¼šåˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰"></a>ç¤ºä¾‹ï¼šåˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># è¯»å…¥ä¸¤ä¸ªæ•°</span><span class="token builtin class-name">read</span> a b<span class="token comment"># ä½¿ç”¨ test å‘½ä»¤åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span><span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token variable">$a</span> <span class="token parameter variable">-eq</span> <span class="token variable">$b</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"ç›¸ç­‰"</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">"ä¸ç›¸ç­‰"</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ol><li>ä½¿ç”¨ <code>==</code>ã€<code>&gt;</code>ã€<code>&lt;</code> è¿™äº›ç¬¦å·æ—¶ï¼Œå®ƒä»¬åªèƒ½ç”¨äºå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œä¸èƒ½ç”¨äºæ•°å­—ã€‚å¯¹äºæ•°å€¼ï¼Œåº”ä½¿ç”¨ <code>-eq</code>ã€<code>-gt</code>ã€<code>-lt</code> è¿™æ ·çš„æ“ä½œç¬¦ã€‚</li><li>å°½ç®¡ Shell æ”¯æŒ <code>-gt</code> å’Œ <code>-lt</code> ä¹‹ç±»çš„æ•°å€¼æ¯”è¾ƒæ“ä½œç¬¦ï¼Œä½†ä¸æ”¯æŒ <code>&gt;=</code> å’Œ <code>&lt;=</code>ã€‚</li><li>å»ºè®®åœ¨ä½¿ç”¨å˜é‡æ—¶ï¼Œå°¤å…¶æ˜¯åœ¨å­—ç¬¦ä¸²æ¯”è¾ƒä¸­ï¼Œå°†å˜é‡ç”¨åŒå¼•å·åŒ…å›´ä»¥é˜²æ­¢ç©ºå€¼æˆ–å¸¦æœ‰ç©ºæ ¼çš„å€¼å¸¦æ¥é—®é¢˜ã€‚</li><li>å¯¹äºæ•´å‹æ•°å€¼çš„æ¯”è¾ƒï¼Œæ›´æ¨èä½¿ç”¨ <code>(())</code> æ¥è¿›è¡Œã€‚</li></ol><h2 id="æ–‡ä»¶æ£€æµ‹"><a href="#æ–‡ä»¶æ£€æµ‹" class="headerlink" title="æ–‡ä»¶æ£€æµ‹"></a>æ–‡ä»¶æ£€æµ‹</h2><p><code>test</code> å‘½ä»¤è¿˜å¯ä»¥ç”¨äºæ–‡ä»¶çš„æ£€æµ‹ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç±»å‹ã€æƒé™å’Œæ¯”è¾ƒç­‰ã€‚</p><h3 id="æ–‡ä»¶ç±»å‹åˆ¤æ–­"><a href="#æ–‡ä»¶ç±»å‹åˆ¤æ–­" class="headerlink" title="æ–‡ä»¶ç±»å‹åˆ¤æ–­"></a>æ–‡ä»¶ç±»å‹åˆ¤æ–­</h3><table><thead><tr><th align="left">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">-b filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºå—è®¾å¤‡æ–‡ä»¶ã€‚</td></tr><tr><td align="left">-c filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºå­—ç¬¦è®¾å¤‡æ–‡ä»¶ã€‚</td></tr><tr><td align="left">-d filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç›®å½•æ–‡ä»¶ã€‚</td></tr><tr><td align="left">-e filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</td></tr><tr><td align="left">-f filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œäº•ä¸”æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶ã€‚</td></tr><tr><td align="left">-L filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥æ–‡ä»¶ã€‚</td></tr><tr><td align="left">-p filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç®¡é“æ–‡ä»¶ã€‚</td></tr><tr><td align="left">-s filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºéç©ºã€‚</td></tr><tr><td align="left">-S filename</td><td>åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºå¥—æ¥å­—æ–‡ä»¶ã€‚</td></tr></tbody></table><h3 id="æ–‡ä»¶æƒé™åˆ¤æ–­"><a href="#æ–‡ä»¶æƒé™åˆ¤æ–­" class="headerlink" title="æ–‡ä»¶æƒé™åˆ¤æ–­"></a>æ–‡ä»¶æƒé™åˆ¤æ–­</h3><table><thead><tr><th align="left">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">-r filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦æ‹¥æœ‰è¯»æƒé™ã€‚</td></tr><tr><td align="left">-w filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦æ‹¥æœ‰å†™æƒé™ã€‚</td></tr><tr><td align="left">-x filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦æ‹¥æœ‰æ‰§è¡Œæƒé™ã€‚</td></tr><tr><td align="left">-u filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦æ‹¥æœ‰ SUID æƒé™ã€‚</td></tr><tr><td align="left">-g filename</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦æ‹¥æœ‰ SGID æƒé™ã€‚</td></tr><tr><td align="left">-k filename</td><td>åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦æ‹¥æœ‰ SBIT æƒé™ã€‚</td></tr></tbody></table><h3 id="æ–‡ä»¶æ¯”è¾ƒ"><a href="#æ–‡ä»¶æ¯”è¾ƒ" class="headerlink" title="æ–‡ä»¶æ¯”è¾ƒ"></a>æ–‡ä»¶æ¯”è¾ƒ</h3><table><thead><tr><th align="left">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">filename1 -nt filename2</td><td>åˆ¤æ–­ filename1 çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ¯” filename2 çš„æ–°ã€‚</td></tr><tr><td align="left">filename -ot filename2</td><td>åˆ¤æ–­ filename1 çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ¯” filename2 çš„æ—§ã€‚</td></tr><tr><td align="left">filename1 -ef filename2</td><td>åˆ¤æ–­ filename1 æ˜¯å¦å’Œ filename2 çš„ inode å·ä¸€è‡´ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªåˆ¤æ–­ç”¨äºåˆ¤æ–­ç¡¬é“¾æ¥æ˜¯å¾ˆå¥½çš„æ–¹æ³•</td></tr></tbody></table><h3 id="ç¤ºä¾‹ï¼šæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶å¯å†™"><a href="#ç¤ºä¾‹ï¼šæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶å¯å†™" class="headerlink" title="ç¤ºä¾‹ï¼šæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶å¯å†™"></a>ç¤ºä¾‹ï¼šæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶å¯å†™</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># è¯»å…¥æ–‡ä»¶åå’Œå†…å®¹</span><span class="token builtin class-name">read</span> filename<span class="token builtin class-name">read</span> content<span class="token comment"># æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯å†™ä¸”å†…å®¹éç©º</span><span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-w</span> <span class="token string">"<span class="token variable">$filename</span>"</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$content</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$content</span>"</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">$filename</span>"</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å†…å®¹å†™å…¥æ–‡ä»¶æˆåŠŸ"</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å†…å®¹å†™å…¥å¤±è´¥"</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸æ•°å€¼æ¯”è¾ƒç›¸å…³çš„-test-é€‰é¡¹"><a href="#ä¸æ•°å€¼æ¯”è¾ƒç›¸å…³çš„-test-é€‰é¡¹" class="headerlink" title="ä¸æ•°å€¼æ¯”è¾ƒç›¸å…³çš„ test é€‰é¡¹"></a>ä¸æ•°å€¼æ¯”è¾ƒç›¸å…³çš„ test é€‰é¡¹</h2><blockquote><p>test åªèƒ½ç”¨æ¥æ¯”è¾ƒæ•´æ•°ï¼Œå°æ•°ç›¸å…³çš„æ¯”è¾ƒè¿˜æ˜¯å¾—ç”¨ <code>bc</code> å‘½ä»¤</p></blockquote><table><thead><tr><th align="left">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">num1 -eq num2</td><td>åˆ¤æ–­ num1 æ˜¯å¦å’Œ num2 ç›¸ç­‰ã€‚</td></tr><tr><td align="left">num1 -ne num2</td><td>åˆ¤æ–­ num1 æ˜¯å¦å’Œ num2 ä¸ç›¸ç­‰ã€‚</td></tr><tr><td align="left">num1 -gt num2</td><td>åˆ¤æ–­ num1 æ˜¯å¦å¤§äº num2 ã€‚</td></tr><tr><td align="left">num1 -lt num2</td><td>åˆ¤æ–­ num1 æ˜¯å¦å°äº num2ã€‚</td></tr><tr><td align="left">num1 -ge num2</td><td>åˆ¤æ–­ num1 æ˜¯å¦å¤§äºç­‰äº num2ã€‚</td></tr><tr><td align="left">num1 -le num2</td><td>åˆ¤æ–­ num1 æ˜¯å¦å°äºç­‰äº num2ã€‚</td></tr></tbody></table><h2 id="ä¸å­—ç¬¦ä¸²åˆ¤æ–­ç›¸å…³çš„-test-é€‰é¡¹"><a href="#ä¸å­—ç¬¦ä¸²åˆ¤æ–­ç›¸å…³çš„-test-é€‰é¡¹" class="headerlink" title="ä¸å­—ç¬¦ä¸²åˆ¤æ–­ç›¸å…³çš„ test é€‰é¡¹"></a>ä¸å­—ç¬¦ä¸²åˆ¤æ–­ç›¸å…³çš„ test é€‰é¡¹</h2><table><thead><tr><th align="left">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">-z str</td><td>åˆ¤æ–­å­—ç¬¦ä¸² str æ˜¯å¦ä¸ºç©ºã€‚</td></tr><tr><td align="left">-n str</td><td>åˆ¤æ–­å®‡ç¬¦ä¸² str æ˜¯å¦ä¸ºéç©ºã€‚</td></tr><tr><td align="left">str1 = str2 <br> str1 == str2</td><td>=å’Œ==æ˜¯ç­‰ä»·çš„ï¼Œéƒ½ç”¨æ¥åˆ¤æ–­ str1 æ˜¯å¦å’Œ str2 ç›¸ç­‰ã€‚</td></tr><tr><td align="left">str1 != str2</td><td>åˆ¤æ–­ str1 æ˜¯å¦å’Œ str2 ä¸ç›¸ç­‰ã€‚</td></tr><tr><td align="left">str1 \&gt; str2</td><td>åˆ¤æ–­ str1 æ˜¯å¦å¤§äº str2ã€‚\&gt;æ˜¯&gt;çš„è½¬ä¹‰å­—ç¬¦ï¼Œè¿™æ ·å†™æ˜¯ä¸ºäº†é˜²æ­¢&gt;è¢«è¯¯è®¤ä¸ºæˆé‡å®šå‘è¿ç®—ç¬¦ã€‚</td></tr><tr><td align="left">str1 \&lt; str2</td><td>åˆ¤æ–­ str1 æ˜¯å¦å°äº str2ã€‚åŒæ ·ï¼Œ\&lt;ä¹Ÿæ˜¯è½¬ä¹‰å­—ç¬¦ã€‚</td></tr></tbody></table><h3 id="å­—ç¬¦ä¸²åˆ¤æ–­"><a href="#å­—ç¬¦ä¸²åˆ¤æ–­" class="headerlink" title="å­—ç¬¦ä¸²åˆ¤æ–­"></a>å­—ç¬¦ä¸²åˆ¤æ–­</h3><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•åˆ©ç”¨ <code>test</code> å‘½ä»¤è¿›è¡Œå­—ç¬¦ä¸²ç›¸å…³çš„åˆ¤æ–­ã€‚</p><h4 id="ç¤ºä¾‹ï¼šæ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰"><a href="#ç¤ºä¾‹ï¼šæ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰" class="headerlink" title="ç¤ºä¾‹ï¼šæ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰"></a>ç¤ºä¾‹ï¼šæ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># è¯»å…¥ä¸¤ä¸ªå­—ç¬¦ä¸²</span><span class="token builtin class-name">read</span> str1<span class="token builtin class-name">read</span> str2<span class="token comment"># æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º</span><span class="token comment"># é˜²æ­¢ $str1 å’Œ $str2 æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶å‡ºç°é”™è¯¯ï¼Œå› æ­¤éœ€è¦ç”¨åŒå¼•å·æ‹¬</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$str1</span>"</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$str2</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©º"</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$str1</span>"</span> <span class="token operator">!=</span> <span class="token string">"<span class="token variable">$str2</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ç›¸ç­‰"</span>  <span class="token builtin class-name">exit</span> <span class="token number">2</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å­—ç¬¦ä¸²ç›¸ç­‰"</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h3><p>æœ€åï¼Œ<code>test</code> å‘½ä»¤è¿˜æ”¯æŒé€»è¾‘è¿ç®—ï¼Œè¿™åŒ…æ‹¬ <code>é€»è¾‘ä¸</code>ã€<code>é€»è¾‘æˆ–</code> å’Œ <code>é€»è¾‘é</code>ã€‚</p><table><thead><tr><th align="left">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">expression1 -a expression</td><td>é€»è¾‘ä¸ï¼Œè¡¨è¾¾å¼ expression1 å’Œ expression2 éƒ½æˆç«‹ï¼Œæœ€ç»ˆçš„ç»“æœæ‰æ˜¯æˆç«‹çš„ã€‚</td></tr><tr><td align="left">expression1 -o expression2</td><td>é€»è¾‘æˆ–ï¼Œè¡¨è¾¾å¼ expression1 å’Œ expression2 æœ‰ä¸€ä¸ªæˆç«‹ï¼Œæœ€ç»ˆçš„ç»“æœå°±æˆç«‹ã€‚</td></tr><tr><td align="left">!expression</td><td>é€»è¾‘éï¼Œå¯¹ expression è¿›è¡Œå–åã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹ï¼šåˆ©ç”¨é€»è¾‘æˆ–è¿›è¡Œå­—ç¬¦ä¸²ç©ºåˆ¤æ–­"><a href="#ç¤ºä¾‹ï¼šåˆ©ç”¨é€»è¾‘æˆ–è¿›è¡Œå­—ç¬¦ä¸²ç©ºåˆ¤æ–­" class="headerlink" title="ç¤ºä¾‹ï¼šåˆ©ç”¨é€»è¾‘æˆ–è¿›è¡Œå­—ç¬¦ä¸²ç©ºåˆ¤æ–­"></a>ç¤ºä¾‹ï¼šåˆ©ç”¨é€»è¾‘æˆ–è¿›è¡Œå­—ç¬¦ä¸²ç©ºåˆ¤æ–­</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># è¯»å…¥ä¸¤ä¸ªå­—ç¬¦ä¸²</span><span class="token builtin class-name">read</span> str1<span class="token builtin class-name">read</span> str2<span class="token comment"># ä½¿ç”¨é€»è¾‘æˆ–æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º</span><span class="token comment"># ä½¿ç”¨ -o é€‰é¡¹å–ä»£ä¸Šé¢çš„ ||</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$str1</span>"</span> <span class="token parameter variable">-o</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$str2</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©º"</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$str1</span>"</span> <span class="token operator">!=</span> <span class="token string">"<span class="token variable">$str2</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ç›¸ç­‰"</span>  <span class="token builtin class-name">exit</span> <span class="token number">2</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">"å­—ç¬¦ä¸²ç›¸ç­‰"</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä¸Šè¿°ä»‹ç»å’Œç¤ºä¾‹ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ <code>test</code> å‘½ä»¤æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚<code>test</code> å‘½ä»¤çš„çµæ´»æ€§ä½¿å¾—å®ƒæˆä¸º Shell è„šæœ¬ä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…·ï¼Œå¸Œæœ›ä½ èƒ½åœ¨å®è·µä¸­çµæ´»è¿ç”¨å®ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell æ•°å­¦è®¡ç®—ï¼šè½»æ¾æŒæ¡ç®—æœ¯è¿ç®—åŸºæœ¬åŠŸ</title>
      <link href="posts/fc80fc40.html"/>
      <url>posts/fc80fc40.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„ Shell è„šæœ¬ç¼–å†™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦è¿›è¡Œæ•°å­¦è®¡ç®—çš„åœºæ™¯ã€‚ç›¸è¾ƒäºå…¶ä»–ç¼–ç¨‹è¯­è¨€ç›´æ¥æ”¯æŒç®—æ•°è¿ç®—ï¼ŒShell æœ¬èº«å¹¶ä¸ç›´æ¥æ”¯æŒå¤æ‚çš„æ•°å­¦è®¡ç®—ï¼Œå› ä¸ºå®ƒå¹¶ä¸å¦‚ Python é‚£æ ·ç›´æ¥æ”¯æŒç®€å•çš„æ•°å­¦è¡¨è¾¾å¼ã€‚</p><p>ä¸è¿‡ï¼Œåˆ«æ‹…å¿ƒï¼Œé€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•åœ¨ Shell ä¸­çµæ´»è¿›è¡Œå„ç§æ•°å­¦è®¡ç®—ã€‚</p><h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>åœ¨æ·±å…¥äº†è§£ç»†èŠ‚ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ï¼Œå°½ç®¡ Shell æœ¬èº«å¯¹æ•°å­¦è¿ç®—çš„æ”¯æŒå¾ˆæœ‰é™ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›ç‰¹å®šçš„å‘½ä»¤å’Œè¿ç®—æ–¹å¼æ¥è¿›è¡Œã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥åœ¨ Shell ä¸­è¿›è¡Œæ•°å­¦è¿ç®—ï¼ŒåŒ…æ‹¬ä¸€äº›ç›´æ¥çš„è¿ç®—å™¨å¦‚ <code>(())</code> å’Œ <code>let</code>ï¼Œä»¥åŠä¾èµ–äºå¤–éƒ¨å·¥å…·å¦‚ <code>bc</code> çš„æ–¹å¼ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è®²è§£æœ€å¸¸ç”¨çš„æ•°å­¦è®¡ç®—æ–¹å¼ï¼Œå¹¶æä¾›å®é™…çš„ä»£ç ç¤ºä¾‹ã€‚å‡†å¤‡å¥½å¼€å§‹ä½ çš„ Shell æ•°å­¦ä¹‹æ—…äº†å—ï¼Ÿ</p><h2 id="Shell-ç®—æœ¯è¿ç®—ç¬¦"><a href="#Shell-ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="Shell ç®—æœ¯è¿ç®—ç¬¦"></a>Shell ç®—æœ¯è¿ç®—ç¬¦</h2><p>åœ¨æ·±å…¥ç¤ºä¾‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¿«é€Ÿäº†è§£ä¸€ä¸‹ Shell æ”¯æŒçš„ä¸€äº›åŸºæœ¬ç®—æœ¯è¿ç®—ç¬¦åŠå…¶å«ä¹‰ã€‚</p><table><thead><tr><th>ç®—æœ¯è¿ç®—ç¬¦</th><th>è¯´æ˜/å«ä¹‰</th></tr></thead><tbody><tr><td>+, -</td><td>åŠ æ³•ï¼ˆæˆ–æ­£å·ï¼‰ã€å‡æ³•ï¼ˆæˆ–è´Ÿå·ï¼‰</td></tr><tr><td>*, /, %</td><td>ä¹˜æ³•ã€é™¤æ³•ã€å–ä½™ï¼ˆå–æ¨¡ï¼‰</td></tr><tr><td>**</td><td>å¹‚è¿ç®—</td></tr><tr><td>++, â€“</td><td>è‡ªå¢å’Œè‡ªå‡ï¼Œå¯ä»¥æ”¾åœ¨å˜é‡çš„å‰é¢ä¹Ÿå¯ä»¥æ”¾åœ¨å˜é‡çš„åé¢</td></tr><tr><td>!, &amp;&amp;, ||</td><td>é€»è¾‘éï¼ˆå–åï¼‰ã€é€»è¾‘ä¸ï¼ˆandï¼‰ã€é€»è¾‘æˆ–ï¼ˆorï¼‰</td></tr><tr><td>&lt;, &lt;=, &gt;, &gt;=</td><td>æ¯”è¾ƒç¬¦å·ï¼ˆå°äºã€å°äºç­‰äºã€å¤§äºã€å¤§äºç­‰äºï¼‰</td></tr><tr><td>==, !=, =</td><td>æ¯”è¾ƒç¬¦å·ï¼ˆç›¸ç­‰ã€ä¸ç›¸ç­‰ï¼›å¯¹äºå­—ç¬¦ä¸²ï¼Œ= ä¹Ÿå¯ä»¥è¡¨ç¤ºç›¸å½“äºï¼‰</td></tr><tr><td>&lt;&lt;, &gt;&gt;</td><td>å‘å·¦ç§»ä½ã€å‘å³ç§»ä½</td></tr><tr><td>~, |, &amp;, ^</td><td>æŒ‰ä½å–åã€æŒ‰ä½æˆ–ã€æŒ‰ä½ä¸ã€æŒ‰ä½å¼‚æˆ–</td></tr><tr><td>=, +=, -=, *=, /=, %=</td><td>èµ‹å€¼è¿ç®—ç¬¦</td></tr></tbody></table><h2 id="Shell-ä¸­çš„æ•°å­¦è®¡ç®—æ–¹å¼"><a href="#Shell-ä¸­çš„æ•°å­¦è®¡ç®—æ–¹å¼" class="headerlink" title="Shell ä¸­çš„æ•°å­¦è®¡ç®—æ–¹å¼"></a>Shell ä¸­çš„æ•°å­¦è®¡ç®—æ–¹å¼</h2><p>shell ä¸­å¸¸ç”¨çš„å…­ç§æ•°å­¦è®¡ç®—æ–¹å¼ï¼š</p><table><thead><tr><th>è¿ç®—æ“ä½œç¬¦/è¿ç®—å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>(( ))</td><td>ç”¨äºæ•´æ•°è¿ç®—ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œæ¨èä½¿ç”¨ã€‚ä½†æ˜¯åªèƒ½è¿›è¡Œæ•´æ•°è¿ç®—ï¼Œä¸èƒ½å¯¹å°æ•°æˆ–è€…å­—ç¬¦ä¸²è¿›è¡Œè®¡ç®—ã€‚</td></tr><tr><td>let</td><td>ç”¨äºæ•´æ•°è¿ç®—ï¼Œå’Œ (()) ç±»ä¼¼ã€‚</td></tr><tr><td>$[]</td><td>ç”¨äºæ•´æ•°è¿ç®—ï¼Œä¸å¦‚ (()) çµæ´»ã€‚</td></tr><tr><td>expr</td><td>å¯ç”¨äºæ•´æ•°è¿ç®—ï¼Œä¹Ÿå¯ä»¥å¤„ç†å­—ç¬¦ä¸²ã€‚æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æ³¨æ„å„ç§ç»†èŠ‚ï¼Œä¸æ¨èä½¿ç”¨ã€‚</td></tr><tr><td>bc</td><td>Linuxä¸‹çš„ä¸€ä¸ªè®¡ç®—å™¨ç¨‹åºï¼Œå¯ä»¥å¤„ç†æ•´æ•°å’Œå°æ•°ã€‚Shell æœ¬èº«åªæ”¯æŒæ•´æ•°è¿ç®—ï¼Œæƒ³è®¡ç®—å°æ•°å°±å¾—ä½¿ç”¨ bc è¿™ä¸ªå¤–éƒ¨çš„è®¡ç®—å™¨ã€‚</td></tr><tr><td>declare -i</td><td>å°†å˜é‡å®šä¹‰ä¸ºæ•´æ•°ï¼Œç„¶åå†è¿›è¡Œæ•°å­¦è¿ç®—æ—¶å°±ä¸ä¼šè¢«å½“åšå­—ç¬¦ä¸²äº†ã€‚åŠŸèƒ½æœ‰é™ï¼Œä»…æ”¯æŒæœ€åŸºæœ¬çš„æ•°å­¦è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤å’Œå–ä½™ï¼‰ï¼Œä¸æ”¯æŒé€»è¾‘è¿ç®—ã€è‡ªå¢è‡ªå‡ç­‰ï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨ã€‚</td></tr></tbody></table><blockquote><p>(()) å¯ä»¥ç”¨äºæ•´æ•°è®¡ç®—ï¼Œbc å¯ä»¥ç”¨äºå°æ•°è®¡ç®—ï¼Œæ¨èåªä½¿ç”¨ (()) å’Œ bc çš„æ–¹å¼è¿›è¡Œè¿ç®—</p></blockquote><h3 id="ä½¿ç”¨-è¿›è¡Œæ•´æ•°è¿ç®—"><a href="#ä½¿ç”¨-è¿›è¡Œæ•´æ•°è¿ç®—" class="headerlink" title="ä½¿ç”¨ (()) è¿›è¡Œæ•´æ•°è¿ç®—"></a>ä½¿ç”¨ (()) è¿›è¡Œæ•´æ•°è¿ç®—</h3><p><code>(( ))</code> æ˜¯è¿›è¡Œæ•´æ•°è¿ç®—æœ€æ¨èçš„æ–¹å¼ï¼Œå®ƒä¸ä»…æ•ˆç‡é«˜ï¼Œè€Œä¸”è¯­æ³•ç®€æ´ã€‚è¯·æ³¨æ„ï¼Œ<code>(( ))</code> åªæ”¯æŒæ•´æ•°è¿ç®—ï¼Œä¸èƒ½ç”¨äºå°æ•°æˆ–å­—ç¬¦ä¸²ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€äº›å®é™…çš„ä»£ç ç¤ºä¾‹æ¥å±•ç¤º <code>(())</code> çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># ç®€å•çš„æ•°å€¼è¿ç®—</span><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$((</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>  <span class="token comment"># è¾“å‡º 2</span><span class="token comment"># å˜é‡è¿ç®—</span><span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">3</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">*=</span><span class="token number">2</span><span class="token punctuation">))</span></span>  <span class="token comment"># ç­‰åŒäº i=i*2ï¼Œæ­¤æ—¶ i çš„å€¼å˜ä¸º 6</span><span class="token builtin class-name">echo</span> <span class="token variable">$i</span>  <span class="token comment"># è¾“å‡º 6</span><span class="token comment"># å¤åˆè¿ç®—</span><span class="token variable"><span class="token punctuation">((</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">))</span></span><span class="token builtin class-name">echo</span> <span class="token variable">$a</span>  <span class="token comment"># è¾“å‡º 8ï¼Œå±•ç¤ºäº†åŠ æ³•ã€å¹‚è¿ç®—å’Œå–æ¨¡çš„ç»„åˆä½¿ç”¨</span><span class="token comment"># é€»è¾‘è¿ç®—</span><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$((</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token number">6</span><span class="token variable">))</span></span>  <span class="token comment"># è¾“å‡º 1ï¼Œ1 è¡¨ç¤ºçœŸï¼ˆtrueï¼‰</span><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$((</span><span class="token number">3</span><span class="token operator">&gt;</span><span class="token number">6</span><span class="token variable">))</span></span>  <span class="token comment"># è¾“å‡º 0ï¼Œ0 è¡¨ç¤ºå‡ï¼ˆfalseï¼‰</span><span class="token comment"># è‡ªå¢å’Œè‡ªå‡è¿ç®—</span><span class="token assign-left variable">c</span><span class="token operator">=</span><span class="token number">10</span><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$((</span>c<span class="token operator">++</span><span class="token variable">))</span></span>  <span class="token comment"># è¾“å‡º 10ï¼Œc çš„å€¼å˜ä¸º 11</span><span class="token builtin class-name">echo</span> <span class="token variable">$c</span>  <span class="token comment"># è¾“å‡º 11</span><span class="token comment"># å¤šè¡¨è¾¾å¼è¿ç®—</span><span class="token variable"><span class="token punctuation">((</span>a<span class="token operator">=</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span> b<span class="token operator">=</span>a<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">))</span></span><span class="token builtin class-name">echo</span> <span class="token variable">$a</span> <span class="token variable">$b</span>  <span class="token comment"># å…ˆè®¡ç®— a=3+5ï¼Œç„¶å b=a+10ï¼›æœ€ç»ˆè¾“å‡º 8 18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™äº›ä¾‹å­ä½“ç°äº† <code>(())</code> åœ¨å¤„ç†å„ç§æ•´æ•°è¿ç®—ä¸­çš„å¼ºå¤§å’Œçµæ´»æ€§ã€‚</p><h3 id="ä½¿ç”¨-bc-è¿›è¡Œå°æ•°è®¡ç®—"><a href="#ä½¿ç”¨-bc-è¿›è¡Œå°æ•°è®¡ç®—" class="headerlink" title="ä½¿ç”¨ bc è¿›è¡Œå°æ•°è®¡ç®—"></a>ä½¿ç”¨ bc è¿›è¡Œå°æ•°è®¡ç®—</h3><p>å¯¹äºéœ€è¦å°æ•°è¿ç®—çš„åœºæ™¯ï¼Œ<code>bc</code> æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ã€‚å®ƒæ˜¯ Linux ä¸‹çš„ä¸€ä¸ªé«˜ç²¾åº¦è®¡ç®—å™¨ç¨‹åºï¼Œæ”¯æŒæ•´æ•°å’Œå°æ•°è¿ç®—ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ bc è¿›è¡Œå°æ•°åŠ æ³•</span><span class="token builtin class-name">echo</span> <span class="token string">"scale=2; 3.14 + 2.86"</span> <span class="token operator">|</span> <span class="token function">bc</span>  <span class="token comment"># è¾“å‡º 6.00</span><span class="token comment"># ä½¿ç”¨å˜é‡</span><span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token number">5.75</span><span class="token assign-left variable">b</span><span class="token operator">=</span><span class="token number">4.25</span><span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$a</span> + <span class="token variable">$b</span>"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">)</span></span><span class="token builtin class-name">echo</span> <span class="token variable">$result</span>  <span class="token comment"># è¾“å‡º 10.00</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>bc</code> ä½¿ç”¨ <code>scale</code> æ¥å®šä¹‰å°æ•°ç‚¹åçš„ç²¾åº¦ï¼Œè¿™åœ¨è¿›è¡Œå°æ•°è¿ç®—æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶ Shell æœ¬èº«å¯¹æ•°å­¦è¿ç®—çš„æ”¯æŒæœ‰é™ï¼Œä½†é€šè¿‡ <code>(())</code> å’Œ <code>bc</code> ç­‰æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°è¿›è¡Œæ•´æ•°å’Œå°æ•°çš„è®¡ç®—ã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ åœ¨ç¼–å†™ Shell è„šæœ¬æ—¶ï¼Œæ›´åŠ è‡ªå¦‚åœ°å¤„ç†æ•°å­¦è¿ç®—é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell æ•°ç»„ï¼šçµæ´»æ“ä½œçš„ç§˜è¯€</title>
      <link href="posts/1ddd131d.html"/>
      <url>posts/1ddd131d.html</url>
      
        <content type="html"><![CDATA[<p>è¿›å…¥ç¼–ç¨‹ä¸–ç•Œï¼Œæ— è®ºæ˜¯åˆå­¦è€…è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼Œéƒ½ä¼šæ¥è§¦åˆ°å„ç§å„æ ·çš„æ•°æ®ç»“æ„ï¼Œè€Œæ•°ç»„æ— ç–‘æ˜¯å…¶ä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç§ã€‚åœ¨ Shell ç¼–ç¨‹ä¸­ï¼Œæ•°ç»„çš„ä½¿ç”¨åŒæ ·å æ®äº†æå…¶é‡è¦çš„åœ°ä½ã€‚</p><p>æœ¬æ–‡å°†é€šè¿‡ç®€å•æ˜“æ‡‚çš„è¯­è¨€å’Œä¾‹å­ï¼Œå¸®åŠ©ä½ å¿«é€ŸæŒæ¡ Shell æ•°ç»„çš„ä½¿ç”¨ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Shell-æ•°ç»„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Shell-æ•°ç»„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Shell æ•°ç»„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Shell æ•°ç»„ï¼Ÿ</h2><p>Shell æ•°ç»„æ˜¯ä¸€ç§å¯ä»¥å­˜å‚¨å¤šä¸ªå€¼çš„å˜é‡ã€‚ä¸å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒShell æ•°ç»„å¯ä»¥åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œè¿™äº›å…ƒç´ å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²æˆ–å…¶ä»–æ•°æ®ç±»å‹ã€‚</p><p>åœ¨ Shell ä¸­ï¼Œæ•°ç»„çš„ä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹çš„ï¼Œè¿™æ„å‘€ç€ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡æ˜¯ 0ï¼Œç¬¬äºŒä¸ªå…ƒç´ çš„ä¸‹æ ‡æ˜¯ 1ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><h2 id="åˆ›å»ºå’Œè®¿é—®æ•°ç»„"><a href="#åˆ›å»ºå’Œè®¿é—®æ•°ç»„" class="headerlink" title="åˆ›å»ºå’Œè®¿é—®æ•°ç»„"></a>åˆ›å»ºå’Œè®¿é—®æ•°ç»„</h2><p>è®©æˆ‘ä»¬å…ˆä»å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ•°ç»„å¼€å§‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">3</span> <span class="token number">5</span> <span class="token number">7</span> <span class="token number">9</span> <span class="token number">11</span> <span class="token string">'alex'</span> <span class="token string">'harry'</span> <span class="token number">0.14</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>array</code> çš„æ•°ç»„ï¼Œå®ƒåŒ…å«äº†å¤šç§ç±»å‹çš„å…ƒç´ ï¼Œæ—¢æœ‰æ•´æ•°ï¼Œä¹Ÿæœ‰å­—ç¬¦ä¸²å’Œæµ®ç‚¹æ•°ã€‚</p><p>è¦è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­æ³•ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>  <span class="token comment"># è®¿é—®ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡º 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="è·å–æ•°ç»„æ‰€æœ‰å…ƒç´ "><a href="#è·å–æ•°ç»„æ‰€æœ‰å…ƒç´ " class="headerlink" title="è·å–æ•°ç»„æ‰€æœ‰å…ƒç´ "></a>è·å–æ•°ç»„æ‰€æœ‰å…ƒç´ </h2><p>è·å–æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ <code>${array[*]}</code> æˆ– <code>${array[@]}</code>ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>  <span class="token comment"># è¾“å‡ºæ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å¢åŠ å’Œä¿®æ”¹æ•°ç»„å…ƒç´ "><a href="#å¢åŠ å’Œä¿®æ”¹æ•°ç»„å…ƒç´ " class="headerlink" title="å¢åŠ å’Œä¿®æ”¹æ•°ç»„å…ƒç´ "></a>å¢åŠ å’Œä¿®æ”¹æ•°ç»„å…ƒç´ </h2><p>å‘æ•°ç»„æ·»åŠ æ–°å…ƒç´ éå¸¸ç®€å•ï¼Œåªéœ€æŒ‡å®šä¸€ä¸ªæ–°çš„ç´¢å¼•å¹¶èµ‹å€¼å³å¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">array<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'new_element'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœè¦ä¿®æ”¹æ•°ç»„ä¸­çš„ç°æœ‰å…ƒç´ ï¼Œä¹Ÿé‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">55</span>  <span class="token comment"># ä¿®æ”¹ç´¢å¼•ä¸º 2 çš„å…ƒç´ å€¼ä¸º 55</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="åˆ é™¤æ•°ç»„å…ƒç´ "><a href="#åˆ é™¤æ•°ç»„å…ƒç´ " class="headerlink" title="åˆ é™¤æ•°ç»„å…ƒç´ "></a>åˆ é™¤æ•°ç»„å…ƒç´ </h2><p>åˆ é™¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>unset</code> å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">unset</span> array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># åˆ é™¤ç´¢å¼•ä¸º 2 çš„å…ƒç´ </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ•°ç»„é•¿åº¦å’Œå…ƒç´ é•¿åº¦"><a href="#æ•°ç»„é•¿åº¦å’Œå…ƒç´ é•¿åº¦" class="headerlink" title="æ•°ç»„é•¿åº¦å’Œå…ƒç´ é•¿åº¦"></a>æ•°ç»„é•¿åº¦å’Œå…ƒç´ é•¿åº¦</h2><p>è·å–æ•°ç»„çš„é•¿åº¦ï¼ˆå³å…ƒç´ çš„æ€»æ•°ï¼‰ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">${<span class="token operator">#</span>array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>  <span class="token comment"># è¾“å‡ºæ•°ç»„çš„é•¿åº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è·å–ç‰¹å®šå…ƒç´ çš„é•¿åº¦ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">${<span class="token operator">#</span>array<span class="token punctuation">[</span>3<span class="token punctuation">]</span>}</span>  <span class="token comment"># è¾“å‡ºç´¢å¼•ä¸º 3 çš„å…ƒç´ çš„é•¿åº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ•°ç»„æ‹¼æ¥"><a href="#æ•°ç»„æ‹¼æ¥" class="headerlink" title="æ•°ç»„æ‹¼æ¥"></a>æ•°ç»„æ‹¼æ¥</h2><p>æ•°ç»„çš„æ‹¼æ¥ä¹Ÿéå¸¸ç›´æ¥ï¼Œåªéœ€è¦å°†ä¸¤ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ åˆ—å‡ºï¼Œèµ‹å€¼ç»™ä¸€ä¸ªæ–°çš„æ•°ç»„å³å¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">array_new</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span> <span class="token variable">${nums<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="åˆ é™¤æ•°ç»„"><a href="#åˆ é™¤æ•°ç»„" class="headerlink" title="åˆ é™¤æ•°ç»„"></a>åˆ é™¤æ•°ç»„</h2><p>æƒ³è¦ä¸€æ¬¡æ€§åˆ é™¤æ•´ä¸ªæ•°ç»„ï¼ŒåŒæ ·ä½¿ç”¨ <code>unset</code> å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">unset</span> array<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Shell æ•°ç»„çš„åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºã€è®¿é—®ã€ä¿®æ”¹ã€è·å–é•¿åº¦ã€æ‹¼æ¥ä»¥åŠåˆ é™¤æ“ä½œã€‚æ•°ç»„æ˜¯ Shell è„šæœ¬ä¸­éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆåœ°å¤„ç†æ•°æ®ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨ Shell ç¼–ç¨‹çš„é“è·¯ä¸Šæ›´è¿›ä¸€æ­¥ã€‚è®°ä½ï¼Œå®è·µæ˜¯å­¦ä¹ çš„æ·å¾„ï¼Œå¤šå†™ä»£ç ï¼Œå¤šåšå®éªŒï¼Œæ‰èƒ½æ›´å¿«åœ°æå‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell å­—ç¬¦ä¸²æ“ä½œï¼šè®©ä½ çš„è„šæœ¬è¯­è¨€æ›´åŠ çµæ´»</title>
      <link href="posts/68372f77.html"/>
      <url>posts/68372f77.html</url>
      
        <content type="html"><![CDATA[<p>å­—ç¬¦ä¸²åœ¨ç¼–ç¨‹ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨ Shell è„šæœ¬ç¼–ç¨‹ä¸­ã€‚æ— è®ºæ˜¯å¤„ç†æ–‡ä»¶è·¯å¾„ã€ç”ŸæˆåŠ¨æ€æ¶ˆæ¯è¿˜æ˜¯æ‰§è¡Œå¤æ‚çš„æ–‡æœ¬åˆ†æï¼ŒæŒæ¡å­—ç¬¦ä¸²æ“ä½œæ— ç–‘ä¼šè®©ä½ çš„è„šæœ¬æ›´åŠ å¼ºå¤§ä¸”çµæ´»ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥äº†è§£ä¸€äº›åŸºç¡€è€Œä¸”å®ç”¨çš„ Shell å­—ç¬¦ä¸²æ“ä½œæŠ€å·§ï¼Œæ— è®ºä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼ŒæŒæ¡å­—ç¬¦ä¸²æ“ä½œæ€»èƒ½åœ¨ç¼–å†™è„šæœ¬æ—¶è®©ä½ äº‹åŠåŠŸå€ã€‚</p><h2 id="è·å–å­—ç¬¦ä¸²é•¿åº¦"><a href="#è·å–å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="è·å–å­—ç¬¦ä¸²é•¿åº¦"></a>è·å–å­—ç¬¦ä¸²é•¿åº¦</h2><p>æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ä¸€ä¸ªå­—ç¬¦ä¸²æœ‰å¤šé•¿ï¼Œæ¯”å¦‚åœ¨æ ¡éªŒç”¨æˆ·åæˆ–è€…æ˜¯åˆ‡å‰²å­—ç¬¦ä¸²æ—¶ã€‚Shell é€šè¿‡ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼å°±èƒ½å¸®åŠ©æˆ‘ä»¬å¾—åˆ°ç­”æ¡ˆã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span>alex<span class="token builtin class-name">echo</span> <span class="token variable">${<span class="token operator">#</span>name}</span>  <span class="token comment"># è¾“å‡ºï¼š4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>${#å˜é‡å}</code> çš„è¯­æ³•ï¼Œå°±å¯ä»¥å¿«é€Ÿè·å–å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚è¿™ç§æ–¹å¼ç®€æ´è€Œé«˜æ•ˆï¼Œå¯¹äºå„ç§å­—ç¬¦ä¸²æ“ä½œåœºæ™¯éå¸¸å®ç”¨ã€‚</p><h2 id="å­—ç¬¦ä¸²è¿æ¥åˆåˆå¹¶"><a href="#å­—ç¬¦ä¸²è¿æ¥åˆåˆå¹¶" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥åˆåˆå¹¶"></a>å­—ç¬¦ä¸²è¿æ¥åˆåˆå¹¶</h2><p>åœ¨æ—¥å¸¸çš„è„šæœ¬ç¼–å†™ä¸­ï¼Œå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œæ˜¯é¿ä¸å¼€çš„ã€‚æ— è®ºæ˜¯æ‹¼æ¥è·¯å¾„ï¼Œè¿˜æ˜¯ç”Ÿæˆå«æœ‰å˜é‡çš„æç¤ºä¿¡æ¯ï¼Œå­—ç¬¦ä¸²è¿æ¥éƒ½æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span>alex<span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">26</span><span class="token assign-left variable">str1</span><span class="token operator">=</span><span class="token variable">$name</span><span class="token variable">$begin</span><span class="token assign-left variable">str2</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$name</span> <span class="token variable">$age</span>"</span> <span class="token comment"># æ³¨æ„ï¼Œå½“å­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºæ ¼æ—¶ï¼Œæœ€å¥½ç”¨åŒå¼•å·åŒ…è£¹èµ·æ¥</span><span class="token assign-left variable">str3</span><span class="token operator">=</span><span class="token variable">$name</span><span class="token string">"=====&gt;<span class="token variable">$age</span>"</span><span class="token assign-left variable">str4</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$name</span> =====&gt; <span class="token variable">$age</span>"</span><span class="token assign-left variable">str5</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${name}</span>is a web artisan and the age is<span class="token variable">${age}</span>"</span><span class="token builtin class-name">echo</span> <span class="token variable">$str1</span>  <span class="token comment"># è¾“å‡ºï¼šalex26</span><span class="token builtin class-name">echo</span> <span class="token variable">$str2</span>  <span class="token comment"># è¾“å‡ºï¼šalex 26</span><span class="token builtin class-name">echo</span> <span class="token variable">$str3</span>  <span class="token comment"># è¾“å‡ºï¼šalex=====&gt;26</span><span class="token builtin class-name">echo</span> <span class="token variable">$str4</span>  <span class="token comment"># è¾“å‡ºï¼šalex =====&gt; 26</span><span class="token builtin class-name">echo</span> <span class="token variable">$str5</span>  <span class="token comment"># è¾“å‡ºï¼šalexis a web artisan and the age is26</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿æ¥å­—ç¬¦ä¸²æ—¶ï¼Œç›´æ¥ä½¿ç”¨ <code>$å˜é‡å</code> æˆ–è€…æ˜¯ <code>${å˜é‡å}</code> å®Œæˆã€‚ç‰¹åˆ«æ˜¯åœ¨å­—ç¬¦ä¸²å’Œå˜é‡æ··åˆä½¿ç”¨çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨å¤§æ‹¬å·å¯ä»¥å¸®åŠ©æ˜ç¡®å˜é‡çš„è¾¹ç•Œï¼Œé¿å…è§£æä¸Šçš„æ··ä¹±ã€‚</p><h2 id="å­—ç¬¦ä¸²æˆªå–"><a href="#å­—ç¬¦ä¸²æˆªå–" class="headerlink" title="å­—ç¬¦ä¸²æˆªå–"></a>å­—ç¬¦ä¸²æˆªå–</h2><p>å­—ç¬¦ä¸²æˆªå–æ˜¯å¦ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æå–å‡ºæˆ‘ä»¬éœ€è¦çš„æŸä¸€éƒ¨åˆ†ã€‚è¿™åœ¨å¤„ç†è·¯å¾„ã€æ–‡ä»¶åæˆ–è€…æ˜¯æ—¥å¿—åˆ†æç­‰åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">name</span><span class="token operator">=</span>alex<span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">26</span><span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token string">"hello, my name is <span class="token variable">${name}</span>, my age is <span class="token variable">${age}</span>. nice to meet you!"</span><span class="token comment"># ä»å­—ç¬¦ä¸²å·¦è¾¹å¼€å§‹è®¡æ•°</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">:</span> 4<span class="token operator">:</span> 6}</span>  <span class="token comment"># o, my</span><span class="token comment"># ç›´æ¥æˆªå–åˆ°å­—ç¬¦ä¸²çš„æœ«å°¾</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">:</span> 4}</span>  <span class="token comment"># o, my name is alex, my age is 26. nice to meet you!</span><span class="token comment"># ä»å­—ç¬¦ä¸²å³è¾¹å¼€å§‹è®¡æ•°</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">:</span> 0-11<span class="token operator">:</span> 8}</span>  <span class="token comment"># o meet y</span><span class="token comment"># ç›´æ¥æˆªå–åˆ°å­—ç¬¦ä¸²çš„æœ«å°¾</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">:</span> 0-11}</span>  <span class="token comment"># o meet you!</span><span class="token comment"># ä½¿ç”¨ # å·æˆªå–å³è¾¹æ‰€æœ‰å­—ç¬¦</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">#</span>*my}</span>  <span class="token comment"># name is alex, my age is 26. nice to meet you!</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">#</span>*y}</span>  <span class="token comment"># name is alex, my age is 26. nice to meet you!</span><span class="token comment"># å¦‚æœä¸éœ€è¦å¿½ç•¥å­å­—ç¬¦ä¸²å·¦è¾¹çš„å­—ç¬¦ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä¸å†™ * å·</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">#</span>my}</span>  <span class="token comment"># hello, my name is alex, my age is 26. nice to meet you!</span><span class="token comment"># å¦‚æœå¸Œæœ›ç›´åˆ°æœ€åä¸€ä¸ªå­å­—ç¬¦ä¸²æ‰åŒ¹é…ç»“æŸï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸¤ä¸ª # å·</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">##</span>*my}</span>  <span class="token comment"># age is 26. nice to meet you!</span><span class="token comment"># ä½¿ç”¨ % å·æˆªå–å·¦è¾¹æ‰€æœ‰å­—ç¬¦</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">%</span>my*}</span>  <span class="token comment"># hello, my name is alex,</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">%</span>y*}</span>  <span class="token comment"># hello, my name is alex, my age is 26. nice to meet</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">%</span>}</span>  <span class="token comment"># hello, my name is alex, my age is 26. nice to meet you!</span><span class="token builtin class-name">echo</span> <span class="token variable">${str<span class="token operator">%%</span>my*}</span>  <span class="token comment"># hello,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™äº›æˆªå–æ–¹æ³•åŸºäºä¸åŒçš„éœ€æ±‚ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç»ƒä¹ æ¥ç†Ÿç»ƒæŒæ¡ã€‚</p><p>æ›´å¤šçš„ç”¨æ³•å¯ä»¥å¯¹ç…§è¿™å¼ è¡¨è¿›è¡ŒæŸ¥çœ‹ï¼š</p><table><thead><tr><th>æ ¼å¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>${string: start :length}</td><td>ä» string å­—ç¬¦ä¸²çš„å·¦è¾¹ç¬¬ start ä¸ªå­—ç¬¦å¼€å§‹ï¼Œå‘å³æˆªå– length ä¸ªå­—ç¬¦</td></tr><tr><td>${string: start}</td><td>ä» string å­—ç¬¦ä¸²çš„å·¦è¾¹ç¬¬ start ä¸ªå­—ç¬¦å¼€å§‹æˆªå–ï¼Œç›´åˆ°æœ€å</td></tr><tr><td>${string: 0-start :length}</td><td>ä» string å­—ç¬¦ä¸²çš„å³è¾¹ç¬¬ start ä¸ªå­—ç¬¦å¼€å§‹ï¼Œå‘å³æˆªå– length ä¸ªå­—ç¬¦</td></tr><tr><td>${string: 0-start}</td><td>ä» string å­—ç¬¦ä¸²çš„å³è¾¹ç¬¬ start ä¸ªå­—ç¬¦å¼€å§‹æˆªå–ï¼Œç›´åˆ°æœ€å</td></tr><tr><td>${string#*chars}</td><td>ä» string å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç° *chars çš„ä½ç½®å¼€å§‹ï¼Œæˆªå– *chars å³è¾¹çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td>${string##*chars}</td><td>ä» string å­—ç¬¦ä¸²æœ€åä¸€æ¬¡å‡ºç° *chars çš„ä½ç½®å¼€å§‹ï¼Œæˆªå– *chars å³è¾¹çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td>${string%*chars}</td><td>ä» string å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç° *chars çš„ä½ç½®å¼€å§‹ï¼Œæˆªå– *chars å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td>${string%%*chars}</td><td>ä» string å­—ç¬¦ä¸²æœ€åä¸€æ¬¡å‡ºç° *chars çš„ä½ç½®å¼€å§‹ï¼Œæˆªå– *chars å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦</td></tr></tbody></table><p>é€šè¿‡ä»¥ä¸Šçš„ä»‹ç»ï¼Œæˆ‘å¸Œæœ›èƒ½å¸®åŠ©ä½ äº†è§£å¹¶æŒæ¡ Shell ä¸­çš„åŸºç¡€å­—ç¬¦ä¸²æ“ä½œã€‚</p><p>è®°ä½ï¼Œå®è·µæ˜¯å­¦ä¹ çš„æ·å¾„ã€‚æˆ‘é¼“åŠ±ä½ è‡ªè¡Œç¼–å†™è„šæœ¬ï¼Œå°è¯•ä¸åŒçš„å­—ç¬¦ä¸²æ“ä½œï¼Œè¿™æ ·ä½ æ‰èƒ½æ›´åŠ ç†Ÿæ‚‰å¹¶çµæ´»è¿ç”¨å®ƒä»¬ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CharlesæŠ“åŒ…ç¥å™¨çš„ä½¿ç”¨ï¼Œå®Œç¾è§£å†³æŠ“å–HTTPSè¯·æ±‚unknowné—®é¢˜</title>
      <link href="posts/1eac0236.html"/>
      <url>posts/1eac0236.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Windows ä¸Šå¯èƒ½æ¯”è¾ƒå¥½ç”¨çš„æŠ“åŒ…å·¥å…·æ˜¯ fidderï¼Œå½“ç„¶ï¼Œåœ¨ Mac ä¸Šä¹Ÿæœ‰ä¸€æ¬¾æŠ“åŒ…ç¥å™¨ä¸è¾“ fiddlerï¼Œé‚£å°±æ˜¯ä»Šå¤©çš„ä¸»è§’â€”â€” Charlesã€‚</p><p>è½¯ä»¶çš„å®‰è£…è¿‡ç¨‹å°±ä¸ä»‹ç»äº†ï¼Œåªè¦è‡ªå·±ä¸‹è½½å¥½äº†è½¯ä»¶ï¼Œå®‰è£…è¿‡ç¨‹å°±æ˜¯å‚»ç“œå¼çš„æ“ä½œï¼Œéå¸¸ç®€å•ã€‚</p><p>ä»Šå¤©ä¸»è¦ä»‹ç»çš„æ˜¯å¦‚ä½•é…ç½® HTTP å’Œ HTTPSã€‚æœ‰ä¸å°‘ç«¥é‹åœ¨æŠ“å– HTTPS è¯·æ±‚æ—¶ï¼Œä¼šå‡ºç° <code>unknown</code> æ— æ³•è§£æçš„æƒ…å†µï¼Œé‚£ä¹ˆï¼Œé‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>è¿™ç¯‡æ–‡ç« å°†ä¸ºä½ ä»‹ç»æ•´ä¸ªé…ç½®è¿‡ç¨‹ï¼Œæ¥ï¼Œç»§ç»­å¾€ä¸‹çœ‹å§ï¼</p><blockquote><p>æˆ‘è¿™é‡Œæ¼”ç¤ºçš„æ˜¯ï¼š<br>Charles ç‰ˆæœ¬ä¸ºï¼š4.6.6<br>MacOS ç³»ç»Ÿç‰ˆæœ¬ä¸ºï¼šSonoma 14.5<br>iOS ç³»ç»Ÿç‰ˆæœ¬ä¸ºï¼š17.3</p></blockquote><h2 id="å®‰è£…è¯ä¹¦"><a href="#å®‰è£…è¯ä¹¦" class="headerlink" title="å®‰è£…è¯ä¹¦"></a>å®‰è£…è¯ä¹¦</h2><p>å®‰è£…è¯ä¹¦è¿™ä¸€æ­¥æ˜¯æŠ“å– HTTPS è¯·æ±‚çš„å…³é”®æ‰€åœ¨ï¼Œ<strong>åŒ…æ‹¬ PC ç«¯å’Œæ‰‹æœºç«¯éƒ½éœ€è¦å®‰è£…è¯ä¹¦</strong>ã€‚</p><h3 id="PC-ç«¯"><a href="#PC-ç«¯" class="headerlink" title="PC ç«¯"></a>PC ç«¯</h3><p>æˆ‘ä»¬éœ€è¦å…ˆæ‰“å¼€ <code>Charles</code> è½¯ä»¶ï¼Œç„¶ååœ¨èœå•æ ä¸­ä¾æ¬¡é€‰æ‹©ï¼š<code>Help</code> -&gt; <code>SSL Proxying</code> -&gt; <code>Install Charles Root Certificate</code> ç„¶åç›´æ¥ç‚¹å‡»ï¼Œå°†è¯ä¹¦å®‰è£…åˆ°æˆ‘ä»¬çš„ç”µè„‘ä¸Šã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8a490511ae8a2661.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…è¯ä¹¦"></p><p>å°†è¯ä¹¦å®‰è£…å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€<strong>é’¥åŒ™ä¸²è®¿é—®</strong></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a26501fc5f4396e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰“å¼€ã€Œé’¥åŒ™ä¸²è®¿é—®ã€"></p><p>å½“æˆ‘ä»¬æ‰“å¼€<strong>é’¥åŒ™ä¸²è®¿é—®</strong>åï¼Œæ‰¾åˆ°ã€Œç³»ç»Ÿé’¥åŒ™ä¸²ã€-&gt; ã€Œç³»ç»Ÿã€-&gt; ã€Œè¯ä¹¦ã€-&gt; ã€ŒCharles Proxy CAâ€¦â€¦ã€</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c389e595b039a474.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰¾åˆ°è¯ä¹¦"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¯ä¹¦é»˜è®¤æ˜¯<strong>ä¸è¢«ä¿¡ä»»çš„</strong>ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦å°†å…¶è®¾ç½®ä¸ºä¿¡ä»»ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e1684b7fff48320e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®è¯ä¹¦ä¸ºâ€œå§‹ç»ˆä¿¡ä»»â€"></p><ol><li>æˆ‘ä»¬ç›´æ¥å¯¹ç€â€œCharles Proxy â€¦â€¦â€å¼€å¤´çš„è¯ä¹¦ç›´æ¥<strong>åŒå‡»</strong>ç„¶åå°±ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—ï¼›</li><li>æ­¤å¼¹çª—ä¸­æœ‰ä¸€ä¸ª<strong>ä¿¡ä»»</strong>ï¼Œé»˜è®¤æ˜¯é—­åˆçš„ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦ç‚¹å‡»ä¸€ä¸‹ï¼Œè¿›è¡Œå±•å¼€ï¼›</li><li>å±•å¼€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€é¡¹â€œä½¿ç”¨æ­¤è¯ä¹¦æ—¶â€ï¼Œæˆ‘ä»¬å°†å…¶æ”¹ä¸º<strong>å§‹ç»ˆä¿¡ä»»</strong>ï¼›</li><li>ç„¶åå…³é—­æ­¤å¼¹çª—å°±å¯ä»¥äº†ã€‚ä¸æ”¾å¿ƒçš„ç«¥é‹å¯ä»¥å†æ¬¡æ‰“å¼€è¿™ä¸ªå¼¹çª—åšä¸€ä¸ªéªŒè¯ã€‚</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7bec8f2e8ed07af8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="éœ€è¦è¾“å…¥å¯†ç "></p><p>å½“æˆ‘ä»¬å…³é—­å¼¹çª—çš„æ—¶å€™ï¼Œéœ€è¦æˆ‘ä»¬éªŒè¯å¯†ç ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-91aab2a8c9c1560d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å·²ç»æ ‡è®°ä¸ºâ€œå—æ‰€æœ‰ç”¨æˆ·ä¿¡ä»»â€"></p><p>å½“æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹è¯ä¹¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ—¶å·²ç»æ˜¯<strong>å—æ‰€æœ‰ç”¨æˆ·ä¿¡ä»»</strong>ï¼Œæ­¤æ—¶ç”µè„‘ç«¯çš„è¯ä¹¦å°±å·²ç»å®‰è£…å®Œæˆäº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®‰è£…æ‰‹æœºç«¯çš„è¯ä¹¦ï¼š</p><h3 id="æ‰‹æœºç«¯"><a href="#æ‰‹æœºç«¯" class="headerlink" title="æ‰‹æœºç«¯"></a>æ‰‹æœºç«¯</h3><blockquote><p>æˆ‘è¿™é‡Œä»¥ iOS è®¾å¤‡ä¸ºä¾‹ï¼ŒAndroid æ‰‹æœºå¯èƒ½ä¼šæœ‰æ‰€å·®å¼‚ï¼Œä½†æ˜¯æˆ‘æƒ³åº”è¯¥å®‰è£…æ­¥éª¤éƒ½æ˜¯å¤§å·®ä¸å·®çš„ï¼Œå„ä½åšä¸€ä¸ªå‚è€ƒä¹Ÿè¡Œã€‚</p></blockquote><p>åœ¨æ‰‹æœºä¸Šå®‰è£…è¯ä¹¦ï¼Œä¾ç„¶éœ€è¦å…ˆæ‰“å¼€ <code>Charles</code> è½¯ä»¶ï¼Œç„¶ååœ¨èœå•æ ä¸­ä¾æ¬¡é€‰æ‹©ï¼š<code>Help</code> -&gt; <code>SSL Proxying</code> -&gt; <code>Install Charles Root Certificate on a Mobile Device or Remote Browser</code> ç„¶åç›´æ¥ç‚¹å‡»ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0fdd6d440d4b36f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹æœºä¸Šå®‰è£…è¯ä¹¦"></p><p>å½“æˆ‘ä»¬ç‚¹å‡»ä¹‹åä¼šæœ‰ä¸€ä¸ªå¼¹æ¡†æç¤ºï¼Œå¤§è‡´å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-eb69b8372e7e6d68.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹æœºç«¯å®‰è£…æ—¶ï¼Œä¼šæœ‰å¼¹çª—æç¤º"></p><p>å¤§è‡´çš„æ„æ€æ˜¯è¯´éœ€è¦æˆ‘ä»¬åœ¨æ‰‹æœºä¸Šè®¾ç½® HTTP ä»£ç†ï¼Œä»£ç†åœ°å€ä¸º <code>192.168.0.102:8888</code> è®¾ç½®å¥½åå†é€šè¿‡æµè§ˆå™¨è®¿é—® <code>chls.pro/ssl</code> åœ°å€å¹¶ä¸‹è½½å®‰è£…è¯ä¹¦ã€‚</p><p>å¹¶ä¸”è¿˜éœ€è¦æ³¨æ„ï¼š<strong>å¦‚æœæ˜¯ iOS 10 åŠå…¶ä»¥åçš„ç‰ˆæœ¬æ—¶ï¼Œè¿˜éœ€è¦è¿›å…¥ã€Œè®¾ç½®ã€-&gt; ã€Œé€šç”¨ã€-&gt;ã€Œå…³äºæœ¬æœºã€-&gt; æ»‘åˆ°æœ€åº•éƒ¨ã€Œè¯ä¹¦ä¿¡ä»»è®¾ç½®ã€ï¼Œå¹¶å¯ç”¨ Charles è¯ä¹¦ä¸ºå¯ä¿¡ä»»è¯ä¹¦ã€‚</strong></p><p>å¹¶ä¸”è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ <strong>ä¸€å®šéœ€è¦å°†æ‰‹æœºå’Œç”µè„‘è¿æ¥åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…</strong>ï¼Œå¦‚æœä½ çš„ç”µè„‘æ˜¯ç¬”è®°æœ¬çš„è¯ï¼Œå°±æ˜¯è¯´ä½ çš„ç”µè„‘å’Œæ‰‹æœºè¿æ¥çš„æ˜¯åŒä¸€ä¸ª Wi-Fiã€‚å¦å¤–è¿™é‡Œæˆ‘çš„ç”µè„‘ç«¯å±€åŸŸç½‘ IP åœ°å€ä¸º <code>192.168.0.102</code> ä½ çš„å¯èƒ½å’Œæˆ‘çš„ä¸ä¸€æ ·ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ­£å¸¸ç°è±¡ï¼Œä»¥å¼¹çª—ä¸­çš„ IP åœ°å€ä¸ºå‡†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰‹æœºä¸Šæ“ä½œï¼š</p><ol><li>æ‰“å¼€ã€Œè®¾ç½®ã€æ‰¾åˆ°ã€Œæ— çº¿å±€åŸŸç½‘ã€è¿™é‡Œä¸€å®šéœ€è¦æ³¨æ„ï¼Œæ­¤æ—¶ä½ æ‰‹æœºä¸Šè¿æ¥çš„ Wi-Fi ä¸€å®šå’Œç”µè„‘æ‰€åœ¨çš„ç½‘ç»œåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œä¸ç„¶å°±ç™½æ­äº†ã€‚</li><li>ç‚¹å‡»ä½ æ‰€è¿æ¥çš„ Wi-Fiï¼Œæ»‘åˆ°æœ€åº•éƒ¨ä¼šæœ‰ä¸€ä¸ªã€Œé…ç½®ä»£ç†ã€ï¼Œç‚¹å‡»æ‰“å¼€ï¼Œé€‰æ‹©ã€Œæ‰‹åŠ¨ã€ã€‚</li><li>ç„¶ååœ¨â€œæœåŠ¡å™¨â€ä½ç½®è¾“å…¥<strong>192.168.0.102</strong>ï¼Œâ€œç«¯å£â€ä½ç½®è¾“å…¥<strong>8888</strong>ï¼Œç„¶åç‚¹å‡»å³ä¸Šè§’çš„ã€Œå­˜å‚¨ã€ã€‚</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-248604b868222b90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹æœºä¸Šé…ç½®ä»£ç†"></p><p>ç„¶åå»æ‰“å¼€ <strong>Safari</strong> æµè§ˆå™¨ï¼ˆå…¶ä»–æµè§ˆå™¨<strong>ä¸ä¸€å®š</strong>å¯ä»¥å”¤èµ·å®‰è£…è¯ä¹¦çš„å¼¹çª—ï¼‰ï¼Œè¾“å…¥åœ°å€ <code>chls.pro/ssl</code> æ‰“å¼€é¡µé¢ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å”¤èµ·å®‰è£…æè¿°æ–‡ä»¶çš„å¼¹çª—ã€‚</p><p>å¦‚æœæ­¤æ—¶ä½ å‘ç°å¹¶æ²¡æœ‰å”¤èµ·å®‰è£…æè¿°æ–‡ä»¶çš„å¼¹çª—æ—¶ï¼Œä½ éœ€è¦å›åˆ°ä½ çš„ç”µè„‘ä¸Šï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼ä»¥ä¸‹çš„å¼¹çª—ï¼Œä½ éœ€è¦ç‚¹å‡»ä¸€ä¸‹<strong>Allow</strong>ï¼Œè¿™æ˜¯ä½ çš„æ‰‹æœºè¿æ¥åˆ°äº† Charles ã€‚å½“ä½ ç‚¹å‡»äº† <strong>Allow</strong> ä¹‹åå†å»æ‰‹æœº Safari æµè§ˆå™¨ä¸Šåˆ·æ–°ä¸€ä¸‹åº”è¯¥å°±ä¼šæœ‰å®‰è£…æè¿°æ–‡ä»¶çš„å¼¹çª—äº†ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-90de545c3e0bb400.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="éœ€è¦åœ¨ç”µè„‘ä¸Šå…è®¸ä¸€ä¸‹"></p><p>å½“å‡ºç°å®‰è£…æè¿°æ–‡ä»¶çš„å¼¹çª—åï¼Œä¼šå‘ŠçŸ¥ä½ ç°åœ¨æ­£åœ¨ä¸‹è½½ä¸€ä¸ªé…ç½®æè¿°æ–‡ä»¶ï¼Œä½ ç›´æ¥ç‚¹å‡»<strong>å…è®¸</strong>å°±å¥½äº†ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c86485bab631efaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹æœºä¸Šä¸‹è½½é…ç½®æè¿°æ–‡ä»¶"></p><p>å½“ä¸‹è½½å¥½è¯ä¹¦ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å‰å¾€ï¼šã€Œè®¾ç½®ã€-&gt;ã€Œé€šç”¨ã€-&gt; ã€ŒVPNä¸è®¾å¤‡ç®¡ç†ã€ç„¶åå°±å¯ä»¥çœ‹åˆ°â€œå·²ä¸‹è½½çš„æè¿°æ–‡ä»¶â€ <code>Charles Proxy CAâ€¦â€¦</code> è¿›è¡Œç‚¹å‡»è¿›å»ï¼Œç„¶åçœ‹åˆ°å³ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªã€Œå®‰è£…ã€æŒ‰é’®ï¼Œç‚¹å‡»å®‰è£…å³å¯ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ab64c916867c3eda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…é…ç½®æè¿°æ–‡ä»¶"></p><p>ä¹‹å‰ä¹Ÿè¯´åˆ°äº†ï¼Œå¦‚æœæ˜¯ iOS 10 åŠå…¶ä»¥åçš„ç‰ˆæœ¬æ—¶ï¼Œè¿˜éœ€è¦åœ¨ã€Œè¯ä¹¦ä¿¡ä»»è®¾ç½®ã€ï¼Œå¹¶å¯ç”¨ Charles è¯ä¹¦ä¸ºå¯ä¿¡ä»»è¯ä¹¦ï¼Œè¿™ç‚¹ä½ æŒ‰ç…§ä½ çš„ç³»ç»Ÿç‰ˆæœ¬æŒ‰éœ€æ¥åšå°±å¥½äº†ã€‚</p><p>ä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œç°åœ¨å¾ˆå°‘æœ‰ä½äº iOS 10 çš„æ‰‹æœºè¿˜åœ¨è·‘äº†å§ï¼Ÿ<strong>å…¶å®è¿™ä¸€ç‚¹ä¹Ÿæ˜¯å¾ˆå¤šäººè™½ç„¶å®‰è£…å®Œäº†è¯ä¹¦ï¼Œä½†æ˜¯å‘ç°ä¾ç„¶æŠ“å– HTTPS è¯·æ±‚æ—¶è®¤ä¸º unknown çš„åŸå› ã€‚</strong> æ‰€ä»¥ï¼Œä¸€å®šè¦è®°å¾—å»ä¿¡ä»»ä¸€ä¸‹è¯ä¹¦ï¼Œè¿™ç‚¹éå¸¸é‡è¦ï¼</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a650be3665c57d25.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¼€å¯ä¿¡ä»»è¯ä¹¦"></p><p>ç°åœ¨æˆ‘ä»¬è¯ä¹¦å·²ç»å®‰è£…å¥½äº†ï¼Œä½†æ˜¯è¿˜éœ€è¦ç®€å•é…ç½®ä¸€ä¸‹ Charlesã€‚</p><h2 id="é…ç½®-Charles"><a href="#é…ç½®-Charles" class="headerlink" title="é…ç½® Charles"></a>é…ç½® Charles</h2><h3 id="é…ç½®ä»£ç†ç«¯å£"><a href="#é…ç½®ä»£ç†ç«¯å£" class="headerlink" title="é…ç½®ä»£ç†ç«¯å£"></a>é…ç½®ä»£ç†ç«¯å£</h3><p>ç›´æ¥ç‚¹å‡»èœå•æ ä¸­çš„ã€ŒProxyã€ -&gt;ã€ŒProxy Settingsã€</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0a36814f9dfecb62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®ä»£ç†"></p><p>è¿˜è®°å¾—ä¸Šé¢æˆ‘ä»¬åœ¨æ‰‹æœºä¸Šè®¾ç½®ä»£ç†çš„æ—¶å€™é‚£ä¸ª 8888 ç«¯å£å—ï¼Ÿå¦‚æœä½ æƒ³è‡ªå®šä¹‰ä»£ç†ç«¯å£ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªä½ç½®è¿›è¡Œæ›´æ”¹ã€‚ä¸æ”¹é—®é¢˜ä¹Ÿä¸å¤§ï¼Œè‡ªå·±æŒ‰ç…§å®é™…æƒ…å†µè€Œå®šã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-58134297b5b4207b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ›´æ”¹ä»£ç†ç«¯å£"></p><h3 id="é…ç½®-SSL-ä»£ç†è®¾ç½®"><a href="#é…ç½®-SSL-ä»£ç†è®¾ç½®" class="headerlink" title="é…ç½® SSL ä»£ç†è®¾ç½®"></a>é…ç½® SSL ä»£ç†è®¾ç½®</h3><p>ç›´æ¥ç‚¹å‡»èœå•æ ä¸­çš„ã€ŒProxyã€-&gt;ã€ŒSSL Proxying Settingsã€</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9c01ebf614410cc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®SSLä»£ç†è®¾ç½®"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é…ç½® <strong>SSL Proxying Settings</strong>ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å‹¾é€‰ä¸Šäº†ã€ŒEnable SSL Proxyingã€å¹¶ä¸”è¿˜éœ€è¦æ·»åŠ ã€ŒIncludeã€ï¼Œ<strong>å¦åˆ™å³ä½¿æˆ‘ä»¬æ·»åŠ äº†è¯ä¹¦ï¼ŒæŠ“å– HTTPS æ—¶è¿˜æ˜¯ä¼šå‡ºç° unknown</strong>ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-457f3b5df5b88fff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½® SSL ä»£ç†è®¾ç½®"></p><p>Include å’Œ Exclude å°±æ˜¯å­—é¢ä¸Šçš„å«ä¹‰ï¼Œåˆ†åˆ«ä»£è¡¨åŒ…å«å’Œä¸åŒ…å«ï¼Œè¿™é‡Œæˆ‘åœ¨ Include å¤„è®¾ç½®ä¸¤ä¸ªæ˜Ÿå· <code>*</code> çš„å«ä¹‰æ˜¯ï¼šåŒ…å«æ‰€æœ‰çš„åŸŸåå’Œç«¯å£ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‰ç…§ä½ è‡ªå·±çš„å®é™…æƒ…å†µæ¥è®¾ç½®ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨è¯¥é…ç½®çš„éƒ½å·²ç»é…ç½®å®Œäº†ï¼Œå‰©ä¸‹çš„å°±å¯ä»¥æ„‰å¿«çš„ç©è€å•¦ã€‚</p><blockquote><p>å¦å¤–ï¼Œå¬è¯´ Android 7.0 ä¹‹åé»˜è®¤ä¸ä¿¡ä»»ç”¨æˆ·æ·»åŠ åˆ°ç³»ç»Ÿçš„ CA è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹åŸºäº SDK24 åŠä»¥ä¸Šçš„ APP æ¥è¯´ï¼Œå³ä½¿ä½ åœ¨æ‰‹æœºä¸Šå®‰è£…äº†æŠ“åŒ…å·¥å…·çš„è¯ä¹¦ä¹Ÿæ— æ³•æŠ“å– HTTPS è¯·æ±‚ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå½“å‰æˆ‘æ‰‹ä¸Šæ²¡æœ‰ Android æ‰‹æœºï¼Œä¹Ÿæ— æ³•å»æµ‹è¯•ï¼Œè¿™ä¸ªé—®é¢˜å°±ç•™ç»™æœ‰ Android æ‰‹æœºçš„ç”¨æˆ·æ¥è§£å†³å§ã€‚ä¸è¿‡ï¼Œæˆ‘æƒ³è¿™ä¸ªé—®é¢˜åº”è¯¥ä¹Ÿå·²ç»æœ‰äº†è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœä½ çŸ¥é“è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå¸Œæœ›ä¸€èµ·åˆ†äº«åˆ†äº«ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ“åŒ…å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ“åŒ…å·¥å…· </tag>
            
            <tag> MacOS </tag>
            
            <tag> Charles </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨èå‡ ä¸ªå¥½ç”¨çš„GRPCè°ƒè¯•å·¥å…·</title>
      <link href="posts/47f9e31c.html"/>
      <url>posts/47f9e31c.html</url>
      
        <content type="html"><![CDATA[<h1 id="GRPC-è°ƒè¯•å·¥å…·"><a href="#GRPC-è°ƒè¯•å·¥å…·" class="headerlink" title="GRPC è°ƒè¯•å·¥å…·"></a>GRPC è°ƒè¯•å·¥å…·</h1><h2 id="1-grpcui"><a href="#1-grpcui" class="headerlink" title="1. grpcui"></a>1. <a href="https://github.com/fullstorydev/grpcui">grpcui</a></h2><ul><li>ä¸‹è½½</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™æ—¶ï¼Œä¼šåœ¨ $GOPATH/bin ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª grpcui å¯æ‰§è¡Œæ–‡ä»¶</span>go <span class="token function">install</span> github.com/fullstorydev/grpcui/cmd/grpcui@latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">grpcui <span class="token parameter variable">-help</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>è°ƒè¯•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™é‡Œçš„åœ°å€éœ€è¦è®¾ç½®ä¸ºï¼šgrpc é¡¹ç›®åŸŸåæˆ–è€… ip + ç«¯å£å·</span><span class="token comment"># -plaintext å‚æ•°å¿½ç•¥ tls è¯ä¹¦çš„éªŒè¯è¿‡ç¨‹</span>grpcui <span class="token parameter variable">-plaintext</span> localhost:12345<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-grpcurl"><a href="#2-grpcurl" class="headerlink" title="2. grpcurl"></a>2. <a href="https://github.com/fullstorydev/grpcurl">grpcurl</a></h2><ul><li>ä¸‹è½½</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™æ—¶ï¼Œä¼šåœ¨ $GOPATH/bin ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª grpcurl å¯æ‰§è¡Œæ–‡ä»¶</span>go <span class="token function">install</span> github.com/fullstorydev/grpcurl/cmd/grpcurl@latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">grpcurl <span class="token parameter variable">-help</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>è°ƒè¯•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹æœåŠ¡åˆ—è¡¨</span><span class="token comment"># grpcurl å·¥å…·é»˜è®¤ä½¿ç”¨ TLS è®¤è¯ï¼ˆå¯é€šè¿‡ -cert å’Œ -key å‚æ•°è®¾ç½®å…¬é’¥å’Œå¯†é’¥ï¼‰å¯ä»¥é€šè¿‡æŒ‡å®š plaintext é€‰é¡¹æ¥å¿½ç•¥ TLS è®¤è¯</span>grpcurl <span class="token parameter variable">-plaintext</span> localhost:5200 list<span class="token comment"># æ¯”å¦‚è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š</span><span class="token comment"># grpc.reflection.v1alpha.ServerReflection</span><span class="token comment"># proto.TagService</span><span class="token comment"># æŸ¥çœ‹æœåŠ¡çš„æ–¹æ³•åˆ—è¡¨</span>grpcurl <span class="token parameter variable">-plaintext</span> localhost:5200 list proto.TagService<span class="token comment"># æ¯”å¦‚è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š</span><span class="token comment"># proto.TagService.GetTagList</span><span class="token comment"># æŸ¥çœ‹æ–¹æ³•çš„ç»†èŠ‚</span>grpcurl <span class="token parameter variable">-plaintext</span> localhost:5200 describe proto.TagService<span class="token comment"># æ¯”å¦‚è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š</span><span class="token comment"># proto.TagService is a service:</span><span class="token comment"># service TagService {</span><span class="token comment">#  rpc GetTagList ( .proto.GetTagListRequest ) returns ( .proto.GetTagListResponse );</span><span class="token comment"># }</span><span class="token comment"># è°ƒç”¨æ–¹æ³•</span><span class="token comment"># å‚æ•°å¿…é¡»ä¸º json æ ¼å¼çš„å­—ç¬¦ä¸²</span><span class="token comment"># `proto.TagService/GetTagList` æ˜¯æ‰€éœ€è¦è°ƒç”¨çš„æ¥å£</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{"name":"go"}'</span> localhost:5200 proto.TagService/GetTagList<span class="token comment"># æˆ–è€…</span>grpcurl <span class="token parameter variable">-plaintext</span> <span class="token parameter variable">-d</span> <span class="token string">'{"name":"go"}'</span> localhost:5200 proto.TagService.GetTagList<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½éœ€è¦å¯åŠ¨åå°„æœåŠ¡æ‰å¯ä»¥ä½¿ç”¨ï¼Œä»£ç ç±»ä¼¼å¦‚ä¸‹</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"log"</span><span class="token string">"net"</span>pb <span class="token string">"github.com/pudongping/go-grpc-service/proto"</span><span class="token string">"github.com/pudongping/go-grpc-service/server"</span><span class="token string">"google.golang.org/grpc"</span><span class="token string">"google.golang.org/grpc/reflection"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>s <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>pb<span class="token punctuation">.</span><span class="token function">RegisterTagServiceServer</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> server<span class="token punctuation">.</span><span class="token function">NewTagServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>listen<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">":5200"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"net.Listen err: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// æ³¨å†Œåå°„æœåŠ¡ï¼Œæ–¹ä¾¿è®© grpcurl æˆ–è€… grpcui ç”¨ä½œè°ƒè¯•</span>reflection<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>err <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>listen<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"server.Serve err: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-bloomrpc"><a href="#3-bloomrpc" class="headerlink" title="3. bloomrpc"></a>3. <a href="https://github.com/bloomrpc/bloomrpc">bloomrpc</a></h2><blockquote><p>ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼ŒGitHub ä»“åº“ä¸Šæœ‰ä¸€å¼ åŠ¨å›¾æ¼”ç¤ºï¼Œåªéœ€è¦ä¸Šä¼  proto æ–‡ä»¶å³å¯ï¼Œä¸éœ€è¦åœ¨ä»£ç ä¸­å¼€å¯åå°„ã€‚</p></blockquote><p><strong>å¦‚æœå‘ç° bloomrpc åŒ…ä½¿ç”¨ int64 æ—¶å¤±çœŸï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://github.com/crossoverJie/ptg">crossoverJie/ptg</a> åŒ…ï¼ˆçœ‹ä»–çš„æ–‡æ¡£è¯´å·²ç»è§£å†³æ‰ bloomrpc int64 å¤±çœŸçš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘è‡ªå·±æ²¡æœ‰å»éªŒè¯ï¼‰</strong></p><ul><li>å®‰è£…</li></ul><pre class="line-numbers language-none"><code class="language-none"># macOS/Homebrewbrew install --cask bloomrpc# æˆ–è€…ç›´æ¥æ ¹æ®ç³»ç»Ÿä¸‹è½½å¯¹åº”çš„åŒ…æ–‡ä»¶ï¼Œä¸‹è½½åœ°å€å¦‚ä¸‹ï¼šhttps://github.com/bloomrpc/bloomrpc/releases# æ¯”å¦‚è¦æ˜¯ macOS ç³»ç»Ÿä¸‹wget https://github.com/bloomrpc/bloomrpc/releases/download/1.5.3/BloomRPC-1.5.3.dmg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-kreya"><a href="#4-kreya" class="headerlink" title="4. kreya"></a>4. <a href="https://kreya.app/">kreya</a></h2>]]></content>
      
      
      <categories>
          
          <category> RPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
            <tag> GRPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go åŸºç¡€æ•°æ®ç±»å‹</title>
      <link href="posts/1308b152.html"/>
      <url>posts/1308b152.html</url>
      
        <content type="html"><![CDATA[<h1 id="Go-åŸºç¡€æ•°æ®ç±»å‹"><a href="#Go-åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="Go åŸºç¡€æ•°æ®ç±»å‹"></a>Go åŸºç¡€æ•°æ®ç±»å‹</h1><p>å¯¹äºæµ®ç‚¹ç±»å‹éœ€è¦è¢«è‡ªåŠ¨æ¨å¯¼çš„å˜é‡ï¼Œå…¶ç±»å‹å°†è¢«è‡ªåŠ¨è®¾ç½®ä¸º float64ï¼Œè€Œä¸ç®¡èµ‹å€¼ç»™å®ƒçš„æ•°å­—æ˜¯å¦æ˜¯ç”¨ 32 ä½é•¿åº¦è¡¨ç¤ºçš„<br>åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥å°½å¯èƒ½åœ°ä½¿ç”¨ float64 ç±»å‹ï¼Œå› ä¸º math åŒ…ä¸­æ‰€æœ‰æœ‰å…³æ•°å­¦è¿ç®—çš„å‡½æ•°éƒ½ä¼šè¦æ±‚æ¥æ”¶è¿™ä¸ªç±»å‹ã€‚</p><h2 id="Go-æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#Go-æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="Go æ”¯æŒçš„æ•°æ®ç±»å‹"></a>Go æ”¯æŒçš„æ•°æ®ç±»å‹</h2><h3 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h3><ul><li>å¸ƒå°”ç±»å‹ï¼šbool</li><li>æ•´å‹ï¼š int8ã€byteã€int16ã€intã€uintã€uintptr ç­‰</li><li>æµ®ç‚¹ç±»å‹ï¼šfloat32ï¼ˆå•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œå¯ä»¥ç²¾ç¡®åˆ°å°æ•°ç‚¹å 7 ä½ï¼‰ã€float64ï¼ˆåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œå¯ä»¥ç²¾ç¡®åˆ°å°æ•°ç‚¹å 15 ä½ï¼‰</li><li>å¤æ•°ç±»å‹ï¼šcomplex64ã€complex128</li><li>å­—ç¬¦ä¸²ï¼šstring</li><li>å­—ç¬¦ç±»å‹ï¼šrune</li><li>é”™è¯¯ç±»å‹ï¼šerror</li></ul><h3 id="å¤åˆç±»å‹"><a href="#å¤åˆç±»å‹" class="headerlink" title="å¤åˆç±»å‹"></a>å¤åˆç±»å‹</h3><ul><li>æŒ‡é’ˆï¼špointer</li><li>æ•°ç»„ï¼šarray</li><li>åˆ‡ç‰‡ï¼šslice <a href="https://ueokande.github.io/go-slice-tricks/">åˆ‡ç‰‡åŠ¨æ€æ“ä½œå›¾ç‰‡ç¤ºä¾‹</a></li><li>å­—å…¸ï¼šmap</li><li>é€šé“ï¼šchan</li><li>ç»“æ„ä½“ï¼šstruct</li><li>æ¥å£ï¼šinterface</li></ul><h4 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h4><table><thead><tr><th>ç±»å‹</th><th>é•¿åº¦ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</th><th>è¯´æ˜</th><th>å€¼èŒƒå›´</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>int8</td><td>1</td><td>å¸¦ç¬¦å·8ä½æ•´å‹</td><td>-128~127</td><td>0</td></tr><tr><td>uint8</td><td>1</td><td>æ— ç¬¦å·8ä½æ•´å‹ï¼Œä¸ byte ç±»å‹ç­‰ä»·</td><td>0~255</td><td>0</td></tr><tr><td>int16</td><td>2</td><td>å¸¦ç¬¦å·16ä½æ•´å‹</td><td>-32768~32767</td><td>0</td></tr><tr><td>uint16</td><td>2</td><td>æ— ç¬¦å·16ä½æ•´å‹</td><td>0~65535</td><td>0</td></tr><tr><td>int32</td><td>4</td><td>å¸¦ç¬¦å·32ä½æ•´å‹ï¼Œä¸ rune ç±»å‹ç­‰ä»·</td><td>-2147483648~2147483647</td><td>0</td></tr><tr><td>uint32</td><td>4</td><td>æ— ç¬¦å·32ä½æ•´å‹</td><td>0~4294967295</td><td>0</td></tr><tr><td>int64</td><td>8</td><td>å¸¦ç¬¦å·64ä½æ•´å‹</td><td>-9223372036854775808~9223372036854775807</td><td>0</td></tr><tr><td>uint64</td><td>8</td><td>æ— ç¬¦å·64ä½æ•´å‹</td><td>0~18446744073709551615</td><td>0</td></tr><tr><td>int</td><td>32ä½æˆ–64ä½</td><td>æ ¹æ®å®¿ä¸»æœºçš„æœºå™¨å­—é•¿å†³å®šï¼ˆint å’Œ uint æ˜¯ä¸€æ ·çš„å¤§å°ï¼‰</td><td>32 ä½çš„æœºå™¨å°±æ˜¯ int32ï¼Œ64 ä½å°±æ˜¯ int64</td><td>0</td></tr><tr><td>uint</td><td>32ä½æˆ–64ä½</td><td>æ ¹æ®å®¿ä¸»æœºçš„æœºå™¨å­—é•¿å†³å®šï¼ˆint å’Œ uint æ˜¯ä¸€æ ·çš„å¤§å°ï¼‰</td><td>32 ä½çš„æœºå™¨å°±æ˜¯ int32ï¼Œ64 ä½å°±æ˜¯ int64</td><td>0</td></tr><tr><td>uintptr</td><td>ä¸å¯¹åº”æŒ‡é’ˆç›¸åŒ</td><td>æ— ç¬¦å·æ•´å‹ï¼Œè¶³ä»¥å­˜å‚¨æŒ‡é’ˆå€¼çš„æœªè§£é‡Šä½</td><td>32ä½å¹³å°ä¸‹ä¸º4å­—èŠ‚ï¼Œ64ä½å¹³å°ä¸‹ä¸º8å­—èŠ‚</td><td>0</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­init å‡½æ•°ã€å˜é‡ã€å¸¸é‡çš„æ‰§è¡Œé¡ºåº</title>
      <link href="posts/40b0fc5c.html"/>
      <url>posts/40b0fc5c.html</url>
      
        <content type="html"><![CDATA[<h1 id="init-å‡½æ•°ã€å˜é‡ã€å¸¸é‡çš„æ‰§è¡Œé¡ºåº"><a href="#init-å‡½æ•°ã€å˜é‡ã€å¸¸é‡çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="init å‡½æ•°ã€å˜é‡ã€å¸¸é‡çš„æ‰§è¡Œé¡ºåº"></a>init å‡½æ•°ã€å˜é‡ã€å¸¸é‡çš„æ‰§è¡Œé¡ºåº</h1><p><img src="/medias/loading.gif" data-original="https://cdn.learnku.com/uploads/images/202011/11/1/ipbtiTb7Fd.png!large" alt="img"></p><ul><li>å‡å¦‚ main å¼•å…¥äº† pkg1 æœ€ç»ˆä¾èµ–äº pkg3ï¼Œpkg3 ä¸­çš„ init() æ–¹æ³•ä¼šä¼˜å…ˆè¢«æ‰§è¡Œï¼›</li><li>åŒä¸€ä¸ªåŒ…é‡Œï¼Œå•æ–‡ä»¶çš„æƒ…å†µï¼Œinit() ä¼˜å…ˆäºå…¶ä»–æ–¹æ³•æ‰§è¡Œï¼ŒåŒ…æ‹¬ main()ï¼›</li><li>åŒä¸€ä¸ªåŒ…é‡Œçš„å¸¸é‡å’Œå˜é‡å£°æ˜ä¼šä¼˜å…ˆäº init() æ–¹æ³•æ‰§è¡Œï¼›</li><li>åŒä¸€ä¸ªæ–‡ä»¶é‡Œå…è®¸å¤šä¸ª init() å­˜åœ¨ï¼Œä¼šæŒ‰ç…§è‡ªä¸Šè€Œä¸‹çš„é¡ºåºæ‰§è¡Œï¼›</li><li>åŒä¸€ä¸ªåŒ…ï¼Œå¤šä¸ªæ–‡ä»¶é‡Œå­˜åœ¨ init() çš„æƒ…å†µï¼Œæ‰§è¡Œé¡ºåºæ˜¯æŒ‰æ–‡ä»¶åçš„å­—æ¯æ’åºæ‰§è¡Œã€‚</li></ul><h2 id="åŒ…å¯¼å…¥è·¯å¾„ä¼˜å…ˆçº§"><a href="#åŒ…å¯¼å…¥è·¯å¾„ä¼˜å…ˆçº§" class="headerlink" title="åŒ…å¯¼å…¥è·¯å¾„ä¼˜å…ˆçº§"></a>åŒ…å¯¼å…¥è·¯å¾„ä¼˜å…ˆçº§</h2><h3 id="å¦‚æœä½¿ç”¨-govendor-æ—¶"><a href="#å¦‚æœä½¿ç”¨-govendor-æ—¶" class="headerlink" title="å¦‚æœä½¿ç”¨ govendor æ—¶"></a>å¦‚æœä½¿ç”¨ <code>govendor</code> æ—¶</h3><ol><li>å…ˆä»é¡¹ç›®æ ¹ç›®å½•çš„ <code>vendor</code> ç›®å½•ä¸‹æŸ¥æ‰¾</li><li>ç„¶åä» $GOROOT/src ç›®å½•ä¸‹æŸ¥æ‰¾</li><li>ç„¶åä» $GOPATH/src ç›®å½•ä¸‹æŸ¥æ‰¾</li><li>éƒ½æ‰¾ä¸åˆ°æ—¶ï¼ŒæŠ¥é”™</li></ol><h3 id="å¦‚æœä½¿ç”¨-go-modules-æ—¶"><a href="#å¦‚æœä½¿ç”¨-go-modules-æ—¶" class="headerlink" title="å¦‚æœä½¿ç”¨ go modules æ—¶"></a>å¦‚æœä½¿ç”¨ <code>go modules</code> æ—¶</h3><ol><li>å¦‚æœå¯¼å…¥çš„åŒ…æœ‰åŸŸåï¼Œåˆ™éƒ½ä¼šåœ¨ $GOPATH/pkg/mod ä¸‹æŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°å°±å»åŸŸåå¯¹åº”çš„ç½‘ç«™ä¸‹å¯»æ‰¾ï¼Œæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°çš„ä¸æ˜¯ä¸€ä¸ªåŒ…ï¼Œåˆ™æŠ¥é”™</li><li>å¦‚æœå¯¼å…¥çš„åŒ…æ²¡æœ‰åŸŸåï¼Œæ¯”å¦‚ <code>fmt</code> åŒ…ï¼Œåˆ™å°±å» $GOROOT ä¸‹æ‰¾</li><li>å¦‚æœé¡¹ç›®æ ¹ç›®å½•ä¸‹å­˜åœ¨ <code>vendor</code> ç›®å½•ï¼Œåˆ™ä¸ç®¡å¯¼å…¥çš„åŒ…æœ‰æ²¡æœ‰åŸŸåï¼Œéƒ½åªä¼šåœ¨ <code>vendor</code> ç›®å½•ä¸­æŸ¥æ‰¾</li></ol><blockquote><p>é€šå¸¸ <code>vendor</code> ç›®å½•æ˜¯é€šè¿‡æ‰§è¡Œ <code>go mod vendor</code> å‘½ä»¤ç”Ÿæˆçš„ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†äº«å‡ ä¸ªGo Slice æŠ€å·§ï¼Œå¤§å¤§æé«˜å·¥ä½œæ•ˆç‡ï¼</title>
      <link href="posts/669a361f.html"/>
      <url>posts/669a361f.html</url>
      
        <content type="html"><![CDATA[<h2 id="å£°æ˜ä¸€ä¸ªæ•°ç»„"><a href="#å£°æ˜ä¸€ä¸ªæ•°ç»„" class="headerlink" title="å£°æ˜ä¸€ä¸ªæ•°ç»„"></a>å£°æ˜ä¸€ä¸ªæ•°ç»„</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token comment">// è®©ç¼–è¯‘å™¨ç»Ÿè®¡æ•°ç»„å­—é¢å€¼ä¸­å…ƒç´ çš„æ•°ç›®</span><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token comment">// ç±»å‹ï¼š [10]int é•¿åº¦ï¼š 10 å®¹é‡ï¼š 10 å€¼ä¸ºï¼š [1 2 3 4 5 6 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç±»å‹ï¼š %T é•¿åº¦ï¼š %v å®¹é‡ï¼š %v å€¼ä¸ºï¼š %v \n"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token comment">// æ¯”è¾ƒï¼Œç±»å‹ï¼š bool ç»“æœï¼š true </span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æ¯”è¾ƒï¼Œç±»å‹ï¼š %T ç»“æœï¼š %v \n"</span><span class="token punctuation">,</span> arr <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> arr <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// æ¯”è¾ƒï¼Œç±»å‹ï¼š bool ç»“æœï¼š true </span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æ¯”è¾ƒï¼Œç±»å‹ï¼š %T ç»“æœï¼š %v \n"</span><span class="token punctuation">,</span> arr <span class="token operator">==</span> arr1<span class="token punctuation">,</span> arr <span class="token operator">==</span> arr1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŸºäºæ•°ç»„åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡"><a href="#åŸºäºæ•°ç»„åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡" class="headerlink" title="åŸºäºæ•°ç»„åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡"></a>åŸºäºæ•°ç»„åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token comment">// åŸºäºæ•°ç»„åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡</span><span class="token keyword">var</span> slice <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment">// ç±»å‹ï¼š [10]int é•¿åº¦ï¼š 10 å®¹é‡ï¼š 10 å€¼ä¸ºï¼š [1 2 3 4 5 6 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç±»å‹ï¼š %T é•¿åº¦ï¼š %v å®¹é‡ï¼š %v å€¼ä¸ºï¼š %v \n"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token comment">// ç±»å‹ï¼š []int é•¿åº¦ï¼š 10 å®¹é‡ï¼š 10 å€¼ä¸ºï¼š [1 2 3 4 5 6 7 8 9 10] </span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç±»å‹ï¼š %T é•¿åº¦ï¼š %v å®¹é‡ï¼š %v å€¼ä¸ºï¼š %v \n"</span><span class="token punctuation">,</span> slice<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> slice<span class="token punctuation">)</span><span class="token comment">// ç±»å‹ä¸åŒï¼Œæ— æ³•è¿ç®—ï¼Œç¼–è¯‘å™¨ç›´æ¥ç¼–è¯‘ä¸è¿‡</span><span class="token comment">// fmt.Printf("æ¯”è¾ƒï¼Œç±»å‹ï¼š %T ç»“æœï¼š %v \n", arr == slice, arr == slice)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ‡ç‰‡æˆªå–"><a href="#åˆ‡ç‰‡æˆªå–" class="headerlink" title="åˆ‡ç‰‡æˆªå–"></a>åˆ‡ç‰‡æˆªå–</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> slice1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token comment">// å·¦é—­å³å¼€çš„ç´¢å¼•åŒºé—´</span><span class="token comment">// slice2 çš„é•¿åº¦ä¸º 3 å³ï¼ˆ6-3=3ï¼‰å®¹é‡ä¸º 7 å³ï¼ˆ10-3=7ï¼‰</span><span class="token keyword">var</span> slice2 <span class="token operator">=</span> slice1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token comment">// slice3 çš„é•¿åº¦ä¸º 3 å³ï¼ˆ6-3=3ï¼‰å®¹é‡ä¸º 6 å³ï¼ˆ9-3=6ï¼‰</span>slice3 <span class="token operator">:=</span> slice1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token comment">// ç±»å‹ï¼š []int é•¿åº¦ï¼š 10 å®¹é‡ï¼š 10 å€¼ä¸ºï¼š [1 2 3 4 5 6 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç±»å‹ï¼š %T é•¿åº¦ï¼š %v å®¹é‡ï¼š %v å€¼ä¸ºï¼š %v \n"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice1<span class="token punctuation">)</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token comment">// ç±»å‹ï¼š []int é•¿åº¦ï¼š 3 å®¹é‡ï¼š 7 å€¼ä¸ºï¼š [4 5 6]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç±»å‹ï¼š %T é•¿åº¦ï¼š %v å®¹é‡ï¼š %v å€¼ä¸ºï¼š %v \n"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice2<span class="token punctuation">)</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// ç±»å‹ï¼š []int é•¿åº¦ï¼š 3 å®¹é‡ï¼š 6 å€¼ä¸ºï¼š [4 5 6]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç±»å‹ï¼š %T é•¿åº¦ï¼š %v å®¹é‡ï¼š %v å€¼ä¸ºï¼š %v \n"</span><span class="token punctuation">,</span> slice3<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice3<span class="token punctuation">)</span><span class="token punctuation">,</span> slice3<span class="token punctuation">)</span>slice4 <span class="token operator">:=</span> slice2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">cap</span><span class="token punctuation">(</span>slice2<span class="token punctuation">)</span><span class="token punctuation">]</span>slice5 <span class="token operator">:=</span> slice3<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">cap</span><span class="token punctuation">(</span>slice3<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment">// slice4 ==&gt; [4 5 6 7 8 9 10]</span><span class="token comment">// slice2 å®é™…å¼•ç”¨çš„æ•°ç»„æ˜¯ [4 5 6 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice4 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice4<span class="token punctuation">)</span><span class="token comment">// slice5 ==&gt; [4 5 6 7 8 9]</span><span class="token comment">// slice3 å®é™…å¼•ç”¨çš„æ•°ç»„æ˜¯ [4 5 6 7 8 9]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice5 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ‡ç‰‡æ‹·è´"><a href="#åˆ‡ç‰‡æ‹·è´" class="headerlink" title="åˆ‡ç‰‡æ‹·è´"></a>åˆ‡ç‰‡æ‹·è´</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> slice1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span>slice2 <span class="token operator">:=</span> slice1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token comment">// slice1 ==&gt; [1 2 3 4 5 6 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice1 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token comment">// slice2 ==&gt; [5 6 7]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice2 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// ä¿®æ”¹åˆ‡å‰²åçš„åˆ‡ç‰‡å€¼ï¼Œå‘ç°åŸå§‹åˆ‡ç‰‡ä¹Ÿè¢«ä¿®æ”¹äº†ï¼ˆæµ…æ‹·è´ï¼Œåˆ‡ç‰‡ä¸ºå¼•ç”¨ä¼ é€’ï¼‰</span>slice2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token comment">// slice1 ==&gt; [1 2 3 4 5 123 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice1 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token comment">// slice2 ==&gt; [5 123 7]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice2 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// å¤åˆ¶ä¸€ä¸ªåˆ‡ç‰‡æ—¶ï¼Œå¦‚æœä¸ç”³æ˜é•¿åº¦ï¼Œæ˜¯ä¸ä¼šå¤åˆ¶çš„</span><span class="token keyword">var</span> slice3 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token function">copy</span><span class="token punctuation">(</span>slice3<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// slice1 ==&gt; [1 2 3 4 5 123 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice1 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token comment">// slice2 ==&gt; [5 123 7]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice2 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// slice3 ==&gt; []</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice3 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice3<span class="token punctuation">)</span>slice4 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">copy</span><span class="token punctuation">(</span>slice4<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// é€šè¿‡å¤åˆ¶åï¼Œä¿®æ”¹å¤åˆ¶åçš„åˆ‡ç‰‡ä¸ä¼šå½±å“åŸåˆ‡ç‰‡ï¼ˆæ·±æ‹·è´ï¼Œå€¼ä¼ é€’ï¼‰</span>slice4<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">567</span><span class="token comment">// slice1 ==&gt; [1 2 3 4 5 123 7 8 9 10]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice1 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token comment">// slice2 ==&gt; [5 123 7]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice2 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token comment">// slice4 ==&gt; [5 567 7] </span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"slice4 ==&gt; %v \n"</span><span class="token punctuation">,</span> slice4<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ArrayChunk-æ•°ç»„åˆ‡å‰²"><a href="#ArrayChunk-æ•°ç»„åˆ‡å‰²" class="headerlink" title="ArrayChunk æ•°ç»„åˆ‡å‰²"></a>ArrayChunk æ•°ç»„åˆ‡å‰²</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ArrayChunkString å°†ä¸€ä¸ªæ•°ç»„åˆ†å‰²æˆå¤šä¸ª</span><span class="token comment">// s := []string{"a1", "a2", "a3", "a4", "a5", "a6", "a7"}</span><span class="token comment">// size := 2</span><span class="token comment">// output: [[a1 a2] [a3 a4] [a5 a6] [a7]]</span><span class="token keyword">func</span> <span class="token function">ArrayChunkString</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span><span class="token keyword">if</span> size <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"size: cannot be less than 1"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>length <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>chunks <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">Ceil</span><span class="token punctuation">(</span><span class="token function">float64</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">float64</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">var</span> n <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> end <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">;</span> chunks <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> chunks<span class="token operator">--</span> <span class="token punctuation">{</span>end <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token keyword">if</span> end <span class="token operator">&gt;</span> length <span class="token punctuation">{</span>end <span class="token operator">=</span> length<span class="token punctuation">}</span>n <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token operator">*</span>size<span class="token punctuation">:</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span>i<span class="token operator">++</span><span class="token punctuation">}</span><span class="token keyword">return</span> n<span class="token punctuation">}</span><span class="token comment">// ArrayChunkInt å°†ä¸€ä¸ªåˆ‡ç‰‡åˆ†å‰²æˆå¤šä¸ª</span><span class="token comment">// i := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}</span><span class="token comment">// size := 3</span><span class="token comment">// output: [[0 1 2] [3 4 5] [6 7 8] [9]]</span><span class="token keyword">func</span> <span class="token function">ArrayChunkInt</span><span class="token punctuation">(</span>i <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span>batches <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span>size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>size<span class="token punctuation">)</span><span class="token keyword">for</span> size <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>i<span class="token punctuation">,</span> batches <span class="token operator">=</span> i<span class="token punctuation">[</span>size<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">append</span><span class="token punctuation">(</span>batches<span class="token punctuation">,</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>size<span class="token punctuation">:</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>batches <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>batches<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token keyword">return</span> batches<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ArrayReverse-æ•°ç»„åè½¬"><a href="#ArrayReverse-æ•°ç»„åè½¬" class="headerlink" title="ArrayReverse æ•°ç»„åè½¬"></a>ArrayReverse æ•°ç»„åè½¬</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ArrayReverseInt æ•°ç»„åè½¬</span><span class="token comment">// i := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}</span><span class="token comment">// output: [9 8 7 6 5 4 3 2 1 0]</span><span class="token keyword">func</span> <span class="token function">ArrayReverseInt</span><span class="token punctuation">(</span>i <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token keyword">for</span> left<span class="token punctuation">,</span> right <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> left<span class="token punctuation">,</span> right <span class="token operator">=</span> left<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> right<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>i<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">return</span> i<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•åœ¨Goä¸­ä½¿ç”¨Swaggerï¼Ÿ</title>
      <link href="posts/53c8a188.html"/>
      <url>posts/53c8a188.html</url>
      
        <content type="html"><![CDATA[<h1 id="Swagger-go-çš„ä½¿ç”¨"><a href="#Swagger-go-çš„ä½¿ç”¨" class="headerlink" title="Swagger go çš„ä½¿ç”¨"></a>Swagger go çš„ä½¿ç”¨</h1><h2 id="http-æœåŠ¡"><a href="#http-æœåŠ¡" class="headerlink" title="http æœåŠ¡"></a>http æœåŠ¡</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/swaggo/swag/cmd/swag@v1.7.8go get <span class="token parameter variable">-u</span> github.com/swaggo/gin-swagger@v1.3.3go get <span class="token parameter variable">-u</span> github.com/swaggo/filesgo get <span class="token parameter variable">-u</span> github.com/alecthomas/template<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ"></a>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">swag <span class="token parameter variable">-v</span><span class="token comment"># swag version v1.7.8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å†™å…¥æ³¨è§£"><a href="#å†™å…¥æ³¨è§£" class="headerlink" title="å†™å…¥æ³¨è§£"></a>å†™å…¥æ³¨è§£</h3><table><thead><tr><th>æ³¨è§£</th><th>æè¿°</th></tr></thead><tbody><tr><td>@Summary</td><td>æ‘˜è¦</td></tr><tr><td>@Produce</td><td>API å¯ä»¥äº§ç”Ÿçš„ MIME ç±»å‹çš„åˆ—è¡¨ï¼ŒMIME ç±»å‹ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå“åº”ç±»å‹ï¼Œä¾‹å¦‚ï¼šjsonã€xmlã€html ç­‰ç­‰</td></tr><tr><td>@Param</td><td>å‚æ•°æ ¼å¼ï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šå‚æ•°åã€å…¥å‚ç±»å‹ã€æ•°æ®ç±»å‹ã€æ˜¯å¦å¿…å¡«ã€æ³¨é‡Š</td></tr><tr><td>@Success</td><td>å“åº”æˆåŠŸï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šçŠ¶æ€ç ã€å‚æ•°ç±»å‹ã€æ•°æ®ç±»å‹ã€æ³¨é‡Š</td></tr><tr><td>@Failure</td><td>å“åº”å¤±è´¥ï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šçŠ¶æ€ç ã€å‚æ•°ç±»å‹ã€æ•°æ®ç±»å‹ã€æ³¨é‡Š</td></tr><tr><td>@Router</td><td>è·¯ç”±ï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šè·¯ç”±åœ°å€ï¼ŒHTTP æ–¹æ³•</td></tr></tbody></table><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// @Summary æ–°å¢æ ‡ç­¾</span><span class="token comment">// @Produce  json</span><span class="token comment">// @Param name body string true "æ ‡ç­¾åç§°" minlength(3) maxlength(100)</span><span class="token comment">// @Param state body int false "çŠ¶æ€" Enums(0, 1) default(1)</span><span class="token comment">// @Param created_by body string false "åˆ›å»ºè€…" minlength(3) maxlength(100)</span><span class="token comment">// @Success 200 {object} model.Tag "æˆåŠŸ"</span><span class="token comment">// @Failure 400 {object} errcode.Error "è¯·æ±‚é”™è¯¯"</span><span class="token comment">// @Failure 500 {object} errcode.Error "å†…éƒ¨é”™è¯¯"</span><span class="token comment">// @Router /api/v1/tags [post]</span><span class="token keyword">func</span> <span class="token punctuation">(</span>t Tag<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é’ˆå¯¹é¡¹ç›®å†™æ³¨è§£"><a href="#é’ˆå¯¹é¡¹ç›®å†™æ³¨è§£" class="headerlink" title="é’ˆå¯¹é¡¹ç›®å†™æ³¨è§£"></a>é’ˆå¯¹é¡¹ç›®å†™æ³¨è§£</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// @title gin-blog-service åšå®¢ç³»ç»Ÿ</span><span class="token comment">// @version 1.0</span><span class="token comment">// @description gin-blog-service å­¦ä¹  gin å†™çš„ä¸€ä¸ªåšå®¢ç³»ç»Ÿ</span><span class="token comment">// @termsOfService https://github.com/pudongping/gin-blog-service</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç”Ÿæˆæ–‡æ¡£"><a href="#ç”Ÿæˆæ–‡æ¡£" class="headerlink" title="ç”Ÿæˆæ–‡æ¡£"></a>ç”Ÿæˆæ–‡æ¡£</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">swag init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æ·»åŠ -swagger-è®¿é—®è·¯ç”±"><a href="#æ·»åŠ -swagger-è®¿é—®è·¯ç”±" class="headerlink" title="æ·»åŠ  swagger è®¿é—®è·¯ç”±"></a>æ·»åŠ  swagger è®¿é—®è·¯ç”±</h3><blockquote><p>è¿™é‡Œä»¥ <code>gin</code> æ¡†æ¶ä¸­ä½¿ç”¨ä¸ºä¾‹</p></blockquote><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"github.com/gin-gonic/gin"</span>ginSwagger <span class="token string">"github.com/swaggo/gin-swagger"</span><span class="token string">"github.com/swaggo/gin-swagger/swaggerFiles"</span>    <span class="token comment">// åˆå§‹åŒ– docs åŒ…ï¼Œå†…å«æœ‰ swagger ç”Ÿæˆçš„æ–‡æ¡£</span><span class="token boolean">_</span> <span class="token string">"github.com/pudongping/gin-blog-service/docs"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">NewRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>gin<span class="token punctuation">.</span>Engine <span class="token punctuation">{</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¦‚æœæœ‰é¢å¤–éœ€æ±‚ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šè®¿é—®åœ°å€</span><span class="token comment">// swaggerUrl := ginSwagger.URL("http://127.0.0.1:8000/swagger/doc.json")</span><span class="token comment">// r.GET("/swagger/*any", ginSwagger.WrapHandler(swaggerFiles.Handler, swaggerUrl))</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/swagger/*any"</span><span class="token punctuation">,</span> ginSwagger<span class="token punctuation">.</span><span class="token function">WrapHandler</span><span class="token punctuation">(</span>swaggerFiles<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> r<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="grpc-æœåŠ¡"><a href="#grpc-æœåŠ¡" class="headerlink" title="grpc æœåŠ¡"></a>grpc æœåŠ¡</h2><h3 id="å®‰è£…-protoc-æ’ä»¶-protoc-gen-swagger"><a href="#å®‰è£…-protoc-æ’ä»¶-protoc-gen-swagger" class="headerlink" title="å®‰è£… protoc æ’ä»¶ protoc-gen-swagger"></a>å®‰è£… protoc æ’ä»¶ protoc-gen-swagger</h3><blockquote><p>protoc-gen-swagger çš„ä½œç”¨æ˜¯é€šè¿‡ proto æ–‡ä»¶æ¥ç”Ÿæˆ swagger å®šä¹‰ï¼ˆ.swagger.jsonï¼‰</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¸‹è½½-Swagger-UI-æ–‡ä»¶"><a href="#ä¸‹è½½-Swagger-UI-æ–‡ä»¶" class="headerlink" title="ä¸‹è½½ Swagger UI æ–‡ä»¶"></a>ä¸‹è½½ Swagger UI æ–‡ä»¶</h3><p>Swagger æä¾›å¯è§†åŒ–çš„æ¥å£ç®¡ç†å¹³å°ï¼Œä¹Ÿå°±æ˜¯ Swagger UIï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ° <a href="https://github.com/swagger-api/swagger-ui">https://github.com/swagger-api/swagger-ui</a> ä¸Šå°†å…¶æºç å‹ç¼©åŒ…ä¸‹è½½ä¸‹æ¥ï¼Œæ¥ç€åœ¨é¡¹ç›®çš„ third_party ç›®å½•ä¸‹æ–°å»º swagger-ui ç›®å½•ï¼Œå°†å…¶ dist ç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºæ–‡ä»¶æ‹·è´åˆ°æˆ‘ä»¬é¡¹ç›®çš„ third_party/swagger-ui ç›®å½•ä¸­å»ã€‚</p><h3 id="é™æ€èµ„æºè½¬æ¢"><a href="#é™æ€èµ„æºè½¬æ¢" class="headerlink" title="é™æ€èµ„æºè½¬æ¢"></a>é™æ€èµ„æºè½¬æ¢</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†é™æ€æ–‡ä»¶è½¬æ¢ä¸º go ä»£ç </span>go get <span class="token parameter variable">-u</span> github.com/go-bindata/go-bindata/<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨é¡¹ç›®çš„ <code>pkg</code> ç›®å½•ä¸‹æ–°å»º <code>swagger</code> ç›®å½•ï¼Œå¹¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹è½¬æ¢å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨æ‰§è¡Œå®Œæ¯•åï¼Œåº”å½“åœ¨é¡¹ç›®çš„ pkg/swagger ç›®å½•ä¸‹åˆ›å»ºäº† data.go æ–‡ä»¶</span>go-bindata <span class="token parameter variable">--nocompress</span> <span class="token parameter variable">-pkg</span> swagger <span class="token parameter variable">-o</span> pkg/swagger/data.go third_party/swagger-ui/<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Swagger-UI-å¤„ç†å’Œè®¿é—®"><a href="#Swagger-UI-å¤„ç†å’Œè®¿é—®" class="headerlink" title="Swagger UI å¤„ç†å’Œè®¿é—®"></a>Swagger UI å¤„ç†å’Œè®¿é—®</h3><p>ä¸ºäº†è®©åˆšåˆšè½¬æ¢çš„é™æ€èµ„æºä»£ç èƒ½å¤Ÿè®©å¤–éƒ¨è®¿é—®åˆ°ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… go-bindata-assetfs åº“ï¼Œå®ƒèƒ½å¤Ÿç»“åˆ net/http æ ‡å‡†åº“å’Œ go-bindata æ‰€ç”Ÿæˆ Swagger UI çš„ Go ä»£ç ä¸¤è€…æ¥ä¾›å¤–éƒ¨è®¿é—®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/elazarl/go-bindata-assetfs/<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼•å…¥å¹¶ä½¿ç”¨</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>assetfs <span class="token string">"github.com/elazarl/go-bindata-assetfs"</span><span class="token string">"github.com/pudongping/go-grpc-service/pkg/swagger"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">runHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>http<span class="token punctuation">.</span>ServeMux <span class="token punctuation">{</span>httpMux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>httpMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/ping"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">`pong`</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// ä»£ç å¤§è‡´è°ƒæ•´è¿™é‡Œ start</span>prefix <span class="token operator">:=</span> <span class="token string">"/swagger-ui/"</span>fileServer <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">FileServer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>assetfs<span class="token punctuation">.</span>AssetFS<span class="token punctuation">{</span>Asset<span class="token punctuation">:</span>    swagger<span class="token punctuation">.</span>Asset<span class="token punctuation">,</span>AssetDir<span class="token punctuation">:</span> swagger<span class="token punctuation">.</span>AssetDir<span class="token punctuation">,</span>Prefix<span class="token punctuation">:</span>   <span class="token string">"third_party/swagger-ui"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>httpMux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">StripPrefix</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> fileServer<span class="token punctuation">)</span><span class="token punctuation">)</span>httpMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/swagger/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">"swagger.json"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>p <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">TrimPrefix</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">"/swagger/"</span><span class="token punctuation">)</span>p <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">"proto"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>http<span class="token punctuation">.</span><span class="token function">ServeFile</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">// ä»£ç å¤§è‡´è°ƒæ•´è¿™é‡Œ end</span><span class="token keyword">return</span> httpMux<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡æ–°è¿è¡ŒæœåŠ¡ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://127.0.0.1:8004/swagger-ui/</code> å³å¯è®¿é—® swagger é¢æ¿</p><p>è®¿é—®è‡ªå·±çš„ swagger æ–‡æ¡£æ¥å£ <code>http://127.0.0.1:8004/swagger/tag.swagger.json</code></p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åŒæ—¶å®‰è£…å¤šä¸ªä¸åŒç‰ˆæœ¬çš„Goï¼ŸGVMå°±å¯ä»¥ï¼</title>
      <link href="posts/c10fde57.html"/>
      <url>posts/c10fde57.html</url>
      
        <content type="html"><![CDATA[<h1 id="GVM"><a href="#GVM" class="headerlink" title="GVM"></a><a href="https://github.com/moovweb/gvm">GVM</a></h1><blockquote><p>å®‰è£…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°äº†é”™è¯¯ï¼Œè¿˜æ˜¯ç›´æ¥å…ˆè®¿é—®ä»“åº“åœ°å€çœ‹çœ‹æ–‡æ¡£ä»‹ç»ï¼Œå¯èƒ½è§£å†³å¾—æ›´å¿«ã€‚</p></blockquote><h2 id="å®‰è£…å¹¶ä½¿ç”¨"><a href="#å®‰è£…å¹¶ä½¿ç”¨" class="headerlink" title="å®‰è£…å¹¶ä½¿ç”¨"></a>å®‰è£…å¹¶ä½¿ç”¨</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">bash</span> <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-S</span> <span class="token parameter variable">-L</span> https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer<span class="token punctuation">)</span><span class="token comment"># ä¹Ÿå¯ä»¥å…ˆæŠŠè„šæœ¬å…ˆä¸‹è½½ä¸‹æ¥ï¼Œç„¶åæ‰§è¡Œ</span><span class="token function">curl</span> <span class="token parameter variable">-o</span> gvm-installer https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer<span class="token function">chmod</span> +x gvm-installer./gvm-installer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å¯ç”¨çš„ go ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm listall<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ go</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™é‡Œçš„ç‰ˆæœ¬å·ç”± `gvm listall` å‘½ä»¤è¿”å›çš„ç‰ˆæœ¬å·ä¹‹ä¸€</span>gvm <span class="token function">install</span> go1.16.5<span class="token comment"># ä¸‹è½½åçš„ go ä½äº `~/.gvm/gos` ç›®å½•ä¸‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„ go ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm list<span class="token comment"># gvm gos (installed)</span><span class="token comment">#</span><span class="token comment">#   go1.17</span><span class="token comment">#   go1.17.13</span><span class="token comment">#   go1.20.8</span><span class="token comment">#=&gt; go1.21.0</span><span class="token comment">#   system</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ go</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm use go1.16.5<span class="token comment"># è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬çš„ go</span>gvm use go1.16.5 <span class="token parameter variable">--default</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¸è½½ç‰¹å®šç‰ˆæœ¬çš„ go</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm uninstall go1.16.5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ…é‡ï¼ï¼ï¼</strong> å®Œå…¨å¸è½½æ‰ GVM å’Œæ‰€æœ‰å®‰è£…çš„ Go ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm implode<span class="token comment"># å¦‚æœä»¥ä¸Šçš„å‘½ä»¤ä¸å¥æ•ˆçš„è¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token variable">$GVM_ROOT</span><span class="token comment"># ç„¶åå»é™¤æ‰ ~/.zshrc æ–‡ä»¶ä¸­çš„ç±»ä¼¼ä»¥ä¸‹å†…å®¹å³å¯ï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯ bash åˆ™åœ¨ ~/.bashrc æ–‡ä»¶ä¸­ï¼‰</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-s</span> <span class="token string">"/Users/pudongping/.gvm/scripts/gvm"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> <span class="token string">"/Users/pudongping/.gvm/scripts/gvm"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨-GVM-pkgset"><a href="#ä½¿ç”¨-GVM-pkgset" class="headerlink" title="ä½¿ç”¨ GVM pkgset"></a>ä½¿ç”¨ GVM pkgset</h2><blockquote><p>ä½¿ç”¨ pkgset å¯ä»¥å°†ä½ æ¯ä¸€ä¸ªé¡¹ç›®çš„ä¾èµ–åŒ…éƒ½åˆ†éš”å¼€æ¥ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ç³»ç»Ÿç¯å¢ƒå˜é‡</span><span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span><span class="token comment"># å¯è§å·²ç»å°† `~/.gvm/bin` åŠ å…¥äº†ç¯å¢ƒå˜é‡ä¸­</span><span class="token comment"># /Users/pudongping/.gvm/bin</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆä½¿ç”¨ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ <code>go1.21.0</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm use go1.21.0<span class="token comment"># Now using version go1.21.0</span>gvm list<span class="token comment"># gvm gos (installed)</span><span class="token comment">#</span><span class="token comment">#   go1.17</span><span class="token comment">#   go1.17.13</span><span class="token comment">#   go1.20.8</span><span class="token comment">#=&gt; go1.21.0</span><span class="token comment">#   system</span><span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span><span class="token comment"># /Users/pudongping/.gvm/pkgsets/go1.21.0/global/bin:/Users/pudongping/.gvm/gos/go1.21.0/bin:/Users/pudongping/.gvm/pkgsets/go1.21.0/global/overlay/bin:/Users/pudongping/.gvm/bin</span><span class="token comment"># æ­¤æ—¶å¯è§å¤šæ·»åŠ äº†</span><span class="token comment"># ~/.gvm/pkgsets/{GO_VERSION}/global/bin</span><span class="token comment"># ~/.gvm/gos/{GO_VERSION}/bin</span><span class="token comment"># ~/.gvm/pkgsets/{GO_VERSION}/global/overlay/bin</span><span class="token builtin class-name">echo</span> <span class="token variable">$GOPATH</span><span class="token comment"># /Users/pudongping/.gvm/pkgsets/go1.21.0/global</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ <strong>global</strong> pkgset</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gvm pkgset list<span class="token comment">#gvm go package sets (go1.21.0)</span><span class="token comment">#</span><span class="token comment">#=&gt;  global</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ›å»ºç‰¹å®šçš„ pkgset</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºä¸€ä¸ªåä¸º `ppGvm` çš„ pkgset</span>gvm pkgset create ppGvmgvm pkgset list<span class="token comment">#</span><span class="token comment">#gvm go package sets (go1.21.0)</span><span class="token comment">#</span><span class="token comment">#=&gt;  global</span><span class="token comment">#    ppGvm</span> <span class="token comment"># æ­¤æ—¶æŸ¥çœ‹ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œè¿˜ä¸ä¼šå°† `ppGvm` åŠ å…¥    </span><span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span><span class="token comment"># /Users/pudongping/.gvm/pkgsets/go1.21.0/global/bin:/Users/pudongping/.gvm/gos/go1.21.0/bin:/Users/pudongping/.gvm/pkgsets/go1.21.0/global/overlay/bin:/Users/pudongping/.gvm/bin</span><span class="token builtin class-name">echo</span> <span class="token variable">$GOPATH</span><span class="token comment"># /Users/pudongping/.gvm/pkgsets/go1.21.0/global</span><span class="token comment"># ä½¿ç”¨ `ppGvm` pkgset</span>gvm pkgset use ppGvm<span class="token comment"># Now using pkgset go1.21.0@ppGvm</span>gvm pkgset list<span class="token comment">#</span><span class="token comment">#gvm go package sets (go1.21.0)</span><span class="token comment">#</span><span class="token comment">#    global</span><span class="token comment">#=&gt;  ppGvm</span><span class="token comment"># æ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å°† `ppGvm` åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­</span><span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span><span class="token comment"># /Users/pudongping/.gvm/pkgsets/go1.21.0/ppGvm/bin:/Users/pudongping/.gvm/pkgsets/go1.21.0/ppGvm/overlay/bin:/Users/pudongping/.gvm/pkgsets/go1.21.0/global/bin:/Users/pudongping/.gvm/gos/go1.21.0/bin:/Users/pudongping/.gvm/pkgsets/go1.21.0/global/overlay/bin:/Users/pudongping/.gvm/bin</span><span class="token builtin class-name">echo</span> <span class="token variable">$GOPATH</span><span class="token comment"># /Users/pudongping/.gvm/pkgsets/go1.21.0/ppGvm:/Users/pudongping/.gvm/pkgsets/go1.21.0/global</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ­¤æ—¶ä½ é€šè¿‡ <code>go get</code> ä¸‹è½½ go åŒ…çš„è¯ï¼Œä½ å¯ä»¥çœ‹åˆ°æ–°çš„åŒ…è¢«æ·»åŠ åˆ°äº†ä»¥ä¸‹ç›®å½•ä¸‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable"><span class="token variable">$(</span> <span class="token function">awk</span> -F<span class="token string">':'</span> <span class="token string">'{print $1}'</span> <span class="token operator">&lt;&lt;&lt;</span> $GOPATH <span class="token variable">)</span></span><span class="token comment"># æˆ–è€…ç›´æ¥ cd /Users/pudongping/.gvm/pkgsets/go1.21.0/ppGvm</span><span class="token builtin class-name">pwd</span><span class="token comment">#/Users/pudongping/.gvm/pkgsets/go1.21.0/ppGvm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangä¸­é‡åˆ°â€œnote module requires Go xxxâ€åçš„è§£å†³æ–¹æ¡ˆï¼Œä¸å‡çº§Goç‰ˆæœ¬ï¼</title>
      <link href="posts/1c839b10.html"/>
      <url>posts/1c839b10.html</url>
      
        <content type="html"><![CDATA[<p>å‰å‡ å¤©ï¼Œéœ€è¦å¯¹ä¸€ä¸ªä¸¤å¹´å‰å†™çš„é¡¹ç›®æ·»åŠ ç‚¹å„¿æ–°åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°ä¸€ä¸ª Http å®¢æˆ·ç«¯åŒ…ï¼Œäºæ˜¯å°±ç”¨äº† <code>https://github.com/go-resty/resty</code> è¿™ä¸ªæ’ä»¶åŒ…ã€‚</p><p>æˆ‘å…ˆæ˜¯ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œäº†ä»¥ä¸‹åŒ…çš„å®‰è£…å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-v</span> github.com/go-resty/resty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å®ä¾‹åŒ–äº† <code>client := resty.New()</code> å¯¹è±¡ï¼Œç´§æ¥ç€æˆ‘æƒ³å…ˆå¯åŠ¨ä¸€ä¸‹é¡¹ç›®ï¼Œçœ‹è¿™ä¸ªåŒ…æ˜¯å¦æ­£å¸¸å¯ç”¨ï¼Œç»“æœï¼Œæ‰§è¡Œ <code>go run main.go</code> å‘½ä»¤æ—¶ï¼Œå°±æŠ¥ä»¥ä¸‹é”™è¯¯äº†ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0760e7ef8be84cf3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŠ¥é”™äº†"></p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŠ¥é”™æç¤ºæ˜¯ï¼š<code>note: module requires Go 1.17</code> å› ä¸ºï¼Œæˆ‘ç°åœ¨ç»´æŠ¤çš„è¿™ä¸ªé¡¹ç›®æ˜¯ä¸¤å¹´å‰å†™çš„ï¼Œé‚£ä¸ªæ—¶å€™ Go æ¯”è¾ƒç¨³å®šçš„ç‰ˆæœ¬è¿˜æ˜¯ <code>go 1.16</code> å› æ­¤ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿæ˜¯åŸºäº <code>go 1.16</code> ç‰ˆæœ¬å†™çš„ã€‚å¯è¿‘æœŸ Go çš„ç‰ˆæœ¬è¿­ä»£éå¸¸å¿«ï¼Œæˆªæ­¢å‘ç¨¿ï¼Œç°åœ¨ Go å·²ç»è¿­ä»£åˆ° <code>go 1.22.2</code> ç‰ˆæœ¬äº†ï¼Œå¹¶ä¸”æ¯ä¸ªç‰ˆæœ¬ä¹‹é—´å·®å¼‚ä¹Ÿä¸å°ï¼Œå› æ­¤è·¨ç‰ˆæœ¬ä¹‹åå°±éœ€è¦è§£å†³ä¸€äº›å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>å›åˆ°åˆšåˆšçš„æŠ¥é”™æç¤ºï¼š<code>module requires Go 1.17</code> æˆ‘ä»¬å¤§è‡´å¯è§å°±æ˜¯<strong>æœ‰éƒ¨åˆ†æ’ä»¶åŒ…ä¾èµ–äº† Go 1.17</strong> é«˜ç‰ˆæœ¬ï¼Œè€Œæˆ‘ç°åœ¨æœ¬åœ°ç‰ˆæœ¬è¿˜æ˜¯ Go 1.16ï¼Œç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´ï¼Œé‚£ä¹ˆï¼Œåº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><h2 id="æ¢è®¨è§£å†³æ–¹æ¡ˆ"><a href="#æ¢è®¨è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ¢è®¨è§£å†³æ–¹æ¡ˆ"></a>æ¢è®¨è§£å†³æ–¹æ¡ˆ</h2><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‡çº§ä¸€ä¸‹ Go çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥å°±ä¼šè¿åˆƒè€Œè§£ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šè·‘äº†ä¸¤å¹´å¤šäº†ï¼Œç°åœ¨è´¸ç„¶çš„å»å‡çº§ Go ç‰ˆæœ¬ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰äº›ä¸å¦¥ï¼Œæ¯•ç«Ÿæ²¡æœ‰ä»€ä¹ˆæ¯”é¡¹ç›®ç¨³å®šæ›´åŠ é‡è¦äº†ã€‚</p><p>ä¸èƒ½å»å‡çº§ Go ç‰ˆæœ¬ï¼Œé‚£å°±åªæœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆäº†ã€‚</p><p><strong>æ‰¾åˆ°æœ‰é—®é¢˜çš„æ’ä»¶åŒ…ï¼Œç„¶åå¯¹æœ‰é—®é¢˜çš„ä¾èµ–åŒ…è¿›è¡Œé™çº§å°±å¥½äº†</strong>ã€‚ä½†æ˜¯ï¼Œé—®é¢˜æ˜¯ï¼šå¦‚ä½•å¿«é€Ÿä¸”å‡†ç¡®çš„æ‰¾åˆ°è¿™ä¸ªä¾èµ–åŒ…å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å†å›åˆ°åˆšåˆšçš„æŠ¥é”™æç¤ºï¼Œå¯ä»¥ä»”ç»†æŸ¥çœ‹åˆ°ï¼Œå¯èƒ½è·Ÿ <code>golang.org/x/sys@v0.13.0</code> è¿™ä¸ªåŒ…æœ‰å…³ç³»ï¼Œæ¯•ç«Ÿé”™è¯¯ä¿¡æ¯ä¸­å°±å«æœ‰å®ƒã€‚</p><p>é‚£ä¹ˆï¼ŒæŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ­¥ä¸€æ­¥æŸ¥åˆ°æ¯ä¸ªåŒ…çš„ä¾èµ–ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¥½å®šä½é—®é¢˜ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°ç›´æ¥ä½¿ç”¨ <code>go mod graph</code> å‘½ä»¤æ¥æŸ¥çœ‹é¡¹ç›®ç°æœ‰çš„ç»“æ„å›¾ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®ä¾èµ–çš„åŒ…ä¸ç®—å¤šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å‹‰å‹‰å¼ºå¼ºæ‹å¾—æ¸…æ¥šç›¸å…³çš„ä¾èµ–ï¼Œå¦‚æœä¾èµ–åŒ…æ¯”è¾ƒå¤šäº†ï¼Œä¼°è®¡ä¹Ÿçœ‹éº»äº†å§â€¦â€¦</p><h2 id="å€ŸåŠ©å·¥å…·æ¥æŸ¥æ‰¾ä¾èµ–å…³ç³»"><a href="#å€ŸåŠ©å·¥å…·æ¥æŸ¥æ‰¾ä¾èµ–å…³ç³»" class="headerlink" title="å€ŸåŠ©å·¥å…·æ¥æŸ¥æ‰¾ä¾èµ–å…³ç³»"></a>å€ŸåŠ©å·¥å…·æ¥æŸ¥æ‰¾ä¾èµ–å…³ç³»</h2><p>ä½ ä¼šå‘ç°æ ¹æœ¬æ— ä»çœ‹èµ·ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥å€ŸåŠ©æŸäº›å·¥å…·æ¥æŸ¥çœ‹å‘¢ï¼Ÿå…¶å®ï¼Œæˆ‘ä¹Ÿä¸ç¡®å®šæœ‰æ²¡æœ‰è¿™æ ·çš„å·¥å…·ï¼Œé‚£è¿˜æ˜¯è€å¥—è·¯å‘—ï¼Œç›´æ¥å» Github ä¸Šæœä¸€æ³¢è¯•äº†çœ‹ï¼Œç»“æœï¼Œä¸€æœè¿˜çœŸæœ‰ï¼</p><p>å°±æ˜¯è¿™ä¸ªåŒ…ï¼š<code>https://github.com/PaulXu-cn/go-mod-graph-chart</code> çœ‹äº†ä¸‹åŒ…ä»‹ç»ï¼š<strong>â€œä¸€ä¸ªèƒ½å°† <code>go mod graph</code> è¾“å‡ºå†…å®¹å¯è§†åŒ–çš„æ— ä¾èµ–å°å·¥å…·â€</strong> ï¼Œè¿™ä¸æ­£æ˜¯æˆ‘éœ€è¦çš„å˜›ï¼</p><p>æœæ–­ç”¨èµ·æ¥ï¼</p><p>ç”±äºè¿™ä¸ªå°å·¥å…·æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œäºæ˜¯ç›´æ¥ä½¿ç”¨ <code>go install</code> å‘½ä»¤å®‰è£…äº†ä¸‹ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-50d8c5f97c29c6f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨å·¥å…·"></p><p>ç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ <code>go mod graph | gmchart -keep 1</code> ï¼ˆè®¾ç½® <code>-keep 1</code> æ˜¯ä¸ºäº†ä¿è¯ HTTP æœåŠ¡æ°¸ä¸é€€å‡ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å®Œå…¨ä¸è®¾ç½®ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ gmchart å¯åŠ¨çš„ HTTP æœåŠ¡å°±åªä¼šå¯åŠ¨ä¸€åˆ†é’Ÿã€‚ï¼‰</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2148d071f6be258b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯åŠ¨å·¥å…·"></p><p>å½“ä½ æ‰§è¡Œå®Œä»¥ä¸Šå‘½ä»¤ä¹‹åï¼Œä¼šåœ¨æµè§ˆå™¨ä¸­è‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªå¯è§†åŒ–çš„å±•ç¤ºå›¾è¡¨ã€‚è¿™ä¸ªå·¥å…·å…¶å®å°±æ˜¯å°† <code>go mod graph</code> å‘½ä»¤è¾“å‡ºçš„å†…å®¹ä»¥<strong>æ ‘çŠ¶</strong>çš„å½¢å¼æ¸²æŸ“æˆ web é¡µé¢å±•ç¤ºäº†å‡ºæ¥ï¼Œæ›´åŠ æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ¯ä¸ªåŒ…çš„ä¾èµ–å…³ç³»ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a327b7f04b13f9d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç›´æ¥æœç´¢ä¾èµ–"></p><p>æœ‰äº†è¿™ä¸ªå·¥å…·çš„ååŠ©ï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥å»è§£å†³åˆšåˆšçš„æŠ¥é”™é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æœç´¢ <code>sys@v0.13.0</code> å…³é”®è¯ï¼Œçœ‹è¿™ä¸ªåŒ…è¢«å“ªäº›åŒ…ä¾èµ–ï¼Œç„¶åä¾æ¬¡æ£€æŸ¥å„ä¸ªä¾èµ–åŒ…æ‰€æ”¯æŒçš„ç‰ˆæœ¬ï¼Œå¦‚æœé«˜äº <code>go 1.16</code> é‚£ä¹ˆåˆ™ç›´æ¥å°†è¿™ä¸ªåŒ…é™çº§å°±å¥½äº†ã€‚</p><p>æœåˆ° <code>x/sys@v0.13.0</code> ä¹‹åï¼Œæˆ‘ä»¬å¯¹ç€å®ƒç‚¹å‡»ä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹è§å¦‚ä¸‹ï¼Œæœ‰ä¸‰ä¸ªåŒ…ä¾èµ–äº† <code>golang.org/x/sys@v0.13.0</code> åŒ…ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1cc83cbb02dd48f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¡®å®šä¾èµ–å…³ç³»"></p><p>ç°åœ¨çš„æ€è·¯å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªåŒ…å»æ‰¾ï¼ŒæŠŠä¾èµ–é«˜ç‰ˆæœ¬çš„åŒ…æ‰¾å‡ºæ¥ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®åŒ…çš„ä¸‹è½½åœ°å€ <code>golang.org/x/net</code> å‘ç°å®ƒä¼šè‡ªåŠ¨é‡å®šå‘åˆ° <code>https://pkg.go.dev/golang.org/x/net</code> åœ°å€ä¸Šï¼Œè¿™æ˜¯ç”±äºå®˜æ–¹åŒ…æ¢äº†åŸŸåå¯¼è‡´ï¼Œä¸ç”¨å¤ªåœ¨æ„è¿™ç‚¹ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3cf5b39fd0d37fbf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰¾åˆ°å…·ä½“åŒ…"></p><p>æˆªè‡³å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œ<code>golang.org/x/net</code> çš„ Latest ç‰ˆæœ¬æ˜¯ v0.22.0ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“æ­¤æ—¶çš„ç‰ˆæœ¬ä¾èµ–äºä»€ä¹ˆç‰ˆæœ¬çš„ Go å‘¢ï¼Ÿæ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥å»æŸ¥çœ‹è¿™ä¸ªåŒ…çš„ <code>go.mod</code> æ–‡ä»¶ï¼Œå°±ä¸€ç›®äº†ç„¶äº†ã€‚</p><blockquote><p>åœ¨ Go Modules æ¨¡å¼ä¸‹ï¼Œé¡¹ç›®æ ¹ç›®å½•çš„ go.mod æ–‡ä»¶ä¸­ï¼Œéƒ½ä¼šè®°å½•å½“å‰é¡¹ç›®ä¾èµ–çš„ Go æœ€ä½ç‰ˆæœ¬ã€‚</p></blockquote><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-79fe07d35d94c8e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰¾åˆ°æŒ‡å®šç‰ˆæœ¬"></p><p>æˆ‘ä»¬å¯¹ç€ Latest å·¦ä¾§çš„ç‰ˆæœ¬ç‚¹ä¸€ä¸‹ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°æ‰€æœ‰çš„ç‰ˆæœ¬ã€‚å› ä¸ºåœ¨æˆ‘çš„é¡¹ç›®ä¸­é‡‡ç”¨çš„ç‰ˆæœ¬æ˜¯ <code>golang.org/x/net@v0.17.0</code> å› æ­¤ï¼Œæˆ‘ä»¬å…ˆä¼˜å…ˆæŸ¥çœ‹è¿™ä¸ªç‰ˆæœ¬çš„ <code>go.mod</code> æ–‡ä»¶ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-19da41b4a3e7bdde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹go.mod"></p><p>è¿›å…¥åˆ°æŒ‡å®šç‰ˆæœ¬é¡µé¢ä¹‹åï¼Œå†ç‚¹å‡»é¡µé¢å³ä¸Šæ–¹ä¾§çš„ <code>go.mod</code> å¤„ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bb730c130fb98188.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„go.modå†…å®¹"></p><p>æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªç‰ˆæœ¬çš„ go.mod æ–‡ä»¶äº†ï¼Œè¯¶â€¦â€¦ æ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±çœ‹åˆ°äº† <code>go 1.17</code> å­—çœ¼äº†ï¼Ÿæœ‰ç‚¹å„¿å°æ¿€åŠ¨äº†ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿé‚£ä¹ˆï¼Œæˆ‘ä»¬åªéœ€è¦å¾€å‰é¢çš„ç‰ˆæœ¬ä¸­å»æ‰¾ï¼Œåªè¦æ‰¾åˆ°æœ‰ä¸€ä¸ªæœ€å¤§çš„ç‰ˆæœ¬æ˜¯ä¾èµ–äº <code>go 1.16</code> å°±è¡Œï¼Œç„¶åï¼Œæˆ‘å°±å¼€å§‹ç»§ç»­æ‰¾å‘€æ‰¾â€¦â€¦</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-67d9f7360bc3c0ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹å„ä¸ªç‰ˆæœ¬"></p><p>ç‚¹å‡»ä¾èµ–åŒ…çš„ç‰ˆæœ¬ä½ç½®å¤„ï¼Œå¯è§æ‰€æœ‰çš„ç‰ˆæœ¬ï¼Œç„¶åæˆ‘ä»¬ä¸€ä¸ªç‰ˆæœ¬ä¸€ä¸ªç‰ˆæœ¬çš„ç‚¹å‡»åçœ‹çœ‹ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bd14b74f47b45584.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ€å°çš„ç‰ˆæœ¬ä¹Ÿæ˜¯ä¾èµ–go 1.17"></p><p>å‘ç°ï¼Œæ¯”è¾ƒæ¶å¿ƒçš„ä¸€å¹•å‡ºç°äº†ï¼<strong>è¿æœ€ä½çš„ç‰ˆæœ¬ v0.1.0 å°±æ˜¯ä¾èµ–äº go 1.17 ï¼</strong>  çœŸæ˜¯ WTF ï¼</p><h2 id="å†æ¬¡ç¢°å£ï¼é‡åˆ°éš¾é¢˜"><a href="#å†æ¬¡ç¢°å£ï¼é‡åˆ°éš¾é¢˜" class="headerlink" title="å†æ¬¡ç¢°å£ï¼é‡åˆ°éš¾é¢˜"></a>å†æ¬¡ç¢°å£ï¼é‡åˆ°éš¾é¢˜</h2><p>é‚£â€¦â€¦è¿™ä¸ªé—®é¢˜å°±æ²¡æœ‰è§£äº†å—ï¼Ÿå…¶å®å¹¶ä¸æ˜¯ï¼Œæˆ‘ä»¬å¿½ç•¥äº†ä¸€ç‚¹ï¼Œè¿˜æœ‰ä¸€ç§ç‰ˆæœ¬å½¢å¼ï¼Œå°±æ˜¯ç±»ä¼¼äº <code>v0.0.0-20211029224645-99673261e6eb</code> è¿™ç§çš„ç‰ˆæœ¬ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„ç‰ˆæœ¬ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥è‡ªè¡Œå»æŸ¥ä¸€æŸ¥ï¼Œä»Šå¤©çš„é‡ç‚¹ä¸åœ¨è¿™é‡Œã€‚</p><p>è™½ç„¶æˆ‘ä»¬çŸ¥é“ï¼Œè¿™æ ·çš„ç‰ˆæœ¬è‚¯å®šæ˜¯å°äº v0.1.0 ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åˆè¯¥å¦‚ä½•å»æ‰¾åˆ°è¿™ç§ç‰ˆæœ¬å·çš„æ’ä»¶åŒ…å‘¢ï¼Ÿé—®é¢˜ä¸€ä¸‹å­å°±æ£˜æ‰‹äº†èµ·æ¥â€¦â€¦</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æŠŠè¿™ä¸ªäº‹æƒ…å¥½å¥½æ‹é¡ºä¸€ä¸‹ã€‚æˆ‘æ˜¯å› ä¸ºè¦åœ¨é¡¹ç›®ä¸­ç”¨åˆ° <code>github.com/go-resty/resty</code> åŒ…ï¼Œæ‰€ä»¥æˆ‘å°±ä½¿ç”¨ <code>go get -v github.com/go-resty/resty</code> å‘½ä»¤å»ä¸‹è½½äº†è¿™ä¸ªæ’ä»¶åŒ…ï¼Œç„¶åå¯åŠ¨é¡¹ç›®çš„æ—¶å€™å°±ç›´æ¥æŠ¥é”™äº†ã€‚æŠ¥é”™å†…å®¹åˆ†æå¾—å‡ºæ˜¯æŸäº›åŒ…ä¾èµ–äº†é«˜ç‰ˆæœ¬çš„ go 1.17 æˆ‘è‡ªå·±æœ¬åœ°ä½¿ç”¨çš„æ˜¯ go 1.16 ï¼Œå¥½å§ï¼Œé‚£æˆ‘å…ˆåœ¨é¡¹ç›®ä¸­ä¸ä½¿ç”¨ <code>github.com/go-resty/resty</code> åŒ…ï¼Œçœ‹é¡¹ç›®æ˜¯å¦èƒ½å¤Ÿè·‘å¾—èµ·æ¥ã€‚å½“æˆ‘åœ¨é¡¹ç›®ä¸­æ²¡æœ‰å»æ‰äº† resty åŒ…ä¹‹åï¼Œé¡¹ç›®è·‘èµ·æ¥äº†ï¼Œæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œè¯æ˜æˆ‘ä¹‹å‰çš„é¡¹ç›®æ˜¯æ­£å¸¸çš„ï¼Œå°±æ˜¯å› ä¸ºä¸‹è½½äº† resty åŒ…ä¹‹åå¯¼è‡´æ— æ³•å¯åŠ¨çš„ã€‚å¯æ˜¯ï¼Œæˆ‘ç°åœ¨å°±æƒ³ç”¨ resty åŒ…ï¼Œå¹¶ä¸”æ ¹æ®ä»¥ä¸Šçš„æ’æŸ¥ï¼Œæˆ‘ä»¬è¿˜å‘ç°äº† <code>golang.org/x/net</code> åŒ…åªèƒ½ç”¨ v0.0.0 æŸä¸ªå…·ä½“ç‰ˆæœ¬çš„ã€‚</p><p>æœ‰äº†è¿™äº›ç»éªŒä¹‹åï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥åˆ° resty åŒ…çš„ go.mod æ–‡ä»¶ä¸­æŸ¥çœ‹ä¸€ä¸‹ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-39c961225bb33afb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹restyåŒ…çš„ä¾èµ–æƒ…å†µ"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰æœ€æ–°çš„ resty v2.12.0 ç‰ˆæœ¬æ˜¯æ”¯æŒ go 1.16 çš„ï¼Œä½†æ˜¯é—®é¢˜å°±åœ¨äºæ­¤æ—¶ç”¨çš„ <code>golang.org/x/net</code> åŒ…æ˜¯ v0.22.0 ç‰ˆæœ¬ï¼Œé€šè¿‡ä»¥ä¸Šæˆ‘ä»¬çš„ç»“è®ºæ¥çœ‹ v0.22.0 ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒ go 1.16 çš„ï¼Œé‚£ä¹ˆï¼Œé—®é¢˜å°±å‡ºç°åœ¨è¿™é‡Œäº†ï¼</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9001a183087f44c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®šä½åˆ°å…·ä½“restyåŒ…"></p><p>æ‰¾åˆ°é—®é¢˜æ‰€åœ¨äº†ä¹‹åï¼Œæˆ‘ä»¬å°±ä¸€ä¸ªç‰ˆæœ¬ä¸€ä¸ªç‰ˆæœ¬çš„å»æ‰¾ï¼Œæœ€åç»ˆäºé”å®šäº† <code>resty v2.7.0</code> ç‰ˆæœ¬ï¼</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><ol><li>ç›´æ¥å»é¡¹ç›®çš„ <code>go.mod</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>require github.com/go-resty/resty/v2 v2.7.0</code></li><li>å†å»æ‰§è¡Œ <code>go mod download github.com/go-resty/resty/v2</code> ä¸‹è½½äº†æŒ‡å®š v2.7.0 ç‰ˆæœ¬çš„ resty åŒ…</li><li>å†å»è¿è¡Œä¸€ä¸‹é¡¹ç›®ï¼Œå°±å‘ç°è·‘èµ·æ¥å•¦ï¼å®Œç¾ï¼</li></ol><h2 id="æœ€åæ€»ç»“ä¸€ä¸‹"><a href="#æœ€åæ€»ç»“ä¸€ä¸‹" class="headerlink" title="æœ€åæ€»ç»“ä¸€ä¸‹"></a>æœ€åæ€»ç»“ä¸€ä¸‹</h2><ol><li>æˆ‘æœ¬åœ°ä¹‹å‰æ˜¯æ²¡æœ‰æ‹‰å–è¿‡ <code>resty</code> åŒ…çš„ï¼Œå› æ­¤å½“æˆ‘ä½¿ç”¨ <code>go get</code> å‘½ä»¤ä¸”æ²¡æœ‰æ˜ç¡®æŒ‡å®šç‰ˆæœ¬å·çš„æƒ…å†µä¸‹ï¼Œæ˜¯ç›´æ¥ä¼šæ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„ï¼Œä¹Ÿå°±æ˜¯ <code>go get -v github.com/go-resty/resty</code>ã€‚</li><li>å…¶å®ä¸ç®¡æ˜¯ <code>golang.org/x/sys</code> åŒ…è¿˜æ˜¯ <code>golang.org/x/net</code> åŒ…ï¼Œåœ¨æˆ‘é¡¹ç›®ä¸­å¹¶æ²¡<strong>ç›´æ¥</strong>å¼•ç”¨å®ƒä»¬ï¼Œå› æ­¤ï¼Œæ ¹æœ¬å°±æ— æ³•åœ¨ <code>go.mod</code> æ–‡ä»¶ä¸­å»è°ƒæ•´å®ƒä»¬çš„ç‰ˆæœ¬ã€‚å¦å¤–ï¼Œå“ªæ€•æ˜¯å­˜åœ¨ <code>go.mod</code> æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯åé¢å¸¦äº†æœ‰ <code>// indirect</code> æ³¨é‡Šçš„ï¼Œå°±ç®—æ˜¯æˆ‘ä»¬åœ¨ <code>go.mod</code> æ–‡ä»¶ä¸­åˆ äº†è¿™ä¸ªä¾èµ–ä¹Ÿæ²¡æœ‰å•¥ç”¨ï¼</li></ol><blockquote><p>indirect æ ‡è¯†è¡¨ç¤ºè¯¥æ¨¡å—ä¸ºé—´æ¥ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯åœ¨å½“å‰åº”ç”¨ç¨‹åºä¸­çš„ import è¯­å¥ä¸­ï¼Œå¹¶æ²¡æœ‰å‘ç°è¿™ä¸ªæ¨¡å—çš„æ˜ç¡®å¼•ç”¨ï¼Œæœ‰å¯èƒ½æ˜¯ä½ å…ˆæ‰‹åŠ¨ go get æ‹‰å–ä¸‹æ¥çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä½ æ‰€ä¾èµ–çš„æ¨¡å—æ‰€ä¾èµ–çš„ï¼Œæƒ…å†µæœ‰å¥½å‡ ç§ã€‚</p></blockquote><ol start="3"><li>è™½ç„¶è¿™ä¸¤ä¸ªæœ‰å†²çªçš„åŒ…åœ¨ <code>go.mod</code> æ–‡ä»¶ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯åœ¨ <code>go.sum</code> æ–‡ä»¶ä¸­æ˜¯å­˜åœ¨çš„ï¼Œå¯ä¸å¯ä»¥ç›´æ¥åœ¨ <code>go.sum</code> æ–‡ä»¶ä¸­å°†å…¶ä¿®æ”¹æˆ–è€…åˆ é™¤å‘¢ï¼Ÿå›ç­”æ˜¯ï¼š<strong>ä¸å¯ä»¥ï¼</strong> å› ä¸ºæ­¤æ—¶ä½ åªéœ€è¦æ‰§è¡Œä¸‹ <code>go mod tidy</code> å‘½ä»¤ï¼Œé©¬ä¸Šåˆå›æ¥äº†ã€‚</li></ol><p>å…¶å®é‡åˆ°è¿™ä¸ªæŠ¥é”™æ—¶ï¼Œæˆ‘ä¹Ÿå»æœç´¢å¼•æ“ä¸ŠæŸ¥è¯¢äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¤šæ•°äººçš„å›ç­”éƒ½æ˜¯è¦å‡çº§ go ç‰ˆæœ¬ã€‚å¯æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šè¿è¡Œäº†ä¸€æ®µæ—¶é—´äº†ï¼Œèƒ½å¤Ÿç¨³å®šè¿è¡Œçš„é¡¹ç›®ï¼Œè‚¯å®šæ˜¯ä¸èƒ½åšè°ƒæ•´å¤§ç‰ˆæœ¬è¿™ç§å¤§åŠ¨å¹²æˆˆåŠ¨ä½œçš„ï¼Œä¸ç„¶ï¼Œå‡ºäº†å¤§é—®é¢˜ï¼Œå¯èƒ½å°±ç›´æ¥æ‹¿æˆ‘ç¥­å¤©äº†ã€‚</p><p>è¦æ˜¯ä½ ä¹Ÿé‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œä½ ä¹Ÿä¸æƒ³é€šè¿‡å‡çº§ go ç‰ˆæœ¬æ¥è§£å†³ï¼Œä¹Ÿå¯ä»¥è¯•è¯•æˆ‘è¯´çš„è¿™ä¸ªæ–¹æ¡ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Consulï¼Œä¸€ä¸ªæœåŠ¡å‘ç°ç¥å™¨</title>
      <link href="posts/74705a17.html"/>
      <url>posts/74705a17.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨å¾®æœåŠ¡çš„æ¶æ„ä¸­ï¼ŒConsul æ˜¯ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚å®ƒç”± HashiCorp å…¬å¸å¼€å‘ï¼ŒConsul æä¾›äº†æœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç½‘æ ¼åŠŸèƒ½ï¼Œä½¿å¾—åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç®¡ç†å’Œé…ç½®æœåŠ¡å˜å¾—ç®€å•é«˜æ•ˆã€‚</p><h2 id="æœåŠ¡å‘ç°ï¼šè§£å†³å¾®æœåŠ¡å¯»å€éš¾é¢˜"><a href="#æœåŠ¡å‘ç°ï¼šè§£å†³å¾®æœåŠ¡å¯»å€éš¾é¢˜" class="headerlink" title="æœåŠ¡å‘ç°ï¼šè§£å†³å¾®æœåŠ¡å¯»å€éš¾é¢˜"></a>æœåŠ¡å‘ç°ï¼šè§£å†³å¾®æœåŠ¡å¯»å€éš¾é¢˜</h2><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å®ä¾‹é€šå¸¸ä¼šåŠ¨æ€å˜åŒ–ï¼Œè¿™ä½¿å¾—æœåŠ¡é—´çš„äº’ç›¸å¯»å€å˜å¾—å¤æ‚ã€‚Consulé€šè¿‡æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°æœºåˆ¶è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚æ¯ä¸ªæœåŠ¡å®ä¾‹åœ¨å¯åŠ¨æ—¶å‘Consulæ³¨å†Œè‡ªå·±ï¼Œå¹¶å‘¨æœŸæ€§åœ°æ›´æ–°å…¶å¥åº·çŠ¶æ€ã€‚è¿™æ ·ï¼ŒæœåŠ¡ä¹‹é—´å°±å¯ä»¥é€šè¿‡ConsulæŸ¥è¯¢å…¶ä»–æœåŠ¡çš„å½“å‰å¯ç”¨å®ä¾‹ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ³¨å†ŒæœåŠ¡ç¤ºä¾‹</span><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> PUT <span class="token string">'http://localhost:8500/v1/agent/service/register'</span> <span class="token punctuation">\</span><span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span><span class="token parameter variable">--data</span> <span class="token string">'{  "ID": "my-service-1",  "Name": "my-service",  "Tags": ["v1"],  "Address": "10.0.0.1",  "Port": 8080,  "Check": {    "HTTP": "http://10.0.0.1:8080/health",    "Interval": "10s"  }}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¥åº·æ£€æŸ¥ï¼šç¡®ä¿æœåŠ¡è´¨é‡å’Œå¯é æ€§"><a href="#å¥åº·æ£€æŸ¥ï¼šç¡®ä¿æœåŠ¡è´¨é‡å’Œå¯é æ€§" class="headerlink" title="å¥åº·æ£€æŸ¥ï¼šç¡®ä¿æœåŠ¡è´¨é‡å’Œå¯é æ€§"></a>å¥åº·æ£€æŸ¥ï¼šç¡®ä¿æœåŠ¡è´¨é‡å’Œå¯é æ€§</h2><p>Consul çš„å¥åº·æ£€æŸ¥æœºåˆ¶ç¡®ä¿åªæœ‰å¥åº·çš„æœåŠ¡å®ä¾‹è¢«ç”¨äºæœåŠ¡å‘ç°ã€‚æ¯ä¸ªæœåŠ¡å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå¥åº·æ£€æŸ¥ï¼ŒConsul  ä¼šå®šæœŸæ‰§è¡Œè¿™äº›æ£€æŸ¥ä»¥ç¡®å®šæœåŠ¡å®ä¾‹çš„å¥åº·çŠ¶æ€ã€‚</p><h2 id="åŠ¨æ€é…ç½®ï¼šçµæ´»çš„æœåŠ¡é…ç½®ç®¡ç†"><a href="#åŠ¨æ€é…ç½®ï¼šçµæ´»çš„æœåŠ¡é…ç½®ç®¡ç†" class="headerlink" title="åŠ¨æ€é…ç½®ï¼šçµæ´»çš„æœåŠ¡é…ç½®ç®¡ç†"></a>åŠ¨æ€é…ç½®ï¼šçµæ´»çš„æœåŠ¡é…ç½®ç®¡ç†</h2><p>Consul çš„ <code>Key/Value</code> å­˜å‚¨åŠŸèƒ½å…è®¸ç¨‹åºå‘˜å­˜å‚¨å’Œç®¡ç†é…ç½®ä¿¡æ¯ã€‚æœåŠ¡å¯ä»¥åœ¨å¯åŠ¨æ—¶ä» Consul æŸ¥è¯¢è¿™äº›é…ç½®ï¼Œå®ç°åŠ¨æ€é…ç½®ç®¡ç†ã€‚å½“é…ç½®æ›´æ”¹æ—¶ï¼ŒæœåŠ¡å¯ä»¥è‡ªåŠ¨è·å–æ–°çš„é…ç½®ï¼Œè€Œæ— éœ€é‡å¯ã€‚</p><h2 id="å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒï¼šæ‰©å±•å…¨çƒæœåŠ¡"><a href="#å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒï¼šæ‰©å±•å…¨çƒæœåŠ¡" class="headerlink" title="å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒï¼šæ‰©å±•å…¨çƒæœåŠ¡"></a>å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒï¼šæ‰©å±•å…¨çƒæœåŠ¡</h2><p>Consul å¤©ç„¶æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œè¿™ä½¿å¾—æ„å»ºè·¨åœ°ç†ä½ç½®çš„é«˜å¯ç”¨ç³»ç»Ÿå˜å¾—ç®€å•ã€‚ç¨‹åºå‘˜å¯ä»¥é…ç½®æœåŠ¡åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒä¹‹é—´ç›¸äº’å‘ç°å’Œé€šä¿¡ï¼Œè€Œ Consul ä¼šå¤„ç†æ‰€æœ‰å¤æ‚çš„ç½‘ç»œå’ŒåŒæ­¥é—®é¢˜ã€‚</p><h2 id="ä»¥ä¸‹æ˜¯-Consul-çš„å‡ ç§å®‰è£…æ–¹å¼"><a href="#ä»¥ä¸‹æ˜¯-Consul-çš„å‡ ç§å®‰è£…æ–¹å¼" class="headerlink" title="ä»¥ä¸‹æ˜¯ Consul çš„å‡ ç§å®‰è£…æ–¹å¼"></a>ä»¥ä¸‹æ˜¯ Consul çš„å‡ ç§å®‰è£…æ–¹å¼</h2><h3 id="ç¬¬ä¸€ç§æ–¹å¼ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨-homebrew-å®‰è£…"><a href="#ç¬¬ä¸€ç§æ–¹å¼ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨-homebrew-å®‰è£…" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨ homebrew å®‰è£…"></a>ç¬¬ä¸€ç§æ–¹å¼ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>homebrew</code> å®‰è£…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> consul<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨-docker-å®‰è£…-consul"><a href="#ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨-docker-å®‰è£…-consul" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ docker å®‰è£… consul"></a>ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ docker å®‰è£… consul</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‹‰å– latest ç‰ˆæœ¬é•œåƒ</span><span class="token function">docker</span> pull consul<span class="token comment"># æ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„ consul é•œåƒï¼Œè¿™é‡Œä»¥ 1.14.1 ç‰ˆæœ¬ç¤ºä¾‹</span><span class="token function">docker</span> pull consul:1.14.1<span class="token comment"># -bind çš„åœ°å€ä¸º docker0 æˆ–è€… eth0 çš„ ip åœ°å€éƒ½å¯ä»¥</span><span class="token function">docker</span> run <span class="token parameter variable">--name</span> alex-consul <span class="token punctuation">\</span><span class="token parameter variable">--net</span><span class="token operator">=</span>host <span class="token punctuation">\</span><span class="token parameter variable">-d</span> consul:1.14.1 <span class="token punctuation">\</span>agent <span class="token parameter variable">-server</span> <span class="token parameter variable">-bind</span><span class="token operator">=</span><span class="token number">172.17</span>.118.227 -bootstrap-expect<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-client</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token parameter variable">-ui</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç¬¬ä¸‰ç§æ–¹å¼ï¼šç›´æ¥ä¸‹è½½-consul-äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨"><a href="#ç¬¬ä¸‰ç§æ–¹å¼ï¼šç›´æ¥ä¸‹è½½-consul-äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹å¼ï¼šç›´æ¥ä¸‹è½½ consul äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨"></a>ç¬¬ä¸‰ç§æ–¹å¼ï¼šç›´æ¥ä¸‹è½½ consul äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨</h3><blockquote><p><a href="https://www.consul.io/downloads" title="å®˜æ–¹ä¸‹è½½é¡µé¢">å®˜æ–¹ä¸‹è½½é¡µé¢</a> å¯ä»¥æŒ‰ç…§ç³»ç»Ÿï¼Œé€‰æ‹©æŒ‡å®šçš„ consul ç‰ˆæœ¬<br>æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯ <code>Mac ç‰ˆæœ¬çš„ consul 1.14.2 ç‰ˆæœ¬</code>ï¼Œ <a href="https://releases.hashicorp.com/consul/1.14.2/consul_1.14.2_darwin_amd64.zip" title="ä¸‹è½½åœ°å€">ä¸‹è½½åœ°å€</a> ä¸‹è½½å®Œæˆä¹‹åæ˜¯ä¸€ä¸ª <code>zip</code> å‹ç¼©åŒ…ï¼Œç›´æ¥è§£å‹å³å¯ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½ mac ç‰ˆæœ¬çš„ consul 1.14.2</span><span class="token function">wget</span> https://releases.hashicorp.com/consul/1.14.2/consul_1.14.2_darwin_amd64.zip<span class="token comment"># æˆ–è€…</span><span class="token function">curl</span> <span class="token parameter variable">-O</span> https://releases.hashicorp.com/consul/1.14.2/consul_1.14.2_darwin_amd64.zip<span class="token comment"># è§£å‹</span><span class="token function">unzip</span> consul_1.14.2_darwin_amd64.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨æ—¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># data æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ consul çš„æ•°æ®æ–‡ä»¶ï¼Œ config æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</span><span class="token comment"># éœ€è¦å°† client è®¾ç½®æˆ 0.0.0.0 å¦åˆ™æ— æ³•åœ¨å¤–ç½‘è®¿é—® consul çš„ UI ç•Œé¢</span><span class="token comment"># å¯åŠ¨å‘½ä»¤</span>./consul agent -data-dir<span class="token operator">=</span>./data -config-dir<span class="token operator">=</span>./config <span class="token parameter variable">-server</span> <span class="token parameter variable">-bind</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 -bootstrap-expect<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-client</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">-ui</span><span class="token comment"># æˆ–è€…</span>./consul agent -data-dir<span class="token operator">=</span>./data -config-dir<span class="token operator">=</span>./config <span class="token parameter variable">-server</span> <span class="token parameter variable">-bootstrap</span> <span class="token parameter variable">-ui</span> <span class="token parameter variable">-node</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-client</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é€šè¿‡ -dev å¯åŠ¨ï¼Œä¸ä¼šä¿å­˜é…ç½®ï¼ˆå³é‡å¯ consul åé…ç½®ä¿¡æ¯å°†æ¶ˆå¤±ï¼‰</span>consul agent <span class="token parameter variable">-dev</span><span class="token comment"># æŸ¥çœ‹é›†ç¾¤æˆå‘˜ã€‚æ·»åŠ  `-detailed` é€‰é¡¹å¯ä»¥æŸ¥çœ‹åˆ°é¢å¤–çš„ä¿¡æ¯ã€‚</span>consul members<span class="token comment"># æŸ¥çœ‹å‡†ç¡®åŒ¹é… server çš„çŠ¶æ€ä¿¡æ¯</span><span class="token function">curl</span> localhost:8500/v1/catalog/nodes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ç³»ç»Ÿ </tag>
            
            <tag> Consul </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ–‡å¼„æ‡‚ Swoole è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link href="posts/289a4dbc.html"/>
      <url>posts/289a4dbc.html</url>
      
        <content type="html"><![CDATA[<h2 id="swoole-å’Œ-workerman-çš„åŒºåˆ«"><a href="#swoole-å’Œ-workerman-çš„åŒºåˆ«" class="headerlink" title="swoole å’Œ workerman çš„åŒºåˆ«"></a>swoole å’Œ workerman çš„åŒºåˆ«</h2><ul><li>workerman ä½¿ç”¨çº¯ php ç¼–å†™ï¼›swoole é‡‡ç”¨ c/c++ è¯­è¨€ç¼–å†™ï¼Œä½œä¸º php æ‰©å±•</li><li>workerman å¤šè¿›ç¨‹ï¼›swoole åç¨‹ï¼Œå¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹</li><li>swoole æ€§èƒ½ä¼˜äº workerman</li><li>swoole å¹¶æ²¡æœ‰ç”¨ libeventï¼Œæ‰€ä»¥ä¸éœ€è¦å®‰è£… libevent</li><li>swoole å¹¶ä¸ä¾èµ– php çš„ stream/sockets/pcntl/posix/sysvmsg ç­‰æ‰©å±•</li></ul><h2 id="master-ï¼ˆä¸»è¿›ç¨‹ï¼‰ã€reactor-ï¼ˆçº¿ç¨‹ï¼‰ã€managerï¼ˆç®¡ç†è¿›ç¨‹ï¼‰ã€worker-ï¼ˆå·¥ä½œè¿›ç¨‹ï¼‰-ã€-task-ï¼ˆä»»åŠ¡è¿›ç¨‹ï¼‰"><a href="#master-ï¼ˆä¸»è¿›ç¨‹ï¼‰ã€reactor-ï¼ˆçº¿ç¨‹ï¼‰ã€managerï¼ˆç®¡ç†è¿›ç¨‹ï¼‰ã€worker-ï¼ˆå·¥ä½œè¿›ç¨‹ï¼‰-ã€-task-ï¼ˆä»»åŠ¡è¿›ç¨‹ï¼‰" class="headerlink" title="master ï¼ˆä¸»è¿›ç¨‹ï¼‰ã€reactor ï¼ˆçº¿ç¨‹ï¼‰ã€managerï¼ˆç®¡ç†è¿›ç¨‹ï¼‰ã€worker ï¼ˆå·¥ä½œè¿›ç¨‹ï¼‰ ã€ task ï¼ˆä»»åŠ¡è¿›ç¨‹ï¼‰"></a>master ï¼ˆä¸»è¿›ç¨‹ï¼‰ã€reactor ï¼ˆçº¿ç¨‹ï¼‰ã€managerï¼ˆç®¡ç†è¿›ç¨‹ï¼‰ã€worker ï¼ˆå·¥ä½œè¿›ç¨‹ï¼‰ ã€ task ï¼ˆä»»åŠ¡è¿›ç¨‹ï¼‰</h2><p>å¯¹äº Linux ç³»ç»Ÿï¼Œæ˜¯æ— æ³•åŒºåˆ†<strong>è¿›ç¨‹</strong>å’Œ<strong>çº¿ç¨‹</strong>çš„ï¼ŒCPU æ˜¯å•è¿›ç¨‹ï¼ˆå› æ­¤<strong>å¹¶è¡Œæ‰§è¡Œ</strong>åªæœ‰1ï¼Œå› ä¸ºåªæœ‰ 1 ä¸ª CPUï¼Œä½†æ˜¯å¯ç”¨å¼€å¤šä¸ªè¿›ç¨‹/çº¿ç¨‹å»æ‰§è¡Œï¼Œè¿™æ ·å°±è¾¾åˆ°äº†<strong>å¹¶å‘æ‰§è¡Œ</strong>ï¼ŒCPU å¯ä»¥é€šè¿‡è½®è®­è°ƒåº¦ä»å¤šä¸ªè¿›ç¨‹/çº¿ç¨‹ä¹‹é—´æ¥å›åšåˆ‡æ¢ï¼Œä½†æ˜¯å¤šè¿›ç¨‹/çº¿ç¨‹åˆ‡æ¢ä¹Ÿå°±äº§ç”Ÿäº†åˆ‡æ¢ä¹‹é—´çš„æˆæœ¬<strong>è¿›ç¨‹/çº¿ç¨‹çš„æ•°é‡è¶Šå¤šï¼Œåˆ‡æ¢æˆæœ¬å°±è¶Šå¤§ï¼Œä¹Ÿå°±è¶Šæµªè´¹ï¼Œå› ä¸ºè¿™ç§åˆ‡æ¢å¹¶æ²¡æœ‰åœ¨ä¸šåŠ¡ä»£ç ä¸­æ¶ˆè€—</strong>ï¼‰</p><p>ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆå¯ç”¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰å’Œå†…æ ¸ç©ºé—´ï¼ˆå†…æ ¸çº¿ç¨‹ï¼‰ï¼Œå†…æ ¸çº¿ç¨‹å°±æ˜¯ threadï¼ˆçº¿ç¨‹ï¼‰ï¼Œç”¨æˆ·çº¿ç¨‹å°±æ˜¯ co-routineï¼ˆåç¨‹ï¼Œgolang ä¸­å«åš goroutineï¼‰ï¼Œç„¶ååˆå¯ä»¥é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å»ç»‘å®šä¸€ä¸ª <strong>åç¨‹è°ƒåº¦å™¨</strong>ï¼Œä¸€ä¸ªåç¨‹è°ƒåº¦å™¨åˆå¯ä»¥ç»‘å®šå¤šä¸ªåç¨‹ï¼Œè¿™æ ·æ€§èƒ½é«˜ä½å°±å®Œå…¨å–å†³äºä¼˜åŒ–åç¨‹è°ƒåº¦å™¨ï¼Œå“ªé—¨è¯­è¨€çš„åç¨‹è°ƒåº¦å™¨åšçš„å¥½ï¼Œé‚£ä¹ˆæ€§èƒ½å°±é«˜ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e8dbb161c619f9c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-877e8c01041475e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h3 id="master-è¿›ç¨‹"><a href="#master-è¿›ç¨‹" class="headerlink" title="master è¿›ç¨‹"></a>master è¿›ç¨‹</h3><p>ä¸»è¿›ç¨‹å†…æœ‰å¤šä¸ª reactor çº¿ç¨‹ï¼Œreactor çº¿ç¨‹åŸºäº epoll/kqueue è¿›è¡Œç½‘ç»œäº‹ä»¶è½®è®­ã€‚æ”¶åˆ°æ•°æ®åè½¬å‘åˆ° worker è¿›ç¨‹å»å¤„ç†ã€‚</p><h3 id="reactor-çº¿ç¨‹"><a href="#reactor-çº¿ç¨‹" class="headerlink" title="reactor çº¿ç¨‹"></a>reactor çº¿ç¨‹</h3><p>reactor çº¿ç¨‹ä¸ªæ•°é»˜è®¤å’Œ cpu æ ¸å¿ƒæ•°ä¸€è‡´</p><h3 id="manager-è¿›ç¨‹"><a href="#manager-è¿›ç¨‹" class="headerlink" title="manager è¿›ç¨‹"></a>manager è¿›ç¨‹</h3><p>å¯¹æ‰€æœ‰ worker è¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œworker è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç»“æŸæˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶è‡ªåŠ¨å›æ”¶ï¼Œå¹¶åˆ›å»ºæ–°çš„ worker è¿›ç¨‹</p><h3 id="worker-è¿›ç¨‹"><a href="#worker-è¿›ç¨‹" class="headerlink" title="worker è¿›ç¨‹"></a>worker è¿›ç¨‹</h3><p>å¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬åè®®è§£æå’Œå“åº”è¯·æ±‚ã€‚å¦‚æœ swoole æ²¡æœ‰è®¾ç½® worker_num ï¼Œåº•å±‚ä¼šå¯åŠ¨ä¸ cpu æ•°é‡ä¸€è‡´çš„ worker è¿›ç¨‹</p><h3 id="task-è¿›ç¨‹"><a href="#task-è¿›ç¨‹" class="headerlink" title="task è¿›ç¨‹"></a>task è¿›ç¨‹</h3><p>task è¿›ç¨‹å’Œ worker è¿›ç¨‹æ˜¯åŒçº§åˆ«çš„ï¼Œå¯ä»¥å°† worker è¿›ç¨‹ä¸­çš„ä¸€äº›æœåŠ¡æŠ•é€’ç»™ task è¿›ç¨‹è¿›è¡Œå¤„ç†ï¼Œæ¥è¾¾åˆ°åˆ†æ‹… worker è¿›ç¨‹å·¥ä½œé‡çš„ç›®çš„</p><h3 id="coroutine-åç¨‹"><a href="#coroutine-åç¨‹" class="headerlink" title="coroutine åç¨‹"></a>coroutine åç¨‹</h3><p>åç¨‹å¯ä»¥ç†è§£ä¸ºçº¯ç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œå…¶é€šè¿‡åä½œè€Œä¸æ˜¯æŠ¢å æ¥è¿›è¡Œåˆ‡æ¢ï¼Œç›¸å¯¹äºè¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œåç¨‹æ‰€æœ‰çš„æ“ä½œéƒ½å¯ä»¥åœ¨ç”¨æˆ·æ€å®Œæˆï¼Œåˆ›å»ºå’Œåˆ‡æ¢çš„æ¶ˆè€—æ›´ä½ï¼ŒSwoole å¯ä»¥ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚åˆ›å»ºå¯¹åº”çš„åç¨‹ï¼Œæ ¹æ® IO çš„çŠ¶æ€æ¥åˆç†çš„è°ƒåº¦åç¨‹ã€‚</p><p>åœ¨ Swoole 4.x ä¸­ï¼Œåç¨‹ï¼ˆCoroutineï¼‰å–ä»£äº†å¼‚æ­¥å›è°ƒï¼Œæˆä¸º Swoole å®˜æ–¹æ¨èçš„ç¼–ç¨‹æ–¹å¼ã€‚Swoole åç¨‹è§£å†³äº†å¼‚æ­¥å›è°ƒç¼–ç¨‹å›°éš¾çš„é—®é¢˜ï¼Œä½¿ç”¨åç¨‹å¯ä»¥ä»¥ä¼ ç»ŸåŒæ­¥ç¼–ç¨‹çš„æ–¹æ³•ç¼–å†™ä»£ç ï¼Œåº•å±‚è‡ªåŠ¨åˆ‡æ¢ä¸ºå¼‚æ­¥ IOï¼Œæ—¢ä¿è¯äº†ç¼–ç¨‹çš„ç®€å•æ€§ï¼Œåˆå¯å€ŸåŠ©å¼‚æ­¥ IOï¼Œæå‡ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚</p><blockquote><p>æ³¨ï¼šSwoole 4.x ä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿæ”¯æŒåç¨‹ï¼Œä¸è¿‡ 4.x ç‰ˆæœ¬å¯¹åç¨‹å†…æ ¸è¿›è¡Œäº†é‡æ„ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œæä¾›äº†å®Œæ•´çš„åç¨‹+é€šé“ç‰¹æ€§ï¼Œå¸¦æ¥å…¨æ–°çš„ CSP ç¼–ç¨‹æ¨¡å‹ï¼Œåç»­ä»‹ç»å’Œç¤ºä¾‹éƒ½æ˜¯åŸºäº Swoole 4.x ç‰ˆæœ¬ã€‚</p></blockquote><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-78ba06649d969718.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿›ç¨‹/çº¿ç¨‹ç»“æ„å›¾"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-aa2ab771fa24e858.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="swoole æ¶æ„"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e90a521635fbfee1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="swoole è¿è¡Œæµç¨‹å›¾"></p><h2 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h2><ul><li>è¿›ç¨‹<br>è¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†ä¸Šçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ï¼Œæ˜¯åº”ç”¨ç¨‹åºè¿è¡Œçš„è½½ä½“ã€‚</li><li>çº¿ç¨‹<br>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œä¸­ä¸€ä¸ªå•ä¸€çš„é¡ºåºæ§åˆ¶æµç¨‹ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œæ˜¯å¤„ç†å™¨è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</li></ul><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3><ul><li>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œè€Œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ã€‚</li><li>ä¸€ä¸ªè¿›ç¨‹ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­ä»£ç çš„ä¸åŒæ‰§è¡Œè·¯çº¿ã€‚</li><li>è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä½†åŒä¸€è¿›ç¨‹ä¸‹çš„å„ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ç¨‹åºçš„å†…å­˜ç©ºé—´ï¼ˆåŒ…æ‹¬ä»£ç æ®µï¼Œæ•°æ®é›†ï¼Œå †ç­‰ï¼‰åŠä¸€äº›è¿›ç¨‹çº§çš„èµ„æºï¼ˆå¦‚æ‰“å¼€æ–‡ä»¶å’Œä¿¡å·ç­‰ï¼‰ï¼ŒæŸè¿›ç¨‹å†…çš„çº¿ç¨‹åœ¨å…¶ä»–è¿›ç¨‹ä¸å¯è§ã€‚</li><li>è°ƒåº¦å’Œåˆ‡æ¢ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è¦å¿«å¾—å¤šã€‚</li><li>çº¿ç¨‹å¤©ç”Ÿçš„å…±äº«å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹é—´çš„é€šä¿¡æ›´ç®€å•ï¼Œé¿å…äº†è¿›ç¨‹ IPCï¼ˆè¿›ç¨‹é—´çš„é€šä¿¡ï¼‰ å¼•å…¥æ–°çš„å¤æ‚åº¦ã€‚</li><li>è¿›ç¨‹å¼€é”€å¤§ï¼Œçº¿ç¨‹å¼€é”€å°ã€‚</li></ul><h3 id="php-å®ç°å¤šè¿›ç¨‹"><a href="#php-å®ç°å¤šè¿›ç¨‹" class="headerlink" title="php å®ç°å¤šè¿›ç¨‹"></a>php å®ç°å¤šè¿›ç¨‹</h3><p>pcntl æ˜¯ php å®˜æ–¹çš„å¤šè¿›ç¨‹æ‰©å±•ï¼Œåªèƒ½åœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œç¼–è¯‘ php çš„æ—¶å€™éœ€è¦å¼€å¯ â€“enable-pcntl<br>pcntl_fork åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ï¼Œfork æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä» fork å¾—ä½ç½®å¼€å§‹å‘ä¸‹ç»§ç»­æ‰§è¡Œï¼Œä¸åŒçš„æ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„ fork è¿”å›å€¼ä¸ºå­è¿›ç¨‹å·ï¼Œè€Œå­è¿›ç¨‹å¾—åˆ°å¾—æ˜¯ 0ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æˆ‘æ˜¯çˆ¶è¿›ç¨‹'</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æˆ‘æ˜¯å­è¿›ç¨‹'</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤šè¿›ç¨‹ä¾‹å­ï¼šä¼šå…ˆè¾“å‡º <code>111</code> ç„¶åè¾“å‡º <code>222</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'222'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'111'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ä¸¤æ®µä»£ç å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶ä¸ä¼šå› ä¸ºç¬¬ä¸€ä¸ªåˆ¤æ–­ä¸­æœ‰äº† sleep å°±åœæ­¢å¾€ä¸‹æ‰§è¡Œä»£ç </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿›ç¨‹é—´çš„é€šä¿¡"><a href="#è¿›ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´çš„é€šä¿¡"></a>è¿›ç¨‹é—´çš„é€šä¿¡</h3><p>åœ¨å„ä¸ªè¿›ç¨‹ä¸­ï¼Œå†…å­˜ç©ºé—´éƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œå„ä¸ªå˜é‡éƒ½æ˜¯åœ¨ä¸åŒçš„å†…å­˜ç©ºé—´ã€‚è¿›ç¨‹é—´ç©ºé—´ç‹¬ç«‹ï¼Œæ•°æ®ä¸èƒ½å…±äº«ã€‚</p><p>ä¾‹å­å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'alex'</span><span class="token punctuation">;</span><span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'===111'</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼šè¾“å‡º alex===111</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼šè¾“å‡º alex</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›ç¨‹é—´çš„é€šä¿¡å¯ä»¥é‡‡ç”¨å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚ï¼šç®¡é“é€šä¿¡ã€æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ã€è¿›ç¨‹ä¿¡å·é€šä¿¡ã€å¥—æ¥å­—é€šä¿¡ã€ç¬¬ä¸‰æ–¹é€šä¿¡ï¼ˆä½¿ç”¨æ–‡ä»¶æ“ä½œï¼Œæˆ–è€…mysqlï¼Œæˆ–è€…redisç­‰æ–¹æ³•ä¹Ÿå¯ä»¥å®ç°é€šä¿¡ï¼‰ã€å…±äº«å†…å­˜é€šä¿¡ï¼ˆæ˜ å°„ä¸€æ®µèƒ½è¢«å…¶ä»–è¿›ç¨‹æ‰€è®¿é—®çš„å†…å­˜ï¼Œè¿™æ®µå…±äº«å†…å­˜ç”±ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºï¼Œä½†å¤šä¸ªè¿›ç¨‹éƒ½å¯ä»¥è®¿é—®ã€‚å…±äº«å†…å­˜æ˜¯æœ€å¿«çš„ IPC &lt;è¿›ç¨‹é—´é€šä¿¡&gt; æ–¹å¼ï¼Œå®ƒæ˜¯é’ˆå¯¹å…¶ä»–è¿›ç¨‹é—´é€šä¿¡æ–¹å¼è¿è¡Œæ•ˆç‡ä½è€Œä¸“é—¨è®¾è®¡çš„ã€‚<code>swoole</code> å°±æ˜¯é‡‡ç”¨å…±äº«å†…å­˜é€šä¿¡ï¼‰</p><h2 id="çº¿ç¨‹å’Œåç¨‹"><a href="#çº¿ç¨‹å’Œåç¨‹" class="headerlink" title="çº¿ç¨‹å’Œåç¨‹"></a>çº¿ç¨‹å’Œåç¨‹</h2><p>æèµ·å¹¶å‘ç¼–ç¨‹ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ <strong>å¤šçº¿ç¨‹ç¼–ç¨‹</strong> ã€‚çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè°ƒåº¦çš„æœ€å°å•ä½ï¼Œå…±äº«åŒä¸€è¿›ç¨‹çš„æ•°æ®å’Œèµ„æºï¼Œå¹¶è¡Œåœ°å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚ï¼ˆåŒä¸€è¿›ç¨‹ä¸‹å¤šçº¿ç¨‹ä¹‹é—´çš„å†…å­˜æ˜¯å…±äº«çš„ï¼‰ã€‚</p><p>å¤šçº¿ç¨‹å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨çº¿ç¨‹æ•°é‡è¿‡å¤šæ—¶ï¼Œé—®é¢˜è¢«æ”¾å¤§çš„å°¤ä¸ºæ˜æ˜¾ã€‚</p><ul><li>çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é€ æˆçš„å¼€é”€ã€‚</li><li>çº¿ç¨‹ä¹‹é—´å¯¹èµ„æºçš„ç«äº‰é—®é¢˜ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ã€‚</li></ul><p>åç¨‹ä¹Ÿæ˜¯ä¸€ç§å¼‚æ­¥æ–¹æ¡ˆã€‚åœ¨ä»£ç  IO é˜»å¡æ—¶ï¼Œå½“å‰åç¨‹è®©å‡º CPU æ‰§è¡Œæƒï¼Œè®©å…¶å®ƒåç¨‹æ‰§è¡Œï¼Œå¾… IO æ‰§è¡Œå®Œæ¯•ï¼Œé˜»å¡çš„åç¨‹ç»§ç»­æ‰§è¡Œã€‚è™½ç„¶ä»£ç æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œä½†å†™ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥çš„ã€‚æ”¯æŒåç¨‹çš„ç¼–ç¨‹è¯­è¨€å®ç°äº†åç¨‹çš„è°ƒåº¦å™¨ï¼Œæä¾›äº† channel æœºåˆ¶è¿›è¡Œåç¨‹é—´é€šä¿¡ ï¼ˆCSPæ¨¡å‹ä¸­æ¶ˆæ¯ä¼ é€’çš„å®ç°ï¼‰ã€‚åŸºäº CSP æ¨¡å‹çš„åç¨‹æ–¹æ¡ˆï¼Œå®ç°äº†æ— å…±äº«å†…å­˜æ— é”çš„å¹¶å‘ï¼Œå¯ä»¥åŒ¹é…å¼‚æ­¥å›è°ƒçš„æ€§èƒ½ã€‚</p><p><strong>Swoole çš„åç¨‹åœ¨åº•å±‚å®ç°ä¸Šæ˜¯å•çº¿ç¨‹çš„</strong>ï¼Œå› æ­¤åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªåç¨‹åœ¨å·¥ä½œï¼Œåç¨‹çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œè¿™ä¸çº¿ç¨‹ä¸åŒï¼Œå¤šä¸ªçº¿ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿè°ƒåº¦åˆ°å¤šä¸ª CPU å¹¶è¡Œæ‰§è¡Œã€‚</p><p>ä¸€ä¸ªåç¨‹æ­£åœ¨è¿è¡Œæ—¶ï¼Œå…¶ä»–åç¨‹ä¼šåœæ­¢å·¥ä½œã€‚å½“å‰åç¨‹æ‰§è¡Œé˜»å¡ IO æ“ä½œæ—¶ä¼šæŒ‚èµ·ï¼Œåº•å±‚è°ƒåº¦å™¨ä¼šè¿›å…¥äº‹ä»¶å¾ªç¯ã€‚å½“æœ‰ IO å®Œæˆäº‹ä»¶æ—¶ï¼Œåº•å±‚è°ƒåº¦å™¨æ¢å¤äº‹ä»¶å¯¹åº”çš„åç¨‹çš„æ‰§è¡Œã€‚</p><p>åœ¨ Swoole ä¸­å¯¹ CPU å¤šæ ¸çš„åˆ©ç”¨ï¼Œä»ç„¶ä¾èµ–äº Swoole å¼•æ“çš„å¤šè¿›ç¨‹æœºåˆ¶ã€‚</p><h3 id="åç¨‹çš„ç‰¹æ€§"><a href="#åç¨‹çš„ç‰¹æ€§" class="headerlink" title="åç¨‹çš„ç‰¹æ€§"></a>åç¨‹çš„ç‰¹æ€§</h3><p>åç¨‹æé«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚å› ä¸ºå­ç¨‹åºåˆ‡æ¢ä¸æ˜¯çº¿ç¨‹åˆ‡æ¢ï¼Œè€Œæ˜¯ç”±ç¨‹åºè‡ªèº«æ§åˆ¶ï¼Œå› æ­¤ï¼Œæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚<br>ä¸éœ€è¦å¤šè¿›ç¨‹çš„é”æœºåˆ¶ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨åŒæ—¶å†™å˜é‡å†²çªã€‚ï¼ˆswoole æ˜¯å¼€äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªåç¨‹çš„æœºåˆ¶ï¼‰</p><h3 id="çº¿ç¨‹å’Œåç¨‹çš„é€‚ç”¨åœºæ™¯"><a href="#çº¿ç¨‹å’Œåç¨‹çš„é€‚ç”¨åœºæ™¯" class="headerlink" title="çº¿ç¨‹å’Œåç¨‹çš„é€‚ç”¨åœºæ™¯"></a>çº¿ç¨‹å’Œåç¨‹çš„é€‚ç”¨åœºæ™¯</h3><p>åç¨‹ï¼ˆååŒç¨‹åºï¼‰ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡ŒæŸä¸ªåç¨‹ã€‚å¼€è¾Ÿå¤šä¸ªåç¨‹å¼€é”€ä¸å¤§ï¼Œåç¨‹é€‚åˆå¯¹æŸä»»åŠ¡è¿›è¡Œåˆ†æ—¶å¤„ç†ã€‚<strong>IOå¯†é›†å‹</strong><br>çº¿ç¨‹ï¼ŒåŒä¸€æ—¶é—´å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ã€‚å¼€è¾Ÿå¤šæ¡çº¿ç¨‹å¼€é”€å¾ˆå¤§ã€‚çº¿ç¨‹é€‚åˆå¤šä»»åŠ¡åŒæ—¶å¤„ç†ã€‚ <strong>CPUå¯†é›†å‹</strong></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Swoole </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Swoole çš„åº•å±‚æ¶æ„åŠè¿è¡ŒåŸç†</title>
      <link href="posts/84212e0c.html"/>
      <url>posts/84212e0c.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆçœ‹è¿™å¼ åº•å±‚æ¶æ„å›¾</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-176c45bba608fa9a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Swoole çš„åº•å±‚æ¶æ„åŠè¿è¡ŒåŸç†å›¾"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSwoole ä¸»è¦åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li><strong>Masterï¼š</strong> å½“æˆ‘ä»¬è¿è¡Œå¯åŠ¨ Swoole çš„ PHP è„šæœ¬æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºè¯¥è¿›ç¨‹ï¼ˆå®ƒæ˜¯æ•´ä¸ªåº”ç”¨çš„ root è¿›ç¨‹ï¼‰ï¼Œç„¶åç”±è¯¥è¿›ç¨‹ fork å‡º Reactor çº¿ç¨‹å’Œ Manager è¿›ç¨‹ã€‚</li><li><strong>Reactorï¼š</strong> Reactor æ˜¯åŒ…å«åœ¨ Master è¿›ç¨‹ä¸­çš„å¤šçº¿ç¨‹ç¨‹åºï¼Œç”¨æ¥å¤„ç† TCP è¿æ¥å’Œæ•°æ®æ”¶å‘ï¼ˆå¼‚æ­¥éé˜»å¡æ–¹å¼ï¼‰ã€‚Reactor ä¸»çº¿ç¨‹åœ¨ Accept æ–°çš„è¿æ¥åï¼Œä¼šå°†è¿™ä¸ªè¿æ¥åˆ†é…ç»™ä¸€ä¸ªå›ºå®šçš„ Reactor çº¿ç¨‹ï¼Œå¹¶ç”±è¿™ä¸ªçº¿ç¨‹è´Ÿè´£ç›‘å¬æ­¤ socketã€‚åœ¨ socket å¯è¯»æ—¶è¯»å–æ•°æ®ï¼Œå¹¶è¿›è¡Œåè®®è§£æï¼Œå°†è¯·æ±‚æŠ•é€’åˆ° Worker è¿›ç¨‹ï¼›åœ¨ socket å¯å†™æ—¶å°†æ•°æ®å‘é€ç»™ TCP å®¢æˆ·ç«¯ã€‚</li><li><strong>Managerï¼š</strong> Manager è¿›ç¨‹è´Ÿè´£ fork å¹¶ç»´æŠ¤å¤šä¸ª Worker å­è¿›ç¨‹ã€‚å½“æœ‰ Worker å­è¿›ç¨‹ä¸­æ­¢æ—¶ï¼ŒManager è´Ÿè´£å›æ”¶å¹¶åˆ›å»ºæ–°çš„ Worker å­è¿›ç¨‹ï¼Œä»¥ä¾¿ä¿æŒ Worker è¿›ç¨‹æ€»æ•°ä¸å˜ï¼›å½“æœåŠ¡å™¨å…³é—­æ—¶ï¼ŒManager å°†å‘é€ä¿¡å·ç»™æ‰€æœ‰ Worker å­è¿›ç¨‹ï¼Œé€šçŸ¥å…¶å…³é—­æœåŠ¡ã€‚</li><li><strong>Workerï¼š</strong> ä»¥å¤šè¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œæ¯ä¸ªå­è¿›ç¨‹è´Ÿè´£æ¥å—ç”± Reactor çº¿ç¨‹æŠ•é€’çš„è¯·æ±‚æ•°æ®åŒ…ï¼Œå¹¶æ‰§è¡Œ PHP å›è°ƒå‡½æ•°å¤„ç†æ•°æ®ï¼Œç„¶åç”Ÿæˆå“åº”æ•°æ®å¹¶å‘ç»™ Reactor çº¿ç¨‹ï¼Œç”± Reactor çº¿ç¨‹å‘é€ç»™ TCP å®¢æˆ·ç«¯ã€‚æ‰€æœ‰è¯·æ±‚çš„å¤„ç†é€»è¾‘éƒ½æ˜¯åœ¨ Worker å­è¿›ç¨‹ä¸­å®Œæˆï¼Œè¿™æ˜¯æˆ‘ä»¬ç¼–å†™ä¸šåŠ¡ä»£ç æ—¶çœŸæ­£è¦å…³å¿ƒçš„éƒ¨åˆ†ã€‚</li><li><strong>Task Workerï¼š</strong> åŠŸèƒ½å’Œ Worker è¿›ç¨‹ç±»ä¼¼ï¼ŒåŒæ ·ä»¥å¤šè¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†ä»…ç”¨äºä»»åŠ¡åˆ†å‘ï¼Œå½“ Worker è¿›ç¨‹å°†ä»»åŠ¡å¼‚æ­¥åˆ†å‘åˆ°ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼ŒTask Worker è´Ÿè´£ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹è¿™äº›ä»»åŠ¡ï¼ˆåŒæ­¥é˜»å¡æ–¹å¼å¤„ç†ï¼‰ï¼Œå¤„ç†å®Œæˆåå°†ç»“æœè¿”å›ç»™ Worker è¿›ç¨‹ã€‚</li></ul><p>Swoole å®˜æ–¹å¯¹ Reactorã€Workerã€Task Workeræœ‰ä¸€ä¸ªå½¢è±¡çš„æ¯”å–»ï¼Œå¦‚æœæŠŠåŸºäº Swoole çš„ Web æœåŠ¡å™¨æ¯”ä½œä¸€ä¸ªå·¥å‚ï¼Œé‚£ä¹ˆ Reactor å°±æ˜¯è¿™ä¸ªå·¥å‚çš„é”€å”®å‘˜ï¼ŒWorker æ˜¯è´Ÿè´£ç”Ÿäº§çš„å·¥äººï¼Œé”€å”®å‘˜è´Ÿè´£æ¥è®¢å•ï¼Œç„¶åäº¤ç»™å·¥äººç”Ÿäº§ï¼Œè€Œ Task Worker å¯ä»¥ç†è§£ä¸ºè¡Œæ”¿äººå‘˜ï¼Œè´Ÿè´£æ›¿å·¥äººå¤„ç†ç”Ÿäº§ä»¥å¤–çš„æ‚äº‹ï¼Œæ¯”å¦‚è®¢ç›’é¥­ã€æ”¶å¿«é€’ï¼Œè®©å·¥äººå¯ä»¥å®‰å¿ƒç”Ÿäº§ã€‚</p><h1 id="Swoole-çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°"><a href="#Swoole-çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°" class="headerlink" title="Swoole çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°"></a>Swoole çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°</h1><p>å½“ Master ä¸»è¿›ç¨‹å¯åŠ¨æˆ–å…³é—­æ—¶ä¼šè§¦å‘ä¸‹é¢è¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼š</p><ul><li>onStart</li><li>onShutdown</li></ul><p>è€Œ Manager ç®¡ç†è¿›ç¨‹å¯åŠ¨æˆ–å…³é—­æ—¶ä¼šè§¦å‘ä¸‹é¢è¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼š</p><ul><li>onManagerStart</li><li>onManagerStop</li></ul><p>Worker è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰å¤šä¸ªå›è°ƒå‡½æ•°ï¼š</p><ul><li>onWorkerStartï¼šWorker è¿›ç¨‹å¯åŠ¨æ—¶</li><li>onWorkerStopï¼š Worker è¿›ç¨‹å…³é—­æ—¶</li><li>onConnectï¼šè¿æ¥å»ºç«‹æ—¶</li><li>onCloseï¼šè¿æ¥å…³é—­æ—¶</li><li>onReceiveï¼šæ”¶åˆ°è¯·æ±‚æ•°æ®æ—¶</li><li>onFinishï¼šæŠ•é€’çš„ä»»åŠ¡å¤„ç†å®Œæˆæ—¶</li></ul><p>Task Worker è¿›ç¨‹ä¹Ÿæœ‰ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œåˆ†åˆ«åœ¨</p><ul><li>onTaskï¼šç”±æ–°ä»»åŠ¡æŠ•é€’è¿‡æ¥æ—¶</li><li>onWorkerStartï¼šTask Worker è¿›ç¨‹å¯åŠ¨æ—¶ä¹Ÿä¼šè§¦å‘</li></ul><p>æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä¸»è¦å…³æ³¨çš„æ˜¯ Worker è¿›ç¨‹çš„å›è°ƒå‡½æ•°ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨å®ä¾‹ä¸Šç›‘å¬ç›¸åº”çš„äº‹ä»¶ï¼Œå¹¶ç¼–å†™å¯¹åº”çš„å›è°ƒå‡½æ•°æ¥å¤„ç†ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Swoole </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>swooleç¯å¢ƒæ­å»º</title>
      <link href="posts/59727fb0.html"/>
      <url>posts/59727fb0.html</url>
      
        <content type="html"><![CDATA[<p>PHP Swoole æ‰©å±•çš„å®‰è£…æ–¹å¼æœ‰å¾ˆå¤šï¼Œè¿™å®Œå…¨å–å†³äºä½ çš„ä½¿ç”¨ç¯å¢ƒï¼Œæœ¬æ–‡å¤§è‡´ä»‹ç»å‡ ç§å¸¸è§çš„å®‰è£…æ–¹å¼ï¼Œä¸”ä»¥åœ¨ M1 èŠ¯ç‰‡ä¸Šçš„ Mac ç¯å¢ƒä½œä¸ºç¤ºä¾‹ã€‚</p><h2 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼–è¯‘å®‰è£… php çš„æ—¶å€™ç›´æ¥ç¼–è¯‘è¿›å»</span>--enable-swoole <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pecl <span class="token function">install</span> swoole<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç¬¬ä¸‰ç§"><a href="#ç¬¬ä¸‰ç§" class="headerlink" title="ç¬¬ä¸‰ç§"></a>ç¬¬ä¸‰ç§</h2><p>docker å®‰è£…</p><h2 id="ç¬¬å››ç§"><a href="#ç¬¬å››ç§" class="headerlink" title="ç¬¬å››ç§"></a>ç¬¬å››ç§</h2><p>æºç ç¼–è¯‘å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»å®˜æ–¹æ‰©å±•ç½‘ç«™ä¸­ä¸‹è½½ swoole æºç å®‰è£…åŒ…ï¼Œè¿™é‡Œä¸‹è½½çš„ç‰ˆæœ¬ä¸º 4.4.3</span><span class="token function">wget</span> http://pecl.php.net/get/swoole-4.4.3.tgz<span class="token comment"># å®‰è£… 4.6.4 ç‰ˆæœ¬çš„ swoole</span><span class="token function">wget</span> https://github.com/swoole/swoole-src/archive/v4.6.4.tar.gz<span class="token comment"># è§£å‹å®‰è£…åŒ…å¹¶è¿›å…¥</span><span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> swoole-4.4.3.tgz <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> swoole-4.4.3<span class="token comment"># æŸ¥æ‰¾ phpize æ‰€åœ¨ç›®å½•</span><span class="token function">which</span> phpize<span class="token comment"># ä½¿ç”¨ phpize ç”Ÿæˆ configure æ–‡ä»¶</span>/usr/local/php/bin/phpize./configure --with-php-config<span class="token operator">=</span>/usr/local/php/bin/php-config --enable-openssl --enable-http2 --enable-sockets --enable-mysqlnd<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment"># åœ¨ php.ini é…ç½®æ–‡ä»¶ä¸­å¼€å¯ swoole æ‰©å±•</span><span class="token assign-left variable">extension</span><span class="token operator">=</span>swoole.so<span class="token comment"># é‡å¯ php</span>/etc/init.d/php-fpm restart<span class="token comment"># æŸ¥çœ‹æ‰©å±•æ˜¯å¦å·²ç»å¼€å¯</span>php <span class="token parameter variable">-m</span>  php <span class="token parameter variable">--ri</span> swoole<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="M1-èŠ¯ç‰‡-MacOS-ä¸Šå®‰è£…-swoole"><a href="#M1-èŠ¯ç‰‡-MacOS-ä¸Šå®‰è£…-swoole" class="headerlink" title="M1 èŠ¯ç‰‡ MacOS ä¸Šå®‰è£… swoole"></a>M1 èŠ¯ç‰‡ MacOS ä¸Šå®‰è£… swoole</h2><h3 id="ä¸‹è½½-swoole-æºç "><a href="#ä¸‹è½½-swoole-æºç " class="headerlink" title="ä¸‹è½½ swoole æºç "></a>ä¸‹è½½ swoole æºç </h3><pre class="line-numbers language-none"><code class="language-none"># ä¸‹è½½ swoole æºç wget https://github.com/swoole/swoole-src/archive/refs/tags/v4.8.1.zip# è§£å‹ç¼© swoole æºç unzip v4.8.1.zip# åˆ‡æ¢åˆ°æºç ç›®å½•ä¸­cd swoole-src-4.8.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…å‰å‡†å¤‡"><a href="#å®‰è£…å‰å‡†å¤‡" class="headerlink" title="å®‰è£…å‰å‡†å¤‡"></a>å®‰è£…å‰å‡†å¤‡</h3><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹ php å®‰è£…ç›®å½•which php# æ¯”å¦‚æˆ‘çš„ php ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š# /opt/homebrew/opt/php@7.4/bin/php# æŸ¥çœ‹ php-config ç›®å½•which php-config# æ¯”å¦‚æˆ‘çš„ php-config ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š# /opt/homebrew/opt/php@7.4/bin/php-config# æŸ¥çœ‹ phpize å®‰è£…ç›®å½•which phpize# æ¯”å¦‚æˆ‘çš„ phpize ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š# /opt/homebrew/opt/php@7.4/bin/phpize# æŸ¥çœ‹ openssl å®‰è£…è·¯å¾„brew info openssl# å¦‚æœå‡ºç°å¦‚ä¸‹æ‰€ç¤ºï¼š# export LDFLAGS="-L/opt/homebrew/opt/openssl@3/lib"# å¦‚æœæ²¡æœ‰å®‰è£… openssl çš„è¯ï¼Œåˆ™æ‰§è¡Œ `brew install openssl` è¿›è¡Œå®‰è£…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç¼–è¯‘å®‰è£…-swoole"><a href="#ç¼–è¯‘å®‰è£…-swoole" class="headerlink" title="ç¼–è¯‘å®‰è£… swoole"></a>ç¼–è¯‘å®‰è£… swoole</h3><pre class="line-numbers language-none"><code class="language-none"># ä½¿ç”¨ phpize åˆ›å»º php ç¼–è¯‘æ£€æµ‹è„šæœ¬ ./configure# åœ¨ swoole æºç ç›®å½•ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤# æ³¨æ„ï¼šéœ€è¦é€‰æ‹© php å¯¹åº”ç‰ˆæœ¬çš„ phpizeï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™ç¼–è¯‘å®‰è£…æ— æ³•ç”Ÿæ•ˆsudo /opt/homebrew/opt/php@7.4/bin/phpize# ä¼šç›´æ¥åœ¨ swoole æºç ç›®å½•ä¸­ç”Ÿæˆ configure æ‰§è¡Œæ–‡ä»¶# åˆ›å»ºç¼–è¯‘æ–‡ä»¶# å¼€å¯äº† swoole çš„ ssl åŠŸèƒ½# å¼€å¯äº† swoole æ”¯æŒ http2 ç›¸å…³çš„åŠŸèƒ½# m1 å†…æ ¸ä¸‹éœ€è¦å¼€å¯ --enable-thread-contextsudo ./configure \--with-php-config=/opt/homebrew/opt/php@7.4/bin/php-config \--with-openssl-dir=/opt/homebrew/opt/openssl \--enable-openssl \--enable-http2 \--enable-thread-context# ç¼–è¯‘ swoolesudo make &amp;&amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å°†-swoole-so-æ·»åŠ åˆ°-php-ini-é…ç½®æ–‡ä»¶ä¸­"><a href="#å°†-swoole-so-æ·»åŠ åˆ°-php-ini-é…ç½®æ–‡ä»¶ä¸­" class="headerlink" title="å°† swoole.so æ·»åŠ åˆ° php.ini é…ç½®æ–‡ä»¶ä¸­"></a>å°† swoole.so æ·»åŠ åˆ° php.ini é…ç½®æ–‡ä»¶ä¸­</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ php æ‰©å±•å®‰è£…ç›®å½•</span><span class="token comment"># æ¯”å¦‚æˆ‘çš„è·¯å¾„ä¸º</span><span class="token comment"># extension_dir =&gt; /opt/homebrew/lib/php/pecl/20190902 =&gt; /opt/homebrew/lib/php/pecl/20190902</span>php <span class="token parameter variable">-i</span> <span class="token operator">|</span> <span class="token function">grep</span> extension_dir<span class="token comment"># æŸ¥çœ‹è‡ªå·±çš„ php æ‰©å±•ç›®å½•ä¸‹æ˜¯å¦æœ‰ `swoole.so` æ–‡ä»¶</span><span class="token comment"># æ¯”å¦‚æˆ‘è¿™é‡Œ</span><span class="token builtin class-name">cd</span> /opt/homebrew/lib/php/pecl/20190902<span class="token comment"># å¦‚æœæ²¡æœ‰æ—¶ï¼Œåˆ™éœ€è¦å°†ç¼–è¯‘å¥½çš„ `swoole.so` æ–‡ä»¶å¤åˆ¶åˆ° php çš„æ‰©å±•ç›®å½•ä¸­ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œ</span><span class="token function">cp</span> swoole-src-4.8.1/.libs/swoole.so /opt/homebrew/lib/php/pecl/20190902<span class="token comment"># æŸ¥çœ‹ php.ini é…ç½®æ–‡ä»¶è·¯å¾„</span>php <span class="token parameter variable">--ini</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'Loaded Configuration File:'</span><span class="token comment"># æ¯”å¦‚æˆ‘è¿™é‡Œ</span><span class="token comment"># Loaded Configuration File:         /opt/homebrew/etc/php/7.4/php.ini</span><span class="token comment"># åœ¨ php.ini é…ç½®æ–‡ä»¶ä¸­æœ€åä¸€è¡Œæ·»åŠ  `extension="swoole.so"`</span><span class="token comment"># æ¯”å¦‚æˆ‘è¿™é‡Œ</span><span class="token comment"># vim /opt/homebrew/etc/php/7.4/php.ini</span><span class="token comment"># æŸ¥çœ‹ swoole æ‰©å±•è¯¦æƒ…</span>php <span class="token parameter variable">--ri</span> swoole<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Swoole </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç¼–å†™Dockerfile</title>
      <link href="posts/1a6d22ba.html"/>
      <url>posts/1a6d22ba.html</url>
      
        <content type="html"><![CDATA[<h1 id="ç¼–å†™-dockerfile"><a href="#ç¼–å†™-dockerfile" class="headerlink" title="ç¼–å†™ dockerfile"></a>ç¼–å†™ dockerfile</h1><p>Dockerfile æ–‡ä»¶æ˜¯ç”¨äºå®šä¹‰ Docker é•œåƒç”Ÿæˆæµç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯ä¸€æ¡æ¡æŒ‡ä»¤ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºï¼›è¿™äº›æŒ‡ä»¤åº”ç”¨äºåŸºç¡€é•œåƒå¹¶æœ€ç»ˆåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ<br>ä½ å¯ä»¥è®¤ä¸ºç”¨äºå¿«é€Ÿåˆ›å»ºè‡ªå®šä¹‰çš„ Docker é•œåƒã€‚</p><p>éƒ¨ç½²ä¸€ä¸ªç®€å•çš„ gin é¡¹ç›®ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å†™ Dockerfile</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># FROM æŒ‡å®šåŸºç¡€é•œåƒï¼ˆå¿…é¡»æœ‰çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼‰</span><span class="token instruction"><span class="token keyword">FROM</span> golang:latest</span><span class="token instruction"><span class="token keyword">ENV</span> GOPROXY https://goproxy.cn,direct</span><span class="token comment"># å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º $GOPATH/src/github.com/Alex/go-gin-example</span><span class="token comment"># ä½¿ç”¨ WORKDIR æŒ‡ä»¤å¯ä»¥æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆæˆ–è€…ç§°ä¸ºå½“å‰ç›®å½•ï¼‰ï¼Œ</span><span class="token comment"># ä»¥åå„å±‚çš„å½“å‰ç›®å½•å°±è¢«æ”¹ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼ŒWORKDIR ä¼šå¸®ä½ å»ºç«‹ç›®å½•</span><span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token variable">$GOPATH</span>/src/github.com/Alex/go-gin-example</span><span class="token comment"># å°†å½“å‰ä¸Šä¸‹æ–‡ç›®å½•çš„å†…å®¹å¤åˆ¶åˆ° $GOPATH/src/github.com/Alex/go-gin-example</span><span class="token comment"># COPY æºè·¯å¾„ ç›®æ ‡è·¯å¾„</span><span class="token instruction"><span class="token keyword">COPY</span> . <span class="token variable">$GOPATH</span>/src/github.com/Alex/go-gin-example</span><span class="token instruction"><span class="token keyword">RUN</span> go build .</span><span class="token comment"># EXPOSE æŒ‡ä»¤æ˜¯å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨è¿è¡Œæ—¶å¹¶ä¸ä¼šå› ä¸ºè¿™ä¸ªå£°æ˜åº”ç”¨å°±ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡</span><span class="token comment"># ä½†æ˜¯åœ¨ Dockerfile ä¸­å†™å…¥è¿™æ ·çš„å£°æ˜æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</span><span class="token comment"># 1. å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„</span><span class="token comment"># 2. è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ docker run -P æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 8000</span><span class="token comment"># å°†å®¹å™¨å¯åŠ¨ç¨‹åºè®¾ç½®ä¸º `./go-gin-example`</span><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">"./go-gin-example"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># -t æŒ‡å®šé•œåƒåç§°ä¸º blog-service:v1.0.0</span><span class="token comment"># . æ„å»ºå†…å®¹ä¸ºå½“å‰ä¸Šä¸‹æ–‡ç›®å½•</span><span class="token function">docker</span> build <span class="token parameter variable">-t</span> blog-service:v1.0.0 <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å½“å‰æ„å»ºçš„é•œåƒæ˜¯å¦å­˜åœ¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> images<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token parameter variable">--name</span> my-blog-service blog-service:v1.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœæƒ³è¦ä¸¤ä¸ªå®¹å™¨ä¹‹é—´å…³è”èµ·æ¥ï¼Œäº’ç›¸è®¿é—®çš„æ—¶å€™å¯ä»¥åœ¨å®¹å™¨å†…ç›´æ¥ä½¿ç”¨å…¶å…³è”çš„å®¹å™¨åˆ«åè¿›è¡Œè®¿é—®ï¼Œè€Œä¸æ˜¯é€šè¿‡ IPï¼Œæ¯”å¦‚æ­¤æ—¶åˆå§‹åŒ–çš„æ—¶å€™å°† <code>my-blog-service</code> å®¹å™¨å’Œ <code>mysql</code> å®¹å™¨è¿›è¡Œå…³è”</p><pre class="line-numbers language-none"><code class="language-none">docker run --link mysql:mysql -p 8000:8000 --name my-blog-service blog-service:v1.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker alpine linux ä¿®æ”¹æ—¶åŒº</title>
      <link href="posts/e7d57128.html"/>
      <url>posts/e7d57128.html</url>
      
        <content type="html"><![CDATA[<p>Docker alpine Linux ä¸­ä¿®æ”¹æ—¶åŒº</p><ul><li><a href="https://wiki.alpinelinux.org/wiki/Setting_the_timezone" title="å®˜æ–¹è§£å†³æ–¹æ¡ˆ">å®˜æ–¹è§£å†³æ–¹æ¡ˆ</a></li></ul><h2 id="å¦‚æœå·²ç»åœ¨å®¹å™¨ä¸­"><a href="#å¦‚æœå·²ç»åœ¨å®¹å™¨ä¸­" class="headerlink" title="å¦‚æœå·²ç»åœ¨å®¹å™¨ä¸­"></a>å¦‚æœå·²ç»åœ¨å®¹å™¨ä¸­</h2><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># å®‰è£… timezone æ•°æ®åŒ…</span>apk add tzdata<span class="token comment"># é˜²æ­¢æ·»åŠ å¤±è´¥ï¼Œå¯ä»¥åŠ ä¸Š -U å‚æ•°ï¼Œæ›´æ–°ä»“åº“ç¼“å­˜</span>apk add -U tzdatals /usr/share/zoneinfocp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<span class="token comment"># æŒ‡å®šä¸ºä¸Šæµ·æ—¶åŒº</span>echo "Asia/Shanghai" &gt;  /etc/timezone<span class="token comment"># éªŒè¯æ—¶åŒº `CST` å³ä¸ºä¸­å›½æ ‡å‡†æ—¶é—´</span>date<span class="token comment"># date -R</span><span class="token comment"># ç¤ºä¾‹å¦‚ä¸‹ï¼š</span><span class="token comment"># /etc # date</span><span class="token comment"># Tue May  3 01:41:18 CST 2022</span><span class="token comment"># /etc # date -R</span><span class="token comment"># Tue, 03 May 2022 01:41:25 +0800</span><span class="token comment"># ä¸ºäº†é™ä½å®¹å™¨ç©ºé—´ï¼Œå¯ä»¥åˆ é™¤æ‰æ•°æ®åŒ…</span>apk del tzdata<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚æœæ˜¯åœ¨-dockerfile-ä¸­"><a href="#å¦‚æœæ˜¯åœ¨-dockerfile-ä¸­" class="headerlink" title="å¦‚æœæ˜¯åœ¨ dockerfile ä¸­"></a>å¦‚æœæ˜¯åœ¨ dockerfile ä¸­</h2><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">RUN</span> apk add tzdata <span class="token operator">\</span>&amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class="token operator">\</span>&amp;&amp; echo <span class="token string">"Asia/Shanghai"</span> &gt;  /etc/timezone <span class="token operator">\</span>&amp;&amp; apk del tzdata</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker å®¹å™¨å†…æœåŠ¡è®¿é—®å®¿ä¸»æœºä¸­çš„æœåŠ¡</title>
      <link href="posts/f085ffcd.html"/>
      <url>posts/f085ffcd.html</url>
      
        <content type="html"><![CDATA[<h1 id="docker-å®¹å™¨å†…æœåŠ¡è®¿é—®å®¿ä¸»æœºä¸­çš„æœåŠ¡"><a href="#docker-å®¹å™¨å†…æœåŠ¡è®¿é—®å®¿ä¸»æœºä¸­çš„æœåŠ¡" class="headerlink" title="docker å®¹å™¨å†…æœåŠ¡è®¿é—®å®¿ä¸»æœºä¸­çš„æœåŠ¡"></a>docker å®¹å™¨å†…æœåŠ¡è®¿é—®å®¿ä¸»æœºä¸­çš„æœåŠ¡</h1><p>å‡è®¾ docker ä¸­çš„æŸæœåŠ¡è¦è®¿é—®å®¿ä¸»æœºçš„ mysql æ—¶ï¼š</p><h2 id="ç¬¬ä¸€ç§ï¼šé€šè¿‡-docker0-çš„-IP-åœ°å€è¿›è¡Œè®¿é—®"><a href="#ç¬¬ä¸€ç§ï¼šé€šè¿‡-docker0-çš„-IP-åœ°å€è¿›è¡Œè®¿é—®" class="headerlink" title="ç¬¬ä¸€ç§ï¼šé€šè¿‡ docker0 çš„ IP åœ°å€è¿›è¡Œè®¿é—®"></a>ç¬¬ä¸€ç§ï¼šé€šè¿‡ docker0 çš„ IP åœ°å€è¿›è¡Œè®¿é—®</h2><ol><li>å…ˆåœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ <code>docker0</code> å¯¹åº”çš„ <code>inet</code> IP åœ°å€</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœæ˜¯ CentOS æˆ–è€… Ubuntu</span><span class="token function">ifconfig</span> <span class="token comment"># æˆ–è€…ä½¿ç”¨</span><span class="token function">ip</span> addr show docker0<span class="token comment"># å‡è®¾æŸ¥çœ‹çš„ docker0 çš„ ip åœ°å€ä¸ºï¼š172.18.0.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ä¿®æ”¹ mysql çš„é…ç½®æ–‡ä»¶ï¼Œä¿è¯ mysql å¯ä»¥è¢«ä»»ä½• ip è®¿é—®ï¼Œ<strong>ä½†æ˜¯ä¸€å®šä¸èƒ½å¼€æ”¾ 3306 ç«¯å£ï¼Œä¸ç„¶å¤–ç½‘å°±å¯ä»¥ç›´æ¥è®¿é—® mysql äº†</strong>ï¼Œå¦‚æœä¸å¼€æ”¾å…è®¸ä»»ä½• ip è®¿é—®ï¼Œé‚£ä¹ˆåˆ™å¿…é¡»è¦å¼€æ”¾å…è®¸ docker æœåŠ¡å®¹å™¨çš„ IP èƒ½å¤Ÿè®¿é—®ã€‚ï¼ˆæ³¨æ„è¿™é‡Œçš„ IP æ˜¯éœ€è¦è¿æ¥å®¿ä¸»æœº mysql docker å®¹å™¨çš„ IP ä¸æ˜¯ docker0 çš„ IPï¼‰</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">[mysqld]bind-address = 0.0.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>docker å®¹å™¨ä¸­çš„æœåŠ¡è¿æ¥ mysql æ—¶ï¼Œç›´æ¥é‡‡ç”¨ <code>docker0</code> çš„ IP åœ°å€è¿›è¡Œè®¿é—®å³å¯ã€‚å³ <code>172.18.0.1</code></li></ol><h2 id="ç¬¬äºŒç§ï¼šå°†å®¹å™¨çš„ç½‘ç»œç±»å‹æ”¹æˆ-host-ï¼ˆå®¿ä¸»ç½‘ç»œï¼šå³ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œï¼‰"><a href="#ç¬¬äºŒç§ï¼šå°†å®¹å™¨çš„ç½‘ç»œç±»å‹æ”¹æˆ-host-ï¼ˆå®¿ä¸»ç½‘ç»œï¼šå³ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œï¼‰" class="headerlink" title="ç¬¬äºŒç§ï¼šå°†å®¹å™¨çš„ç½‘ç»œç±»å‹æ”¹æˆ host ï¼ˆå®¿ä¸»ç½‘ç»œï¼šå³ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œï¼‰"></a>ç¬¬äºŒç§ï¼šå°†å®¹å™¨çš„ç½‘ç»œç±»å‹æ”¹æˆ host ï¼ˆå®¿ä¸»ç½‘ç»œï¼šå³ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œï¼‰</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯”å¦‚å®¹å™¨å¯åŠ¨æ—¶ï¼Œå¢åŠ  --net=host å‚æ•°</span><span class="token comment"># åœ¨è¿™é‡Œå°±æ²¡æœ‰å¿…è¦å»æŒ‡å®šæ˜ å°„ç«¯å£ï¼Œå› ä¸ºå®¹å™¨ä¸­æš´éœ²å‡ºå»çš„ç«¯å£ç­‰åŒäºå®¿ä¸»æœºæš´éœ²çš„ç«¯å£</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--net</span><span class="token operator">=</span>host <span class="token punctuation">{</span>image<span class="token punctuation">}</span> <span class="token function">sh</span><span class="token comment"># æµ‹è¯•ï¼š</span><span class="token function">ping</span> localhost<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬ä¸‰ç§ï¼šå¢åŠ -host-docker-internal-åˆ°-hosts-æ–‡ä»¶"><a href="#ç¬¬ä¸‰ç§ï¼šå¢åŠ -host-docker-internal-åˆ°-hosts-æ–‡ä»¶" class="headerlink" title="ç¬¬ä¸‰ç§ï¼šå¢åŠ  host.docker.internal åˆ° hosts æ–‡ä»¶"></a>ç¬¬ä¸‰ç§ï¼šå¢åŠ  <code>host.docker.internal</code> åˆ° <code>hosts</code> æ–‡ä»¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># host-gateway å…¶å®æ˜¯ä¸ªç‰¹æ®Šçš„ CDNï¼Œåœ¨è¿è¡Œæ—¶ä¼šè¢«æ›¿æ¢ä¸ºçœŸå®çš„å®¿ä¸»ç½‘å…³ IP åœ°å€</span><span class="token comment"># é€šè¿‡æŸ¥çœ‹ `cat /etc/hosts` å³å¯å¾—çŸ¥å·²ç»è¢«æ›¿æ¢æˆ docker0 çš„ç½‘ç®¡ IP åœ°å€</span><span class="token comment"># åˆ›å»ºå®¹å™¨çš„æ—¶å€™æ·»åŠ  `--add-host=host.docker.internal:host-gateway`</span><span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</span><span class="token comment"># å¯¹äº mac ä¸Šçš„ docker è®¾ç½®è¿˜æœ‰ç•¥å¾®ä¸ä¸€æ ·</span><span class="token comment"># mac docker ç‰ˆæœ¬åœ¨ v17.12-v18.02 éœ€è¦å°† host.docker.internal æ›¿æ¢æˆ docker.for.mac.host.internal</span><span class="token comment"># mac docker ç‰ˆæœ¬åœ¨ v17.06-v18.11 éœ€è¦æ›¿æ¢æˆ docker.for.mac.localhost</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> --add-host<span class="token operator">=</span>host.docker.internal:host-gateway <span class="token punctuation">{</span>image<span class="token punctuation">}</span> <span class="token function">sh</span><span class="token comment"># è¿›å…¥å®¹å™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ ping è¿›è¡Œæµ‹è¯•ï¼š</span><span class="token function">ping</span> host.docker.internal<span class="token comment"># æ¯”å¦‚åœ¨å®¹å™¨ä¸­è¿æ¥å®¿ä¸»æœºä¸­çš„ mysql æ—¶ï¼Œé‚£ä¹ˆåˆ™éœ€è¦è®¾ç½®ä¸º</span>host.docker.internal:3306<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker å®¹å™¨å…³è”çš„å‡ ç§æ–¹å¼</title>
      <link href="posts/775a3bbf.html"/>
      <url>posts/775a3bbf.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-é€šè¿‡-link-å®¹å™¨å…³è”"><a href="#1-é€šè¿‡-link-å®¹å™¨å…³è”" class="headerlink" title="1. é€šè¿‡ link å®¹å™¨å…³è”"></a>1. é€šè¿‡ link å®¹å™¨å…³è”</h2><p>é€šè¿‡ <code>--link</code>ï¼Œå¯ä»¥åœ¨å®¹å™¨å†…ç›´æ¥ä½¿ç”¨å…¶å…³è”çš„å®¹å™¨åˆ«åè¿›è¡Œè®¿é—®ï¼Œè€Œä¸é€šè¿‡ IPï¼Œä½†æ˜¯ â€“link åªèƒ½è§£å†³å•æœºå®¹å™¨é—´çš„å…³è”ï¼Œåœ¨åˆ†å¸ƒå¼å¤šæœºçš„æƒ…å†µä¸‹ï¼Œéœ€è¦é€šè¿‡åˆ«çš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># -- link &lt;å®¹å™¨åç§°&gt;:&lt;å®¹å™¨åˆ«åï¼ˆå¯ä»¥é€šè¿‡å®¹å™¨åˆ«åç›´æ¥è®¿é—®åˆ°å¯¹æ–¹å®¹å™¨çš„ ipï¼Œè®¾ç½®äº†å®¹å™¨åˆ«ååŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡å¯¹æ–¹å®¹å™¨çš„ ip è®¿é—®ï¼‰&gt;</span><span class="token comment"># alex-mysql ä¸º mysql å®ä¾‹çš„å®¹å™¨åç§°</span><span class="token comment"># åœ¨æœåŠ¡ä¸­å¯ä»¥ç›´æ¥é€šè¿‡ mysql-service å»è®¿é—®åˆ° alex-mysql å®¹å™¨çš„ IP</span><span class="token parameter variable">--link</span> alex-mysql:mysql-service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-é€šè¿‡å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ª-network-ç½‘ç»œè¿›è¡Œå…³è”"><a href="#2-é€šè¿‡å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ª-network-ç½‘ç»œè¿›è¡Œå…³è”" class="headerlink" title="2. é€šè¿‡å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ª network ç½‘ç»œè¿›è¡Œå…³è”"></a>2. é€šè¿‡å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ª network ç½‘ç»œè¿›è¡Œå…³è”</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºä¸€ä¸ª some-network ç½‘ç»œ</span><span class="token function">docker</span> network create <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span><span class="token comment"># æŒ‡å®šæ¡¥æ¥æ¨¡å¼åˆ›å»ºï¼ˆä¸æŒ‡å®šæ—¶ï¼Œé»˜è®¤å°±æ˜¯æ¡¥æ¥æ¨¡å¼ï¼‰</span><span class="token function">docker</span> network create <span class="token parameter variable">-d</span> bridge <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span><span class="token comment"># é€šè¿‡ --network å°†å½“å‰å®¹å™¨åŠ å…¥åˆ°æ­¤ç½‘ç»œä¸­</span><span class="token function">docker</span> run <span class="token parameter variable">--name</span> <span class="token punctuation">{</span>redis-server<span class="token punctuation">}</span> <span class="token parameter variable">--network</span> <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span> <span class="token parameter variable">-d</span> redis<span class="token comment"># è®¿é—®æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®¹å™¨åç§°è¿›è¡Œè®¿é—®ï¼Œæ¯”å¦‚è¿™é‡Œï¼šredis-server</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--network</span> <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span> <span class="token parameter variable">--rm</span> redis redis-cli <span class="token parameter variable">-h</span> <span class="token punctuation">{</span>redis-server<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä»–å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å·²å­˜åœ¨çš„ç½‘ç»œ</span><span class="token function">docker</span> network list<span class="token comment"># åˆ é™¤è‡ªå®šä¹‰ç½‘ç»œ</span><span class="token function">docker</span> network <span class="token function">rm</span> <span class="token punctuation">{</span>network-id or some-network<span class="token punctuation">}</span><span class="token comment"># å°†å·²æœ‰å®¹å™¨è¿æ¥åˆ° docker ç½‘ç»œ</span><span class="token function">docker</span> network connect <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span> <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span><span class="token comment"># æŸ¥çœ‹ç½‘ç»œæƒ…å†µ</span><span class="token function">docker</span> network inspect <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span><span class="token comment"># æ–­å¼€ç½‘ç»œ</span><span class="token function">docker</span> network disconnect <span class="token punctuation">{</span>some-network<span class="token punctuation">}</span> <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€èµ·æ¥äº†è§£ä¸‹Docker-compose</title>
      <link href="posts/2d05cf8b.html"/>
      <url>posts/2d05cf8b.html</url>
      
        <content type="html"><![CDATA[<p>Docker Composeæ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡Composeï¼Œä½ å¯ä»¥ä½¿ç”¨ YAML æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡ã€‚ç„¶åï¼Œåªéœ€ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œå°±å¯ä»¥åˆ›å»ºå¹¶å¯åŠ¨é…ç½®ä¸­çš„æ‰€æœ‰æœåŠ¡ã€‚è¿™ä½¿å¾—éƒ¨ç½²å¤šå®¹å™¨åº”ç”¨å˜å¾—ç®€å•å¿«æ·ã€‚</p><h3 id="æ ¸å¿ƒç‰¹æ€§"><a href="#æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h3><ul><li><p><strong>å¤šå®¹å™¨ç¼–æ’</strong>ï¼šDocker Compose å…è®¸ä½ åœ¨å•ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„å®¹å™¨ä½œä¸ºé¡¹ç›®ã€‚è¿™äº›å®¹å™¨é€šè¿‡ç½‘ç»œè¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ•´ä½“æœåŠ¡ã€‚</p></li><li><p><strong>æ˜“äºé…ç½®</strong>ï¼šä½¿ç”¨ YAML æ–‡ä»¶å®šä¹‰æœåŠ¡é…ç½®ï¼Œä½¿å…¶æ˜“äºç¼–å†™ã€è¯»å–å’Œç»´æŠ¤ã€‚</p></li><li><p><strong>ä¸€é”®éƒ¨ç½²</strong>ï¼šåªéœ€ä¸€ä¸ª<code>docker-compose up</code>å‘½ä»¤ï¼Œå°±å¯ä»¥å¯åŠ¨å’Œè¿è¡Œæ•´ä¸ªåº”ç”¨ç¯å¢ƒã€‚</p></li><li><p><strong>ç¯å¢ƒéš”ç¦»</strong>ï¼šDocker Compose ä½¿ç”¨é¡¹ç›®åç§°æ¥éš”ç¦»ä¸åŒçš„ç¯å¢ƒï¼Œæ‚¨å¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªç¯å¢ƒï¼Œè€Œä¸ä¼šäº§ç”Ÿå†²çªã€‚</p></li><li><p><strong>å¯é‡å¤æ€§</strong>ï¼šç”±äºæœåŠ¡å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­é‡å¤éƒ¨ç½²ç›¸åŒçš„åº”ç”¨é…ç½®ï¼Œç¡®ä¿ç¯å¢ƒä¹‹é—´çš„ä¸€è‡´æ€§ã€‚</p></li></ul><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul><li><p><strong>å¼€å‘ç¯å¢ƒ</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ Docker Compose æ¥å®šä¹‰å’Œè¿è¡Œåº”ç”¨çš„æ‰€æœ‰ä¾èµ–æœåŠ¡ï¼Œä¾‹å¦‚æ•°æ®åº“ã€ç¼“å­˜ç­‰ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºå’Œæ‹†è§£å¼€å‘ç¯å¢ƒã€‚</p></li><li><p><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ï¼šé€šè¿‡å®šä¹‰åŒ…å«åº”ç”¨åŠå…¶ä¾èµ–æœåŠ¡çš„ Compose æ–‡ä»¶ï¼Œå¯ä»¥è½»æ¾åœ°åœ¨ CI/CD ç®¡é“ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p></li><li><p><strong>å°è§„æ¨¡ç”Ÿäº§éƒ¨ç½²</strong>ï¼šå¯¹äºå°å‹é¡¹ç›®æˆ–åˆæœŸé˜¶æ®µçš„äº§å“ï¼ŒDocker Compose æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥éƒ¨ç½²å’Œç®¡ç†å¤šå®¹å™¨åº”ç”¨ã€‚</p></li></ul><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><ol><li><p><strong>å®šä¹‰æœåŠ¡</strong>ï¼šåœ¨<code>docker-compose.yml</code>æ–‡ä»¶ä¸­å®šä¹‰åº”ç”¨æ‰€éœ€çš„æœåŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºé•œåƒçš„é…ç½®ã€å®¹å™¨è¿è¡Œæ—¶é…ç½®ï¼ˆå¦‚ç«¯å£æ˜ å°„ã€å·æŒ‚è½½ï¼‰ç­‰ã€‚</p></li><li><p><strong>å¯åŠ¨æœåŠ¡</strong>ï¼šè¿è¡Œ<code>docker-compose up</code>å‘½ä»¤æ¥å¯åŠ¨å¹¶è¿è¡Œå®šä¹‰çš„æ‰€æœ‰æœåŠ¡ã€‚Compose ä¼šæŒ‰ç…§ä¾èµ–å…³ç³»é¡ºåºå¯åŠ¨æœåŠ¡ï¼Œå¹¶ç¡®ä¿æ‰€éœ€çš„ç½‘ç»œå’Œå·å·²æ­£ç¡®è®¾ç½®ã€‚</p></li><li><p><strong>ç®¡ç†æœåŠ¡</strong>ï¼šä½¿ç”¨<code>docker-compose</code>å‘½ä»¤å¯ä»¥ç®¡ç†æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚å¯åŠ¨ã€åœæ­¢ã€é‡å»ºç­‰ã€‚</p></li></ol><h3 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h3><p>è¦å¼€å§‹ä½¿ç”¨ Docker Composeï¼Œæ‚¨éœ€è¦ï¼š</p><ol><li><p><strong>å®‰è£…Docker</strong>ï¼šç¡®ä¿æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£…äº† Dockerã€‚</p></li><li><p><strong>å®‰è£…Docker Compose</strong>ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒDocker Compose å¯ä»¥ä¸ Docker ä¸€èµ·å®‰è£…ã€‚</p></li><li><p><strong>ç¼–å†™<code>docker-compose.yml</code>æ–‡ä»¶</strong>ï¼šå®šä¹‰æ‚¨çš„å¤šå®¹å™¨åº”ç”¨ã€‚</p></li><li><p><strong>è¿è¡Œ<code>docker-compose up</code>å‘½ä»¤</strong>ï¼šå¯åŠ¨å¹¶è¿è¡Œæ‚¨çš„åº”ç”¨ã€‚</p></li></ol><p>ä»‹äºç¯‡å¹…æœ‰é™ï¼Œä»Šå¤©æš‚æ—¶ä»‹ç» docker-compose çš„å®‰è£…æ–¹å¼ï¼Œåé¢æœ‰æ—¶é—´äº†å†è®²å…·ä½“çš„ä½¿ç”¨ã€‚</p><h3 id="å®‰è£…-docker-compose"><a href="#å®‰è£…-docker-compose" class="headerlink" title="å®‰è£… docker-compose"></a>å®‰è£… docker-compose</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨æºç å®‰è£…ï¼ˆæ¨èæ–¹å¼ï¼‰</span><span class="token punctuation">[</span>æœ€æ–°å‘è¡Œçš„ç‰ˆæœ¬åœ°å€<span class="token punctuation">]</span><span class="token punctuation">(</span>https://github.com/docker/compose/releases<span class="token punctuation">)</span><span class="token comment"># å®‰è£… 1.27.4 ç‰ˆæœ¬çš„ docker-compose ï¼ˆä¸‹è½½äº†æºç ï¼Œå¹¶æ”¹åä¸º docker-composeï¼‰</span><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose<span class="token comment"># å¢åŠ æ‰§è¡Œæƒé™</span><span class="token function">sudo</span> <span class="token function">chmod</span> u+x /usr/local/bin/docker-compose<span class="token comment"># å»ºç«‹è½¯è¿æ¥åˆ° /usr/bin ç›®å½•</span><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/bin/docker-compose /usr/bin/docker-compose<span class="token comment"># æŸ¥çœ‹ docker-compose ç‰ˆæœ¬</span><span class="token function">docker-compose</span> version---------------------------------<span class="token comment"># å¦‚æœæ˜¯åœ¨ centos ç³»ç»Ÿä¸­</span><span class="token comment"># å®‰è£…æ‰©å±•æº</span><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> epel-release<span class="token comment"># å®‰è£… python-pip æ¨¡å—</span><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> python-pip<span class="token comment"># å¦‚æœæ˜¯åœ¨ ubuntu ç³»ç»Ÿä¸­</span><span class="token comment"># å®‰è£… python-pip æ¨¡å—</span><span class="token function">apt</span> <span class="token function">install</span> python-pip<span class="token comment"># ä½¿ç”¨ pip å®‰è£… docker-compose</span>pip <span class="token function">install</span> <span class="token function">docker-compose</span><span class="token comment"># åˆ é™¤æ‰æ—§çš„ç¯å¢ƒå˜é‡ docker-compose</span><span class="token function">sudo</span> <span class="token function">rm</span> /usr/bin/docker-compose<span class="token function">sudo</span> <span class="token function">rm</span> /usr/local/bin/docker-compose<span class="token comment"># æˆ–è€…ä½¿ç”¨ pip å‘½ä»¤å¸è½½ docker-compose</span>pip uninstall <span class="token function">docker-compose</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸è§å‘½ä»¤"><a href="#å¸¸è§å‘½ä»¤" class="headerlink" title="å¸¸è§å‘½ä»¤"></a>å¸¸è§å‘½ä»¤</h3><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># å¯åŠ¨å®¹å™¨</span>docker-compose up -d<span class="token comment"># æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</span>docker-compose ps<span class="token comment"># æŸ¥çœ‹æ—¥å¿—</span>docker-compose logs<span class="token comment"># å…³é—­å®¹å™¨</span>docker-compose stop<span class="token comment"># å¯åŠ¨å®¹å™¨</span>docker-compose start<span class="token comment"># é‡å¯å®¹å™¨</span>docker-compose restart<span class="token comment"># å…³é—­å¹¶åˆ é™¤å®¹å™¨</span>docker-compose down<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch èšåˆæŸ¥è¯¢</title>
      <link href="posts/25480f12.html"/>
      <url>posts/25480f12.html</url>
      
        <content type="html"><![CDATA[<h2 id="èšåˆçš„åŸºæœ¬è¯­æ³•ç»“æ„"><a href="#èšåˆçš„åŸºæœ¬è¯­æ³•ç»“æ„" class="headerlink" title="èšåˆçš„åŸºæœ¬è¯­æ³•ç»“æ„"></a>èšåˆçš„åŸºæœ¬è¯­æ³•ç»“æ„</h2><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"{aggregations_name_1}"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"{aggregations_type}"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token punctuation">{</span>aggregations_body<span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"{aggregations_name_2}"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"{aggregations_type}"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token punctuation">{</span>aggregations_body<span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>aggregations</code> è¡¨ç¤ºèšåˆæŸ¥è¯¢è¯­å¥ï¼Œå¯ä»¥ç®€å†™ä¸º <code>aggs</code></li><li><code>{aggregations_name_1}</code> è¡¨ç¤ºä¸€ä¸ªèšåˆè®¡ç®—çš„åç§°ï¼Œå¯ä»¥éšæ„å‘½åï¼Œå› ä¸º es æ”¯æŒä¸€æ¬¡è¿›è¡Œå¤šæ¬¡ç»Ÿè®¡åˆ†ææŸ¥è¯¢ï¼Œåé¢éœ€è¦é€šè¿‡è¿™ä¸ªåå­—åœ¨æŸ¥è¯¢ç»“æœä¸­æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„è®¡ç®—ç»“æœ</li><li><code>{aggregations_type}</code> è¡¨ç¤ºèšåˆç±»å‹ï¼Œä»£è¡¨æˆ‘ä»¬æƒ³è¦æ€ä¹ˆç»Ÿè®¡æ•°æ®ï¼Œä¸»è¦æœ‰ä¸¤å¤§ç±»èšåˆç±»å‹ï¼Œ<strong>æ¡¶èšåˆ</strong> å’Œ <strong>æŒ‡æ ‡èšåˆ</strong>ï¼Œè¿™ä¸¤ç±»èšåˆåˆåŒ…æ‹¬å¤šç§èšåˆç±»å‹ã€‚æŒ‡æ ‡èšåˆï¼šsumã€avg æ¡¶èšåˆï¼šterms</li><li><code>{aggregations_body}</code> èšåˆç±»å‹çš„å‚æ•°ï¼Œé€‰æ‹©ä¸åŒçš„èšåˆç±»å‹ï¼Œæœ‰ä¸åŒçš„å‚æ•°</li><li><code>{aggregations_name_2}</code> è¡¨ç¤ºå…¶ä»–èšåˆè®¡ç®—çš„åå­—ï¼Œå¯ä»¥è¿›è¡Œå¤šç§ç±»å‹çš„ç»Ÿè®¡</li></ul><h3 id="value-count-å€¼èšåˆ"><a href="#value-count-å€¼èšåˆ" class="headerlink" title="value count å€¼èšåˆ"></a>value count å€¼èšåˆ</h3><p>value count å€¼èšåˆï¼Œä¸»è¦ç”¨äºç»Ÿè®¡æ–‡æ¡£æ€»æ•°ï¼Œç±»ä¼¼ sql ä¸­çš„ <code>count</code> å‡½æ•°</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_count"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// èšåˆæŸ¥è¯¢çš„åå­—ï¼Œå¯ä»¥éšä¾¿å–ä¸€ä¸ªåå­—</span>      <span class="token property">"value_count"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// èšåˆç±»å‹ä¸ºï¼švalue_count</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"app_name1"</span>  <span class="token comment">// è®¡ç®— app_name1 è¿™ä¸ªå­—æ®µå€¼çš„æ€»æ•°</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># è¿”å›å€¼ç¤ºä¾‹<span class="token punctuation">{</span>  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_count"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">2</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="cardinality"><a href="#cardinality" class="headerlink" title="cardinality"></a>cardinality</h3><p>cardinality åŸºæ•°èšåˆï¼Œä¹Ÿç”¨äºç»Ÿè®¡æ–‡æ¡£çš„æ€»æ•°ï¼Œè·Ÿ value count çš„åŒºåˆ«æ˜¯ï¼ŒåŸºæ•°èšåˆä¼šå»é‡ï¼Œä¸ä¼šç»Ÿè®¡é‡å¤çš„å€¼ï¼Œç±»ä¼¼ sql ä¸­çš„ <code>count(DISTINCT field)</code> ç”¨æ³•</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_count"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"cardinality"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"check_status"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># è¿”å›å€¼ç¤ºä¾‹<span class="token punctuation">{</span>  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_count"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">1</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="avg"><a href="#avg" class="headerlink" title="avg"></a>avg</h3><p>æ±‚å¹³å‡å€¼</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_avg"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"check_status"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># è¿”å›å€¼ç¤ºä¾‹<span class="token punctuation">{</span>  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_avg"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">2.6666666666666665</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h3><p>æ±‚å’Œ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_sum"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"sum"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"check_status"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># è¿”å›å€¼ç¤ºä¾‹<span class="token punctuation">{</span>  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_sum"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">8.0</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="max"><a href="#max" class="headerlink" title="max"></a>max</h3><p>æ±‚æœ€å¤§å€¼</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_max"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"max"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"check_status"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># è¿”å›å€¼ç¤ºä¾‹<span class="token punctuation">{</span>  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_max"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3.0</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="min"><a href="#min" class="headerlink" title="min"></a>min</h3><p>æ±‚æœ€å°å€¼</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_min"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"min"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"check_status"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># è¿”å›å€¼ç¤ºä¾‹<span class="token punctuation">{</span>  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token property">"relation"</span> <span class="token operator">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"alex_max"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token number">2.0</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch æŸ¥è¯¢è¯­æ³•</title>
      <link href="posts/65a50e61.html"/>
      <url>posts/65a50e61.html</url>
      
        <content type="html"><![CDATA[<h2 id="æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•ç»“æ„"><a href="#æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•ç»“æ„" class="headerlink" title="æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•ç»“æ„"></a>æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•ç»“æ„</h2><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>/_search<span class="token punctuation">{</span>    <span class="token property">"from"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// æœç´¢ç»“æœçš„å¼€å§‹ä½ç½®</span>    <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">// åˆ†é¡µå¤§å°ï¼Œæ¯é¡µæ˜¾ç¤ºæ•°é‡</span>    <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"field_1"</span><span class="token punctuation">,</span> <span class="token string">"field_2"</span><span class="token punctuation">,</span> <span class="token string">"field_3"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// éœ€è¦è¿”å›çš„å­—æ®µæ•°ç»„</span>    <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// must æ¡ä»¶ï¼Œç±»ä¼¼ sql ä¸­çš„ andï¼Œä»£è¡¨å¿…é¡»åŒ¹é…æ¡ä»¶</span>            <span class="token property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// must_not æ¡ä»¶ï¼Œè·Ÿ must ç›¸åï¼Œå¿…é¡»ä¸åŒ¹é…æ¡ä»¶ï¼Œç›¸å½“äº sql è¯­å¥ä¸­çš„ `!=`</span>            <span class="token property">"should"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// should æ¡ä»¶ï¼Œç±»ä¼¼ sql ä¸­çš„ orï¼Œä»£è¡¨åŒ¹é…å…¶ä¸­ä¸€ä¸ªæ¡ä»¶</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// query å­å¥</span>    <span class="token property">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// aggs å­å¥ï¼Œä¸»è¦ç”¨æ¥ç¼–å†™ç»Ÿè®¡åˆ†æè¯­å¥ï¼Œç±»ä¼¼ sql çš„ group by å­å¥</span>    <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token property">"{field1}"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// éœ€è¦æ’åºçš„å­—æ®µ</span>                <span class="token property">"order"</span><span class="token operator">:</span> <span class="token string">"desc"</span>  <span class="token comment">// æ’åºçš„è§„åˆ™ï¼Œasc å‡åºï¼Œdesc é™åº</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>            <span class="token property">"{field2}"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token property">"order"</span><span class="token operator">:</span> <span class="token string">"asc"</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token comment">// æ’åºå­å¥</span><span class="token punctuation">}</span># ä¹Ÿå¯ä»¥å¤šä¸ªç´¢å¼•åŒæ—¶æŸ¥è¯¢# å¤šä¸ªç´¢å¼•åŒæ—¶æŸ¥è¯¢æ—¶ï¼Œç”¨é€—å·åˆ†éš”ï¼Œæ¯”å¦‚ï¼šGET /<span class="token punctuation">{</span>index1<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>index2<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>index3<span class="token punctuation">}</span>/_doc/_search# æˆ–è€…ä½¿ç”¨å‰ç¼€æ¨¡ç³ŠåŒ¹é…ï¼Œæ¯”å¦‚ï¼šGET /rcp_goods_img_*/_doc/_search<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Filter-å’Œ-Query"><a href="#Filter-å’Œ-Query" class="headerlink" title="Filter å’Œ Query"></a>Filter å’Œ Query</h2><p>ä»»ä½•ä¸€ä¸ª document å¯¹äº filter æ¥è¯´ï¼Œå°±æ˜¯ <strong>match ä¸å¦</strong> çš„é—®é¢˜ï¼Œæ˜¯ä¸ªäºŒå€¼é—®é¢˜ï¼Œ0 å’Œ 1 æ²¡æœ‰ <strong>scroing</strong> çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ä½¿ç”¨ query çš„æ—¶å€™ï¼Œæ˜¯è¡¨ç¤º <strong>match ç¨‹åº¦é—®é¢˜ï¼Œæœ‰ scroing è¿‡ç¨‹</strong>ã€‚</p><p>es åº•å±‚å¯¹ filter åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä¼šå¯¹è¿‡æ»¤ç»“æœè¿›è¡Œç¼“å­˜ï¼ŒåŒæ—¶ï¼Œfilter æ²¡æœ‰ç›¸å…³æ€§è®¡ç®—è¿‡ç¨‹ï¼Œæ‰€ä»¥ filter æ¯” query å¿«ã€‚</p><p>æ‰€ä»¥ï¼Œå®˜ç½‘æ¨èï¼Œä½œä¸ºä¸€æ¡æ¯”è¾ƒé€šç”¨çš„è§„åˆ™ï¼š<em><strong>ä»…åœ¨å…¨æ–‡æ£€ç´¢æ—¶ï¼Œä½¿ç”¨ Queryï¼Œå…¶å®ƒæ—¶å€™éƒ½ç”¨ Filter</strong></em>ï¼Œä½†æ˜¯è¿˜æ˜¯å¾—æŒ‰ç…§æˆ‘ä»¬çš„å®é™…æƒ…å†µæ¥çœ‹ï¼Œæ¯•ç«Ÿæœ‰äº›æ—¶å€™ç”¨ç©ºé—´æ¢æ—¶é—´ä¸ä¸€å®šåˆ’ç®—ã€‚</p><h2 id="match-å’Œ-term"><a href="#match-å’Œ-term" class="headerlink" title="match å’Œ term"></a>match å’Œ term</h2><p>match æŸ¥è¯¢çš„æ—¶å€™ï¼Œes ä¼šæ ¹æ®ä½ ç»™å®šçš„å­—æ®µæä¾›åˆé€‚çš„åˆ†æå™¨ï¼Œè€Œ term æŸ¥è¯¢ä¸ä¼šæœ‰åˆ†æå™¨åˆ†æçš„è¿‡ç¨‹ï¼Œmatch æŸ¥è¯¢ç›¸å½“äºæ¨¡ç³ŠåŒ¹é…ï¼ŒåªåŒ…å«å…¶ä¸­ä¸€éƒ¨åˆ†å…³é”®è¯å°±è¡Œã€‚<strong>match ç³»åˆ—åŒ¹é…æ—¶ï¼Œdatatype è¦è®¾ç½®ä¸º text ï¼Œå¦åˆ™ä¸ä¼šå¼€å¯åˆ†è¯</strong></p><h3 id="match-all"><a href="#match-all" class="headerlink" title="match_all"></a>match_all</h3><p>è¡¨ç¤ºå–å‡ºæ‰€æœ‰ documentsï¼Œåœ¨ä¸ filter ç»“åˆä½¿ç”¨æ—¶ï¼Œä¼šç»å¸¸ç”¨åˆ° match_all</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼ˆæŸ¥è¯¢æ‰€æœ‰çš„ç´¢å¼•å¯¹åº”çš„æ‰€æœ‰æ–‡æ¡£ï¼‰GET _search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># æŸ¥æŒ‡å®šç´¢å¼•ä¸‹æ‰€æœ‰çš„æ•°æ®GET /rcp_goods_img_*/_doc/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><p>ä¸€èˆ¬åœ¨å…¨æ–‡æ£€ç´¢æ—¶ä½¿ç”¨ï¼Œé¦–å…ˆåˆ©ç”¨ analyzerï¼ˆåˆ†è¯å™¨ï¼‰å¯¹å…·ä½“æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œåˆ†æï¼Œç„¶åè¿›è¡ŒæŸ¥è¯¢ã€‚ä½†æ˜¯åœ¨æŸ¥è¯¢ï¼Œæ¯”å¦‚è¯´æ•°å€¼å‹å­—æ®µã€æ—¥æœŸå‹å­—æ®µã€å¸ƒå°”å­—æ®µæˆ–è€…ä¸éœ€è¦åˆ†è¯çš„å­—ç¬¦ä¸²ä¸Šè¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œè¡¨ç¤ºç²¾ç¡®åŒ¹é…</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># ç¤ºä¾‹# select goods_id<span class="token punctuation">,</span> app_name from rcp_goods_img_checks._doc where goods_id = m43337929006 order by app_name descGET /rcp_goods_img_checks/_doc/_search<span class="token punctuation">{</span>  <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"goods_id"</span><span class="token punctuation">,</span>    <span class="token string">"app_name"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"goods_id"</span><span class="token operator">:</span> <span class="token string">"m43337929006"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      <span class="token property">"app_name"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"order"</span><span class="token operator">:</span> <span class="token string">"desc"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="multi-match"><a href="#multi-match" class="headerlink" title="multi_match"></a>multi_match</h3><p>åŒæ—¶å¯¹æŸ¥è¯¢çš„å…³é”®è¯è¿›è¡Œå¤šå­—æ®µåŒæ—¶åŒ¹é…ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªå­—æ®µåŒ¹é…åˆ°å€¼å°±è¿”å›ç»“æœ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># ç¤ºä¾‹# åªè¦æŸ¥è¯¢çš„å­—æ®µ check_status ã€app_name ã€site_id è¿™ä¸‰ä¸ªå­—æ®µä¸­ä»»æ„ä¸€ä¸ªå­—æ®µä¸º <span class="token number">19</span> é‚£ä¹ˆå°±è¿”å›ç»“æœ# select * from rcp_goods_img_checks._doc where check_status = <span class="token number">19</span> or app_name = <span class="token number">19</span> or site_id = <span class="token number">19</span>GET /rcp_goods_img_checks/_doc/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"multi_match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>      <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"check_status"</span><span class="token punctuation">,</span> <span class="token string">"app_name"</span><span class="token punctuation">,</span> <span class="token string">"site_id"</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="match-phrase-prefix"><a href="#match-phrase-prefix" class="headerlink" title="match_phrase_prefix"></a>match_phrase_prefix</h3><p>å·¦å‰ç¼€åŒ¹é…ï¼Œç±»ä¼¼ sql ä¸­çš„ like <code>field%</code></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># ç¤ºä¾‹# select * from rcp_goods_img_checks._doc where goods_id like 'm%'GET /rcp_goods_img_checks/_doc/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"match_phrase_prefix"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"goods_id"</span><span class="token operator">:</span> <span class="token string">"m"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="term"><a href="#term" class="headerlink" title="term"></a>term</h3><p>term ç”¨äºç²¾ç¡®æŸ¥æ‰¾ï¼Œå¯ç”¨äºæ•°å€¼ã€æ—¥æœŸã€å¸ƒå°”å€¼æˆ–è€…ä¸éœ€è¦åˆ†è¯çš„å­—ç¬¦ä¸²ï¼Œå½“ä½¿ç”¨ term æ—¶ï¼Œä¸ä¼šå¯¹æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œåˆ†æï¼Œè¿›è¡Œçš„æ˜¯ç²¾ç¡®æŸ¥æ‰¾</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># ç¤ºä¾‹# å­—æ®µåªæœ‰ä¸€ä¸ªå€¼æ—¶ï¼Œç²¾ç¡®æŸ¥è¯¢# select * from rcp_goods_img_checks._doc where site_id = <span class="token number">18</span>GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"site_id"</span><span class="token operator">:</span> <span class="token string">"18"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># å› ä¸ºæ˜¯ç²¾ç¡®æŸ¥è¯¢ï¼Œå› æ­¤ä¸éœ€è¦æŸ¥è¯¢è¿›è¡Œè¯„åˆ†è®¡ç®—# ä½¿ç”¨ constant_score æŸ¥è¯¢ä»¥éè¯„åˆ†æ¨¡å¼æ¥æ‰§è¡Œ term æŸ¥è¯¢ï¼Œå¹¶ä½œä¸ºç»Ÿä¸€è¯„åˆ†GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"constant_score"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>          <span class="token property">"site_id"</span><span class="token operator">:</span> <span class="token string">"18"</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="terms"><a href="#terms" class="headerlink" title="terms"></a>terms</h3><p>terms å’Œ term ç±»ä¼¼ï¼Œterms å¯ä»¥æŒ‡å®šå¤šä¸ªå€¼ï¼Œåªè¦ doc æ»¡è¶³ terms é‡Œçš„ä»»æ„å€¼ï¼Œå°±æ˜¯æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„ï¼Œå±äºç²¾ç¡®æŸ¥æ‰¾</p><p><strong>terms è¡¨ç¤ºçš„æ˜¯ contains å…³ç³»ï¼Œè€Œä¸æ˜¯ equals å…³ç³»</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># ç¤ºä¾‹# å­—æ®µæœ‰å¤šä¸ªå€¼æ—¶# select * from rcp_goods_img_checks._doc where site_id in (<span class="token string">"18"</span><span class="token punctuation">,</span> <span class="token string">"20"</span>)GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"site_id"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"18"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span># ä½¿ç”¨ constant_score æŸ¥è¯¢ä»¥éè¯„åˆ†æ¨¡å¼æ¥æ‰§è¡Œ terms æŸ¥è¯¢ï¼Œå¹¶ä½œä¸ºç»Ÿä¸€è¯„åˆ†GET /rcp_goods_img_checks/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"constant_score"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>          <span class="token property">"site_id"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"18"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="range"><a href="#range" class="headerlink" title="range"></a>range</h3><p>èŒƒå›´æŸ¥æ‰¾</p><p>æ“ä½œç¬¦å¯ä»¥æ˜¯ï¼š</p><ul><li><strong>gt</strong>ï¼šå¤§äº</li><li><strong>gte</strong>ï¼šå¤§äºç­‰äº</li><li><strong>lt</strong>ï¼šå°äº</li><li><strong>lte</strong>ï¼šå°äºç­‰äº</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"># select * from rcp_goods_img_checks._doc where site_id &gt;= <span class="token number">19</span> and site_id &lt; <span class="token number">30</span>GET /rcp_goods_img_checks/_doc/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"site_id"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"gte"</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>        <span class="token property">"lt"</span><span class="token operator">:</span> <span class="token number">30</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="exists-å’Œ-missing"><a href="#exists-å’Œ-missing" class="headerlink" title="exists å’Œ missing"></a>exists å’Œ missing</h3><p>exists ç”¨äºæŸ¥æ‰¾æŸä¸ªå­—æ®µå«æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå€¼å¯¹åº”çš„ documentï¼Œè€Œ missing ç”¨äºæŸ¥æ‰¾æŸä¸ªå­—æ®µä¸å­˜åœ¨å€¼å¯¹åº”çš„ documentï¼Œç±»æ¯”å…³ç³»æ•°æ®åº“ä¸­çš„ <strong>is not null ç­‰åŒäº exists</strong> å’Œ <strong>is null ç­‰åŒäº missing</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"># select * from rcp_goods_img_checks._doc where title is not <span class="token null keyword">null</span><span class="token punctuation">{</span>    <span class="token property">"exists"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"title"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span># select * from rcp_goods_img_checks._doc where title is <span class="token null keyword">null</span><span class="token punctuation">{</span>    <span class="token property">"missing"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"title"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="bool"><a href="#bool" class="headerlink" title="bool"></a>bool</h3><p>ä½¿ç”¨ bool å­å¥æ¥å°†å„ç§å­æŸ¥è¯¢å…³è”èµ·æ¥ï¼Œç»„å»ºå¸ƒå°”è¡¨è¾¾å¼ï¼Œå®ç°å¤åˆæŸ¥è¯¢ï¼Œbool å­å¥å¯ä»¥éšæ„ç»„åˆã€åµŒå¥—ã€‚</p><p>bool å­å¥ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>mustï¼šè¡¨ç¤ºå¿…é¡»åŒ¹é…ï¼Œä¸ and ç­‰ä»·ï¼ˆè´¡çŒ®ç®—åˆ†ï¼‰</li><li>must_notï¼šè¡¨ç¤ºä¸€å®šä¸èƒ½åŒ¹é…ï¼Œä¸ not ç­‰ä»·ï¼ˆä¸è´¡çŒ®ç®—åˆ†ï¼‰</li><li>shouldï¼šè¡¨ç¤ºå¯ä»¥åŒ¹é…ï¼Œç±»ä¼¼äºå¸ƒå°”è¿ç®—é‡Œé¢çš„<strong>é€»è¾‘æˆ–</strong> ä¸ or ç­‰ä»·ï¼ˆè´¡çŒ®ç®—åˆ†ï¼‰</li><li>filterï¼šè¿‡æ»¤å­å¥ï¼Œå¿…é¡»åŒ¹é…ï¼ˆä¸è´¡çŒ®ç®—åˆ†ï¼‰</li></ul><p>å¦‚æœ bool å­å¥é‡Œï¼Œæ²¡æœ‰ must å­å¥ï¼Œé‚£ä¹ˆï¼Œshould å­å¥é‡Œè‡³å°‘åŒ¹é…ä¸€ä¸ªï¼Œå¦‚æœæœ‰ must å­å¥ï¼Œé‚£ä¹ˆï¼Œshould å­å¥è‡³å°‘åŒ¹é… 0 ä¸ªã€‚å¯ä»¥ä½¿ç”¨ <code>minimum_should_match</code> æ¥å¯¹æœ€å°åŒ¹é…æ•°è¿›è¡Œè®¾ç½®ã€‚</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"bool"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"must"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"term"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"kimchy"</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"must_not"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"range"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"from"</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token property">"to"</span> <span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"should"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                <span class="token property">"term"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"tag"</span> <span class="token operator">:</span> <span class="token string">"v1"</span> <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>                <span class="token property">"term"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"tag"</span> <span class="token operator">:</span> <span class="token string">"v1.0.2"</span> <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"minimum_should_match"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"boost"</span> <span class="token operator">:</span> <span class="token number">1.0</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span># select * from rcp_goods_img_checks._doc where app_name = <span class="token number">2</span> and site_id = <span class="token number">18</span> and updated_at between <span class="token number">0</span> and <span class="token number">1659695794</span> order by updated_at desc limit <span class="token number">100</span>GET /rcp_goods_img_checks/_doc/_search<span class="token punctuation">{</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"app_name"</span><span class="token operator">:</span> <span class="token number">2</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"site_id"</span><span class="token operator">:</span> <span class="token number">18</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token property">"from"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>              <span class="token property">"to"</span><span class="token operator">:</span> <span class="token number">1659695794</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>  <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"desc"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ pyenv ç®¡ç†å¤šä¸ªç‰ˆæœ¬ Python</title>
      <link href="posts/9fc3a49a.html"/>
      <url>posts/9fc3a49a.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/pyenv/pyenv">pyenv</a> æ˜¯ Python çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œåˆ©ç”¨å®ƒå¯ä»¥åœ¨åŒä¸€å°ç”µè„‘ä¸Šå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„ Pythonã€‚</p><h2 id="å®‰è£…æ–¹å¼"><a href="#å®‰è£…æ–¹å¼" class="headerlink" title="å®‰è£…æ–¹å¼"></a>å®‰è£…æ–¹å¼</h2><p>æ–¹å¼ä¸€ï¼šMacOS ä¸‹å¯ä»¥ç›´æ¥é€šè¿‡ Homebrew æ¥å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew update<span class="token comment"># å®‰è£… pyenv</span>brew <span class="token function">install</span> pyenv<span class="token comment"># å¦‚æœæ˜¯å‡çº§æ—¶</span>brew upgrade pyenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–¹å¼äºŒï¼šé€šè¿‡è‡ªåŠ¨ç¨‹åºæ¥å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> https://pyenv.run <span class="token operator">|</span> <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹å¼ä¸‰ï¼šé€šè¿‡æºç çš„æ–¹å¼æ¥å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/pyenv/pyenv.git ~/.pyenv<span class="token comment"># å¯é€‰çš„ï¼šå¯ä»¥å°è¯•ç¼–è¯‘ä¸€ä¸ªåŠ¨æ€çš„ bash æ‰©å±•æ¥åŠ é€Ÿ Pyenv ï¼Œå¦‚æœå¤±è´¥äº†ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼ŒPyenv ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œ</span><span class="token builtin class-name">cd</span> <span class="token variable"><span class="token variable">$(</span>pyenv root<span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> src/configure <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token parameter variable">-C</span> src<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯é€šè¿‡æºç æ¥å®‰è£…çš„è¯ï¼Œéœ€è¦å‡çº§ pyenv æ—¶ï¼Œå¯é€šè¿‡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable"><span class="token variable">$(</span>pyenv root<span class="token variable">)</span></span><span class="token function">git</span> fetch<span class="token function">git</span> tag<span class="token function">git</span> checkout <span class="token punctuation">{</span>tag_name<span class="token punctuation">}</span><span class="token comment"># egï¼šgit checkout v0.1.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h2><p>å¦‚æœä½ æ˜¯ç”¨çš„ <code>Bash</code> åˆ™éœ€è¦ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'export PYENV_ROOT="$HOME/.pyenv"'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc<span class="token builtin class-name">echo</span> <span class="token string">'command -v pyenv &gt;/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc<span class="token builtin class-name">echo</span> <span class="token string">'eval "$(pyenv init -)"'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½ æ˜¯ç”¨çš„ <code>Zsh</code> åˆ™éœ€è¦ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'export PYENV_ROOT="$HOME/.pyenv"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">echo</span> <span class="token string">'[[ -d $PYENV_ROOT/bin ]] &amp;&amp; export PATH="$PYENV_ROOT/bin:$PATH"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">echo</span> <span class="token string">'eval "$(pyenv init -)"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="pyenv-ä½¿ç”¨"><a href="#pyenv-ä½¿ç”¨" class="headerlink" title="pyenv ä½¿ç”¨"></a>pyenv ä½¿ç”¨</h2><p>æ£€æŸ¥ pyenv æ˜¯å¦å®‰è£…æˆåŠŸ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹ pyenv æŒ‡ä»¤åˆ—è¡¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv commands<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æ‰€æœ‰å¯é€‰çš„ python ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv <span class="token function">install</span> <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹å·²ç»å®‰è£…çš„æ‰€æœ‰ python ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç‰ˆæœ¬å·å‰é¢å¸¦æœ‰ * å·çš„ï¼Œåˆ™è¯æ˜å½“å‰ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªç‰ˆæœ¬</span>pyenv versions<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ˜¾ç¤ºå½“å‰çš„ Python ç‰ˆæœ¬åŠå…¶æœ¬åœ°è·¯å¾„</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„ Python</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯”å¦‚è¿™é‡Œä¸‹è½½ python 3.9.6</span>pyenv <span class="token function">install</span> <span class="token number">3.9</span>.6<span class="token comment"># å®‰è£…å®Œæ¯•ä¹‹åè®°å¾—åˆ·æ–° pyenv shims</span>pyenv rehash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœå®‰è£… python æ¯”è¾ƒæ…¢æ—¶çš„è§£å†³æ–¹æ¡ˆï¼š</p><p>é¦–å…ˆåœ¨ pyenv çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª cache æ–‡ä»¶å¤¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">$(</span>pyenv root<span class="token variable">)</span></span>/cache/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åæˆ‘ä»¬å…ˆæ‰§è¡Œä¸€ä¸‹å®‰è£…å‘½ä»¤ï¼Œæ¯”å¦‚ <code>pyenv install 3.9.6</code> å®ƒä¼šæ˜¾ç¤ºå‡ºä¸‹è½½é“¾æ¥ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥å¤åˆ¶ä¸‹è½½é“¾æ¥åœ°å€ï¼Œé€šè¿‡æµè§ˆå™¨ä¸‹è½½ï¼Œç„¶åå°†ä¸‹è½½åçš„ <code>Python-3.9.6.tar.xz</code> æ–‡ä»¶æ”¾åˆ° <code>$(pyenv root)/cache/</code> æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åå†æ¬¡æ‰§è¡Œ <code>pyenv install 3.9.6</code> å‘½ä»¤å³å¯ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨ cache æ–‡ä»¶å¤¹ä¸­çš„å®‰è£…åŒ…ã€‚</p><p><strong>ä¸‹è½½åçš„ Python ç›´æ¥åœ¨ <code>$(pyenv root)/versions/</code> ç›®å½•ä¸‹ã€‚</strong></p><p>å¸è½½æŒ‡å®šç‰ˆæœ¬çš„ Python</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯”å¦‚è¿™é‡Œå¸è½½ python 3.9.6</span>pyenv uninstall <span class="token number">3.9</span>.6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ‡æ¢ Python ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…¨å±€åˆ‡æ¢ï¼ˆç³»ç»Ÿå…¨å±€ç”¨ç³»ç»Ÿé»˜è®¤çš„ Python æ¯”è¾ƒå¥½ï¼Œä¸å»ºè®®ç›´æ¥å¯¹å…¶æ“ä½œï¼‰</span>pyenv global <span class="token number">3.9</span>.6<span class="token comment"># é€šè¿‡æŸ¥çœ‹ Python ç‰ˆæœ¬æ¥ç¡®å®šæ˜¯å¦åˆ‡æ¢æˆåŠŸ</span>python <span class="token parameter variable">-V</span><span class="token comment"># åˆ‡æ¢å›ç³»ç»Ÿç‰ˆæœ¬</span>pyenv global system<span class="token comment"># ç”¨ local è¿›è¡ŒæŒ‡å®šç‰ˆæœ¬åˆ‡æ¢ï¼Œä¸€èˆ¬å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼ˆåªå½±å“å½“å‰æ‰€åœ¨æ–‡ä»¶å¤¹ï¼‰</span>pyenv <span class="token builtin class-name">local</span> <span class="token number">3.9</span>.6<span class="token comment"># è§£é™¤ local è®¾ç½®</span>pyenv <span class="token builtin class-name">local</span> <span class="token parameter variable">--unset</span><span class="token comment"># å½“å‰ shell ä¼šè¯åˆ‡æ¢ï¼Œé€€å‡º shell ä¼šè¯åå¤±æ•ˆ</span>pyenv shell <span class="token number">3.9</span>.6<span class="token comment"># è§£é™¤ shell è®¾ç½®</span>pyenv shell <span class="token parameter variable">--unset</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¸è½½-pyenv"><a href="#å¸è½½-pyenv" class="headerlink" title="å¸è½½ pyenv"></a>å¸è½½ pyenv</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœæ˜¯ä½¿ç”¨ homebrew ä¸‹è½½çš„ pyenv æ—¶ï¼Œå¸è½½ä¸º</span>brew uninstall pyenv<span class="token comment"># å¦‚æœæ˜¯ä½¿ç”¨ git æ‹‰å–æºç å®‰è£…çš„ pyenv æ—¶ï¼Œå¸è½½ä¸º</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token variable"><span class="token variable">$(</span>pyenv root<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»“åˆ-pyenv-ä¸ºæ¯ä¸ªé¡¹ç›®å»ºç«‹è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒ"><a href="#ç»“åˆ-pyenv-ä¸ºæ¯ä¸ªé¡¹ç›®å»ºç«‹è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="ç»“åˆ pyenv ä¸ºæ¯ä¸ªé¡¹ç›®å»ºç«‹è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒ"></a>ç»“åˆ pyenv ä¸ºæ¯ä¸ªé¡¹ç›®å»ºç«‹è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒ</h2><h3 id="å¦‚æœç”¨çš„æ˜¯-pipenv-æ—¶"><a href="#å¦‚æœç”¨çš„æ˜¯-pipenv-æ—¶" class="headerlink" title="å¦‚æœç”¨çš„æ˜¯ pipenv æ—¶"></a>å¦‚æœç”¨çš„æ˜¯ pipenv æ—¶</h3><p>Pipenv æ˜¯ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒç»¼åˆäº† virtualenvï¼Œpip å’Œ pyenv ä¸‰è€…çš„åŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨ pipenv è¿™ä¸ªå·¥å…·æ¥å®‰è£…ã€å¸è½½ã€è·Ÿè¸ªå’Œè®°å½•ä¾èµ–æ€§ï¼Œå¹¶åˆ›å»ºã€ä½¿ç”¨å’Œç»„ç»‡ä½ çš„è™šæ‹Ÿç¯å¢ƒã€‚</p><p>ä½¿ç”¨ Homebrew å®‰è£… pipenv</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… pipenv</span>brew update <span class="token operator">&amp;&amp;</span> brew <span class="token function">install</span> pipenv<span class="token comment"># æ›´æ–° pipenv</span>brew update <span class="token operator">&amp;&amp;</span> brew upgrade pipenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ pip æ¥å®‰è£…å’Œå‡çº§ pipenv</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… pipenv</span>pip <span class="token function">install</span> pipenv<span class="token comment"># æ›´æ–° pipenv</span>pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pipenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ pipenv å»ºç«‹è™šæ‹Ÿç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰ä½ æƒ³è¦çš„ Python ç‰ˆæœ¬ {python_version} æ—¶ï¼Œpipenv ä¼šè°ƒç”¨ pyenv æ¥å®‰è£…å¯¹åº”çš„ Python ç‰ˆæœ¬</span><span class="token builtin class-name">cd</span> <span class="token punctuation">{</span>your_project_dir<span class="token punctuation">}</span> <span class="token operator">&amp;&amp;</span> pipenv <span class="token parameter variable">--python</span> <span class="token punctuation">{</span>python_version<span class="token punctuation">}</span><span class="token comment"># egï¼špipenv --python 3.9.6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>pipenv --venv</code> æ¥æŸ¥çœ‹é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒç›®å½•ï¼Œå¯ä»¥é€šè¿‡ <code>pipenv --rm</code> æ¥åˆ é™¤è™šæ‹Ÿç¯å¢ƒã€‚</p><h3 id="å¦‚æœç”¨çš„æ˜¯-virtualenv-æ—¶"><a href="#å¦‚æœç”¨çš„æ˜¯-virtualenv-æ—¶" class="headerlink" title="å¦‚æœç”¨çš„æ˜¯ virtualenv æ—¶"></a>å¦‚æœç”¨çš„æ˜¯ <a href="https://github.com/pypa/virtualenv">virtualenv</a> æ—¶</h3><p>å¦‚æœæˆ‘ä»¬å®‰è£…äº† pyenv æ—¶ï¼Œå…¶å®å·²ç»è‡ªåŠ¨ä»¥ plugin çš„å½¢å¼å®‰è£…å¥½äº† virtualenv æˆ‘ä»¬åªéœ€ç›´æ¥ä½¿ç”¨å°±å¥½äº†ã€‚</p><p>å¦‚æœæ²¡æœ‰å®‰è£… virtualenv æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ pip è¿›è¡Œå®‰è£…</span>pip <span class="token function">install</span> virtualenv<span class="token comment"># æˆ–è€…ä½¿ç”¨ homebrew å®‰è£…</span>brew <span class="token function">install</span> pyenv-virtualenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ virtualenv å»ºç«‹è™šæ‹Ÿç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv virtualenv <span class="token punctuation">{</span>python_version<span class="token punctuation">}</span> <span class="token punctuation">{</span>virtual_env_name<span class="token punctuation">}</span><span class="token comment"># egï¼špyenv virtualenv 3.9.6 envdemo396</span><span class="token comment"># æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒç›®å½•</span><span class="token function">ls</span> <span class="token parameter variable">-al</span> <span class="token variable"><span class="token variable">$(</span>pyenv root<span class="token variable">)</span></span>/versions<span class="token comment"># ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ pyenv å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹</span>pyenv versions<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å½“å‰æœ‰å“ªäº›è™šæ‹Ÿç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv virtualenvs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¿€æ´»æ–°åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»¥ envdemo396 è™šæ‹Ÿç¯å¢ƒä¸ºä¾‹</span>pyenv activate envdemo396<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰‹åŠ¨é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv deactivate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»¥ envdemo396 è™šæ‹Ÿç¯å¢ƒä¸ºä¾‹</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token variable"><span class="token variable">$(</span>pyenv root<span class="token variable">)</span></span>/versions/envdemo396<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git bug åˆ†æ”¯</title>
      <link href="posts/56cac605.html"/>
      <url>posts/56cac605.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-bug-åˆ†æ”¯"><a href="#Git-bug-åˆ†æ”¯" class="headerlink" title="Git bug åˆ†æ”¯"></a>Git bug åˆ†æ”¯</h1><blockquote><p>ä¿®å¤ bug æ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡åˆ›å»ºæ–°çš„ bug åˆ†æ”¯è¿›è¡Œä¿®å¤ï¼Œç„¶ååˆå¹¶ï¼Œæœ€ååˆ é™¤ï¼›<br>å½“æ‰‹å¤´å·¥ä½œæ²¡æœ‰å®Œæˆæ—¶ï¼Œå…ˆæŠŠå·¥ä½œç°åœº git stash ä¸€ä¸‹ï¼Œç„¶åå»ä¿®å¤ bugï¼Œä¿®å¤åï¼Œå† git stash popï¼Œå›åˆ°å·¥ä½œç°åœºï¼›<br>åœ¨ master åˆ†æ”¯ä¸Šä¿®å¤çš„ bugï¼Œæƒ³è¦åˆå¹¶åˆ°å½“å‰ dev åˆ†æ”¯ï¼Œå¯ä»¥ç”¨ git cherry-pick <commit id=""> å‘½ä»¤ï¼ŒæŠŠ bug æäº¤çš„ä¿®æ”¹â€œå¤åˆ¶â€åˆ°å½“å‰åˆ†æ”¯ï¼Œé¿å…é‡å¤åŠ³åŠ¨ã€‚</commit></p></blockquote><p>åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š<br>å½“ä½ éœ€è¦ä¿®æ”¹ä¸€ä¸ª bugï¼Œä½†æ˜¯ä½ å½“å‰çš„å¼€å‘åŠŸèƒ½è¿˜ä¸æƒ³æäº¤åˆ°è¿œç¨‹ç‰ˆæœ¬åº“ä¸­ï¼Œåˆå¿…é¡»è¦å…ˆå°† bug æäº¤ã€‚</p><ol><li>æŸ¥çœ‹å½“å‰å·¥ä½œåŒºçš„çŠ¶æ€ï¼ˆå‡è®¾å½“å‰åœ¨ <code>dev</code> åˆ†æ”¯ï¼‰</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># å·¥ä½œåŒºçš„æ–‡ä»¶è¿˜æ²¡æœ‰æäº¤</span>git status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å­˜å‚¨å½“å‰çš„å·¥ä½œç°åœº</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git">git stash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>å†æ¬¡æŸ¥çœ‹å·¥ä½œåŒºçš„çŠ¶æ€ï¼Œåº”è¯¥æ˜¯å¹²å‡€çš„</li><li>å¦‚æœéœ€è¦åœ¨ <code>master</code> åˆ†æ”¯ä¸Šä¿®å¤ bugï¼Œé‚£ä¹ˆå°±éœ€è¦ä» <code>master</code> åˆ†æ”¯ä¸Šåˆ›å»ºä¸´æ—¶åˆ†æ”¯</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># åˆ‡æ¢åˆ° master åˆ†æ”¯</span>git checkout master<span class="token comment"># åˆ›å»ºä¿®å¤ bug çš„åˆ†æ”¯ä¸º issue-1</span>git checkout -b issue-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>åœ¨ <code>issue-1</code> åˆ†æ”¯ä¸Šä¿®å¤ bug</li><li>åœ¨ <code>issue-1</code> åˆ†æ”¯ä¸Šæäº¤ä»£ç </li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git">git add -A &amp;&amp; git commit -m <span class="token string">'fixed bug 1'</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li>åˆ‡æ¢åˆ° <code>master</code> åˆ†æ”¯</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git">git switch master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="8"><li>ä» <code>master</code> åˆ†æ”¯ä¸Šåˆå¹¶ <code>issue-1</code> åˆ†æ”¯çš„ä»£ç ï¼Œå¹¶æ·»åŠ äº†åˆå¹¶ä¿¡æ¯</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git">git merge --no-ff -m <span class="token string">"merged bug fix 1"</span> issue-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="9"><li>åŸæ¥æ˜¯åœ¨ <code>dev</code> åˆ†æ”¯ä¸Šå¹²æ´»ï¼Œç°åœ¨åˆ‡æ¢åˆ° <code>dev</code> åˆ†æ”¯ä¸Šç»§ç»­å¹²æ´»</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout dev<span class="token comment"># å¦‚æœæ­¤æ—¶ç”¨ git status å‘½ä»¤æŸ¥çœ‹çš„è¯ï¼Œæ­¤æ—¶çš„å·¥ä½œåŒºæ˜¯å¹²å‡€çš„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="10"><li>æŸ¥çœ‹ä¹‹å‰ä¸´æ—¶å­˜å‚¨çš„å·¥ä½œç°åœº</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git">git stash list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="11"><li>æ¢å¤å·¥ä½œç°åœºï¼ˆæœ‰ä¸¤ç§æ–¹æ³•ï¼‰</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># ç¬¬ä¸€ç§æ–¹æ³•ï¼š</span><span class="token comment"># æ¢å¤å·¥ä½œç°åœº</span>git stash apply<span class="token comment"># åˆ é™¤ä¹‹å‰ä¸´æ—¶å­˜å‚¨çš„å·¥ä½œç°åœº</span>git stash drop<span class="token comment"># ç¬¬äºŒç§æ–¹æ³•ï¼š</span><span class="token comment"># æ¢å¤çš„åŒæ—¶æŠŠ stash å†…å®¹ä¹Ÿåˆ äº†</span>git stash pop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="12"><li>å¦‚æœéœ€è¦æ¢å¤æŒ‡å®šçš„å·¥ä½œç°åœº</li></ol><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æŸ¥çœ‹æ‰€æœ‰çš„å·¥ä½œç°åœº</span>git stash list<span class="token comment"># æ¢å¤åç§°ä¸º ã€Œstash@{0}ã€ çš„å·¥ä½œç°åœº</span>git stash apply stash@{0}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="13"><li>å°†ä¿®å¤å¥½çš„ bug åŒæ­¥åˆ°å…¶ä»–çš„åˆ†æ”¯</li></ol><blockquote><p>å¯ä»¥é€šè¿‡ç›´æ¥å°†ä¿®å¤ bug çš„æ–‡ä»¶ä¿®æ”¹å†…å®¹å¤åˆ¶åˆ°å…¶ä»–åˆ†æ”¯ï¼Œæ¯”å¦‚åœ¨ <code>issue-1</code> åˆ†æ”¯ä¸Šä¿®å¤çš„æäº¤ç‰ˆæœ¬å·ä¸º <code>c55ae16d5b1a</code>ï¼Œç°åœ¨åªéœ€è¦å°†è¿™ä¸ªç‰ˆæœ¬å·çš„æ‰€æœ‰ä¿®æ”¹å†…å®¹å¤åˆ¶åˆ° dev åˆ†æ”¯ä¸Šå³å¯ã€‚</p></blockquote><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># å½“å‰åˆ†æ”¯ä¸º dev</span>git checkout dev<span class="token comment"># å¤åˆ¶ä¸€ä¸ªç‰¹å®šçš„æäº¤åˆ°å½“å‰åˆ†æ”¯ï¼ˆæ­¤æ“ä½œä¼šè‡ªåŠ¨æäº¤ä¸€ä¸ªç‰ˆæœ¬å·ï¼‰</span>git cherry-pick c55ae16d5b1a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»º GitLab Git æœåŠ¡å™¨</title>
      <link href="posts/34b62620.html"/>
      <url>posts/34b62620.html</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://about.gitlab.com/install/?version=ce#centos-7">å®˜æ–¹å®‰è£…æ–‡æ¡£</a></p></blockquote><p>GitLabæ˜¯Rubyå¼€å‘çš„è‡ªæ‰˜ç®¡çš„Gité¡¹ç›®ä»“åº“ï¼Œå¯é€šè¿‡Webç•Œé¢è®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººçš„é¡¹ç›®ã€‚</p><blockquote><p>ç‰ˆæœ¬ï¼šGitLab åˆ†ä¸ºç¤¾åŒºç‰ˆï¼ˆCEï¼‰å’Œä¼ä¸šç‰ˆï¼ˆEEï¼‰<br>æ­¤æ¬¡å®‰è£…çš„ gitlab ç‰ˆæœ¬ä¸ºï¼š14.10.0</p></blockquote><h2 id="Ubuntu-ç³»ç»Ÿä¸‹"><a href="#Ubuntu-ç³»ç»Ÿä¸‹" class="headerlink" title="Ubuntu ç³»ç»Ÿä¸‹"></a>Ubuntu ç³»ç»Ÿä¸‹</h2><ul><li>æ›´æ–°è½¯ä»¶æº</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¨èä½¿ç”¨ apt å·¥å…·ï¼Œå…¶å®ä½¿ç”¨ apt-get ä¹Ÿè¡Œ</span><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> upgrade<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å®‰è£…ä¾èµ–åŒ…ï¼Œå¦‚æœç³»ç»Ÿå·²ç»å®‰è£…ï¼Œå°±ä¸éœ€è¦å†æ¬¡å®‰è£…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">curl</span> openssh-server ca-certificates tzdata perl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ·»åŠ  gitlab è½¯ä»¶åŒ…ä»“åº“</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™é‡Œæ·»åŠ çš„æ˜¯ä¼ä¸šç‰ˆï¼ˆEEï¼‰åœ°å€</span><span class="token function">curl</span> https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… Postfix æ¥å‘é€é€šçŸ¥é‚®ä»¶</li></ul><pre class="line-numbers language-none"><code class="language-none">apt install -y postfix<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å®‰è£… gitlab ä¼ä¸šç‰ˆï¼ˆEEï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…ä¼ä¸šç‰ˆ gitlab</span><span class="token function">apt</span> <span class="token function">install</span> gitlab-ee<span class="token comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬</span><span class="token function">sudo</span> <span class="token function">apt-cache</span> madison gitlab-ee<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®å¾ˆç®€å•ï¼Œä¸€çœ‹å°±æ‡‚ï¼Œå°±ä¸åšä»‹ç»</span><span class="token function">vim</span> /etc/gitlab/gitlab.rb<span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ï¼šéœ€è¦å°† `external_url` åé¢çš„å€¼ä¿®æ”¹æˆä½ è‡ªå·±è®¿é—® gitlab çš„åœ°å€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é‡æ–°ç¼–è¯‘é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitlab-ctl reconfigure<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>é‡å¯ gitlab</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitlab-ctl restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹é»˜è®¤çš„ root å¯†ç </li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/gitlab/initial_root_password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="CentOS-7-ç³»ç»Ÿä¸‹"><a href="#CentOS-7-ç³»ç»Ÿä¸‹" class="headerlink" title="CentOS 7 ç³»ç»Ÿä¸‹"></a>CentOS 7 ç³»ç»Ÿä¸‹</h2><ul><li>å®‰è£…ä¾èµ–åŒ…ï¼Œå¦‚æœç³»ç»Ÿå·²ç»å®‰è£…ï¼Œå°±ä¸éœ€è¦å†æ¬¡å®‰è£…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… curl å’Œ ssh ç¨‹åºï¼Œï¼ˆä¸€èˆ¬ç³»ç»Ÿéƒ½ä¼šè‡ªå¸¦ï¼Œå› æ­¤å¯ä»¥å¿½ç•¥ï¼‰</span><span class="token comment"># policycoreutils-python ä¾èµ–åŒ…ä¸å½±å“éƒ¨ç½² gitlab å› æ­¤ä¹Ÿå¯ä»¥ä¸å®‰è£…</span><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">curl</span> policycoreutils-python openssh-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é…ç½® ssh æœåŠ¡</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨ ssh æœåŠ¡</span><span class="token function">sudo</span> systemctl start sshd<span class="token comment"># è®¾ç½® ssh æœåŠ¡ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨</span><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> sshd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é…ç½® Postfix æ¥å‘é€é€šçŸ¥é‚®ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… Postfix</span><span class="token function">sudo</span> yum <span class="token function">install</span> postfix<span class="token comment"># è®¾ç½® Postfix æœåŠ¡ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨</span><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> postfix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯åŠ¨ Postfix æœåŠ¡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰“å¼€ Postfix çš„é…ç½®æ–‡ä»¶</span><span class="token function">vim</span> /etc/postfix/main.cf<span class="token comment"># ä¿®æ”¹ `inet_interfaces = localhost` ä¸º `inet_interfaces = all`</span><span class="token comment"># å¯åŠ¨ Postfix æœåŠ¡</span><span class="token function">sudo</span> systemctl start postfix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ·»åŠ  gitlab è½¯ä»¶åŒ…ä»“åº“</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿™é‡Œæ·»åŠ çš„æ˜¯ç¤¾åŒºç‰ˆï¼ˆCEï¼‰åœ°å€</span><span class="token function">curl</span> https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… gitlab ç¤¾åŒºç‰ˆï¼ˆCEï¼‰</li></ul><pre class="line-numbers language-none"><code class="language-none">sudo EXTERNAL_URL="ä½ çš„ GitLab æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€æˆ–è€…åŸŸå" yum install -y gitlab-ce# æ¯”å¦‚ï¼šsudo EXTERNAL_URL="http://127.0.0.1:8099" yum install -y gitlab-ce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨æµè§ˆå™¨è®¿é—® <code>ä½ çš„ GitLab æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€æˆ–è€…åŸŸå</code> ï¼Œè´¦å·ä¸º <code>root</code> å¯†ç é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹åˆå§‹å¯†ç </li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/gitlab/initial_root_password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å¦‚æœä¸æƒ³åšè¿‡å¤šçš„é…ç½®æ—¶ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥éª¤å³å¯ï¼š"><a href="#å¦‚æœä¸æƒ³åšè¿‡å¤šçš„é…ç½®æ—¶ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥éª¤å³å¯ï¼š" class="headerlink" title="å¦‚æœä¸æƒ³åšè¿‡å¤šçš„é…ç½®æ—¶ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥éª¤å³å¯ï¼š"></a>å¦‚æœä¸æƒ³åšè¿‡å¤šçš„é…ç½®æ—¶ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥éª¤å³å¯ï¼š</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span><span class="token comment"># é»˜è®¤å®‰è£…çš„æ˜¯æœ€æ–°ç‰ˆ</span><span class="token function">sudo</span> <span class="token assign-left variable">EXTERNAL_URL</span><span class="token operator">=</span><span class="token string">"ä½ çš„ GitLab æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€æˆ–è€…åŸŸå"</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gitlab-ce<span class="token comment"># å¦‚æœéœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„è¯ </span>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gitlab-ce-14.10.1-ce.0.el7.x86_64<span class="token comment"># æˆ–è€…</span>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gitlab-ce-14.10.1-ce.0.el7<span class="token comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬</span>yum <span class="token parameter variable">--showduplicates</span> list gitlab-ce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‡ºç°ä»¥ä¸‹ç•Œé¢ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fd85b0c1dd3a1e17.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…æˆåŠŸç•Œé¢"></p><h3 id="gitlab-å¸¸ç”¨å‘½ä»¤"><a href="#gitlab-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="gitlab å¸¸ç”¨å‘½ä»¤"></a>gitlab å¸¸ç”¨å‘½ä»¤</h3><pre class="line-numbers language-none"><code class="language-none"># å¯åŠ¨æ‰€æœ‰ gitlab ç»„ä»¶gitlab-ctl start# åœæ­¢æ‰€æœ‰ gitlab ç»„ä»¶gitlab-ctl stop# é‡å¯æ‰€æœ‰ gitlab ç»„ä»¶gitlab-ctl restart# æŸ¥çœ‹æœåŠ¡çŠ¶æ€gitlab-ctl status# ä¿®æ”¹ gitlab é…ç½®æ–‡ä»¶vim /etc/gitlab/gitlab.rb# é‡æ–°ç¼–è¯‘ gitlab çš„é…ç½®gitlab-ctl reconfigure # æŸ¥çœ‹ gitlab é…ç½®ä¿¡æ¯gitlab-ctl show-config# æ£€æŸ¥ gitlabgitlab-rake gitlab:check SANITIZE=true --trace# æŸ¥çœ‹æ—¥å¿—gitlab-ctl tailgitlab-ctl tail nginx/gitlab_access.log# æ—¥å¿—åœ°å€ /var/log/gitlab# æœåŠ¡åœ°å€ /var/opt/gitlab# nginx é…ç½®è·¯å¾„ /var/opt/gitlab/nginx/conf/nginx.conf# æŸ¥çœ‹ gitlab çš„ç‰ˆæœ¬cat /opt/gitlab/embedded/service/gitlab-rails/VERSION<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡ç½®è´¦å·å¯†ç "><a href="#é‡ç½®è´¦å·å¯†ç " class="headerlink" title="é‡ç½®è´¦å·å¯†ç "></a>é‡ç½®è´¦å·å¯†ç </h3><blockquote><p><a href="https://docs.gitlab.com/ee/security/reset_user_password.html">å®˜æ–¹æ–‡æ¡£é‡ç½®ç”¨æˆ·å¯†ç </a></p></blockquote><h4 id="ä½¿ç”¨-Rake-ä»»åŠ¡"><a href="#ä½¿ç”¨-Rake-ä»»åŠ¡" class="headerlink" title="ä½¿ç”¨ Rake ä»»åŠ¡"></a>ä½¿ç”¨ Rake ä»»åŠ¡</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitlab-rake <span class="token string">"gitlab:password:reset"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ447rdnsv9nreZ ~<span class="token punctuation">]</span><span class="token comment"># gitlab-rake "gitlab:password:reset"</span>Enter username: rootEnter password: Confirm password: Password successfully updated <span class="token keyword">for</span> user with username root.<span class="token punctuation">[</span>root@iZ447rdnsv9nreZ ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨-Rails-æ§åˆ¶å°"><a href="#ä½¿ç”¨-Rails-æ§åˆ¶å°" class="headerlink" title="ä½¿ç”¨ Rails æ§åˆ¶å°"></a>ä½¿ç”¨ Rails æ§åˆ¶å°</h4><pre class="line-numbers language-none"><code class="language-none"># æ‰“å¼€äº¤äº’æ¨¡å¼gitlab-rails console -e production# å¦‚æœæ˜¯ä½ç‰ˆæœ¬çš„ gitlab å¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤gitlab-rails console production# å®šä½åˆ° gitlab æ•°æ®åº“ä¸­ Users è¡¨ä¸­çš„ä¸€ä¸ªç”¨æˆ·user = User.where(id:1).first# æˆ–è€…é€šè¿‡ç”¨æˆ·åè¿›è¡ŒæŸ¥æ‰¾user = User.find_by_username 'root'# æˆ–è€…é€šè¿‡é‚®ç®±åœ°å€æŸ¥æ‰¾user = User.find_by(email: 'user@example.com')# å¦‚æœç”¨æˆ· idã€ç”¨æˆ·åã€é‚®ç®±åœ°å€éƒ½ä¸è®°å¾—ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·User.all# å¯†ç å¿…é¡»ä¸å°äº 8 ä¸ªå­—ç¬¦ï¼Œå¯†ç åé¢åŠ ä¸åŠ å•å¼•å·éƒ½å¯ä»¥# é‡ç½®ç®¡ç†å‘˜å¯†ç ä¸º 12345678user.password=12345678# ç¡®è®¤ç®¡ç†å‘˜çš„å¯†ç ä¸º 12345678user.password_confirmation=12345678# ä¿å­˜æ›´æ”¹ä¿¡æ¯ï¼Œå¿…é¡»è¦æœ‰åé¢çš„æ„Ÿå¹å·user.save!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ447rdnsv9nreZ gitlab<span class="token punctuation">]</span><span class="token comment"># gitlab-rails console -e production</span>-------------------------------------------------------------------------------- Ruby:         ruby <span class="token number">2.7</span>.5p203 <span class="token punctuation">(</span><span class="token number">2021</span>-11-24 revision f69aeb8314<span class="token punctuation">)</span> <span class="token punctuation">[</span>x86_64-linux<span class="token punctuation">]</span> GitLab:       <span class="token number">14.10</span>.0 <span class="token punctuation">(</span>88da5554d96<span class="token punctuation">)</span> FOSS GitLab Shell: <span class="token number">13.25</span>.1 PostgreSQL:   <span class="token number">12.7</span>-----------------------------------------------------------<span class="token punctuation">[</span> booted <span class="token keyword">in</span> <span class="token number">606</span>.21s <span class="token punctuation">]</span>Loading production environment <span class="token punctuation">(</span>Rails <span class="token number">6.1</span>.4.7<span class="token punctuation">)</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:005:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> user <span class="token operator">=</span> User.where<span class="token punctuation">(</span>id:1<span class="token punctuation">)</span>.first<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">#&lt;User id:1 @root&gt;</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:006:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">user.password</span><span class="token operator">=</span><span class="token number">12345678</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">12345678</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:007:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">user.password_confirmation</span><span class="token operator">=</span><span class="token number">12345678</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">12345678</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:008:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> user.save<span class="token operator">!</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:009:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…è¿™æ ·ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ447rdnsv9nreZ ~<span class="token punctuation">]</span><span class="token comment"># gitlab-rails console -e production</span>-------------------------------------------------------------------------------- Ruby:         ruby <span class="token number">2.7</span>.5p203 <span class="token punctuation">(</span><span class="token number">2021</span>-11-24 revision f69aeb8314<span class="token punctuation">)</span> <span class="token punctuation">[</span>x86_64-linux<span class="token punctuation">]</span> GitLab:       <span class="token number">14.10</span>.0 <span class="token punctuation">(</span>88da5554d96<span class="token punctuation">)</span> FOSS GitLab Shell: <span class="token number">13.25</span>.1 PostgreSQL:   <span class="token number">12.7</span>------------------------------------------------------------<span class="token punctuation">[</span> booted <span class="token keyword">in</span> <span class="token number">41</span>.21s <span class="token punctuation">]</span>Loading production environment <span class="token punctuation">(</span>Rails <span class="token number">6.1</span>.4.7<span class="token punctuation">)</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:001:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> User.all<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">#&lt;ActiveRecord::Relation [#&lt;User id:1 @root&gt;]&gt;</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> user <span class="token operator">=</span> User.find_by_username <span class="token string">'root'</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">#&lt;User id:1 @root&gt;</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:003:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">user.password</span><span class="token operator">=</span><span class="token string">'alex123456'</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"alex123456"</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:004:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">user.password_confirmation</span><span class="token operator">=</span><span class="token string">'alex123456'</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"alex123456"</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:005:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> user.save<span class="token operator">!</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:006:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤‡ä»½ä¸æ¢å¤"><a href="#å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="å¤‡ä»½ä¸æ¢å¤"></a>å¤‡ä»½ä¸æ¢å¤</h3><p>éœ€è¦æ³¨æ„ï¼Œä¸¤å°æœåŠ¡å™¨ä¸Šçš„ gitlab å¿…é¡»ç‰ˆæœ¬ä¸€è‡´ï¼Œæ‰å¯ä»¥è¿›è¡Œæ¢å¤ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ gitlab çš„ç‰ˆæœ¬å·</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /opt/gitlab/embedded/service/gitlab-rails/VERSION<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¤‡ä»½æ–‡ä»¶</span>/usr/bin/gitlab-rake gitlab:backup:create<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç”Ÿæˆçš„å¤‡ä»½æ–‡ä»¶ä½äº <code>/var/opt/gitlab/backups</code> ç›®å½•ã€‚<br>å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>vim /etc/gitlab/gitlab.rb</code> ä¸­çš„ <code>gitlab_rails['backup_path']</code> é¡¹ï¼Œæ¥è°ƒæ•´é»˜è®¤çš„å¤‡ä»½ç›®å½•ã€‚</p><p>ç”Ÿæˆçš„æ–‡ä»¶ç±»ä¼¼äº <code>1651390965_2022_05_01_14.10.0_gitlab_backup.tar</code></p><h4 id="æ¢å¤"><a href="#æ¢å¤" class="headerlink" title="æ¢å¤"></a>æ¢å¤</h4><blockquote><p>è´¦å·å¯†ç ã€git ä»“åº“ã€ä»¥åŠä¸ªäººè®¾ç½®å•¥çš„éƒ½ä¼šè¢«æ¢å¤è¿‡æ¥</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœæ­¢ unicorn å’Œ sidekiqï¼Œä¿è¯æ•°æ®åº“æ²¡æœ‰æ–°çš„è¿æ¥ï¼Œä¸ä¼šæœ‰å†™æ•°æ®æƒ…å†µ</span><span class="token function">sudo</span> gitlab-ctl stop unicorn<span class="token function">sudo</span> gitlab-ctl stop sidekiq<span class="token comment"># è¿›å…¥å¤‡ä»½ç›®å½•è¿›è¡Œæ¢å¤ï¼Œ1651390965_2022_05_01_14.10.0 ä¸ºå¤‡ä»½æ–‡ä»¶çš„æ—¶é—´ä»¥åŠ gitlab ç‰ˆæœ¬å·</span><span class="token builtin class-name">cd</span> /var/opt/gitlab/backupsgitlab-rake gitlab:backup:restore <span class="token assign-left variable">BACKUP</span><span class="token operator">=</span>1651390965_2022_05_01_14.10.0<span class="token comment"># å¯åŠ¨ unicorn å’Œ sidekiq</span><span class="token function">sudo</span> gitlab-ctl start unicorn<span class="token function">sudo</span> gitlab-ctl start sidekiq<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é™çº§"><a href="#é™çº§" class="headerlink" title="é™çº§"></a>é™çº§</h3><p>é™çº§åªå»ºè®®åœ¨æ¬¡è¦ç‰ˆæœ¬å’Œè¡¥ä¸ç‰ˆæœ¬ä¹‹é—´é™çº§ã€‚<a href="https://docs.gitlab.com/ee/update/package/downgrade.html">å®˜æ–¹æ–‡æ¡£</a> æ¯”å¦‚ä»¥ä¸‹å°† <code>14.10.1</code> ç‰ˆæœ¬é™ä½åˆ° <code>14.10.0</code> ç‰ˆæœ¬</p><ol><li>åœæ­¢ gitlab å¹¶åˆ é™¤å½“å‰åŒ…</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># If running Puma</span><span class="token function">sudo</span> gitlab-ctl stop puma<span class="token comment"># Stop sidekiq</span><span class="token function">sudo</span> gitlab-ctl stop sidekiq<span class="token comment"># If on Ubuntu: remove the current package</span><span class="token function">sudo</span> dpkg <span class="token parameter variable">-r</span> gitlab-ce<span class="token comment"># If on Centos: remove the current package</span><span class="token function">sudo</span> yum remove gitlab-ce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç¡®å®šè¦é™çº§åˆ°çš„ gitlab ç‰ˆæœ¬</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># (Replace with gitlab-ce if you have GitLab FOSS installed)</span><span class="token comment"># Ubuntu</span><span class="token function">sudo</span> <span class="token function">apt-cache</span> madison gitlab-ce<span class="token comment"># CentOS:</span><span class="token function">sudo</span> yum <span class="token parameter variable">--showduplicates</span> list gitlab-ce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å°† gitlab é™çº§åˆ°æ‰€éœ€ç‰ˆæœ¬</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># (Replace with gitlab-ce if you have GitLab FOSS installed)</span><span class="token comment"># Ubuntu</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> gitlab-ce<span class="token operator">=</span><span class="token number">14.10</span>.0-ce.0<span class="token comment"># CentOS:</span><span class="token function">sudo</span> yum <span class="token function">install</span> gitlab-ce-14.10.0-ce.0.el7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>é‡æ–°é…ç½® gitlab</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gitlab-ctl reconfigure<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Git æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨ Docker å®‰è£… Gitlab</title>
      <link href="posts/bd835025.html"/>
      <url>posts/bd835025.html</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://hub.docker.com/r/gitlab/gitlab-ce">Gitlab å®˜æ–¹ docker</a><br><a href="https://docs.gitlab.com/ee/install/docker.html">å®˜æ–¹ docker å®‰è£…æ–‡æ¡£</a></p></blockquote><p><strong>å†…å­˜å°äº 4GB çš„æœºå™¨æœ€å¥½ä¸è¦å®‰è£…ï¼GitLab è¶…çº§å å†…å­˜ï¼</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /srv/gitlab<span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span><span class="token parameter variable">--hostname</span> <span class="token punctuation">{</span>your_github_hostname or your_ip<span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token parameter variable">--publish</span> <span class="token number">443</span>:443 <span class="token parameter variable">--publish</span> <span class="token number">80</span>:80 <span class="token parameter variable">--publish</span> <span class="token number">22</span>:22 <span class="token punctuation">\</span><span class="token parameter variable">--name</span> gitlab <span class="token punctuation">\</span><span class="token comment"># docker é‡å¯åï¼Œå®¹å™¨ä¹Ÿä¼šé‡å¯</span><span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span><span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span><span class="token comment"># gitlab é…ç½®</span><span class="token parameter variable">--volume</span> /srv/gitlab/config:/etc/gitlab <span class="token punctuation">\</span><span class="token comment"># gitlab æ—¥å¿—</span><span class="token parameter variable">--volume</span> /srv/gitlab/logs:/var/log/gitlab <span class="token punctuation">\</span><span class="token comment"># gitlab åº”ç”¨æ•°æ®</span><span class="token parameter variable">--volume</span> /srv/gitlab/data:/var/opt/gitlab <span class="token punctuation">\</span><span class="token comment"># è®¾ç½®å…±äº«å†…å­˜å¤§å°</span>--shm-size 256m <span class="token punctuation">\</span>gitlab/gitlab-ce:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿—</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> gitlab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é»˜è®¤ç”¨æˆ·åä¸º <code>root</code> ï¼Œåˆå§‹å¯†ç å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è·å–ã€‚<strong>24å°æ—¶å†…è¦ä¿®æ”¹é»˜è®¤å¯†ç </strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> gitlab <span class="token function">grep</span> <span class="token string">'Password:'</span> /etc/gitlab/initial_root_password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><blockquote><p>å› ä¸ºæˆ‘ä»¬å°† docker ä¸­çš„é…ç½®æ˜ å°„åˆ°å®¿ä¸»æœºçš„ <code>/srv/gitlab/config</code> ç›®å½•ä¸‹ï¼Œå› æ­¤å¯ç›´æ¥åœ¨è¯¥ç›®å½•ä¸­ç¼–è¾‘é…ç½®æ–‡ä»¶</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å¯ç”¨çš„é…ç½®</span><span class="token function">cat</span> /srv/gitlab/config/gitlab.rb <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'^#'</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'^$'</span><span class="token comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span><span class="token function">vim</span> /srv/gitlab/config/gitlab.rb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯èƒ½éœ€è¦ä¿®æ”¹çš„å†…å®¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®æ—¶åŒº</span>gitlab_rails<span class="token punctuation">[</span><span class="token string">'time_zone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span><span class="token comment"># è®¾ç½®è®¿é—®åœ°å€ï¼Œæ²¡æœ‰åŸŸååˆ™å¯ä»¥ç›´æ¥è®¾ç½®å®¿ä¸»æœºçš„ IP</span>external_url <span class="token string">'http://127.0.0.1'</span><span class="token comment"># è®¾ç½® ssh è®¿é—® hostï¼Œæ²¡æœ‰åŸŸååˆ™å¯ä»¥ç›´æ¥è®¾ç½®å®¿ä¸»æœºçš„ IP</span>gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_ssh_host'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token comment"># è®¾ç½® ssh ç«¯å£</span>gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_shell_ssh_port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2222</span><span class="token comment"># ç¦ç”¨å†…å»ºçš„ nginx</span>nginx<span class="token punctuation">[</span><span class="token string">'enable'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment"># å–æ¶ˆæ‰è¿™é‡Œçš„æ³¨é‡Š</span><span class="token comment"># å¤ªå ç”¨å†…å­˜äº†</span>puma<span class="token punctuation">[</span><span class="token string">'worker_processes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>postgresql<span class="token punctuation">[</span><span class="token string">'shared_buffers'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"256MB"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è¿ç”¨ systemd ç®¡ç† Linux ä¸­çš„æœåŠ¡</title>
      <link href="posts/ad8a576e.html"/>
      <url>posts/ad8a576e.html</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯-systemd"><a href="#ä»€ä¹ˆæ˜¯-systemd" class="headerlink" title="ä»€ä¹ˆæ˜¯ systemd"></a>ä»€ä¹ˆæ˜¯ systemd</h2><p><code>systemd</code> æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äºç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†çš„ä¸€ç§å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆå§‹åŒ–ç³»ç»Ÿï¼Œç”¨äºå¯åŠ¨å’Œç®¡ç†æ•´ä¸ªç³»ç»Ÿã€‚ä» Linux kernel å®Œæˆè‡ªæˆ‘å¯åŠ¨åï¼Œsystemd æ˜¯ç¬¬ä¸€ä¸ªè¢«å¯åŠ¨çš„ç”¨æˆ·çº§è¿›ç¨‹ï¼Œå®ƒçš„è¿›ç¨‹ ID ä¸º 1ã€‚å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬å¯åŠ¨ç³»ç»ŸæœåŠ¡ï¼Œç®¡ç†ç³»ç»Ÿèµ„æºï¼Œä»¥åŠå¤„ç†ç³»ç»Ÿå…³æœºã€é‡å¯ç­‰æ“ä½œã€‚</p><h2 id="ç³»ç»ŸæœåŠ¡å’Œ-systemd"><a href="#ç³»ç»ŸæœåŠ¡å’Œ-systemd" class="headerlink" title="ç³»ç»ŸæœåŠ¡å’Œ systemd"></a>ç³»ç»ŸæœåŠ¡å’Œ systemd</h2><p>åœ¨ Linux ä¸­, ä¸€ä¸ªæœåŠ¡é€šå¸¸è¢«å®šä¹‰ä¸ºä¸€ä¸ªå¸¸é©»çš„é•¿æ—¶è¿è¡Œç¨‹åºï¼Œæ¯”å¦‚ web æœåŠ¡å™¨, æ•°æ®åº“æœåŠ¡å™¨ç­‰ã€‚åœ¨ä½¿ç”¨ systemd çš„ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½è¢«å®šä¹‰ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ unitï¼Œè¿™äº› unit ä¼šè¢« systemd ç®¡ç†å’Œç›‘è§†ã€‚æ‰€æœ‰è¢« systemd ç®¡ç†çš„æœåŠ¡çš„é…ç½®æ–‡ä»¶éƒ½åœ¨ <code>/etc/systemd/system</code> å’Œ <code>/usr/lib/systemd/system</code> ç›®å½•ä¸‹ã€‚</p><h2 id="ç®¡ç†-systemd-æœåŠ¡"><a href="#ç®¡ç†-systemd-æœåŠ¡" class="headerlink" title="ç®¡ç† systemd æœåŠ¡"></a>ç®¡ç† systemd æœåŠ¡</h2><p>ä½ å¯ä»¥é€šè¿‡ <code>systemctl</code> å‘½ä»¤æ¥ç®¡ç†è¢« systemd æ§åˆ¶çš„æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ <code>systemctl</code> å‘ä»¤ï¼š</p><ul><li>æŸ¥çœ‹æ‰€æœ‰è¢« systemd æ§åˆ¶çš„æœåŠ¡: <code>systemctl list-units --type=service</code></li><li>å¯åŠ¨ä¸€ä¸ªæœåŠ¡: <code>systemctl start [service-name]</code></li><li>åœæ­¢ä¸€ä¸ªæœåŠ¡: <code>systemctl stop [service-name]</code></li><li>é‡å¯ä¸€ä¸ªæœåŠ¡: <code>systemctl restart [service-name]</code></li><li>æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„çŠ¶æ€: <code>systemctl status [service-name]</code></li><li>ä½¿æœåŠ¡åœ¨å¯åŠ¨æ—¶è‡ªå¯åŠ¨: <code>systemctl enable [service-name]</code></li><li>ç¦æ­¢æœåŠ¡åœ¨å¯åŠ¨æ—¶è‡ªå¯åŠ¨: <code>systemctl disable [service-name]</code></li></ul><h2 id="åˆ›å»º-systemd-æœåŠ¡"><a href="#åˆ›å»º-systemd-æœåŠ¡" class="headerlink" title="åˆ›å»º systemd æœåŠ¡"></a>åˆ›å»º systemd æœåŠ¡</h2><p>åˆ›å»ºè‡ªå®šä¹‰çš„ systemd æœåŠ¡ä¹Ÿå¾ˆç®€å•ã€‚ä¸»è¦æ˜¯åˆ›å»ºä¸€ä¸ªä»¥ <code>.service</code> ç»“å°¾çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†æœåŠ¡çš„æ‰§è¡Œç¨‹åºï¼Œå¯åŠ¨æ–¹å¼ç­‰ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><p>Systemd çš„ Service é…ç½®åœ¨ <code>/etc/systemd/system/</code> ç›®å½•ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª <code>echo.service</code> æ–‡ä»¶ï¼Œå®é™…é¡¹ç›®åº”å½“æ”¹ä¸ºå¯¹åº”çš„åç§°ã€‚ç¼–è¾‘æ­¤æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹åˆ—å†…å®¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span><span class="token assign-left variable">Description</span><span class="token operator">=</span>Echo Http Server<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target<span class="token assign-left variable">After</span><span class="token operator">=</span>syslog.target<span class="token punctuation">[</span>Service<span class="token punctuation">]</span><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">65535</span><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/php /opt/servers/echo/server.php<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-USR1</span> <span class="token variable">$MAINPID</span><span class="token assign-left variable">Restart</span><span class="token operator">=</span>always<span class="token punctuation">[</span>Install<span class="token punctuation">]</span><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target graphical.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>After æŒ‡ä»¤çº¦å®šäº†å¯åŠ¨çš„é¡ºåºï¼Œå¿…é¡»åœ¨ network å’Œ syslog å¯åŠ¨åæ‰å¯åŠ¨ echo æœåŠ¡</li><li>Service ä¸­å¡«å†™äº†åº”ç”¨ç¨‹åºçš„è·¯å¾„ä¿¡æ¯ï¼Œè¯·ä¿®æ”¹ä¸ºå®é™…é¡¹ç›®å¯¹åº”çš„è·¯å¾„</li><li>Restart=always è¡¨ç¤ºå¦‚æœè¿›ç¨‹æŒ‚æ‰ä¼šè‡ªåŠ¨æ‹‰èµ·</li><li>WantedBy çº¦å®šäº†åœ¨å“ªäº›ç¯å¢ƒä¸‹å¯åŠ¨ï¼Œmulti-user.target graphical.target è¡¨ç¤ºåœ¨å›¾å½¢ç•Œé¢å’Œå‘½ä»¤è¡Œç¯å¢ƒéƒ½ä¼šå¯åŠ¨</li></ul><p>ç¼–å†™å®Œæˆåéœ€è¦ reload å®ˆæŠ¤è¿›ç¨‹ä½¿å…¶ç”Ÿæ•ˆ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token parameter variable">--system</span> daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç®¡ç†æœåŠ¡ç¤ºä¾‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨æœåŠ¡</span><span class="token function">sudo</span> systemctl start echo.service<span class="token comment"># reload æœåŠ¡</span><span class="token function">sudo</span> systemctl reload echo.service<span class="token comment"># å…³é—­æœåŠ¡</span><span class="token function">sudo</span> systemctl stop echo.service<span class="token comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><span class="token function">sudo</span> systemctl status echo.service<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰çš„å¯åŠ¨é¡¹</span><span class="token function">sudo</span> systemctl list-unit-files<span class="token comment"># ç¦ç”¨å¼€æœºå¯åŠ¨</span><span class="token function">sudo</span> systemctl disable echo.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>systemd</code> æ˜¯ Linux å‘è¡Œç‰ˆä¸­çš„æ ‡å‡†å·¥å…·ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿå¯åŠ¨å’ŒæœåŠ¡ã€‚å…¶ <code>systemctl</code> å­å‘½ä»¤ä¹Ÿä¸ºç®¡ç†æœåŠ¡æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ã€‚ç†è§£å’ŒæŒæ¡ <code>systemctl</code> çš„ä½¿ç”¨å¿…å°†ä½¿ä½ èƒ½æ›´å¥½çš„ç†è§£å’Œæ§åˆ¶ä½ çš„ Linux ç³»ç»Ÿã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ–‡è®²æ‡‚ HTTP åè®®çŸ¥è¯†</title>
      <link href="posts/d8b21c9b.html"/>
      <url>posts/d8b21c9b.html</url>
      
        <content type="html"><![CDATA[<h1 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a>HTTPåè®®</h1><h2 id="HTTPæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#HTTPæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="HTTPæ˜¯ä»€ä¹ˆï¼Ÿ"></a>HTTPæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ä¸€ç§è§„èŒƒï¼Œç»Ÿä¸€äº†åŒæ–¹çš„æ²Ÿé€šæ–¹æ³•ã€‚<br>æµè§ˆå™¨ä¸­æ‰€æ˜¾ç¤ºçš„å†…å®¹éƒ½æ˜¯éœ€è¦ä»æœåŠ¡å™¨ä¸‹è½½åˆ°å®¢æˆ·ç«¯æ‰å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºã€‚ï¼ˆæ¯åˆ·æ–°ä¸€æ¬¡ç½‘é¡µéƒ½ä¼šäº§ç”Ÿä¸‹è½½ã€‚ï¼‰</p><h2 id="ä¸¤å¤§é‡ç‚¹ã€‚"><a href="#ä¸¤å¤§é‡ç‚¹ã€‚" class="headerlink" title="ä¸¤å¤§é‡ç‚¹ã€‚"></a>ä¸¤å¤§é‡ç‚¹ã€‚</h2><ul><li>è¯·æ±‚ä½“ï¼ˆrequestï¼‰<ul><li>å‘ä»€ä¹ˆï¼Ÿ<br>è¯·æ±‚æŠ¥æ–‡ã€‚</li></ul></li><li>å“åº”ä½“ï¼ˆresponseï¼‰<ul><li>æ”¶ä»€ä¹ˆï¼Ÿ<br>å“åº”æŠ¥æ–‡ã€‚</li></ul></li></ul><h2 id="http-æ ¼å¼"><a href="#http-æ ¼å¼" class="headerlink" title="http æ ¼å¼"></a>http æ ¼å¼</h2><p>æ¯ä¸ª http è¯·æ±‚å’Œå“åº”éƒ½éµå¾ªç›¸åŒçš„æ ¼å¼ï¼Œä¸€ä¸ª http åŒ…å« header å’Œ body ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ body æ˜¯å¯é€‰çš„ã€‚</p><h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// ç¬¬ä¸€è¡Œä¸ºè¯·æ±‚è¡Œ// GET è¯·æ±‚// è¯·æ±‚çš„url// http/1.1 åè®®ç‰ˆæœ¬GET http://sodevel.com/course/res/95/104 HTTP/1.1// ä»¥ä¸‹éƒ½æ˜¯è¯·æ±‚å¤´Host: sodevel.comProxy-Connection: keep-aliveCache-Control: max-age<span class="token operator">=</span><span class="token number">0</span>Upgrade-Insecure-Requests: <span class="token number">1</span>User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Windows NT <span class="token number">6.1</span><span class="token punctuation">;</span> WOW64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/69.0.3497.100 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>Cookie: XSRF-TOKEN<span class="token operator">=</span>eyJpdiI6IlphTmxTVXROaGkySTdYdk9xUnc5cUE9PSIsInZhbHVlIjoidWVVRDBiSWxzYVB6ZDk3VmlQSzhuSGF6THI3R2lzOGVodUxXM1I2aWt4WWdmTGw0R1JXbkFvY0NId00xdlhHSSIsIm1hYyI6IjVhMGFhNDY0NjExMTgxZjU4ZGM4NTM0ZGIwYjdiZmY2ZjMzN2YzY2U5YmZjN2NjZmZmZjNjMTg1NjhjNzZiZTQifQ%3D%3D<span class="token punctuation">;</span> <span class="token assign-left variable">laravel_session</span><span class="token operator">=</span>eyJpdiI6IkJYR3NSUXRtTHVURzFSVXRyZDNHXC93PT0iLCJ2YWx1ZSI6IjhscEdQc2IxMjNEaTBzMjRlNXM5eE1QOUNOeXdENXBTMWpBMFdoMk5oSzc0N1REVGVUVmdWYmhrc05MWEpZSWMiLCJtYWMiOiJmNzcwNjYwYjZmNDFlYzlmOWIwZjQ1MDM0MzA5NzQ2NjYzNTUzMzI5ZjIzMmIzYTAyMjQ4M2UzZGZhNGEzOWZhIn0%3D// å½“é‡åˆ°è¿ç»­çš„ä¸¤ä¸ª <span class="token punctuation">\</span>r<span class="token punctuation">\</span>n æ—¶ï¼Œheader éƒ¨åˆ†ç»“æŸï¼Œåé¢çš„æ•°æ®å…¨éƒ¨æ˜¯ body<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-505d729ac85418fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¯·æ±‚æµç¨‹"></p><h3 id="reponse"><a href="#reponse" class="headerlink" title="reponse"></a>reponse</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// å“åº”è¡Œ// åè®®ç‰ˆæœ¬// è¯·æ±‚çŠ¶æ€HTTP/1.1 <span class="token number">200</span> OK// å“åº”å¤´å¼€å§‹Server: nginxContent-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>UTF-8Transfer-Encoding: chunkedConnection: closeVary: Accept-EncodingX-Powered-By: PHP/7.2.6Cache-Control: no-cache, privateDate: Mon, <span class="token number">31</span> Dec <span class="token number">2018</span> 06:54:59 GMTSet-Cookie: XSRF-TOKEN<span class="token operator">=</span>eyJpdiI6IjFUVHVvOVwvMURRT1BTbmFzczhNTWhnPT0iLCJ2YWx1ZSI6IkhNdmtmcTcyWGNlSUNRTjVDU0hUcU1QenY3K1pDcHAzdTVHUGFXMVNhMlp4clg3bVNidzArMzhhaE1wSHJVVXciLCJtYWMiOiIxZmNhZmY2OGYwYmEzNzFhZDhlOGViYjE4YzRjNmExMTE2MjhiODI5M2Q2NWFmZjM2NWM2MDAwYzg0NzJkOTRlIn0%3D<span class="token punctuation">;</span> <span class="token assign-left variable">expires</span><span class="token operator">=</span>Mon, <span class="token number">31</span>-Dec-2018 08:54:59 GMT<span class="token punctuation">;</span> Max-Age<span class="token operator">=</span><span class="token number">7200</span><span class="token punctuation">;</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/Set-Cookie: <span class="token assign-left variable">laravel_session</span><span class="token operator">=</span>eyJpdiI6ImtqdG9sa0lIZ3hNRWhkNGpFM08rSXc9PSIsInZhbHVlIjoiSkZjeWlOcCtVdks4VlFHRVB5KzRoUzZQZFUyMWd1YzRDNmdmUHhUU1IwVEhyaUZ5eXdcL0NWREk5THFEQndzNEkiLCJtYWMiOiI1ZmViNDU0ZDVkNDFlYzU0ZjZjMGRjNGYyYWFjZGFjYjg2OGMyZWFlODI3ZDY1NzBhOWE5MjAyMmU5ZWVkNjQ1In0%3D<span class="token punctuation">;</span> <span class="token assign-left variable">expires</span><span class="token operator">=</span>Mon, <span class="token number">31</span>-Dec-2018 08:54:59 GMT<span class="token punctuation">;</span> Max-Age<span class="token operator">=</span><span class="token number">7200</span><span class="token punctuation">;</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/<span class="token punctuation">;</span> httponlyContent-Encoding: <span class="token function">gzip</span>Proxy-Connection: keep-alive// å“åº”å¤´ç»“æŸ// å½“é‡åˆ°è¿ç»­çš„ä¸¤ä¸ª <span class="token punctuation">\</span>r<span class="token punctuation">\</span>n æ—¶ï¼Œå“åº”å¤´éƒ¨åˆ†ç»“æŸï¼Œåé¢çš„æ•°æ®å…¨éƒ¨æ˜¯ body<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-911fe20dbfb82de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å“åº”æµç¨‹"></p><p><strong>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong></p><p><code>å“åº”å¤´å’Œå“åº”æ­£æ–‡ï¼ˆæ ‡å‡†çš„ç½‘é¡µhtmlä»£ç æˆ–è€…å›¾ç‰‡ï¼‰ä¸­é—´æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œåªä¸è¿‡Chromeæµè§ˆå™¨å°†ä¸­é—´çš„ç©ºè¡Œ</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"www.example.com"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)&lt;br /&gt;\n"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// ä¸€ä¸ª \r\n ä»£è¡¨æ¢è¡Œ</span>    <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"GET / HTTP/1.1\r\n"</span><span class="token punctuation">;</span>    <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"Host: www.example.com\r\n"</span><span class="token punctuation">;</span>    <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">;</span>    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="çŠ¶æ€ç ï¼š"><a href="#çŠ¶æ€ç ï¼š" class="headerlink" title="çŠ¶æ€ç ï¼š"></a>çŠ¶æ€ç ï¼š</h3><blockquote><p>1â€“ å·²ç»æ¥å—è¯·æ±‚ï¼Œå¤„ç†ä¸­<br>2â€“ è¯·æ±‚æˆåŠŸ<br>3â€“ æ¶‰åŠè·³è½¬ç½‘å€<br>4â€“ å®¢æˆ·ç«¯é”™è¯¯ï¼Œæ¯”å¦‚è¯·æ±‚äº†ä¸å­˜åœ¨çš„ç½‘å€<br>5â€“ æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨ç«¯å¯èƒ½å‡ºç°é—®é¢˜</p></blockquote><ul><li>100~199ï¼šè¡¨ç¤ºæœåŠ¡ç«¯æˆåŠŸæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¦æ±‚å®¢æˆ·ç«¯ç»§ç»­æäº¤ä¸‹ä¸€æ¬¡è¯·æ±‚æ‰èƒ½å®Œæˆæ•´ä¸ªå¤„ç†è¿‡ç¨‹ã€‚</li><li>200~299ï¼šè¡¨ç¤ºæœåŠ¡ç«¯æˆåŠŸæ¥æ”¶è¯·æ±‚å¹¶å·²å®Œæˆæ•´ä¸ªå¤„ç†è¿‡ç¨‹ã€‚æœ€å¸¸ç”¨å°±æ˜¯ï¼š200</li><li>300~399ï¼šä¸ºå®Œæˆè¯·æ±‚ï¼Œå®¢æˆ·ç«¯éœ€è¿›ä¸€æ­¥ç»†åŒ–è¯·æ±‚ã€‚æ¯”è¾ƒå¸¸ç”¨çš„å¦‚ï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²ç»ç§»åŠ¨ä¸€ä¸ªæ–°åœ°å€ä½¿ç”¨ 302 è¡¨ç¤ºå°†èµ„æºé‡å®šå‘ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºæœªå‘ç”Ÿæ”¹å˜ï¼Œä½¿ç”¨ 304ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ä»æœ¬åœ°ç¼“å­˜ä¸­è·å–ã€‚</li><li>400~499ï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚æœ‰é”™è¯¯ï¼Œå¦‚ï¼š404 è¡¨ç¤ºä½ è¯·æ±‚çš„èµ„æºåœ¨ web æœåŠ¡å™¨ä¸­æ‰¾ä¸åˆ°ï¼Œ403 è¡¨ç¤ºæœåŠ¡å™¨æ‹’ç»å®¢æˆ·ç«¯çš„è®¿é—®ï¼Œä¸€èˆ¬æ˜¯æƒé™ä¸å¤Ÿã€‚</li><li>500~599ï¼šæœåŠ¡å™¨ç«¯å‡ºç°é”™è¯¯ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ï¼š500</li></ul><h3 id="æ³¨æ„ç‚¹ï¼š"><a href="#æ³¨æ„ç‚¹ï¼š" class="headerlink" title="æ³¨æ„ç‚¹ï¼š"></a>æ³¨æ„ç‚¹ï¼š</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">setcookie<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> å’Œ header<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> å‰ä¸èƒ½æœ‰ä»»ä½•è¾“å‡ºã€‚åŸå› æ˜¯ï¼šè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ç”¨äºè®¾ç½®å¤´ä¿¡æ¯çš„ï¼Œhttpåè®®å¿…é¡»æ˜¯å…ˆè®¾ç½®å¤´ä¿¡æ¯åæ‰ä¼šæœ‰è¾“å‡ºå†…å®¹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-69402ab4b1507951.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="httpåè®®"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d334afce5c97f48b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="httpåè®®"></p><ol><li>æµè§ˆå™¨é€šè¿‡httpåè®®å‘èµ·è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ˆApacheæˆ–è€…nginxï¼‰</li><li>æœåŠ¡å™¨ï¼ˆApacheæˆ–è€…nginxï¼‰æ ¹æ®ä¸åŒçš„éœ€æ±‚äº¤ç»™phpæ–‡ä»¶å¤„ç†ã€‚</li><li>phpå¯èƒ½ä¼šéœ€è¦è¯·æ±‚MySQL</li><li>å¦‚æœéœ€è¦è¯·æ±‚mysqlï¼Œmysqlå°†ç»“æœè¿”å›ç»™phpæ–‡ä»¶</li><li>phpæ–‡ä»¶å°†ç»“æœè¿”è¿˜ç»™æœåŠ¡å™¨ï¼ˆApacheæˆ–è€…nginxï¼‰</li><li>æœåŠ¡å™¨ï¼ˆApacheæˆ–è€…nginxï¼‰å°†æœ€ç»ˆç»“æœé€šè¿‡httpåè®®å‘é€ç»™æµè§ˆå™¨ã€‚</li></ol><h3 id="httpåè®®ç‰¹ç‚¹"><a href="#httpåè®®ç‰¹ç‚¹" class="headerlink" title="httpåè®®ç‰¹ç‚¹"></a>httpåè®®ç‰¹ç‚¹</h3><ol><li>æ— çŠ¶æ€ï¼šä¸èƒ½è®°ä½æœ¬æ¬¡è¯·æ±‚äº§ç”Ÿçš„æ•°æ®ï¼Œä¸åŒè¯·æ±‚ä¹‹é—´ï¼Œæ•°æ®ä¸èƒ½å…±äº«ã€‚</li><li>æœ‰ä¼šè¯ï¼šsessionå’Œcookieã€‚</li><li>ç¼“å­˜ï¼šé€šè¿‡Cache-Controlæ ‡è®°ï¼Œå¯é€šçŸ¥æµè§ˆå™¨å¦‚ä½•ç¼“å­˜è¯¥é¡µé¢ã€‚</li><li>åŒæºï¼šæµè§ˆå™¨ä¸ºäº†é˜²æ­¢è·¨åŸŸæ”»å‡»ï¼Œå¤šæ•°è¦æ±‚åŒæºç­–ç•¥ï¼ŒHTTPå¯ä»¥é€šè¿‡æ ‡è®°æ¥å¼€æ”¾é™åˆ¶ã€‚</li><li>è®¤è¯ï¼šé€šè¿‡Authenticateæ ‡è®°ï¼Œå¯å®ç°åŸºäºhttpçš„è®¤è¯ã€‚</li><li>ä»£ç†</li></ol><ul><li><h3 id="èµ„æ–™æ–‡æ¡£"><a href="#èµ„æ–™æ–‡æ¡£" class="headerlink" title="èµ„æ–™æ–‡æ¡£"></a>èµ„æ–™æ–‡æ¡£</h3></li></ul><blockquote><p><a href="https://www.cnblogs.com/ranyonsue/p/5984001.html">https://www.cnblogs.com/ranyonsue/p/5984001.html</a><br>æˆ–è€…<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></p></blockquote><ul><li><h3 id="http-åŠ¨è¯"><a href="#http-åŠ¨è¯" class="headerlink" title="http åŠ¨è¯"></a>http åŠ¨è¯</h3></li></ul><table><thead><tr><th>åŠ¨è¯</th><th>æè¿°</th><th>æ˜¯å¦å¹‚ç­‰</th></tr></thead><tbody><tr><td>GET</td><td>è·å–èµ„æºï¼Œå•ä¸ªæˆ–å¤šä¸ª</td><td>æ˜¯</td></tr><tr><td>POST</td><td>åˆ›å»ºèµ„æº</td><td>å¦</td></tr><tr><td>PUT</td><td>æ›´æ–°èµ„æºï¼Œå®¢æˆ·ç«¯æä¾›å®Œæ•´çš„èµ„æºæ•°æ®</td><td>æ˜¯</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/PATCH">PATCH</a></td><td>æ›´æ–°èµ„æºï¼Œå®¢æˆ·ç«¯æä¾›éƒ¨åˆ†çš„èµ„æºæ•°æ®</td><td>å¦</td></tr><tr><td>DELETE</td><td>åˆ é™¤èµ„æº</td><td>æ˜¯</td></tr></tbody></table><p><code>å¹‚ç­‰æ€§</code>ï¼ŒæŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡è®¿é—®ä¸å¤šæ¬¡è®¿é—®ï¼Œå¯¹è¿™ä¸ªèµ„æºå¸¦æ¥çš„å˜åŒ–æ˜¯ç›¸åŒçš„ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆ PUT æ˜¯å¹‚ç­‰çš„è€Œ PATCH æ˜¯éå¹‚ç­‰çš„ï¼Œå› ä¸º PUT æ˜¯æ ¹æ®å®¢æˆ·ç«¯æä¾›äº†å®Œæ•´çš„èµ„æºæ•°æ®ï¼Œå®¢æˆ·ç«¯æäº¤ä»€ä¹ˆå°±æ›¿æ¢ä¸ºä»€ä¹ˆï¼Œè€Œ PATCH æœ‰å¯èƒ½æ˜¯æ ¹æ®å®¢æˆ·ç«¯æä¾›çš„å‚æ•°ï¼ŒåŠ¨æ€çš„è®¡ç®—å‡ºæŸä¸ªå€¼ï¼Œä¾‹å¦‚æ¯æ¬¡è¯·æ±‚åèµ„æºçš„æŸä¸ªå‚æ•°å‡1ï¼Œæ‰€ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œèµ„æºä¼šæœ‰ä¸åŒçš„å˜åŒ–ã€‚</p></blockquote><h3 id="http-çŠ¶æ€ç "><a href="#http-çŠ¶æ€ç " class="headerlink" title="http çŠ¶æ€ç "></a>http çŠ¶æ€ç </h3><blockquote><p>http çŠ¶æ€ç è¯¦ç»†è®²è§£ï¼š<a href="https://httpstatuses.com/">https://httpstatuses.com/</a><br>json.api æ ¼å¼è§„èŒƒåŒ–ï¼š<a href="http://jsonapi.org.cn/format/">http://jsonapi.org.cn/format/</a></p></blockquote><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>å¯¹æˆåŠŸçš„ GETã€PUTã€PATCH æˆ– DELETE æ“ä½œè¿›è¡Œå“åº”ã€‚ä¹Ÿå¯ä»¥è¢«ç”¨åœ¨ä¸åˆ›å»ºæ–°èµ„æºçš„ POST æ“ä½œä¸Š</td></tr><tr><td>201</td><td>Created</td><td>å¯¹åˆ›å»ºæ–°èµ„æºçš„ POST æ“ä½œè¿›è¡Œå“åº”ã€‚åº”è¯¥å¸¦ç€æŒ‡å‘æ–°èµ„æºåœ°å€çš„ Location å¤´</td></tr><tr><td>202</td><td>Accepted</td><td>æœåŠ¡å™¨æ¥å—äº†è¯·æ±‚ï¼Œä½†æ˜¯è¿˜æœªå¤„ç†ï¼Œå“åº”ä¸­åº”è¯¥åŒ…å«ç›¸åº”çš„æŒ‡ç¤ºä¿¡æ¯ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¯¥å»å“ªé‡ŒæŸ¥è¯¢å…³äºæœ¬æ¬¡è¯·æ±‚çš„ä¿¡æ¯</td></tr><tr><td>204</td><td>No Content</td><td>å¯¹ä¸ä¼šè¿”å›å“åº”ä½“çš„æˆåŠŸè¯·æ±‚è¿›è¡Œå“åº”ï¼ˆæ¯”å¦‚ DELETE è¯·æ±‚ï¼‰</td></tr><tr><td>304</td><td>Not Modified</td><td>HTTPç¼“å­˜headerç”Ÿæ•ˆçš„æ—¶å€™ç”¨</td></tr><tr><td>400</td><td>Bad Request</td><td>è¯·æ±‚å¼‚å¸¸ï¼Œæ¯”å¦‚è¯·æ±‚ä¸­çš„bodyæ— æ³•è§£æ</td></tr><tr><td>401</td><td>Unauthorized</td><td>æ²¡æœ‰è¿›è¡Œè®¤è¯æˆ–è€…è®¤è¯éæ³•</td></tr><tr><td>403</td><td>Forbidden</td><td>æœåŠ¡å™¨å·²ç»ç†è§£è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œå®ƒ</td></tr><tr><td>404</td><td>Not Found</td><td>è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æº</td></tr><tr><td>405</td><td>Method Not Allowed</td><td>æ‰€è¯·æ±‚çš„ HTTP æ–¹æ³•ä¸å…è®¸å½“å‰è®¤è¯ç”¨æˆ·è®¿é—®</td></tr><tr><td>410</td><td>Gone</td><td>è¡¨ç¤ºå½“å‰è¯·æ±‚çš„èµ„æºä¸å†å¯ç”¨ã€‚å½“è°ƒç”¨è€ç‰ˆæœ¬ API çš„æ—¶å€™å¾ˆæœ‰ç”¨</td></tr><tr><td>415</td><td>Unsupported Media Type</td><td>å¦‚æœè¯·æ±‚ä¸­çš„å†…å®¹ç±»å‹æ˜¯é”™è¯¯çš„</td></tr><tr><td>422</td><td>Unprocessable Entity</td><td>ç”¨æ¥è¡¨ç¤ºæ ¡éªŒé”™è¯¯</td></tr><tr><td>429</td><td>Too Many Requests</td><td>ç”±äºè¯·æ±‚é¢‘æ¬¡è¾¾åˆ°ä¸Šé™è€Œè¢«æ‹’ç»è®¿é—®</td></tr></tbody></table><h3 id="http-æäº¤æ•°æ®å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼"><a href="#http-æäº¤æ•°æ®å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼" class="headerlink" title="http æäº¤æ•°æ®å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼"></a>http æäº¤æ•°æ®å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼</h3><ol><li>application/x-www-form-urlencoded(é»˜è®¤å€¼)</li><li>multipart/form-data ï¼ˆform è¡¨å•æäº¤æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å¢åŠ  enctype=â€multipart/form-dataâ€ï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç§‘æ™® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æƒé™</title>
      <link href="posts/41bc9f3e.html"/>
      <url>posts/41bc9f3e.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æƒé™"><a href="#Linux-ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æƒé™" class="headerlink" title="Linux ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æƒé™"></a>Linux ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æƒé™</h1><h2 id="ç”¨æˆ·"><a href="#ç”¨æˆ·" class="headerlink" title="ç”¨æˆ·"></a>ç”¨æˆ·</h2><table><thead><tr><th>å‘½ä»¤ä»‹ç»</th><th>å‘½ä»¤è¡Œ</th></tr></thead><tbody><tr><td>æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·</td><td>cat /etc/passwd  æˆ–è€… cat /etc/shadow</td></tr><tr><td>æ·»åŠ è´¦å·</td><td>useradd æ¯”å¦‚æ·»åŠ  alex è´¦å·: useradd alex</td></tr><tr><td>ä¿®æ”¹å¯†ç </td><td>passwd æ¯”å¦‚ä¿®æ”¹ alex è´¦å·çš„å¯†ç ï¼š passwd alex</td></tr><tr><td>ä¿®æ”¹è´¦å·</td><td>usermod</td></tr><tr><td>åˆ é™¤è´¦å·</td><td>userdel</td></tr><tr><td>æŸ¥è¯¢è´¦å·</td><td>id æ¯”å¦‚æŸ¥è¯¢ alex çš„è´¦å·ï¼šid alex</td></tr><tr><td>åˆ‡æ¢è´¦å·</td><td>su æ¯”å¦‚åˆ‡æ¢åˆ° alex è´¦å·ï¼šsu alex</td></tr></tbody></table><h2 id="ç”¨æˆ·ç»„"><a href="#ç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·ç»„"></a>ç”¨æˆ·ç»„</h2><table><thead><tr><th>å‘½ä»¤ä»‹ç»</th><th>å‘½ä»¤è¡Œ</th></tr></thead><tbody><tr><td>æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ç»„</td><td>cat /etc/group æˆ–è€… cat /etc/gshadow</td></tr><tr><td>æ·»åŠ ç”¨æˆ·ç»„</td><td>groupadd</td></tr><tr><td>ä¿®æ”¹ç»„ä¿¡æ¯</td><td>groupmod</td></tr><tr><td>åˆ é™¤ç”¨æˆ·ç»„</td><td>groupdel</td></tr></tbody></table><table><thead><tr><th>å‘½ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>groupadd -g 4000 adminuser</td><td>æ–°å»º adminuser ç”¨æˆ·ç»„ï¼Œä¸” id ä¸º 4000</td></tr><tr><td>useradd -G adminuser natasha</td><td>æ–°å»º natasha ç”¨æˆ·ï¼Œä¸” adminuser ä½œä¸ºå…¶é™„å±ç»„</td></tr><tr><td>useradd -s /sbin/nologin sarah</td><td>æ–°å»º sarah ç”¨æˆ·ï¼Œä¸”åœ¨ç³»ç»Ÿä¸­æ²¡æœ‰ä»»ä½•å¯äº¤äº’çš„ shell ï¼ˆä¸å…è®¸è¯¥ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼‰</td></tr><tr><td>useradd -u 123 jay</td><td>æ–°å»º jay ç”¨æˆ·ï¼Œä¸” id ä¸º 123</td></tr><tr><td>echo redhat | passwd â€“stdin harry</td><td>æ–°å»º harry ç”¨æˆ·ï¼Œä¸”å¯†ç ä¸º redhat</td></tr></tbody></table><h2 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h2><ul><li><h3 id="è¯»ã€å†™ã€æ‰§è¡Œ"><a href="#è¯»ã€å†™ã€æ‰§è¡Œ" class="headerlink" title="è¯»ã€å†™ã€æ‰§è¡Œ"></a>è¯»ã€å†™ã€æ‰§è¡Œ</h3></li></ul><p>æ•°å­—è¡¨è¾¾å½¢å¼ï¼šè¯»ï¼ˆ4ï¼‰ å†™ï¼ˆ2ï¼‰ æ‰§è¡Œï¼ˆ1ï¼‰<br>å­—æ¯è¡¨è¾¾å½¢å¼ï¼šè¯»ï¼ˆrï¼‰ å†™ï¼ˆwï¼‰ æ‰§è¡Œï¼ˆxï¼‰</p><ul><li><h3 id="ä¿®æ”¹æ–‡ä»¶æƒé™"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™"></a>ä¿®æ”¹æ–‡ä»¶æƒé™</h3></li></ul><p>chmod æ¯”å¦‚ä¿®æ”¹aæ–‡ä»¶çš„æƒé™ä¸ºæœ€é«˜æƒé™chmod  0777 a<br>ä¿®æ”¹aaaæ–‡ä»¶å¤¹ä¸‹é¢æ‰€æœ‰çš„æ–‡ä»¶ä¸ºæœ€å¤§æƒé™chmod 0777 -R aaa (-Rä»£è¡¨é€’å½’)<br>(æˆ–è€…ä½¿ç”¨chmod -R 777 aaa)</p><ul><li><h3 id="ä¿®æ”¹èµ„æºçš„æ‰€æœ‰è€…"><a href="#ä¿®æ”¹èµ„æºçš„æ‰€æœ‰è€…" class="headerlink" title="ä¿®æ”¹èµ„æºçš„æ‰€æœ‰è€…"></a>ä¿®æ”¹èµ„æºçš„æ‰€æœ‰è€…</h3>chown</li><li><h3 id="ä¿®æ”¹èµ„æºæ‰€å±çš„ç”¨æˆ·ç»„"><a href="#ä¿®æ”¹èµ„æºæ‰€å±çš„ç”¨æˆ·ç»„" class="headerlink" title="ä¿®æ”¹èµ„æºæ‰€å±çš„ç”¨æˆ·ç»„"></a>ä¿®æ”¹èµ„æºæ‰€å±çš„ç”¨æˆ·ç»„</h3>chgrp</li><li><h3 id="æŸ¥çœ‹æƒé™ä¿¡æ¯"><a href="#æŸ¥çœ‹æƒé™ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æƒé™ä¿¡æ¯"></a>æŸ¥çœ‹æƒé™ä¿¡æ¯</h3>ll</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZuf6aig35m8ho0xq75ijnZ wwwroot<span class="token punctuation">]</span><span class="token comment"># ll</span>total <span class="token number">8</span>drwxr-xr-x <span class="token number">4</span> www www <span class="token number">4096</span> Jun <span class="token number">23</span> 01:55 defaultdrwxrwxrwx <span class="token number">9</span> www www <span class="token number">4096</span> Jun <span class="token number">23</span> <span class="token number">17</span>:26 www.drling.xin<span class="token comment"># å¯¹äº default æ–‡ä»¶å¤¹æƒé™çš„è§£è¯»</span><span class="token comment"># drwxr-xr-x</span><span class="token comment"># d è¡¨ç¤º default ä¸ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœæ˜¯æ–‡ä»¶çš„è¯å‰é¢ä¼šæ˜¯ -</span><span class="token comment"># rwx ç¬¬2ä¸ªå­—æ¯åˆ°ç¬¬4ä¸ªå­—æ¯ ä»£è¡¨ç€æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ å¯è¯»å¯å†™å¯æ‰§è¡Œ</span><span class="token comment"># r-x ç¬¬5ä¸ªå­—æ¯åˆ°ç¬¬7ä¸ªå­—æ¯ è¡¨ç¤ºç€æ–‡ä»¶æ‰€åœ¨çš„ç”¨æˆ·ç»„çš„å…¶ä»–ç”¨æˆ·çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ å¯è¯»ä¸å¯å†™å¯æ‰§è¡Œ</span><span class="token comment"># r-x ç¬¬8ä¸ªå­—æ¯åˆ°ç¬¬10ä¸ªå­—æ¯ è¡¨ç¤ºç”¨æˆ·ç»„å…¶ä»–çš„äººçš„æƒé™ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆé™Œç”Ÿäººçš„æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ å¯è¯»ä¸å¯å†™å¯æ‰§è¡Œ</span><span class="token comment"># 4 ä»£è¡¨è¿æ¥æ•°</span><span class="token comment"># www ç¬¬ä¸€ä¸ª www ä»£è¡¨ default è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç”¨æˆ·</span><span class="token comment"># www ç¬¬äºŒä¸ª www ä»£è¡¨ default è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç”¨æˆ·ç»„</span><span class="token comment"># 4096 ä»£è¡¨æ¡£æ¡ˆå®¹é‡</span><span class="token comment"># Jun 23 01:55 ä»£è¡¨æ¡£æ¡ˆæœ€åè¢«ä¿®æ”¹çš„æ—¶é—´</span><span class="token comment"># default æ–‡ä»¶å¤¹å¯¹åº”çš„æ•°å­—æƒé™ä¸º 755</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ›´æ”¹ <code>/var/www/test</code> æ–‡ä»¶æ‰€å±è€…ä¸º harryï¼Œæ‰€å±ç»„ä¸º alex</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> harry:alex /var/www/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ‰€æœ‰äººéƒ½ä¸èƒ½æ‰§è¡Œ <code>/var/www/test</code> æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> a-x /var/www/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ä¸ºç‰¹å®šç”¨æˆ·è®¾å®šç‰¹æ®Šæƒé™</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">setfacl <span class="token parameter variable">-Rm</span> u:natasha:rw,u:harry:- /var/www/test<span class="token comment"># æŸ¥çœ‹ç‰¹å®šæƒé™</span>getfacl /var/www/test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ‡æ¢ç”¨æˆ·å¹¶æ‰§è¡Œå‘½ä»¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ‡æ¢æˆ www-data ç”¨æˆ·ï¼Œå¹¶æ‰§è¡Œ php artisan tinker å‘½ä»¤</span><span class="token function">sudo</span> <span class="token parameter variable">-H</span> <span class="token parameter variable">-u</span> www-data <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'php artisan tinker'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£Vimä¿å­˜å‘½ä»¤â€œ:w !sudo tee %â€</title>
      <link href="posts/c1413261.html"/>
      <url>posts/c1413261.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Linux ä¸–ç•Œä¸­ï¼ŒVim ç¼–è¾‘å™¨æ˜¯ä¸€ä¸ªå¹¿å—æ¬¢è¿çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå®ƒå¼ºå¤§çš„åŠŸèƒ½å’Œä¸°å¯Œçš„å‘½ä»¤é›†åˆèµ‹äºˆäº†å®ƒæ— ä¸ä¼¦æ¯”çš„ç”Ÿå‘½åŠ›ã€‚ä»Šå¤©æˆ‘ä»¬è¦æ¥æ¢è®¨çš„æ˜¯ Vim ä¸­çš„ä¸€ä¸ª<strong>å¾ˆå¸¸ç”¨ä½†å¯èƒ½åˆå­¦è€…æ˜“äºå¿½ç•¥</strong>çš„å‘½ä»¤â€”â€”<code>:w !sudo tee %</code>ã€‚è¿™ä¸ªå‘½ä»¤æ•´ä½“ä¸Šçš„å«ä¹‰æ˜¯å½“ä½ æ‰“å¼€ä¸€ä¸ªéœ€è¦ root æƒé™<strong>æ‰èƒ½ä¿®æ”¹</strong>çš„æ–‡ä»¶ï¼Œè€Œä½ ä¿®æ”¹æ–‡ä»¶ååˆä¸æƒ³é€€å‡º Vim ç¼–è¾‘å™¨ï¼Œç„¶åå†ä½¿ç”¨ sudo å‘½ä»¤æ¥å¯åŠ¨ Vimï¼Œè¿™æ—¶ä½ å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥è·å–ä¸´æ—¶çš„æƒé™ï¼Œä¿å­˜ä½ çš„æ›´æ”¹ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆæ‹†åˆ†è¿™ä¸ªå‘½ä»¤çš„æ¯ä¸€ä¸ªéƒ¨åˆ†æ¥ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><ol><li><p><code>:</code>ï¼šè¿™åœ¨ Vim ä¸­æ„å‘³ç€æˆ‘ä»¬å°†è¦è¾“å…¥ä¸€æ¡å‘½ä»¤ã€‚åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥åœ¨æ ‡é¢˜æ ä¸­ç”¨<code>: </code>æ¥å¼€å§‹ã€‚</p></li><li><p><code>w</code>ï¼šâ€:wâ€ æ˜¯ä¸€ä¸ªå¸¸è§çš„ Vim å‘½ä»¤ï¼Œä»£è¡¨ç€ â€œwriteâ€ã€‚è¿™ä¸ªå‘½ä»¤å•ç‹¬ä½¿ç”¨çš„è¯ï¼Œä¼šå°†ä½ åœ¨ Vim ä¸­æ‰€åšçš„æ”¹åŠ¨å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚è¿™é‡Œçš„å†™å…¥å¹¶ä¸ç›´æ¥æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯å†™å…¥ç»™ Vim çš„ç¼“å†²åŒºã€‚</p></li><li><p><code>!</code>ï¼šåœ¨ Vim ä¸­ï¼Œæ„Ÿå¹å·(â€˜!â€™)è¡¨ç¤ºæˆ‘ä»¬è¦åœ¨ shell ç¯å¢ƒä¸‹æ‰§è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ã€‚å®ƒå‘Šè¯‰ Vim å»è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç¨‹åºã€‚</p></li><li><p><code>sudo</code>ï¼šåœ¨ Linux å‘½ä»¤ä¸­ï¼Œ<code>sudo</code> å‘½ä»¤ï¼ˆSuâ€doâ€ï¼ˆsuperuser; substitute user; switch user doï¼‰ï¼‰é€šå¸¸è¡¨ç¤ºä½â€ä»¥è¶…çº§ç”¨æˆ·èº«ä»½å»åšâ€çš„æ„ä¹‰ã€‚ä¹‹æ‰€ä»¥éœ€è¦ <code>sudo</code> æ˜¯å› ä¸ºåŸæœ¬ä½ å¯èƒ½æ²¡æœ‰å†™å…¥è¿™ä¸ªæ–‡ä»¶éœ€è¦çš„æƒé™ã€‚</p></li><li><p><code>tee</code>ï¼š<code>tee</code> æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ UNIX å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ¥å—è¾“å…¥ï¼Œå¹¶å°†ç»“æœé‡å®šå‘åˆ°æ–‡ä»¶å’Œå±å¹•ï¼ˆstdoutï¼‰ã€‚</p></li><li><p><code>%</code>ï¼šåœ¨ Vim ä¸­ï¼Œâ€™%â€™ ç¬¦å·è¡¨ç¤ºå½“å‰æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ã€‚</p></li></ol><p>æ‰€ä»¥ï¼Œè¿™ä¸ªå‘½ä»¤çš„æ•´ä½“å«ä¹‰å°±ä»£è¡¨ç€ï¼š <strong>æŠŠå½“å‰çš„ç¼“å†²åŒºå†…å®¹è¾“å‡ºåˆ°å±å¹•ï¼Œå¹¶ä»¥è¶…çº§ç”¨æˆ·çš„èº«ä»½é€šè¿‡ <code>tee</code> å‘½ä»¤å†™å…¥åˆ°å½“å‰æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ä¸­</strong>ã€‚</p><p>ä¸»è¦ç”¨äºï¼š<strong>åœ¨æ²¡æœ‰æ–‡ä»¶å†™å…¥æƒé™å´éœ€è¦ä¿å­˜çš„æƒ…å†µä¸‹ï¼Œèµ‹äºˆç”¨æˆ·ä»¥è¶…çº§ç”¨æˆ·çš„èº«ä»½ä¿å­˜æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ã€‚</strong></p><p>äº‹å®ä¸Šï¼Œè¿™ä¸ªå‘½ä»¤èƒŒåçš„åŸç†æ›´ä¸ºé«˜æ·±ã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­è¾“å…¥ä¸€æ¡å¸¦æœ‰ç®¡é“ï¼ˆ|ï¼‰çš„å‘½ä»¤ï¼ŒShell ä¼šæŒ‰ç…§é¡ºåºä¸€ä¸€å¤„ç†ä½ çš„å‘½ä»¤ã€‚åœ¨æˆ‘ä»¬çš„è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œé¦–å…ˆå®ƒè¢«<code>:</code>è§£é‡Šä¸º Vim å‘½ä»¤ï¼Œæ­¤æ—¶çš„ <code>w</code>  æŒ‡å®šæˆ‘ä»¬å°†ç¼“å†²åŒºçš„æ•°æ®å†™å‡ºã€‚è€Œå‚æ•° <code>!sudo tee %</code> è¢«æ„é€ ä¸ºä¸€ä¸ªä¼ ç»™ Shell çš„å‘½ä»¤å¹¶è¢«æ‰§è¡Œã€‚<code>%</code> åœ¨ Shell è¯­å¢ƒä¸‹åˆè¢« Vim å…·ä½“åŒ–ä¸ºå½“å‰ç¼–è¾‘çš„æ–‡ä»¶åï¼Œäºæ˜¯ Shell ä¼šæ‰§è¡Œ <code>tee</code> å‘½ä»¤ï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®ç®€å•å¤åˆ¶åˆ°æŒ‡å®šçš„æ–‡ä»¶å’Œæ§åˆ¶å°ã€‚</p><p>è¿™ä¸ªåœ¨ Vim ä¸­ç»å¦™çš„å‘½ä»¤èƒŒåçš„åŸç†åŒ…å«äº†å¤šä¸ªçç¢çš„ä¿¡æ¯ï¼Œæ¯ä¸ªéƒ½æ˜¯ç¨‹åºå‘˜åœ¨æ—¥å¤ä¸€æ—¥çš„æ“ä½œä¸­å½¢æˆçš„æœ€ä½³å®è·µã€‚</p><p>æŒæ¡äº†è¿™ä¸ªå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯¹ Vimï¼Œå¯¹ Shellï¼Œå¯¹ Linux æ–‡ä»¶æƒé™ç®¡ç†æœ‰äº†æ›´æ·±ä¸€å±‚çš„ç†è§£ã€‚è¿™ä¹Ÿæ˜¯ Vim ä¸ºä½•å¦‚æ­¤è¿·äººçš„åŸå› ä¹‹ä¸€ï¼Œåœ¨ Vim ä¸­ï¼Œæœ‰ç€æ— æ•°è¿™æ ·çš„å°æŠ€å·§ç­‰ä½ å»å‘æ˜ï¼Œæ­£å¦‚ä¸€ä½å¤§å¸ˆæ›¾ç»è¯´è¿‡ï¼Œâ€œVimå°±åƒä¸€ä¸ªæ— å°½å®è—ï¼Œæ€»æœ‰ä½ æœªæ›¾å‘ç°çš„æ–°ä¸–ç•Œã€‚â€ æ˜¯çš„ï¼Œè¿™æ˜¯æˆ‘åˆšåˆšè¯´çš„ï¼Œå“ˆå“ˆâ€¦â€¦</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdownï¼šè§£æ”¾æ’ç‰ˆï¼Œç®€æ´é«˜æ•ˆçš„æ–‡å­—åˆ›ä½œç¥å™¨ï¼</title>
      <link href="posts/23b678b6.html"/>
      <url>posts/23b678b6.html</url>
      
        <content type="html"><![CDATA[<p>Markdown æ˜¯ä¸€ç§è½»é‡çº§çš„æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨<strong>æ˜“è¯»æ˜“å†™</strong>çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼Œå€ŸåŠ©å¯å®ç°å¿«é€Ÿæ’ç‰ˆä¸”è½¬æ¢æˆæ ¼å¼ä¸°å¯Œçš„ HTML é¡µé¢ã€‚ç›®å‰è¢«è¶Šæ¥è¶Šå¤šçš„å†™ä½œçˆ±å¥½è€…åŠå·¥ä½œè€…ä½¿ç”¨ã€‚å®ƒåœ¨å†™ä½œã€åšå®¢ã€æ–‡æ¡£ç­‰é¢†åŸŸå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œå› å…¶<strong>ç®€æ´ã€æ˜“è¯»ã€æ˜“å†™</strong>çš„ç‰¹ç‚¹è€Œå¤‡å—æ¬¢è¿ï¼Œä¸€æ—¦æŒæ¡è¿™ç§æ ‡è®°è¯­è¨€ï¼Œå°†æå¤§æé«˜æ•ˆç‡ã€‚ä½†æ˜¯è‹¥éœ€è¦å¤æ‚æ’ç‰ˆå¦‚å·¦å³å¯¹é½ç¼©è¿›ç­‰ï¼Œè¿˜æ˜¯é€‰æ‹© word ç­‰ä¸“ä¸šè½¯ä»¶ã€‚</p><p>Markdown ç”¨ç®€æ´çš„è¯­æ³•ä»£æ›¿æ’ç‰ˆï¼Œè€Œä¸åƒå¸¸ç”¨æ–‡å­—å¤„ç†è½¯ä»¶ Word æˆ– Pages ç­‰è¿›è¡Œæ’ç‰ˆã€å­—ä½“ã€æ’å…¥ç­‰è®¾ç½®ã€‚æ ‡è®°è¯­è¨€å¯ä»¥é€šè¿‡é”®ç›˜å³å®ç°å­—ä½“å¤§å°ã€æ’å…¥è¡¨æ ¼ï¼Œå›¾ç‰‡ï¼Œè¶…é“¾æ¥ï¼Œè„šæ³¨ç­‰ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥ä»‹ç» Markdown è¯­æ³•çš„å„ä¸ªæ–¹é¢ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œè¿ç”¨è¿™ä¸€å¼ºå¤§çš„æ–‡æœ¬æ ‡è®°å·¥å…·ã€‚</p><blockquote><p>æ˜¯çš„ï¼Œè¿™ç¯‡æ•™ç¨‹å°±æ˜¯é‡‡ç”¨çš„ markdown è¯­æ³•å†™çš„ã€‚</p></blockquote><h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-Markdown"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-Markdown" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© Markdown"></a>ä¸ºä»€ä¹ˆé€‰æ‹© Markdown</h2><ul><li>æœ€å¤§å¥½å¤„æ˜¯ï¼š<strong>å¿«é€ŸæŒæ¡</strong>ï¼ˆé€šå¸¸è€Œè¨€ï¼Œä½ çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å°±å®Œå…¨æŒæ¡äº†ï¼‰ï¼›</li><li>ç®€å•ï¼Œé€‚åˆæ‰€æœ‰äººç¾¤ï¼Œæ–¹ä¾¿æ‰“å¼€ï¼Œä¸è‡³äºå‡ºç°ä½ç‰ˆæœ¬ word æ‰“ä¸å¼€é«˜ç‰ˆæœ¬ word çš„æ–‡æ¡£ï¼›</li><li>é¿å…è½¯ä»¶ä¸åŒï¼Œå¦‚å¯¹æ–¹æ˜¯ wpsï¼Œçœ‹åˆ°çš„ word æ–‡æ¡£æ•ˆæœå’Œä½ ä¸ä¸€æ ·ï¼›</li><li>æ–¹ä¾¿å¿«é€Ÿæ’ç‰ˆï¼ŒèŠ‚çœæ—¶é—´ï¼›</li><li>è½»æ¾çš„å¯¼å‡ºä¸º HTMLã€PDF æ ¼å¼æˆ–å…¶ä»–æ ¼å¼ï¼›</li><li>çº¯æ–‡æœ¬å†…å®¹ï¼Œå…¼å®¹æ‰€æœ‰çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸æ–‡å­—å¤„ç†è½¯ä»¶ï¼Œå‡ ä¹å¯ä»¥åœ¨æ‰€æœ‰çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ç¼–å†™ï¼›</li><li>æ”¯æŒ Markdown è¯­æ³•çš„ç¼–è¾‘å™¨æœ‰å¾ˆå¤šï¼Œéƒ¨åˆ†ç½‘ç«™ä¹Ÿæ”¯æŒï¼›</li><li>å®ƒåŸºäºçº¯æ–‡æœ¬ï¼Œæ–¹ä¾¿ä¿®æ”¹å’Œå…±äº«ï¼›</li><li>æœ‰ä¼—å¤šç¼–ç¨‹è¯­è¨€çš„å®ç°ï¼Œä»¥åŠåº”ç”¨çš„ç›¸å…³æ‰©å±•ï¼›</li><li>åœ¨ GitHub ç­‰ç½‘ç«™ä¸­æœ‰å¾ˆå¥½çš„åº”ç”¨ï¼›</li><li>é€‚åˆç”¨æ¥ç¼–å†™æ–‡æ¡£ã€è®°å½•ç¬”è®°ã€æ’°å†™æ–‡ç« ã€‚</li></ul><h2 id="Markdownçš„åŸºç¡€è¯­æ³•"><a href="#Markdownçš„åŸºç¡€è¯­æ³•" class="headerlink" title="Markdownçš„åŸºç¡€è¯­æ³•"></a>Markdownçš„åŸºç¡€è¯­æ³•</h2><h3 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h3><p>Markdown æä¾›äº†å…­çº§æ ‡é¢˜ï¼Œé€šè¿‡åœ¨æ–‡æœ¬å‰é¢æ·»åŠ ç›¸åº”æ•°é‡çš„äº•å·<code>#</code>æ¥è¡¨ç¤ºä¸åŒçº§åˆ«çš„æ ‡é¢˜ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> ä¸€çº§æ ‡é¢˜</span><span class="token title important"><span class="token punctuation">##</span> äºŒçº§æ ‡é¢˜</span><span class="token title important"><span class="token punctuation">###</span> ä¸‰çº§æ ‡é¢˜</span><span class="token title important"><span class="token punctuation">####</span> å››çº§æ ‡é¢˜</span><span class="token title important"><span class="token punctuation">#####</span> äº”çº§æ ‡é¢˜</span><span class="token title important"><span class="token punctuation">######</span> å…­çº§æ ‡é¢˜</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ®µè½"><a href="#æ®µè½" class="headerlink" title="æ®µè½"></a>æ®µè½</h3><p>æ®µè½ä¹‹é—´ä½¿ç”¨<strong>ç©ºè¡Œ</strong>è¿›è¡Œåˆ†éš”ã€‚Markdown ä¼šè‡ªåŠ¨è¯†åˆ«æ¢è¡Œï¼Œä½†å¦‚æœéœ€è¦å¼ºåˆ¶æ¢è¡Œï¼Œå¯ä»¥<strong>åœ¨è¡Œæœ«æ·»åŠ ä¸¤ä¸ªç©ºæ ¼ã€‚</strong></p><h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h3><p>Markdown æ”¯æŒæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ã€‚   æœ‰åºåˆ—è¡¨ä½¿ç”¨<strong>æ•°å­—åŠ è‹±æ–‡å¥ç‚¹</strong>ï¼Œæ— åºåˆ—è¡¨ä½¿ç”¨<strong>æ˜Ÿå·</strong>ã€<strong>åŠ å·</strong>æˆ–<strong>å‡å·</strong>ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> æœ‰åºåˆ—è¡¨é¡¹1<span class="token list punctuation">2.</span> æœ‰åºåˆ—è¡¨é¡¹2<span class="token list punctuation">*</span> æ— åºåˆ—è¡¨é¡¹A<span class="token list punctuation">+</span> æ— åºåˆ—è¡¨é¡¹B<span class="token list punctuation">-</span> æ— åºåˆ—è¡¨é¡¹C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p>æ’å…¥è¶…é“¾æ¥çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">é“¾æ¥æ–‡æœ¬</span>](<span class="token url">é“¾æ¥åœ°å€</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">ç‚¹æˆ‘ç›´æ¥è®¿é—®ç™¾åº¦</span>](<span class="token url">https://www.baidu.com</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h3><p>æ’å…¥å›¾ç‰‡çš„è¯­æ³•ä¸é“¾æ¥ç±»ä¼¼ï¼Œåªéœ€åœ¨é“¾æ¥è¯­æ³•å‰åŠ ä¸€ä¸ªæ„Ÿå¹å·ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">å›¾ç‰‡æè¿°</span>](<span class="token url">å›¾ç‰‡åœ°å€</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">æˆ‘çš„åšå®¢å›¾æ ‡</span>](<span class="token url">https://pudongping.github.io/medias/favicon.png</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p>å¼•ç”¨ä»–äººçš„æ–‡å­—å¯ä»¥ä½¿ç”¨å¤§äºå· <code>&gt;</code>ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token blockquote punctuation">&gt;</span> è¿™æ˜¯å¼•ç”¨çš„æ–‡å­—ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ–‡æœ¬æ ¼å¼åŒ–"><a href="#æ–‡æœ¬æ ¼å¼åŒ–" class="headerlink" title="æ–‡æœ¬æ ¼å¼åŒ–"></a>æ–‡æœ¬æ ¼å¼åŒ–</h2><h3 id="ç²—ä½“å’Œæ–œä½“"><a href="#ç²—ä½“å’Œæ–œä½“" class="headerlink" title="ç²—ä½“å’Œæ–œä½“"></a>ç²—ä½“å’Œæ–œä½“</h3><p>è¦ä½¿æ–‡å­—æ˜¾ç¤ºä¸º<strong>ç²—ä½“</strong>ï¼Œå¯ä»¥ä½¿ç”¨<strong>ä¸¤ä¸ªæ˜Ÿå·</strong>ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token bold"><span class="token punctuation">**</span><span class="token content">è¿™æ˜¯ç²—ä½“æ–‡å­—</span><span class="token punctuation">**</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¦ä½¿æ–‡å­—æ˜¾ç¤ºä¸º<em>æ–œä½“</em>ï¼Œå¯ä»¥ä½¿ç”¨<em>ä¸€ä¸ªæ˜Ÿå·</em>ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token italic"><span class="token punctuation">*</span><span class="token content">è¿™æ˜¯æ–œä½“æ–‡å­—</span><span class="token punctuation">*</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½ è¿˜å¯ä»¥ç»„åˆä½¿ç”¨<em><strong>ç²—ä½“å’Œæ–œä½“</strong></em>ï¼Œå¯ä»¥ä½¿ç”¨<em>ä¸‰ä¸ªæ˜Ÿå·</em>ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token bold"><span class="token punctuation">**</span><span class="token content"><span class="token italic"><span class="token punctuation">*</span><span class="token content">è¿™æ˜¯ç²—ä½“åŠ æ–œä½“æ–‡å­—</span><span class="token punctuation">*</span></span></span><span class="token punctuation">**</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åˆ é™¤çº¿"><a href="#åˆ é™¤çº¿" class="headerlink" title="åˆ é™¤çº¿"></a>åˆ é™¤çº¿</h3><p>è¦åœ¨æ–‡å­—ä¸Šæ·»åŠ <del>åˆ é™¤çº¿</del>æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ³¢æµªçº¿ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token strike"><span class="token punctuation">~~</span><span class="token content">è¿™æ˜¯å¸¦åˆ é™¤çº¿çš„æ–‡å­—</span><span class="token punctuation">~~</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»¥ä¸Šæ˜¯ Markdown ä¸­å¸¸ç”¨çš„æ–‡æœ¬æ ¼å¼åŒ–æ–¹æ³•ï¼Œå®ƒä»¬ä½¿æ–‡æœ¬æ›´å…·è¡¨ç°åŠ›å’Œå¯è¯»æ€§ã€‚</p><h2 id="ä»£ç å—å’Œè¡Œå†…ä»£ç "><a href="#ä»£ç å—å’Œè¡Œå†…ä»£ç " class="headerlink" title="ä»£ç å—å’Œè¡Œå†…ä»£ç "></a>ä»£ç å—å’Œè¡Œå†…ä»£ç </h2><h3 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h3><p>è¦æ’å…¥ä»£ç å—ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰ä¸ªåå¼•å·ï¼Œåé¢è·Ÿä¸Šç¼–ç¨‹è¯­è¨€ï¼ˆå¯é€‰ï¼‰ï¼Œç„¶åæ˜¯ä»£ç å†…å®¹ã€‚ä¾‹å¦‚ï¼š</p><p>```go<br>package main</p><p>import (<br>â€œfmtâ€<br>)</p><p>func SayHi() {<br>fmt.Println(â€œHello Alex!â€)<br>}<br>```</p><p>æ˜¾ç¤ºæ•ˆæœï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello Alex!"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸æŒ‡å®šç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‰ä¸ªåå¼•å·ï¼š</p><p>```<br>è¿™æ˜¯æ™®é€šçš„ä»£ç å—<br>å¯ä»¥åŒ…å«å¤šè¡Œä»£ç <br>```</p><h3 id="è¡Œå†…ä»£ç "><a href="#è¡Œå†…ä»£ç " class="headerlink" title="è¡Œå†…ä»£ç "></a>è¡Œå†…ä»£ç </h3><p>è¦åœ¨æ–‡æœ¬ä¸­æ’å…¥è¡Œå†…ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ªåå¼•å·å°†ä»£ç åŒ…è£¹èµ·æ¥ï¼š</p><p>`è¿™æ˜¯è¡Œå†…ä»£ç `</p><p>Markdown çš„ä»£ç å—å’Œè¡Œå†…ä»£ç åŠŸèƒ½ä½¿å¾—å±•ç¤ºå’Œåˆ†äº«ä»£ç å˜å¾—éå¸¸æ–¹ä¾¿ã€‚</p><h2 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h2><h3 id="åˆ›å»ºè¡¨æ ¼çš„è¯­æ³•å’ŒåŸºæœ¬ç»“æ„"><a href="#åˆ›å»ºè¡¨æ ¼çš„è¯­æ³•å’ŒåŸºæœ¬ç»“æ„" class="headerlink" title="åˆ›å»ºè¡¨æ ¼çš„è¯­æ³•å’ŒåŸºæœ¬ç»“æ„"></a>åˆ›å»ºè¡¨æ ¼çš„è¯­æ³•å’ŒåŸºæœ¬ç»“æ„</h3><p>Markdown æ”¯æŒåˆ›å»ºç®€å•çš„è¡¨æ ¼ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> è¡¨å¤´1 </span><span class="token punctuation">|</span><span class="token table-header important"> è¡¨å¤´2 </span><span class="token punctuation">|</span><span class="token table-header important"> è¡¨å¤´3 </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">---</span><span class="token punctuation">|</span><span class="token punctuation">---</span><span class="token punctuation">|</span><span class="token punctuation">---</span><span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> å•å…ƒæ ¼1 </span><span class="token punctuation">|</span><span class="token table-data"> å•å…ƒæ ¼2 </span><span class="token punctuation">|</span><span class="token table-data"> å•å…ƒæ ¼3 </span><span class="token punctuation">|</span><span class="token punctuation">|</span><span class="token table-data"> å•å…ƒæ ¼4 </span><span class="token punctuation">|</span><span class="token table-data"> å•å…ƒæ ¼5 </span><span class="token punctuation">|</span><span class="token table-data"> å•å…ƒæ ¼6 </span><span class="token punctuation">|</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ï¼Œ<code>|</code> ç”¨äºåˆ†éš”ä¸åŒçš„åˆ—ï¼Œè¡¨å¤´ä¸‹çš„åˆ†éš”çº¿ <code>---</code> ç”¨äºåŒºåˆ†è¡¨å¤´å’Œè¡¨æ ¼å†…å®¹ã€‚</p><h3 id="è¡¨æ ¼çš„å¯¹é½å’Œæ ¼å¼è®¾ç½®"><a href="#è¡¨æ ¼çš„å¯¹é½å’Œæ ¼å¼è®¾ç½®" class="headerlink" title="è¡¨æ ¼çš„å¯¹é½å’Œæ ¼å¼è®¾ç½®"></a>è¡¨æ ¼çš„å¯¹é½å’Œæ ¼å¼è®¾ç½®</h3><p>å¯ä»¥é€šè¿‡åœ¨è¡¨å¤´ä¸‹æ–¹çš„<strong>å†’å·ä½ç½®</strong>æ¥è®¾ç½®è¡¨æ ¼ä¸­æ–‡æœ¬çš„å¯¹é½æ–¹å¼ï¼š</p><ul><li>å†’å·åœ¨å·¦ä¾§ï¼šå·¦å¯¹é½</li><li>å†’å·åœ¨å³ä¾§ï¼šå³å¯¹é½</li><li>å†’å·åœ¨ä¸¤ä¾§ï¼šå±…ä¸­å¯¹é½</li></ul><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> å·¦å¯¹é½ </span><span class="token punctuation">|</span><span class="token table-header important"> å±…ä¸­å¯¹é½ </span><span class="token punctuation">|</span><span class="token table-header important"> å³å¯¹é½ </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">:------</span><span class="token punctuation">|</span><span class="token punctuation">:-------:</span><span class="token punctuation">|</span><span class="token punctuation">-------:</span><span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> æ–‡æœ¬1  </span><span class="token punctuation">|</span><span class="token table-data"> æ–‡æœ¬2   </span><span class="token punctuation">|</span><span class="token table-data"> æ–‡æœ¬3  </span><span class="token punctuation">|</span><span class="token punctuation">|</span><span class="token table-data"> æ–‡æœ¬4  </span><span class="token punctuation">|</span><span class="token table-data"> æ–‡æœ¬5   </span><span class="token punctuation">|</span><span class="token table-data"> æ–‡æœ¬6  </span><span class="token punctuation">|</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ•ˆæœï¼š</p><table><thead><tr><th align="left">å·¦å¯¹é½</th><th align="center">å±…ä¸­å¯¹é½</th><th align="right">å³å¯¹é½</th></tr></thead><tbody><tr><td align="left">æ–‡æœ¬1</td><td align="center">æ–‡æœ¬2</td><td align="right">æ–‡æœ¬3</td></tr><tr><td align="left">æ–‡æœ¬4</td><td align="center">æ–‡æœ¬5</td><td align="right">æ–‡æœ¬6</td></tr></tbody></table><p>è¿™æ˜¯ Markdown ä¸­ç®€å•ä½†å®ç”¨çš„è¡¨æ ¼è¯­æ³•ï¼Œèƒ½å¤Ÿæ»¡è¶³æ—¥å¸¸æ–‡æ¡£å’Œåšå®¢çš„æ’ç‰ˆéœ€æ±‚ã€‚</p><h2 id="æ‰©å±•åŠŸèƒ½"><a href="#æ‰©å±•åŠŸèƒ½" class="headerlink" title="æ‰©å±•åŠŸèƒ½"></a>æ‰©å±•åŠŸèƒ½</h2><h3 id="åˆ†éš”çº¿"><a href="#åˆ†éš”çº¿" class="headerlink" title="åˆ†éš”çº¿"></a>åˆ†éš”çº¿</h3><p>è¦æ’å…¥æ°´å¹³åˆ†éš”çº¿ï¼Œå¯ä»¥åœ¨ä¸€è¡Œä¸­ä½¿ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„<strong>æ˜Ÿå·</strong>ã€<strong>å‡å·</strong>æˆ–<strong>ä¸‹åˆ’çº¿</strong>ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important">***<span class="token punctuation">---</span></span>___<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ•ˆæœï¼š</p><hr><p>è¿™å°†åœ¨æ–‡æ¡£ä¸­åˆ›å»ºä¸€æ¡æ°´å¹³çº¿ï¼Œç”¨äºåˆ†éš”ä¸åŒéƒ¨åˆ†çš„å†…å®¹ã€‚</p><h3 id="è½¬ä¹‰å­—ç¬¦"><a href="#è½¬ä¹‰å­—ç¬¦" class="headerlink" title="è½¬ä¹‰å­—ç¬¦"></a>è½¬ä¹‰å­—ç¬¦</h3><p>Markdown ä½¿ç”¨åæ–œæ  <code>\</code> ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿å…¶æ˜¾ç¤ºåŸæœ¬çš„æ„ä¹‰ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">\*è¿™æ˜¯æ™®é€šçš„æ˜Ÿå·\*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸Šè¿°è¯­æ³•å°†æ˜¾ç¤ºä¸ºï¼š*è¿™æ˜¯æ™®é€šçš„æ˜Ÿå·*</p><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>Markdown æ²¡æœ‰åŸç”Ÿæ”¯æŒæ³¨é‡Šçš„è¯­æ³•ï¼Œä½†å¯ä»¥ä½¿ç”¨ HTML çš„æ³¨é‡Šæ ‡ç­¾ï¼Œå¦‚ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token comment">&lt;!-- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š --&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™äº›æ‰©å±•åŠŸèƒ½èƒ½å¤Ÿè¿›ä¸€æ­¥æå‡ Markdown çš„çµæ´»æ€§å’Œé€‚ç”¨æ€§ã€‚</p><h2 id="å®é™…åº”ç”¨ä¸ç¤ºä¾‹"><a href="#å®é™…åº”ç”¨ä¸ç¤ºä¾‹" class="headerlink" title="å®é™…åº”ç”¨ä¸ç¤ºä¾‹"></a>å®é™…åº”ç”¨ä¸ç¤ºä¾‹</h2><p>Markdown çš„ç®€æ´å’Œæ˜“è¯»æ€§ä½¿å…¶åœ¨å„ç§åœºæ™¯ä¸‹éƒ½å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚</p><h3 id="å†™ä½œ"><a href="#å†™ä½œ" class="headerlink" title="å†™ä½œ"></a>å†™ä½œ</h3><p>Markdown éå¸¸é€‚åˆæ’°å†™æ–‡ç« ã€åšå®¢å’Œç¬”è®°ã€‚é€šè¿‡ä½¿ç”¨æ ‡é¢˜ã€åˆ—è¡¨å’Œä»£ç å—ï¼Œå¯ä»¥è½»æ¾åœ°ç»„ç»‡å’Œå±•ç¤ºå†…å®¹ã€‚</p><h3 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h3><p>è®¸å¤šåšå®¢å¹³å°æ”¯æŒ Markdownï¼Œæ¯”å¦‚ï¼š<strong>ç®€ä¹¦</strong>ã€<strong>åšå®¢å›­</strong>ã€<strong>æ€å¦</strong> â€¦â€¦å› ä¸ºå®ƒç®€åŒ–äº†åšå®¢æ–‡ç« çš„ç¼–è¾‘è¿‡ç¨‹ã€‚åˆ›ä½œè€…å¯ä»¥ä¸“æ³¨äºå†…å®¹åˆ›ä½œï¼Œè€Œæ— éœ€è¿‡å¤šå…³æ³¨æ’ç‰ˆã€‚</p><h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><p>è®¸å¤šå¼€å‘è€…ä½¿ç”¨ Markdown æ¥ç¼–å†™æŠ€æœ¯æ–‡æ¡£ã€‚è¡¨æ ¼ã€ä»£ç å—å’Œè¡Œå†…ä»£ç ç­‰åŠŸèƒ½ä½¿å¾—ç¼–å†™å’Œåˆ†äº«æ–‡æ¡£å˜å¾—æ›´åŠ ä¾¿æ·ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Markdown ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ç»„åˆä½¿ç”¨å„ç§å…ƒç´ ï¼š</p><blockquote><p>ä½ å®Œå…¨å¯ä»¥å°†ä»¥ä¸‹å†…å®¹ï¼Œå¤åˆ¶ï¼Œç„¶åç›´æ¥ç²˜è´´åˆ°<strong>ä»»ä½•</strong>ä¸€ä¸ªæ”¯æŒ markdown è¯­æ³•çš„ç¼–è¾‘å¹³å°ä¸Šï¼Œå³å¯çœ‹åˆ°å’Œæˆ‘ä¸€æ¨¡ä¸€æ ·çš„æ’ç‰ˆå†…å®¹ã€‚å†ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œå…±åŒåä½œæ—¶ï¼Œæ–‡æœ¬æ’ç‰ˆé”™ä½çš„å°´å°¬å•¦ï¼</p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> Markdownç¤ºä¾‹</span><span class="token blockquote punctuation">&gt;</span> è¿™é‡Œä»…ä»…æä¾›ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å†…å®¹ï¼Œä»¥ä¾›ä½“éªŒã€‚<span class="token title important"><span class="token punctuation">##</span> åˆ—è¡¨</span><span class="token list punctuation">-</span> é¡¹ç›®1<span class="token list punctuation">-</span> é¡¹ç›®2  <span class="token list punctuation">-</span> å­é¡¹ç›®A  <span class="token list punctuation">-</span> å­é¡¹ç›®B<span class="token title important"><span class="token punctuation">##</span> ä»£ç å—</span>\```pythondef hello_world():    print("Hello, World!")\```<span class="token title important"><span class="token punctuation">##</span> é“¾æ¥</span><span class="token url">[<span class="token content">ç‚¹æˆ‘æ‰“å¼€ç™¾åº¦</span>](<span class="token url">https://www.baidu.com</span>)</span><span class="token title important"><span class="token punctuation">##</span> å›¾ç‰‡</span><span class="token url"><span class="token operator">!</span>[<span class="token content">æˆ‘çš„åšå®¢å›¾æ ‡</span>](<span class="token url">https://pudongping.github.io/medias/favicon.png</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¼–è¾‘å™¨å’Œå·¥å…·"><a href="#ç¼–è¾‘å™¨å’Œå·¥å…·" class="headerlink" title="ç¼–è¾‘å™¨å’Œå·¥å…·"></a>ç¼–è¾‘å™¨å’Œå·¥å…·</h2><h3 id="Markdown-ç¼–è¾‘å™¨"><a href="#Markdown-ç¼–è¾‘å™¨" class="headerlink" title="Markdown ç¼–è¾‘å™¨"></a>Markdown ç¼–è¾‘å™¨</h3><p>æœ‰è®¸å¤šç¼–è¾‘å™¨ä¸“é—¨æ”¯æŒ Markdown è¯­æ³•ï¼Œæä¾›æ›´å¥½çš„ç¼–è¾‘ä½“éªŒå’Œé¢„è§ˆæ•ˆæœã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Markdown ç¼–è¾‘å™¨ï¼š</p><ul><li><strong>æœ‰é“äº‘ç¬”è®°</strong>ï¼šè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ç”¨äº†å¥½å‡ å¹´çš„äº‘ç¬”è®°è½¯ä»¶ï¼Œæœ‰å¤§å‚èƒŒä¹¦ï¼Œå¯é ç¨³å®šã€‚</li><li><strong>è¯­é›€</strong>ï¼šé˜¿é‡Œæ¨å‡ºçš„ä¸€æ¬¾äº‘ç¬”è®°è½¯ä»¶ï¼Œå±äºåèµ·ä¹‹ç§€ï¼Œmarkdown æ‰€è§æ‰€å¾—éƒ½æ”¯æŒçš„å¾ˆå¥½ã€‚</li><li><strong>Visual Studio Code</strong>: å¼ºå¤§çš„ä»£ç ç¼–è¾‘å™¨ï¼Œå†…ç½® Markdown æ”¯æŒï¼Œå¹¶æœ‰ä¸°å¯Œçš„æ‰©å±•æ’ä»¶ã€‚</li><li><strong>Typora</strong>: ä¸“æ³¨äº Markdown ç¼–è¾‘çš„æ‰€è§å³æ‰€å¾—ç¼–è¾‘å™¨ï¼Œç•Œé¢ç®€æ´æ˜“ç”¨ã€‚</li><li><strong>Atom</strong>: å¼€æºçš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå…·æœ‰ä¸°å¯Œçš„ç¤¾åŒºæ’ä»¶ï¼Œæ”¯æŒ Markdown ç¼–è¾‘ã€‚</li></ul><h3 id="åœ¨çº¿å·¥å…·"><a href="#åœ¨çº¿å·¥å…·" class="headerlink" title="åœ¨çº¿å·¥å…·"></a>åœ¨çº¿å·¥å…·</h3><p>å¦‚æœä½ ä¸æƒ³ä¸‹è½½å®‰è£…ç¼–è¾‘å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨çº¿çš„ Markdown ç¼–è¾‘å·¥å…·ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>Dillinger</strong>: åœ¨çº¿ Markdown ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆï¼Œæ— éœ€æ³¨å†Œã€‚ ä½“éªŒåœ°å€ï¼š<code>https://dillinger.io/</code></li><li><strong>StackEdit</strong>: æä¾›ç¦»çº¿ç¼–è¾‘å’Œäº‘åŒæ­¥åŠŸèƒ½ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚ä½“éªŒåœ°å€ï¼š<code>https://stackedit.io/</code></li><li><strong>ç®€ä¹¦</strong>ï¼šç®—æ˜¯æˆ‘æ¯”è¾ƒå–œæ¬¢çš„åœ¨çº¿å†™ä½œå¹³å°äº†ï¼Œç½‘ç«™æ’ç‰ˆç®€æ´å¤§æ°”ï¼Œä¸“æ³¨å†…å®¹è¾“å‡ºã€‚ä½“éªŒåœ°å€ï¼š<code>https://jianshu.com/</code></li></ul><h2 id="æ³¨æ„äº‹é¡¹å’Œå¸¸è§é—®é¢˜"><a href="#æ³¨æ„äº‹é¡¹å’Œå¸¸è§é—®é¢˜" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œå¸¸è§é—®é¢˜"></a>æ³¨æ„äº‹é¡¹å’Œå¸¸è§é—®é¢˜</h2><p>åœ¨ä½¿ç”¨ Markdown æ—¶ï¼Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹å’Œå¸¸è§é—®é¢˜éœ€è¦æ³¨æ„ï¼š</p><h3 id="æ–‡æœ¬ç¼–è¾‘å™¨çš„å·®å¼‚"><a href="#æ–‡æœ¬ç¼–è¾‘å™¨çš„å·®å¼‚" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘å™¨çš„å·®å¼‚"></a>æ–‡æœ¬ç¼–è¾‘å™¨çš„å·®å¼‚</h3><p>ä¸åŒçš„æ–‡æœ¬ç¼–è¾‘å™¨<strong>å¯èƒ½</strong>å¯¹ Markdown çš„æ¸²æŸ“ç»“æœæœ‰è½»å¾®çš„å·®å¼‚ã€‚åœ¨å‘å¸ƒå‰ï¼Œå»ºè®®åœ¨ä¸åŒçš„ç¼–è¾‘å™¨ä¸­é¢„è§ˆï¼Œç¡®ä¿æœ€ç»ˆæ•ˆæœç¬¦åˆé¢„æœŸã€‚ä½†æ˜¯ä¸€èˆ¬è€Œè¨€ï¼Œå·®å¼‚ä¸ä¼šå¾ˆå¤§ã€‚</p><h3 id="å›¾ç‰‡è·¯å¾„é—®é¢˜"><a href="#å›¾ç‰‡è·¯å¾„é—®é¢˜" class="headerlink" title="å›¾ç‰‡è·¯å¾„é—®é¢˜"></a>å›¾ç‰‡è·¯å¾„é—®é¢˜</h3><p>å½“æ’å…¥å›¾ç‰‡æ—¶ï¼Œç¡®ä¿å›¾ç‰‡è·¯å¾„æ˜¯æ­£ç¡®çš„ã€‚ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„éƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†éœ€è¦æ³¨æ„æ–‡ä»¶ç»“æ„å’Œä½ç½®ã€‚</p><h3 id="æ’ç‰ˆçš„ä¸€è‡´æ€§"><a href="#æ’ç‰ˆçš„ä¸€è‡´æ€§" class="headerlink" title="æ’ç‰ˆçš„ä¸€è‡´æ€§"></a>æ’ç‰ˆçš„ä¸€è‡´æ€§</h3><p>ä¸ºäº†ä¿æŒæ–‡æ¡£çš„ä¸€è‡´æ€§ï¼Œå»ºè®®åœ¨æ’ç‰ˆæ—¶ä½¿ç”¨ç›¸åŒçš„æ ‡å‡†ã€‚ä¾‹å¦‚ï¼Œç»Ÿä¸€ä½¿ç”¨ç›¸åŒæ•°é‡çš„ç©ºæ ¼ç¼©è¿›ä»£ç å—ï¼Œé¿å…å‡ºç°æ’ç‰ˆæ··ä¹±çš„æƒ…å†µã€‚</p><h3 id="ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†"><a href="#ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†"></a>ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†</h3><p>æœ‰äº›ç‰¹æ®Šå­—ç¬¦å¯èƒ½åœ¨ Markdown ä¸­å…·æœ‰ç‰¹æ®Šçš„æ„ä¹‰ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºåŸæœ¬çš„å­—ç¬¦ï¼Œè¯·ä½¿ç”¨<strong>è½¬ä¹‰å­—ç¬¦</strong>ï¼ˆåæ–œæ ï¼‰è¿›è¡Œå¤„ç†ã€‚</p><hr><p>é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œæˆ‘ä»¬äº†è§£äº† Markdown çš„åŸºç¡€è¯­æ³•å’Œä¸€äº›é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€åˆ—è¡¨ã€é“¾æ¥ã€å›¾ç‰‡ã€ä»£ç å—ã€è¡¨æ ¼ç­‰ã€‚Markdownä»¥å…¶ç®€æ´ã€ç›´è§‚çš„è¯­æ³•ï¼Œå¹¿æ³›åº”ç”¨äºå†™ä½œã€åšå®¢ã€æ–‡æ¡£ç­‰é¢†åŸŸã€‚</p><p>æ€»ä½“è€Œè¨€ï¼ŒMarkdown æ˜¯ä¸€ç§<strong>å¼ºå¤§è€Œçµæ´»</strong>çš„æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œä½¿å¾—æ–‡æœ¬ç¼–è¾‘å˜å¾—æ›´åŠ è½»æ¾å’Œæ„‰å¿«ã€‚å®ƒä¸ä»…é€‚ç”¨äºä¸ªäººå†™ä½œï¼Œä¹Ÿæ˜¯å›¢é˜Ÿåä½œå’ŒæŠ€æœ¯æ–‡æ¡£ç¼–å†™çš„ç†æƒ³é€‰æ‹©ã€‚</p><p>åœ¨é€‰æ‹©ç¼–è¾‘å™¨æ—¶ï¼Œå¯ä»¥æ ¹æ®ä¸ªäººçš„å–œå¥½å’Œéœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼ŒåŒæ—¶æ³¨æ„åœ¨ä¸åŒç¼–è¾‘å™¨ä¹‹é—´çš„æ¸²æŸ“å·®å¼‚ã€‚ä½¿ç”¨ Markdown æ—¶ï¼Œè¿˜è¦ç•™æ„ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¦‚æ’ç‰ˆä¸€è‡´æ€§ã€å›¾ç‰‡è·¯å¾„å’Œç‰¹æ®Šå­—ç¬¦çš„å¤„ç†ã€‚</p><p>Markdown çš„å­¦ä¹ å’Œåº”ç”¨å¯ä»¥æé«˜æ–‡æœ¬ç¼–è¾‘çš„æ•ˆç‡ï¼ŒåŒæ—¶ä¸ºç”¨æˆ·æä¾›äº†æ›´å¥½çš„å†™ä½œå’Œå±•ç¤ºä½“éªŒã€‚è‡³å°‘ï¼Œå½“æˆ‘ä½¿ç”¨äº† markdown ä¹‹åï¼Œæˆ‘åšç¬”è®°ã€å†™åšå®¢ã€å†™æ–‡ç« éƒ½æ²¡èƒ½ç¦»å¼€å®ƒã€‚</p><p>å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°æŒæ¡ Markdownï¼Œè®©ä½ åœ¨æ–‡æœ¬ç¼–è¾‘çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æ‘¸æ‰‹æ•™ä½ å®‰è£… Redis</title>
      <link href="posts/b76f1d2.html"/>
      <url>posts/b76f1d2.html</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…-Redis"><a href="#å®‰è£…-Redis" class="headerlink" title="å®‰è£… Redis"></a>å®‰è£… Redis</h1><ul><li><a href="https://redis.io/">rediså®˜ç½‘</a></li><li><a href="https://www.redis.net.cn/">redis ä¸­æ–‡ç½‘</a></li><li><a href="http://redisdoc.com/">Redis å‘½ä»¤å‚è€ƒ</a></li></ul><h2 id="Redis-çš„ä¼˜ç‚¹"><a href="#Redis-çš„ä¼˜ç‚¹" class="headerlink" title="Redis çš„ä¼˜ç‚¹"></a>Redis çš„ä¼˜ç‚¹</h2><ol><li>ç®€å•çš„ key-value å­˜å‚¨ï¼Œæ€§èƒ½æé«˜ã€‚</li><li>Redis æ‹¥æœ‰æ›´å¤šçš„æ•°æ®ç»“æ„å’Œå¹¶æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œã€‚</li><li>Redis æ”¯æŒæ•°æ®æŒä¹…åŒ–å’Œæ•°æ®æ¢å¤ã€‚</li><li>Redis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚</li><li>æœåŠ¡å™¨æ”¯æŒ AUTH å¯†ç éªŒè¯ã€‚</li></ol><h2 id="Ubuntu-ä¸‹å®‰è£…-Redis"><a href="#Ubuntu-ä¸‹å®‰è£…-Redis" class="headerlink" title="Ubuntu ä¸‹å®‰è£… Redis"></a>Ubuntu ä¸‹å®‰è£… Redis</h2><ul><li>å®‰è£…å‘½ä»¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›´æ–°æœ¬åœ°æº</span><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token comment"># å®‰è£… Redis æœåŠ¡ç«¯</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> redis-server<span class="token comment"># å®‰è£… php-redis æ‰©å±•ç¨‹åº</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨ Redis</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹ Redis æ˜¯å¦å¯åŠ¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»¥ä¸Šå‘½ä»¤å°†æ‰“å¼€ä»¥ä¸‹ç»ˆç«¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>127.0.0.1 æ˜¯æœ¬æœº IP ï¼Œ6379 æ˜¯ redis æœåŠ¡ç«¯å£ã€‚ç°åœ¨æˆ‘ä»¬è¾“å…¥ PING å‘½ä»¤ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>PONG<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¯æ˜å·²ç»æˆåŠŸå®‰è£… Redisï¼</p><h3 id="redis-è¿æ¥æ–¹å¼"><a href="#redis-è¿æ¥æ–¹å¼" class="headerlink" title="redis è¿æ¥æ–¹å¼"></a>redis è¿æ¥æ–¹å¼</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">-h</span> <span class="token punctuation">{</span>host<span class="token punctuation">}</span> <span class="token parameter variable">-p</span> <span class="token punctuation">{</span>port<span class="token punctuation">}</span> <span class="token parameter variable">-a</span> <span class="token punctuation">{</span>password<span class="token punctuation">}</span><span class="token comment"># egï¼š</span>redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token parameter variable">-a</span> <span class="token string">"mypass"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨å®‰è£…åŒ…ç¼–è¯‘å®‰è£…"><a href="#ä½¿ç”¨å®‰è£…åŒ…ç¼–è¯‘å®‰è£…" class="headerlink" title="ä½¿ç”¨å®‰è£…åŒ…ç¼–è¯‘å®‰è£…"></a>ä½¿ç”¨å®‰è£…åŒ…ç¼–è¯‘å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://download.redis.io/releases/redis-5.0.4.tar.gz<span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> redis-4.0.9.tar.gz<span class="token builtin class-name">cd</span> redis-4.0.9/ll<span class="token function">make</span><span class="token comment"># ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆ 6.2.1</span><span class="token function">wget</span> https://download.redis.io/releases/redis-6.2.1.tar.gz<span class="token function">tar</span> xzf redis-6.2.1.tar.gz<span class="token builtin class-name">cd</span> redis-6.2.1<span class="token function">make</span><span class="token comment"># å¯åŠ¨ redis æœåŠ¡ç«¯</span>src/redis-erver<span class="token comment"># ä½¿ç”¨ redis å®¢æˆ·ç«¯ä½œä¸ºæµ‹è¯•</span>src/redis-cli æˆ–è€… <span class="token builtin class-name">cd</span> src <span class="token operator">&amp;&amp;</span> ./redis-cli<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…-phpredis-æ‰©å±•"><a href="#å®‰è£…-phpredis-æ‰©å±•" class="headerlink" title="å®‰è£… phpredis æ‰©å±•"></a>å®‰è£… phpredis æ‰©å±•</h2><blockquote><p>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://learnku.com/articles/33412">Homestead å®‰è£… PHP Redis æ‰©å±•</a></p></blockquote><ol><li>ä¸‹è½½ phpredis æºä»£ç </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~ <span class="token operator">&amp;&amp;</span> <span class="token function">git</span> clone https://github.com/phpredis/phpredis.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>ä»æºç ç¼–è¯‘å®‰è£…</li></ol><blockquote><p>ubuntu æ²¡æœ‰å®‰è£… phpize å¯æ‰§è¡Œå‘½ä»¤ï¼šsudo apt-get install php-dev æ¥å®‰è£… phpize</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/phpredis <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>phpize <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>./configure <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æŸ¥çœ‹ <code>php.ini</code> æ–‡ä»¶ç»å¯¹è·¯å¾„</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php <span class="token parameter variable">-i</span> <span class="token operator">|</span> <span class="token function">grep</span> php.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>éœ€è¦åœ¨ <code>php.ini</code> ä¸­åŠ å…¥ä¸€è¡Œ <code>extension=redis.so</code> æ¥å¯ç”¨ <code>redis</code> æ‰©å±•</li><li>é‡å¯ php æœåŠ¡</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æœ¬äººä½¿ç”¨çš„æ˜¯ ubuntu18.04ï¼Œphp ç‰ˆæœ¬ä¸º 7.2</span><span class="token function">service</span> php7.2-fpm status<span class="token function">service</span> php7.2-fpm restart<span class="token comment"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸäº† redis æ‰©å±•</span>php <span class="token parameter variable">-m</span> <span class="token operator">|</span> <span class="token function">grep</span> redis<span class="token comment"># æŸ¥çœ‹æ‰©å±•æ‰€åœ¨ç›®å½•</span>php <span class="token parameter variable">-i</span> <span class="token operator">|</span> <span class="token function">grep</span> extension_dir<span class="token comment"># å®‰è£…å®Œæ¯•çš„ redis.so æ‰©å±•æ–‡ä»¶åœ¨ /usr/lib/php/20170718/ ç›®å½•ä¸‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis é«˜é¢‘å¸¸ç”¨å‘½ä»¤åˆ—è¡¨</title>
      <link href="posts/d7e52b6f.html"/>
      <url>posts/d7e52b6f.html</url>
      
        <content type="html"><![CDATA[<h1 id="Redis-çš„æ•°æ®ç±»å‹"><a href="#Redis-çš„æ•°æ®ç±»å‹" class="headerlink" title="Redis çš„æ•°æ®ç±»å‹"></a>Redis çš„æ•°æ®ç±»å‹</h1><h2 id="redis-cli-å‘½ä»¤"><a href="#redis-cli-å‘½ä»¤" class="headerlink" title="redis-cli å‘½ä»¤"></a>redis-cli å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>cli å‘½ä»¤ç¤ºä¾‹</th></tr></thead><tbody><tr><td>del</td><td>åˆ é™¤ key</td><td>del key_name</td></tr><tr><td>exists</td><td>æ£€æŸ¥ç»™å®š key æ˜¯å¦å­˜åœ¨</td><td>exists key_name</td></tr><tr><td>keys</td><td>æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼ pattern çš„ key</td><td>keys pattern</td></tr><tr><td>type</td><td>è¿”å› key æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹</td><td>type key_name</td></tr><tr><td>expire</td><td>è®¾ç½® key çš„è¿‡æœŸæ—¶é—´</td><td>expire key_name time_in_seconds</td></tr><tr><td>ttl</td><td>è¿”å› key çš„å‰©ä½™è¿‡æœŸæ—¶é—´</td><td>ttl key_name</td></tr><tr><td>save</td><td>RDB æŒä¹…åŒ–</td><td>save</td></tr><tr><td>info</td><td>Redis æœåŠ¡å™¨çš„å„ç§ä¿¡æ¯å’Œç»Ÿè®¡æ•°å€¼</td><td>inro [section]</td></tr><tr><td>shutdown</td><td>ä¿å­˜å¹¶åœæ­¢æ‰€æœ‰å®¢æˆ·ç«¯</td><td>shutdown [nosave] [save]</td></tr><tr><td>flushall</td><td>æ¸…ç©ºæ•´ä¸ª redis æœåŠ¡å™¨çš„æ•°æ®</td><td>flushall</td></tr><tr><td>flushdb</td><td>æ¸…ç©ºå½“å‰åº“ä¸­æ‰€æœ‰çš„ key</td><td>flushdb</td></tr><tr><td>select</td><td>åˆ‡æ¢åˆ°æŒ‡å®šçš„æ•°æ®åº“</td><td>select db_number</td></tr></tbody></table><h2 id="Redis-å­—æ®µç±»å‹"><a href="#Redis-å­—æ®µç±»å‹" class="headerlink" title="Redis å­—æ®µç±»å‹"></a>Redis å­—æ®µç±»å‹</h2><ul><li>å­—ç¬¦ä¸² String</li><li>æ•£åˆ—/å“ˆå¸Œ Hash</li><li>åˆ—è¡¨ List</li><li>æ— åºé›†åˆ Set</li><li>å¯æ’åºé›†åˆ Zset</li></ul><h3 id="å­—ç¬¦ä¸²-String"><a href="#å­—ç¬¦ä¸²-String" class="headerlink" title="å­—ç¬¦ä¸² String"></a>å­—ç¬¦ä¸² String</h3><blockquote><p>æœ€å¤§å®¹é‡ä¸º 512M</p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>Cli å‘½ä»¤ç¤ºä¾‹</th><th>PHP å†™æ³•</th></tr></thead><tbody><tr><td>set</td><td>èµ‹å€¼</td><td>set key value</td><td>$redis-&gt;set(â€˜keyâ€™, â€˜valueâ€™);</td></tr><tr><td>setex</td><td>èµ‹å€¼å¹¶æ·»åŠ è¿‡æœŸæ—¶é—´</td><td>setex key expire value</td><td>$redis-&gt;setex(â€˜keyâ€™, â€˜expireâ€™, â€˜valueâ€™);</td></tr><tr><td>get</td><td>å–å€¼</td><td>get key</td><td>$redis-&gt;get(â€˜keyâ€™);</td></tr><tr><td>incr</td><td>é€’å¢æ•°å­—</td><td>incr key</td><td>$redis-&gt;incr(â€˜int_keyâ€™);</td></tr><tr><td>incrby</td><td>å¢åŠ æŒ‡å®šçš„æ•°å­—</td><td>incrby key increment</td><td>$redis-&gt;incrBy(â€˜int_keyâ€™, number);</td></tr><tr><td>decr</td><td>é€’å‡æ•°å­—</td><td>decr key</td><td>$redis-&gt;decr(â€˜key1â€™);</td></tr><tr><td>decrby</td><td>å‡å°‘æŒ‡å®šçš„æ•°å­—</td><td>decrby key decrement</td><td>$redis-&gt;decrBy(â€˜key1â€™, number);</td></tr><tr><td>incrbyfloat</td><td>å¢åŠ æŒ‡å®šæµ®ç‚¹æ•°</td><td>incrbyfloat key increment</td><td>$redis-&gt;incrByFloat(â€˜key1â€™, 1.5);</td></tr><tr><td>append</td><td>å‘å°¾éƒ¨è¿½åŠ å€¼</td><td>append key value</td><td>$redis-&gt;append(â€˜keyâ€™, â€˜value2â€™);</td></tr><tr><td>strlen</td><td>è·å–å­—ç¬¦ä¸²é•¿åº¦</td><td>strlen key</td><td>$redis-&gt;strlen(â€˜keyâ€™);</td></tr><tr><td>mset</td><td>åŒæ—¶è®¾ç½®å¤šä¸ª key çš„å€¼</td><td>mset key1 value1 [key2 value2 â€¦]</td><td>$redis-&gt;mSet(array(â€˜key0â€™ =&gt; â€˜value0â€™, â€˜key1â€™ =&gt; â€˜value1â€™));</td></tr><tr><td>mget</td><td>åŒæ—¶è·å–å¤šä¸ª key çš„å€¼</td><td>mget key1 [key2 â€¦]</td><td>$redis-&gt;mGet(array(â€˜key1â€™, â€˜key2â€™, â€˜key3â€™));</td></tr></tbody></table><h3 id="æ•£åˆ—-å“ˆå¸Œ-Hash"><a href="#æ•£åˆ—-å“ˆå¸Œ-Hash" class="headerlink" title="æ•£åˆ—/å“ˆå¸Œ Hash"></a>æ•£åˆ—/å“ˆå¸Œ Hash</h3><blockquote><p>1ã€ä¸ php çš„ array ç›¸ä¼¼ï¼›2ã€å¯ä»¥ä¿å­˜å¤šä¸ª key-value å¯¹ï¼Œæ¯ä¸ª k-v éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼›3ã€æœ€å¤š 2^32-1 ä¸ªå­—æ®µã€‚</p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>Cli å‘½ä»¤ç¤ºä¾‹</th><th>PHP å†™æ³•</th></tr></thead><tbody><tr><td>hset</td><td>èµ‹å€¼</td><td>hset key field value</td><td>$redis-&gt;hSet(key, field, value);</td></tr><tr><td>hmset</td><td>èµ‹å€¼å¤šä¸ªå­—æ®µ</td><td>hmset key field1 value1 [field2 values]</td><td>$redis-&gt;hMset(key, array(â€˜field1â€™ =&gt; â€˜value1â€™, â€˜field2â€™ =&gt; â€˜value2â€™));</td></tr><tr><td>hget</td><td>å–å€¼</td><td>hset key field</td><td>$redis-&gt;hGet(key, field);</td></tr><tr><td>hmget</td><td>å–å¤šä¸ªå­—æ®µçš„å€¼</td><td>hmset key field1 [field2]</td><td>$redis-&gt;hmGet(key, array(â€˜field1â€™, â€˜field2â€™));</td></tr><tr><td>hgetall</td><td>å–æ‰€æœ‰å­—æ®µçš„å€¼</td><td>hgetall key</td><td>$redis-&gt;hGetAll(key);</td></tr><tr><td>hlen</td><td>è·å–å­—æ®µçš„æ•°é‡</td><td>hlen key</td><td>$redis-&gt;hLen(key);</td></tr><tr><td>hexists</td><td>åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</td><td>hexists key field</td><td>$redis-&gt;hExists(key, field);</td></tr><tr><td>hsetnx</td><td>å½“å­—æ®µä¸å­˜åœ¨æ—¶èµ‹å€¼</td><td>hsetnx key field value</td><td>$redis-&gt;hSetNx(key, field, value);</td></tr><tr><td>hincrby</td><td>å¢åŠ æ•°å­—</td><td>hincrby key field increment</td><td>$redis-&gt;hIncrBy(key, field, num);</td></tr><tr><td>hdel</td><td>åˆ é™¤å­—æ®µ</td><td>hdel key field</td><td>$redis-&gt;hDel(key, field);</td></tr><tr><td>hkeys</td><td>è·å–æ‰€æœ‰å­—æ®µå</td><td>hkeys key</td><td>$redis-&gt;hKeys(key);</td></tr><tr><td>hvals</td><td>è·å–æ‰€æœ‰å­—æ®µå€¼</td><td>hvals key</td><td>$redis-&gt;hVals(key);</td></tr></tbody></table><h3 id="åˆ—è¡¨-List"><a href="#åˆ—è¡¨-List" class="headerlink" title="åˆ—è¡¨ List"></a>åˆ—è¡¨ List</h3><blockquote><p>1ã€å®ç°æ–¹å¼ä¸ºåŒå‘é“¾è¡¨ï¼›2ã€ç”¨äºå­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼›3ã€ä»é˜Ÿåˆ—ä¸¤ç«¯æ·»åŠ å’Œå¼¹å‡ºå…ƒç´ ï¼›4ã€ç‰¹åˆ«é€‚åˆäºåšæ¶ˆæ¯é˜Ÿåˆ—ã€‚</p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>Cli å‘½ä»¤ç¤ºä¾‹</th><th>PHP å†™æ³•</th></tr></thead><tbody><tr><td>lpush</td><td>å‘åˆ—è¡¨å·¦ç«¯æ·»åŠ å…ƒç´ </td><td>lpush key value</td><td>$redis-&gt;lPush(key, value);</td></tr><tr><td>rpush</td><td>å‘åˆ—è¡¨å³ç«¯æ·»åŠ å…ƒç´ </td><td>rpush key value</td><td>$redis-&gt;rPush(key, value);</td></tr><tr><td>lpop</td><td>ä»åˆ—è¡¨å·¦ç«¯å¼¹å‡ºå…ƒç´ </td><td>lpop key</td><td>$redis-&gt;lPop(key);</td></tr><tr><td>rpop</td><td>ä»åˆ—è¡¨å³ç«¯å¼¹å‡ºå…ƒç´ </td><td>rpop key</td><td>$redis-&gt;rPop(key);</td></tr><tr><td>llen</td><td>è·å–åˆ—è¡¨ä¸­å…ƒç´ ä¸ªæ•°</td><td>llen key</td><td>$redis-&gt;lSize(key);</td></tr><tr><td>lrange</td><td>è·å–åˆ—è¡¨ä¸­æŸä¸€ç‰‡æ®µçš„å…ƒç´ </td><td>lrange key start stop</td><td>$redis-&gt;lRange(key, start, end);</td></tr><tr><td>lrem</td><td>åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šçš„å€¼</td><td>lrem key count value</td><td>$redis-&gt;lRem(key, value, count);</td></tr><tr><td>lindex</td><td>è·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼</td><td>lindex key index</td><td>$redis-&gt;lGet(key, index);</td></tr><tr><td>lset</td><td>è®¾ç½®æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼</td><td>lset key index value</td><td>$redis-&gt;lSet(key, index, value);</td></tr><tr><td>ltrim</td><td>å€¼ä¿ç•™åˆ—è¡¨æŒ‡å®šç‰‡æ®µ</td><td>ltrim key start stop</td><td>$redis-&gt;lTrim(key, start, end);</td></tr><tr><td>linsert</td><td>å‘åˆ—è¡¨ä¸­æ’å…¥å…ƒç´ </td><td>linsert key before/after existing_value value</td><td>$redis-&gt;lInsert(key, Redis::BEFORE, existing_value, value);</td></tr></tbody></table><h3 id="æ— åºé›†åˆ-Set"><a href="#æ— åºé›†åˆ-Set" class="headerlink" title="æ— åºé›†åˆ Set"></a>æ— åºé›†åˆ Set</h3><blockquote><p>1ã€é›†åˆä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸åŒçš„ï¼›2ã€å…ƒç´ æœ€å¤šä¸º 2^32-1ï¼›3ã€å…ƒç´ æ²¡æœ‰é¡ºåº</p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>Cli å‘½ä»¤ç¤ºä¾‹</th><th>PHP å†™æ³•</th></tr></thead><tbody><tr><td>sadd</td><td>æ·»åŠ å…ƒç´ </td><td>sadd key value1 [value2 value3 â€¦]</td><td>$redis-&gt;sAdd(â€˜key1â€™, â€˜set1â€™);</td></tr><tr><td>srem</td><td>åˆ é™¤å…ƒç´ </td><td>srem key value2 [value2 value3 â€¦]</td><td>$redis-&gt;sRem(â€˜keyâ€™, â€˜set2â€™);</td></tr><tr><td>smembers</td><td>è·å¾—é›†åˆä¸­æ‰€æœ‰å…ƒç´ </td><td>smembers key</td><td>$redis-&gt;sMembers(â€˜keyâ€™);</td></tr><tr><td>sismember</td><td>åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</td><td>sismember key value</td><td>$redis-&gt;slsMember(key, value);</td></tr><tr><td>sdiff</td><td>å¯¹é›†åˆåšå·®é›†è¿ç®—</td><td>sdiff key1 key2 [key3 â€¦]</td><td>$redis-&gt;sDiff(key1, key2, key3);</td></tr><tr><td>sinter</td><td>å¯¹é›†åˆåšäº¤é›†è¿ç®—</td><td>sinter key1 key2 [key3 â€¦]</td><td>$redis-&gt;sInter(â€˜key1â€™, â€˜key2â€™, â€˜key3â€™);</td></tr><tr><td>sunion</td><td>å¯¹é›†åˆåšå¹¶é›†è¿ç®—</td><td>sunion key1 key2 [key3 â€¦]</td><td>$redis-&gt;sUnion(â€˜key1â€™, â€˜key2â€™, â€˜key3â€™);</td></tr><tr><td>scard</td><td>è·å¾—é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°</td><td>scard key</td><td>$redis-&gt;sCard(â€˜key1â€™);</td></tr><tr><td>sdiffstore</td><td>å¯¹é›†åˆåšå·®é›†è¿ç®—å¹¶å°†ç»“æœå­˜å‚¨</td><td>sdiffstore destination key1 key2 [key3 â€¦]</td><td>$redis-&gt;sDiffStore(â€˜outputâ€™, key1, key2, key3);</td></tr><tr><td>sinterstore</td><td>å¯¹é›†åˆåšäº¤é›†è¿ç®—å¹¶å°†ç»“æœå­˜å‚¨</td><td>sinterstore destination key1 key2 [key3 â€¦]</td><td>$redis-&gt;sInterStore(â€˜outputâ€™, â€˜key1â€™, â€˜key2â€™, â€˜key3â€™);</td></tr><tr><td>sunionstore</td><td>å¯¹é›†åˆåšå¹¶é›†è¿ç®—å¹¶å°†ç»“æœå­˜å‚¨</td><td>sunionstore destination key1 key2 [key3 â€¦]</td><td>$redis-&gt;sUnionStore(â€˜outputâ€™, â€˜key1â€™, â€˜key2â€™, â€˜key3â€™);</td></tr><tr><td>srandmember</td><td>éšæœºè·å–é›†åˆä¸­çš„å…ƒç´ </td><td>srandmember key [count]</td><td>$redis-&gt;sRandMember(â€˜key1â€™, 2);</td></tr><tr><td>spop</td><td>éšæœºå¼¹å‡ºä¸€ä¸ªå…ƒç´ </td><td>spop key</td><td>$redis-&gt;sPop(â€˜key1â€™);</td></tr></tbody></table><h3 id="å¯æ’åºé›†åˆ-Zset"><a href="#å¯æ’åºé›†åˆ-Zset" class="headerlink" title="å¯æ’åºé›†åˆ Zset"></a>å¯æ’åºé›†åˆ Zset</h3><blockquote><p>1ã€é›†åˆæ˜¯æœ‰åºçš„ï¼›2ã€æ”¯æŒæ’å…¥ï¼Œåˆ é™¤ï¼Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼›3ã€å¯ä»¥è·å–åˆ†æ•°æœ€é«˜/æœ€ä½çš„å‰ N ä¸ªå…ƒç´ ã€‚</p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>Cli å‘½ä»¤ç¤ºä¾‹</th><th>PHP å†™æ³•</th></tr></thead><tbody><tr><td>zadd</td><td>æ·»åŠ å…ƒç´ </td><td>zadd key score1 value1 [score2 value2 score3 value3 â€¦]</td><td>$redis-&gt;zAdd(â€˜keyâ€™, 1, â€˜val1â€™);</td></tr><tr><td>zscore</td><td>è·å–å…ƒç´ çš„åˆ†æ•°</td><td>zscore key value</td><td>$redis-&gt;zScore(key, val2);</td></tr><tr><td>zrange</td><td>è·å–æ­£åºæ’ååœ¨æŸç´¢å¼•åŒºé—´èŒƒå›´çš„å…ƒç´ </td><td>zrange key start stop [withscore]</td><td>$redis-&gt;zRange(â€˜key1â€™, 0, -1);</td></tr><tr><td>zrevrange</td><td>è·å–å€’åºæ’ååœ¨æŸç´¢å¼•åŒºé—´èŒƒå›´çš„å…ƒç´ </td><td>zrevrange key start stop [withscore]</td><td>$redis-&gt;zRevRange(â€˜key1â€™, 0, -1);</td></tr><tr><td>zrangebyscore</td><td>è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ </td><td>zrangebyscore key min max</td><td>$redis-&gt;zRangeByScore(key, start, end, array(withscores, limit));</td></tr><tr><td>zincrby</td><td>å¢åŠ æŸä¸ªå…ƒç´ çš„åˆ†æ•°</td><td>zcard key</td><td>$redis-&gt;zSize(â€˜keyâ€™);</td></tr><tr><td>zcount</td><td>è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•°</td><td>zcount key min max</td><td>$redis-&gt;zCount(key, start, end);</td></tr><tr><td>zrem</td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td><td>zrem key value1 [value2 â€¦]</td><td>$redis-&gt;zDelete(â€˜keyâ€™, â€˜val2â€™);</td></tr><tr><td>zremrangebyrank</td><td>æŒ‰ç…§æ’åç´¢å¼•åŒºé—´èŒƒå›´åˆ é™¤å…ƒç´ </td><td>zremrangebyrank key start stop</td><td>$redis-&gt;zRemRangeByRank(â€˜keyâ€™, 0, 1);</td></tr><tr><td>zremrangebyscore</td><td>æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´ </td><td>zremrangebyscore key min max</td><td>$redis-&gt;zRemRangeByScore(â€˜keyâ€™, 0, 3);</td></tr><tr><td>zrank</td><td>è·å–æ­£åºæ’åºçš„å…ƒç´ çš„æ’å</td><td>zrank key value</td><td>$redis-&gt;zRank(key, value);</td></tr><tr><td>zrevrank</td><td>è·å–é€†åºæ’åºçš„å…ƒç´ çš„æ’å</td><td>zrevrank key value</td><td>$redis-&gt;zRevRank(key, value);</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>M1 å®‰è£… Homebrew å’Œ php å¼€å‘ç¯å¢ƒ</title>
      <link href="posts/b12a8007.html"/>
      <url>posts/b12a8007.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆå®‰è£… homebrew æ–¹ä¾¿ä¸‹è½½è½¯ä»¶ã€‚</p><blockquote><p>å¦‚æœä½¿ç”¨å®˜ç½‘æ¨èçš„æ–¹å¼ä¸‹è½½æ—¶æç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯æ—¶ï¼Œåˆ™è¡¨ç¤ºç½‘ç»œè¶…æ—¶ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨æºç åŒ…çš„å½¢å¼å®‰è£…</p></blockquote><p>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">curl: <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> Failed to connect to raw.githubusercontent.com port <span class="token number">443</span>: Connection refused<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…"><a href="#ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…" class="headerlink" title="ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…"></a>ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…</h2><ol><li>è¿›å…¥ <a href="https://github.com/Homebrew/brew/tags">Homebrew çš„ GitHub ä»“åº“ tag åœ°å€</a> ä¸‹è½½æœ€æ–°çš„ tag</li><li>æ ¹æ®ç³»ç»Ÿé€‰æ‹©ä¸‹è½½ï¼šmacã€windows å¯ä»¥ä¸‹è½½ zip æ–‡ä»¶ï¼Œ linux å¯ä»¥ä¸‹è½½ tar.gz çš„æ–‡ä»¶ã€‚</li><li>ä¸‹è½½åè§£å‹ã€‚</li><li>åœ¨ <code>/usr/local</code> æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>Homebrew</code> æ–‡ä»¶å¤¹ï¼Œç„¶åå°†è§£å‹åçš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ° <code>Homebrew</code> æ–‡ä»¶å¤¹ä¸‹</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯ brew-3.3.3 ç‰ˆæœ¬</span><span class="token comment"># ä¸‹è½½åœ°å€ä¸ºï¼šhttps://github.com/Homebrew/brew/archive/refs/tags/3.3.3.zip</span><span class="token function">wget</span> <span class="token builtin class-name">cd</span> /usr/local <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> Homebrew<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>å»ºç«‹è½¯è¿æ¥</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/Homebrew/bin/brew /usr/local/bin/brew<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>è¿›å…¥æœ¬åœ° <code>Homebrew</code> çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚æœæ‰¾ä¸åˆ°çš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ <code>terminal</code> ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿›å…¥  usr/local ç›®å½•</span><span class="token builtin class-name">cd</span> /usr/local<span class="token comment"># ä½¿ç”¨è®¿è¾¾(finder) æ‰“å¼€å½“å‰ç›®å½•</span><span class="token function">open</span> <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>æŸ¥çœ‹ <code>/usr/local</code> ç›®å½•ä¸‹æ˜¯å¦æœ‰ <code>Homebrew</code> æ–‡ä»¶å¤¹ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰ï¼Œå¦‚æœä½ å‘ç°æ²¡æœ‰ <code>Homebrew</code> æ–‡ä»¶å¤¹ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º <code>Homebrew</code> æ–‡ä»¶å¤¹</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/Homebrew<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li><p>å°†ç¬¬ä¸‰æ­¥ä¸­è§£å‹åçš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ° <code>/usr/local/Homebrew</code> ç›®å½•</p></li><li><p>é‡å¯å‘½ä»¤è¡Œçª—å£ï¼Œè¾“å…¥ <code>brew</code> å‘½ä»¤ï¼Œå‡ºç° brew ç›¸å…³çš„ help é¡µé¢ï¼Œå³è¡¨ç¤ºå·²ç»å®‰è£…æˆåŠŸ</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /usr/local/bin/brew -&gt; /usr/local/Homebrew/bin/brew</span><span class="token builtin class-name">cd</span> /usr/local/Homebrew <span class="token operator">&amp;&amp;</span> brew<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ•²å‡» <code>brew</code> å‘½ä»¤æ—¶ï¼Œå‡ºç°ä»¥ä¸‹å†…å®¹æ—¶ï¼Œè¡¨ç¤ºå·²ç»å®‰è£… Homebrew æˆåŠŸ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Example usage:  brew search <span class="token punctuation">[</span>TEXT<span class="token operator">|</span>/REGEX/<span class="token punctuation">]</span>  brew info <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>  brew <span class="token function">install</span> FORMULA<span class="token punctuation">..</span>.  brew update  brew upgrade <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>  brew uninstall FORMULA<span class="token punctuation">..</span>.  brew list <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>Troubleshooting:  brew config  brew doctor  brew <span class="token function">install</span> <span class="token parameter variable">--verbose</span> <span class="token parameter variable">--debug</span> FORMULAContributing:  brew create <span class="token punctuation">[</span>URL <span class="token punctuation">[</span>--no-fetch<span class="token punctuation">]</span><span class="token punctuation">]</span>  brew edit <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>Further help:  brew commands  brew <span class="token builtin class-name">help</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span>  <span class="token function">man</span> brew  https://docs.brew.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>å®‰è£…å®Œæˆåï¼Œä¸€å®šè¦ä¸‹è½½ä¸€ä¸ªè½¯ä»¶æµ‹è¯•ä¸‹ï¼Œæ¯”å¦‚ä¸‹è½½ <code>wget</code></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token function">wget</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="9"><li>æ›´æ¢ brew çš„ä¸‹è½½æº</li></ol><ul><li><p><a href="http://mirrors.ustc.edu.cn/help/brew.git.html">Homebrew æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span><span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/brew.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span><span class="token function">git</span> remote set-url origin https://github.com/Homebrew/brew.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-bottles.html">Homebrew Bottles æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¯·åœ¨è¿è¡Œ brew å‰è®¾ç½®ç¯å¢ƒå˜é‡ HOMEBREW_BOTTLE_DOMAIN ï¼Œå€¼ä¸º https://mirrors.ustc.edu.cn/homebrew-bottles</span><span class="token comment"># å¯¹äº bash ç”¨æˆ·</span><span class="token builtin class-name">echo</span> <span class="token string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> <span class="token operator">&gt;&gt;</span> ~/.bash_profile<span class="token builtin class-name">source</span> ~/.bash_profile<span class="token comment"># å¯¹äº zsh ç”¨æˆ·</span><span class="token builtin class-name">echo</span> <span class="token string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">source</span> ~/.zshrc<span class="token comment"># å¦‚æœæƒ³æ¢å¤æˆå®˜æ–¹ Homebrew Bottles æºï¼Œåˆ™ç›´æ¥æ³¨é‡Šæ‰ HOMEBREW_BOTTLE_DOMAIN å˜é‡å³å¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-core.git.html">Homebrew Core æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>/Library/Taps/homebrew/homebrew-core"</span><span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>/Library/Taps/homebrew/homebrew-core"</span><span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-core<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-cask.git.html">Homebrew Cask æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ä¸º USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask<span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask<span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-cask<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-cask-versions.git.html">Homebrew Cask Versions æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ä¸º USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask-versions<span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask-versions.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask-versions<span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-cask-versions.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="ä¸‹è½½-php"><a href="#ä¸‹è½½-php" class="headerlink" title="ä¸‹è½½ php"></a>ä¸‹è½½ php</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ homebrew æœç´¢ php</span>brew search php<span class="token comment"># ä½¿ç”¨ homebrew å®‰è£… php7.4</span>brew <span class="token function">install</span> php@7.4<span class="token comment"># å®‰è£…ä¹‹åçš„ php7.4 åœ¨ /opt/homebrew/etc/php/7.4/ ç›®å½•ä¸‹</span><span class="token comment"># å› ä¸º mac ä¸‹é»˜è®¤å·²ç»å®‰è£…äº† php7.3 ï¼Œå¦‚æœä½ æƒ³é¦–å…ˆä½¿ç”¨ php7.4 ç‰ˆæœ¬æ—¶ï¼Œéœ€è¦æ‰§è¡Œ</span><span class="token builtin class-name">echo</span> <span class="token string">'export PATH="/opt/homebrew/opt/php@7.4/bin:$PATH"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">echo</span> <span class="token string">'export PATH="/opt/homebrew/opt/php@7.4/sbin:$PATH"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc  <span class="token comment"># å¦‚æœæƒ³è¦è®©ç¼–è¯‘å™¨æ‰¾åˆ° php7.4 é‚£ä¹ˆè¿˜éœ€è¦è®¾ç½®</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">LDFLAGS</span><span class="token operator">=</span><span class="token string">"-L/opt/homebrew/opt/php@7.4/lib"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">CPPFLAGS</span><span class="token operator">=</span><span class="token string">"-I/opt/homebrew/opt/php@7.4/include"</span><span class="token comment"># å†™å…¥ .zshrc æ–‡ä»¶ä¹‹åï¼Œéœ€è¦æ‰§è¡Œ source å‘½ä»¤ï¼Œé‡æ–°åŠ è½½é…ç½®ä¿¡æ¯</span><span class="token builtin class-name">source</span> ~/.zshrc<span class="token comment"># å¯ä»¥ä½¿ç”¨ homebrew æ¥ç®¡ç† php7.4 çš„æœåŠ¡çŠ¶æ€ï¼Œæ¯”å¦‚é‡å¯</span>brew services restart php@7.4<span class="token comment"># å¦‚æœä¸éœ€è¦å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ php7.4 æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ</span>/opt/homebrew/opt/php@7.4/sbin/php-fpm <span class="token parameter variable">--nodaemonize</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ‡æ¢å¤šä¸ª-php-ç‰ˆæœ¬"><a href="#åˆ‡æ¢å¤šä¸ª-php-ç‰ˆæœ¬" class="headerlink" title="åˆ‡æ¢å¤šä¸ª php ç‰ˆæœ¬"></a>åˆ‡æ¢å¤šä¸ª php ç‰ˆæœ¬</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥åˆ‡æ¢åˆ° php7.4</span>brew <span class="token function">link</span> <span class="token parameter variable">--overwrite</span> php@7.4<span class="token comment"># æˆ–è€…å…ˆå–æ¶ˆé“¾æ¥</span>brew unlink php<span class="token comment"># ç„¶åå†é“¾æ¥</span>brew <span class="token function">link</span> php@7.4 <span class="token parameter variable">--force</span>php <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…-composer"><a href="#å®‰è£…-composer" class="headerlink" title="å®‰è£… composer"></a>å®‰è£… composer</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token function">composer</span><span class="token comment"># æŸ¥çœ‹ composer æ˜¯å¦å®‰è£…æˆåŠŸ</span><span class="token function">composer</span> <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>brew update</td><td>æ›´æ–° Homebrew è‡ªèº«</td></tr><tr><td>brew outdated</td><td>æŸ¥çœ‹å“ªäº›å®‰è£…åŒ…éœ€è¦æ›´æ–°</td></tr><tr><td>brew upgrade</td><td>æ›´æ–°æ‰€æœ‰çš„åŒ…</td></tr><tr><td>brew upgrade $FORMULA</td><td>æ›´æ–°æŒ‡å®šçš„åŒ…</td></tr><tr><td>brew cleanup</td><td>æ¸…ç†æ‰€æœ‰åŒ…çš„æ—§ç‰ˆæœ¬</td></tr><tr><td>brew cleanup $FORMULA</td><td>æ¸…ç†æŒ‡å®šåŒ…çš„æ—§ç‰ˆæœ¬</td></tr><tr><td>brew cleanup -n</td><td>æŸ¥çœ‹å¯æ¸…ç†çš„æ—§ç‰ˆæœ¬åŒ…ï¼Œä¸æ‰§è¡Œå®é™…æ“ä½œ</td></tr><tr><td>brew pin $FORMULA</td><td>é”å®šæŸä¸ªåŒ…</td></tr><tr><td>brew unpin $FORMULA</td><td>å–æ¶ˆé”å®š</td></tr><tr><td>brew info $FORMULA</td><td>æ˜¾ç¤ºæŸä¸ªåŒ…çš„ä¿¡æ¯</td></tr><tr><td>brew info</td><td>æ˜¾ç¤ºå®‰è£…äº†åŒ…æ•°é‡ï¼Œæ–‡ä»¶æ•°é‡ï¼Œå’Œæ€»å ç”¨ç©ºé—´</td></tr><tr><td>brew deps â€“installed â€“tree</td><td>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çš„ä¾èµ–ï¼Œæ ‘å½¢æ˜¾ç¤º</td></tr><tr><td>brew list</td><td>åˆ—å‡ºå·²å®‰è£…çš„åŒ…</td></tr><tr><td>brew rm $FORMULA</td><td>åˆ é™¤æŸä¸ªåŒ…</td></tr><tr><td>brew install {package-name}</td><td>ä¸‹è½½æŸä¸ªåŒ…</td></tr><tr><td>brew uninstall â€“force $FORMULA</td><td>åˆ é™¤æ‰€æœ‰ç‰ˆæœ¬</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Homebrew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸èŠ±ä¸€åˆ†é’±ä¹Ÿå¯ä»¥ç”¨ä¸Š JetBrains æ­£ç‰ˆå…¨å®¶æ¡¶</title>
      <link href="posts/b3af447c.html"/>
      <url>posts/b3af447c.html</url>
      
        <content type="html"><![CDATA[<p>æ˜¨å¤©ï¼Œå‘ç°æ­£åœ¨ä½¿ç”¨çš„ idea è¦åˆ°æœŸäº†ï¼Œäºæ˜¯è‡ªå·±å¾—é©¬ä¸Šå»ç»­çº¦ï¼Œå…å¾—å½±å“è‡ªå·±çš„å·¥ä½œã€‚</p><p>å…¶å®ï¼Œæˆ‘ä½“éªŒè¿‡ä¸å°‘çš„ç¼–è¾‘å™¨ï¼ŒNotepad++ã€Sublime Textã€Apache NetBeansã€Vimã€Neovimã€å†å°±æ˜¯å¤§åé¼é¼çš„ Visual Studio Code å’Œå·¨å¼ºå¤§çš„ JetBrains IDEã€‚æœ€ç»ˆä½“éªŒä¸‹æ¥ï¼Œåœ¨å·¥ä½œä¸­çš„ä¸»è¦ç¼–è¾‘å™¨è¿˜æ˜¯ä½¿ç”¨äº† IDEã€‚é™¤äº†ç¡®å®æ¯”è¾ƒå ç”¨å†…å­˜ä»¥å¤–ï¼Œæ²¡æœ‰å…¶ä»–å¯æŒ‘å‰”çš„ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-dcae6b5c4b3eafc8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»·æ ¼ä¸è²"></p><p><img src="/medias/loading.gif" data-original="https://img-blog.csdnimg.cn/img_convert/db879ed091daa570863771c473f61c70.png"></p><p>ä½†æ˜¯ï¼Œè¦æ˜¯ç›´æ¥å»è´­ä¹°æ­£ç‰ˆæˆæƒçš„è¯ï¼Œä»·æ ¼ç¡®å®ä¸ä¾¿å®œï¼Œå…‰ä¸€ä¸ª IDE æ¯æœˆä¹Ÿè¦ 24.9 ç¾å…ƒï¼ŒæŠ˜åˆäººæ°‘å¸å°ä¸¤ç™¾æ¥å—äº†ï¼Œæ›´åˆ«è¯´å…¨å®¶æ¡¶äº†ï¼Œè¦ 77.9 ç¾å…ƒã€‚å¯¹äºä¸ªäººç”¨æˆ·è€Œè¨€ï¼Œä¼°è®¡ä¸€èˆ¬éƒ½ä¼šå‡ºé—¨å³è½¬å»æŸå®ä¸ŠèŠ±ä¸ª 9.9 ä¹°è´¦å·äº†ã€‚ç”¨ç¡®å®å¯ä»¥ç”¨ï¼Œä½†æ˜¯å°±æ˜¯ä¸å¤ªç¨³å®šã€‚</p><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•æ—¢æƒ³ä½¿ç”¨æ­£ç‰ˆæˆæƒï¼Œåˆä¸æƒ³æé’±å‘¢ï¼Ÿè¿˜çœŸæœ‰ï¼Œ<strong>å¼€æºå¼€å‘è®¸å¯è¯â€”â€”JetBrains é€šè¿‡ä¸ºæ ¸å¿ƒé¡¹ç›®è´¡çŒ®è€…å…è´¹æä¾›ä¸€å¥—ä¸€æµçš„å¼€å‘è€…å·¥å…·æ¥æ”¯æŒéå•†ä¸šå¼€æºé¡¹ç›®ã€‚</strong></p><p>åˆ«çœ‹ä»–å†™çš„æ¡ä»¶é‚£ä¹ˆå¤šï¼Œå…¶å®æ€»ç»“ä¸‹æ¥ä¹Ÿå°±å‡ ç‚¹ï¼š</p><ol><li>ä½ å¾—æœ‰ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¸”è¿‘æœŸä¸‰ä¸ªæœˆæœ‰ä¸€å®šçš„æ´»è·ƒåº¦ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿‘ä¸‰ä¸ªæœˆæœ‰å®šæœŸæäº¤ä»£ç å°±è¡Œã€‚</li><li>åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹å¾—æœ‰ä¸€ä¸ªå¼€æºè®¸å¯è¯ï¼Œ  é¡¹ç›®ä¸ºå…¬å¼€ä»£ç ã€‚</li><li>å¹¶ä¸”æ­¤ä»“åº“è¿˜ä¸èƒ½æ˜¯åšå®¢å’Œä¸€äº›ç¤ºä¾‹ä»£ç ã€‚ï¼ˆè¿™ä¸€ç‚¹å¥½åƒæ˜¯ä»Šå¹´åŠ ä¸Šçš„å§ï¼Œå»å¹´æˆ‘ç»­çº¦çš„æ—¶å€™ï¼Œè²Œä¼¼éƒ½è¿˜æ²¡æœ‰è¿™ä¸€ç‚¹ï¼‰</li></ol><p>å…·ä½“æ»¡è¶³æ¡ä»¶å¯é€šè¿‡è®¿é—® <a href="https://www.jetbrains.com/zh-cn/community/opensource/#support">https://www.jetbrains.com/zh-cn/community/opensource/#support</a> åœ°å€è¿›è¡ŒæŸ¥çœ‹ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-eff4930bcc518842.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ»¡è¶³æ¡ä»¶"></p><p>æ¥ä¸‹æ¥è®²å¦‚ä½•ç”³è¯·è¿™ä¸ªå…è´¹çš„è®¸å¯è¯ã€‚</p><h2 id="æ³¨å†Œè´¦å·"><a href="#æ³¨å†Œè´¦å·" class="headerlink" title="æ³¨å†Œè´¦å·"></a>æ³¨å†Œè´¦å·</h2><p>å…ˆè®¿é—® <a href="https://account.jetbrains.com/licenses">https://account.jetbrains.com/licenses</a> åœ°å€ï¼Œåœ¨ JetBrains å®˜ç½‘ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·ã€‚</p><h2 id="ç”³è¯·"><a href="#ç”³è¯·" class="headerlink" title="ç”³è¯·"></a>ç”³è¯·</h2><p>ç›´æ¥è®¿é—®å®˜æ–¹çš„ç”³è¯·åœ°å€ <a href="https://www.jetbrains.com/shop/eform/opensource">https://www.jetbrains.com/shop/eform/opensource</a></p><p>è¿™ä¸ªé¡µé¢æœ‰ä¸‰ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å¤§è‡´è®²è§£ä¸€ä¸‹ã€‚</p><ol><li>Do we know you?</li></ol><p><strong>No</strong>ï¼šä¹‹å‰ä»æ¥æ²¡æœ‰ç”³è¯·è¿‡çš„ï¼Œå°±é€‰è¿™ä¸ªã€‚<strong>Yes</strong>ï¼šä¹‹å‰å¼„è¿‡å¼€æºè®¸å¯çš„ï¼Œå°±ç›´æ¥é€‰è¿™ä¸ªï¼Œç„¶åå¡«ä¸Šè‡ªå·±çš„ License ID å³å¯ã€‚</p><ol start="2"><li>Tell us about your project</li></ol><p>è¿™é‡Œå°±æ ¹æ®ä½ é¡¹ç›®çš„å®é™…æƒ…å†µå¡«å†™å°±è¡Œäº†ï¼Œæ²¡æœ‰å¤ªå¤šçš„æ»‘å¤´ã€‚</p><ol start="3"><li>Tell us about yourself</li></ol><ul><li>Email address: æ¯”è¾ƒé‡è¦çš„æ˜¯è¿™ä¸€é¡¹ï¼Œè¿™ä¸ªé‚®ç®±è¦å’Œä½  GitHub ä¸»é¡µä¸Šçš„é‚®ç®±åœ°å€ä¸€è‡´ã€‚</li><li>A link to your profile on GitHub,etc: è¿™ä¸ªå¡«ä½  GitHub çš„ä¸»é¡µåœ°å€å³å¯ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ebea11272aecf962.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fb0937c35ce4e7aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="22.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7330fa398a713aa3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="33.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4bf839e7eda63932.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="44.png"></p><p>å¥½äº†ï¼Œå¡«å†™å®Œæ¯•ä¹‹åï¼Œç›´æ¥æäº¤å°±å¯ä»¥ç­‰ç€äº†ã€‚ä¸€èˆ¬éœ€è¦ç­‰ä¸¤å‘¨å·¦å³ï¼Œå…¶å®å¾ˆå¿«ï¼ŒåŸºæœ¬ä¸Šåœ¨ä¸€å‘¨å†…å°±ä¼šæœ‰é‚®ä»¶é€šçŸ¥ä½ å…·ä½“çš„ç”³è¯·ç»“æœã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7b6bb5cd1b97bf7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="55.png"></p><h2 id="é€šè¿‡ç”³è¯·å"><a href="#é€šè¿‡ç”³è¯·å" class="headerlink" title="é€šè¿‡ç”³è¯·å"></a>é€šè¿‡ç”³è¯·å</h2><p>ç”³è¯·ä¹‹åï¼Œä½ è¦ç•™å¿ƒä½ çš„é‚®ç®±é‡Œé¢æ ‡é¢˜ä¸º <strong>License Certificate for JetBrains</strong> å¼€å¤´çš„é‚®ä»¶ã€‚ç„¶åä½ éœ€è¦ç‚¹å‡» <strong>Take me to my license(s)</strong> è¿™ä¸ªè®¸å¯è¯å¯ä»¥ç›´æ¥å’Œä½ çš„ JetBrains è´¦å·ç›´æ¥ç»‘å®šï¼Œä½¿ç”¨ IDE çš„æ—¶å€™ç›´æ¥é€šè¿‡ä½ çš„è´¦å·ç™»å½•å³å¯ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ç¦»çº¿æ¿€æ´»ç ï¼Œé€šè¿‡æ¿€æ´»ç çš„å½¢å¼å»æ¿€æ´» IDEã€‚è¿™ä¸ªå°±çœ‹è‡ªå·±çš„å–œå¥½äº†ã€‚</p><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p><strong>åœ¨ä½ çš„ GitHub é¦–é¡µï¼Œéœ€è¦æŠŠä½ çš„é‚®ç®±æ˜¾ç¤ºå‡ºæ¥ï¼Œ</strong> è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å®¡æŸ¥äººå‘˜åˆ¤æ–­è¿™æ˜¯å¦ä¸ºä½ è‡ªå·±çš„è´¦å·ã€‚äººå®¶éƒ½å…è´¹ç»™ä½ ä½¿ç”¨äº†ï¼Œè‚¯å®šä¹Ÿæ˜¯å¸Œæœ›ä½ ä¸è¦å¤ªé¬¼å‘€ã€‚</p><p>å¦å¤–è¿™ä¸ªè®¸å¯è¯æ˜¯å¯ä»¥åå¤ç”³è¯·çš„ï¼Œæ¯ä¸€æ¬¡çš„æœ‰æ•ˆæœŸæ˜¯ä¸€å¹´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€æ¬¡ç”³è¯·æˆåŠŸä¹‹åï¼Œå¦‚æœç¬¬äºŒå¹´ä½ çš„ä»“åº“è¿˜æ»¡è¶³ç”³è¯·æ¡ä»¶ï¼Œé‚£ä¹ˆä½ è¿˜å¯ä»¥ç»§ç»­ç”³è¯·ã€‚</p><p>æ„Ÿå¹å¼€æºçš„ä¼Ÿå¤§ï¼æ„Ÿå¹ JetBrains çš„ä¼Ÿå¤§ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç§‘æ™® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JetBrains </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ</title>
      <link href="posts/fe9e07a8.html"/>
      <url>posts/fe9e07a8.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•æ‰¾åˆ°-Redis-çš„-Big-keyï¼Ÿ"><a href="#å¦‚ä½•æ‰¾åˆ°-Redis-çš„-Big-keyï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ"></a>å¦‚ä½•æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ</h1><h2 id="1-ä»€ä¹ˆæ˜¯-Redis-çš„-Big-keyï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-Redis-çš„-Big-keyï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ Redis çš„ Big keyï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯ Redis çš„ Big keyï¼Ÿ</h2><p>Redis çš„ Big key æ˜¯æŒ‡å ç”¨å†…å­˜è¾ƒå¤§çš„ keyï¼Œé€šå¸¸æ˜¯å¤§ Listã€å¤§ Setã€å¤§ Hashã€å¤§ String ç­‰ç­‰ã€‚</p><p>æ¯”å¦‚è¯´ï¼š</p><ul><li>å­—ç¬¦ä¸²ç±»å‹ã€‚å¦‚ï¼šè¶…è¿‡ 1 MB çš„ keyï¼Œå°±æ˜¯ä¸€ä¸ª Big keyã€‚</li><li>éå­—ç¬¦ä¸²ç±»å‹ã€‚å¦‚ï¼šä¸€ä¸ªåŒ…å« 100 ä¸‡ä¸ªå…ƒç´ çš„ Listï¼Œå ç”¨å†…å­˜ 100 MBï¼Œé‚£ä¹ˆè¿™ä¸ª List å°±æ˜¯ä¸€ä¸ª Big keyã€‚</li></ul><p><strong>å…·ä½“çš„è§„å®šæ ¹æ®æ¯ä¸ªå…¬å¸çš„å®é™…æƒ…å†µè€Œå®šã€‚</strong></p><h2 id="2-ä¸ºä»€ä¹ˆè¦æ‰¾åˆ°-Redis-çš„-Big-keyï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆè¦æ‰¾åˆ°-Redis-çš„-Big-keyï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆè¦æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆè¦æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ</h2><ul><li>å†…å­˜ç©ºé—´ä¸å‡åŒ€ï¼šå¦‚æœ Redis çš„ Big key å ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å†…å­˜ç©ºé—´ä¸å‡åŒ€ï¼Œä»è€Œå¯¼è‡´ Redis çš„å†…å­˜ä¸è¶³ã€‚</li><li>æŸ¥è¯¢æ—¶é˜»å¡ï¼šå› ä¸º Redis å•çº¿ç¨‹ç‰¹æ€§ï¼Œå¦‚æœæ“ä½œæŸä¸ª Big keyï¼Œè€—æ—¶æ¯”è¾ƒä¹…ï¼Œåˆ™åé¢çš„è¯·æ±‚ä¼šè¢«é˜»å¡ã€‚</li><li>è¿‡æœŸæ—¶é˜»å¡ï¼šå¦‚æœ Big key è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå½“è¿‡æœŸåï¼Œè¿™ä¸ª key ä¼šè¢«åˆ é™¤ï¼Œå‡å¦‚æ²¡æœ‰ä½¿ç”¨è¿‡æœŸå¼‚æ­¥åˆ é™¤ï¼Œå°±ä¼šå­˜åœ¨é˜»å¡ Redis çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”æ…¢æŸ¥è¯¢ä¸­æŸ¥ä¸åˆ°ï¼ˆå› ä¸ºè¿™ä¸ªåˆ é™¤æ˜¯å†…éƒ¨å¾ªç¯äº‹ä»¶ï¼‰</li></ul><h2 id="3-å¦‚ä½•æ‰¾åˆ°-Redis-çš„-Big-keyï¼Ÿ"><a href="#3-å¦‚ä½•æ‰¾åˆ°-Redis-çš„-Big-keyï¼Ÿ" class="headerlink" title="3. å¦‚ä½•æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ"></a>3. å¦‚ä½•æ‰¾åˆ° Redis çš„ Big keyï¼Ÿ</h2><h3 id="ç›´æ¥ä½¿ç”¨-redis-cli-å‘½ä»¤ï¼Œåˆ†æå¤§è‡´çš„æƒ…å†µ"><a href="#ç›´æ¥ä½¿ç”¨-redis-cli-å‘½ä»¤ï¼Œåˆ†æå¤§è‡´çš„æƒ…å†µ" class="headerlink" title="ç›´æ¥ä½¿ç”¨ redis-cli å‘½ä»¤ï¼Œåˆ†æå¤§è‡´çš„æƒ…å†µ"></a>ç›´æ¥ä½¿ç”¨ <code>redis-cli</code> å‘½ä»¤ï¼Œåˆ†æå¤§è‡´çš„æƒ…å†µ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æˆ‘è¿™é‡Œåœ¨ç¬¬äºŒä¸ªæ•°æ®åº“ä¸Šåšçš„æµ‹è¯•ï¼Œå› æ­¤éœ€è¦æŒ‡å®šæ•°æ®åº“ `-n 2`</span>$ redis-cli <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token parameter variable">-n</span> <span class="token number">2</span> <span class="token parameter variable">--bigkeys</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¤§è‡´çš„ç»“æœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Scanning the entire keyspace to find biggest keys as well as</span><span class="token comment"># average sizes per key type.  You can use -i 0.1 to sleep 0.1 sec</span><span class="token comment"># per 100 SCAN commands (not usually needed).</span><span class="token punctuation">[</span>00.00%<span class="token punctuation">]</span> Biggest <span class="token builtin class-name">set</span>    found so far <span class="token string">'"large_set_key"'</span> with <span class="token number">201</span> members<span class="token punctuation">[</span>00.00%<span class="token punctuation">]</span> Biggest list   found so far <span class="token string">'"large_list_key"'</span> with <span class="token number">201</span> items<span class="token punctuation">[</span>00.00%<span class="token punctuation">]</span> Biggest string found so far <span class="token string">'"large_string_key"'</span> with <span class="token number">5242880</span> bytes<span class="token punctuation">[</span>00.00%<span class="token punctuation">]</span> Biggest <span class="token builtin class-name">hash</span>   found so far <span class="token string">'"large_hash_key"'</span> with <span class="token number">201</span> fields<span class="token punctuation">[</span>00.00%<span class="token punctuation">]</span> Biggest zset   found so far <span class="token string">'"large_zset_key"'</span> with <span class="token number">201</span> members-------- summary -------<span class="token comment"># ä¸€å…±æ‰«æäº† 5 ä¸ª key</span>Sampled <span class="token number">5</span> keys <span class="token keyword">in</span> the keyspace<span class="token operator">!</span><span class="token comment"># æ‰€æœ‰ key çš„æ€»é•¿åº¦æ˜¯ 71 å­—èŠ‚ï¼Œå¹³å‡é•¿åº¦ä¸º 14.20 å­—èŠ‚</span>Total key length <span class="token keyword">in</span> bytes is <span class="token number">71</span> <span class="token punctuation">(</span>avg len <span class="token number">14.20</span><span class="token punctuation">)</span>Biggest   list found <span class="token string">'"large_list_key"'</span> has <span class="token number">201</span> itemsBiggest   <span class="token builtin class-name">hash</span> found <span class="token string">'"large_hash_key"'</span> has <span class="token number">201</span> fieldsBiggest string found <span class="token string">'"large_string_key"'</span> has <span class="token number">5242880</span> bytesBiggest    <span class="token builtin class-name">set</span> found <span class="token string">'"large_set_key"'</span> has <span class="token number">201</span> membersBiggest   zset found <span class="token string">'"large_zset_key"'</span> has <span class="token number">201</span> members<span class="token comment"># æ¯ä¸€ç§ key æƒ…å†µçš„æ€»è§ˆï¼ŒæŸç§ç±»å‹çš„ key å ç”¨å†…å­˜çš„ç™¾åˆ†æ¯”ï¼Œå¹³å‡å¤§å°</span><span class="token number">1</span> lists with <span class="token number">201</span> items <span class="token punctuation">(</span><span class="token number">20.00</span>% of keys, avg size <span class="token number">201.00</span><span class="token punctuation">)</span><span class="token number">1</span> hashs with <span class="token number">201</span> fields <span class="token punctuation">(</span><span class="token number">20.00</span>% of keys, avg size <span class="token number">201.00</span><span class="token punctuation">)</span><span class="token number">1</span> strings with <span class="token number">5242880</span> bytes <span class="token punctuation">(</span><span class="token number">20.00</span>% of keys, avg size <span class="token number">5242880.00</span><span class="token punctuation">)</span><span class="token number">0</span> streams with <span class="token number">0</span> entries <span class="token punctuation">(</span>00.00% of keys, avg size <span class="token number">0.00</span><span class="token punctuation">)</span><span class="token number">1</span> sets with <span class="token number">201</span> members <span class="token punctuation">(</span><span class="token number">20.00</span>% of keys, avg size <span class="token number">201.00</span><span class="token punctuation">)</span><span class="token number">1</span> zsets with <span class="token number">201</span> members <span class="token punctuation">(</span><span class="token number">20.00</span>% of keys, avg size <span class="token number">201.00</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a06d75c4c7c12cef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="redis-cli æ‰«æ big key"></p><p>ç„¶åå¯ä»¥ä½¿ç”¨ <code>memory usage</code> å‘½ä»¤æŸ¥çœ‹å…·ä½“çš„å†…å­˜å ç”¨æƒ…å†µï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">localhost:<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>MEMORY USAGE large_string_key<span class="token string">"6291520"</span>localhost:<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>MEMORY USAGE large_list_key<span class="token string">"2240"</span>localhost:<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>MEMORY USAGE large_set_key<span class="token string">"11264"</span>localhost:<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>MEMORY USAGE large_hash_key<span class="token string">"4269"</span>localhost:<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>MEMORY USAGE large_zset_key<span class="token string">"18968"</span>localhost:<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fd87710c7404b132.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h3 id="é€šè¿‡ä»£ç è„šæœ¬æ‰¾åˆ°å…·ä½“çš„-Big-key"><a href="#é€šè¿‡ä»£ç è„šæœ¬æ‰¾åˆ°å…·ä½“çš„-Big-key" class="headerlink" title="é€šè¿‡ä»£ç è„šæœ¬æ‰¾åˆ°å…·ä½“çš„ Big key"></a>é€šè¿‡ä»£ç è„šæœ¬æ‰¾åˆ°å…·ä½“çš„ Big key</h3><p>è¯¦è§ä»£ç ã€‚<a href="https://github.com/pudongping/golang-tutorial/blob/main/project/redis_big_key/big_key.go">æºç åœ°å€</a></p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> redis_big_key<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"io/ioutil"</span><span class="token string">"log"</span><span class="token string">"math/rand"</span><span class="token string">"strings"</span><span class="token string">"sync"</span><span class="token string">"time"</span><span class="token string">"github.com/go-redis/redis"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">NewRedisClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>redis<span class="token punctuation">.</span>Client <span class="token punctuation">{</span>client <span class="token operator">:=</span> redis<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>redis<span class="token punctuation">.</span>Options<span class="token punctuation">{</span>Addr<span class="token punctuation">:</span>     <span class="token string">"localhost:6379"</span><span class="token punctuation">,</span>Password<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>DB<span class="token punctuation">:</span>       <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">return</span> client<span class="token punctuation">}</span><span class="token comment">// GenerateRandomString ç”ŸæˆæŒ‡å®šå¤§å°çš„éšæœºå­—ç¬¦ä¸²</span><span class="token keyword">func</span> <span class="token function">GenerateRandomString</span><span class="token punctuation">(</span>size <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> size <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">}</span>rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>chars <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span><span class="token punctuation">)</span>result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> chars<span class="token punctuation">[</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// WriteBigKey å†™å…¥å¤§ key</span><span class="token keyword">func</span> <span class="token function">WriteBigKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>client <span class="token operator">:=</span> <span class="token function">NewRedisClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// ä½¿ç”¨å®Œæ¯•åï¼Œå…³é—­è¿æ¥</span><span class="token keyword">defer</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> err <span class="token builtin">error</span><span class="token comment">// å†™å…¥å­—ç¬¦ä¸²ç±»å‹çš„é”®ï¼Œå¤§å°ä¸º 5M</span>largeStringValue <span class="token operator">:=</span> <span class="token function">GenerateRandomString</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"large_string_key"</span><span class="token punctuation">,</span> largeStringValue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"å†™å…¥å­—ç¬¦ä¸²ç±»å‹çš„é”®å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å†™å…¥å“ˆå¸Œç±»å‹çš„é”®ï¼Œå…ƒç´ ä¸ªæ•°å¤§äº 200</span>hashData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">var</span> hashLock sync<span class="token punctuation">.</span>RWMutex<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>field <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"field_%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>value <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"value_%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>hashLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>hashData<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> valuehashLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">HMSet</span><span class="token punctuation">(</span><span class="token string">"large_hash_key"</span><span class="token punctuation">,</span> hashData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"å†™å…¥å“ˆå¸Œç±»å‹çš„é”®å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å†™å…¥åˆ—è¡¨ç±»å‹çš„é”®ï¼Œå…ƒç´ ä¸ªæ•°å¤§äº 200</span>listData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>listData <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>listData<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"value_%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">LPush</span><span class="token punctuation">(</span><span class="token string">"large_list_key"</span><span class="token punctuation">,</span> listData<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"å†™å…¥åˆ—è¡¨ç±»å‹çš„é”®å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å†™å…¥é›†åˆç±»å‹çš„é”®ï¼Œå…ƒç´ ä¸ªæ•°å¤§äº 200</span>setData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>setData <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>setData<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">SAdd</span><span class="token punctuation">(</span><span class="token string">"large_set_key2"</span><span class="token punctuation">,</span> setData<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"å†™å…¥é›†åˆç±»å‹çš„é”®å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å†™å…¥æœ‰åºé›†åˆç±»å‹çš„é”®ï¼Œå…ƒç´ ä¸ªæ•°å¤§äº 200</span>zsetData <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>redis<span class="token punctuation">.</span>Z<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>zsetData <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>zsetData<span class="token punctuation">,</span> redis<span class="token punctuation">.</span>Z<span class="token punctuation">{</span>Score<span class="token punctuation">:</span>  <span class="token function">float64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>Member<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"value_%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">ZAdd</span><span class="token punctuation">(</span><span class="token string">"large_zset_key"</span><span class="token punctuation">,</span> zsetData<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"å†™å…¥æœ‰åºé›†åˆç±»å‹çš„é”®å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"å†™å…¥å¤§ key æ€»è€—æ—¶ï¼š%s"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ScanBigKey æ‰«æå¤§ key</span><span class="token comment">// maxMemory å•ä½ä¸º b</span><span class="token keyword">func</span> <span class="token function">ScanBigKey</span><span class="token punctuation">(</span>maxMemory <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span><span class="token keyword">if</span> maxMemory <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span class="token keyword">var</span> cursor <span class="token builtin">uint64</span><span class="token keyword">var</span> keys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>client <span class="token operator">:=</span> <span class="token function">NewRedisClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">defer</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>maxKeys <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">{</span><span class="token keyword">var</span> err <span class="token builtin">error</span>keys<span class="token punctuation">,</span> cursor<span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"æ‰«æå¤§ key å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// æ£€æŸ¥æ¯ä¸ªé”®çš„å†…å­˜å ç”¨æƒ…å†µ</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> keys <span class="token punctuation">{</span><span class="token comment">// memory å•ä½ä¸º byte</span>memory<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">MemoryUsage</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"è·å–é”® %s çš„å†…å­˜å ç”¨å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å¦‚æœå†…å­˜å ç”¨è¶…è¿‡æŒ‡å®šæœ€å¤§å†…å­˜æ—¶ï¼Œåˆ™æ‰“å°å‡ºæ¥</span><span class="token keyword">if</span> memory <span class="token operator">&gt;</span> maxMemory <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"é”® %s çš„å†…å­˜å ç”¨ä¸º %f MB"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token function">float64</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span>maxKeys <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>maxKeys<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// å¦‚æœ cursor ä¸º 0ï¼Œè¯´æ˜å·²ç»éå†å®Œæˆï¼Œé€€å‡ºå¾ªç¯</span><span class="token keyword">if</span> cursor <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span><span class="token keyword">break</span><span class="token punctuation">}</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"æ‰«æå¤§ key æ€»è€—æ—¶ï¼š%s"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span> maxKeys<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">ClearKeys</span><span class="token punctuation">(</span>keys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span>start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>client <span class="token operator">:=</span> <span class="token function">NewRedisClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">defer</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>pipe <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>pipe<span class="token punctuation">.</span><span class="token function">Unlink</span><span class="token punctuation">(</span>keys<span class="token operator">...</span><span class="token punctuation">)</span><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> pipe<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤ key å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤ key æ€»è€—æ—¶ï¼š%s"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">WriteKeysToFile</span><span class="token punctuation">(</span>keys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span>content <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token string">"./bigKey.txt"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-å¦‚ä½•ä¼˜åŒ–-Redis-çš„-Big-keyï¼Ÿ"><a href="#4-å¦‚ä½•ä¼˜åŒ–-Redis-çš„-Big-keyï¼Ÿ" class="headerlink" title="4. å¦‚ä½•ä¼˜åŒ– Redis çš„ Big keyï¼Ÿ"></a>4. å¦‚ä½•ä¼˜åŒ– Redis çš„ Big keyï¼Ÿ</h2><h3 id="æ•°æ®ç»“æ„ä¼˜åŒ–"><a href="#æ•°æ®ç»“æ„ä¼˜åŒ–" class="headerlink" title="æ•°æ®ç»“æ„ä¼˜åŒ–"></a>æ•°æ®ç»“æ„ä¼˜åŒ–</h3><ul><li>æ‹†åˆ†æ•°æ®ï¼šå°†å¤§ key æ‹†åˆ†ä¸ºæ›´å°çš„é”®ï¼Œè¿™å¯ä»¥é€šè¿‡æ‹†åˆ†æ•°æ®ç»“æ„æˆ–è€…å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡æ¥å®ç°ã€‚</li><li>é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼šä½¿ç”¨æ›´é€‚åˆä½ æ•°æ®å’Œä½¿ç”¨åœºæ™¯çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å°†åˆ—è¡¨ï¼ˆlistï¼‰è½¬æ¢ä¸ºé›†åˆï¼ˆsetï¼‰ã€å“ˆå¸Œï¼ˆhashï¼‰æˆ–æœ‰åºé›†åˆï¼ˆsorted setï¼‰ç­‰ã€‚</li></ul><h3 id="æ•°æ®æ¸…ç†"><a href="#æ•°æ®æ¸…ç†" class="headerlink" title="æ•°æ®æ¸…ç†"></a>æ•°æ®æ¸…ç†</h3><ul><li>å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ï¼šç¡®ä¿è¿‡æœŸæ•°æ®åŠæ—¶æ¸…ç†ï¼Œé¿å…æ— ç”¨æ•°æ®å ç”¨ç©ºé—´ã€‚</li><li>åˆ é™¤ä¸å¿…è¦çš„æ•°æ®ï¼šå®šæœŸæ¸…ç†ä¸å†éœ€è¦çš„æ•°æ®ï¼Œç¡®ä¿ Redis ä¸­ä¿ç•™çš„æ•°æ®æ—¶çœŸæ­£æœ‰ç”¨çš„ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœç›´æ¥ delï¼Œå¯èƒ½ä¼šå¯¼è‡´é˜»å¡ Redis æœåŠ¡ã€‚å¤§è‡´æœ‰ä»¥ä¸‹å¤„ç†æ–¹å¼ï¼š<ul><li>ä½¿ç”¨å¼‚æ­¥åˆ é™¤ï¼šä½¿ç”¨ <code>unlink</code> å¼‚æ­¥åˆ é™¤ï¼Œå¯ä»¥é¿å…é˜»å¡ Redis æœåŠ¡ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å†…å­˜å ç”¨å˜å¤§ã€‚</li><li>ä½¿ç”¨åˆ†æ‰¹åˆ é™¤ï¼šå°†å¤§é‡çš„åˆ é™¤æ“ä½œåˆ†æ‰¹è¿›è¡Œï¼Œæ¯æ¬¡åˆ é™¤ä¸€éƒ¨åˆ†ï¼Œç›´åˆ°åˆ é™¤å®Œæ¯•ã€‚</li></ul></li></ul><h3 id="å†…å­˜ä¼˜åŒ–"><a href="#å†…å­˜ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h3><ul><li>å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šè°ƒæ•´ Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œæ¯”å¦‚è®¾ç½® LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç­–ç•¥æ¥æ·˜æ±°ä¸å¸¸ç”¨çš„é”®ã€‚</li><li>å†…å­˜ä¼˜åŒ–é…ç½®ï¼šè°ƒæ•´ Redis çš„å†…å­˜é…ç½®å‚æ•°ï¼Œæ¯”å¦‚é€‚å½“è°ƒæ•´ <code>maxmemory</code> å‚æ•°ï¼Œé¿å…å†…å­˜è¶…é™é—®é¢˜ã€‚</li></ul><blockquote><p><a href="pudongping.github.io">åŸæ–‡åœ°å€</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ</title>
      <link href="posts/ddef4649.html"/>
      <url>posts/ddef4649.html</url>
      
        <content type="html"><![CDATA[<h1 id="Python-ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ"><a href="#Python-ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="Python ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ"></a>Python ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ</h1><p>Python éœ€è¦ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒçš„ä¸»è¦åŸå› åŒ…æ‹¬ï¼š</p><ol><li>éš”ç¦»é¡¹ç›®ä¾èµ–ï¼šè™šæ‹Ÿç¯å¢ƒå…è®¸æ‚¨åœ¨ä¸åŒçš„é¡¹ç›®ä¹‹é—´éš”ç¦»ä¾èµ–å…³ç³»ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒï¼Œä»¥ç¡®ä¿é¡¹ç›®çš„ä¾èµ–ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚è¿™å¯¹äºå¼€å‘å¤šä¸ªé¡¹ç›®æˆ–ç»´æŠ¤é¡¹ç›®çš„ä¸åŒç‰ˆæœ¬éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢ä¾èµ–å†²çªã€‚</li><li>ç‰ˆæœ¬ç®¡ç†ï¼šè™šæ‹Ÿç¯å¢ƒå…è®¸æ‚¨åœ¨ä¸åŒçš„é¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„ Python ç‰ˆæœ¬ã€‚è¿™å¯¹äºéœ€è¦æ”¯æŒä¸åŒ Python ç‰ˆæœ¬çš„é¡¹ç›®éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæ‚¨å¯ä»¥åœ¨ä¸åŒçš„è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…å’Œä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ Pythonã€‚</li><li>é˜²æ­¢å…¨å±€ä¾èµ–æ±¡æŸ“ï¼šå¦‚æœæ‚¨åœ¨å…¨å±€ Python ç¯å¢ƒä¸­å®‰è£…ä¾èµ–é¡¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¨å±€ä¾èµ–é¡¹çš„æ··ä¹±ï¼Œç”šè‡³å¯èƒ½ç ´åç³»ç»Ÿä¾èµ–é¡¹ã€‚è™šæ‹Ÿç¯å¢ƒå°†é¡¹ç›®çš„ä¾èµ–é¡¹éš”ç¦»åˆ°é¡¹ç›®æœ¬èº«çš„ç›®å½•ä¸­ï¼Œä»è€Œé¿å…äº†è¿™ç§æƒ…å†µã€‚</li><li>ç®¡ç†ä¾èµ–é¡¹ï¼šè™šæ‹Ÿç¯å¢ƒå…è®¸æ‚¨åœ¨é¡¹ç›®çº§åˆ«ç®¡ç†ä¾èµ–é¡¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ pip æ¥å®‰è£…ã€å‡çº§å’Œå¸è½½ä¾èµ–é¡¹ï¼Œè€Œä¸ä¼šå½±å“å…¨å±€ Python ç¯å¢ƒã€‚</li><li>ç®€åŒ–éƒ¨ç½²ï¼šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å°†é¡¹ç›®åŠå…¶ä¾èµ–é¡¹æ‰“åŒ…å¹¶éƒ¨ç½²åˆ°å…¶ä»–ç¯å¢ƒä¸­ï¼Œè€Œä¸å¿…æ‹…å¿ƒä¾èµ–å†²çªæˆ–ç‰ˆæœ¬é—®é¢˜ã€‚</li></ol><h2 id="Pipenv"><a href="#Pipenv" class="headerlink" title="Pipenv"></a><a href="https://github.com/pypa/pipenv">Pipenv</a></h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…¨å±€å®‰è£…ï¼Œå¦‚æœåªæƒ³åœ¨å½“å‰ç”¨æˆ·æ¨¡å¼ä¸‹å®‰è£…ï¼Œå¯æ·»åŠ å‚æ•° `--user`</span>pip3 <span class="token function">install</span> pipenv<span class="token comment"># æ›´æ–° pipenv</span>pip3 <span class="token function">install</span> <span class="token parameter variable">--user</span> <span class="token parameter variable">--upgrade</span> pipenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ python3 ç‰ˆæœ¬</span>python3 <span class="token parameter variable">--version</span><span class="token comment"># å‡è®¾æ˜¯ Python 3.11.4</span><span class="token comment"># æŒ‡å®šä½¿ç”¨ python 3.11.4 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span>pipenv <span class="token parameter variable">--python</span> <span class="token number">3.11</span>.4<span class="token comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>pipenv shell<span class="token comment"># é€€å‡ºå½“å‰è™šæ‹Ÿç¯å¢ƒ</span><span class="token builtin class-name">exit</span><span class="token comment"># åˆ é™¤å½“å‰è™šæ‹Ÿç¯å¢ƒ</span>pipenv <span class="token parameter variable">--rm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸‹è½½ä¾èµ–åŒ…"><a href="#ä¸‹è½½ä¾èµ–åŒ…" class="headerlink" title="ä¸‹è½½ä¾èµ–åŒ…"></a>ä¸‹è½½ä¾èµ–åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½ Pipfile æ–‡ä»¶ä¸­çš„æ‰€æœ‰åŒ…</span>pipenv <span class="token function">install</span><span class="token comment"># å®‰è£… requests æ’ä»¶åŒ…å¹¶åŠ å…¥åˆ° Pipfile</span>pipenv <span class="token function">install</span> requests<span class="token comment"># å®‰è£…å›ºå®šç‰ˆæœ¬çš„ requests</span>pipenv <span class="token function">install</span> <span class="token assign-left variable">requests</span><span class="token operator">==</span><span class="token number">2.22</span>.0<span class="token comment"># åªå®‰è£…å¼€å‘ç¯å¢ƒæ‰ä¼šä½¿ç”¨åˆ°çš„åŒ…</span>pipenv <span class="token function">install</span> <span class="token punctuation">{</span>package-name<span class="token punctuation">}</span> <span class="token parameter variable">--dev</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ›´æ–°ä¾èµ–åŒ…"><a href="#æ›´æ–°ä¾èµ–åŒ…" class="headerlink" title="æ›´æ–°ä¾èµ–åŒ…"></a>æ›´æ–°ä¾èµ–åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹æ‰€æœ‰éœ€è¦æ›´æ–°çš„ä¾èµ–</span>pipenv update <span class="token parameter variable">--outdated</span><span class="token comment"># æ›´æ–°æ‰€æœ‰åŒ…çš„ä¾èµ–é¡¹</span>pipenv update<span class="token comment"># æ›´æ–°æŒ‡å®šåŒ…çš„ä¾èµ–é¡¹</span>pipenv update <span class="token punctuation">{</span>package-name<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸è½½ä¾èµ–åŒ…"><a href="#å¸è½½ä¾èµ–åŒ…" class="headerlink" title="å¸è½½ä¾èµ–åŒ…"></a>å¸è½½ä¾èµ–åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¸è½½æŒ‡å®šæ¨¡å—</span>pipenv uninstall <span class="token punctuation">{</span>package-name<span class="token punctuation">}</span><span class="token comment"># å¸è½½å…¨éƒ¨åŒ…</span>pipenv uninstall <span class="token parameter variable">--all</span><span class="token comment"># å¸è½½å…¨éƒ¨å¼€å‘ç¯å¢ƒæ‰€éœ€è¦ä¾èµ–çš„åŒ…</span>pipenv uninstall --all-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…¶ä»–å¸¸ç”¨å‘½ä»¤"><a href="#å…¶ä»–å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å…¶ä»–å¸¸ç”¨å‘½ä»¤"></a>å…¶ä»–å¸¸ç”¨å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ˜¾ç¤ºç›®å½•ä¿¡æ¯</span>pipenv <span class="token parameter variable">--where</span><span class="token comment"># æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span>pipenv <span class="token parameter variable">--venv</span><span class="token comment"># æ˜¾ç¤º python è§£é‡Šå™¨ä¿¡æ¯</span>pipenv <span class="token parameter variable">--py</span><span class="token comment"># æŸ¥çœ‹å½“å‰å®‰è£…çš„åº“åŠå…¶ä¾èµ–</span>pipenv graph<span class="token comment"># æ£€æŸ¥å®‰å…¨æ¼æ´</span>pipenv check<span class="token comment"># ç”Ÿæˆ Pipfile.lock æ–‡ä»¶</span>pipenv lock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°† Pipfile å’Œ Pipfile.lock æ–‡ä»¶é‡Œé¢çš„åŒ…å¯¼å‡ºä¸º requirements.txt æ–‡ä»¶</span>pipenv run pip freeze <span class="token operator">&gt;</span> requirements.txt<span class="token comment"># æˆ–è€…</span>pipenv requirements <span class="token operator">&gt;</span> requirements.txt<span class="token comment"># åªä½¿ç”¨ `pipenv install` æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰ç›®å½•ä¸‹çš„ requirements.txt å¹¶ç”Ÿæˆ Pipfile æ–‡ä»¶</span><span class="token comment"># é€šè¿‡ requirements.txt å®‰è£…åŒ…</span>pipenv <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt<span class="token comment"># åªå®‰è£…å¼€å‘ç¯å¢ƒæ‰€éœ€è¦çš„åŒ…</span>pipenv <span class="token function">install</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">--dev</span> requirements.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python3 </tag>
            
            <tag> Pip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¤è¯†ä¸‹ JWT</title>
      <link href="posts/22722346.html"/>
      <url>posts/22722346.html</url>
      
        <content type="html"><![CDATA[<h1 id="è®¤è¯†ä¸‹-JWT"><a href="#è®¤è¯†ä¸‹-JWT" class="headerlink" title="è®¤è¯†ä¸‹ JWT"></a>è®¤è¯†ä¸‹ JWT</h1><p><a href="https://jwt.io/">JWT</a> æ˜¯ JSON Web Token çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªéå¸¸è½»å·§çš„è§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ JWT åœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯ã€‚<br>JWT ç”±å¤´éƒ¨ï¼ˆheaderï¼‰ã€è½½è·ï¼ˆpayloadï¼‰ä¸ç­¾åï¼ˆsignatureï¼‰ç»„æˆï¼Œä¸€ä¸ª JWT ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">{</span>    <span class="token string">"typ"</span><span class="token builtin class-name">:</span><span class="token string">"JWT"</span>,    <span class="token string">"alg"</span><span class="token builtin class-name">:</span><span class="token string">"HS256"</span><span class="token punctuation">}</span><span class="token punctuation">{</span>    <span class="token string">"iss"</span><span class="token builtin class-name">:</span><span class="token string">"http://localhost"</span>,    <span class="token string">"iat"</span>:1587000625,    <span class="token string">"exp"</span>:1618536625,    <span class="token string">"nbf"</span>:1587000625,    <span class="token string">"jti"</span><span class="token builtin class-name">:</span><span class="token string">"iCxsfo97UVUijjjP"</span>,    <span class="token string">"sub"</span>:1,    <span class="token string">"prv"</span><span class="token builtin class-name">:</span><span class="token string">"13e8d028b391f3b7b63f21933dbad458ff21072e"</span><span class="token punctuation">}</span>signature<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¤´éƒ¨å£°æ˜äº†åŠ å¯†ç®—æ³•ï¼›</li><li>è½½è·ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ•°æ®ï¼Œ<code>exp</code> æ˜¯è¿‡æœŸæ—¶é—´ï¼Œ<code>sub</code> æ˜¯ JWT çš„ä¸»ä½“ï¼Œè¿™é‡Œå°±æ˜¯ç”¨æˆ·çš„ idï¼›<ul><li>audï¼ˆAudienceï¼‰ï¼šå—ä¼—ï¼Œä¹Ÿå°±æ˜¯æ¥å— JWT çš„ä¸€æ–¹ã€‚</li><li>expï¼ˆExpiresAtï¼‰ï¼šæ‰€ç­¾å‘çš„ JWT è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´å¿…é¡»å¤§äºç­¾å‘æ—¶é—´ã€‚</li><li>jtiï¼ˆJWT Idï¼‰ï¼šJWT çš„å”¯ä¸€æ ‡è¯†ã€‚</li><li>iatï¼ˆIssuedAtï¼‰ï¼šç­¾å‘æ—¶é—´</li><li>issï¼ˆIssuerï¼‰ï¼šJWT çš„ç­¾å‘è€…ã€‚</li><li>nbfï¼ˆNot Beforeï¼‰ï¼šJWT çš„ç”Ÿæ•ˆæ—¶é—´ï¼Œå¦‚æœæœªåˆ°è¿™ä¸ªæ—¶é—´åˆ™ä¸ºä¸å¯ç”¨ã€‚</li><li>subï¼ˆSubjectï¼‰ï¼šä¸»é¢˜</li></ul></li><li>æœ€åçš„ signature æ˜¯ç”±æœåŠ¡å™¨è¿›è¡Œçš„ç­¾åï¼Œä¿è¯äº† token ä¸è¢«ç¯¡æ”¹ã€‚</li></ul><p>signature ç­¾åçš„ç”Ÿæˆå…¬å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">HMACSHA256<span class="token punctuation">(</span>  base64UrlEncode<span class="token punctuation">(</span>header<span class="token punctuation">)</span> + <span class="token string">"."</span> +  base64UrlEncode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>,  secret<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>JWT æœ€åæ˜¯é€šè¿‡ Base64 ç¼–ç çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚æ‰€ä»¥ä¸è¦åœ¨ JWT ä¸­å­˜æ”¾ä¸€äº›æ•æ„Ÿä¿¡æ¯ã€‚</p></blockquote><p>ç”¨æˆ· idï¼Œè¿‡æœŸæ—¶é—´ç­‰æ•°æ®éƒ½ä¿å­˜åœ¨ Token ä¸­äº†ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å°† Token ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™åœ¨ Header ä¸­æºå¸¦ Tokenï¼ŒæœåŠ¡å™¨è·å– Token åï¼Œè¿›è¡Œ <code>base64_decode</code>  å³å¯è·å–æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œç”±äºå·²ç»æœ‰äº†ç­¾åï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒæ•°æ®è¢«ç¯¡æ”¹ã€‚</p><h3 id="Token-éªŒè¯"><a href="#Token-éªŒè¯" class="headerlink" title="Token éªŒè¯"></a>Token éªŒè¯</h3><p>æœ‰äº† token ä¹‹åè¯¥å¦‚ä½•éªŒè¯ token çš„æœ‰æ•ˆæ€§ï¼Œå¹¶å¾—åˆ° token å¯¹åº”çš„ç”¨æˆ·å‘¢ï¼Ÿå…¶å®åŸç†å¾ˆç®€å•ï¼ŒLaravel ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº† <code>auth</code> è¿™ä¸ªä¸­é—´ä»¶</p><ol><li>è·å–å®¢æˆ·ç«¯æäº¤çš„ token</li><li>æ£€æµ‹ token ä¸­çš„ç­¾å signature æ˜¯å¦æ­£ç¡®</li><li>åˆ¤æ–­ payload æ•°æ®ä¸­çš„ expï¼Œæ˜¯å¦å·²ç»è¿‡æœŸ</li><li>æ ¹æ® payload æ•°æ®ä¸­çš„ subï¼Œå–æ•°æ®åº“ä¸­éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨</li><li>ä¸Šè¿°æ£€æµ‹ä¸æ­£ç¡®ï¼Œåˆ™æŠ›å‡ºç›¸åº”å¼‚å¸¸</li></ol><h3 id="å®‰è£…-jwt-auth"><a href="#å®‰è£…-jwt-auth" class="headerlink" title="å®‰è£… jwt-auth"></a>å®‰è£… jwt-auth</h3><p><a href="https://github.com/tymondesigns/jwt-auth">jwt-auth</a> æ˜¯ Laravel å’Œ lumen çš„ JWT ç»„ä»¶ï¼Œé¦–å…ˆæ¥å®‰è£…ä¸€ä¸‹ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">composer</span> require tymon/jwt-auth<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸‹ JWT çš„ secretï¼Œè¿™ä¸ª secret å¾ˆé‡è¦ï¼Œç”¨äºæœ€åçš„ç­¾åï¼Œæ›´æ¢è¿™ä¸ª secret ä¼šå¯¼è‡´ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ token æ— æ•ˆã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan jwt:secret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨ .env æ–‡ä»¶ä¸­ï¼Œå¢åŠ äº†ä¸€è¡Œ <code>JWT_SECRET</code>ã€‚<br>ä¿®æ”¹ config/auth.phpï¼Œå°† <code>api guard</code> çš„ <code>driver</code> æ”¹ä¸º <code>jwt</code>ã€‚</p><p>config/auth.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token string single-quoted-string">'guards'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'web'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'session'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'provider'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'api'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'jwt'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'provider'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>user æ¨¡å‹éœ€è¦ç»§æ‰¿ <code>Tymon\JWTAuth\Contracts\JWTSubject</code> æ¥å£ï¼Œå¹¶å®ç°æ¥å£çš„ä¸¤ä¸ªæ–¹æ³• <code>getJWTIdentifier()</code> å’Œ <code>getJWTCustomClaims()</code>ã€‚</p><p>app\Models\User.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Auth</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Spatie<span class="token punctuation">\</span>Permission<span class="token punctuation">\</span>Traits<span class="token punctuation">\</span>HasRoles</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Tymon<span class="token punctuation">\</span>JWTAuth<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>JWTSubject</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notifiable</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>MustVerifyEmail</span> <span class="token keyword">as</span> MustVerifyEmailTrait<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>MustVerifyEmail</span> <span class="token keyword">as</span> MustVerifyEmailContract<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span> <span class="token keyword">implements</span> <span class="token class-name">MustVerifyEmailContract</span><span class="token punctuation">,</span> JWTSubject    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getJWTIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getJWTCustomClaims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>getJWTIdentifier</code> è¿”å›äº† User çš„ idï¼Œ<code>getJWTCustomClaims</code> æ˜¯æˆ‘ä»¬éœ€è¦é¢å¤–åœ¨ JWT è½½è·ä¸­å¢åŠ çš„è‡ªå®šä¹‰å†…å®¹ï¼Œè¿™é‡Œè¿”å›ç©ºæ•°ç»„ã€‚æ‰“å¼€ tinkerï¼Œæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œå°è¯•ç”Ÿæˆä¸€ä¸ª tokenã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">guard</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'api'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>jwt-auth</code> æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼Œå¯ä»¥åœ¨ .env ä¸­è¿›è¡Œè®¾ç½®</p><ul><li><code>JWT_TTL</code> ç”Ÿæˆçš„ token åœ¨å¤šå°‘åˆ†é’Ÿåè¿‡æœŸï¼Œé»˜è®¤ 60 åˆ†é’Ÿ</li><li><code>JWT_REFRESH_TTL</code>   ç”Ÿæˆçš„ tokenï¼Œåœ¨å¤šå°‘åˆ†é’Ÿå†…ï¼Œå¯ä»¥åˆ·æ–°è·å–ä¸€ä¸ªæ–° tokenï¼Œé»˜è®¤ 20160 åˆ†é’Ÿï¼Œ14 å¤©ã€‚</li></ul><p>è¿™é‡Œéœ€è¦ç†è§£ä¸€ä¸‹ JWT çš„è¿‡æœŸå’Œåˆ·æ–°æœºåˆ¶ï¼Œè¿‡æœŸå¾ˆå¥½ç†è§£ï¼Œè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œtoken å°±æ— æ•ˆäº†ã€‚åˆ·æ–°æ—¶é—´ä¸€èˆ¬æ¯”è¿‡æœŸæ—¶é—´é•¿ï¼Œåªè¦åœ¨è¿™ä¸ªåˆ·æ–°æ—¶é—´å†…ï¼Œå³ä½¿ token è¿‡æœŸäº†ï¼Œ ä¾ç„¶å¯ä»¥æ¢å–ä¸€ä¸ªæ–°çš„ tokenï¼Œä»¥è¾¾åˆ°åº”ç”¨é•¿æœŸå¯ç”¨ï¼Œä¸éœ€è¦é‡æ–°ç™»å½•çš„ç›®çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç§‘æ™® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ æ„¿æ„èŠ±åŠä¸ªå°æ—¶æ—¶é—´å¾—åˆ°ä¸€ä¸ªç»ˆèº«å—ç›Šçš„æŠ€èƒ½å—</title>
      <link href="posts/7c4e8ab6.html"/>
      <url>posts/7c4e8ab6.html</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆæˆ‘ä»¬ç”¨ 3 ç§’æ—¶é—´æ¥é—­ç›®æ€è€ƒä¸€ä¸‹ï¼ŒåŠä¸ªå°æ—¶æˆ‘ä»¬å¯ä»¥åšå“ªäº›äº‹æƒ…ï¼Ÿ3 2 1 å¥½ï¼Œæ—¶é—´åˆ°ã€‚ç›¸ä¿¡ä½ å·²ç»æœ‰äº†ä½ è‡ªå·±çš„ç­”æ¡ˆï¼Œè€Œä»Šå¤©æˆ‘è¦ç»™å¤§å®¶ä»‹ç»çš„æ˜¯å¯ä»¥ç”¨åŠä¸ªå°æ—¶å°±èƒ½å¤Ÿå¿«é€ŸæŒæ¡çš„ä¸€é¡¹æŠ€èƒ½ï¼šç”¨åŒæ‹¼æ‰“å­—ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯åŒæ‹¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åŒæ‹¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŒæ‹¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åŒæ‹¼ï¼Ÿ</h2><blockquote><p>åŒæ‹¼æ˜¯æ±‰è¯­æ‹¼éŸ³è¾“å…¥æ³•çš„ä¸€ç§ç¼–ç æ–¹æ¡ˆã€‚ç›¸å¯¹äºå…¨æ‹¼è€Œè¨€ï¼Œä½¿ç”¨åŒæ‹¼è¾“å…¥æ±‰å­—æ—¶åªéœ€è¾“å…¥ä¸€ä¸ªä»£è¡¨å£°æ¯çš„å­—æ¯ï¼Œä¸€ä¸ªä»£è¡¨éŸµæ¯çš„å­—æ¯ï¼Œå°±å¯ä»¥æ‰“å‡ºä»»æ„ä¸€ä¸ªä¸­æ–‡å­—äº†ã€‚ï¼ˆæ‘˜æŠ„è‡ªç»´åŸºç™¾ç§‘ï¼‰</p></blockquote><p>å¬ç€è¿˜æ˜¯æœ‰äº›æ‡µï¼Ÿåˆ«æ…Œï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­å°±æ›´å¥½ç†è§£äº†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“æ±‰å­—çš„æ‹¼éŸ³æ˜¯ç”±å£°æ¯å’ŒéŸµæ¯ç»„åˆè€Œæˆï¼Œæ¯”å¦‚è¯´ï¼Œã€ŒåŒæ‹¼ã€ è¿™ä¸ªè¯çš„å®Œæ•´æ‹¼éŸ³ä¸ºã€Œshuang pinã€ï¼Œå‡è®¾æˆ‘ä»¬ä¸å€ŸåŠ©ä»»ä½•æ™ºèƒ½æ‹¼éŸ³è¾“å…¥æ³•ï¼Œæˆ‘ä»¬ç”¨å…¨æ‹¼å°†è¿™ä¸ªè¯æ‰“å‡ºæ¥è¦æŒ‰ 6 + 3 = 9 æ¬¡é”®ç›˜ã€‚æ˜¯ä¸æ˜¯è¿˜æ˜¯æœ‰ç‚¹è´¹åŠ²å„¿æ¥ç€ï¼Ÿå¥½ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±ä¼šæƒ³ï¼Œæ—¢ç„¶æˆ‘ä»¬éƒ½å·²ç»çŸ¥é“æ‹¼éŸ³æ˜¯ç”±å£°æ¯å’ŒéŸµæ¯ç»„åˆè€Œæˆï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å°±å¯ä»¥è€ƒè™‘ç”¨ä¸€äº›é”®ä½è¡¨ç¤ºå£°æ¯ï¼Œä¸€äº›é”®ä½è¡¨ç¤ºéŸµæ¯ï¼Œæ‰“å­—çš„æ—¶å€™åªéœ€è¦å°†äºŒè€…ä¿©ä¿©ç»„åˆèµ·æ¥å³å¯å‘¢ï¼Ÿäº‹å®ä¸Šï¼ŒçœŸå¯ä»¥è¿™ä¹ˆåšï¼Œè¿™å°±æ˜¯åŒæ‹¼ã€‚ä»¥ã€Œshuang pinã€ ä¸ºä¾‹ï¼Œå‡è®¾é”®ä½ <code>u</code> ä»£è¡¨ <code>sh</code>ã€<code>l</code> è¡¨ç¤º <code>uang</code>ã€<code>p</code> ä»£è¡¨ <code>p</code>ã€<code>b</code> ä»£è¡¨ <code>in</code>ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬æƒ³æ‰“ã€ŒåŒæ‹¼ã€äºŒå­—æ—¶ï¼Œæˆ‘ä»¬å°±åªéœ€è¦æŒ‰ã€Œulpbã€è¿™å››ä¸ªé”®ä½ï¼ŒæŒ‰ 4 æ¬¡é”®ç›˜å³å¯ï¼Œè¿™ç›¸æ¯”åŸæ¥æŒ‰ 9 æ¬¡é”®ç›˜è¿˜æ˜¯é«˜æ•ˆäº†ä¸å°‘ã€‚</p><h2 id="ç»™æˆ‘ä¸€ä¸ªä½¿ç”¨åŒæ‹¼çš„ç†ç”±ï¼Ÿ"><a href="#ç»™æˆ‘ä¸€ä¸ªä½¿ç”¨åŒæ‹¼çš„ç†ç”±ï¼Ÿ" class="headerlink" title="ç»™æˆ‘ä¸€ä¸ªä½¿ç”¨åŒæ‹¼çš„ç†ç”±ï¼Ÿ"></a>ç»™æˆ‘ä¸€ä¸ªä½¿ç”¨åŒæ‹¼çš„ç†ç”±ï¼Ÿ</h2><p>å¦‚æœä½ æ˜¯æ–‡å­—å·¥ä½œè€…ï¼Œé€‰æ‹©åŒæ‹¼å¯ä»¥è®©ä½ ä¸ç”¨åƒä»¥å‰ä¸€æ ·é«˜å¼ºåº¦çš„å¤§é‡å‡»é”®ï¼Œæ‰“å­—æ—¶ï¼ŒèŠ‚å¥æ›´åŠ é½æ•´ã€‚ï¼ˆä½¿ç”¨åŒæ‹¼æ‰“å­—çš„èŠ‚å¥ç±»ä¼¼ï¼šå’šå’šå“’ï¼Œå’šå’šå“’â€¦â€¦ï¼Œå…¨æ‹¼çš„èŠ‚å¥ç±»ä¼¼ï¼šå’šå“’ã€å’šå’šå“’ã€å“’å“’â€¦â€¦ï¼‰</p><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªçƒ­çˆ±å°è¯•æ–°é²œäº‹ç‰©çš„äººï¼Œé‚£ä¹ˆå­¦ä¼šåŒæ‹¼ä¼šè®©ä½ åˆå¢åŠ ä¸€é¡¹æ–°æŠ€èƒ½ã€‚å°±åƒå­¦éœ¸é’ˆå¯¹ä¸€é“æ•°å­¦é¢˜æœ‰å¥½å‡ ç§è§£æ³•ä¸€æ ·ã€‚</p><p>åŒæ‹¼è™½ä¸æ˜¯æŸé¡¹åŸºç¡€ç”Ÿå­˜å¿…å¤‡èƒ½åŠ›ï¼Œä½ ä¸å­¦å¹¶ä¸ä¼šæŸå¤±ä»€ä¹ˆï¼Œä½†æ˜¯å®ƒç¡®å®æ˜¯ä¸€é¡¹ä½ ä¸éœ€è¦èŠ±è´¹å¤šå¤§åŠªåŠ›å°±å¯ä»¥è½»æ¾å­¦ä¼šçš„æŠ€èƒ½ã€‚ä¸å¦¨è¯•è¯•ï¼Œçœ‹ä¸€çœ‹å­¦ä¼šåŒæ‹¼èƒ½ç»™ä½ å’Œä½ çš„ç”Ÿæ´»å¸¦æ¥å¤šå°‘å˜åŒ–ã€‚</p><h2 id="åŒæ‹¼å’Œå…¨æ‹¼å„è‡ªä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#åŒæ‹¼å’Œå…¨æ‹¼å„è‡ªä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="åŒæ‹¼å’Œå…¨æ‹¼å„è‡ªä¼˜ç¼ºç‚¹ï¼Ÿ"></a>åŒæ‹¼å’Œå…¨æ‹¼å„è‡ªä¼˜ç¼ºç‚¹ï¼Ÿ</h2><p>è¯´åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹æ—¥å¸¸æ‰“å­—æ—¶çš„æµç¨‹ï¼š</p><ol><li>è®¤è¯»</li><li>è¾“å…¥æ‹¼éŸ³</li><li>ç¿»é¡µ</li><li>é€‰å­—</li></ol><p>æ ¹æ®ä»¥ä¸Šçš„æµç¨‹å¯çœ‹å‡ºï¼Œå½±å“æ‰“å­—é€Ÿåº¦å¿«æ…¢ä¸»è¦å–å†³äºç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹ã€‚æ‰“ä¸€ä¸ªå­—æ—¶ï¼Œä½¿ç”¨å…¨æ‹¼ï¼Œè¿™ä¸ªå­—çš„æ‹¼éŸ³é•¿åº¦æœ‰å¤šå°‘ï¼Œé‚£ä¹ˆåˆ™éœ€è¦æ•²å‡»å¤šå°‘æ¬¡é”®ä½ï¼Œè€ŒåŒæ‹¼æ°¸è¿œå›ºå®šçš„åªéœ€è¦æ•²å‡»ä¸¤æ¬¡é”®ä½ï¼Œè¿™è®©å‡»é”®çš„èŠ‚å¥æ›´åŠ é½æ•´ã€‚æ‰“å­—æ—¶ï¼Œé€‚å½“çš„èŠ‚å¥å¯ä»¥è®©è¾“å‡ºæ›´åŠ æµç•…ã€‚ä½†æ˜¯åœ¨é€‰å­—é˜¶æ®µæ—¶ï¼Œå› ä¸ºæ‹¼éŸ³æ‰“å­—é‡ç ç‡æœ¬èº«å°±æ¯”è¾ƒé«˜ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬æ‰“ ã€Œyiã€æ—¶ï¼Œå€™é€‰é¡¹å°±ä¼šå‡ºç°å¾ˆå¤šä¸ªï¼Œè¿™æ˜¯å…¨æ‹¼å’ŒåŒæ‹¼éƒ½ä¼šå­˜åœ¨çš„ç—›ç‚¹ã€‚ä½†æ˜¯ä¸ç®¡å…¨æ‹¼è¿˜æ˜¯åŒæ‹¼éƒ½å±äºæ‹¼éŸ³æ‰“å­—ï¼Œå› æ­¤åªè¦ä½ ä¼šæ‹¼éŸ³ï¼Œé‚£ä¹ˆå­¦ä¹ æˆæœ¬å°±ä¸ä¼šå¤ªé«˜ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨åŒæ‹¼æ‰“å­—ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨åŒæ‹¼æ‰“å­—ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨åŒæ‹¼æ‰“å­—ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨åŒæ‹¼æ‰“å­—ï¼Ÿ</h2><p>æˆ‘ä»¬å…ˆæŠ“ä½åŒæ‹¼çš„æ ¸å¿ƒï¼šåŸºäºæ‹¼éŸ³ï¼Œç”¨ä¸¤ä¸ªé”®ä½å¯¹åº”å£°æ¯å’ŒéŸµæ¯ã€‚æ‰“å­—æ—¶ï¼Œå…ˆå°†åŸæ¥çš„å…¨æ‹¼æ‹†åˆ†æˆå£°æ¯éƒ¨åˆ†å’ŒéŸµæ¯éƒ¨åˆ†ï¼ŒåŒæ‹¼çš„ç¬¬ä¸€ä¸ªé”®ç”¨æ¥è¾“å…¥å£°æ¯ï¼Œç¬¬äºŒä¸ªé”®ç”¨æ¥è¾“å…¥éŸµæ¯ï¼Œæ€»å…±æ•²å‡» 2 æ¬¡é”®ä½å³å¯æˆå­—ã€‚</p><p>ç¬¬ä¸€ä¸ªé”® â€”â€” å£°æ¯</p><ul><li>å•å£°æ¯ï¼šå¦‚qã€wã€rã€tã€yç­‰ç­‰ï¼Œè¿™äº›ç›´æ¥ä¸é”®ç›˜ä¸Šçš„æŒ‰é”®ç›¸å¯¹åº”ã€‚</li><li>åŒå£°æ¯ï¼šzhã€chã€shï¼Œä½¿ç”¨æŸä¸ªå•éŸµæ¯çš„é”®ä¸ä¹‹å¯¹åº”ï¼Œæ¯”å¦‚ zh-vã€ch-iã€sh-uã€‚å› ä¸ºåŒæ‹¼çš„åŸåˆ™æ˜¯ç¬¬ä¸€ä¸ªé”®ä¸ºå£°æ¯ï¼Œæ‰€ä»¥ç”¨æˆ·å¦‚æœåœ¨ç¬¬ä¸€ä¸ªé”®ä¸ŠæŒ‰äº†éŸµæ¯ï¼Œé‚£ä¹ˆä¸€å®šå°±æ˜¯éœ€è¦è½¬æ¢çš„éå•å£°æ¯äº†ã€‚</li><li>æ— å£°æ¯ï¼šæœ‰ä¸€äº›æ‹¼éŸ³æ²¡æœ‰å£°æ¯ï¼Œæ¯”å¦‚ï¼Œã€Œå®‰ã€ï¼ˆanï¼‰ï¼Œç”±äºåŒæ‹¼çš„åŸåˆ™æ˜¯ä¸€å®šè¦ç”¨ä¸¤ä¸ªé”®è¾“å…¥ä¸€ä¸ªå­—ï¼Œä¸èƒ½æŠŠå£°æ¯çš„ä½ç½®ç©ºå‡ºæ¥ï¼Œæ‰€ä»¥å¿…é¡»ç»™è¿™ç§ç±»å‹çš„æ‹¼éŸ³å•ç‹¬è€ƒè™‘ã€‚ä¸€èˆ¬æœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼šç¬¬ä¸€ç§æ˜¯å¾®è½¯åŒæ‹¼ç­‰é‡‡ç”¨çš„ï¼Œå›ºå®šè®¾å®šä¸€ä¸ªéŸµæ¯é”®åšã€Œé›¶å£°æ¯ã€é”®æ¥è¡¥å…¨å£°æ¯ï¼›ç¬¬äºŒç§æ˜¯å°é¹¤åŒæ‹¼ç­‰é‡‡ç”¨çš„åˆ†æƒ…å†µè€ƒè™‘ï¼š1ã€å¦‚æœæ˜¯å•å£°æ¯ï¼Œå¦‚ï¼šå“¦ï¼ˆoï¼‰ï¼Œè¿è¾“ä¸¤ééŸµæ¯ï¼ˆooï¼‰ã€‚2ã€å¦‚æœæ˜¯åŒå£°æ¯ï¼Œå¦‚ï¼šçˆ±ï¼ˆaiï¼‰ï¼Œç›´æ¥æ‰“æ‹¼éŸ³ï¼ˆaiï¼‰ã€‚3ã€å¦‚æœæ˜¯ä¸¤ä½ä»¥ä¸Šçš„éŸµæ¯ï¼Œå¦‚ï¼šæ˜‚ï¼ˆangï¼‰ï¼Œç”¨éŸµæ¯éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå­—ç¬¦é”®è¡¥å…¨å£°æ¯ï¼Œç¬¬äºŒä¸ªé”®æŒ‰éå•éŸµæ¯è½¬æ¢ï¼ˆahï¼‰ã€‚ï¼ˆè¿™é‡ŒéŸµæ¯ <code>ang</code> æ˜ å°„çš„é”®ä½ä¸º <code>h</code>ï¼‰ã€‚</li></ul><p>ç¬¬äºŒä¸ªé”® â€”â€” éŸµæ¯</p><ul><li>å•éŸµæ¯ï¼šå¦‚aã€oã€eã€iç­‰ç­‰ï¼Œä¸å•å£°æ¯çš„å¤„ç†æ–¹å¼ä¸€æ ·ï¼Œç›´æ¥ä¸é”®ç›˜ä¸Šçš„æŒ‰é”®ç›¸å¯¹åº”ã€‚</li><li>å…¶å®ƒçš„éŸµæ¯ï¼šå‡ç”±å•å£°æ¯çš„é”®ä¸ä¹‹å¯¹åº”ã€‚æŸäº›é”®è¿˜å¯ä»¥ä¸å¤šä¸ªéŸµæ¯å¯¹åº”ï¼Œå¦‚ï¼šä»¥å°é¹¤åŒæ‹¼ä¸ºä¾‹ x-ia/uaã€‚ä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿå› ä¸ºè¿™äº›éŸµæ¯éƒ½æ˜¯äº’æ–¥çš„ï¼Œèƒ½ä¸ <code>ia</code> ç»„åˆçš„å£°æ¯ä¸€å®šä¸èƒ½ä¸ <code>ua</code> ç»„åˆï¼Œåä¹‹äº¦ç„¶ã€‚å¦‚ï¼šèŠ±ï¼ˆhuaï¼‰ï¼Œä½†æ˜¯ <code>hia</code> æ‰“ä¸å‡ºå­—ï¼›å®¶ï¼ˆjiaï¼‰ï¼Œä½†æ˜¯ <code>jua</code> æ‰“ä¸å‡ºå­—ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‰“ã€Œçˆ±åŒæ‹¼ã€è¿™ä¸‰ä¸ªå­—æ—¶ï¼š</p><ul><li>çˆ± ai â€”â€” æ²¡æœ‰å£°æ¯ï¼ŒéŸµæ¯ä¸ºéå•éŸµæ¯ã€‚å°é¹¤åŒæ‹¼é‡‡ç”¨<strong>åˆ†æƒ…å†µè€ƒè™‘</strong>ï¼Œå› ä¸ºéŸµæ¯ä¸ºä¸¤ä½ï¼Œæ‰€ä»¥ç›´æ¥æ‰“æ‹¼éŸ³ï¼ˆaiï¼‰ï¼›å¾®è½¯åŒæ‹¼é‡‡ç”¨<strong>å•ç‹¬è®¾å®šé›¶å£°æ¯é”®</strong>ï¼Œå¾®è½¯åŒæ‹¼è®¾å®šçš„é›¶é”®ä¸º <code>o</code>ã€éŸµæ¯ <code>ai</code> æ˜ å°„çš„é”®ä½ä¸º <code>l</code>ï¼Œæ‰€ä»¥ä¸ºï¼ˆolï¼‰ã€‚</li><li>åŒ shuang â€”â€” å£°æ¯ä¸ºåŒå£°æ¯ï¼ŒéŸµæ¯ä¸ºéå•éŸµæ¯ï¼Œåˆ™å‡éœ€è½¬æ¢ã€‚ä»¥å°é¹¤åŒæ‹¼ä¸ºä¾‹ï¼Œå£°æ¯ <code>sh</code> æ˜ å°„ä¸º <code>u</code>ï¼ŒéŸµæ¯ <code>uang</code> æ˜ å°„ä¸º <code>l</code> æ‰€ä»¥ä¸º <code>ul</code>ã€‚</li><li>æ‹¼ pin â€”â€” å£°æ¯ä¸ºå•å£°æ¯ï¼Œä¸ç”¨è½¬æ¢ï¼ŒéŸµæ¯ä¸ºéå•éŸµæ¯ï¼Œéœ€è¦è½¬æ¢ã€‚ä»¥å°é¹¤åŒæ‹¼ä¸ºä¾‹ï¼Œå£°æ¯ <code>p</code> æ˜ å°„ä¸º <code>p</code>ï¼ŒéŸµæ¯ <code>in</code> æ˜ å°„ä¸º <code>b</code> æ‰€ä»¥ä¸º <code>pb</code>ã€‚</li></ul><h2 id="åŒæ‹¼æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ"><a href="#åŒæ‹¼æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="åŒæ‹¼æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ"></a>åŒæ‹¼æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</h2><ul><li>å¸¸è§çš„åŒæ‹¼æ–¹æ¡ˆï¼šå¾®è½¯ã€æ™ºèƒ½ABCã€åŠ åŠ ã€å°é¹¤ã€æœç‹—ã€ç´«å…‰ã€è‡ªç„¶ç â€¦â€¦</li><li>ä¸å¤ªå¸¸è§çš„åŒæ‹¼æ–¹æ¡ˆï¼šå›½æ ‡ï¼ˆä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡†ï¼‰ã€é›…æ­Œã€å¾æ°â€¦â€¦</li><li>çˆ±å¥½è€…åŒæ‹¼æ–¹æ¡ˆï¼šå°æµªã€å¤§ç‰›ã€æ˜Ÿç©ºâ€¦â€¦</li></ul><h2 id="ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸åŒçš„æ–¹æ¡ˆå‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸åŒçš„æ–¹æ¡ˆå‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸åŒçš„æ–¹æ¡ˆå‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸åŒçš„æ–¹æ¡ˆå‘¢ï¼Ÿ</h2><p>åŒæ‹¼çš„è¾“å…¥æ¦‚å¿µæ˜¯ï¼šå°†å…¨æ‹¼æ‹†åˆ†æˆå£°æ¯éƒ¨åˆ†å’ŒéŸµæ¯éƒ¨åˆ†ï¼Œç„¶åç”¨ä¸€å¥—è§„åˆ™å»è§„å®šå„ä¸ªå£°éŸµæ¯ä¸å„ä¸ªé”®çš„å¯¹åº”å…³ç³»ï¼Œè¿™æ˜¯æ¯ä¸€å¥—æ–¹æ¡ˆéƒ½éµå¾ªçš„æ ¸å¿ƒåŸåˆ™ã€‚é‚£ä¹ˆï¼Œåœ¨è¿™ä¸ªæ ¸å¿ƒæ¦‚å¿µçš„çº¦æŸä¸‹ï¼Œå…·ä½“çš„å¯¹åº”å…³ç³»å°±ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºäº†ï¼Œæ¯ä¸€ä¸ªäººéƒ½å¯ä»¥ç»™è‡ªå·±åˆ¶å®šä¸€å¥—è§„åˆ™ã€‚æ‰€ä»¥ï¼Œå°±ä¼šæœ‰å„ç§å„æ ·çš„åŒæ‹¼æ–¹æ¡ˆäº†ã€‚</p><h2 id="é‚£ä¹ˆå¤šæ–¹æ¡ˆï¼Œå¦‚ä½•é€‰å®šä¸€å¥—é€‚åˆè‡ªå·±çš„åŒæ‹¼æ–¹æ¡ˆï¼Ÿ"><a href="#é‚£ä¹ˆå¤šæ–¹æ¡ˆï¼Œå¦‚ä½•é€‰å®šä¸€å¥—é€‚åˆè‡ªå·±çš„åŒæ‹¼æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="é‚£ä¹ˆå¤šæ–¹æ¡ˆï¼Œå¦‚ä½•é€‰å®šä¸€å¥—é€‚åˆè‡ªå·±çš„åŒæ‹¼æ–¹æ¡ˆï¼Ÿ"></a>é‚£ä¹ˆå¤šæ–¹æ¡ˆï¼Œå¦‚ä½•é€‰å®šä¸€å¥—é€‚åˆè‡ªå·±çš„åŒæ‹¼æ–¹æ¡ˆï¼Ÿ</h2><p>å…³äºåŒæ‹¼æ–¹æ¡ˆçš„é€‰æ‹©ï¼Œä½ éœ€è¦å…ˆç¡®å®šä½ æ‰€ç”¨çš„å¹³å°ã€ä½ æ‰€ç”¨çš„è¾“å…¥æ³•æ˜¯å¦æ”¯æŒè¯¥æ–¹æ¡ˆï¼Œä¸”è¯¥æ–¹æ¡ˆæ˜¯å¦è¿˜ä¿æŒç»´æŠ¤ã€‚ä¸ç„¶ä½ å­¦ä¼šäº†æŸæ–¹æ¡ˆä¹‹åæ²¡æ³•è¾“å…¥å°±æ¯”è¾ƒå°´å°¬å•¦ï¼ï¼ˆåœ¨ 2018 å¹´çš„æ—¶å€™ï¼Œæˆ‘å°±äº†è§£è¿‡åŒæ‹¼ï¼Œä½†ç”±äºé‚£æ—¶æˆ‘æ‰‹æœºé»˜è®¤è¾“å…¥æ³•ä¸æ”¯æŒåŒæ‹¼ï¼Œå› æ­¤åé¢å°±ä¸äº†äº†ä¹‹äº†ã€‚ï¼‰</p><p>ç›®å‰<strong>ä¸»æµ</strong>çš„è¾“å…¥æ³•åŸºæœ¬ä¸Šéƒ½ä¼šè‡ªå¸¦è¿™äº›åŒæ‹¼æ–¹æ¡ˆï¼šè‡ªç„¶ç åŒæ‹¼ã€å¾®è½¯åŒæ‹¼ã€æœç‹—åŒæ‹¼ã€å°é¹¤åŒæ‹¼ã€æ‹¼éŸ³åŠ åŠ åŒæ‹¼ã€æ™ºèƒ½ABCã€‚<strong>ä¸åŒçš„åŒæ‹¼æ–¹æ¡ˆæœ‰ä¸åŒçš„é£æ ¼ï¼Œæ²¡æœ‰ç»å¯¹çš„å­°ä¼˜å­°åŠ£ä¹‹åˆ†</strong>ã€‚</p><p>åœ¨æ‰€æœ‰çš„ä¸»æµæ–¹æ¡ˆä¸­ï¼Œæˆ‘ä¸ªäººæœ€æ¨èçš„æ˜¯å°é¹¤åŒæ‹¼å’Œè‡ªç„¶ç åŒæ‹¼ã€‚å¦‚æœä½ æ˜¯ iOS/MacOS ç”¨æˆ·ï¼Œè¿™ä¸ªæ¨èèŒƒå›´å†ç¼©çª„åˆ°å°é¹¤åŒæ‹¼è¿™ä¸€ç§ã€‚é™¤å»è¿™ä¸¤ç§éƒ½æ˜¯ç³»ç»Ÿè¾“å…¥æ³•çš„åŸç”Ÿæ”¯æŒä¹‹å¤–ï¼Œä¸»è¦è¿˜æœ‰ä»¥ä¸‹åŸå› ï¼š</p><p><img src="/medias/loading.gif" data-original="https://cdn.sspai.com/editor/u_/c9akdr5b34ta61ljn9k0.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1" alt="å°é¹¤åŒæ‹¼æ–¹æ¡ˆ"></p><p><img src="/medias/loading.gif" data-original="https://cdn.sspai.com/editor/u_/c9akdr5b34ta7netbujg.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1" alt="è‡ªç„¶ç åŒæ‹¼æ–¹æ¡ˆ"></p><ul><li>è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½é¿å¼€äº†é‡‡ç”¨ <code>;</code> é”®å®‰æ”¾éŸµæ¯ã€‚ï¼ˆå¦‚å¾®è½¯åŒæ‹¼ã€æœç‹—åŒæ‹¼ã€ç´«å…‰åŒæ‹¼éƒ½å°† <code>;</code> é”®æ˜ å°„æˆäº†éŸµæ¯ <code>ing</code>ï¼‰è¿™æ ·ç ´åäº†æˆ‘ä»¬å¸¸è§„æ‹¼éŸ³è®°å¿†æ€ç»´ã€‚ï¼ˆæ ‡ç‚¹ç¬¦å·å°±åº”è¯¥æ˜¯æ ‡ç‚¹ç¬¦å·é”®ä½ã€‚ï¼‰</li><li>è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½æ²¡æœ‰é‡‡ç”¨å›ºå®šé›¶å£°æ¯æ–¹æ¡ˆã€‚æ‰€è°“ã€Œé›¶å£°æ¯ã€æŒ‡çš„æ˜¯å°†é”®ç›˜ä¸Šä¸€ä¸ªç‰¹å®šçš„é”®æŒ‡å®šä¸ºé›¶å£°æ¯ï¼Œæ­é…éŸµæ¯é”®ä»¥è¾“å…¥çº¯éŸµæ¯ç»„æˆçš„å­—ï¼Œå¦‚å¾®è½¯åŒæ‹¼ä¸­è¾“å…¥ã€Œå®‰ã€ä¸º<code>oj</code>ã€‚å°é¹¤å’Œè‡ªç„¶ç å°†é›¶å£°æ¯è®¾å®šæˆéŸµæ¯çš„é¦–å­—æ¯ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒåŒå­—æ¯ç»„æˆçš„çº¯éŸµæ¯å­—å¯ä»¥ä¸å…¨æ‹¼å®Œå…¨ä¸€è‡´ï¼Œå¦‚ã€Œå®‰ã€ä¸º<code>an</code>ï¼Œå•å­—æ¯çš„çº¯éŸµæ¯å­—åŒå‡»æŒ‰é”®å³å¯ï¼Œå¦‚ã€Œå“¦ã€ä¸º<code>oo</code>ï¼Œé™ä½äº†é€‚åº”éš¾åº¦ã€‚</li></ul><p>åœ¨è®¾è®¡ä¸Šï¼Œå°é¹¤åŒæ‹¼è„±èƒäºè¾ƒä¸ºå¤è€çš„è‡ªç„¶ç åŒæ‹¼ï¼Œè°ƒæ•´äº†éƒ¨åˆ†éŸµæ¯çš„ä½ç½®ï¼Œä½†åŸºæœ¬ä¸ŠæŠŠä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„éŸµæ¯æ”¾åœ¨äº†æ¯”è¾ƒæ˜“äºå‘åŠ›çš„é£ŸæŒ‡å’Œä¸­æŒ‡ä¸Šã€‚</p><p>ä¹‹å‰åœ¨è®¨è®ºå…¨æ‹¼å’ŒåŒæ‹¼çš„ä¼˜ç¼ºç‚¹æ—¶ï¼Œè¯´åˆ°è¿‡æ‹¼éŸ³æ‰“å­—æ—¶çš„é‡ç ç‡é«˜ï¼Œä¸åƒäº”ç¬”è¾“å…¥æ³•ä¸€æ ·ï¼Œå¯ä»¥åšåˆ°ã€Œå››ç å”¯ä¸€ã€ï¼Œé€‚åˆç›²æ‰“ã€‚é‚£æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥åšåˆ°æ‹¼éŸ³è¾“å…¥æ³•å’Œäº”ç¬”è¾“å…¥æ³•ç›¸ç»“åˆï¼Œä¸”ä¹Ÿå¯ä»¥å‡å°‘é‡ç ç‡å‘¢ï¼Ÿè¿˜çœŸå¯ä»¥ï¼Œé‚£å°±æ˜¯ã€Œå°é¹¤éŸ³å½¢ã€ã€‚å­¦å¥½äº†å°é¹¤åŒæ‹¼ä¹‹åå¾ˆå®¹æ˜“ä¸Šæ‰‹å°é¹¤éŸ³å½¢ï¼Œå› æ­¤ï¼Œåœ¨ä¼—å¤šåŒæ‹¼æ–¹æ¡ˆä¸­ï¼Œæˆ‘æœ€æ¨èçš„å°±æ˜¯<strong>å°é¹¤åŒæ‹¼</strong>ã€‚å½“ç„¶ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„ï¼Œæ‰æ˜¯æœ€å¥½çš„ï¼</p><h2 id="åŒæ‹¼æ–¹æ¡ˆçš„ç»ƒä¹ "><a href="#åŒæ‹¼æ–¹æ¡ˆçš„ç»ƒä¹ " class="headerlink" title="åŒæ‹¼æ–¹æ¡ˆçš„ç»ƒä¹ "></a>åŒæ‹¼æ–¹æ¡ˆçš„ç»ƒä¹ </h2><h3 id="å¦‚ä½•å¿«é€Ÿè®°å¿†é”®ä½ï¼Ÿ"><a href="#å¦‚ä½•å¿«é€Ÿè®°å¿†é”®ä½ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¿«é€Ÿè®°å¿†é”®ä½ï¼Ÿ"></a>å¦‚ä½•å¿«é€Ÿè®°å¿†é”®ä½ï¼Ÿ</h3><p>è®°å¿†æŸäº›äº‹ç‰©æ—¶ï¼Œä¸€èˆ¬æˆ‘ä¼šå…ˆè€ƒè™‘ç†è§£ä¼˜å…ˆï¼Œå…¶æ¬¡å†ã€Œè¿è¿çœ‹ã€å’Œã€Œæ‰¾ä¸åŒã€ï¼Œæœ€åå†æ˜¯æ­»è®°ç¡¬èƒŒã€‚ä¸‹é¢æˆ‘åˆ†äº«ä¸€ä¸‹æˆ‘é€šè¿‡<strong>ååˆ†é’Ÿå·¦å³çš„æ—¶é—´è®°å®Œå°é¹¤åŒæ‹¼æ–¹æ¡ˆé”®ä½</strong>çš„æ–¹æ³•ã€‚</p><h4 id="å£°æ¯"><a href="#å£°æ¯" class="headerlink" title="å£°æ¯"></a>å£°æ¯</h4><ul><li>å•å£°æ¯ï¼šç›´æ¥ä¸é”®ç›˜ä¸Šçš„é”®ä½ç›¸å¯¹åº”ï¼›</li><li>ä¸‰ä¸ªåŒå£°æ¯ zh-vã€ch-iã€sh-u å¯ä»¥ç›´æ¥æ­»è®°ç¡¬èƒŒï¼›</li><li>é›¶å£°æ¯ï¼ˆæ‹¼éŸ³ä¸­å…¨éƒ¨æ˜¯éŸµæ¯æ—¶ï¼‰ï¼š<ul><li>å•éŸµæ¯ã€ä¸‰éŸµæ¯æ—¶ï¼šéŸµæ¯é¦–å­—æ¯ + éŸµæ¯æ‰€åœ¨é”®ã€‚å¦‚ï¼šå•Š a-aaã€å“¦ o-ooã€é¢ e-eeã€æ˜‚ ang-ahã€é¥ eng-eg</li><li>åŒéŸµæ¯æ—¶ï¼šç›´æ¥æ‰“æ‹¼éŸ³ã€‚å¦‚ï¼šçˆ± ai-aiã€å®‰ an-anã€å‚² ao-aoã€è¯¶ ei-eiã€å—¯ en-enã€è€³ er-erã€å¶ ou-ou</li></ul></li></ul><h4 id="éŸµæ¯"><a href="#éŸµæ¯" class="headerlink" title="éŸµæ¯"></a>éŸµæ¯</h4><ul><li>å…ˆä¸€èµ·è®°å¿† enã€engã€angã€an è¿™å››ä¸ªéŸµæ¯ã€‚ æˆ‘ä»¬å‘ç°è¿™å‡ ä¸ªéŸµæ¯è¿˜æ˜¯æœ‰ä¸€ç‚¹å„¿å¯¹ç§°çš„ï¼Œåˆšå¥½æˆ‘ä»¬åœ¨ä½¿ç”¨é”®ç›˜æ—¶ï¼Œæ­£ç¡®çš„æŒ‡æ³•æ˜¯å°†å·¦æ‰‹é£ŸæŒ‡æ”¾åœ¨ <code>f</code> é”®ä¸Šï¼Œå³æ‰‹é£ŸæŒ‡æ”¾åœ¨ <code>j</code> é”®ä¸Šï¼Œè¿™æ · f-enã€g-engã€h-angã€j-an å¹¶ä¸”åœ¨æŒ‰é”®ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ä»å¤–å¾€å†…éŸµæ¯æ›´é•¿ï¼Œå¦‚å·¦æ‰‹é£ŸæŒ‡ä»å·¦å¾€å³æ—¶ f-enã€g-engï¼Œå³æ‰‹é£ŸæŒ‡ä»å³å¾€å·¦æ—¶ j-anã€h-angï¼›</li><li>ç„¶åä¸€å¹¶è®°å¿† s-iong/ongã€l-iangã€uang åŒæ ·ä½ ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨æ­£ç¡®çš„æŒ‡æ³•æ—¶ï¼Œæˆ‘ä»¬å·¦æ‰‹çš„æ— åæŒ‡åˆšå¥½å°±æ”¾åœ¨ <code>s</code> é”®ä¸Šï¼Œå³æ‰‹çš„æ— åæŒ‡åˆšå¥½æ”¾åœ¨ <code>l</code> é”®ä¸Šã€‚ä¸”æˆ‘ä»¬å¯ä»¥å¤§è‡´è®°å¿†ä»¥ <code>ong</code> ç»“å°¾çš„å°±æ˜¯åœ¨ <code>s</code> é”®ä¸Šï¼Œä»¥ <code>ang</code> ç»“å°¾çš„å°±æ˜¯åœ¨ <code>l</code> é”®ä¸Šæ›´è¿›ä¸€æ­¥è®°å¿†ã€‚</li><li>å…¶ä»–çš„éŸµæ¯ï¼Œæˆ‘æ˜¯ç›´æ¥é€šè¿‡é”®ä½ä¸Šçš„å£°æ¯å’ŒéŸµæ¯ç»„æˆæŸäº›éŸ³æ¥è®°å¿†çš„ï¼Œå› ä¸ºå£°æ¯é”®ä½åœ¨ä½¿ç”¨å…¨æ‹¼æ—¶ï¼Œæˆ‘å°±ä¼šç›²æ‰“ï¼Œå› æ­¤ç®€å•ï¼Œç°åœ¨å°±æ˜¯è¦ç¡®å®šéŸµæ¯é”®ä½ï¼Œé‚£å°±ç›´æ¥é€šè¿‡å£°æ¯é”®ä½æ‰¾éŸµæ¯é”®ä½å°±å¯ä»¥æ›´å¿«ä¸Šæ‰‹äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä¸€ä¸ªä¸€ä¸ªè®²è§£ã€‚<ul><li>q-iu â€”â€”æˆ‘ç›´æ¥è®°å¿†ã€Œç§‹ã€çš„éŸ³ï¼Œè¿™æ ·æˆ‘å°±å¾ˆå¿«å¯ä»¥é€šè¿‡ <code>q</code> æ‰¾åˆ° <code>iu</code></li><li>w-ei â€”â€” åŒç†ã€Œä¸ºã€</li><li>r-uan â€”â€” è½¯</li><li>y-yun â€”â€” æ™•</li><li>p-ie â€”â€” æ’‡</li><li>d-ai â€”â€” å‘†</li><li>z-ou â€”â€” èµ°</li><li>c-ao â€”â€” è‰</li><li>b-in â€”â€” æ–Œ</li><li>n-iao â€”â€” é¸Ÿ</li><li>m-ian â€”â€” é¢</li><li>t-ue/ve â€”â€” è¿™ä¸ªæ— æ³•ç›´æ¥ç»„æˆæ‹¼éŸ³ï¼Œå¯é€šè¿‡ ue å’Œ veã€Œé•¿å¾—åƒã€æ¥å°†äºŒè€…è®°åœ¨ä¸€èµ·</li><li>o-o/uo â€”â€” è¿™ä¸ªæˆ‘æ˜¯ç›´æ¥é€šè¿‡ã€Œoã€çš„è¯»éŸ³ã€Œå“¦ã€æ¥è®°å¿†çš„</li><li>k-ing/uai â€”â€” è¿™ä¸ªæˆ‘æ˜¯é€šè¿‡è‹±æ–‡å•è¯ king å’Œ kuaiï¼ˆå¿«ï¼‰æ¥è®°å¿†</li><li>x-ia/ua â€”â€” è¿™ä¸ªæˆ‘æ˜¯é€šè¿‡ xiaï¼ˆè™¾ï¼‰ï¼Œç„¶å ia å’Œ uaã€Œé•¿å¾—åƒã€æ¥è®°å¿†</li><li>v-ui/v â€”â€” è¿™ä¸ªæˆ‘æ˜¯ç›´æ¥é€šè¿‡ã€Œå¾®ã€çš„è¯»éŸ³æ¥è®°å¿†çš„</li></ul></li></ul><p>ä»¥ä¸Šæ˜¯æˆ‘çš„è®°å¿†æ–¹å¼ï¼Œä¾›å„ä½å‚è€ƒã€‚æ€»ä¹‹é€‚åˆè‡ªå·±çš„æ–¹å¼æ‰æ˜¯æœ€å¥½çš„æ–¹å¼ï¼Œåªè¦èƒ½å¤Ÿè®°ä½å°±è¡Œã€‚</p><h3 id="å¦‚ä½•å¿«é€Ÿç»ƒä¹ ï¼Ÿ"><a href="#å¦‚ä½•å¿«é€Ÿç»ƒä¹ ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¿«é€Ÿç»ƒä¹ ï¼Ÿ"></a>å¦‚ä½•å¿«é€Ÿç»ƒä¹ ï¼Ÿ</h3><h4 id="å¯ä»¥é€šè¿‡ä¸€äº›ç»ƒä¹ ç«™ç‚¹æ¥å­¦ä¹ "><a href="#å¯ä»¥é€šè¿‡ä¸€äº›ç»ƒä¹ ç«™ç‚¹æ¥å­¦ä¹ " class="headerlink" title="å¯ä»¥é€šè¿‡ä¸€äº›ç»ƒä¹ ç«™ç‚¹æ¥å­¦ä¹ "></a>å¯ä»¥é€šè¿‡ä¸€äº›ç»ƒä¹ ç«™ç‚¹æ¥å­¦ä¹ </h4><p>è¿™é‡Œæ¨èä½¿ç”¨ <a href="https://api.ihint.me/shuang/">https://api.ihint.me/shuang/</a> è¿™ä¸ªåœ¨çº¿ç½‘ç«™æ¥å­¦ä¹ ï¼Œæ”¯æŒ 17 ç§åŒæ‹¼æ–¹æ¡ˆï¼Œå¹¶ä¸”è¿˜æœ‰å¾®ä¿¡å°ç¨‹åºç‰ˆï¼ˆå¯ä»¥æœç´¢å°ç¨‹åºã€ŒåŒæ‹¼å­¦ä¹ ã€æ¥ä½¿ç”¨ï¼‰</p><p><img src="/medias/loading.gif" data-original="https://cdn.nlark.com/yuque/0/2023/png/26208023/1698650234532-d5f0ee18-85f1-4132-894b-7a212039c336.png?x-oss-process=image/resize,w_1500,limit_0"></p><h4 id="å¼ºåŒ–éŸµæ¯ç»ƒä¹ "><a href="#å¼ºåŒ–éŸµæ¯ç»ƒä¹ " class="headerlink" title="å¼ºåŒ–éŸµæ¯ç»ƒä¹ "></a>å¼ºåŒ–éŸµæ¯ç»ƒä¹ </h4><p>è¿™ä¸ªå°±åƒæˆ‘ä»¬ä¸Šå­¦çš„æ—¶å€™æš´åŠ›è®°å•è¯ä¸€æ ·ï¼Œåªè¦ä½ ä¸€ä¸ªåŠ¨ä½œé‡å¤çš„å¤šäº†ï¼Œä½ å°±è‡ªç„¶è€Œç„¶çš„ä¼šè®°ä½ï¼Œé‚£ä¹ˆä»€ä¹ˆæ ·çš„æ–‡å­—å†…å®¹éŸµæ¯é‡å¤ç‡ä¼šæ¯”è¾ƒé«˜å‘¢ï¼Ÿé‚£è‚¯å®šå°±æ˜¯å¾—æŠ¼éŸµå˜›ï¼Œæ¯”å¦‚å¦‚ä¸‹</p><p>tm qk se dg yj yu ï¼ˆtian qing se deng yan yuï¼‰<br>er wo zd dg ni ï¼ˆer wo zai deng niï¼‰<br>iv yj nn nn ug qi ï¼ˆchui yan niao niao sheng qiï¼‰<br>ge jl qm wj li ï¼ˆge jiang qian wan liï¼‰<br>zd pk di uu hj li ï¼ˆzai ping di shu han liï¼‰<br>fh qm ic de pn yi ï¼ˆfang qian chao de piao yiï¼‰<br>jq dh wo ww yu jm ni fu bi ï¼ˆjiu dang wo wei yu jian ni fu biï¼‰</p><p>å› æ­¤é€šè¿‡æ‰“æ­Œè¯æˆ–è€…æŠ¼éŸµæ¯”è¾ƒå¤šçš„è¯—æ­Œéƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h4 id="å¤šç»ƒä¹ "><a href="#å¤šç»ƒä¹ " class="headerlink" title="å¤šç»ƒä¹ "></a>å¤šç»ƒä¹ </h4><p>å­¦ä»¥è‡´ç”¨æ‰æœ‰ç”¨ï¼Œå¹³æ—¶æ— è®ºæ˜¯èŠå¤©è¿˜æ˜¯å·¥ä½œï¼Œéƒ½å°½å¯èƒ½ä½¿ç”¨åŒæ‹¼ã€‚åˆšå¼€å§‹ä½¿ç”¨æ—¶è‚¯å®šä¸æ˜¯é‚£ä¹ˆé¡ºç•…ï¼Œè¿™å¾ˆæ­£å¸¸ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘å°±æ˜¯ä½¿ç”¨åŒæ‹¼å†™çš„ï¼Œå½“ç„¶æ‰“å­—é€Ÿåº¦å¹¶æ²¡æœ‰æˆ‘ä½¿ç”¨å…¨æ‹¼å¿«ã€‚ä½†æ˜¯ï¼Œåªè¦ä¸æ–­çš„ç”¨ï¼Œé‚£ä¹ˆè‚¯å®šä¼šç†Ÿèƒ½ç”Ÿå·§ã€‚èŠå¤©æ—¶ï¼Œå¦‚æœè®°ä¸å¤ªæ¸…é”®ä½ï¼Œè¿˜å¯ä»¥å°†é”®ä½å›¾è®¾å®šä¸ºèŠå¤©èƒŒæ™¯ã€‚å› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ã€Œå°é¹¤åŒæ‹¼ã€è¿™é‡Œæˆ‘æä¾›ä¸€å¼ å°é¹¤åŒæ‹¼æ–¹æ¡ˆçš„å£çº¸ä¾›å„ä½å‚è€ƒã€‚</p><p><img src="/medias/loading.gif" data-original="https://cdn.nlark.com/yuque/0/2023/jpeg/26208023/1698653500731-34b243ec-7659-4dfa-bd90-339494be30e4.jpeg" alt="å°é¹¤åŒæ‹¼1284Ã—2778å£çº¸"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å­¦ä¹ è‚¯å®šæ˜¯ç—›è‹¦çš„ï¼Œä½†å—ç›Šä¹Ÿæ˜¯ç»ˆèº«çš„ã€‚æ—¢ç„¶ä½ éƒ½èƒ½å¤Ÿçœ‹åˆ°è¿™é‡Œï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ è¿˜æ˜¯åšæŒå°†åŒæ‹¼å­¦ä¼šå§ã€‚ä¹‹æ‰€ä»¥æ²¡æœ‰æ¨èå­¦ä¹ äº”ç¬”ï¼Œé‚£æ˜¯å› ä¸ºå­¦ä¹ äº”ç¬”ç¡®å®å­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ï¼Œè€ŒåŒæ‹¼ç®—æ˜¯ä¸€ä¸ªæ‰“å­—è¾ƒå¿«ã€å­¦ä¹ æ›²çº¿è¾ƒå¹³ç¼“çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆäº†ã€‚å¸Œæœ›æ²¡æœ‰æµªè´¹ä½ çš„æ—¶é—´ï¼Œä¹Ÿå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿç»™ä½ å¸¦æ¥å¸®åŠ©ã€‚</p><h2 id="å…³è”é˜…è¯»"><a href="#å…³è”é˜…è¯»" class="headerlink" title="å…³è”é˜…è¯»"></a>å…³è”é˜…è¯»</h2><ul><li><a href="https://zh.wikipedia.org/zh-hans/%E5%8F%8C%E6%8B%BC">åŒæ‹¼-ç»´åŸºç™¾ç§‘</a></li><li><a href="https://sspai.com/post/72622">äºŒã€‡äºŒäºŒå¹´ï¼Œæ¥è¯•è¯•åŒæ‹¼è¾“å…¥æ³•å§</a></li><li><a href="https://sspai.com/post/42667">è®©åŒæ‹¼ä¸å†æ˜¯åªå±äºå°‘æ•°äººçš„è¾“å…¥æ–¹å¼</a></li><li><a href="https://sspai.com/post/56134">åŒæ‹¼è¾“å…¥æ³•çš„è¿›é˜¶ï¼šå°é¹¤éŸ³å½¢</a></li></ul><p>æˆ‘æ˜¯ Alexï¼Œä¸‰è§‚æ¯”äº”å®˜æ›´æ­£ï¼Œæ€æƒ³æ¯”å¥—è·¯æ›´æ·±çš„ç¼–ç¨‹çˆ±å¥½è€…ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wise-locksmith PHP äº’æ–¥é”åº“</title>
      <link href="posts/1e08f87d.html"/>
      <url>posts/1e08f87d.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP-äº’æ–¥é”åº“"><a href="#PHP-äº’æ–¥é”åº“" class="headerlink" title="PHP äº’æ–¥é”åº“"></a>PHP äº’æ–¥é”åº“</h1><p><a href="https://github.com/pudongping/wise-locksmith">wise-locksmith</a> æ˜¯ä¸€ä¸ªä¸å±€é™äºæ¡†æ¶çš„äº’æ–¥é”åº“ï¼Œç”¨äºåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æä¾› PHP ä»£ç çš„äº’æ–¥æ‰§è¡Œã€‚<br>å¦‚æœä½ æ˜¯ä½¿ç”¨ <a href="https://hyperf.wiki/">hyperf</a> æ¡†æ¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://github.com/pudongping/hyperf-wise-locksmith">hyperf-wise-locksmith</a> é€‚é…åº“ã€‚</p><h2 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h2><ul><li>PHP &gt;= 7.1 æˆ–ä»¥ä¸Šç‰ˆæœ¬</li><li>Redis &gt;= 2.6.12 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨åˆ°åˆ†å¸ƒå¼é”æˆ–è€…çº¢é”çš„æƒ…å†µä¸‹ï¼‰</li><li>Swoole &gt;= 4.5 æˆ–ä»¥ä¸Šç‰ˆæœ¬ ï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨åç¨‹çº§åˆ«çš„äº’æ–¥é”çš„æƒ…å†µä¸‹ï¼‰</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">composer</span> require pudongping/wise-locksmith<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'vendor/autoload.php'</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Pudongping<span class="token punctuation">\</span>WiseLocksmith<span class="token punctuation">\</span>Locker</span><span class="token punctuation">;</span><span class="token variable">$redisHosts</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">6379</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">6380</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">6381</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">6382</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">6383</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å¦‚æœéœ€è¦ä½¿ç”¨åˆ°åˆ†å¸ƒå¼é”æˆ–è€…çº¢é”æ—¶ï¼Œåˆ™éœ€è¦åˆå§‹åŒ– redis å®ä¾‹ï¼Œå¦åˆ™å¯è·³è¿‡è¿™ä¸€æ­¥</span><span class="token variable">$redisInstances</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$redis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'port'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$redis</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token variable">$redisHosts</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºä¸€ä¸ªé”å®ä¾‹</span><span class="token variable">$locker</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="flock-æ–‡ä»¶é”"><a href="#flock-æ–‡ä»¶é”" class="headerlink" title="flock - æ–‡ä»¶é”"></a>flock - æ–‡ä»¶é”</h3><p>æ–‡ä»¶é”æ²¡æœ‰ä»»ä½•ä¾èµ–ã€‚å¯é€šè¿‡å¯é€‰çš„ç¬¬ 3 ä¸ªå‚æ•°å‚æ•°è®¾ç½®é”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’ã€‚ï¼ˆæ”¯æŒæµ®ç‚¹å‹ï¼Œæ¯”å¦‚ 1.5 è¡¨ç¤º 1500ms ä¹Ÿå°±æ˜¯æœ€å¤šä¼šç­‰å¾… 1500msï¼Œå¦‚æœæ²¡æœ‰æŠ¢å åˆ°é”ï¼Œé‚£ä¹ˆåˆ™ä¸»åŠ¨æ”¾å¼ƒæŠ¢é”ï¼ŒåŒæ—¶ä¼šæŠ›å‡º <code>Pudongping\WiseLocksmith\Exception\TimeoutException</code> å¼‚å¸¸ï¼‰<br>è®¾ç½®æˆ <code>Pudongping\WiseLocksmith\Lock\File\Flock::INFINITE_TIMEOUT</code> æ—¶ï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œåˆ™å½“å‰ä¸€ç›´ä¼šé˜»å¡å¼æŠ¢å é”ï¼Œç›´åˆ°æŠ¢å åˆ°é”ä¸ºæ­¢ã€‚é»˜è®¤å€¼ä¸ºï¼š<code>Pudongping\WiseLocksmith\Lock\File\Flock::INFINITE_TIMEOUT</code>ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token function">tempnam</span><span class="token punctuation">(</span><span class="token function">sys_get_temp_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'wise-locksmith-flock-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fileHandler</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$locker</span><span class="token operator">-&gt;</span><span class="token function">flock</span><span class="token punctuation">(</span><span class="token variable">$fileHandler</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è¿™é‡Œå†™ä½ æƒ³ä¿æŠ¤çš„ä»£ç </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="redisLock-åˆ†å¸ƒå¼é”"><a href="#redisLock-åˆ†å¸ƒå¼é”" class="headerlink" title="redisLock - åˆ†å¸ƒå¼é”"></a>redisLock - åˆ†å¸ƒå¼é”</h3><p>éœ€è¦ä¾èµ– <code>redis</code> æ‰©å±•ã€‚å¯é€šè¿‡å¯é€‰çš„ç¬¬ 3 ä¸ªå‚æ•°è®¾ç½®é”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’ã€‚ï¼ˆæ”¯æŒæµ®ç‚¹å‹ï¼Œæ¯”å¦‚ 1.5 è¡¨ç¤º 1500ms ä¹Ÿå°±æ˜¯æœ€å¤šä¼šç­‰å¾… 1500msï¼Œå¦‚æœæ²¡æœ‰æŠ¢å åˆ°é”ï¼Œé‚£ä¹ˆåˆ™ä¸»åŠ¨æ”¾å¼ƒæŠ¢é”ï¼ŒåŒæ—¶ä¼šæŠ›å‡º <code>Pudongping\WiseLocksmith\Exception\TimeoutException</code> å¼‚å¸¸ï¼‰<br>é»˜è®¤å€¼ä¸ºï¼š<code>5</code>ã€‚ç¬¬ 4 ä¸ªå‚æ•°ä¸ºå½“å‰é”çš„å…·æœ‰å”¯ä¸€æ€§çš„å€¼ï¼Œé™¤éæœ‰ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦è®¾ç½®ï¼Œä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$locker</span><span class="token operator">-&gt;</span><span class="token function">redisLock</span><span class="token punctuation">(</span><span class="token variable">$redisInstances</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'redisLock'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è¿™é‡Œå†™ä½ æƒ³ä¿æŠ¤çš„ä»£ç </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="redLock-çº¢é”ï¼ˆredis-é›†ç¾¤ç¯å¢ƒæ—¶ï¼Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼‰"><a href="#redLock-çº¢é”ï¼ˆredis-é›†ç¾¤ç¯å¢ƒæ—¶ï¼Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼‰" class="headerlink" title="redLock - çº¢é”ï¼ˆredis é›†ç¾¤ç¯å¢ƒæ—¶ï¼Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼‰"></a>redLock - çº¢é”ï¼ˆredis é›†ç¾¤ç¯å¢ƒæ—¶ï¼Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼‰</h3><p>redLock é”æ‰€éœ€è¦è®¾ç½®çš„å‚æ•°å’Œ redisLock é”é™¤äº†ç¬¬ä¸€ä¸ªå‚æ•°æœ‰åŒºåˆ«ä»¥å¤–ï¼Œå…¶ä»–å‡ ä¸ªå‚æ•°å®Œå…¨ä¸€è‡´ã€‚redLock é”æ˜¯ redisLock é”çš„é›†ç¾¤å®ç°ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$locker</span><span class="token operator">-&gt;</span><span class="token function">redLock</span><span class="token punctuation">(</span><span class="token variable">$redisInstances</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'redLock'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è¿™é‡Œå†™ä½ æƒ³ä¿æŠ¤çš„ä»£ç </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="channelLock-åç¨‹çº§åˆ«çš„äº’æ–¥é”"><a href="#channelLock-åç¨‹çº§åˆ«çš„äº’æ–¥é”" class="headerlink" title="channelLock - åç¨‹çº§åˆ«çš„äº’æ–¥é”"></a>channelLock - åç¨‹çº§åˆ«çš„äº’æ–¥é”</h3><p>ä½¿ç”¨æ­¤é”æ—¶ï¼Œéœ€è¦å®‰è£… <code>swoole</code> æ‰©å±•ã€‚ä¸”ç‰ˆæœ¬å¿…é¡»å¤§äºç­‰äº <code>4.5</code>ã€‚å¯é€šè¿‡å¯é€‰çš„ç¬¬ 3 ä¸ªå‚æ•°è®¾ç½®é”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’ã€‚ï¼ˆæ”¯æŒæµ®ç‚¹å‹ï¼Œæ¯”å¦‚ 1.5 è¡¨ç¤º 1500ms ä¹Ÿå°±æ˜¯æœ€å¤šä¼šç­‰å¾… 1500msï¼Œå¦‚æœæ²¡æœ‰æŠ¢å åˆ°é”ï¼Œé‚£ä¹ˆåˆ™ä¸»åŠ¨æ”¾å¼ƒæŠ¢é”ï¼ŒåŒæ—¶ç›´æ¥è¿”å› <code>false</code> è¡¨ç¤ºæ²¡æœ‰æŠ¢å åˆ°é”ï¼‰<br>è®¾ç½®æˆ <code>-1</code> æ—¶ï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œåˆ™å½“å‰ä¸€ç›´ä¼šé˜»å¡å¼æŠ¢å é”ï¼Œç›´åˆ°æŠ¢å åˆ°é”ä¸ºæ­¢ã€‚é»˜è®¤å€¼ä¸ºï¼š<code>-1</code>ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$locker</span><span class="token operator">-&gt;</span><span class="token function">channelLock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'channelLock'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è¿™é‡Œå†™ä½ æƒ³ä¿æŠ¤çš„ä»£ç </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äº’æ–¥é” </tag>
            
            <tag> é” </tag>
            
            <tag> PHP </tag>
            
            <tag> Mutex </tag>
            
            <tag> Lock </tag>
            
            <tag> çº¢é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ GRPC</title>
      <link href="posts/8a377bf8.html"/>
      <url>posts/8a377bf8.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-GRPC"><a href="#ä½¿ç”¨-GRPC" class="headerlink" title="ä½¿ç”¨ GRPC"></a>ä½¿ç”¨ GRPC</h1><h2 id="å®‰è£…-protobuf"><a href="#å®‰è£…-protobuf" class="headerlink" title="å®‰è£… protobuf"></a>å®‰è£… <a href="https://github.com/protocolbuffers/protobuf">protobuf</a></h2><blockquote><p><a href="https://grpc.io/docs/protoc-installation/">å®˜æ–¹å®‰è£…åœ°å€</a></p></blockquote><ul><li>ç¬¬ä¸€ç§æ–¹å¼ï¼šMac ä¸‹ä½¿ç”¨ Homebrew å®‰è£…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> protobuf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ç¬¬äºŒç§æ–¹å¼ï¼šæŒ‡å®šç‰ˆæœ¬å·å®‰è£…</li></ul><blockquote><p>è¿™é‡ŒæŒ‡å®šå®‰è£… <code>3.17.0</code> ç‰ˆæœ¬</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">PROTOC_ZIP</span><span class="token operator">=</span>protoc-3.17.0-osx-x86_64.zip<span class="token function">curl</span> <span class="token parameter variable">-OL</span> https://github.com/protocolbuffers/protobuf/releases/download/v3.17.0/<span class="token variable">$PROTOC_ZIP</span><span class="token function">sudo</span> <span class="token function">unzip</span> <span class="token parameter variable">-o</span> <span class="token variable">$PROTOC_ZIP</span> <span class="token parameter variable">-d</span> /usr/local bin/protoc<span class="token function">sudo</span> <span class="token function">unzip</span> <span class="token parameter variable">-o</span> <span class="token variable">$PROTOC_ZIP</span> <span class="token parameter variable">-d</span> /usr/local <span class="token string">'include/*'</span><span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable">$PROTOC_ZIP</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®‰è£…</p><blockquote><p>è¿™é‡Œç¤ºèŒƒçš„æ˜¯å®‰è£… Linux ç¯å¢ƒä¸‹çš„ protobuf</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…</span><span class="token function">wget</span> https://github.com/protocolbuffers/protobuf/releases/download/v3.17.0-rc1/protoc-3.17.0-rc-1-linux-x86_64.zip<span class="token comment"># åˆ›å»ºæ–‡ä»¶å¤¹å¹¶è§£å‹ç¼©åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­</span><span class="token function">mkdir</span> protoc <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> protoc-3.17.0-rc-1-linux-x86_64.zip <span class="token parameter variable">-C</span> protoc<span class="token comment"># å°†è§£å‹åçš„æ–‡ä»¶ç§»åŠ¨åˆ° /usr/local æ–‡ä»¶å¤¹ä¸‹</span><span class="token function">sudo</span> <span class="token function">mv</span> protoc /usr/local/protoc<span class="token comment"># åˆ›å»ºè½¯è¿æ¥ï¼Œæ–¹ä¾¿åœ¨ä»»æ„ç›®å½•ä¸‹ä½¿ç”¨ protoc å‘½ä»¤</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/protoc/bin/protoc /usr/local/bin/protoc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬ä¸‰ç§æ–¹å¼ï¼šç¼–è¯‘å®‰è£…</li></ul><blockquote><p>è¿™é‡Œå®‰è£…çš„æ˜¯ <code>3.19.1</code> ç‰ˆæœ¬</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½å®‰è£…åŒ…</span><span class="token function">wget</span> https://github.com/protocolbuffers/protobuf/releases/download/v3.19.1/protobuf-all-3.19.1.zip<span class="token comment"># è§£å‹ç¼©</span><span class="token function">unzip</span> protobuf-all-3.19.1.zip <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> protobuf-3.19.1./configure<span class="token function">make</span><span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬å››ç§æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ ¹æ®ä½ è‡ªå·±çš„ç³»ç»Ÿä¸‹è½½å¯¹åº”çš„æºç åŒ… ï¼ˆæ¯”å¦‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ mac bookï¼Œæˆ‘å°±è¦ä¸‹è½½ osx å‹ç¼©åŒ…ï¼‰</span><span class="token builtin class-name">cd</span> ~/go-tools <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> https://github.com/protocolbuffers/protobuf/releases/download/v3.19.1/protoc-3.19.1-osx-x86_64.zip<span class="token comment"># è§£å‹ç¼©</span><span class="token function">unzip</span> protoc-3.19.1-osx-x86_64.zip<span class="token comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span><span class="token function">vim</span> ~/.zshrc<span class="token comment"># å†™å…¥ä»¥ä¸‹é…ç½®ä¿¡æ¯</span><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"/Users/pudongping/go-tools/protoc-3.19.1-osx-x86_64/bin:<span class="token environment constant">$PATH</span>"</span><span class="token builtin class-name">source</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€šè¿‡æŸ¥çœ‹ç‰ˆæœ¬å·ï¼Œæ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># protoc æ˜¯ Protobuf çš„ç¼–è¯‘å™¨ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯ç”¨äºç¼–è¯‘ .proto æ–‡ä»¶</span>protoc <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>å¦‚æœå‡ºç° <code>protoc: error while loading shared libraries: libprotobuf.so.15: cannot open shared object file: No such file or directory</code> é‚£ä¹ˆåˆ™éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>ldconfig</code> å‘½ä»¤åï¼Œå†æ¬¡è¿è¡Œå³å¯æˆåŠŸã€‚</p></blockquote><h2 id="å®‰è£…-protoc-æ’ä»¶"><a href="#å®‰è£…-protoc-æ’ä»¶" class="headerlink" title="å®‰è£… protoc æ’ä»¶"></a>å®‰è£… protoc æ’ä»¶</h2><blockquote><p>ä»…å®‰è£… protoc ç¼–è¯‘å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯­è¨€ï¼Œè¿˜éœ€è¦å®‰è£…è¿è¡Œæ—¶çš„ protoc æ’ä»¶ï¼Œè€Œå¯¹åº” Go è¯­è¨€çš„æ˜¯ protoc-gen-go æ’ä»¶ã€‚</p></blockquote><p>å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼Œä½†æ˜¯<strong>ä¸æ¨è</strong>ï¼Œå› ä¸º protoc-gen-go æ˜¯éœ€è¦ä¸ proto è½¯ä»¶åŒ…ç‰ˆæœ¬ç›¸åŒ¹é…çš„ï¼Œå¿…é¡»è¦é”å®šç‰ˆæœ¬å·</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…çš„äºŒè¿›åˆ¶æ–‡ä»¶åœ¨ `$GOPATH/bin` ç›®å½•ä¸‹</span><span class="token comment"># å®‰è£… protobuf 3.17.0 ç‰ˆæœ¬ä¹‹åç›´æ¥æ‰§è¡Œ go get -u github.com/golang/protobuf/protoc-gen-go å‘½ä»¤åï¼Œ</span><span class="token comment"># è²Œä¼¼å®‰è£…çš„ protoc-gen-go ç‰ˆæœ¬æ˜¯ v1.27.1ï¼Œä½†æ˜¯æŒ‡å®š protoc-gen-go@v1.27.1 è²Œä¼¼åˆæ‰¾ä¸åˆ° v1.27.1 çš„ç‰ˆæœ¬ï¼Œä¸çŸ¥ä¸ºä½•ï¼Œæš‚ä¸”è®°å½•ä¸‹ã€‚</span><span class="token comment"># åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</span>go get <span class="token parameter variable">-u</span> github.com/golang/protobuf/protoc-gen-go@v1.3.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ¨èçš„å®‰è£…æ–¹å¼å¦‚ä¸‹ï¼š</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">GIT_TAG</span><span class="token operator">=</span><span class="token string">"v1.3.3"</span>go get <span class="token parameter variable">-d</span> <span class="token parameter variable">-u</span> github.com/golang/protobuf/protoc-gen-go<span class="token function">git</span> <span class="token parameter variable">-C</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOPATH<span class="token variable">)</span></span>"</span>/src/github.com/golang/protobuf checkout <span class="token variable">$GIT_TAG</span>go <span class="token function">install</span> github.com/golang/protobuf/protoc-gen-go<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè¿˜å¯ä»¥å°†å…¶ç§»åŠ¨åˆ° bin ç›®å½•ä¸‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> <span class="token variable">$GOPATH</span>/bin/protoc-gen-go /usr/local/go/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å®‰è£…-grpc-go-åº“"><a href="#å®‰è£…-grpc-go-åº“" class="headerlink" title="å®‰è£… grpc-go åº“"></a>å®‰è£… grpc-go åº“</h2><p>grpc-go åŒ…å«äº† Go çš„ grpc åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> google.golang.org/grpc@v1.29.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœä½¿ç”¨ä»¥ä¸Šæ–¹å¼å®‰è£…ï¼Œå‘ç°æ— æ³•å®‰è£…ï¼ˆå¯èƒ½ä¼šè¢«å¢™æ‰äº†ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ‰‹åŠ¨å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/grpc/grpc-go.git <span class="token variable">$GOPATH</span>/src/google.golang.org/grpc<span class="token function">git</span> clone https://github.com/golang/net.git <span class="token variable">$GOPATH</span>/src/golang.org/x/net<span class="token function">git</span> clone https://github.com/golang/text.git <span class="token variable">$GOPATH</span>/src/golang.org/x/text<span class="token function">git</span> clone https://github.com/google/go-genproto.git <span class="token variable">$GOPATH</span>/src/google.golang.org/genproto<span class="token builtin class-name">cd</span> <span class="token variable">$GOPATH</span>/src/go <span class="token function">install</span> google.golang.org/grpc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç”Ÿæˆ-proto-æ–‡ä»¶ï¼ˆç”Ÿæˆæ¥å£åº“ï¼‰"><a href="#ç”Ÿæˆ-proto-æ–‡ä»¶ï¼ˆç”Ÿæˆæ¥å£åº“ï¼‰" class="headerlink" title="ç”Ÿæˆ proto æ–‡ä»¶ï¼ˆç”Ÿæˆæ¥å£åº“ï¼‰"></a>ç”Ÿæˆ proto æ–‡ä»¶ï¼ˆç”Ÿæˆæ¥å£åº“ï¼‰</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åŠ è½½ protoc-gen-go æ’ä»¶ ç”Ÿæˆ grpc çš„ go æœåŠ¡ç«¯/å®¢æˆ·ç«¯</span><span class="token comment"># æ³¨æ„ï¼šå¿…é¡»è¦å…ˆå®‰è£…å¥½ protoc-gen-go æ’ä»¶</span><span class="token comment"># è¿™é‡Œå°† .proto æ–‡ä»¶å†™åˆ° proto ç›®å½•ï¼Œæ‰§è¡Œæ­¤å‘½ä»¤åå°†ä¼šæŠŠå¯¹åº”çš„ .pb.go æ–‡ä»¶ä¹Ÿä¼šç”Ÿæˆåˆ° proto ç›®å½•</span>protoc <span class="token parameter variable">--go_out</span><span class="token operator">=</span>plugins<span class="token operator">=</span>grpc:. ./proto/*.proto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>-I</code> å‚æ•°ï¼šæ ¼å¼ä¸º <code>-IPATH</code> ä½œç”¨æ˜¯æŒ‡å®š import æœç´¢çš„ç›®å½•ï¼ˆä¹Ÿå°±æ˜¯ Proto æ–‡ä»¶ä¸­çš„ import å‘½ä»¤ï¼‰ï¼Œå¯æŒ‡å®šå¤šä¸ªï¼Œç¼–è¯‘æ—¶æŒ‰ç…§é¡ºåºæŸ¥æ‰¾ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™é»˜è®¤å½“å‰å·¥ä½œç›®å½•ï¼Œæ¯”å¦‚ï¼š<code>-I.</code> ã€<code>-I/usr/local</code> ã€<code>-I$GOPATH/src</code></li><li><code>M</code> å‚æ•°ï¼šæŒ‡å®šå¯¼å…¥çš„ <code>.proto</code> æ–‡ä»¶è·¯å¾„ç¼–è¯‘åå¯¹åº”çš„ golang åŒ…åï¼ˆä¸æŒ‡å®šé»˜è®¤ä»¥ .proto æ–‡ä»¶ä¸­ import è¯­å¥è·¯å¾„ï¼‰ï¼Œæ ¼å¼ä¸ºï¼šMfoo/bar.proto=quux/shmeï¼Œåˆ™åœ¨ç”Ÿæˆã€ç¼–è¯‘ Proto æ—¶å°†æ‰€æŒ‡å®šçš„åŒ…åæ›¿æ¢ä¸ºæ‰€è¦æ±‚çš„åå­—ï¼ˆå¦‚ï¼šfoo/bar.proto ç¼–è¯‘åä¸ºåŒ…åä¸º quux/shmeï¼‰</li><li><code>--go_out</code>ï¼šè®¾ç½®æ‰€ç”Ÿæˆçš„ Go ä»£ç è¾“å‡ºçš„ç›®å½•ã€‚è¯¥æŒ‡ä»¤ä¼šåŠ è½½ protoc-gen-go æ’ä»¶ï¼Œä»¥è¾¾åˆ°ç”Ÿæˆ Go ä»£ç çš„ç›®çš„ã€‚ç”Ÿæˆçš„æ–‡ä»¶ä»¥ .pb.go ä¸ºæ–‡ä»¶åç¼€ï¼Œè¿™é‡Œçš„ <code>:</code> ï¼ˆå†’å·ï¼‰æœ‰åˆ†éš”ç¬¦çš„ä½œç”¨ï¼Œåè·Ÿå‘½ä»¤æ‰€éœ€è¦çš„å‚æ•°é›†ï¼Œè¿™æ„å‘³ç€æŠŠç”Ÿæˆçš„ Go ä»£ç è¾“å‡ºåˆ°æŒ‡å‘çš„ protoc ç¼–è¯‘çš„å½“å‰ç›®å½•ã€‚</li><li><code>plugins=plugin1+plugin2</code>ï¼šæŒ‡å®šè¦åŠ è½½çš„å­æ’ä»¶åˆ—è¡¨ã€‚æˆ‘ä»¬å®šä¹‰çš„ proto æ–‡ä»¶æ˜¯æ¶‰åŠäº† RPC æœåŠ¡çš„ï¼Œè€Œé»˜è®¤æ˜¯ä¸ä¼šç”Ÿæˆ RPC ä»£ç çš„ï¼Œå› æ­¤éœ€è¦åœ¨ go_out ä¸­ç»™å‡º plugins å‚æ•°ï¼Œå°†å…¶ä¼ é€’ç»™ protoc-gen-go æ’ä»¶ï¼Œå³å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¯·æ”¯æŒ RPCã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> RPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
            <tag> GRPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git åˆå¹¶å¤šä¸ª commit</title>
      <link href="posts/d05f7a67.html"/>
      <url>posts/d05f7a67.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-åˆå¹¶å¤šä¸ª-commit"><a href="#Git-åˆå¹¶å¤šä¸ª-commit" class="headerlink" title="Git åˆå¹¶å¤šä¸ª commit"></a>Git åˆå¹¶å¤šä¸ª commit</h1><h2 id="æŸ¥çœ‹æäº¤å†å²-git-log"><a href="#æŸ¥çœ‹æäº¤å†å²-git-log" class="headerlink" title="æŸ¥çœ‹æäº¤å†å² git log"></a>æŸ¥çœ‹æäº¤å†å² <code>git log</code></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æœ€è¿‘çš„ç¬¬ 1 æ¡</span>commit ddc9e34424e8764357d086ad103219fa2c87e2dd<span class="token comment"># æœ€è¿‘çš„ç¬¬ 2 æ¡</span>commit 3cccd5d8696b91163b47a8be045e8bbf9c443ddd<span class="token comment"># æœ€è¿‘çš„ç¬¬ 3 æ¡</span>commit d70ae2c4c1c6d2edd16c6b11a8e334663a3dade5<span class="token comment"># æœ€è¿‘çš„ç¬¬ 4 æ¡</span>commit fed4fe30dbc89ccc7ae72b917b2a600ecf249d4e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h2><p>å¦‚æœæƒ³è¦åˆå¹¶æœ€è¿‘çš„ 1 åˆ°æœ€è¿‘çš„ç¬¬ 3 æ¡ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li>ä» <code>HEAD</code> ç‰ˆæœ¬å¼€å§‹å¾€è¿‡å»æ•° 3 ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> rebase <span class="token parameter variable">-i</span> HEAD~3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æŒ‡å®šè¦åˆå¹¶çš„ç‰ˆæœ¬ä¹‹å‰çš„ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯”å¦‚æˆ‘æƒ³è¦å°†æœ€è¿‘çš„ 1 æ¡ commit å’Œæœ€è¿‘çš„ç¬¬ 3 æ¡ commit è¿›è¡Œåˆå¹¶ï¼Œé‚£ä¹ˆ</span><span class="token comment"># æˆ‘è¿™é‡Œæ˜¯éœ€è¦å†™æœ€è¿‘ç¬¬ 4 æ¡ commit çš„ commit_id `fed4fe30db` </span><span class="token comment"># fed4fe30db ä¸å‚ä¸åˆå¹¶</span><span class="token function">git</span> rebase <span class="token parameter variable">-i</span> fed4fe30db<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€‰å–è¦åˆå¹¶çš„æäº¤"><a href="#é€‰å–è¦åˆå¹¶çš„æäº¤" class="headerlink" title="é€‰å–è¦åˆå¹¶çš„æäº¤"></a>é€‰å–è¦åˆå¹¶çš„æäº¤</h2><ol><li>æ‰§è¡Œäº† <code>git rebase</code> å‘½ä»¤ä¹‹åï¼Œä¼šå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œæ¯”å¦‚å¤§è‡´å¦‚ä¸‹ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pick 3cccd5d å¯¹è¯åº“åŠ ä¸Šè¯»å†™é”pick ddc9e34 debug<span class="token comment"># Rebase d70ae2c..ddc9e34 onto d70ae2c (2 commands)</span><span class="token comment">#</span><span class="token comment"># Commands:</span><span class="token comment"># p, pick &lt;commit&gt; = use commit</span><span class="token comment"># r, reword &lt;commit&gt; = use commit, but edit the commit message</span><span class="token comment"># e, edit &lt;commit&gt; = use commit, but stop for amending</span><span class="token comment"># s, squash &lt;commit&gt; = use commit, but meld into previous commit</span><span class="token comment"># f, fixup &lt;commit&gt; = like "squash", but discard this commit's log message</span><span class="token comment"># x, exec &lt;command&gt; = run command (the rest of the line) using shell</span><span class="token comment"># b, break = stop here (continue rebase later with 'git rebase --continue')</span><span class="token comment"># d, drop &lt;commit&gt; = remove commit</span><span class="token comment"># l, label &lt;label&gt; = label current HEAD with a name</span><span class="token comment"># t, reset &lt;label&gt; = reset HEAD to a label</span><span class="token comment"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span><span class="token comment"># .       create a merge commit using the original merge commit's</span><span class="token comment"># .       message (or the oneline, if no original merge commit was</span><span class="token comment"># .       specified). Use -c &lt;commit&gt; to reword the commit message.</span><span class="token comment">#</span><span class="token comment"># These lines can be re-ordered; they are executed from top to bottom.</span><span class="token comment">#</span><span class="token comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span><span class="token comment">#</span><span class="token comment"># However, if you remove everything, the rebase will be aborted.</span><span class="token comment">#</span><span class="token comment"># Note that empty commits are commented out</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>pickï¼šæ­£å¸¸é€‰ä¸­</li><li>rewordï¼šé€‰ä¸­ï¼Œå¹¶ä¸”ä¿®æ”¹æäº¤ä¿¡æ¯</li><li>editï¼šé€‰ä¸­ï¼Œrebase æ—¶ä¼šæš‚åœï¼Œå…è®¸ä½ ä¿®æ”¹è¿™ä¸ª commit</li><li>squashï¼šé€‰ä¸­ï¼Œä¼šå°†å½“å‰ commit ä¸ä¸Šä¸€ä¸ª commit åˆå¹¶</li><li>fixupï¼šä¸ squash ç›¸åŒï¼Œä½†ä¸ä¼šä¿å­˜å½“å‰ commit çš„æäº¤ä¿¡æ¯</li><li>execï¼šæ‰§è¡Œå…¶ä»– shell å‘½ä»¤</li></ul><ol start="2"><li>éœ€è¦å°† commit_id å‰é¢çš„ <code>pick</code> æ”¹ä¸º <code>s</code> æˆ–è€… <code>squash</code> ä¹‹åä¿å­˜å¹¶å…³é—­æ–‡æœ¬ç¼–è¾‘çª—å£ï¼Œæ”¹å®Œä¹‹åçš„å†…å®¹å¦‚ä¸‹ï¼šï¼ˆè¿™é‡Œä»…ä»…å±•ç¤ºäº†å†…å®¹å˜åŠ¨æƒ…å†µï¼‰</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pick 3cccd5d å¯¹è¯åº“åŠ ä¸Šè¯»å†™é”s ddc9e34 debug <span class="token comment"># è¿™ä¸€è¡Œåšäº†æ”¹åŠ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç„¶åä¿å­˜å¹¶é€€å‡ºï¼Œgit å°±ä¼šå‹ç¼©æäº¤å†å²ï¼Œå¦‚æœæœ‰å†²çªï¼Œåˆ™éœ€è¦è§£å†³å†²çªï¼Œè§£å†³å†²çªçš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„å†å²ï¼Œä¸ç„¶æˆ‘ä»¬çš„ä¿®æ”¹å°±ä¸¢å¼ƒäº†ï¼Œä¿®æ”¹ä¹‹åè¦è®°å¾—æ•²ä¸‹é¢çš„å‘½ä»¤</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span><span class="token comment"># ç¡®è®¤ rebase</span><span class="token function">git</span> rebase <span class="token parameter variable">--continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä½ æƒ³æ”¾å¼ƒè¿™æ¬¡å‹ç¼©çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å–æ¶ˆ rebase</span><span class="token function">git</span> rebase <span class="token parameter variable">--abort</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>å¦‚æœæ²¡æœ‰å†²çªï¼Œæˆ–è€…å†²çªå·²ç»è§£å†³ï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹ç¼–è¾‘çª—å£ï¼Œæ¯”å¦‚ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pick 3cccd5d å¯¹è¯åº“åŠ ä¸Šè¯»å†™é”<span class="token comment"># This is a combination of 2 commits.</span><span class="token comment"># This is the 1st commit message:</span>å¯¹è¯åº“åŠ ä¸Šè¯»å†™é”<span class="token comment"># This is the commit message #2:</span>debug<span class="token comment"># Please enter the commit message for your changes. Lines starting</span><span class="token comment"># with '#' will be ignored, and an empty message aborts the commit.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>è¾“å…¥ <code>:wq</code> ä¿å­˜å¹¶é€€å‡ºï¼Œç„¶åæŸ¥çœ‹ <code>git log --oneline</code> æŸ¥çœ‹ <code>commit</code> å†å²ä¿¡æ¯ï¼Œä½ å°±ä¼šå‘ç° commit å·²ç»è¢«åˆå¹¶äº†</li><li>å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ <code>git push -f</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ä¸‹è§£å‹ç¼©æ–‡ä»¶</title>
      <link href="posts/1ee32f49.html"/>
      <url>posts/1ee32f49.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-ä¸‹è§£å‹ç¼©æ–‡ä»¶"><a href="#Linux-ä¸‹è§£å‹ç¼©æ–‡ä»¶" class="headerlink" title="Linux ä¸‹è§£å‹ç¼©æ–‡ä»¶"></a>Linux ä¸‹è§£å‹ç¼©æ–‡ä»¶</h1><p><strong>å»ºè®®ä¸è¦æ·»åŠ æˆ rar çš„å‹ç¼©æ–‡ä»¶ï¼Œä¸ç„¶åœ¨æœåŠ¡å™¨ä¸Šé¢è§£å‹ç¼©çš„æ—¶å€™å¾ˆéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ æˆ zip çš„å‹ç¼©æ–‡ä»¶</strong></p><h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><p>ä¼˜ç‚¹ï¼šå„ç³»ç»Ÿå¹³å°éƒ½å¯ä»¥ç”¨ï¼Œç¼ºç‚¹ï¼šå‹ç¼©ç‡ä¸æ˜¯å¾ˆé«˜</p><p>zip å‘½ä»¤å¸¸ç”¨é€‰é¡¹åŠå«ä¹‰</p><table><thead><tr><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-r</td><td>é€’å½’å‹ç¼©ç›®å½•ï¼ŒåŠå°†åˆ¶å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä»¥åŠå­ç›®å½•å…¨éƒ¨å‹ç¼©ã€‚</td></tr><tr><td>-m</td><td>å°†æ–‡ä»¶å‹ç¼©ä¹‹åï¼Œåˆ é™¤åŸå§‹æ–‡ä»¶ï¼Œç›¸å½“äºæŠŠæ–‡ä»¶ç§»åˆ°å‹ç¼©æ–‡ä»¶ä¸­ã€‚</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºè¯¦ç»†çš„å‹ç¼©è¿‡ç¨‹ä¿¡æ¯ã€‚</td></tr><tr><td>-q</td><td>åœ¨å‹ç¼©çš„æ—¶å€™ä¸æ˜¾ç¤ºå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</td></tr><tr><td>-å‹ç¼©çº§åˆ«</td><td>å‹ç¼©çº§åˆ«æ˜¯ä» 1~9 çš„æ•°å­—ï¼Œ-1 ä»£è¡¨å‹ç¼©é€Ÿåº¦æ›´å¿«ï¼Œ-9 ä»£è¡¨å‹ç¼©æ•ˆæœæ›´å¥½ã€‚</td></tr><tr><td>-u</td><td>æ›´æ–°å‹ç¼©æ–‡ä»¶ï¼Œå³å¾€å‹ç¼©æ–‡ä»¶ä¸­æ·»åŠ æ–°æ–‡ä»¶ã€‚</td></tr></tbody></table><p>unzip å‘½ä»¤å¸¸ç”¨é€‰é¡¹åŠå«ä¹‰</p><table><thead><tr><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-d ç›®å½•å</td><td>å°†å‹ç¼©æ–‡ä»¶è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸‹ã€‚</td></tr><tr><td>-n</td><td>è§£å‹æ—¶å¹¶ä¸è¦†ç›–å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚</td></tr><tr><td>-o</td><td>è§£å‹æ—¶è¦†ç›–å·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ— éœ€ç”¨æˆ·ç¡®è®¤ã€‚</td></tr><tr><td>-v</td><td>æŸ¥çœ‹å‹ç¼©æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‹ç¼©æ–‡ä»¶ä¸­åŒ…å«çš„æ–‡ä»¶å¤§å°ã€æ–‡ä»¶åä»¥åŠå‹ç¼©æ¯”ç­‰ï¼Œä½†å¹¶ä¸åšè§£å‹æ“ä½œã€‚</td></tr><tr><td>-t</td><td>æµ‹è¯•å‹ç¼©æ–‡ä»¶æœ‰æ— æŸåï¼Œä½†å¹¶ä¸è§£å‹ã€‚</td></tr><tr><td>-x æ–‡ä»¶åˆ—è¡¨</td><td>è§£å‹æ–‡ä»¶ï¼Œä½†ä¸åŒ…å«æ–‡ä»¶åˆ—è¡¨ä¸­æŒ‡å®šçš„æ–‡ä»¶ã€‚</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‹ç¼© tt ç›®å½•ä¸º zip æ ¼å¼</span><span class="token function">zip</span> <span class="token parameter variable">-r</span> tt.zip tt<span class="token comment"># è§£å‹ç¼©</span><span class="token function">unzip</span> tt.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-c</td><td>åˆ›å»ºå‹ç¼©æ–‡ä»¶</td></tr><tr><td>-x</td><td>è§£å¼€å‹ç¼©æ–‡ä»¶</td></tr><tr><td>-t</td><td>æŸ¥çœ‹å‹ç¼©åŒ…å†…æœ‰å“ªäº›æ–‡ä»¶</td></tr><tr><td>-z</td><td>ç”¨Gzipå‹ç¼©æˆ–è§£å‹</td></tr><tr><td>-j</td><td>ç”¨bzip2å‹ç¼©æˆ–è§£å‹</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºå‹ç¼©æˆ–è§£å‹çš„è¿‡ç¨‹</td></tr><tr><td>-f</td><td>ç›®æ ‡æ–‡ä»¶å</td></tr><tr><td>-p</td><td>ä¿ç•™åŸå§‹çš„æƒé™ä¸å±æ€§</td></tr><tr><td>-P</td><td>ä½¿ç”¨ç»å¯¹è·¯å¾„æ¥å‹ç¼©</td></tr><tr><td>-C</td><td>æŒ‡å®šè§£å‹åˆ°çš„ç›®å½•</td></tr></tbody></table><p>ä¼˜ç‚¹ï¼šCPU æ¶ˆè€—å°‘ï¼Œç¼ºç‚¹ï¼šä»…ä»…æ˜¯æ‰“åŒ…å·¥å…·ï¼Œä¸è´Ÿè´£å‹ç¼©</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‹ç¼© tt ç›®å½•ä¸º tar æ ¼å¼</span><span class="token function">tar</span> <span class="token parameter variable">-cvf</span> tt.tar tt<span class="token comment"># è§£å‹ç¼©</span><span class="token function">tar</span> <span class="token parameter variable">-xvf</span> tt.tar <span class="token parameter variable">-C</span> /home/alex/tt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tar-gz"><a href="#tar-gz" class="headerlink" title="tar.gz"></a>tar.gz</h2><p>ä¼˜ç‚¹ï¼šCPU å ç”¨å°‘ï¼Œå‹ç¼©ç‡å¾ˆç†æƒ³</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‹ç¼© tt ç›®å½•ä¸º tar.gz æ ¼å¼</span><span class="token function">tar</span> <span class="token parameter variable">-czvf</span> tt.tar.gz tt<span class="token comment"># è§£å‹ç¼©</span><span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> tt.tar.gz<span class="token comment"># è§£å‹ç¼©åˆ°æŒ‡å®šç›®å½• /home/alex ç›®å½•ä¸‹</span><span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> tt.tar.gz <span class="token parameter variable">-C</span> /home/alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tar-bz2"><a href="#tar-bz2" class="headerlink" title="tar.bz2"></a>tar.bz2</h2><p>ä¼˜ç‚¹ï¼šæ‰€æœ‰æ–¹å¼ä¸­å‹ç¼©ç‡æœ€å¥½ï¼Œç¼ºç‚¹ï¼šæ›´åŠ å ç”¨ CPU å’Œæ—¶é—´</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‹ç¼© tt ç›®å½•ä¸º tar.bz2 æ ¼å¼</span><span class="token function">tar</span> <span class="token parameter variable">-cjvf</span> tt.tar.bz2 tt<span class="token comment"># è§£å‹ç¼©</span><span class="token function">tar</span> <span class="token parameter variable">-xjvf</span> tt.tar.bz2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> tar </tag>
            
            <tag> zip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡</title>
      <link href="posts/9a5708c9.html"/>
      <url>posts/9a5708c9.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-systemd-ç®¡ç†æœåŠ¡"><a href="#ä½¿ç”¨-systemd-ç®¡ç†æœåŠ¡" class="headerlink" title="ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡"></a>ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡</h1><h2 id="ç¼–å†™-Service-è„šæœ¬"><a href="#ç¼–å†™-Service-è„šæœ¬" class="headerlink" title="ç¼–å†™ Service è„šæœ¬"></a>ç¼–å†™ Service è„šæœ¬</h2><p>Systemd çš„ Service é…ç½®åœ¨ <code>/etc/systemd/system/</code> ç›®å½•ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª <code>echo.service</code> æ–‡ä»¶ï¼Œå®é™…é¡¹ç›®åº”å½“æ”¹ä¸ºå¯¹åº”çš„åç§°ã€‚ç¼–è¾‘æ­¤æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹åˆ—å†…å®¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span><span class="token assign-left variable">Description</span><span class="token operator">=</span>Echo Http Server<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target<span class="token assign-left variable">After</span><span class="token operator">=</span>syslog.target<span class="token punctuation">[</span>Service<span class="token punctuation">]</span><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">65535</span><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/php /opt/servers/echo/server.php<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-USR1</span> <span class="token variable">$MAINPID</span><span class="token assign-left variable">Restart</span><span class="token operator">=</span>always<span class="token punctuation">[</span>Install<span class="token punctuation">]</span><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target graphical.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>After æŒ‡ä»¤çº¦å®šäº†å¯åŠ¨çš„é¡ºåºï¼Œå¿…é¡»åœ¨ network å’Œ syslog å¯åŠ¨åæ‰å¯åŠ¨ echo æœåŠ¡</li><li>Service ä¸­å¡«å†™äº†åº”ç”¨ç¨‹åºçš„è·¯å¾„ä¿¡æ¯ï¼Œè¯·ä¿®æ”¹ä¸ºå®é™…é¡¹ç›®å¯¹åº”çš„è·¯å¾„</li><li>Restart=always è¡¨ç¤ºå¦‚æœè¿›ç¨‹æŒ‚æ‰ä¼šè‡ªåŠ¨æ‹‰èµ·</li><li>WantedBy çº¦å®šäº†åœ¨å“ªäº›ç¯å¢ƒä¸‹å¯åŠ¨ï¼Œmulti-user.target graphical.target è¡¨ç¤ºåœ¨å›¾å½¢ç•Œé¢å’Œå‘½ä»¤è¡Œç¯å¢ƒéƒ½ä¼šå¯åŠ¨</li></ul><p>ç¼–å†™å®Œæˆåéœ€è¦ reload å®ˆæŠ¤è¿›ç¨‹ä½¿å…¶ç”Ÿæ•ˆ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token parameter variable">--system</span> daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç®¡ç†æœåŠ¡"><a href="#ç®¡ç†æœåŠ¡" class="headerlink" title="ç®¡ç†æœåŠ¡"></a>ç®¡ç†æœåŠ¡</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨æœåŠ¡</span><span class="token function">sudo</span> systemctl start echo.service<span class="token comment"># reload æœåŠ¡</span><span class="token function">sudo</span> systemctl reload echo.service<span class="token comment"># å…³é—­æœåŠ¡</span><span class="token function">sudo</span> systemctl stop echo.service<span class="token comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><span class="token function">sudo</span> systemctl status echo.service<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰çš„å¯åŠ¨é¡¹</span><span class="token function">sudo</span> systemctl list-unit-files<span class="token comment"># ç¦ç”¨å¼€æœºå¯åŠ¨</span><span class="token function">sudo</span> systemctl disable echo.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> systemd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åŸºäº PHP æ­å»º GRPC æœåŠ¡</title>
      <link href="posts/e4a23e35.html"/>
      <url>posts/e4a23e35.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP7-4-æ­å»º-GRPC-å®¢æˆ·ç«¯æœåŠ¡"><a href="#PHP7-4-æ­å»º-GRPC-å®¢æˆ·ç«¯æœåŠ¡" class="headerlink" title="PHP7.4 æ­å»º GRPC å®¢æˆ·ç«¯æœåŠ¡"></a>PHP7.4 æ­å»º GRPC å®¢æˆ·ç«¯æœåŠ¡</h1><blockquote><p>æœ¬åœ°ç³»ç»Ÿï¼šMacBook M1 arm64<br>ä¸ºäº†ä¸‹è½½è½¯ä»¶æ–¹ä¾¿ï¼Œç»Ÿä¸€é‡‡ç”¨ Homebrew å®‰è£…è½¯ä»¶<br><strong>php ç›®å‰åªèƒ½æ­å»º gRPC å®¢æˆ·ç«¯</strong>ï¼Œè¯¦è§ <a href="https://grpc.io/docs/languages/php/quickstart/">gRPCå®˜æ–¹æ–‡æ¡£</a>ï¼Œ<br>ä¸è¿‡ä½ è¦æ˜¯æƒ³ä½¿ç”¨ php æ­å»º grpc å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ php åŸºäº swoole çš„ <a href="https://hyperf.io/">hyperfæ¡†æ¶</a><br>å¦‚æœä½ æƒ³ä½¿ç”¨ hyperf æ­å»º grpc å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œä½ å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ä¸ª demo é¡¹ç›® <a href="https://github.com/pudongping/hyperf-grpc-demo">hyperf-grpc-demo</a><br>æœ¬æ–‡ç¤ºä¾‹ä»£ç  <a href="https://github.com/pudongping/php-grpc-demo">php-grpc-demo</a></p></blockquote><h2 id="M1-ä¸‹å®‰è£…-php7-4-å¼€å‘ç¯å¢ƒ"><a href="#M1-ä¸‹å®‰è£…-php7-4-å¼€å‘ç¯å¢ƒ" class="headerlink" title="M1 ä¸‹å®‰è£… php7.4 å¼€å‘ç¯å¢ƒ"></a>M1 ä¸‹å®‰è£… php7.4 å¼€å‘ç¯å¢ƒ</h2><h3 id="ä¸‹è½½-php"><a href="#ä¸‹è½½-php" class="headerlink" title="ä¸‹è½½ php"></a>ä¸‹è½½ php</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ homebrew æœç´¢ php</span>brew search php<span class="token comment"># ä½¿ç”¨ homebrew å®‰è£… php7.4</span>brew <span class="token function">install</span> php@7.4<span class="token comment"># å®‰è£…ä¹‹åçš„ php7.4 åœ¨ /opt/homebrew/etc/php/7.4/ ç›®å½•ä¸‹</span><span class="token comment"># å› ä¸º mac ä¸‹é»˜è®¤å·²ç»å®‰è£…äº† php7.3 ï¼Œå¦‚æœä½ æƒ³é¦–å…ˆä½¿ç”¨ php7.4 ç‰ˆæœ¬æ—¶ï¼Œéœ€è¦æ‰§è¡Œ</span><span class="token builtin class-name">echo</span> <span class="token string">'export PATH="/opt/homebrew/opt/php@7.4/bin:$PATH"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">echo</span> <span class="token string">'export PATH="/opt/homebrew/opt/php@7.4/sbin:$PATH"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc  <span class="token comment"># å¦‚æœæƒ³è¦è®©ç¼–è¯‘å™¨æ‰¾åˆ° php7.4 é‚£ä¹ˆè¿˜éœ€è¦è®¾ç½®</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">LDFLAGS</span><span class="token operator">=</span><span class="token string">"-L/opt/homebrew/opt/php@7.4/lib"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">CPPFLAGS</span><span class="token operator">=</span><span class="token string">"-I/opt/homebrew/opt/php@7.4/include"</span><span class="token comment"># å†™å…¥ .zshrc æ–‡ä»¶ä¹‹åï¼Œéœ€è¦æ‰§è¡Œ source å‘½ä»¤ï¼Œé‡æ–°åŠ è½½é…ç½®ä¿¡æ¯</span><span class="token builtin class-name">source</span> ~/.zshrc<span class="token comment"># å¯ä»¥ä½¿ç”¨ homebrew æ¥ç®¡ç† php7.4 çš„æœåŠ¡çŠ¶æ€ï¼Œæ¯”å¦‚é‡å¯</span>brew services restart php@7.4<span class="token comment"># å¦‚æœä¸éœ€è¦å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ php7.4 æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ</span>/opt/homebrew/opt/php@7.4/sbin/php-fpm <span class="token parameter variable">--nodaemonize</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-composer"><a href="#å®‰è£…-composer" class="headerlink" title="å®‰è£… composer"></a>å®‰è£… composer</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token function">composer</span><span class="token comment"># æŸ¥çœ‹ composer æ˜¯å¦å®‰è£…æˆåŠŸ</span><span class="token function">composer</span> <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…-GRPC-æ‰©å±•"><a href="#å®‰è£…-GRPC-æ‰©å±•" class="headerlink" title="å®‰è£… GRPC æ‰©å±•"></a>å®‰è£… GRPC æ‰©å±•</h2><ul><li>å®‰è£… grpc æ‰©å±•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pecl <span class="token function">install</span> grpc<span class="token comment"># æŸ¥çœ‹ grpc æ‰©å±•æ˜¯å¦å®‰è£…æˆåŠŸ</span>php <span class="token parameter variable">-m</span> <span class="token operator">|</span> <span class="token function">grep</span> grpc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… protobuf æ‰©å±•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pecl <span class="token function">install</span> protobuf<span class="token comment"># æŸ¥çœ‹ protobuf æ‰©å±•æ˜¯å¦å®‰è£…æˆåŠŸ</span>php <span class="token parameter variable">-m</span> <span class="token operator">|</span> <span class="token function">grep</span> protobuf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæç¤ºæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤º</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/opt/homebrew/Cellar/php@7.4/7.4.25/include/php/ext/pcre/php_pcre.h:25:10: fatal error: <span class="token string">'pcre2.h'</span> <span class="token function">file</span> not found<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥å‚è€ƒè¿™æ¡ <a href="https://github.com/swoole/swoole-src/issues/3926">issue</a> å»è§£å†³</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ php7.4 ç‰ˆæœ¬</span><span class="token comment"># pcre2 ç‰ˆæœ¬æ˜¯ 10.39</span><span class="token comment"># å› æ­¤æˆ‘è¿™é‡Œéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼Œéœ€è¦æ³¨æ„æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ m1 ï¼Œintel èŠ¯ç‰‡çš„ Mac homebrew å®‰è£… php çš„è·¯å¾„å’Œ m1 èŠ¯ç‰‡çš„è·¯å¾„ä¸ä¸€è‡´ï¼Œéœ€è¦æŒ‰ç…§ä½ è‡ªå·±çš„å®é™…è·¯å¾„å»å»ºç«‹è½¯è¿æ¥</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /opt/homebrew/Cellar/pcre2/10.39/include/pcre2.h /opt/homebrew/Cellar/php@7.4/7.4.25/include/php/ext/pcre/pcre2.h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç”Ÿæˆ-php-plugins-æ’ä»¶"><a href="#ç”Ÿæˆ-php-plugins-æ’ä»¶" class="headerlink" title="ç”Ÿæˆ php-plugins æ’ä»¶"></a>ç”Ÿæˆ php-plugins æ’ä»¶</h2><blockquote><p>è¿™é‡Œå› ä¸º grpc/grpc è¿™ä¸ªåŒ…éå¸¸å¤§ï¼Œæœ‰å¯èƒ½ä¸‹è½½ä¼šä¸æˆåŠŸï¼Œå› æ­¤æˆ‘å·²ç»å°†ç¼–è¯‘å¥½çš„ <code>grpc_php_plugin</code> äºŒè¿›åˆ¶æ–‡ä»¶ä»¥åŠ <code>protoc</code> äºŒè¿›åˆ¶æ–‡ä»¶ä¸Šä¼ åˆ°äº† <code>tools</code> ç›®å½•ä¸‹<br>æ–¹ä¾¿å„ä½åŒå­¦å¯ä»¥ç›´æ¥ä½¿ç”¨</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">-b</span> v1.27.x https://github.com/grpc/grpc.git<span class="token comment"># å¦‚æœé€Ÿåº¦æ…¢çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ gitee æä¾›çš„é•œåƒ</span><span class="token function">git</span> clone <span class="token parameter variable">-b</span> v1.27.x https://gitee.com/mirrors/grpc.git<span class="token comment"># å®‰è£… grpc åœ¨ github ä¸Šçš„å…¶ä»–ä¾èµ–</span><span class="token function">git</span> submodule update <span class="token parameter variable">--init</span><span class="token comment"># ç¼–è¯‘ç”Ÿæˆ grpc php æ’ä»¶ï¼Œç”Ÿæˆ proto æ–‡ä»¶æ—¶éœ€è¦ç”¨åˆ°</span><span class="token comment"># æ‰§è¡ŒæˆåŠŸä¹‹åä¼šæç¤º</span><span class="token comment"># æ¯”å¦‚æˆ‘çš„ç”Ÿæˆä¹‹åæç¤ºäº†ï¼š[HOSTLD]  Linking /Users/pudongping/php-tools/grpc/bins/opt/grpc_php_plugin</span><span class="token comment"># è¿™é‡Œæˆ‘ä»¬åªç¼–è¯‘äº† php çš„æ’ä»¶ï¼Œå¦‚æœä½ éœ€è¦ç¼–è¯‘æ‰€æœ‰çš„æ’ä»¶ï¼Œä½ éœ€è¦æ‰§è¡Œ `make &amp;&amp; make install`</span><span class="token function">make</span> grpc_php_plugin<span class="token comment"># ç”Ÿæˆçš„ grpc_php_plugin æ’ä»¶åœ¨ `bins/opt/` ç›®å½•ä¸‹</span><span class="token comment"># å¹¶ä¸”è¿˜ä¼šè‡ªåŠ¨ç”Ÿæˆ protoc æ–‡ä»¶ï¼Œåœ¨ `bins/opt/protobuf` ç›®å½•ä¸‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œ <code>make grpc_php_plugin</code> æ—¶ï¼Œ å¦‚æœæç¤ºé”™è¯¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>AUTOGEN<span class="token punctuation">]</span> Preparing protobufCan't <span class="token builtin class-name">exec</span> <span class="token string">"aclocal"</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory at /opt/homebrew/Cellar/autoconf/2.71/share/autoconf/Autom4te/FileUtils.pm line <span class="token number">274</span>.autoreconf: error: aclocal failed with <span class="token builtin class-name">exit</span> status: <span class="token number">2</span>make: *** <span class="token punctuation">[</span>third_party/protobuf/configure<span class="token punctuation">]</span> Error <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆéœ€è¦å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> automake<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h2><ul><li>é¡¹ç›®åˆå§‹åŒ–</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…ˆä½¿ç”¨ composer åˆå§‹åŒ–é¡¹ç›®</span><span class="token function">composer</span> init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å®‰è£… grpc composer æ‰©å±•åŒ…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">composer</span> require grpc/grpc<span class="token function">composer</span> require google/protobuf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨ proto æ–‡ä»¶ç”Ÿæˆ php ä»£ç </li></ul><blockquote><p>ä»¥ä¸‹å‘½ä»¤åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°† protoc äºŒè¿›åˆ¶æ–‡ä»¶å’Œ grpc_php_plugin äºŒè¿›åˆ¶æ–‡ä»¶ç§»åŠ¨åˆ° `/usr/local/bin` ç›®å½•ä¸‹ï¼Œè¿™æ ·å°±ä¸éœ€è¦åƒæˆ‘è¿™æ ·å†™ç»å¯¹è·¯å¾„äº†</span><span class="token comment"># ä¸ä¼šæœ‰ client stub ç±»</span>/Users/pudongping/php-tools/grpc/bins/opt/protobuf/protoc <span class="token parameter variable">--php_out</span><span class="token operator">=</span>plugins<span class="token operator">=</span>grpc:./grpc ./proto/meet.proto<span class="token comment"># ä¼šæœ‰ client stub ç±»ï¼Œæˆ‘è¿™é‡Œéœ€è¦ç”Ÿæˆ client stub ç±»</span>/Users/pudongping/php-tools/grpc/bins/opt/protobuf/protoc <span class="token parameter variable">--php_out</span><span class="token operator">=</span>./grpc <span class="token parameter variable">--grpc_out</span><span class="token operator">=</span>./grpc <span class="token parameter variable">--plugin</span><span class="token operator">=</span>protoc-gen-grpc<span class="token operator">=</span>/Users/pudongping/php-tools/grpc/bins/opt/grpc_php_plugin ./proto/meet.proto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å¦‚æœä½ æƒ³è¿è¡Œæˆ‘çš„è¿™ä¸ª demo ï¼Œä½ éœ€è¦å…ˆä¸‹è½½ composer ä¾èµ–</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</span><span class="token function">composer</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä½ éœ€è¦å…ˆå¯åŠ¨æœåŠ¡ç«¯</p><blockquote><p><a href="https://github.com/pudongping/go-micro-demo">æœåŠ¡ç«¯ä»£ç </a></p></blockquote><p>ç„¶åå†å¯åŠ¨ php å®¢æˆ·ç«¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php index.php<span class="token comment"># string(14) " ä½ å¥½ï¼ŒAlex"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> RPC </tag>
            
            <tag> GRPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ redis ä¸­é€šè¿‡ redis-cli è°ƒè¯• lua è„šæœ¬</title>
      <link href="posts/81563347.html"/>
      <url>posts/81563347.html</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨-redis-ä¸­é€šè¿‡-redis-cli-è°ƒè¯•-lua-è„šæœ¬"><a href="#åœ¨-redis-ä¸­é€šè¿‡-redis-cli-è°ƒè¯•-lua-è„šæœ¬" class="headerlink" title="åœ¨ redis ä¸­é€šè¿‡ redis-cli è°ƒè¯• lua è„šæœ¬"></a>åœ¨ redis ä¸­é€šè¿‡ redis-cli è°ƒè¯• lua è„šæœ¬</h1><h2 id="å‡è®¾æˆ‘æœ‰å¦‚ä¸‹ä¸€æ®µ-lua-è„šæœ¬"><a href="#å‡è®¾æˆ‘æœ‰å¦‚ä¸‹ä¸€æ®µ-lua-è„šæœ¬" class="headerlink" title="å‡è®¾æˆ‘æœ‰å¦‚ä¸‹ä¸€æ®µ lua è„šæœ¬"></a>å‡è®¾æˆ‘æœ‰å¦‚ä¸‹ä¸€æ®µ lua è„šæœ¬</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$redis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.10.194'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$lua</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>EOF</span>local k1 = KEYS[1]local k2 = KEYS[2]local v1 = redis.call('get', k1)local v2 = redis.call('get', k2)if v1 and v2 then    local v1ttl = redis.call('ttl', k1)    local v2ttl = redis.call('ttl', k2)    return {true, k1, v1, k2, v2, v1ttl, v2ttl, v1..v2}else    local now = tonumber(ARGV[1])    redis.call('hsetnx', 'hash_table', k1, now)    redis.call('hsetnx', 'hash_table', k2, now)    local hash_all = redis.call('hgetall', 'hash_table')    return {false, hash_all}end<span class="token delimiter symbol">EOF<span class="token punctuation">;</span></span></span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$lua</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬ä¸€ç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨-â€“eval-é€‰é¡¹ç›´æ¥è°ƒè¯•"><a href="#ç¬¬ä¸€ç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨-â€“eval-é€‰é¡¹ç›´æ¥è°ƒè¯•" class="headerlink" title="ç¬¬ä¸€ç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨ â€“eval é€‰é¡¹ç›´æ¥è°ƒè¯•"></a>ç¬¬ä¸€ç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨ â€“eval é€‰é¡¹ç›´æ¥è°ƒè¯•</h2><p>å…ˆåˆ›å»ºä¸€ä¸ª <code>.lua</code> è„šæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># cat &gt; test.lua &lt;&lt;EOF</span> <span class="token builtin class-name">local</span> k1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token builtin class-name">local</span> k2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token builtin class-name">local</span> v1 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k1<span class="token punctuation">)</span> <span class="token builtin class-name">local</span> v2 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k2<span class="token punctuation">)</span> <span class="token keyword">if</span> v1 and v2 <span class="token keyword">then</span>     <span class="token builtin class-name">local</span> v1ttl <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'ttl'</span>, k1<span class="token punctuation">)</span>     <span class="token builtin class-name">local</span> v2ttl <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'ttl'</span>, k2<span class="token punctuation">)</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>true, k1, v1, k2, v2, v1ttl, v2ttl, v1<span class="token punctuation">..</span>v2<span class="token punctuation">}</span> <span class="token keyword">else</span>     <span class="token builtin class-name">local</span> now <span class="token operator">=</span> tonumber<span class="token punctuation">(</span>ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     redis.call<span class="token punctuation">(</span><span class="token string">'hsetnx'</span>, <span class="token string">'hash_table'</span>, k1, now<span class="token punctuation">)</span>     redis.call<span class="token punctuation">(</span><span class="token string">'hsetnx'</span>, <span class="token string">'hash_table'</span>, k2, now<span class="token punctuation">)</span>     <span class="token builtin class-name">local</span> hash_all <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'hgetall'</span>, <span class="token string">'hash_table'</span><span class="token punctuation">)</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>false, hash_all<span class="token punctuation">}</span> end EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœ k1 å’Œ k2 æœ‰å€¼æ—¶</p><p><strong>æ³¨æ„ï¼šå‚æ•°å’Œå€¼ä¹‹é—´æœ‰ä¸€ä¸ªè‹±æ–‡é€—å·ï¼Œå¹¶ä¸”è‹±æ–‡é€—å·å·¦å³å‡æœ‰ä¸€ä¸ªç©ºæ ¼ï¼</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># redis-cli --eval test.lua name age , 12345</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"name"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"alex"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"age"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"18"</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token parameter variable">-1</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">70535</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"alex18"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœ k1 å’Œ k2 ä¸å­˜åœ¨æ—¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># redis-cli --eval test.lua name1 age1 , 12345</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name1"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"1682404163"</span>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age1"</span>   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"1682404163"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€šè¿‡å¢åŠ -ldb-é€‰é¡¹å¯ç”¨-Lua-è°ƒè¯•å™¨æ¥è°ƒè¯•"><a href="#é€šè¿‡å¢åŠ -ldb-é€‰é¡¹å¯ç”¨-Lua-è°ƒè¯•å™¨æ¥è°ƒè¯•" class="headerlink" title="é€šè¿‡å¢åŠ  --ldb é€‰é¡¹å¯ç”¨ Lua è°ƒè¯•å™¨æ¥è°ƒè¯•"></a>é€šè¿‡å¢åŠ  <code>--ldb</code> é€‰é¡¹å¯ç”¨ Lua è°ƒè¯•å™¨æ¥è°ƒè¯•</h3><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨ <code>--ldb</code> é€‰é¡¹åï¼Œæ‰§è¡Œåˆ°æœ€åä¸€æ­¥ï¼Œæ•°æ®ä¼šè‡ªåŠ¨å›æ»šï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¢«æŒä¹…åŒ–åˆ° redis ä¸­ã€‚ä½ å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ‰§è¡Œåˆ°å‘½ä»¤æœ€åä¼šæœ‰ä¸€è¡Œ <code>(Lua debugging session ended -- dataset changes rolled back)</code> æç¤ºä¿¡æ¯ã€‚</p></blockquote><p>ä½¿ç”¨ Redis å†…ç½®çš„ Lua è°ƒè¯•å™¨æ¥è°ƒè¯• Lua è„šæœ¬ï¼Œå¯ä»¥æŸ¥çœ‹å˜é‡å’Œå‘½ä»¤çš„ç»“æœè¾“å‡ºã€‚é€šè¿‡ <code>--ldb</code> é€‰é¡¹æ¥å¯åŠ¨ä¸€ä¸ªè°ƒè¯•ä¼šè¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ§åˆ¶è°ƒè¯•è¿‡ç¨‹ï¼š</p><ul><li>step: æ‰§è¡Œå½“å‰è¡Œï¼Œå¹¶åœåœ¨ä¸‹ä¸€è¡Œã€‚</li><li>continue: ç»§ç»­æ‰§è¡Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹æˆ–è€…è„šæœ¬ç»“æŸã€‚</li><li>list: æ˜¾ç¤ºå½“å‰è¡Œå‘¨å›´çš„æºä»£ç ã€‚</li><li>break: è®¾ç½®æˆ–åˆ é™¤ä¸€ä¸ªæ–­ç‚¹ã€‚ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªè¡Œå·æˆ–è€…ä¸æŒ‡å®šä»»ä½•å‚æ•°æ¥åˆ é™¤æ‰€æœ‰æ–­ç‚¹ã€‚</li><li>watch: æŸ¥çœ‹ä¸€ä¸ªå˜é‡çš„å€¼ã€‚ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå˜é‡åæˆ–è€…ä¸æŒ‡å®šä»»ä½•å‚æ•°æ¥æŸ¥çœ‹æ‰€æœ‰å˜é‡ã€‚</li><li>trace: æŸ¥çœ‹è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨çš„ Redis å‘½ä»¤ã€‚</li><li>quit: é€€å‡ºè°ƒè¯•ä¼šè¯ã€‚</li></ul><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># redis-cli --ldb --eval test.lua name1 age1 , 12345</span>Lua debugging session started, please use:quit    -- End the session.restart -- Restart the script <span class="token keyword">in</span> debug mode again.<span class="token builtin class-name">help</span>    -- Show Lua script debugging commands.* Stopped at <span class="token number">1</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">1</span>   <span class="token builtin class-name">local</span> k1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">2</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">2</span>   <span class="token builtin class-name">local</span> k2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">4</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">4</span>   <span class="token builtin class-name">local</span> v1 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> restartLua debugging session started, please use:quit    -- End the session.restart -- Restart the script <span class="token keyword">in</span> debug mode again.<span class="token builtin class-name">help</span>    -- Show Lua script debugging commands.* Stopped at <span class="token number">1</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">1</span>   <span class="token builtin class-name">local</span> k1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">2</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">2</span>   <span class="token builtin class-name">local</span> k2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">4</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">4</span>   <span class="token builtin class-name">local</span> v1 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> get name1<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> NULL* Stopped at <span class="token number">5</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">5</span>   <span class="token builtin class-name">local</span> v2 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k2<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> get age1<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> NULL* Stopped at <span class="token number">7</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">7</span>   <span class="token keyword">if</span> v1 and v2 <span class="token keyword">then</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">12</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">12</span>      <span class="token builtin class-name">local</span> now <span class="token operator">=</span> tonumber<span class="token punctuation">(</span>ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> <span class="token builtin class-name">continue</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name1"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"1682404163"</span>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age1"</span>   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"1682404163"</span><span class="token punctuation">(</span>Lua debugging session ended -- dataset changes rolled back<span class="token punctuation">)</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å†è¿›ä¸€æ­¥ï¼Œé€šè¿‡ä½¿ç”¨-redis-debug-å‡½æ•°æ‰“å°è°ƒè¯•ä¿¡æ¯"><a href="#å†è¿›ä¸€æ­¥ï¼Œé€šè¿‡ä½¿ç”¨-redis-debug-å‡½æ•°æ‰“å°è°ƒè¯•ä¿¡æ¯" class="headerlink" title="å†è¿›ä¸€æ­¥ï¼Œé€šè¿‡ä½¿ç”¨ redis.debug() å‡½æ•°æ‰“å°è°ƒè¯•ä¿¡æ¯"></a>å†è¿›ä¸€æ­¥ï¼Œé€šè¿‡ä½¿ç”¨ <code>redis.debug()</code> å‡½æ•°æ‰“å°è°ƒè¯•ä¿¡æ¯</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># cat &gt; redis_debug.lua &lt;&lt;EOF</span> <span class="token builtin class-name">local</span> k1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> redis.debug<span class="token punctuation">(</span><span class="token string">'k1 =&gt; '</span>, k1<span class="token punctuation">)</span> <span class="token builtin class-name">local</span> k2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> redis.debug<span class="token punctuation">(</span><span class="token string">'k2 =&gt; '</span>, k1<span class="token punctuation">)</span> <span class="token builtin class-name">local</span> v1 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k1<span class="token punctuation">)</span> redis.debug<span class="token punctuation">(</span><span class="token string">'v1 =&gt; '</span>, type<span class="token punctuation">(</span>v1<span class="token punctuation">))</span> <span class="token builtin class-name">local</span> v2 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k2<span class="token punctuation">)</span> redis.debug<span class="token punctuation">(</span><span class="token string">'v2 =&gt; '</span>, type<span class="token punctuation">(</span>v2<span class="token punctuation">))</span> <span class="token keyword">if</span> v1 and v2 <span class="token keyword">then</span>      <span class="token builtin class-name">local</span> v1_ttl <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'ttl'</span>, k1<span class="token punctuation">)</span>     <span class="token builtin class-name">local</span> v2_ttl <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'ttl'</span>, k2<span class="token punctuation">)</span>     redis.debug<span class="token punctuation">(</span><span class="token string">'k1 =&gt; '</span>, v1, type<span class="token punctuation">(</span>v1_ttl<span class="token punctuation">))</span>     redis.debug<span class="token punctuation">(</span><span class="token string">'k2 =&gt; '</span>, v2, type<span class="token punctuation">(</span>v2_ttl<span class="token punctuation">))</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>true, k1, v1, k2, v2, v1_ttl, v2_ttl, v1<span class="token punctuation">..</span>v2<span class="token punctuation">}</span> <span class="token keyword">else</span>     redis.debug<span class="token punctuation">(</span><span class="token string">'both v1 and v2 of not exists'</span>, v1, v2<span class="token punctuation">)</span>     <span class="token builtin class-name">local</span> now <span class="token operator">=</span> tonumber<span class="token punctuation">(</span>ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     redis.call<span class="token punctuation">(</span><span class="token string">'hsetnx'</span>, <span class="token string">'hash_table'</span>, k1, now<span class="token punctuation">)</span>     redis.call<span class="token punctuation">(</span><span class="token string">'hsetnx'</span>, <span class="token string">'hash_table'</span>, k2, now<span class="token punctuation">)</span>     <span class="token builtin class-name">local</span> hash_all <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'hgetall'</span>, <span class="token string">'hash_table'</span><span class="token punctuation">)</span>     redis.debug<span class="token punctuation">(</span><span class="token string">'reset the value is ==&gt; '</span>, hash_all, <span class="token string">'hasl_all type is ==&gt; '</span>, type<span class="token punctuation">(</span>hash_all<span class="token punctuation">))</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>false, hash_all<span class="token punctuation">}</span> end EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒè¯•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># redis-cli --ldb --eval redis_debug.lua name age , 12345</span>Lua debugging session started, please use:quit    -- End the session.restart -- Restart the script <span class="token keyword">in</span> debug mode again.<span class="token builtin class-name">help</span>    -- Show Lua script debugging commands.* Stopped at <span class="token number">1</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">1</span>   <span class="token builtin class-name">local</span> k1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">2</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">2</span>   redis.debug<span class="token punctuation">(</span><span class="token string">'k1 =&gt; '</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">2</span>: <span class="token string">"k1 =&gt; "</span>, <span class="token string">"name"</span>* Stopped at <span class="token number">4</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">4</span>   <span class="token builtin class-name">local</span> k2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">5</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">5</span>   redis.debug<span class="token punctuation">(</span><span class="token string">'k2 =&gt; '</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">5</span>: <span class="token string">"k2 =&gt; "</span>, <span class="token string">"name"</span>* Stopped at <span class="token number">7</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">7</span>   <span class="token builtin class-name">local</span> v1 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> get name<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token string">"alex"</span>* Stopped at <span class="token number">8</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">8</span>   redis.debug<span class="token punctuation">(</span><span class="token string">'v1 =&gt; '</span>, type<span class="token punctuation">(</span>v1<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">8</span>: <span class="token string">"v1 =&gt; "</span>, <span class="token string">"string"</span>* Stopped at <span class="token number">10</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">10</span>  <span class="token builtin class-name">local</span> v2 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k2<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> get age<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token string">"18"</span>* Stopped at <span class="token number">11</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">11</span>  redis.debug<span class="token punctuation">(</span><span class="token string">'v2 =&gt; '</span>, type<span class="token punctuation">(</span>v2<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">11</span>: <span class="token string">"v2 =&gt; "</span>, <span class="token string">"string"</span>* Stopped at <span class="token number">13</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">13</span>  <span class="token keyword">if</span> v1 and v2 <span class="token keyword">then</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">14</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">14</span>      <span class="token builtin class-name">local</span> v1_ttl <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'ttl'</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> ttl name<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token parameter variable">-1</span>* Stopped at <span class="token number">15</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">15</span>      <span class="token builtin class-name">local</span> v2_ttl <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'ttl'</span>, k2<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> ttl age<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token number">68213</span>* Stopped at <span class="token number">16</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">16</span>      redis.debug<span class="token punctuation">(</span><span class="token string">'k1 =&gt; '</span>, v1, type<span class="token punctuation">(</span>v1_ttl<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">16</span>: <span class="token string">"k1 =&gt; "</span>, <span class="token string">"alex"</span>, <span class="token string">"number"</span>* Stopped at <span class="token number">17</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">17</span>      redis.debug<span class="token punctuation">(</span><span class="token string">'k2 =&gt; '</span>, v2, type<span class="token punctuation">(</span>v2_ttl<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">17</span>: <span class="token string">"k2 =&gt; "</span>, <span class="token string">"18"</span>, <span class="token string">"number"</span>* Stopped at <span class="token number">18</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">18</span>      <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>true, k1, v1, k2, v2, v1_ttl, v2_ttl, v1<span class="token punctuation">..</span>v2<span class="token punctuation">}</span>lua debugger<span class="token operator">&gt;</span> step<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"name"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"alex"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"age"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"18"</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token parameter variable">-1</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">68213</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"alex18"</span><span class="token punctuation">(</span>Lua debugging session ended -- dataset changes rolled back<span class="token punctuation">)</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@a72e6809fb18:/tmp<span class="token comment"># redis-cli --ldb --eval redis_debug.lua name2 age2 , 55333</span>Lua debugging session started, please use:quit    -- End the session.restart -- Restart the script <span class="token keyword">in</span> debug mode again.<span class="token builtin class-name">help</span>    -- Show Lua script debugging commands.* Stopped at <span class="token number">1</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">1</span>   <span class="token builtin class-name">local</span> k1 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">2</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">2</span>   redis.debug<span class="token punctuation">(</span><span class="token string">'k1 =&gt; '</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">2</span>: <span class="token string">"k1 =&gt; "</span>, <span class="token string">"name2"</span>* Stopped at <span class="token number">4</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">4</span>   <span class="token builtin class-name">local</span> k2 <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">5</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">5</span>   redis.debug<span class="token punctuation">(</span><span class="token string">'k2 =&gt; '</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">5</span>: <span class="token string">"k2 =&gt; "</span>, <span class="token string">"name2"</span>* Stopped at <span class="token number">7</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">7</span>   <span class="token builtin class-name">local</span> v1 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k1<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> get name2<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> NULL* Stopped at <span class="token number">8</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">8</span>   redis.debug<span class="token punctuation">(</span><span class="token string">'v1 =&gt; '</span>, type<span class="token punctuation">(</span>v1<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">8</span>: <span class="token string">"v1 =&gt; "</span>, <span class="token string">"boolean"</span>* Stopped at <span class="token number">10</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">10</span>  <span class="token builtin class-name">local</span> v2 <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'get'</span>, k2<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> get age2<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> NULL* Stopped at <span class="token number">11</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">11</span>  redis.debug<span class="token punctuation">(</span><span class="token string">'v2 =&gt; '</span>, type<span class="token punctuation">(</span>v2<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">11</span>: <span class="token string">"v2 =&gt; "</span>, <span class="token string">"boolean"</span>* Stopped at <span class="token number">13</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">13</span>  <span class="token keyword">if</span> v1 and v2 <span class="token keyword">then</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">20</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">20</span>      redis.debug<span class="token punctuation">(</span><span class="token string">'both v1 and v2 of not exists'</span>, v1, v2<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">20</span>: <span class="token string">"both v1 and v2 of not exists"</span>, false, <span class="token boolean">false</span>* Stopped at <span class="token number">21</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">21</span>      <span class="token builtin class-name">local</span> now <span class="token operator">=</span> tonumber<span class="token punctuation">(</span>ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step* Stopped at <span class="token number">22</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">22</span>      redis.call<span class="token punctuation">(</span><span class="token string">'hsetnx'</span>, <span class="token string">'hash_table'</span>, k1, now<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> hsetnx hash_table name2 <span class="token number">55333</span><span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token number">1</span>* Stopped at <span class="token number">23</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">23</span>      redis.call<span class="token punctuation">(</span><span class="token string">'hsetnx'</span>, <span class="token string">'hash_table'</span>, k2, now<span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> hsetnx hash_table age2 <span class="token number">55333</span><span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token number">1</span>* Stopped at <span class="token number">24</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">24</span>      <span class="token builtin class-name">local</span> hash_all <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">'hgetall'</span>, <span class="token string">'hash_table'</span><span class="token punctuation">)</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>redis<span class="token operator">&gt;</span> hgetall hash_table<span class="token operator">&lt;</span>reply<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"name1"</span>,<span class="token string">"1682404163"</span>,<span class="token string">"age1"</span>,<span class="token string">"1682404163"</span>,<span class="token string">"name2"</span>,<span class="token string">"55333"</span>,<span class="token string">"age2"</span>,<span class="token string">"55333"</span><span class="token punctuation">]</span>* Stopped at <span class="token number">25</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">25</span>      redis.debug<span class="token punctuation">(</span><span class="token string">'reset the value is ==&gt; '</span>, hash_all, <span class="token string">'hasl_all type is ==&gt; '</span>, type<span class="token punctuation">(</span>hash_all<span class="token punctuation">))</span>lua debugger<span class="token operator">&gt;</span> step<span class="token operator">&lt;</span>debug<span class="token operator">&gt;</span> line <span class="token number">25</span>: <span class="token string">"reset the value is ==&gt; "</span>, <span class="token punctuation">{</span><span class="token string">"name1"</span><span class="token punctuation">;</span> <span class="token string">"1682404163"</span><span class="token punctuation">;</span> <span class="token string">"age1"</span><span class="token punctuation">;</span> <span class="token string">"1682404163"</span><span class="token punctuation">;</span> <span class="token string">"name2"</span><span class="token punctuation">;</span> <span class="token string">"55333"</span><span class="token punctuation">;</span> <span class="token string">"age2"</span><span class="token punctuation">;</span> <span class="token string">"55333"</span><span class="token punctuation">}</span>, <span class="token string">"hasl_all type is ==&gt; "</span>, <span class="token string">"table"</span>* Stopped at <span class="token number">26</span>, stop reason <span class="token operator">=</span> step over-<span class="token operator">&gt;</span> <span class="token number">26</span>      <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>false, hash_all<span class="token punctuation">}</span>lua debugger<span class="token operator">&gt;</span> step<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name1"</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"1682404163"</span>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age1"</span>   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"1682404163"</span>   <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"name2"</span>   <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"55333"</span>   <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"age2"</span>   <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"55333"</span><span class="token punctuation">(</span>Lua debugging session ended -- dataset changes rolled back<span class="token punctuation">)</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬äºŒç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨-eval-redis-å‘½ä»¤è¿›è¡Œè°ƒè¯•"><a href="#ç¬¬äºŒç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨-eval-redis-å‘½ä»¤è¿›è¡Œè°ƒè¯•" class="headerlink" title="ç¬¬äºŒç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨ eval redis å‘½ä»¤è¿›è¡Œè°ƒè¯•"></a>ç¬¬äºŒç§è°ƒè¯•æ–¹å¼ï¼šä½¿ç”¨ eval redis å‘½ä»¤è¿›è¡Œè°ƒè¯•</h2><blockquote><p>ä½¿ç”¨è¿™ç§æ–¹å¼æ•°æ®ä¼šè¢«æŒä¹…åŒ–ï¼Œä½†æ˜¯å¦‚æœ lua è„šæœ¬æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆå‘½ä»¤è¡Œå†™èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦ï¼Œä¸å¤ªç›´è§‚ã€‚</p></blockquote><p>å…ˆè¿›å…¥ redis cli ä¸­</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none">eval "local k1 = KEYS[1] \local k2 = KEYS[2] \local v1 = redis.call('get', k1) \local v2 = redis.call('get', k2) \if v1 and v2 then \    local v1ttl = redis.call('ttl', k1) \    local v2ttl = redis.call('ttl', k2) \    return {true, k1, v1, k2, v2, v1ttl, v2ttl, v1..v2} \else \    local now = tonumber(ARGV[1]) \    redis.call('hsetnx', 'hash_table', k1, now) \    redis.call('hsetnx', 'hash_table', k2, now) \    local hash_all = redis.call('hgetall', 'hash_table') \    return {false, hash_all} \end" 2 name age 78675<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰§è¡Œæ•ˆæœ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">eval</span> <span class="token string">"local k1 = KEYS[1] \local k2 = KEYS[2] \local v1 = redis.call('get', k1) \local v2 = redis.call('get', k2) \if v1 and v2 then \    local v1ttl = redis.call('ttl', k1) \    local v2ttl = redis.call('ttl', k2) \    return {true, k1, v1, k2, v2, v1ttl, v2ttl, v1..v2} <span class="token entity" title="\e">\e</span>lse \    local now = tonumber(ARGV[1]) \    redis.call('hsetnx', 'hash_table', k1, now) \    redis.call('hsetnx', 'hash_table', k2, now) \    local hash_all = redis.call('hgetall', 'hash_table') \    return {false, hash_all} <span class="token entity" title="\e">\e</span>nd"</span> <span class="token number">2</span> name age <span class="token number">78675</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"name"</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"alex"</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"age"</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"18"</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token parameter variable">-1</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">65267</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"alex18"</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">eval</span> <span class="token string">"local k1 = KEYS[1] \local k2 = KEYS[2] \local v1 = redis.call('get', k1) \local v2 = redis.call('get', k2) \if v1 and v2 then \    local v1ttl = redis.call('ttl', k1) \    local v2ttl = redis.call('ttl', k2) \    return {true, k1, v1, k2, v2, v1ttl, v2ttl, v1..v2} <span class="token entity" title="\e">\e</span>lse \    local now = tonumber(ARGV[1]) \    redis.call('hsetnx', 'hash_table', k1, now) \    redis.call('hsetnx', 'hash_table', k2, now) \    local hash_all = redis.call('hgetall', 'hash_table') \    return {false, hash_all} <span class="token entity" title="\e">\e</span>nd"</span> <span class="token number">2</span> name4 age4 <span class="token number">78675</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name2"</span>    <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"55333"</span>    <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age2"</span>    <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"55333"</span>    <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"name3"</span>    <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"1682408424"</span>    <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"age3"</span>    <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"1682408424"</span>    <span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">"name4"</span>   <span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">"78675"</span>   <span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">"age4"</span>   <span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">"78675"</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="lua-è„šæœ¬è‡ªèº«é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#lua-è„šæœ¬è‡ªèº«é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="lua è„šæœ¬è‡ªèº«é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ"></a>lua è„šæœ¬è‡ªèº«é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</h2><p>é‚£ï¼Œå‡è®¾æˆ‘å†™çš„ lua è„šæœ¬è‡ªèº«å°±æ˜¯æœ‰é—®é¢˜çš„å‘¢ï¼Ÿé‚£åº”è¯¥å¦‚ä½•æ’æŸ¥ï¼Ÿ</p><blockquote><p>å› ä¸ºä¸ç®¡æ˜¯ lua è„šæœ¬è‡ªèº«è¯­æ³•æœ‰é”™è¯¯ï¼Œè¿˜æ˜¯å› ä¸º lua è„šæœ¬æ ¹æœ¬å°±æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œå‡ä¼šè¿”å› <code>false</code> æ‰€ä»¥æœ‰æ—¶å€™ä½ æ ¹æœ¬æä¸æ¸…æ¥š lua è„šæœ¬åˆ°åº•æœ‰æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œå½“ç„¶ä½ å®Œå…¨å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªå›ºå®šå€¼æ¥è¿›è¡Œåˆ¤æ–­ï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p></blockquote><p>æ¯”å¦‚æˆ‘å°†ä»£ç è°ƒæ•´æˆä»¥ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$redis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.10.194'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$lua</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>EOF</span>local k1 = KEYS[1]local k2 = KEYS[2]-- æ•…æ„å°† get å‘½ä»¤å†™æˆ get1 ä»¥ä¾¿å¼•å‘ä¸€ä¸ª lua è„šæœ¬é”™è¯¯local v1 = redis.call('get1', k1)local v2 = redis.call('get', k2)if v1 and v2 then    local v1_ttl = redis.call('ttl', k1)    local v2_ttl = redis.call('ttl', k2)    return {true, k1, v1, k2, v2, v1_ttl, v2_ttl, v1..v2}else    local now = tonumber(ARGV[1])    redis.call('hsetnx', 'hash_table', k1, now)    redis.call('hsetnx', 'hash_table', k2, now)    local hash_all = redis.call('hgetall', 'hash_table')    return {false, hash_all}end<span class="token delimiter symbol">EOF<span class="token punctuation">;</span></span></span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$lua</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œæƒ…å†µ</p><blockquote><p>å…¶å®è¿™é‡Œè¿”å› <code>false</code> æ˜¯å› ä¸º lua è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œå¹¶ä¸æ˜¯å› ä¸º lua è„šæœ¬æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›å€¼å¯¼è‡´ã€‚</p></blockquote><pre class="line-numbers language-none"><code class="language-none">bash-5.0# php demo.php bool(false)bash-5.0# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨-lua-è„šæœ¬ä¸­çš„-pcall-å‡½æ•°å¤„ç†é”™è¯¯ä¸å¼‚å¸¸"><a href="#ä½¿ç”¨-lua-è„šæœ¬ä¸­çš„-pcall-å‡½æ•°å¤„ç†é”™è¯¯ä¸å¼‚å¸¸" class="headerlink" title="ä½¿ç”¨ lua è„šæœ¬ä¸­çš„ pcall å‡½æ•°å¤„ç†é”™è¯¯ä¸å¼‚å¸¸"></a>ä½¿ç”¨ lua è„šæœ¬ä¸­çš„ <code>pcall</code> å‡½æ•°å¤„ç†é”™è¯¯ä¸å¼‚å¸¸</h3><blockquote><p><a href="https://www.lua.org/pil/8.4.html">lua é”™è¯¯å¤„ç†å’Œå¼‚å¸¸</a></p></blockquote><p>ä»£ç æ›´æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$redis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.10.194'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$lua</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>EOF</span>local ok, res = pcall(function()local k1 = KEYS[1]local k2 = KEYS[2]-- æ•…æ„å°† get å‘½ä»¤å†™æˆ get1 ä»¥ä¾¿å¼•å‘ä¸€ä¸ª lua è„šæœ¬é”™è¯¯local v1 = redis.call('get1', k1)local v2 = redis.call('get', k2)if v1 and v2 then    local v1_ttl = redis.call('ttl', k1)    local v2_ttl = redis.call('ttl', k2)    return {true, k1, v1, k2, v2, v1_ttl, v2_ttl, v1..v2}else    local now = tonumber(ARGV[1])    redis.call('hsetnx', 'hash_table', k1, now)    redis.call('hsetnx', 'hash_table', k2, now)    local hash_all = redis.call('hgetall', 'hash_table')    return {false, hash_all}endend)return {ok, res}<span class="token delimiter symbol">EOF<span class="token punctuation">;</span></span></span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$redis</span><span class="token operator">-&gt;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$lua</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å›ç»“æœ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯ä»¥é€šè¿‡è¿”å›å€¼ä¸­çš„ç¬¬ä¸€ä¸ªå€¼æ¥è¿›è¡Œåˆ¤æ–­ lua è„šæœ¬æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¦‚æœä¸º false ï¼Œç¬¬äºŒä¸ªå€¼å³ä¸ºé”™è¯¯æç¤ºä¿¡æ¯</span>bash-5.0<span class="token comment"># php demo.php </span>array<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>  bool<span class="token punctuation">(</span>false<span class="token punctuation">)</span>  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>  string<span class="token punctuation">(</span><span class="token number">61</span><span class="token punctuation">)</span> <span class="token string">"@user_script: 6: Unknown Redis command called from Lua script"</span><span class="token punctuation">}</span>bash-5.0<span class="token comment"># </span><span class="token comment"># lua è„šæœ¬æ— å¼‚å¸¸æ—¶ï¼Œç¬¬ä¸€ä¸ªå€¼ä¸º 1ï¼Œç¬¬äºŒä¸ªå€¼å³ä¸ºåŒ¿åå‡½æ•°ä¸­è¿”å›çš„å€¼</span>bash-5.0<span class="token comment"># php demo.php </span>array<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>  int<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>  array<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    int<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    string<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"name"</span>    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    string<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"alex"</span>    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    string<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age"</span>    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    string<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"18"</span>    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    int<span class="token punctuation">(</span>-1<span class="token punctuation">)</span>    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    int<span class="token punctuation">(</span><span class="token number">62010</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>    string<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"alex18"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> ç¼“å­˜ </tag>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis æ•°æ®å¤‡ä»½ä¸æ¢å¤</title>
      <link href="posts/c14e496.html"/>
      <url>posts/c14e496.html</url>
      
        <content type="html"><![CDATA[<h1 id="Redis-æ•°æ®å¤‡ä»½ä¸æ¢å¤"><a href="#Redis-æ•°æ®å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="Redis æ•°æ®å¤‡ä»½ä¸æ¢å¤"></a>Redis æ•°æ®å¤‡ä»½ä¸æ¢å¤</h1><h2 id="1-å‘½ä»¤è¡Œæ‰§è¡Œ-save-æ‰‹åŠ¨å¼€å¯-RDB-æŒä¹…åŒ–"><a href="#1-å‘½ä»¤è¡Œæ‰§è¡Œ-save-æ‰‹åŠ¨å¼€å¯-RDB-æŒä¹…åŒ–" class="headerlink" title="1. å‘½ä»¤è¡Œæ‰§è¡Œ save æ‰‹åŠ¨å¼€å¯ RDB æŒä¹…åŒ–"></a>1. å‘½ä»¤è¡Œæ‰§è¡Œ save æ‰‹åŠ¨å¼€å¯ RDB æŒä¹…åŒ–</h2><p>ä½¿ç”¨ RDB æ–‡ä»¶åšè¿ç§»æ—¶ï¼Œéœ€è¦æ³¨æ„éœ€è¦å…ˆå…³é—­æ‰ç›®æ ‡ redis çš„ aof åŠŸèƒ½ï¼Œå› ä¸ºå¦‚æœäºŒè€…åŒæ—¶å­˜åœ¨çš„è¯ï¼Œä¼šä¼˜å…ˆäº aof çš„æ–¹å¼è¿›è¡Œæ•°æ®æ¢å¤ã€‚</p><pre class="line-numbers language-none"><code class="language-none">redis-cli -h {target-host} -a {target-password} config set appendonly no<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¼šé˜»å¡ä¸»è¿›ç¨‹</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> saveOK<span class="token comment"># é€šè¿‡ fork ä¸€ä¸ªä¸“é—¨ save çš„å­è¿›ç¨‹ï¼Œä»è€Œä¸ä¼šé˜»å¡ä¸»è¿›ç¨‹</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bgsaveBackground saving started<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¢å¤"><a href="#æ¢å¤" class="headerlink" title="æ¢å¤"></a>æ¢å¤</h3><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹ redis é»˜è®¤å­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„ç›®å½•è·¯å¾„127.0.0.1:6379&gt; config get dir# æŸ¥çœ‹å¤‡ä»½ RDB æ–‡ä»¶çš„åç§°ï¼Œé»˜è®¤ä¸º `dump.rdb`127.0.0.1:6379&gt; config get dbfilename<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†å¤‡ä»½ä¹‹åçš„ <code>dump.rdb</code> æ–‡ä»¶æ”¾åˆ° <code>config get dir</code> å‘½ä»¤å¾—å‡ºçš„ç›®å½•è·¯å¾„ä¸‹ï¼Œç„¶åé‡å¯ redis å³å¯æ¢å¤ã€‚ï¼ˆå»ºè®®å¤‡ä»½çš„æ—¶å€™ï¼Œå¯ä»¥å°† redis æš‚æ—¶å…³é—­ï¼‰</p><h2 id="2-é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨å¼€å¯-AOF-æŒä¹…åŒ–"><a href="#2-é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨å¼€å¯-AOF-æŒä¹…åŒ–" class="headerlink" title="2. é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨å¼€å¯ AOF æŒä¹…åŒ–"></a>2. é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨å¼€å¯ AOF æŒä¹…åŒ–</h2><h3 id="å¤‡ä»½-1"><a href="#å¤‡ä»½-1" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h3><pre class="line-numbers language-none"><code class="language-none"># å…ˆæ¸…ç©ºç›®æ ‡ redis ä¸­å…¨éƒ¨æ•°æ®redis-cli -h {target-host} -a {target-password} flushall# ç„¶ååœ¨æº redis ä¸­ç”Ÿæˆ aof å¤‡ä»½æ–‡ä»¶redis-cli -h {source-host} -a {source-password} config set appendonly yes# æŸ¥çœ‹ç”Ÿæˆåçš„ appendonly.aof æ–‡ä»¶æ‰€åœ¨ç›®å½•127.0.0.1:6379&gt; config get dir# æŸ¥çœ‹å¤‡ä»½çš„ aof æ–‡ä»¶çš„åç§°ï¼Œé»˜è®¤ä¸º `appendonly.aof`127.0.0.1:6379&gt; config get appendfilename<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¢å¤-1"><a href="#æ¢å¤-1" class="headerlink" title="æ¢å¤"></a>æ¢å¤</h3><pre class="line-numbers language-none"><code class="language-none"># å°† `appendonly.aof` æ–‡ä»¶æ”¾åœ¨å½“å‰è·¯å¾„ä¸‹redis-cli -h {target-host} -a {target-password} --pipe &lt; appendonly.aof# æº redis å…³é—­ aof åŠŸèƒ½redis-cli -h {source-host} -a {source-password} config set appendonly no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å°†å¤‡ä»½ä¹‹åçš„ <code>appendonly.aof</code> æ–‡ä»¶æ”¾åˆ° <code>config get dir</code> å‘½ä»¤å¾—å‡ºçš„ç›®å½•è·¯å¾„ä¸‹ï¼Œç„¶åé‡å¯ redis ä¹Ÿåº”è¯¥å¯æ¢å¤ï¼ˆå…·ä½“æˆ‘æ²¡æœ‰å®æ“ï¼Œçœ‹èµ„æ–™æ‰€è¯´å¦‚æ­¤ï¼‰ã€‚</p><h2 id="3-ä½¿ç”¨-redis-dump"><a href="#3-ä½¿ç”¨-redis-dump" class="headerlink" title="3. ä½¿ç”¨ redis-dump"></a>3. ä½¿ç”¨ <a href="https://github.com/delano/redis-dump">redis-dump</a></h2><p>redis-dump æ˜¯ä¸€ä¸ªç”¨äº redis æ•°æ®å¯¼å…¥å¯¼å‡ºçš„å·¥å…·ï¼ˆå¯ä»¥ä»¥æ–°å¢çš„å½¢å¼å¯¼å…¥ï¼‰ï¼Œæ˜¯åŸºäº Ruby å®ç°çš„ï¼Œå› æ­¤éœ€è¦å…ˆå®‰è£… Ruby ç¯å¢ƒï¼Œå»ºè®®å®‰è£… 2.6.1 ç‰ˆæœ¬ä»¥ä¸Šçš„ Rubyã€‚</p><h3 id="MAC-ä¸Šä½¿ç”¨-Homebrew-å®‰è£…-Ruby"><a href="#MAC-ä¸Šä½¿ç”¨-Homebrew-å®‰è£…-Ruby" class="headerlink" title="MAC ä¸Šä½¿ç”¨ Homebrew å®‰è£… Ruby"></a>MAC ä¸Šä½¿ç”¨ Homebrew å®‰è£… Ruby</h3><pre class="line-numbers language-none"><code class="language-none">brew install ruby<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä½¿ç”¨-rvm-ï¼ˆruby-ç‰ˆæœ¬ç®¡ç†å™¨ï¼‰å®‰è£…-ruby"><a href="#ä½¿ç”¨-rvm-ï¼ˆruby-ç‰ˆæœ¬ç®¡ç†å™¨ï¼‰å®‰è£…-ruby" class="headerlink" title="ä½¿ç”¨ rvm ï¼ˆruby ç‰ˆæœ¬ç®¡ç†å™¨ï¼‰å®‰è£… ruby"></a>ä½¿ç”¨ <a href="https://rvm.io/">rvm</a> ï¼ˆruby ç‰ˆæœ¬ç®¡ç†å™¨ï¼‰å®‰è£… ruby</h3><h4 id="centos-7-ä¸Šå®‰è£…-rvm"><a href="#centos-7-ä¸Šå®‰è£…-rvm" class="headerlink" title="centos 7 ä¸Šå®‰è£… rvm"></a>centos 7 ä¸Šå®‰è£… rvm</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://rvm.io/mpapis.asc <span class="token operator">|</span> gpg2 <span class="token parameter variable">--import</span> -<span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://rvm.io/pkuczynski.asc <span class="token operator">|</span> gpg2 <span class="token parameter variable">--import</span> -<span class="token comment"># å®‰è£…æˆåŠŸä¹‹åé€€å‡ºç»ˆç«¯ï¼Œç„¶åå¯ä»¥é€šè¿‡ `rvm help` è¿›è¡ŒæŸ¥çœ‹</span><span class="token punctuation">\</span>curl <span class="token parameter variable">-sSL</span> https://get.rvm.io <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> stable<span class="token comment"># å¦‚æœä¸æƒ³é€€å‡ºç»ˆç«¯ï¼Œå¯ä»¥ç›´æ¥é‡è½½é…ç½®æ–‡ä»¶</span><span class="token builtin class-name">source</span> /etc/profile.d/rvm.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="rvm-å¸¸ç”¨å‘½ä»¤"><a href="#rvm-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="rvm å¸¸ç”¨å‘½ä»¤"></a>rvm å¸¸ç”¨å‘½ä»¤</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ—å‡ºå·²çŸ¥çš„ ruby ç‰ˆæœ¬</span>rvm list known<span class="token comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ ruby</span>rvm <span class="token function">install</span> <span class="token number">2.3</span>.0<span class="token comment"># æ›´æ–° rvm</span>rvm get stable<span class="token comment"># åˆ‡æ¢åˆ°æŒ‡å®š ruby ç‰ˆæœ¬</span>rvm use <span class="token number">2.2</span>.1<span class="token comment"># è®¾ç½®æŒ‡å®š ruby ç‰ˆæœ¬ä¸ºé»˜è®¤ç‰ˆæœ¬</span>rvm use <span class="token number">2.2</span>.2 <span class="token parameter variable">--default</span><span class="token comment"># æŸ¥è¯¢å·²ç»å®‰è£…çš„ ruby ç‰ˆæœ¬</span>rvm list<span class="token comment"># å¸è½½æŒ‡å®šçš„ ruby ç‰ˆæœ¬</span>rvm remove <span class="token number">1.9</span>.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-redis-dump"><a href="#å®‰è£…-redis-dump" class="headerlink" title="å®‰è£… redis-dump"></a>å®‰è£… redis-dump</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… ruby 2.6.1</span>rvm <span class="token function">install</span> <span class="token number">2.6</span>.1<span class="token comment"># ä½¿ç”¨ 2.6.1</span>rvm use <span class="token number">2.6</span>.1rvm use <span class="token number">2.6</span>.1 <span class="token parameter variable">--default</span><span class="token comment"># æŸ¥çœ‹ ruby ç‰ˆæœ¬</span>ruby <span class="token parameter variable">--version</span><span class="token comment"># æ›¿æ¢ gem é•œåƒåœ°å€</span>gem sources <span class="token parameter variable">--add</span> https://gems.ruby-china.org/ <span class="token parameter variable">--remove</span> https://rubygems.org/<span class="token comment"># æŸ¥çœ‹é•œåƒåœ°å€æ˜¯å¦æ›´æ¢æˆåŠŸ</span>gem sources <span class="token parameter variable">-l</span><span class="token comment"># å®‰è£… redis-dump</span>gem <span class="token function">install</span> redis-dump <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="redis-dump-å¤‡ä»½ä¸æ¢å¤"><a href="#redis-dump-å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="redis-dump å¤‡ä»½ä¸æ¢å¤"></a>redis-dump å¤‡ä»½ä¸æ¢å¤</h3><blockquote><p>ä»¥å¢é‡çš„å½¢å¼æ¢å¤</p></blockquote><h4 id="å¤‡ä»½-2"><a href="#å¤‡ä»½-2" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h4><pre class="line-numbers language-none"><code class="language-none"># æ•°æ®å¯¼å‡ºredis-dump -u 127.0.0.1:6379 &gt; data.json# å¯¼å‡ºæŒ‡å®šæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæ¯”å¦‚è¯´ 8 å·æ•°æ®åº“redis-dump -u 127.0.0.1:6379 -d 8 &gt; data8.json# å¦‚æœ redis è®¾ç½®äº†æœ‰å¯†ç redis-dump -u {host} -a {password} &gt; data.jsonredis-dump -u :{password}@127.0.0.1:6379 &gt; data.json# å¦‚æœéœ€è¦å¯¼å‡ºçš„ redis æ˜¯ä¸€ä¸ª URL è¿æ¥åœ°å€æ—¶ï¼Œè²Œä¼¼å¯ä»¥è¿™æ ·ï¼ˆæ²¡æœ‰å®æ“è¿‡ï¼Œå…·ä½“ä¸æ¸…æ¥šï¼‰redis-dump -u :{password}@{domain}:{port}# eg: redis-dump -u :123456@www.alex.com:9055<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ¢å¤-2"><a href="#æ¢å¤-2" class="headerlink" title="æ¢å¤"></a>æ¢å¤</h4><pre class="line-numbers language-none"><code class="language-none"># å¯¼å…¥å‘½ä»¤cat data.json | redis-load# æˆ–è€…&lt; data.json redis-load# å¯¼å…¥æ•°æ®åˆ° 8 å·æ•°æ®åº“cat data8.json | redis-load -u 127.0.0.1:6379 -a 123456 -d 8# æˆ–è€…&lt; data8.json redis-load -u 127.0.0.1:6379 -a 123456 -d 8# å¦‚æœä»¥ä¸Šå‘½ä»¤æ˜¯å› ä¸º utf-8 æ ¼å¼æŠ¥é”™æ—¶ï¼Œå¯ä»¥åŠ ä¸Š `-n` å‚æ•°cat data8.json | redis-load -n -u 127.0.0.1:6379 -a 123456 -d 8# å¦‚æœ redis è®¾ç½®äº†æœ‰å¯†ç cat data.json | redis-load -u :password@127.0.0.1:6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-é€šè¿‡è„šæœ¬å®ç°è¿ç§»"><a href="#4-é€šè¿‡è„šæœ¬å®ç°è¿ç§»" class="headerlink" title="4. é€šè¿‡è„šæœ¬å®ç°è¿ç§»"></a>4. é€šè¿‡è„šæœ¬å®ç°è¿ç§»</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token comment"># é€šè¿‡è¿™ä¸ªè„šæœ¬æ‰§è¡Œå¤‡ä»½æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼Œä¸€æ˜¯ä½¿ç”¨äº† `keys *` ï¼ŒäºŒæ˜¯é‚£å°±æ˜¯ä¼šå°† source_host ä¸­æ‰€æœ‰çš„ key</span><span class="token comment"># åŒæ­¥åˆ° target_host æ—¶ï¼Œä¼šè‡ªåŠ¨æ”¹æˆæ°¸ä¸è¿‡æœŸ</span><span class="token comment"># è¯¦è§ `restore` å‘½ä»¤</span><span class="token comment"># åæœŸæœ‰æ—¶é—´äº†ï¼Œå†è€ƒè™‘ä¼˜åŒ–çš„äº‹æƒ…å§</span><span class="token comment"># document link: https://www.redis.com.cn/commands/restore.html</span><span class="token assign-left variable">source_host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1<span class="token assign-left variable">source_port</span><span class="token operator">=</span><span class="token number">6379</span><span class="token assign-left variable">source_password</span><span class="token operator">=</span><span class="token string">''</span><span class="token assign-left variable">source_db</span><span class="token operator">=</span><span class="token number">1</span><span class="token assign-left variable">target_host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1<span class="token assign-left variable">target_port</span><span class="token operator">=</span><span class="token number">6379</span><span class="token assign-left variable">target_password</span><span class="token operator">=</span><span class="token string">''</span><span class="token assign-left variable">target_db</span><span class="token operator">=</span><span class="token number">2</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$source_password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$target_password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">then</span>  redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> keys <span class="token string">'*'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> key  <span class="token keyword">do</span>      redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> <span class="token parameter variable">--raw</span> dump <span class="token variable">$key</span> <span class="token operator">|</span> perl <span class="token parameter variable">-pe</span> <span class="token string">'chomp if eof'</span> <span class="token operator">|</span> redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${target_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${target_port}</span> <span class="token parameter variable">-n</span> <span class="token variable">${target_db}</span> <span class="token parameter variable">-x</span> restore <span class="token variable">$key</span> <span class="token number">0</span>      <span class="token builtin class-name">echo</span> <span class="token string">"migrate key <span class="token variable">$key</span>"</span>  <span class="token keyword">done</span><span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$source_password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token variable">$target_password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">then</span>  redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> keys <span class="token string">'*'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> key  <span class="token keyword">do</span>      redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> <span class="token parameter variable">--raw</span> dump <span class="token variable">$key</span> <span class="token operator">|</span> perl <span class="token parameter variable">-pe</span> <span class="token string">'chomp if eof'</span> <span class="token operator">|</span> redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${target_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${target_port}</span> <span class="token parameter variable">-a</span> <span class="token variable">${target_password}</span> <span class="token parameter variable">-n</span> <span class="token variable">${target_db}</span> <span class="token parameter variable">-x</span> restore <span class="token variable">$key</span> <span class="token number">0</span>      <span class="token builtin class-name">echo</span> <span class="token string">"migrate key <span class="token variable">$key</span>"</span>  <span class="token keyword">done</span><span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token variable">$source_password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$target_password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">then</span>  redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-a</span> <span class="token variable">${source_password}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> keys <span class="token string">'*'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> key  <span class="token keyword">do</span>      redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-a</span> <span class="token variable">${source_password}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> <span class="token parameter variable">--raw</span> dump <span class="token variable">$key</span> <span class="token operator">|</span> perl <span class="token parameter variable">-pe</span> <span class="token string">'chomp if eof'</span> <span class="token operator">|</span> redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${target_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${target_port}</span> <span class="token parameter variable">-n</span> <span class="token variable">${target_db}</span> <span class="token parameter variable">-x</span> restore <span class="token variable">$key</span> <span class="token number">0</span>      <span class="token builtin class-name">echo</span> <span class="token string">"migrate key <span class="token variable">$key</span>"</span>  <span class="token keyword">done</span><span class="token keyword">else</span>  redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-a</span> <span class="token variable">${source_password}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> keys <span class="token string">'*'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> key  <span class="token keyword">do</span>      redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${source_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${source_port}</span> <span class="token parameter variable">-a</span> <span class="token variable">${source_password}</span> <span class="token parameter variable">-n</span> <span class="token variable">${source_db}</span> <span class="token parameter variable">--raw</span> dump <span class="token variable">$key</span> <span class="token operator">|</span> perl <span class="token parameter variable">-pe</span> <span class="token string">'chomp if eof'</span> <span class="token operator">|</span> redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${target_host}</span> <span class="token parameter variable">-p</span> <span class="token variable">${target_port}</span> <span class="token parameter variable">-a</span> <span class="token variable">${target_password}</span> <span class="token parameter variable">-n</span> <span class="token variable">${target_db}</span> <span class="token parameter variable">-x</span> restore <span class="token variable">$key</span> <span class="token number">0</span>      <span class="token builtin class-name">echo</span> <span class="token string">"migrate key <span class="token variable">$key</span>"</span>  <span class="token keyword">done</span><span class="token keyword">fi</span><span class="token comment"># å…¶å®å°±æ˜¯åˆ©ç”¨äº† redis çš„ dump å’Œ restore å‘½ä»¤</span><span class="token comment"># egï¼š</span><span class="token comment"># 127.0.0.1:6379[1]&gt; set hello "hello, dumping world!"</span><span class="token comment"># OK</span><span class="token comment"># 127.0.0.1:6379[1]&gt; dump hello</span><span class="token comment"># "\x00\x15hello, dumping world!\t\x00\x03\xbfc\xcey\xa1\x9e\xfc"</span><span class="token comment"># 127.0.0.1:6379[1]&gt; restore hello1 0 "\x00\x15hello, dumping world!\t\x00\x03\xbfc\xcey\xa1\x9e\xfc"</span><span class="token comment"># OK</span><span class="token comment"># 127.0.0.1:6379[1]&gt; get hello1</span><span class="token comment"># "hello, dumping world!"</span><span class="token comment"># 127.0.0.1:6379[1]&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-redis-ä½¿ç”¨-migrate-å‘½ä»¤è¿ç§»æ•°æ®è„šæœ¬"><a href="#5-redis-ä½¿ç”¨-migrate-å‘½ä»¤è¿ç§»æ•°æ®è„šæœ¬" class="headerlink" title="5. redis ä½¿ç”¨ migrate å‘½ä»¤è¿ç§»æ•°æ®è„šæœ¬"></a>5. redis ä½¿ç”¨ migrate å‘½ä»¤è¿ç§»æ•°æ®è„šæœ¬</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token assign-left variable">src_redis</span><span class="token operator">=</span><span class="token string">"10.8.163.1"</span><span class="token assign-left variable">src_port</span><span class="token operator">=</span><span class="token string">"6379"</span><span class="token assign-left variable">dest_redis</span><span class="token operator">=</span><span class="token string">"10.8.132.13"</span><span class="token assign-left variable">dest_port</span><span class="token operator">=</span><span class="token string">"6379"</span><span class="token keyword">for</span> <span class="token for-or-select variable">y</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span>redis-cli <span class="token parameter variable">-h</span> $<span class="token punctuation">{</span>src_redis<span class="token punctuation">}</span> <span class="token parameter variable">-p</span> $<span class="token punctuation">{</span>src_port<span class="token punctuation">}</span> keys <span class="token string">"*"</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>   redis-cli <span class="token parameter variable">-h</span> <span class="token variable">${src_redis}</span> <span class="token parameter variable">-p</span> <span class="token variable">${src_port}</span> migrate <span class="token variable">${dest_redis}</span> <span class="token variable">${dest_port}</span> <span class="token variable">${y}</span> <span class="token number">0</span> <span class="token number">1000</span> copy replace   <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token punctuation">\</span> %T<span class="token variable">)</span></span> Copy key <span class="token variable">${y}</span> to new redis...."</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go æ‰“åŒ…å’Œéƒ¨ç½²</title>
      <link href="posts/5c09a73d.html"/>
      <url>posts/5c09a73d.html</url>
      
        <content type="html"><![CDATA[<h1 id="Go-æ‰“åŒ…å’Œéƒ¨ç½²"><a href="#Go-æ‰“åŒ…å’Œéƒ¨ç½²" class="headerlink" title="Go æ‰“åŒ…å’Œéƒ¨ç½²"></a>Go æ‰“åŒ…å’Œéƒ¨ç½²</h1><h2 id="æ‰“åŒ…ç›¸å…³å‘½ä»¤"><a href="#æ‰“åŒ…ç›¸å…³å‘½ä»¤" class="headerlink" title="æ‰“åŒ…ç›¸å…³å‘½ä»¤"></a>æ‰“åŒ…ç›¸å…³å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>go run</td><td>ç¼–è¯‘å¹¶é©¬ä¸Šè¿è¡Œ go ç¨‹åºï¼ˆåªæ¥æ”¶ main åŒ…ä¸‹çš„æ–‡ä»¶ä½œä¸ºå‚æ•°ï¼‰</td></tr><tr><td>go build</td><td>ç¼–è¯‘æŒ‡å®šçš„æºæ–‡ä»¶ã€è½¯ä»¶åŒ…åŠå…¶ä¾èµ–é¡¹ï¼Œä½†å®ƒä¸ä¼šè¿è¡Œç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚(å¦‚æœæƒ³è¦æŒ‡å®šæ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸ºå…¶ä»–åç§°ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>-o</code> å‚æ•°è¿›è¡Œè°ƒæ•´)</td></tr><tr><td>go install</td><td>ç¼–è¯‘å¹¶å®‰è£…æºæ–‡ä»¶ã€è½¯ä»¶åŒ…åˆ° <code>$GOBIN</code> ç›®å½•ä¸‹ã€‚ å¯ä»¥æ‰§è¡Œ <code>go install -x</code> æŸ¥çœ‹å®ƒçš„ç¼–è¯‘è¿‡ç¨‹ã€‚æ–‡ä»¶åç§°ä¸º Go modules çš„é¡¹ç›®åï¼Œè€Œä¸æ˜¯ç›®å½•å</td></tr></tbody></table><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-x</td><td>æ‰“å°ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ‰€æœ‰æ‰§è¡Œå‘½ä»¤ï¼Œæ‰§è¡Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š<code>go run -x main.go</code> å’Œ <code>go build -x</code></td></tr><tr><td>-n</td><td>æ‰“å°ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ‰€æœ‰æ‰§è¡Œå‘½ä»¤ï¼Œä¸æ‰§è¡Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶</td></tr><tr><td>-a</td><td>å¼ºåˆ¶é‡æ–°ç¼–è¯‘æ‰€æœ‰æ¶‰åŠçš„ä¾èµ–ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸åˆ©ç”¨ç¼“å­˜æˆ–å·²ç¼–è¯‘å¥½çš„éƒ¨åˆ†æ–‡ä»¶ï¼Œç›´æ¥æ‰€æœ‰åŒ…éƒ½æ˜¯æœ€æ–°çš„ä»£ç é‡æ–°ç¼–è¯‘å’Œå…³è”</td></tr><tr><td>-o</td><td>æŒ‡å®šç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶åç§°</td></tr><tr><td>-p</td><td>æŒ‡å®šç¼–è¯‘è¿‡ç¨‹ä¸­å¯ä»¥å¹¶å‘è¿è¡Œç¨‹åºçš„æ•°é‡ï¼Œé»˜è®¤å€¼ä¸ºå¯ç”¨çš„ CPU æ•°é‡ï¼ˆGo è¯­è¨€é»˜è®¤æ˜¯æ”¯æŒå¹¶å‘ç¼–è¯‘çš„ï¼‰</td></tr><tr><td>-work</td><td>æ‰“å°ä¸´æ—¶å·¥ä½œç›®å½•çš„å®Œæ•´è·¯å¾„ï¼Œåœ¨é€€å‡ºæ—¶ä¸åˆ é™¤è¯¥ç›®å½•</td></tr><tr><td>-race</td><td>å¯ç”¨æ•°æ®ç«äº‰æ£€æµ‹ï¼Œç›®å‰ä»…æ”¯æŒ Linux/amd64ã€FreeBSD/amd64ã€Darwin/amd64 å’Œ Windows/amd64 å¹³å°</td></tr><tr><td>-installsuffix</td><td>åœ¨è½¯ä»¶åŒ…å®‰è£…çš„ç›®å½•ä¸­å¢åŠ åç¼€æ ‡è¯†ï¼Œä»¥ä¿æŒè¾“å‡ºä¸é»˜è®¤ç‰ˆæœ¬åˆ†å¼€</td></tr></tbody></table><h2 id="è·¨å¹³å°äº¤å‰ç¼–è¯‘"><a href="#è·¨å¹³å°äº¤å‰ç¼–è¯‘" class="headerlink" title="è·¨å¹³å°äº¤å‰ç¼–è¯‘"></a>è·¨å¹³å°äº¤å‰ç¼–è¯‘</h2><p>Go è¯­è¨€æ”¯æŒè·¨å¹³å°äº¤å‰ç¼–è¯‘ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨ Windows æˆ– Mac å¹³å°ä¸‹ç¼–å†™ä»£ç ï¼Œæœ€åå°†ä»£ç ç¼–è¯‘æˆèƒ½å¤Ÿåœ¨ Linux amd64 æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ç¨‹åºã€‚</p><p>æ ¹ç›®å½•ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å¯ä»¥é™æ€ç¼–è¯‘ <code>Linux</code> å¹³å° <code>amd64</code> æ¶æ„çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token parameter variable">-o</span> <span class="token operator">&lt;</span>application-name<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚</span><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux go build <span class="token parameter variable">-a</span> <span class="token parameter variable">-installsuffix</span> cgo <span class="token parameter variable">-o</span> <span class="token operator">&lt;</span>application-name<span class="token operator">&gt;</span> <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Windows ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å››ä¸ªå‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SET <span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span>SET <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linuxSET <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64go build <span class="token parameter variable">-o</span> <span class="token operator">&lt;</span>application-name<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>å‚æ•°å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>CGO_ENABLED</td><td>è®¾ç½®æ˜¯å¦åœ¨ Go ä»£ç ä¸­è°ƒç”¨ C ä»£ç ã€‚0 ä¸ºå…³é—­ï¼Œé‡‡ç”¨çº¯é™æ€ç¼–è¯‘ã€‚å¯é€šè¿‡æ‰§è¡Œ go env è¿›è¡ŒæŸ¥çœ‹</td></tr><tr><td>GOOS</td><td>ç›®æ ‡æ“ä½œç³»ç»Ÿï¼Œå¦‚ Linux ã€Darwinã€Windows</td></tr><tr><td>GOARCH</td><td>ç›®æ ‡æ“ä½œç³»ç»Ÿçš„æ¶æ„ï¼Œè‹¥ä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤å€¼ä¸ºç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡è®¡ç®—æ¶æ„ä¸€è‡´</td></tr><tr><td>GOHOSTOS</td><td>ç”¨äºæ ‡è¯†ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡æ“ä½œç³»ç»Ÿ</td></tr><tr><td>GOHOSTARCH</td><td>ç”¨äºæ ‡è¯†ç¨‹åºè¿è¡Œç¯å¢ƒçš„ç›®æ ‡è®¡ç®—æ¶æ„</td></tr></tbody></table><p><strong>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ Go æ”¯æŒ OS å’Œå¹³å°åˆ—è¡¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go tool dist list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th>ç³»ç»Ÿ</th><th>GOOS</th><th>GOARCH</th></tr></thead><tbody><tr><td>Windows 32ä½</td><td>windows</td><td>386</td></tr><tr><td>Windows 64ä½</td><td>windows</td><td>amd64</td></tr><tr><td>OS X 32ä½</td><td>darwin</td><td>386</td></tr><tr><td>OS X 64ä½</td><td>darwin</td><td>amd64</td></tr><tr><td>Linux 32ä½</td><td>linux</td><td>386</td></tr><tr><td>Linux 64ä½</td><td>linux</td><td>amd64</td></tr></tbody></table><h2 id="ç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…·"><a href="#ç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…·" class="headerlink" title="ç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…·"></a>ç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…·</h2><p>ä»¥ä¸‹å‡ ä¸ªç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…·å¯ä»¥å°†é™æ€æ–‡ä»¶ï¼ˆJSã€CSSã€å›¾ç‰‡ï¼‰æˆ–è€…æ¨¡ç‰ˆæ–‡ä»¶ç­‰é <code>.go</code> æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œ <a href="https://pkg.go.dev/embed">Embed</a> æ ‡å‡†åº“ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯å¾—ä½¿ç”¨ go 1.16 ç‰ˆæœ¬ä»¥åçš„ç‰ˆæœ¬æ‰è¡Œã€‚</p><ul><li><a href="https://github.com/go-bindata/go-bindata">go-bindata/go-bindata</a>ï¼šæ¨èä½¿ç”¨è¿™ä¸ª</li><li><a href="https://github.com/gobuffalo/packr">gobuffalo/packr</a></li><li><a href="https://github.com/markbates/pkger">markbates/pkger</a></li><li><a href="https://github.com/rakyll/statik">rakyll/statik</a></li><li><a href="https://github.com/knadh/stuffbin">knadh/stuffbin</a></li><li><a href="https://github.com/go-bindata/go-bindata">github.com/go-bindata/go-bindata</a></li><li><a href="https://github.com/elazarl/go-bindata-assetfs">elazarl/go-bindata-assetfs</a></li><li><a href="https://github.com/GeertJohan/go.rice">GeertJohan/go.rice</a></li></ul><h3 id="å°†æ•°æ®æ–‡ä»¶è½¬æ¢æˆ-go-ä»£ç "><a href="#å°†æ•°æ®æ–‡ä»¶è½¬æ¢æˆ-go-ä»£ç " class="headerlink" title="å°†æ•°æ®æ–‡ä»¶è½¬æ¢æˆ go ä»£ç "></a>å°†æ•°æ®æ–‡ä»¶è½¬æ¢æˆ go ä»£ç </h3><blockquote><p><a href="https://github.com/go-bindata/go-bindata">go-bindata</a> åº“å¯ä»¥å°†æ•°æ®æ–‡ä»¶è½¬æ¢ä¸º Go ä»£ç ã€‚ä¾‹å¦‚ï¼šå¸¸è§çš„é…ç½®æ–‡ä»¶ã€èµ„æºæ–‡ä»¶ï¼ˆå¦‚ swagger uiï¼‰<br>å› æ­¤è¯»å–é…ç½®ä¿¡æ¯ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://github.com/go-bindata/go-bindata/">go-bindata/go-bindata</a> åŒ…æä¾›çš„æ–¹å¼æ¥è¯»å–ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p></blockquote><ol><li>å®‰è£… <code>go-bindata/go-bindata</code> åŒ…</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/go-bindata/go-bindata/<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>å°†é…ç½®æ–‡ä»¶ç”Ÿæˆ go ä»£ç </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰§è¡Œè¿™æ¡å‘½ä»¤åï¼Œä¼šå°† `configs/config.yaml` æ–‡ä»¶æ‰“åŒ…ï¼Œå¹¶é€šè¿‡ `-o` å‚æ•°é€‰æ‹©æŒ‡å®šçš„è·¯å¾„è¾“å‡ºåˆ° `configs/config.go` æ–‡ä»¶ä¸­</span><span class="token comment"># å†é€šè¿‡ `-pkg` é€‰é¡¹æŒ‡å®šç”Ÿæˆçš„åŒ…åä¸º `configs`</span>go-bindata <span class="token parameter variable">-o</span> configs/config.go -pkg-configs configs/config.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>è¯»å–æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">data<span class="token punctuation">,</span> err <span class="token operator">:=</span> configs<span class="token punctuation">.</span><span class="token function">Asset</span><span class="token punctuation">(</span><span class="token string">"configs/config.yaml"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¼–è¯‘ç¼“å­˜"><a href="#ç¼–è¯‘ç¼“å­˜" class="headerlink" title="ç¼–è¯‘ç¼“å­˜"></a>ç¼–è¯‘ç¼“å­˜</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ç¼–è¯‘ç¼“å­˜æ‰€åœ¨çš„ç›®å½•</span>go <span class="token function">env</span> GOCACHE<span class="token comment"># æ¸…ç†ç¼–è¯‘ç¼“å­˜</span>go clean <span class="token parameter variable">-cache</span><span class="token comment"># æŸ¥çœ‹ç¨‹åºç¼–è¯‘çš„æ—¶é—´</span><span class="token function">time</span> go build<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‹ç¼©ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#å‹ç¼©ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="å‹ç¼©ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶"></a>å‹ç¼©ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶</h2><blockquote><p><strong>å¦‚éå¿…è¦æƒ…å†µï¼Œä¸å»ºè®®å‹ç¼©</strong></p></blockquote><ul><li>æ–¹å¼ä¸€ï¼šå»æ‰ DWARF è°ƒè¯•ä¿¡æ¯å’Œç¬¦å·è¡¨ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go build <span class="token parameter variable">-ldflags</span><span class="token operator">=</span><span class="token string">"-w -s"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th>å‚æ•°å</th><th>å«ä¹‰</th><th>å‰¯ä½œç”¨</th></tr></thead><tbody><tr><td>-w</td><td>å»é™¤ DWARF è°ƒè¯•ä¿¡æ¯</td><td>ä¼šå¯¼è‡´å¼‚å¸¸ panic æŠ›å‡ºæ—¶ï¼Œè°ƒç”¨å †æ ˆä¿¡æ¯æ²¡æœ‰æ–‡ä»¶åã€è¡Œå·ä¿¡æ¯</td></tr><tr><td>-s</td><td>å»é™¤ç¬¦å·è¡¨ä¿¡æ¯</td><td>æ— æ³•ä½¿ç”¨ gdb è°ƒè¯•</td></tr></tbody></table><ul><li>æ–¹å¼äºŒï¼šä½¿ç”¨ <a href="https://github.com/upx/upx">upx</a>ã€ <a href="https://niconiconi.fun/2019/01/10/upx-tutorial/">upx æ•™ç¨‹</a> å·¥å…·å¯¹å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œå‹ç¼©</li></ul><h2 id="ç¼–è¯‘ä¿¡æ¯å†™å…¥ï¼ˆä½¿ç”¨-ldflags-è®¾ç½®ç¼–è¯‘ä¿¡æ¯ï¼‰"><a href="#ç¼–è¯‘ä¿¡æ¯å†™å…¥ï¼ˆä½¿ç”¨-ldflags-è®¾ç½®ç¼–è¯‘ä¿¡æ¯ï¼‰" class="headerlink" title="ç¼–è¯‘ä¿¡æ¯å†™å…¥ï¼ˆä½¿ç”¨ ldflags è®¾ç½®ç¼–è¯‘ä¿¡æ¯ï¼‰"></a>ç¼–è¯‘ä¿¡æ¯å†™å…¥ï¼ˆä½¿ç”¨ ldflags è®¾ç½®ç¼–è¯‘ä¿¡æ¯ï¼‰</h2><blockquote><p><a href="https://ms2008.github.io/2018/10/08/golang-build-version/">go version ä¿¡æ¯æ³¨å…¥</a></p></blockquote><ul><li>å…ˆåœ¨ <code>main.go</code> æ–‡ä»¶ä¸­å†™å…¥ä»£ç </li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> <span class="token punctuation">(</span>buildTime    <span class="token builtin">string</span> <span class="token comment">// äºŒè¿›åˆ¶æ–‡ä»¶ç¼–è¯‘æ—¶é—´</span>buildVersion <span class="token builtin">string</span> <span class="token comment">// äºŒè¿›åˆ¶æ–‡ä»¶ç¼–è¯‘ç‰ˆæœ¬</span>goVersion    <span class="token builtin">string</span> <span class="token comment">// æ‰“åŒ…äºŒè¿›åˆ¶æ–‡ä»¶æ—¶çš„ go ç‰ˆæœ¬ä¿¡æ¯</span>gitCommitID  <span class="token builtin">string</span> <span class="token comment">// äºŒè¿›åˆ¶æ–‡ä»¶ç¼–è¯‘æ—¶çš„ git æäº¤ç‰ˆæœ¬å·</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>args <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"--version"</span> <span class="token operator">||</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"-v"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Build Time: %s \n"</span><span class="token punctuation">,</span> buildTime<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Build Version: %s \n"</span><span class="token punctuation">,</span> buildVersion<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Build Go Version: %s \n"</span><span class="token punctuation">,</span> goVersion<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Build Git Commit Hash ID: %s \n"</span><span class="token punctuation">,</span> gitCommitID<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¼–è¯‘ä»£ç æ—¶æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go build <span class="token parameter variable">-o</span> app-service <span class="token parameter variable">-ldflags</span> <span class="token punctuation">\</span><span class="token string">"-X main.buildTime=<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y-%m-%d,%H:%M:%S<span class="token variable">`</span></span> -X main.buildVersion=1.0.0 -X 'main.goVersion=<span class="token variable"><span class="token variable">$(</span>go version<span class="token variable">)</span></span>' -X main.gitCommitID=<span class="token variable"><span class="token variable">`</span><span class="token function">git</span> rev-parse HEAD<span class="token variable">`</span></span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œé€šè¿‡ <code>-ldflags</code> å‘½ä»¤çš„ <code>-X</code> å‚æ•°å¯ä»¥åœ¨é“¾æ¥æ—¶å°†ä¿¡æ¯å†™å…¥å˜é‡ä¸­ï¼Œå…¶æ ¼å¼ä¸ºï¼š<code>package_name.variable_name=value</code></p></blockquote><ul><li>æŸ¥çœ‹ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œç‰ˆæœ¬ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./app-service <span class="token parameter variable">-version</span><span class="token comment"># output is:</span><span class="token comment"># Build Time: 2022-03-27,13:50:26</span><span class="token comment"># Build Version: 1.0.0</span><span class="token comment"># Build Go Version: go version go1.16.3 darwin/amd64</span><span class="token comment"># Build Git Commit Hash ID: b3473e9cc98148f5c94b53c1cada7de133143462</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="å…³äºå®ˆæŠ¤è¿›ç¨‹"><a href="#å…³äºå®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="å…³äºå®ˆæŠ¤è¿›ç¨‹"></a>å…³äºå®ˆæŠ¤è¿›ç¨‹</h3><ul><li><code>nohup</code> â€”â€” linux ç³»ç»Ÿå†…ç½®ï¼Œç›´æ¥ä½¿ç”¨ <code>nohup ./&lt;executable-file&gt; &amp;</code> å³å¯</li><li><code>systemctl</code> â€”â€” linux ç³»ç»Ÿå†…ç½®ï¼Œéœ€è¦é…ç½® systemctl ç®¡ç†é…ç½®æ–‡ä»¶</li><li><code>supervisor</code></li><li><a href="https://github.com/ochinchina/supervisord">go-supervisor</a> â€”â€” Go è¯­è¨€å®ç°ä½† supervisorï¼Œå¥½å¤„æ˜¯ä¸éœ€è¦å®‰è£… Python ç¯å¢ƒ</li></ul><h4 id="1-ä½¿ç”¨-supervisor-éƒ¨ç½²ï¼š"><a href="#1-ä½¿ç”¨-supervisor-éƒ¨ç½²ï¼š" class="headerlink" title="1. ä½¿ç”¨ supervisor éƒ¨ç½²ï¼š"></a>1. ä½¿ç”¨ supervisor éƒ¨ç½²ï¼š</h4><pre class="line-numbers language-none"><code class="language-none"># å‡è®¾å…³é—­ä¸€ä¸ªç›‘å¬ç«¯å£ä¸º 3000 çš„æœåŠ¡kill -9 $(lsof -ti:3000)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ›å»º supervisor ç›¸å…³é…ç½®ä¿¡æ¯</p><p>vim /etc/supervisor/conf.d/alex-blog.conf</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¨‹åºåç§°ï¼Œstop start ç­‰ç®¡ç†æ—¶ä½¿ç”¨</span><span class="token punctuation">[</span>program:alex-blog<span class="token punctuation">]</span><span class="token comment"># è¿›å…¥è¯¥ç›®å½•è¿è¡Œå‘½ä»¤ï¼Œç¡®ä¿äº†å’Œé¡¹ç›®ç›¸å…³çš„ä¸€äº›é…ç½®æ–‡ä»¶å¯ä»¥å¾—åˆ°åŠ è½½ï¼Œæ¯”å¦‚ .env æ–‡ä»¶</span><span class="token assign-left variable">directory</span><span class="token operator">=</span>/data/www/blog<span class="token comment"># ä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼æ‰§è¡Œ alex-blog äºŒè¿›åˆ¶æ–‡ä»¶</span><span class="token assign-left variable">command</span><span class="token operator">=</span>/data/www/blog/alex-blog<span class="token comment"># é‡å¯æ—¶å‘é€çš„ä¿¡å·ï¼Œç¡®ä¿ç«¯å£æ­£å¸¸å…³é—­</span><span class="token assign-left variable">stopsignal</span><span class="token operator">=</span><span class="token environment constant">TERM</span><span class="token comment"># æ˜¯å¦è‡ªå¯åŠ¨</span><span class="token assign-left variable">autostart</span><span class="token operator">=</span>true<span class="token comment"># æ˜¯å¦è‡ªåŠ¨é‡å¯</span><span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true<span class="token comment"># æ‰§è¡Œç¨‹åºçš„ç”¨æˆ·</span><span class="token assign-left variable">user</span><span class="token operator">=</span>www-data<span class="token comment"># è¾“å‡ºæ—¥å¿—ä½ç½®</span><span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/data/log/supervisor/blog/stdout.log<span class="token comment"># é”™è¯¯è¾“å‡ºæ—¥å¿—</span><span class="token assign-left variable">stderr_logfile</span><span class="token operator">=</span>/data/log/supervisor/blog/stderr.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡è½½ Supervisor é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é‡è½½ supervisor é…ç½®æ–‡ä»¶</span>supervisorctl reload<span class="token comment"># æŸ¥çœ‹ç¨‹åºåç§°ä¸º alex-blog çš„ç¨‹åºçŠ¶æ€</span><span class="token comment"># å¦‚æœç›´æ¥æ‰§è¡Œ `supervisorctl status` å‘½ä»¤çš„è¯ï¼Œåˆ™æ˜¯æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡çš„çŠ¶æ€</span>supervisorctl status alex-blog<span class="token comment"># å…³é—­æ‰€æœ‰ä»»åŠ¡</span>supervisorctl <span class="token function">shutdown</span><span class="token comment"># å¯åŠ¨ä»»åŠ¡</span>supervisorctl start <span class="token operator">&lt;</span>ç¨‹åºå<span class="token operator">&gt;</span><span class="token comment"># å…³é—­ä»»åŠ¡</span>supervisorctl stop <span class="token operator">&lt;</span>ç¨‹åºå<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-ä½¿ç”¨-docker-éƒ¨ç½²ï¼š"><a href="#2-ä½¿ç”¨-docker-éƒ¨ç½²ï¼š" class="headerlink" title="2. ä½¿ç”¨ docker éƒ¨ç½²ï¼š"></a>2. ä½¿ç”¨ docker éƒ¨ç½²ï¼š</h4><h5 id="ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨-docker-ä¸­è¿è¡Œ"><a href="#ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨-docker-ä¸­è¿è¡Œ" class="headerlink" title="ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨ docker ä¸­è¿è¡Œ"></a>ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨ docker ä¸­è¿è¡Œ</h5><p>å…ˆè¦åœ¨å®¿ä¸»æœºä¸­é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿›è¡Œç¼–è¯‘</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># äº¤å‰ç¼–è¯‘ç”Ÿæˆ Linux å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶</span><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux go build <span class="token parameter variable">-a</span> <span class="token parameter variable">-installsuffix</span> cgo <span class="token parameter variable">-o</span> hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç¼–å†™ Dockerfile æ–‡ä»¶</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># åŸºç¡€é•œåƒ</span><span class="token instruction"><span class="token keyword">FROM</span> alpine:3.12</span><span class="token comment"># æˆ–è€…ä½¿ç”¨ Scratch é•œåƒ</span><span class="token comment"># FROM scratch</span><span class="token comment"># ç»´æŠ¤è€…</span><span class="token instruction"><span class="token keyword">MAINTAINER</span> alex</span><span class="token comment"># docker build æ—¶æ‰§è¡Œå‘½ä»¤</span><span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /go-project/demo <span class="token operator">\</span>&amp;&amp; ln -sf /dev/stdout /go-project/demo/storage/service.log</span><span class="token comment"># å·¥ä½œç›®å½•</span><span class="token instruction"><span class="token keyword">WORKDIR</span> /go-project/demo</span><span class="token comment"># æ‹·è´</span><span class="token instruction"><span class="token keyword">COPY</span> hello-world /go-project/demo/hello-world</span><span class="token comment"># æˆ–è€…ç›´æ¥å°†å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨ä¸­</span><span class="token comment"># COPY . /go-project/demo</span><span class="token comment"># è¿™é‡Œæš´éœ²ç«¯å£ä¸å¦éƒ½è¡Œ</span><span class="token comment"># EXPOSE 8501</span><span class="token comment"># docker run æ—¶æ‰§è¡Œçš„å‘½ä»¤</span><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">"./hello-world"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„å»ºé•œåƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> go-project:v1.0.0 <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿è¡Œå®¹å™¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®¿ä¸»æœºçš„ 9501 ç«¯å£æ˜ å°„åˆ°äº†å®¹å™¨çš„ 8501 ç«¯å£</span><span class="token comment"># -d ç”¨äºè¯¥ç¨‹åºåœ¨åå°è¿è¡Œ</span><span class="token comment"># -p ç”¨äºæ˜ å°„ç«¯å£</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">9501</span>:8501 go-project:v1.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="nginx-é…ç½®ä¿¡æ¯"><a href="#nginx-é…ç½®ä¿¡æ¯" class="headerlink" title="nginx é…ç½®ä¿¡æ¯"></a>nginx é…ç½®ä¿¡æ¯</h4><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> go-project</span> <span class="token punctuation">{</span>    <span class="token comment"># go-project HTTP Server çš„ IP åŠ ç«¯å£</span>    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:9501</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span> goblog.com</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">access_log</span>   /data/log/nginx/goblog/access.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span>    /data/log/nginx/goblog/error.log</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">location</span> /static/</span> <span class="token punctuation">{</span>      <span class="token directive"><span class="token keyword">alias</span> /www/wwwroot/gitlab/go-project/public/uploads/</span><span class="token punctuation">;</span> <span class="token comment">#é™æ€èµ„æºè·¯å¾„</span>    <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token comment"># å°†å®¢æˆ·ç«¯çš„ Host å’Œ IP ä¿¡æ¯ä¸€å¹¶è½¬å‘åˆ°å¯¹åº”èŠ‚ç‚¹</span>        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host             <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Real-IP        <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Forwarded-For  <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>                <span class="token comment"># è½¬å‘Cookieï¼Œè®¾ç½® SameSite</span>        <span class="token directive"><span class="token keyword">proxy_cookie_path</span> / <span class="token string">"/; secure; HttpOnly; SameSite=strict"</span></span><span class="token punctuation">;</span>                <span class="token comment"># æ‰§è¡Œä»£ç†è®¿é—®çœŸå®æœåŠ¡å™¨</span>        <span class="token directive"><span class="token keyword">proxy_pass</span>                 http://go-project</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨ Go é¡¹ç›®ä¸­å¯é çš„è·å–é¡¹ç›®æ ¹ç›®å½•</title>
      <link href="posts/7c9ed3a3.html"/>
      <url>posts/7c9ed3a3.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•åœ¨-Go-é¡¹ç›®ä¸­å¯é çš„è·å–é¡¹ç›®æ ¹ç›®å½•"><a href="#å¦‚ä½•åœ¨-Go-é¡¹ç›®ä¸­å¯é çš„è·å–é¡¹ç›®æ ¹ç›®å½•" class="headerlink" title="å¦‚ä½•åœ¨ Go é¡¹ç›®ä¸­å¯é çš„è·å–é¡¹ç›®æ ¹ç›®å½•"></a>å¦‚ä½•åœ¨ Go é¡¹ç›®ä¸­å¯é çš„è·å–é¡¹ç›®æ ¹ç›®å½•</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"os"</span><span class="token string">"path"</span><span class="token string">"path/filepath"</span><span class="token string">"runtime"</span><span class="token string">"strings"</span><span class="token punctuation">)</span><span class="token comment">// getRootPath è·å–é¡¹ç›®æ ¹ç›®å½•</span><span class="token keyword">func</span> <span class="token function">getRootPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span><span class="token comment">// ç¬¬ä¸€ç§æ–¹å¼ï¼šè·å–å½“å‰æ‰§è¡Œç¨‹åºæ‰€åœ¨çš„ç»å¯¹è·¯å¾„</span><span class="token comment">// è¿™ç§ä»…åœ¨ `go build` æ—¶ï¼Œæ‰å¯ä»¥è·å–æ­£ç¡®çš„è·¯å¾„</span><span class="token comment">// è·å–å½“å‰æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å…¨è·¯å¾„ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶æ–‡ä»¶å</span><span class="token comment">// eg: exePath = "/var/folders/hr/2rqppbcx4kv8_3qc_ky1qcy80000gn/T/go-build265586886/b001/exe/main"</span>exePath<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Executable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// eg: rootPathByExecutable = "/private/var/folders/hr/2rqppbcx4kv8_3qc_ky1qcy80000gn/T/go-build265586886/b001/exe"</span>rootPathByExecutable<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">EvalSymlinks</span><span class="token punctuation">(</span>filepath<span class="token punctuation">.</span><span class="token function">Dir</span><span class="token punctuation">(</span>exePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// ç¬¬äºŒç§æ–¹å¼ï¼šè·å–å½“å‰æ‰§è¡Œæ–‡ä»¶ç»å¯¹è·¯å¾„</span><span class="token comment">// è¿™ç§æ–¹å¼åœ¨ `go run` å’Œ `go build` æ—¶ï¼Œéƒ½å¯ä»¥è·å–åˆ°æ­£ç¡®çš„è·¯å¾„</span><span class="token comment">// ä½†æ˜¯äº¤å‰ç¼–è¯‘åï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯é”™è¯¯çš„ç»“æœ</span><span class="token keyword">var</span> rootPathByCaller <span class="token builtin">string</span><span class="token comment">// eg: filename = "/Users/pudongping/glory/codes/golang/gin-biz-web-api/main.go"</span><span class="token boolean">_</span><span class="token punctuation">,</span> filename<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// eg: rootPathByCaller = "/Users/pudongping/glory/codes/golang/gin-biz-web-api"</span><span class="token keyword">if</span> ok <span class="token punctuation">{</span>rootPathByCaller <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Dir</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å¯ä»¥é€šè¿‡ `echo $TMPDIR` æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸´æ—¶ç›®å½•</span><span class="token comment">// eg: tmpDir = "/private/var/folders/hr/2rqppbcx4kv8_3qc_ky1qcy80000gn/T"</span>tmpDir<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">EvalSymlinks</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">TempDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// å¯¹æ¯”é€šè¿‡ `os.Executable()` è·å–åˆ°çš„è·¯å¾„æ˜¯å¦ä¸ `TMPDIR` ç¯å¢ƒå˜é‡è®¾ç½®çš„è·¯å¾„ç›¸åŒ</span><span class="token comment">// ç›¸åŒï¼Œåˆ™è¯´æ˜æ˜¯é€šè¿‡ `go run` å‘½ä»¤å¯åŠ¨çš„</span><span class="token comment">// ä¸åŒï¼Œåˆ™æ˜¯é€šè¿‡ `go build` å‘½ä»¤å¯åŠ¨çš„</span><span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>rootPathByExecutable<span class="token punctuation">,</span> tmpDir<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> rootPathByCaller<span class="token punctuation">}</span><span class="token keyword">return</span> rootPathByExecutable<span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ–¹å¼ï¼Œæ¯”å¦‚å¯ä»¥è‡ªå·±å…ˆåœ¨ç³»ç»Ÿé‡Œè®¾ç½®è¯¸å¦‚ `PROJECT_ROOT_DIR` ä¹‹ç±»çš„ç¯å¢ƒå˜é‡ï¼Œå°†</span><span class="token comment">// æ ¹ç›®å½•æ”¾åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œç„¶åå†åœ¨ç¨‹åºä¸­é€šè¿‡ `os.Getenv("PROJECT_ROOT_DIR")` ä¹Ÿè¡Œ</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">getRootPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/pudongping/golang-tutorial/blob/main/project/get_root_path/main.go">ä»£ç åœ°å€</a></li><li><a href="https://mp.weixin.qq.com/s/ws0fcHi-DzCN5PrJNDNKog">ä¸‰ç§è·å–Goé¡¹ç›®æ ¹ç›®å½•çš„æ–¹å¼ï¼Œè®©ä½ åšæ¶æ„ï¼Œé€‰å“ªç§ï¼Ÿ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go Modules æ¨¡å¼</title>
      <link href="posts/2f3aad3a.html"/>
      <url>posts/2f3aad3a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Go-Modules-æ¨¡å¼"><a href="#Go-Modules-æ¨¡å¼" class="headerlink" title="Go Modules æ¨¡å¼"></a>Go Modules æ¨¡å¼</h1><h2 id="GOPATH-ç›®å½•"><a href="#GOPATH-ç›®å½•" class="headerlink" title="GOPATH ç›®å½•"></a>GOPATH ç›®å½•</h2><p>GOPATH ç›®å½•ä¸‹ä¸€å…±åŒ…å«ä¸‰ä¸ªå­ç›®å½•ï¼š</p><ul><li>binï¼šå­˜å‚¨æ‰€ç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li><li>pkgï¼šå­˜å‚¨é¢„ç¼–è¯‘çš„ç›®æ ‡æ–‡ä»¶ï¼Œä»¥åŠ å¿«ç¨‹åºçš„åç»­ç¼–è¯‘é€Ÿåº¦ã€‚</li><li>srcï¼šå­˜å‚¨æ‰€æœ‰ <code>.go</code> æ–‡ä»¶æˆ–æºä»£ç ã€‚åœ¨ç¼–å†™ Go åº”ç”¨ç¨‹åºï¼Œç¨‹åºåŒ…å’Œåº“æ—¶ï¼Œä¸€èˆ¬ä¼šä»¥ <code>$GOPATH/src/github.com/foo/bar</code> çš„è·¯å¾„è¿›è¡Œå­˜æ”¾ã€‚</li></ul><blockquote><p>ä½¿ç”¨ <code>go get</code> æ¥æ‹‰å–å¤–éƒ¨ä¾èµ–æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…åˆ° <code>$GOPATH</code> ç›®å½•ä¸‹ã€‚</p></blockquote><h2 id="go-mod-å‘½ä»¤"><a href="#go-mod-å‘½ä»¤" class="headerlink" title="go mod å‘½ä»¤"></a>go mod å‘½ä»¤</h2><p>æŸ¥çœ‹ go mod éƒ½æœ‰å“ªäº›å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Go çš„æ‰€æœ‰å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨ `go help` æ¥æŸ¥çœ‹ä½¿ç”¨æ–¹æ³•</span>go <span class="token builtin class-name">help</span> mod<span class="token comment"># æŸ¥çœ‹ go mod download æœ‰å“ªäº›å‚æ•°</span>go <span class="token builtin class-name">help</span> mod download<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">å‘½ä»¤</th><th align="center">ä½œç”¨</th></tr></thead><tbody><tr><td align="left">go mod help</td><td align="center">æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</td></tr><tr><td align="left">go mod init</td><td align="center">åˆå§‹åŒ–å½“å‰æ–‡ä»¶å¤¹ï¼Œç”Ÿæˆ go.mod æ–‡ä»¶</td></tr><tr><td align="left">go mod download</td><td align="center">ä¸‹è½½ go.mod æ–‡ä»¶ä¸­æŒ‡æ˜çš„æ‰€æœ‰ä¾èµ–åˆ°æœ¬åœ°ï¼ˆé»˜è®¤ä¸º <code>$GOPATH/pkg/mod</code> ç›®å½•ï¼‰å¢åŠ  <code>-x</code> å‚æ•° <code>go mod download -x</code> ä¼šæ‰“å°ä¸‹è½½ä¿¡æ¯ï¼›<code>go mod download -json</code> ç”¨æ¥æŸ¥çœ‹æ¨¡å—ä¸‹è½½çš„ zip å­˜æ”¾ä½ç½®ï¼Œä»¥åŠè§£å‹åçš„ä½ç½®ï¼›</td></tr><tr><td align="left">go mod tidy</td><td align="center">æ•´ç†ç°æœ‰çš„ä¾èµ–ï¼Œæ‰§è¡Œæ—¶ä¼šæŠŠæœªä½¿ç”¨çš„ module ç§»é™¤æ‰ï¼ŒåŒæ—¶ä¹Ÿä¼šå¢åŠ ç¼ºå°‘çš„åŒ…</td></tr><tr><td align="left">go mod graph</td><td align="center">æŸ¥çœ‹ç°æœ‰çš„ä¾èµ–ç»“æ„å›¾</td></tr><tr><td align="left">go mod edit</td><td align="center">ç¼–è¾‘ go.mod æ–‡ä»¶ï¼Œæ¯”å¦‚ä¿®æ”¹é¡¹ç›®ä¸­ä½¿ç”¨çš„ go ç‰ˆæœ¬ <code>go mod edit -go=1.17</code></td></tr><tr><td align="left">go mod vendor</td><td align="center">å¯¼å‡ºé¡¹ç›®æ‰€æœ‰çš„ä¾èµ–åˆ° vendor ç›®å½•ï¼ˆéœ€è¦æ‰§è¡Œ go build -mod=vendor æ‰å¯ä»¥ä½¿ç”¨ vendor ä½œä¸ºä¾èµ–æ¥ç¼–è¯‘ï¼Œä½†æ˜¯åœ¨ v1.14 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœ golang é¡¹ç›®æ ¹ç›®å½•ä¸‹å­˜åœ¨ vendor ç›®å½•ï¼Œgo build å‘½ä»¤ä¼šé»˜è®¤ä¼˜å…ˆåŸºäº vendor ç›®å½•ç¼“å­˜çš„ä¸‰æ–¹ä¾èµ–åŒ…æ„å»º golang ç¨‹åºï¼Œé™¤éæˆ‘ä»¬åœ¨ go build å‘½ä»¤åé¢åŠ ä¸Š -mod=mod å‚æ•°ï¼‰</td></tr><tr><td align="left">go mod verify</td><td align="center">æ ¡éªŒä¸€ä¸ªæ¨¡å—æ˜¯å¦è¢«ç¯¡æ”¹è¿‡ï¼Œæ ¡éªŒä» GOPROXY æœåŠ¡å™¨ä¸Šä¸‹è½½çš„ zip æ–‡ä»¶ä¸ GOSUMDB æœåŠ¡å™¨ä¸‹è½½ä¸‹æ¥çš„å“ˆå¸Œå€¼ï¼Œæ˜¯å¦åŒ¹é…ã€‚</td></tr><tr><td align="left">go mod why</td><td align="center">æŸ¥çœ‹ä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–æŸæ¨¡å—ï¼Œæ¯”å¦‚ <code>go mod why gopkg.in/yaml.v2 gopkg.in/yaml.v3</code></td></tr><tr><td align="left">go clean -modcache</td><td align="center">å¯ä»¥æ¸…ç©ºæœ¬åœ°ä¸‹è½½çš„ Go Modules ç¼“å­˜ ï¼ˆä¼šæ¸…ç©º <code>$GOPATH/pkg/mod</code> ç›®å½•ï¼‰</td></tr></tbody></table><h2 id="go-mod-ç¯å¢ƒå˜é‡"><a href="#go-mod-ç¯å¢ƒå˜é‡" class="headerlink" title="go mod ç¯å¢ƒå˜é‡"></a>go mod ç¯å¢ƒå˜é‡</h2><p>å’Œ <code>go mod</code> æ¯”è¾ƒå…³è”çš„å‡ ä¸ªç¯å¢ƒå˜é‡</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">go</span> envGO111MODULE<span class="token operator">=</span><span class="token string">"auto"</span>GOPROXY<span class="token operator">=</span><span class="token string">"https://goproxy.cn,direct"</span>GOSUMDB<span class="token operator">=</span><span class="token string">"sum.golang.org"</span>GONOPROXY<span class="token operator">=</span><span class="token string">""</span>GONOSUMDB<span class="token operator">=</span><span class="token string">""</span>GOPRIVATE<span class="token operator">=</span><span class="token string">""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a>GO111MODULE</h3><p>Go è¯­è¨€æä¾›äº† GO111MODULE è¿™ä¸ªç¯å¢ƒå˜é‡æ¥ä½œä¸º Go modules çš„å¼€å…³ï¼Œå…¶å…è®¸è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li>autoï¼šåªè¦é¡¹ç›®åŒ…å«äº† go.mod æ–‡ä»¶çš„è¯å¯ç”¨ Go modulesï¼Œç›®å‰åœ¨ Go1.11 è‡³ Go 1.14 ä¸­ä»ç„¶æ˜¯é»˜è®¤å€¼</li><li>onï¼šå¯ç”¨ Go modulesï¼Œæ¨èè®¾ç½®ï¼Œå°†ä¼šæ˜¯æœªæ¥ç‰ˆæœ¬ä¸­çš„é»˜è®¤å€¼</li><li>offï¼šç¦ç”¨ Go modulesï¼Œä¸æ¨èè®¾ç½®</li></ul><h4 id="è®¾ç½®æ–¹å¼"><a href="#è®¾ç½®æ–¹å¼" class="headerlink" title="è®¾ç½®æ–¹å¼"></a>è®¾ç½®æ–¹å¼</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ shell ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ Macï¼Œä¸”ä½¿ç”¨çš„ zshï¼Œåˆ™åœ¨ <code>vim ~/.zshrc</code> ç„¶åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå¦‚æœæ˜¯å…¶å®ƒ Linux ç³»åˆ—ç³»ç»Ÿï¼Œåˆ™éœ€è¦åœ¨ <code>~/.bash_profile</code> æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åè¦è®°å¾— <code>source ~/.zshrc</code></p><h3 id="GOPROXY"><a href="#GOPROXY" class="headerlink" title="GOPROXY"></a>GOPROXY</h3><p>è¿™ä¸ªç¯å¢ƒå˜é‡ä¸»è¦æ˜¯ç”¨äºè®¾ç½® Go æ¨¡å—ä»£ç†ï¼ˆGo module proxyï¼‰ï¼Œå…¶ä½œç”¨æ˜¯ç”¨äºä½¿ Go åœ¨åç»­æ‹‰å–æ¨¡å—ç‰ˆæœ¬æ—¶ç›´æ¥é€šè¿‡é•œåƒç«™ç‚¹æ¥å¿«é€Ÿæ‹‰å–</p><p>GOPROXY çš„é»˜è®¤å€¼æ˜¯ï¼š<code>https://proxy.golang.org,direct</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. ä¸ƒç‰› CDN</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span>  <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct<span class="token comment"># 2. é˜¿é‡Œäº‘</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://mirrors.aliyun.com/goproxy/,direct<span class="token comment"># 3. å®˜æ–¹</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span>  <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.io,direct<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>direct</code> æ˜¯ä¸€ä¸ªç‰¹æ®ŠæŒ‡ç¤ºç¬¦ï¼Œç”¨äºæŒ‡ç¤º Go åœ¨è·å–æºç åŒ…æ—¶ï¼Œå…ˆå°è¯•åœ¨è®¾ç½® GOPROXY çš„åœ°å€ä¸‹æŠ“å–ï¼Œå¦‚æœé‡åˆ° 404 æˆ– 410 ç­‰é”™è¯¯æ—¶ï¼Œå†å›æº¯åˆ°æ¨¡å—ç‰ˆæœ¬çš„æºåœ°å€å»æŠ“å– ï¼ˆæ¯”å¦‚ GitHub ç­‰ï¼‰ã€‚</p><h3 id="GOSUMDB"><a href="#GOSUMDB" class="headerlink" title="GOSUMDB"></a>GOSUMDB</h3><p>å®ƒçš„å€¼æ˜¯ä¸€ä¸ª Go checksum databaseï¼Œç”¨äºåœ¨æ‹‰å–æ¨¡å—ç‰ˆæœ¬æ—¶ï¼ˆæ— è®ºæ˜¯ä»æºç«™æ‹‰å–è¿˜æ˜¯é€šè¿‡ Go module proxy æ‹‰å–ï¼‰ä¿è¯æ‹‰å–åˆ°çš„æ¨¡å—ç‰ˆæœ¬æ•°æ®æœªç»è¿‡ç¯¡æ”¹ï¼Œè‹¥å‘ç°ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½å­˜åœ¨ç¯¡æ”¹ï¼Œå°†ä¼šç«‹å³ç»ˆæ­¢ã€‚</p><p>GOSUMDB çš„é»˜è®¤å€¼ä¸ºï¼š<code>sum.golang.org</code>ï¼Œåœ¨å›½å†…ä¹Ÿæ˜¯æ— æ³•è®¿é—®çš„ï¼Œä½†æ˜¯ GOSUMDB å¯ä»¥è¢« Go æ¨¡å—ä»£ç†æ‰€ä»£ç†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® <code>GOPROXY</code> æ¥è§£å†³ï¼Œè€Œå…ˆå‰æˆ‘ä»¬æ‰€è®¾ç½®çš„æ¨¡å—ä»£ç† <code>goproxy.cn</code> ï¼ˆä¸ƒç‰›äº‘çš„ CDNï¼‰å°±èƒ½æ”¯æŒä»£ç† <code>sum.golang.org</code>ï¼Œæ‰€ä»¥è¿™ä¸€ä¸ªé—®é¢˜åœ¨è®¾ç½® GOPROXY åï¼Œå¯ä»¥ä¸éœ€è¦è¿‡åº¦å…³å¿ƒã€‚</p><p>ä¹Ÿå¯ä»¥å°†å…¶è®¾ç½®ä¸º <code>off</code> ï¼Œä¹Ÿå°±æ˜¯ç¦æ­¢ Go åœ¨åç»­æ“ä½œä¸­æ ¡éªŒæ¨¡å—ç‰ˆæœ¬ã€‚ä½†æ˜¯ä¸å»ºè®®å…³é—­æ ¡éªŒã€‚</p><h3 id="GONOPROXY-GONOSUMDB-GOPRIVATE"><a href="#GONOPROXY-GONOSUMDB-GOPRIVATE" class="headerlink" title="GONOPROXY/GONOSUMDB/GOPRIVATE"></a>GONOPROXY/GONOSUMDB/GOPRIVATE</h3><ul><li>GONOPROXY â€”â€” è®¾ç½®ä¸èµ° Go Proxy çš„ URL è§„åˆ™ï¼›</li><li>GONOSUMDB â€”â€” è®¾ç½®ä¸æ£€æŸ¥å“ˆå¸Œçš„ URL è§„åˆ™ï¼›</li><li>GOPRIVATE â€”â€” è®¾ç½®ç§æœ‰æ¨¡å—çš„ URL è§„åˆ™ï¼Œä¼šåŒæ—¶è®¾ç½®ä»¥ä¸Šä¸¤ä¸ªå˜é‡ã€‚</li></ul><p>è¿™ä¸‰ä¸ªç¯å¢ƒå˜é‡éƒ½æ˜¯ç”¨åœ¨å½“å‰é¡¹ç›®ä¾èµ–äº†ç§æœ‰æ¨¡å—ï¼Œä¾‹å¦‚è‡ªå·±å…¬å¸éƒ¨ç½²çš„ç§æœ‰ git ä»“åº“æˆ–è€…æ˜¯ GitHub ä¸­çš„ç§æœ‰ä»“åº“ï¼Œéƒ½æ˜¯éœ€è¦è¿›è¡Œè®¾ç½®çš„ï¼Œå¦åˆ™ä¼šæ‹‰å–å¤±è´¥ã€‚</p><p>è®¾ç½® GOPRIVATE ä¹‹åï¼Œè¡¨ç¤ºè¯¥åœ°å€ä¸ºç§æœ‰ä»“åº“ï¼Œä¸ä¼šä» GOPROXY æ‰€å¯¹åº”çš„åœ°å€ä¸Šå»ä¸‹è½½ã€‚</p><p><strong>è€Œä¸€èˆ¬å»ºè®®ç›´æ¥è®¾ç½® GOPRIVATEï¼Œå®ƒçš„å€¼å°†ä½œä¸º GONOPROXY å’Œ GONOSUMDB çš„é»˜è®¤å€¼ï¼Œæ‰€ä»¥å»ºè®®ç›´æ¥è®¾ç½® GOPRIVATE å³å¯ã€‚</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»¥ä¸‹è¡¨ç¤º git.example.com å’Œ github.com/username/package éƒ½æ˜¯ç§æœ‰ä»“åº“ï¼Œä¸ä¼šè¿›è¡Œ GOPROXY ä¸‹è½½å’Œæ ¡éªŒ</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span><span class="token string">"git.example.com,github.com/username/package"</span><span class="token comment"># è®¾ç½®åï¼Œå‰ç¼€ä¸º `git.example.com` å’Œ `github.com/username/package` çš„æ¨¡å—éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯ç§æœ‰æ¨¡å—</span><span class="token comment"># è¡¨ç¤ºæ‰€æœ‰æ¨¡å—è·¯å¾„ä¸º example.com çš„å­åŸŸåéƒ½ä¸è¿›è¡Œ GOPROXY ä¸‹è½½å’Œæ ¡éªŒ</span><span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒ…æ‹¬ example.com æœ¬èº«</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span><span class="token string">"*.example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨-Go-Modules-åˆå§‹åŒ–é¡¹ç›®"><a href="#ä½¿ç”¨-Go-Modules-åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="ä½¿ç”¨ Go Modules åˆå§‹åŒ–é¡¹ç›®"></a>ä½¿ç”¨ Go Modules åˆå§‹åŒ–é¡¹ç›®</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¼€å¯ Go Modules æ¨¡å—ï¼Œä¿è¯ GO111MODULE=on</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on<span class="token comment"># åœ¨ä»»æ„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼ˆä¸è¦æ±‚åœ¨ $GOPATH/src ç›®å½•ä¸‹åˆ›å»ºï¼‰</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/modules_test<span class="token builtin class-name">cd</span> <span class="token environment constant">$HOME</span>/modules_test<span class="token comment"># åˆ›å»º go.mod æ–‡ä»¶ï¼ŒåŒæ—¶èµ·å½“å‰é¡¹ç›®çš„æ¨¡å—åç§°</span><span class="token comment"># å¦‚æœä½ æ˜¯åœ¨ `$GOPATH/src` ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶å¤¹å¯ä»¥ç›´æ¥æ‰§è¡Œ `go mod init` å‘½ä»¤åˆå§‹åŒ–ï¼Œä¸éœ€è¦åŠ æ¨¡å—åç§°</span>go mod init github.com/pudongping/moudles_test<span class="token comment"># åœ¨è¯¥é¡¹ç›®ä¸‹ç¼–å†™æºä»£ç ï¼Œå¹¶ä¸‹è½½ä¾èµ–åº“</span><span class="token comment"># ä¹Ÿå¯ä»¥ä¸åŠ  `-v` å‚æ•°</span>go get <span class="token parameter variable">-v</span> XXXXXXXXeg: go get <span class="token parameter variable">-v</span> github.com/pudongping/moudles_test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¸‹è½½çš„åŒ…å…¶å®è¢«ç¼“å­˜åœ¨ <code>$GOPATH/pkg/mod</code> ç›®å½•å’Œ <code>$GOPATH/pkg/sumdb</code> ç›®å½•ä¸‹</p></blockquote><ul><li><strong><code>go.mod</code> æ–‡ä»¶ä¸­ï¼š</strong></li></ul><ol><li>moduleï¼šç”¨äºå®šä¹‰å½“å‰é¡¹ç›®çš„æ¨¡å—è·¯å¾„ã€‚</li><li>goï¼šç”¨äºæ ‡è¯†å½“å‰æ¨¡å—çš„ Go è¯­è¨€ç‰ˆæœ¬ï¼Œå€¼ä¸ºåˆå§‹åŒ–æ¨¡å—æ—¶çš„ç‰ˆæœ¬ã€‚</li><li>requireï¼šç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—ç‰ˆæœ¬ã€‚</li><li>excludeï¼šç”¨äºä»ä½¿ç”¨ä¸­æ’é™¤ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—ç‰ˆæœ¬ã€‚</li><li>replaceï¼šç”¨äºå°†ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬æ›¿æ¢ä¸ºå¦å¤–ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬ã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none"># v0.0.0 è¡¨ç¤ºç‰ˆæœ¬ä¿¡æ¯# 20190718012654 è¡¨ç¤ºæ‰€æ‹‰å–ç‰ˆæœ¬çš„ commit æ—¶é—´# fb15b899a751 è¡¨ç¤ºæ‰€æ‹‰å–ç‰ˆæœ¬çš„ commit å“ˆå¸Œå€¼github.com/alecthomas/template v0.0.0-20190718012654-fb15b899a751<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong><code>go.sum</code> æ–‡ä»¶ä¸­ï¼š</strong></li></ul><p>go.sum æ–‡ä»¶çš„ä½œç”¨æ˜¯ï¼šç½—åˆ—å½“å‰é¡¹ç›®ç›´æ¥æˆ–é—´æ¥ä¾èµ–çš„æ‰€æœ‰æ¨¡å—ç‰ˆæœ¬ï¼Œä¿è¯ä»Šåé¡¹ç›®ä¾èµ–çš„ç‰ˆæœ¬ä¸ä¼šè¢«ç¯¡æ”¹ã€‚é—´æ¥ä¾èµ–çš„åŒ…çš„å“ˆå¸Œå€¼ä¹Ÿä¼šè¢«ä¿å­˜ã€‚</p><p>go.sum æ–‡ä»¶ä¸­æœ‰ä¸¤ç§ hash çš„å½¢å¼ï¼š</p><ol><li><code>h1:&lt;hash&gt;</code> å°†ç›®æ ‡æ¨¡å—ç‰ˆæœ¬çš„ zip æ–‡ä»¶å¼€åŒ…åï¼Œé’ˆå¯¹æ‰€æœ‰åŒ…å†…æ–‡ä»¶ä¾æ¬¡è¿›è¡Œ hashï¼Œç„¶åå†æŠŠå®ƒä»¬çš„ hash ç»“æœæŒ‰ç…§å›ºå®šæ ¼å¼å’Œç®—æ³•ç»„æˆæ€»çš„ hash å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¡¨ç¤ºå¯èƒ½ä¾èµ–çš„åº“ç”¨ä¸ä¸Š</li><li><code>xxx/go.mod h1.&lt;hash&gt;</code> è¡¨ç¤º go.mod æ–‡ä»¶åšçš„ hash</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†ç›®æ ‡æ¨¡å—ç‰ˆæœ¬çš„ zip æ–‡ä»¶å¼€åŒ…åï¼Œé’ˆå¯¹åŒ…å†…æ‰€æœ‰æ–‡ä»¶ä¾æ¬¡è¿›è¡Œ hashï¼Œç„¶åå†å°† å®ƒä»¬çš„ hash ç»“æœæ±‡æ€»ç»„æˆ hash</span>github.com/gorilla/mux v1.7.4 h1:VuZ8uybHlWmqV03+zRzdwKL4tUnIp1MAQtp1mIFE1bc<span class="token operator">=</span><span class="token comment"># é’ˆå¯¹ go.mod æ–‡ä»¶çš„ hash å€¼</span>github.com/gorilla/mux v1.7.4/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71So<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="go-get-æ‹‰å–å‘½ä»¤"><a href="#go-get-æ‹‰å–å‘½ä»¤" class="headerlink" title="go get æ‹‰å–å‘½ä»¤"></a>go get æ‹‰å–å‘½ä»¤</h2><blockquote><p>ä¸‹è½½çš„æ¨¡å—ä¼šè¢«æ”¾ç½®äº <code>$GOPATH/pkg/mod</code> ç›®å½•ä¸­</p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>go get</td><td>æ‹‰å–ä¾èµ–ï¼Œä¼šè¿›è¡ŒæŒ‡å®šæ€§æ‹‰å–ï¼ˆæ›´æ–°ï¼‰ï¼Œå¹¶ä¸ä¼šæ›´æ–°æ‰€ä¾èµ–çš„å…¶å®ƒæ¨¡å—ã€‚ï¼ˆå¦‚æœæœ¬åœ°å·²å­˜åœ¨è¦ä¸‹è½½çš„åŒ…ï¼Œå°†ä¼šç›´æ¥ä½¿ç”¨æœ¬åœ°å·²å­˜åœ¨çš„åŒ…ï¼‰</td></tr><tr><td>go get -u</td><td>æ›´æ–°ç°æœ‰çš„ä¾èµ–ï¼Œä¼šå¼ºåˆ¶æ›´æ–°å®ƒæ‰€ä¾èµ–çš„å…¶å®ƒå…¨éƒ¨æ¨¡å—ï¼Œä¸åŒ…æ‹¬è‡ªèº«ã€‚</td></tr><tr><td>go get -u -t ./â€¦</td><td>æ›´æ–°æ‰€æœ‰ç›´æ¥ä¾èµ–å’Œé—´æ¥ä¾èµ–çš„æ¨¡å—ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ä¸­ç”¨åˆ°çš„ã€‚</td></tr><tr><td>go get golang.org/x/text@latest</td><td>æ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè‹¥å­˜åœ¨ tagï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ã€‚</td></tr><tr><td>go get golang.org/x/text@master</td><td>æ‹‰å– master åˆ†æ”¯çš„æœ€æ–° commitã€‚</td></tr><tr><td>go get golang.org/x/<a href="mailto:text@v0.3.2">text@v0.3.2</a></td><td>æ‹‰å– tag ä¸º v0.3.2 çš„ commitã€‚</td></tr><tr><td>go get golang.org/x/text@342b2e</td><td>æ‹‰å– hash ä¸º 342b231 çš„ commitï¼Œæœ€ç»ˆä¼šè¢«è½¬æ¢ä¸º v0.3.2ã€‚</td></tr></tbody></table><h3 id="go-get-å­å‚æ•°è¯´æ˜"><a href="#go-get-å­å‚æ•°è¯´æ˜" class="headerlink" title="go get å­å‚æ•°è¯´æ˜"></a>go get å­å‚æ•°è¯´æ˜</h3><table><thead><tr><th>å­å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>-d</td><td>ä»…ä¸‹è½½ï¼Œä¸å®‰è£…</td></tr><tr><td>-f</td><td>å’Œ -u é…åˆï¼Œå¼ºåˆ¶æ›´æ–°ï¼Œä¸æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</td></tr><tr><td>-t</td><td>ä¸‹è½½æµ‹è¯•ä»£ç æ‰€éœ€çš„ä¾èµ–åŒ…</td></tr><tr><td>-u</td><td>æ›´æ–°åŒ…ï¼ŒåŒ…æ‹¬ä»–ä»¬çš„ä¾èµ–é¡¹</td></tr><tr><td>-v</td><td>è¾“å‡ºè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>insecure</td><td>ä½¿ç”¨ http ç­‰éå®‰å…¨åè®®</td></tr></tbody></table><h2 id="ä¿®æ”¹é¡¹ç›®æ¨¡å—çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»"><a href="#ä¿®æ”¹é¡¹ç›®æ¨¡å—çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»" class="headerlink" title="ä¿®æ”¹é¡¹ç›®æ¨¡å—çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»"></a>ä¿®æ”¹é¡¹ç›®æ¨¡å—çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go mod edit <span class="token parameter variable">-replace</span><span class="token operator">=</span><span class="token operator">&lt;</span>è€ç‰ˆæœ¬<span class="token operator">&gt;=</span><span class="token operator">&lt;</span>éœ€è¦æ›¿æ¢çš„ç‰ˆæœ¬<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚</span>go mod edit <span class="token parameter variable">-replace</span><span class="token operator">=</span>demo-package@v1.0.0<span class="token operator">=</span>demo-package@v2.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="go-list-å‘½ä»¤ä»¥åŠå‚æ•°"><a href="#go-list-å‘½ä»¤ä»¥åŠå‚æ•°" class="headerlink" title="go list å‘½ä»¤ä»¥åŠå‚æ•°"></a>go list å‘½ä»¤ä»¥åŠå‚æ•°</h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-f</td><td>ç”¨äºæŸ¥çœ‹å¯¹åº”ä¾èµ–ç»“æ„ä½“ä¸­çš„æŒ‡å®šçš„å­—æ®µï¼Œå…¶é»˜è®¤å€¼å°±æ˜¯ <code>{{.ImportPath}}</code>ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥è·¯å¾„ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬ä¸éœ€è¦è¿›è¡Œè°ƒæ•´</td></tr><tr><td>-json</td><td>æ˜¾ç¤ºçš„æ ¼å¼ï¼Œè‹¥ä¸æŒ‡å®šè¯¥é€‰é¡¹ï¼Œåˆ™ä¼šä¸€è¡Œè¡Œè¾“å‡ºã€‚</td></tr><tr><td>-u</td><td>æ˜¾ç¤ºèƒ½å¤Ÿå‡çº§çš„æ¨¡å—ä¿¡æ¯</td></tr><tr><td>-m</td><td>æ˜¾ç¤ºå½“å‰é¡¹ç›®æ‰€ä¾èµ–çš„å…¨éƒ¨æ¨¡å—</td></tr></tbody></table><p>æ¯”å¦‚æŸ¥çœ‹ <code>gin</code> æ¡†æ¶çš„ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go list <span class="token parameter variable">-m</span> <span class="token parameter variable">-versions</span> <span class="token parameter variable">-json</span> github.com/gin-gonic/gin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">{</span><span class="token string">"Path"</span><span class="token builtin class-name">:</span> <span class="token string">"github.com/gin-gonic/gin"</span>,<span class="token string">"Version"</span><span class="token builtin class-name">:</span> <span class="token string">"v1.7.7"</span>,<span class="token string">"Versions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"v1.1.1"</span>,<span class="token string">"v1.1.2"</span>,<span class="token string">"v1.1.3"</span>,<span class="token string">"v1.1.4"</span>,<span class="token string">"v1.3.0"</span>,<span class="token string">"v1.4.0"</span>,<span class="token string">"v1.5.0"</span>,<span class="token string">"v1.6.0"</span>,<span class="token string">"v1.6.1"</span>,<span class="token string">"v1.6.2"</span>,<span class="token string">"v1.6.3"</span>,<span class="token string">"v1.7.0"</span>,<span class="token string">"v1.7.1"</span>,<span class="token string">"v1.7.2"</span>,<span class="token string">"v1.7.3"</span>,<span class="token string">"v1.7.4"</span>,<span class="token string">"v1.7.6"</span>,<span class="token string">"v1.7.7"</span><span class="token punctuation">]</span>,<span class="token string">"Time"</span><span class="token builtin class-name">:</span> <span class="token string">"2021-11-24T13:54:13Z"</span>,<span class="token string">"Dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/Users/pudongping/go/pkg/mod/github.com/gin-gonic/gin@v1.7.7"</span>,<span class="token string">"GoMod"</span><span class="token builtin class-name">:</span> <span class="token string">"/Users/pudongping/go/pkg/mod/cache/download/github.com/gin-gonic/gin/@v/v1.7.7.mod"</span>,<span class="token string">"GoVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"1.13"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç§æœ‰åº“ä½¿ç”¨-Go-Modules-æ—¶"><a href="#ç§æœ‰åº“ä½¿ç”¨-Go-Modules-æ—¶" class="headerlink" title="ç§æœ‰åº“ä½¿ç”¨ Go Modules æ—¶"></a>ç§æœ‰åº“ä½¿ç”¨ Go Modules æ—¶</h2><ul><li>éœ€è¦å°† <code>GOPRIVATE</code> ç¯å¢ƒå˜é‡è®¾ç½®æˆä½ ç§æœ‰åº“çš„åŸŸå</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># GO111MODULE è®¾ç½®æˆ on æˆ–è€… auto éƒ½è¡Œ</span><span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span><span class="token string">"auto"</span><span class="token comment"># GOPROXY æœ€å¥½è®¾ç½®æˆå›½å†…é•œåƒåœ°å€</span><span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span><span class="token string">"https://goproxy.cn,direct"</span><span class="token comment"># GOPRIVATE ä¸€å®šè¦è®¾ç½®æˆä½ çš„ç§æœ‰åº“åŸŸåï¼Œæ¯”å¦‚</span><span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span><span class="token string">"gitlab.xxx.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚<strong>æ³¨æ„ï¼šå‰ææ˜¯ä½ èƒ½å¤Ÿé€šè¿‡ ssh å…¬é’¥æ‹‰å–ä»£ç </strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»¥ä¸‹å‡è®¾æˆ‘ç§æœ‰ git ä»“åº“åœ°å€ä¸º gitlab.xxx.com:2222</span><span class="token comment"># é‚£ä¹ˆåˆ™éœ€è¦è°ƒæ•´ä¸º</span><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> ~/.gitconfig</span>[url "ssh://git@gitlab.xxx.com:2222"]        insteadOf = https://gitlab.xxx.comEOF</span><span class="token comment"># æˆ–è€…æ‰§è¡Œï¼ˆæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼‰</span><span class="token function">git</span> config <span class="token parameter variable">--global</span> url.<span class="token string">"ssh://git@gitlab.xxx.com:2222"</span>.insteadof <span class="token string">"https://gitlab.xxx.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•ä¸€ä¸‹ä¸‹è½½ä¸€ä¸ªåŒ…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»…ä»…ä½œä¸ºç¤ºèŒƒï¼Œæ­¤åœ°å€æ ¹æœ¬å°±ä¸å­˜åœ¨</span>go get <span class="token parameter variable">-v</span> gitlab.xxx.com/utils/arrayx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://segmentfault.com/a/1190000021854441">Go Modules ç»ˆæå…¥é—¨</a></li><li><a href="https://mp.weixin.qq.com/s/sWlTylbW2f1llbz232P2Fw">Go Modules ç§æœ‰ä¸åˆè§„åº“æ€ä¹ˆè§£å†³å¼•ç”¨é—®é¢˜</a></li><li><a href="https://studygolang.com/articles/35234">go modules ä½¿ç”¨æœ¬åœ°åº“ã€åˆè§„åº“ã€ç§æœ‰åº“</a></li><li><a href="https://studygolang.com/articles/35235">ç§æœ‰åŒ–ä»“åº“çš„ GO æ¨¡å—ä½¿ç”¨å®è·µ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperf æ¡†æ¶ä¸­å°†æ•°æ®å¯¼å‡ºåˆ° csv æ–‡ä»¶ä¸­</title>
      <link href="posts/d0c857b0.html"/>
      <url>posts/d0c857b0.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hyperf-æ¡†æ¶ä¸­å°†æ•°æ®å¯¼å‡ºåˆ°-csv-æ–‡ä»¶ä¸­"><a href="#Hyperf-æ¡†æ¶ä¸­å°†æ•°æ®å¯¼å‡ºåˆ°-csv-æ–‡ä»¶ä¸­" class="headerlink" title="Hyperf æ¡†æ¶ä¸­å°†æ•°æ®å¯¼å‡ºåˆ° csv æ–‡ä»¶ä¸­"></a>Hyperf æ¡†æ¶ä¸­å°†æ•°æ®å¯¼å‡ºåˆ° csv æ–‡ä»¶ä¸­</h1><p>ç›´æ¥çœ‹ä»£ç å§â€¦â€¦</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>AutoController</span><span class="token punctuation">;</span><span class="token comment">/** * @AutoController * Class TestController * @package App\Controller */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">TestController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span><span class="token punctuation">{</span>    <span class="token comment">/**     * è¯·æ±‚æµ‹è¯•ï¼š     * curl 'http://127.0.0.1:9511/test/csvExport' &gt;&gt; test.csv     *     * @return \Psr\Http\Message\ResponseInterface     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">csvExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'test.csv'</span><span class="token punctuation">;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token string single-quoted-string">'é˜¿çŒ«'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'11'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token string single-quoted-string">'é˜¿ç‹—'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'22'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token string single-quoted-string">'é˜¿çŒª'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'33'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$str</span> <span class="token operator">.=</span> <span class="token function">mb_convert_encoding</span><span class="token punctuation">(</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'GBK'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token operator">-&gt;</span><span class="token function">withHeader</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'text/csv'</span><span class="token punctuation">)</span>            <span class="token operator">-&gt;</span><span class="token function">withHeader</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-disposition'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"attachment; filename=<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$fileName</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>            <span class="token operator">-&gt;</span><span class="token function">withHeader</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-transfer-encoding'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'binary'</span><span class="token punctuation">)</span>            <span class="token operator">-&gt;</span><span class="token function">withBody</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Hyperf<span class="token punctuation">\</span>HttpMessage<span class="token punctuation">\</span>Stream<span class="token punctuation">\</span>SwooleStream</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç¬¬ä¸€ç§ï¼š<br>ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—® <code>http://127.0.0.1:9511/test/csvExport</code></p><p>ç¬¬äºŒç§ï¼š<br>ç›´æ¥é€šè¿‡ <code>curl</code> å‘½ä»¤è¡Œè®¿é—® <code>curl 'http://127.0.0.1:9511/test/csvExport' &gt;&gt; test.csv</code></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperf </tag>
            
            <tag> Swoole </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang å¼€å‘ç¯å¢ƒæ­å»º</title>
      <link href="posts/2417f014.html"/>
      <url>posts/2417f014.html</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-å¼€å‘ç¯å¢ƒæ­å»º"><a href="#Golang-å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="Golang å¼€å‘ç¯å¢ƒæ­å»º"></a>Golang å¼€å‘ç¯å¢ƒæ­å»º</h1><h2 id="ç¬¬ä¸€ç§æ–¹å¼ï¼šå®‰è£…åŒ…å®‰è£…"><a href="#ç¬¬ä¸€ç§æ–¹å¼ï¼šå®‰è£…åŒ…å®‰è£…" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼ï¼šå®‰è£…åŒ…å®‰è£…"></a>ç¬¬ä¸€ç§æ–¹å¼ï¼šå®‰è£…åŒ…å®‰è£…</h2><p>æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿå®‰è£…å¯¹åº”çš„å®‰è£…åŒ…ï¼š<a href="https://golang.google.cn/doc/install">https://golang.google.cn/doc/install</a>ï¼Œå¦‚æœæ˜¯ mac ç³»ç»Ÿï¼Œè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ Homebrew å®‰è£…</p><blockquote><p>ç›´æ¥é€šè¿‡ pkg åŒ…å®‰è£…çš„ go å¸è½½æ–¹å¼ä¸ºï¼š <code>sudo rm -rf /usr/local/go</code> ç„¶å  <code>sudo rm -rf /etc/paths.d/go</code> å³å¯ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> go<span class="token comment"># æŸ¥çœ‹ go ç‰ˆæœ¬å·ï¼Œä»¥ç¡®å®šæ˜¯å¦å®‰è£…æˆåŠŸ</span>go version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹ç¯å¢ƒå˜é‡</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go <span class="token function">env</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>é…ç½® go path</li></ul><p>éœ€è¦ä¸º Go åˆ›å»ºå·¥ä½œç›®å½•ï¼Œåœ¨ $GOPATH ä¸­åˆ›å»º <code>binã€srcã€pkg</code> ä¸‰ä¸ªæ–‡ä»¶å¤¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$GOPATH</span>/<span class="token punctuation">{</span>bin,src,pkg<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>è®¾ç½®ä»£ç†</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. ä¸ƒç‰› CDN</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span>  <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct<span class="token comment"># 2. é˜¿é‡Œäº‘</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://mirrors.aliyun.com/goproxy/,direct<span class="token comment"># 3. å®˜æ–¹</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span>  <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.io,direct<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬äºŒç§æ–¹å¼ï¼šæºç åŒ…ä¸‹è½½å®‰è£…"><a href="#ç¬¬äºŒç§æ–¹å¼ï¼šæºç åŒ…ä¸‹è½½å®‰è£…" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼ï¼šæºç åŒ…ä¸‹è½½å®‰è£…"></a>ç¬¬äºŒç§æ–¹å¼ï¼šæºç åŒ…ä¸‹è½½å®‰è£…</h2><ul><li><a href="https://golang.org/dl">å›½å¤–å®˜æ–¹é•œåƒ</a></li><li><a href="https://golang.google.cn/dl/">ä¸­å›½é•œåƒ</a></li><li><a href="https://studygolang.com/dl">golang ä¸­æ–‡ç½‘</a></li></ul><h3 id="æºç åŒ…å®‰è£…"><a href="#æºç åŒ…å®‰è£…" class="headerlink" title="æºç åŒ…å®‰è£…"></a>æºç åŒ…å®‰è£…</h3><ul><li>ä¸‹è½½ Linux æºç åŒ…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://golang.google.cn/dl/go1.17.2.linux-amd64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>è§£å‹æºç åŒ…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> go1.17.2.linux-amd64.tar.gz <span class="token parameter variable">-C</span> /usr/local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æ·»åŠ é…ç½®å˜é‡ <code>vim ~/.bashrc</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½® GO è¯­è¨€çš„è·¯å¾„</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOROOT</span><span class="token operator">=</span>/usr/local/go  <span class="token comment"># è¡¨ç¤ºæºç åŒ…æ‰€åœ¨è·¯å¾„</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/go  <span class="token comment"># å†™ go é¡¹ç›®çš„å·¥ä½œè·¯å¾„ï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰</span><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$GOROOT</span>/bin:<span class="token variable">$GOPATH</span>/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™å®Œä¹‹åä¿å­˜ï¼Œç„¶åé‡æ–°å¯¼å…¥é…ç½® <code>source ~/.bashrc</code></p><ul><li>å¦‚æœä½¿ç”¨çš„æ˜¯ zsh å¹¶ä¸”åœ¨ Mac ä¸Šä½¿ç”¨ Homebrew å®‰è£…çš„ golangï¼Œé‚£ä¹ˆ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½® GO è¯­è¨€çš„è·¯å¾„</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOROOT</span><span class="token operator">=</span>/usr/local/Cellar/go/1.16.3/libexec<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/glory/codes/golang  <span class="token comment"># å†™ go é¡¹ç›®çš„å·¥ä½œè·¯å¾„ï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰</span><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$GOROOT</span>/bin:<span class="token variable">$GOPATH</span>/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™å®Œä¹‹åä¿å­˜ï¼Œç„¶åé‡æ–°å¯¼å…¥é…ç½® <code>source ~/.zshrc</code></p><ul><li>æ£€æµ‹å¼€å‘ç¯å¢ƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ go ç‰ˆæœ¬</span>go versiongo <span class="token parameter variable">--help</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹æ–‡æ¡£"><a href="#æŸ¥çœ‹æ–‡æ¡£" class="headerlink" title="æŸ¥çœ‹æ–‡æ¡£"></a>æŸ¥çœ‹æ–‡æ¡£</h2><p>æœ¬åœ°ç›´æ¥è®¿é—® go æ–‡æ¡£</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">godoc <span class="token parameter variable">-http</span><span class="token operator">=</span>:6060<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœæç¤º <code>godoc</code> å‘½ä»¤ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…æ–¹å¼ä¸€ï¼š</span>go get golang.org/x/tools<span class="token comment"># å®‰è£…æ–¹å¼äºŒï¼š</span><span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on  go <span class="token function">install</span> golang.org/x/tools/cmd/godoc@latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang http client è¯·æ±‚å°è£…</title>
      <link href="posts/ce804739.html"/>
      <url>posts/ce804739.html</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-http-client-è¯·æ±‚å°è£…"><a href="#Golang-http-client-è¯·æ±‚å°è£…" class="headerlink" title="Golang http client è¯·æ±‚å°è£…"></a>Golang http client è¯·æ±‚å°è£…</h1><p>ä½¿ç”¨åŸç”Ÿ http åŒ…ç®€å•çš„å°è£…äº†ä¸€ä¸‹ <code>get</code> å’Œ <code>post</code> è¯·æ±‚ <a href="https://github.com/pudongping/golang-tutorial/blob/main/project/http_client/httputil.go">æºä»£ç è¯¦è§ Github</a></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> http_client<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"context"</span><span class="token string">"encoding/json"</span><span class="token string">"io/ioutil"</span><span class="token string">"net/http"</span><span class="token string">"net/url"</span><span class="token string">"strings"</span><span class="token string">"time"</span><span class="token string">"golang.org/x/net/context/ctxhttp"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">Get</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> res <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>reqBody<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token function">AnyRequest</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>reqBody<span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">PostJSON</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> res <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>reqBody<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span>headers<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"application/json"</span><span class="token keyword">return</span> <span class="token function">AnyRequest</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>reqBody<span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">PostForm</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> req url<span class="token punctuation">.</span>Values<span class="token punctuation">,</span> res <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>headers<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token keyword">return</span> <span class="token function">AnyRequest</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">AnyRequest</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> req <span class="token builtin">string</span><span class="token punctuation">,</span> res <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>responseObj <span class="token operator">*</span>http<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> responseBody <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>payload <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>request<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> headers <span class="token punctuation">{</span>request<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º 5 ç§’é’Ÿ</span>client <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Client<span class="token punctuation">{</span>Timeout<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token comment">// response, err := client.Do(request)</span>response<span class="token punctuation">,</span> err <span class="token operator">:=</span> ctxhttp<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> client<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">defer</span> response<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>resBody<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>resBody<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">return</span> response<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>resBody<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è°ƒç”¨ç¤ºä¾‹"><a href="#è°ƒç”¨ç¤ºä¾‹" class="headerlink" title="è°ƒç”¨ç¤ºä¾‹"></a>è°ƒç”¨ç¤ºä¾‹</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> http_client<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"context"</span><span class="token string">"encoding/json"</span><span class="token string">"fmt"</span><span class="token string">"net/url"</span><span class="token string">"testing"</span><span class="token string">"time"</span><span class="token string">"github.com/davecgh/go-spew/spew"</span><span class="token punctuation">)</span><span class="token keyword">type</span> Result <span class="token keyword">struct</span> <span class="token punctuation">{</span>Args    <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token string">`json:"args"`</span>Data    <span class="token builtin">string</span>            <span class="token string">`json:"data"`</span>Files   <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token string">`json:"files"`</span>Form    <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token string">`json:"form"`</span>Headers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:"headers"`</span>Json    <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token string">`json:"json"`</span>Method  <span class="token builtin">string</span>            <span class="token string">`json:"method"`</span>Origin  <span class="token builtin">string</span>            <span class="token string">`json:"origin"`</span>Url     <span class="token builtin">string</span>            <span class="token string">`json:"url"`</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">TestGet</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>reqUrl <span class="token operator">:=</span> <span class="token string">"https://httpbin.org/anything?name=alex&amp;age=18"</span>req <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"param1"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"param2"</span><span class="token punctuation">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// var res map[string]interface{}</span><span class="token keyword">var</span> res Result<span class="token boolean">_</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">Get</span><span class="token punctuation">(</span>reqUrl<span class="token punctuation">,</span> req<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æœ‰é”™è¯¯ %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// {</span><span class="token comment">//  "args": {</span><span class="token comment">//    "age": "18",</span><span class="token comment">//    "name": "alex"</span><span class="token comment">//  },</span><span class="token comment">//  "data": "{\"param1\":[1,2,3],\"param2\":\"hello world\",\"param3\":{\"param31\":\"value31\",\"param32\":12345,\"param33\":[11,33,44]}}",</span><span class="token comment">//  "files": {},</span><span class="token comment">//  "form": {},</span><span class="token comment">//  "headers": {</span><span class="token comment">//    "Accept-Encoding": "gzip",</span><span class="token comment">//    "Content-Length": "109",</span><span class="token comment">//    "Content-Type": "application/json",</span><span class="token comment">//    "Host": "httpbin.org",</span><span class="token comment">//    "Token": "123456",</span><span class="token comment">//    "User-Agent": "App/",</span><span class="token comment">//    "X-Amzn-Trace-Id": "Root=1-6358a5b4-5f9ceebc28bd7db245d4accc"</span><span class="token comment">//  },</span><span class="token comment">//  "json": {</span><span class="token comment">//    "param1": [</span><span class="token comment">//      1,</span><span class="token comment">//      2,</span><span class="token comment">//      3</span><span class="token comment">//    ],</span><span class="token comment">//    "param2": "hello world",</span><span class="token comment">//    "param3": {</span><span class="token comment">//      "param31": "value31",</span><span class="token comment">//      "param32": 12345,</span><span class="token comment">//      "param33": [</span><span class="token comment">//        11,</span><span class="token comment">//        33,</span><span class="token comment">//        44</span><span class="token comment">//      ]</span><span class="token comment">//    }</span><span class="token comment">//  },</span><span class="token comment">//  "method": "POST",</span><span class="token comment">//  "origin": "112.65.11.169",</span><span class="token comment">//  "url": "https://httpbin.org/anything?name=alex&amp;age=18"</span><span class="token comment">// }</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"=====&gt;"</span><span class="token punctuation">)</span>spew<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">TestPostJSON</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>reqUrl <span class="token operator">:=</span> <span class="token string">"https://httpbin.org/anything?name=alex&amp;age=18"</span>req <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"param1"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"param2"</span><span class="token punctuation">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span><span class="token string">"param3"</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"param31"</span><span class="token punctuation">:</span> <span class="token string">"value31"</span><span class="token punctuation">,</span><span class="token string">"param32"</span><span class="token punctuation">:</span> <span class="token number">12345</span><span class="token punctuation">,</span><span class="token string">"param33"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">var</span> res <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>headers <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"App/"</span><span class="token punctuation">,</span><span class="token string">"Token"</span><span class="token punctuation">:</span>      <span class="token string">"123456"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token boolean">_</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">PostJSON</span><span class="token punctuation">(</span>reqUrl<span class="token punctuation">,</span> req<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æœ‰é”™è¯¯ %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"=====&gt;"</span><span class="token punctuation">)</span>spew<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">TestPostForm</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>reqUrl <span class="token operator">:=</span> <span class="token string">"https://httpbin.org/anything?name=alex&amp;age=18"</span>req <span class="token operator">:=</span> url<span class="token punctuation">.</span>Values<span class="token punctuation">{</span><span class="token string">"param1"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"value11"</span><span class="token punctuation">,</span> <span class="token string">"value12"</span><span class="token punctuation">,</span> <span class="token string">"value13"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"param2"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"value21"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">var</span> res <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>headers <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"App/"</span><span class="token punctuation">,</span><span class="token string">"Token"</span><span class="token punctuation">:</span>      <span class="token string">"123456"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token boolean">_</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">PostForm</span><span class="token punctuation">(</span>reqUrl<span class="token punctuation">,</span> req<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æœ‰é”™è¯¯ %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// {</span><span class="token comment">//  "args": {</span><span class="token comment">//    "age": "18",</span><span class="token comment">//    "name": "alex"</span><span class="token comment">//  },</span><span class="token comment">//  "data": "",</span><span class="token comment">//  "files": {},</span><span class="token comment">//  "form": {</span><span class="token comment">//    "param1": [</span><span class="token comment">//      "value11",</span><span class="token comment">//      "value12",</span><span class="token comment">//      "value13"</span><span class="token comment">//    ],</span><span class="token comment">//    "param2": "value21"</span><span class="token comment">//  },</span><span class="token comment">//  "headers": {</span><span class="token comment">//    "Accept-Encoding": "gzip",</span><span class="token comment">//    "Content-Length": "59",</span><span class="token comment">//    "Content-Type": "application/x-www-form-urlencoded",</span><span class="token comment">//    "Host": "httpbin.org",</span><span class="token comment">//    "Token": "123456",</span><span class="token comment">//    "User-Agent": "App/",</span><span class="token comment">//    "X-Amzn-Trace-Id": "Root=1-6358a4da-33ec2e5104331c413171db1b"</span><span class="token comment">//  },</span><span class="token comment">//  "json": null,</span><span class="token comment">//  "method": "POST",</span><span class="token comment">//  "origin": "112.65.11.169",</span><span class="token comment">//  "url": "https://httpbin.org/anything?name=alex&amp;age=18"</span><span class="token comment">// }</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"=====&gt;"</span><span class="token punctuation">)</span>spew<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">TestAnyRequest</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœå°†æ—¶é—´è®¾ç½®ç¨å¾®çŸ­ä¸€ç‚¹ï¼Œæ¯”å¦‚è¯´ 2 ç§’ï¼Œé‚£ä¹ˆå¯èƒ½ delete è¯·æ±‚ä¼šæˆåŠŸï¼Œä½†æ˜¯ put è¯·æ±‚å¯èƒ½ä¼šå› ä¸ºä¸Šä¸‹æ–‡è¶…æ—¶è€Œä¸­æ–­æ‰</span>ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>reqUrl <span class="token operator">:=</span> <span class="token string">"https://httpbin.org/anything/123"</span><span class="token keyword">var</span> err <span class="token builtin">error</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"DELETE start"</span><span class="token punctuation">)</span><span class="token keyword">var</span> deleteRes <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token boolean">_</span><span class="token punctuation">,</span> deleteBody<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">AnyRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">"DELETE"</span><span class="token punctuation">,</span> reqUrl<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>deleteRes<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"DELETE æœ‰é”™è¯¯ %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// {</span><span class="token comment">//  "args": {},</span><span class="token comment">//  "data": "",</span><span class="token comment">//  "files": {},</span><span class="token comment">//  "form": {},</span><span class="token comment">//  "headers": {</span><span class="token comment">//    "Accept-Encoding": "gzip",</span><span class="token comment">//    "Host": "httpbin.org",</span><span class="token comment">//    "User-Agent": "Go-http-client/2.0",</span><span class="token comment">//    "X-Amzn-Trace-Id": "Root=1-6358db58-76062ef533376565790e1d8a"</span><span class="token comment">//  },</span><span class="token comment">//  "json": null,</span><span class="token comment">//  "method": "DELETE",</span><span class="token comment">//  "origin": "112.65.11.169",</span><span class="token comment">//  "url": "https://httpbin.org/anything/123"</span><span class="token comment">// }</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>deleteBody<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"DELETE =====&gt;"</span><span class="token punctuation">)</span>spew<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span>deleteRes<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"DELETE end"</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"============================&gt;"</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"PUT start"</span><span class="token punctuation">)</span><span class="token keyword">var</span> putRes <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>putReq <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"param1"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"param2"</span><span class="token punctuation">:</span> <span class="token string">"value2"</span><span class="token punctuation">,</span><span class="token string">"param3"</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span><span class="token punctuation">}</span>putPayload<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>putReq<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"PUT æœ‰é”™è¯¯ %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">}</span>putHeaders <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span><span class="token string">"Token"</span><span class="token punctuation">:</span>        <span class="token string">"1234"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token boolean">_</span><span class="token punctuation">,</span> putBody<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">AnyRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">"PUT"</span><span class="token punctuation">,</span> reqUrl<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>putPayload<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>putRes<span class="token punctuation">,</span> putHeaders<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"PUT æœ‰é”™è¯¯ %v \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// {</span><span class="token comment">//  "args": {},</span><span class="token comment">//  "data": "{\"param1\":[11,22,33],\"param2\":\"value2\",\"param3\":123}",</span><span class="token comment">//  "files": {},</span><span class="token comment">//  "form": {},</span><span class="token comment">//  "headers": {</span><span class="token comment">//    "Accept-Encoding": "gzip",</span><span class="token comment">//    "Content-Length": "52",</span><span class="token comment">//    "Content-Type": "application/json",</span><span class="token comment">//    "Host": "httpbin.org",</span><span class="token comment">//    "Token": "1234",</span><span class="token comment">//    "User-Agent": "Go-http-client/2.0",</span><span class="token comment">//    "X-Amzn-Trace-Id": "Root=1-6358de6f-44d849be16f5a4c477b07616"</span><span class="token comment">//  },</span><span class="token comment">//  "json": {</span><span class="token comment">//    "param1": [</span><span class="token comment">//      11,</span><span class="token comment">//      22,</span><span class="token comment">//      33</span><span class="token comment">//    ],</span><span class="token comment">//    "param2": "value2",</span><span class="token comment">//    "param3": 123</span><span class="token comment">//  },</span><span class="token comment">//  "method": "PUT",</span><span class="token comment">//  "origin": "112.65.11.169",</span><span class="token comment">//  "url": "https://httpbin.org/anything/123"</span><span class="token comment">// }</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>putBody<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"PUT =====&gt;"</span><span class="token punctuation">)</span>spew<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span>putRes<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"PUT end"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> Http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang æ—¶é—´æ“ä½œå¤§å…¨</title>
      <link href="posts/d0937fdd.html"/>
      <url>posts/d0937fdd.html</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-æ—¶é—´æ“ä½œå¤§å…¨"><a href="#Golang-æ—¶é—´æ“ä½œå¤§å…¨" class="headerlink" title="Golang æ—¶é—´æ“ä½œå¤§å…¨"></a>Golang æ—¶é—´æ“ä½œå¤§å…¨</h1><p><a href="https://github.com/pudongping/golang-tutorial/blob/main/project/time_helper/time_explore.go">æºä»£ç è¯¦è§ GitHub</a></p><h2 id="è·å–æ—¶é—´"><a href="#è·å–æ—¶é—´" class="headerlink" title="è·å–æ—¶é—´"></a>è·å–æ—¶é—´</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// è·å–å½“å‰æ—¶é—´</span>now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ ====&gt; 2022-10-24 23:36:33.47472 +0800 CST m=+0.000077400 typeof ===&gt; time.Time</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> now<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token comment">// è·å–å½“å‰æ—¶é—´çš„å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ã€çº³ç§’ã€å¾®å¦™ã€æ¯«ç§’</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´å¹´æœˆæ—¥ ====&gt; [2022][October][24] typeof ===&gt; [int][time.Month][int]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´å¹´æœˆæ—¥ ====&gt; [%v][%v][%v] typeof ===&gt; [%T][%T][%T] \n"</span><span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span>nowYear <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Year</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´å¹´ ====&gt; 2022 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´å¹´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowYear<span class="token punctuation">,</span> nowYear<span class="token punctuation">)</span>nowMonth <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Month</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æœˆ ====&gt; October typeof ===&gt; time.Month</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æœˆ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowMonth<span class="token punctuation">,</span> nowMonth<span class="token punctuation">)</span>nowDay <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¥ ====&gt; 24 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¥ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowDay<span class="token punctuation">,</span> nowDay<span class="token punctuation">)</span>hour<span class="token punctuation">,</span> minute<span class="token punctuation">,</span> second <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¶åˆ†ç§’ ====&gt; [23][36][33] typeof ===&gt; [int][int][int]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¶åˆ†ç§’ ====&gt; [%v][%v][%v] typeof ===&gt; [%T][%T][%T] \n"</span><span class="token punctuation">,</span> hour<span class="token punctuation">,</span> minute<span class="token punctuation">,</span> second<span class="token punctuation">,</span> hour<span class="token punctuation">,</span> minute<span class="token punctuation">,</span> second<span class="token punctuation">)</span>nowHour <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¶ ====&gt; 23 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¶ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowHour<span class="token punctuation">,</span> nowHour<span class="token punctuation">)</span>nowMinute <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Minute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´åˆ† ====&gt; 36 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´åˆ† ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowMinute<span class="token punctuation">,</span> nowMinute<span class="token punctuation">)</span>nowSecond <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ç§’ ====&gt; 33 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ç§’ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowSecond<span class="token punctuation">,</span> nowSecond<span class="token punctuation">)</span><span class="token comment">// 1ç§’(s) ï¼1000æ¯«ç§’(ms)</span><span class="token comment">// 1æ¯«ç§’(ms)ï¼1000å¾®ç§’ (us) ==&gt; Milliseconds ==&gt; æ¯«ç§’</span><span class="token comment">// 1å¾®ç§’(us)ï¼1000çº³ç§’ (ns)  ==&gt; Microseconds  ==&gt; å¾®ç§’</span><span class="token comment">// 1çº³ç§’(ns)ï¼1000çš®ç§’ (ps)  ==&gt; Nanoseconds  ==&gt; çº³ç§’</span>nowNanosecond <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Nanosecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´çº³ç§’ ====&gt; 474905000 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´çº³ç§’ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowNanosecond<span class="token punctuation">,</span> nowNanosecond<span class="token punctuation">)</span><span class="token comment">// è·å–å½“å‰æ—¶é—´æˆ³</span>nowUnix <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¶é—´æˆ³ï¼ˆç§’çº§åˆ«ï¼‰ ====&gt; 1666625793 typeof ===&gt; int64</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¶é—´æˆ³ï¼ˆç§’çº§åˆ«ï¼‰ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowUnix<span class="token punctuation">,</span> nowUnix<span class="token punctuation">)</span>nowUnixNano <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¶é—´æˆ³ï¼ˆçº³ç§’çº§åˆ«ï¼‰ ====&gt; 1666625793474909000 typeof ===&gt; int64</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¶é—´æˆ³ï¼ˆçº³ç§’çº§åˆ«ï¼‰ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> nowUnixNano<span class="token punctuation">,</span> nowUnixNano<span class="token punctuation">)</span>weekDay <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Weekday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ˜ŸæœŸå‡  ====&gt; Monday typeof ===&gt; time.Weekday</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ˜ŸæœŸå‡  ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> weekDay<span class="token punctuation">,</span> weekDay<span class="token punctuation">)</span>yearDay <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">YearDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ˜¯ä¸€å¹´ä¸­å¯¹åº”çš„ç¬¬å‡ å¤© ====&gt; 297 typeof ===&gt; int</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ˜¯ä¸€å¹´ä¸­å¯¹åº”çš„ç¬¬å‡ å¤© ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> yearDay<span class="token punctuation">,</span> yearDay<span class="token punctuation">)</span>location <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Location</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰ç”¨çš„æ—¶åŒºä¸º ====&gt; Local typeof ===&gt; *time.Location</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰ç”¨çš„æ—¶åŒºä¸º ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> location<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ—¶é—´è½¬åŒ–"><a href="#æ—¶é—´è½¬åŒ–" class="headerlink" title="æ—¶é—´è½¬åŒ–"></a>æ—¶é—´è½¬åŒ–</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// æ ¼å¼åŒ–æ—¶é—´</span>ymdhis <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ ====&gt; 2022-10-24 23:40:31 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> ymdhis<span class="token punctuation">,</span> ymdhis<span class="token punctuation">)</span>ymdhis1 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ ====&gt; 2022-10-24 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> ymdhis1<span class="token punctuation">,</span> ymdhis1<span class="token punctuation">)</span>ymdhis2 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"20060102"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ ====&gt; 20221024 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> ymdhis2<span class="token punctuation">,</span> ymdhis2<span class="token punctuation">)</span>ymdhis3 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ ====&gt; 23:40:31 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> ymdhis3<span class="token punctuation">,</span> ymdhis3<span class="token punctuation">)</span>ymdhis4 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"150405"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ ====&gt; 234031 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> ymdhis4<span class="token punctuation">,</span> ymdhis4<span class="token punctuation">)</span>y <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´å¹´ ====&gt; 2022 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´å¹´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>m <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"01"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æœˆ ====&gt; 10 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æœˆ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> m<span class="token punctuation">)</span>d <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"02"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¥ ====&gt; 24 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¥ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> d<span class="token punctuation">)</span>h <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"15"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´æ—¶ ====&gt; 23 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´æ—¶ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> h<span class="token punctuation">,</span> h<span class="token punctuation">)</span>i <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"04"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´åˆ† ====&gt; 40 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´åˆ† ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span>s <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ç§’ ====&gt; 31 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ç§’ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token comment">// æ—¶é—´æˆ³è½¬æ—¶é—´æ ¼å¼</span><span class="token keyword">var</span> timeUnix <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">1666599090</span>goTimeUnix <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span>timeUnix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// å·²çŸ¥æ—¶é—´æˆ³è½¬ go æ ¼å¼æ—¶é—´ ====&gt; 2022-10-24 16:11:30 +0800 CST typeof ===&gt; time.Time</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å·²çŸ¥æ—¶é—´æˆ³è½¬ go æ ¼å¼æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> goTimeUnix<span class="token punctuation">,</span> goTimeUnix<span class="token punctuation">)</span>goTimeUnixFormat <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span>timeUnix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å·²çŸ¥æ—¶é—´æˆ³è½¬ ymdhis æ ¼å¼æ—¶é—´ ====&gt; 2022-10-24 16:11:30 typeof ===&gt; string</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å·²çŸ¥æ—¶é—´æˆ³è½¬ ymdhis æ ¼å¼æ—¶é—´ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> goTimeUnixFormat<span class="token punctuation">,</span> goTimeUnixFormat<span class="token punctuation">)</span><span class="token comment">// è·å–æŒ‡å®šæ—¶é—´çš„æ—¶é—´æˆ³</span>dateUnix <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Local<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 2022-10-24 16:11:30 çš„æ—¶é—´æˆ³ä¸º ====&gt; 1666599090 typeof ===&gt; int64</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"2022-10-24 16:11:30 çš„æ—¶é—´æˆ³ä¸º ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> dateUnix<span class="token punctuation">,</span> dateUnix<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ—¶é—´è®¡ç®—"><a href="#æ—¶é—´è®¡ç®—" class="headerlink" title="æ—¶é—´è®¡ç®—"></a>æ—¶é—´è®¡ç®—</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// è·å–å½“å¤© 0 æ—¶ 0 åˆ† 0 ç§’çš„æ—¶é—´æˆ³</span>currentTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>startTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">.</span><span class="token function">Year</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> currentTime<span class="token punctuation">.</span><span class="token function">Month</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> currentTime<span class="token punctuation">.</span><span class="token function">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> currentTime<span class="token punctuation">.</span><span class="token function">Location</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// å½“å¤© 0 æ—¶ 0 åˆ† 0 ç§’çš„æ—¶é—´æˆ³ ====&gt; 2022-10-24 00:00:00 +0800 CST typeof ===&gt; time.Time</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å¤© 0 æ—¶ 0 åˆ† 0 ç§’çš„æ—¶é—´æˆ³ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> startTime<span class="token punctuation">)</span><span class="token comment">// å½“å¤© 0 æ—¶ 0 åˆ† 0 ç§’çš„æ—¶é—´ ====&gt; 2022-10-24 00:00:00</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å¤© 0 æ—¶ 0 åˆ† 0 ç§’çš„æ—¶é—´ ====&gt; %v \n"</span><span class="token punctuation">,</span> startTime<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// è·å–å½“å¤© 23 æ—¶ 59 åˆ† 59 ç§’çš„æ—¶é—´æˆ³</span>endTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Date</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">.</span><span class="token function">Year</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> currentTime<span class="token punctuation">.</span><span class="token function">Month</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> currentTime<span class="token punctuation">.</span><span class="token function">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> currentTime<span class="token punctuation">.</span><span class="token function">Location</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// å½“å¤© 23 æ—¶ 59 åˆ† 59 ç§’çš„æ—¶é—´æˆ³ ====&gt; 2022-10-24 23:59:59 +0800 CST typeof ===&gt; time.Time</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å¤© 23 æ—¶ 59 åˆ† 59 ç§’çš„æ—¶é—´æˆ³ ====&gt; %v typeof ===&gt; %T \n"</span><span class="token punctuation">,</span> endTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token comment">// å½“å¤© 23 æ—¶ 59 åˆ† 59 ç§’çš„æ—¶é—´ ====&gt; 2022-10-24 23:59:59</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å¤© 23 æ—¶ 59 åˆ† 59 ç§’çš„æ—¶é—´ ====&gt; %v \n"</span><span class="token punctuation">,</span> endTime<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// ä¸è¶…è¿‡ 24 å°æ—¶çš„æ—¶é—´è®¡ç®—</span>currentYmdHis <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// è·å– 1 ç§’é’Ÿå‰çš„æ—¶é—´</span>t1<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseDuration</span><span class="token punctuation">(</span><span class="token string">"-1s"</span><span class="token punctuation">)</span>r1 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ 2022-10-24 23:44:12 ===&gt; 1 ç§’é’Ÿå‰çš„æ—¶é—´ ===&gt; 2022-10-24 23:44:11</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ %v ===&gt; 1 ç§’é’Ÿå‰çš„æ—¶é—´ ===&gt; %v \n"</span><span class="token punctuation">,</span> currentYmdHis<span class="token punctuation">,</span> r1<span class="token punctuation">)</span>t2<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseDuration</span><span class="token punctuation">(</span><span class="token string">"2h"</span><span class="token punctuation">)</span>r2 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ 2022-10-24 23:44:12 ===&gt; 2 å°æ—¶åçš„æ—¶é—´ ===&gt; 2022-10-25 01:44:12</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ %v ===&gt; 2 å°æ—¶åçš„æ—¶é—´ ===&gt; %v \n"</span><span class="token punctuation">,</span> currentYmdHis<span class="token punctuation">,</span> r2<span class="token punctuation">)</span>t3<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseDuration</span><span class="token punctuation">(</span><span class="token string">"1h2m30s"</span><span class="token punctuation">)</span>r3 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ 2022-10-24 23:44:12 ===&gt; 1 å°æ—¶ 2 åˆ† 30 ç§’åçš„æ—¶é—´ ===&gt; 2022-10-25 00:46:42</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ %v ===&gt; 1 å°æ—¶ 2 åˆ† 30 ç§’åçš„æ—¶é—´ ===&gt; %v \n"</span><span class="token punctuation">,</span> currentYmdHis<span class="token punctuation">,</span> r3<span class="token punctuation">)</span><span class="token comment">// è®¡ç®—ä¸¤ä¸ªæ—¶é—´ç›¸å·®å¤šå°‘</span>t4<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseDuration</span><span class="token punctuation">(</span><span class="token string">"1h"</span><span class="token punctuation">)</span>r4 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t4 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// æ³¨æ„ï¼šè¿™é‡Œæ˜¯ 2 å°æ—¶åçš„æ—¶é—´</span>t5<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseDuration</span><span class="token punctuation">(</span><span class="token string">"-1h30m"</span><span class="token punctuation">)</span>r5 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t5<span class="token punctuation">)</span><span class="token comment">// ç›¸å·® 12600 ç§’</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç›¸å·® %v ç§’ \n"</span><span class="token punctuation">,</span> r4<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>r5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// ç›¸å·® 210 åˆ†é’Ÿ</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç›¸å·® %v åˆ†é’Ÿ \n"</span><span class="token punctuation">,</span> r4<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>r5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Minutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// ç›¸å·® 3.5 å°æ—¶</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç›¸å·® %v å°æ—¶ \n"</span><span class="token punctuation">,</span> r4<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>r5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// ç›¸å·® 0.14583333333333334 å¤©</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç›¸å·® %v å¤© \n"</span><span class="token punctuation">,</span> r4<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>r5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token comment">// è¶…è¿‡ 24 å°æ—¶ä¹‹å¤–çš„æ—¶é—´è®¡ç®—</span>t6 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">AddDate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>r6 <span class="token operator">:=</span> t6<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ 2022-10-24 23:44:12 ===&gt; 2 ä¸ªæœˆ 1 å¤©åçš„æ—¶é—´ ===&gt; 2022-12-25 23:44:12</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ %v ===&gt; 2 ä¸ªæœˆ 1 å¤©åçš„æ—¶é—´ ===&gt; %v \n"</span><span class="token punctuation">,</span> currentYmdHis<span class="token punctuation">,</span> r6<span class="token punctuation">)</span>t7 <span class="token operator">:=</span> currentTime<span class="token punctuation">.</span><span class="token function">AddDate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>r7 <span class="token operator">:=</span> t7<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ 2022-10-24 23:44:12 ===&gt; 5 å¤©å‰çš„æ—¶é—´ ===&gt; 2022-10-19 23:44:12</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ %v ===&gt; 5 å¤©å‰çš„æ—¶é—´ ===&gt; %v \n"</span><span class="token punctuation">,</span> currentYmdHis<span class="token punctuation">,</span> r7<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ—¶é—´åˆ¤æ–­æ¯”è¾ƒ"><a href="#æ—¶é—´åˆ¤æ–­æ¯”è¾ƒ" class="headerlink" title="æ—¶é—´åˆ¤æ–­æ¯”è¾ƒ"></a>æ—¶é—´åˆ¤æ–­æ¯”è¾ƒ</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">:=</span> now<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token comment">// å½“å‰æ—¶é—´ä¸º 2022-11-12 19:45:36</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´ä¸º %s \n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token comment">// æ—¶é—´æ¯”è¾ƒ</span><span class="token comment">// å°½å¯èƒ½çš„ä½¿ç”¨ time.ParseInLocation() æ–¹æ³•ï¼Œå› ä¸ºå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ—¶åŒº</span><span class="token comment">// è€Œå°‘ç”¨ time.Parse() æ–¹æ³•ï¼Œå› ä¸ºé»˜è®¤çš„æ—¶åŒºä¸º UTCï¼ˆé›¶æ—¶åŒºï¼‰</span>startTime<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">,</span> <span class="token string">"2022-10-24 18:18:00"</span><span class="token punctuation">)</span>isBefore <span class="token operator">:=</span> startTime<span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>isAfter <span class="token operator">:=</span> startTime<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>isEqual <span class="token operator">:=</span> startTime<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token comment">// 2022-10-24 18:18:00 æ˜¯å¦åœ¨ 2022-11-12 19:45:36 ä¹‹å‰ï¼Ÿ true</span><span class="token comment">// æ˜¯å¦åœ¨ 2022-11-12 19:45:36 ä¹‹åï¼Ÿ false</span><span class="token comment">// è¿˜æ˜¯ç›¸ç­‰ï¼Ÿ false</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"2022-10-24 18:18:00 æ˜¯å¦åœ¨ %s ä¹‹å‰ï¼Ÿ %v \n æ˜¯å¦åœ¨ %s ä¹‹åï¼Ÿ %v \nè¿˜æ˜¯ç›¸ç­‰ï¼Ÿ %v\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> isBefore<span class="token punctuation">,</span> s<span class="token punctuation">,</span> isAfter<span class="token punctuation">,</span> isEqual<span class="token punctuation">)</span>sTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// time.Since(t Time) Duration ã€å½“å‰æ—¶é—´ä¸æ—¶é—´ t çš„æ—¶é—´å·®ï¼ˆä¹Ÿå°±æ˜¯å½“å‰æ—¶é—´å‡å» t çš„å·®ï¼‰ã€‘</span><span class="token comment">// time.Until(t Time) Duration ã€æ—¶é—´ t ä¸å½“å‰æ—¶é—´çš„å·®ï¼ˆä¹Ÿå°±æ˜¯æ—¶é—´ t å‡å»å½“å‰æ—¶é—´ï¼‰ã€‘</span><span class="token comment">// ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶é—´ä¸ºï¼š1666626449 ç»“æŸæ‰§è¡Œæ—¶é—´ä¸ºï¼š1666626452 æ‰§è¡Œäº†å¤šé•¿æ—¶é—´ï¼š3.003903595s ç§’é’Ÿ</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶é—´ä¸ºï¼š%v ç»“æŸæ‰§è¡Œæ—¶é—´ä¸ºï¼š%v æ‰§è¡Œäº†å¤šé•¿æ—¶é—´ï¼š%v ç§’é’Ÿ \n"</span><span class="token punctuation">,</span> sTime<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>sTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// ç¨‹åºåœ¨ -3.004024213s ç§’é’Ÿå‰æ‰§è¡Œ</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç¨‹åºåœ¨ %v ç§’é’Ÿå‰æ‰§è¡Œ \n"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Until</span><span class="token punctuation">(</span>sTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è°ƒæ•´æ—¶åŒº"><a href="#è°ƒæ•´æ—¶åŒº" class="headerlink" title="è°ƒæ•´æ—¶åŒº"></a>è°ƒæ•´æ—¶åŒº</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// è½¬æ¢æ—¶é—´æ—¶ï¼ŒæŒ‡å®šæ—¶åŒº</span><span class="token keyword">var</span> timeParseInTimeZone <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> timezone <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>chinaTimezone<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">LoadLocation</span><span class="token punctuation">(</span>timezone<span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šæ—¶åŒº</span><span class="token comment">// å°½å¯èƒ½çš„ä½¿ç”¨ time.ParseInLocation() æ–¹æ³•ï¼Œå› ä¸ºå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ—¶åŒº</span><span class="token comment">// è€Œå°‘ç”¨ time.Parse() æ–¹æ³•ï¼Œå› ä¸ºé»˜è®¤çš„æ—¶åŒºä¸º UTCï¼ˆé›¶æ—¶åŒºï¼‰</span>t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseInLocation</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> chinaTimezone<span class="token punctuation">)</span><span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">In</span><span class="token punctuation">(</span>chinaTimezone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">}</span>layout <span class="token operator">:=</span> <span class="token string">"2006-01-02 15:04:05"</span>inputTime <span class="token operator">:=</span> <span class="token string">"2022-10-24 21:56:59"</span><span class="token comment">// ä½ æœ¬æœºç³»ç»Ÿå¾—æœ‰ä½ è®¾ç½®çš„æ—¶åŒºæ‰è¡Œï¼Œä¸ç„¶ä¹Ÿä¼šèµ°çš„ä½ ç³»ç»Ÿé»˜è®¤è®¾å®šçš„æ—¶åŒº</span>t1 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span>t2 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"Asia/Chongqing"</span><span class="token punctuation">)</span>t3 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"PRC"</span><span class="token punctuation">)</span>              <span class="token comment">// ä¸­åäººæ°‘å…±å’Œå›½</span>t4 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"Asia/Singapore"</span><span class="token punctuation">)</span>   <span class="token comment">// æ–°åŠ å¡(UTC+08:00)</span>t5 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"Asia/Tokyo"</span><span class="token punctuation">)</span>       <span class="token comment">// ä¸œäº¬(UTC+09:00)</span>t6 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"Etc/GMT"</span><span class="token punctuation">)</span>          <span class="token comment">// åè°ƒä¸–ç•Œæ—¶(UTC+00:00)</span>t7 <span class="token operator">:=</span> <span class="token function">timeParseInTimeZone</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">,</span> <span class="token string">"Pacific/Honolulu"</span><span class="token punctuation">)</span> <span class="token comment">// å¤å¨å¤·(UTC-10:00)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai ====&gt; %s \n"</span><span class="token punctuation">,</span> t1<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Asia/Chongqing ====&gt; %s \n"</span><span class="token punctuation">,</span> t2<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"PRC ====&gt; %s \n"</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Asia/Singapore ====&gt; %s \n"</span><span class="token punctuation">,</span> t4<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Asia/Tokyo ====&gt; %s \n"</span><span class="token punctuation">,</span> t5<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Etc/GMT ====&gt; %s \n"</span><span class="token punctuation">,</span> t6<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Pacific/Honolulu ====&gt; %s \n"</span><span class="token punctuation">,</span> t7<span class="token punctuation">)</span><span class="token comment">// ä¸è®¾ç½®æ—¶åŒºæ—¶ï¼Œé»˜è®¤èµ°çš„ UTC ï¼ˆé›¶æ—¶åŒºï¼‰</span>tt<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> inputTime<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang ä½¿ç”¨ olivere/elastic å®¢æˆ·ç«¯æ“ä½œ ElasticSearch</title>
      <link href="posts/a443aa.html"/>
      <url>posts/a443aa.html</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-ä½¿ç”¨-olivere-elastic-å®¢æˆ·ç«¯æ“ä½œ-ElasticSearch"><a href="#Golang-ä½¿ç”¨-olivere-elastic-å®¢æˆ·ç«¯æ“ä½œ-ElasticSearch" class="headerlink" title="Golang ä½¿ç”¨ olivere/elastic å®¢æˆ·ç«¯æ“ä½œ ElasticSearch"></a>Golang ä½¿ç”¨ olivere/elastic å®¢æˆ·ç«¯æ“ä½œ ElasticSearch</h1><p><code>olivere/elastic</code> æ’ä»¶åŒ…ï¼Œç®—æ˜¯ go è¯­è¨€ä¸­æ¯”è¾ƒé€šç”¨çš„æ“ä½œ ElasticSearch çš„å®¢æˆ·ç«¯äº†ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>v7</code> ç‰ˆæœ¬ã€‚</p><h2 id="ä¸‹è½½-olivere-elastic-åŒ…"><a href="#ä¸‹è½½-olivere-elastic-åŒ…" class="headerlink" title="ä¸‹è½½ olivere/elastic åŒ…"></a>ä¸‹è½½ <code>olivere/elastic</code> åŒ…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get github.com/olivere/elastic/v7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>è¿™é‡Œç›´æ¥ä»¥ä»£ç  demo çš„å½¢å¼å‘ˆç°ï¼Œå…·ä½“å«ä¹‰ï¼Œè¯·è§æ³¨é‡Šã€‚è‹¥æœ‰é”™è¯¯ï¼Œè¿˜æœ›æŒ‡æ­£ï¼Œæ„Ÿè°¢ï¼</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">/**GitHubï¼š https://github.com/olivere/elasticå®˜æ–¹æ–‡æ¡£ç¤ºä¾‹ï¼š https://olivere.github.io/elastic/ä¸‹è½½ï¼šgo get github.com/olivere/elastic/v7*/</span><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"context"</span><span class="token string">"encoding/json"</span><span class="token string">"errors"</span><span class="token string">"fmt"</span><span class="token string">"sync"</span><span class="token string">"time"</span><span class="token string">"github.com/olivere/elastic/v7"</span><span class="token punctuation">)</span><span class="token keyword">var</span> <span class="token punctuation">(</span>ESClient <span class="token operator">*</span>elastic<span class="token punctuation">.</span>Clientonce     sync<span class="token punctuation">.</span>Once<span class="token punctuation">)</span><span class="token keyword">type</span> RcpGoodsImgChecksES <span class="token keyword">struct</span> <span class="token punctuation">{</span>AppName     <span class="token builtin">int</span>    <span class="token string">`json:"app_name"`</span>GoodsId     <span class="token builtin">string</span> <span class="token string">`json:"goods_id"`</span>SiteId      <span class="token builtin">int</span>    <span class="token string">`json:"site_id"`</span>CheckStatus <span class="token builtin">int</span>    <span class="token string">`json:"check_status"`</span>CreatedAt   <span class="token builtin">int</span>    <span class="token string">`json:"created_at"`</span>UpdatedAt   <span class="token builtin">int</span>    <span class="token string">`json:"updated_at"`</span><span class="token punctuation">}</span><span class="token keyword">const</span> RcpGoodsImgChecksESIndex <span class="token operator">=</span> <span class="token string">"rcp_goods_img_checks"</span><span class="token keyword">const</span> RcpGoodsImgChecksESMapping <span class="token operator">=</span> <span class="token string">`{"mappings":{"properties":{"app_name":{"type": "integer"},"goods_id":{"type": "keyword"},"site_id":{"type": "keyword"},"check_status":{"type": "integer"},"created_at":{"type": "date"},"updated_at":{"type": "date"}}}}`</span><span class="token keyword">const</span> esUrl <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:9200"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> err <span class="token builtin">error</span><span class="token comment">// åˆ›å»º es è¿æ¥</span><span class="token function">ConnectES</span><span class="token punctuation">(</span><span class="token comment">// å¦‚æœ es æ˜¯é€šè¿‡ docker å®‰è£…ï¼Œå¦‚æœä¸è®¾ç½® `elastic.SetSniff(false)` é‚£ä¹ˆåˆ™ä¼šæŠ¥é”™</span>elastic<span class="token punctuation">.</span><span class="token function">SetSniff</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// å…è®¸æŒ‡å®šå¼¹æ€§æ˜¯å¦åº”è¯¥å®šæœŸæ£€æŸ¥é›†ç¾¤ï¼Œé»˜è®¤ä¸º true, ä¼šæŠŠè¯·æ±‚ http://ip:port/_nodes/httpï¼Œå¹¶å°†å…¶è¿”å›çš„ publish_address ä½œä¸ºè¯·æ±‚è·¯å¾„</span>elastic<span class="token punctuation">.</span><span class="token function">SetURL</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>esUrl<span class="token punctuation">}</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡åœ°å€</span>elastic<span class="token punctuation">.</span><span class="token function">SetBasicAuth</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">// è®¾ç½®è®¤è¯è´¦å·å’Œå¯†ç </span><span class="token comment">// elastic.SetHealthcheckInterval(time.Second*5), // å¿ƒè·³æ£€æŸ¥ï¼Œé—´éš”æ—¶é—´</span><span class="token comment">// elastic.SetGzip(true),                         // å¯ç”¨ gzip å‹ç¼©</span><span class="token punctuation">)</span><span class="token comment">// Ping the Elasticsearch server to get e.g. the version number</span>info<span class="token punctuation">,</span> code<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">Ping</span><span class="token punctuation">(</span>esUrl<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token comment">// Handle error</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// Elasticsearch returned with code 200 and version 7.9.3</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Elasticsearch returned with code %d and version %s\n"</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> info<span class="token punctuation">.</span>Version<span class="token punctuation">.</span>Number<span class="token punctuation">)</span><span class="token comment">// ç›´æ¥æ‰“å°å‡º es ç‰ˆæœ¬å·</span>esVersion<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">ElasticsearchVersion</span><span class="token punctuation">(</span>esUrl<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// Elasticsearch version 7.9.3</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Elasticsearch version %s\n"</span><span class="token punctuation">,</span> esVersion<span class="token punctuation">)</span><span class="token comment">// åˆ é™¤ç´¢å¼•</span><span class="token comment">// testDeleteIndex()</span><span class="token comment">// åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»º</span>err <span class="token operator">=</span> <span class="token function">CreateIndexIfNotExists</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> RcpGoodsImgChecksESMapping<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç®€å•å°è£…çš„ä¸€äº›å¸¸è§æ–¹æ³•"><a href="#ç®€å•å°è£…çš„ä¸€äº›å¸¸è§æ–¹æ³•" class="headerlink" title="ç®€å•å°è£…çš„ä¸€äº›å¸¸è§æ–¹æ³•"></a>ç®€å•å°è£…çš„ä¸€äº›å¸¸è§æ–¹æ³•</h2><h3 id="åˆ›å»º-es-è¿æ¥"><a href="#åˆ›å»º-es-è¿æ¥" class="headerlink" title="åˆ›å»º es è¿æ¥"></a>åˆ›å»º es è¿æ¥</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ConnectES åˆ›å»º es è¿æ¥</span><span class="token keyword">func</span> <span class="token function">ConnectES</span><span class="token punctuation">(</span>options <span class="token operator">...</span>elastic<span class="token punctuation">.</span>ClientOptionFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>once<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// client, err := elastic.NewClient(elastic.SetSniff(false), elastic.SetURL("http://127.0.0.1:9200"))</span><span class="token keyword">var</span> err <span class="token builtin">error</span>ESClient<span class="token punctuation">,</span> err <span class="token operator">=</span> elastic<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span>options<span class="token operator">...</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Ping</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>PingResult<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ç´¢å¼•ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºç´¢å¼•"><a href="#ç´¢å¼•ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºç´¢å¼•" class="headerlink" title="ç´¢å¼•ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºç´¢å¼•"></a>ç´¢å¼•ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºç´¢å¼•</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// CreateIndexIfNotExists ç´¢å¼•ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºç´¢å¼•</span><span class="token comment">// index ç´¢å¼•åç§°</span><span class="token comment">// mapping æ•°æ®ç±»å‹</span><span class="token keyword">func</span> <span class="token function">CreateIndexIfNotExists</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> mapping <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>exists<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">IndexExists</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> exists <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span>info<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">CreateIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BodyString</span><span class="token punctuation">(</span>mapping<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token comment">// info, err := ESClient.CreateIndex(index).Do(ctx)  // å¦‚æœåªæ˜¯æƒ³åˆ›å»ºç´¢å¼•æ—¶ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ BodyString() æ–¹æ³•</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token operator">!</span>info<span class="token punctuation">.</span>Acknowledged <span class="token punctuation">{</span><span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"ES åˆ›å»ºç´¢å¼• [%s] å¤±è´¥"</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// DeleteIndex åˆ é™¤ç´¢å¼•</span><span class="token comment">// index ç´¢å¼•åç§°</span><span class="token keyword">func</span> <span class="token function">DeleteIndex</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>IndicesDeleteResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>info<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">DeleteIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token operator">!</span>info<span class="token punctuation">.</span>Acknowledged <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"ES åˆ é™¤ç´¢å¼• [%s] å¤±è´¥"</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> info<span class="token punctuation">,</span> err<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å•æ¡æ·»åŠ "><a href="#å•æ¡æ·»åŠ " class="headerlink" title="å•æ¡æ·»åŠ "></a>å•æ¡æ·»åŠ </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// CreateDoc å•æ¡æ·»åŠ </span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// id æ–‡æ¡£ idï¼ˆå¯ä»¥ç›´æ¥ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå½“å®å‚ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œes ä¼šä¸»åŠ¨éšæœºç”Ÿæˆï¼‰</span><span class="token comment">// body éœ€è¦æ·»åŠ çš„å†…å®¹</span><span class="token keyword">func</span> <span class="token function">CreateDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>IndexResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>client <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">""</span> <span class="token operator">!=</span> id <span class="token punctuation">{</span>client <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">BodyJson</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å•æ¡æ›´æ–°"><a href="#å•æ¡æ›´æ–°" class="headerlink" title="å•æ¡æ›´æ–°"></a>å•æ¡æ›´æ–°</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// UpdateDoc å•æ¡æ›´æ–°</span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// id è®°å½• id</span><span class="token comment">// body éœ€è¦æ›´æ–°çš„å†…å®¹ ï¼ˆå»ºè®®åªä½¿ç”¨ map[string]interface{} è¿›è¡Œæ›´æ–°æŒ‡å®šå­—æ®µä¸”éœ€è¦æ³¨æ„ map ä¸­çš„ key éœ€è¦å’Œ es ä¸­çš„ key å®Œå…¨åŒ¹é…ï¼Œå¦åˆ™ es ä¼šè®¤ä¸ºæ–°å¢å­—æ®µï¼Œä¸è¦ä½¿ç”¨ struct å¦åˆ™ä¼šå°†æŸäº›å€¼åˆå§‹åŒ–é›¶å€¼ï¼‰</span><span class="token keyword">func</span> <span class="token function">UpdateDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>UpdateResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="headerlink" title="åˆ é™¤æ–‡æ¡£"></a>åˆ é™¤æ–‡æ¡£</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// DeleteDoc åˆ é™¤æ–‡æ¡£</span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// id éœ€è¦åˆ é™¤çš„æ–‡æ¡£è®°å½• id</span><span class="token keyword">func</span> <span class="token function">DeleteDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>DeleteResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰¹é‡æ·»åŠ "><a href="#æ‰¹é‡æ·»åŠ " class="headerlink" title="æ‰¹é‡æ·»åŠ "></a>æ‰¹é‡æ·»åŠ </h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// CreateBulkDoc æ‰¹é‡æ·»åŠ </span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// ids éœ€è¦æ–°å»ºçš„ id æ•°ç»„ï¼ˆå¯ä»¥ä¸ºç©ºçš„å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼‰</span><span class="token comment">// body éœ€è¦æ·»åŠ çš„å†…å®¹</span><span class="token comment">// éœ€è¦æ³¨æ„ï¼šids å’Œ body çš„é¡ºåºè¦ä¸€ä¸€å¯¹åº”</span><span class="token keyword">func</span> <span class="token function">CreateBulkDoc</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">,</span> ids <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>BulkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>bulkRequest <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Bulk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> body <span class="token punctuation">{</span>tmp <span class="token operator">:=</span> vdoc <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBulkIndexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>doc <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>ids<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>bulkRequest <span class="token operator">=</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰¹é‡æ›´æ–°"><a href="#æ‰¹é‡æ›´æ–°" class="headerlink" title="æ‰¹é‡æ›´æ–°"></a>æ‰¹é‡æ›´æ–°</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// UpdateBulkDoc æ‰¹é‡æ›´æ–°</span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// ids éœ€è¦æ›´æ–°çš„ id æ•°ç»„</span><span class="token comment">// body éœ€è¦æ›´æ–°çš„ id å¯¹åº”çš„æ•°æ® ï¼ˆå»ºè®®åªä½¿ç”¨ []map[string]interface{} è¿›è¡Œæ›´æ–°æŒ‡å®šå­—æ®µä¸”éœ€è¦æ³¨æ„ map ä¸­çš„ key éœ€è¦å’Œ es ä¸­çš„ key å®Œå…¨åŒ¹é…ï¼Œå¦åˆ™ es ä¼šè®¤ä¸ºæ–°å¢å­—æ®µï¼Œä¸è¦ä½¿ç”¨ struct å¦åˆ™ä¼šå°†æŸäº›å€¼åˆå§‹åŒ–é›¶å€¼ï¼‰</span><span class="token comment">// éœ€è¦æ³¨æ„ï¼šids å’Œ body çš„é¡ºåºè¦ä¸€ä¸€å¯¹åº”</span><span class="token keyword">func</span> <span class="token function">UpdateBulkDoc</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">,</span> ids <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> body <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>BulkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>bulkRequest <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Bulk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> body <span class="token punctuation">{</span>tmp <span class="token operator">:=</span> vdoc <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBulkUpdateRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>ids<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DocAsUpsert</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>bulkRequest <span class="token operator">=</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰¹é‡åˆ é™¤"><a href="#æ‰¹é‡åˆ é™¤" class="headerlink" title="æ‰¹é‡åˆ é™¤"></a>æ‰¹é‡åˆ é™¤</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// DeleteBulkDoc æ‰¹é‡åˆ é™¤</span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// ids éœ€è¦åˆ é™¤çš„ id æ•°ç»„</span><span class="token keyword">func</span> <span class="token function">DeleteBulkDoc</span><span class="token punctuation">(</span>index <span class="token builtin">string</span><span class="token punctuation">,</span> ids <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>BulkResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>bulkRequest <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Bulk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> ids <span class="token punctuation">{</span>tmp <span class="token operator">:=</span> vreq <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBulkDeleteRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>bulkRequest <span class="token operator">=</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> bulkRequest<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€šè¿‡æ–‡æ¡£-id-å–å‡ºæ•°æ®"><a href="#é€šè¿‡æ–‡æ¡£-id-å–å‡ºæ•°æ®" class="headerlink" title="é€šè¿‡æ–‡æ¡£ id å–å‡ºæ•°æ®"></a>é€šè¿‡æ–‡æ¡£ id å–å‡ºæ•°æ®</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// FirstDoc é€šè¿‡ id å–å‡ºæ•°æ®</span><span class="token comment">// index ç´¢å¼•</span><span class="token comment">// id éœ€è¦å–çš„æ–‡æ¡£è®°å½• id</span><span class="token keyword">func</span> <span class="token function">FirstDoc</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>elastic<span class="token punctuation">.</span>GetResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> ESClient<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰“å°å‡ºæŸ¥è¯¢æ¡ä»¶"><a href="#æ‰“å°å‡ºæŸ¥è¯¢æ¡ä»¶" class="headerlink" title="æ‰“å°å‡ºæŸ¥è¯¢æ¡ä»¶"></a>æ‰“å°å‡ºæŸ¥è¯¢æ¡ä»¶</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">PrintQuery</span><span class="token punctuation">(</span>src <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹æ‰“å°å‚æ•° ====&gt;"</span><span class="token punctuation">)</span>data<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æ‰“å°å‚æ•°ç»“æŸ ====&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æŸ¥è¯¢å‡ºæ•°æ®"><a href="#æŸ¥è¯¢å‡ºæ•°æ®" class="headerlink" title="æŸ¥è¯¢å‡ºæ•°æ®"></a>æŸ¥è¯¢å‡ºæ•°æ®</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">querySearch</span><span class="token punctuation">(</span>query elastic<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> querySrc<span class="token punctuation">,</span> err <span class="token operator">:=</span> query<span class="token punctuation">.</span><span class="token function">Source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">PrintQuery</span><span class="token punctuation">(</span>querySrc<span class="token punctuation">)</span><span class="token punctuation">}</span>queryRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º %v \n"</span><span class="token punctuation">,</span> queryRet<span class="token punctuation">.</span><span class="token function">TotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> queryRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span><span class="token keyword">var</span> tmp RcpGoodsImgChecksESjson<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•æ–¹æ³•"><a href="#æµ‹è¯•æ–¹æ³•" class="headerlink" title="æµ‹è¯•æ–¹æ³•"></a>æµ‹è¯•æ–¹æ³•</h3><h4 id="åˆ é™¤ç´¢å¼•-1"><a href="#åˆ é™¤ç´¢å¼•-1" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åˆ é™¤ç´¢å¼•</span>deleteIndexRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DeleteIndex</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// deleteIndexRet  ==&gt; &amp;{Acknowledged:true}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"deleteIndexRet  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteIndexRet<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ›å»ºæ–‡æ¡£"><a href="#åˆ›å»ºæ–‡æ¡£" class="headerlink" title="åˆ›å»ºæ–‡æ¡£"></a>åˆ›å»ºæ–‡æ¡£</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testCreateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åˆ›å»ºæ–‡æ¡£</span>now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>createDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">,</span> RcpGoodsImgChecksES<span class="token punctuation">{</span>AppName<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>GoodsId<span class="token punctuation">:</span>     <span class="token string">"alex111"</span><span class="token punctuation">,</span>SiteId<span class="token punctuation">:</span>      <span class="token number">18</span><span class="token punctuation">,</span>CheckStatus<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// CreateDoc ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:1 Result:created Shards:0xc00020c2c0 SeqNo:0 PrimaryTerm:1 Status:0 ForcedRefresh:false}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"CreateDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> createDocRet<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡æ–‡æ¡£-id-çš„å½¢å¼æ›´æ–°æ–‡æ¡£"><a href="#é€šè¿‡æ–‡æ¡£-id-çš„å½¢å¼æ›´æ–°æ–‡æ¡£" class="headerlink" title="é€šè¿‡æ–‡æ¡£ id çš„å½¢å¼æ›´æ–°æ–‡æ¡£"></a>é€šè¿‡æ–‡æ¡£ id çš„å½¢å¼æ›´æ–°æ–‡æ¡£</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// é€šè¿‡æ–‡æ¡£ id çš„å½¢å¼æ›´æ–°æ–‡æ¡£</span>updateDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">UpdateDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"check_status"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"updated_at"</span><span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// UpdateDoc ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:2 Result:updated Shards:0xc0002bc280 SeqNo:1 PrimaryTerm:1 Status:0 ForcedRefresh:false GetResult:&lt;nil&gt;}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"UpdateDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateDocRet<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡-Script-æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œå€ŸåŠ©æ–‡æ¡£-id-æ›´æ–°ï¼‰"><a href="#é€šè¿‡-Script-æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œå€ŸåŠ©æ–‡æ¡£-id-æ›´æ–°ï¼‰" class="headerlink" title="é€šè¿‡ Script æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œå€ŸåŠ©æ–‡æ¡£ id æ›´æ–°ï¼‰"></a>é€šè¿‡ Script æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œå€ŸåŠ©æ–‡æ¡£ id æ›´æ–°ï¼‰</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateDocScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// é€šè¿‡ Script æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œå€ŸåŠ©æ–‡æ¡£ id æ›´æ–°ï¼‰</span>updateDocScript<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Id</span><span class="token punctuation">(</span><span class="token string">"2_18_alex111"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Script</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewScript</span><span class="token punctuation">(</span><span class="token string">"ctx._source.site_id=11"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// updateDocScript  ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:3 Result:updated Shards:0xc000098280 SeqNo:2 PrimaryTerm:1 Status:0 ForcedRefresh:false GetResult:&lt;nil&gt;}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"updateDocScript  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateDocScript<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡æ¡ä»¶-Script-æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶æ‰¹é‡æ›´æ–°å­—æ®µï¼‰"><a href="#é€šè¿‡æ¡ä»¶-Script-æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶æ‰¹é‡æ›´æ–°å­—æ®µï¼‰" class="headerlink" title="é€šè¿‡æ¡ä»¶ Script æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶æ‰¹é‡æ›´æ–°å­—æ®µï¼‰"></a>é€šè¿‡æ¡ä»¶ Script æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶æ‰¹é‡æ›´æ–°å­—æ®µï¼‰</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateDocScriptQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// é€šè¿‡æ¡ä»¶ Script æ–¹å¼æ›´æ–°æ–‡æ¡£ï¼ˆå•å­—æ®µæ›´æ–°ï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶æ‰¹é‡æ›´æ–°å­—æ®µï¼‰</span>updateDocScriptQuery<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">UpdateByQuery</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"alex111"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Script</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewScript</span><span class="token punctuation">(</span><span class="token string">"ctx._source.check_status=23"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ProceedOnVersionConflict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// updateDocScriptQuery  ==&gt; &amp;{Header:map[] Took:47 SliceId:&lt;nil&gt; TimedOut:false Total:2 Updated:2 Created:0 Deleted:0 Batches:1 VersionConflicts:0 Noops:0 Retries:{Bulk:0 Search:0} Throttled: ThrottledMillis:0 RequestsPerSecond:-1 Canceled: ThrottledUntil: ThrottledUntilMillis:0 Failures:[]}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"updateDocScriptQuery  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateDocScriptQuery<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡æ–‡æ¡£-id-æŸ¥æ‰¾æ–‡æ¡£"><a href="#é€šè¿‡æ–‡æ¡£-id-æŸ¥æ‰¾æ–‡æ¡£" class="headerlink" title="é€šè¿‡æ–‡æ¡£ id æŸ¥æ‰¾æ–‡æ¡£"></a>é€šè¿‡æ–‡æ¡£ id æŸ¥æ‰¾æ–‡æ¡£</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testFirstDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// é€šè¿‡æ–‡æ¡£ id æŸ¥æ‰¾æ–‡æ¡£</span>firstDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">FirstDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> firstDocRet<span class="token punctuation">.</span>Found <span class="token punctuation">{</span> <span class="token comment">// è¡¨ç¤ºæ‰¾åˆ°äº†æ•°æ®</span><span class="token comment">// FirstDoc ==&gt;  &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Uid: Routing: Parent: Version:0xc000282a10 SeqNo:0xc000282a18 PrimaryTerm:0xc000282a20 Source:[123 34 97 112 112 95 110 97 109 101 34 58 50 44 34 117 112 100 97 116 101 100 95 97 116 34 58 49 54 54 48 53 55 57 52 56 54 44 34 115 105 116 101 95 105 100 34 58 49 56 44 34 103 111 111 100 115 95 105 100 34 58 34 97 108 101 120 49 49 49 34 44 34 99 114 101 97 116 101 100 95 97 116 34 58 49 54 54 48 53 55 57 52 56 54 44 34 99 104 101 99 107 95 115 116 97 116 117 115 34 58 50 51 125] Found:true Fields:map[] Error:&lt;nil&gt;} Source: {"app_name":2,"updated_at":1660579486,"site_id":18,"goods_id":"alex111","created_at":1660579486,"check_status":23}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"FirstDoc ==&gt;  %+v Source: %+v \n\n"</span><span class="token punctuation">,</span> firstDocRet<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>firstDocRet<span class="token punctuation">.</span>Source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡æ–‡æ¡£-id-åˆ é™¤æ–‡æ¡£"><a href="#é€šè¿‡æ–‡æ¡£-id-åˆ é™¤æ–‡æ¡£" class="headerlink" title="é€šè¿‡æ–‡æ¡£ id åˆ é™¤æ–‡æ¡£"></a>é€šè¿‡æ–‡æ¡£ id åˆ é™¤æ–‡æ¡£</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// é€šè¿‡æ–‡æ¡£ id åˆ é™¤æ–‡æ¡£</span>deleteDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DeleteDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token string">"2_18_alex111"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// DeleteDoc  ==&gt; &amp;{Index:rcp_goods_img_checks Type:_doc Id:2_18_alex111 Version:6 Result:deleted Shards:0xc00007e2c0 SeqNo:7 PrimaryTerm:1 Status:0 ForcedRefresh:false}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"DeleteDoc  ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteDocRet<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‰¹é‡åˆ›å»º"><a href="#æ‰¹é‡åˆ›å»º" class="headerlink" title="æ‰¹é‡åˆ›å»º"></a>æ‰¹é‡åˆ›å»º</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testCreateBulkDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// æ‰¹é‡åˆ›å»º</span>createBulkDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateBulkDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"h1"</span><span class="token punctuation">,</span> <span class="token string">"h2"</span><span class="token punctuation">,</span> <span class="token string">"h3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>RcpGoodsImgChecksES<span class="token punctuation">{</span>AppName<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>GoodsId<span class="token punctuation">:</span>     <span class="token string">"h1_goods_id"</span><span class="token punctuation">,</span>SiteId<span class="token punctuation">:</span>      <span class="token number">17</span><span class="token punctuation">,</span>CheckStatus<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>RcpGoodsImgChecksES<span class="token punctuation">{</span>AppName<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span>GoodsId<span class="token punctuation">:</span>     <span class="token string">"h2_goods_id"</span><span class="token punctuation">,</span>SiteId<span class="token punctuation">:</span>      <span class="token number">19</span><span class="token punctuation">,</span>CheckStatus<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>RcpGoodsImgChecksES<span class="token punctuation">{</span>AppName<span class="token punctuation">:</span>     <span class="token number">3</span><span class="token punctuation">,</span>GoodsId<span class="token punctuation">:</span>     <span class="token string">"h3_goods_id"</span><span class="token punctuation">,</span>SiteId<span class="token punctuation">:</span>      <span class="token number">19</span><span class="token punctuation">,</span>CheckStatus<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>CreatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>UpdatedAt<span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// CreateBulkDoc ==&gt; &amp;{Took:5 Errors:false Items:[map[index:0xc00019c200] map[index:0xc00019c280] map[index:0xc00019c300]]}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"CreateBulkDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> createBulkDocRet<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‰¹é‡æ›´æ–°-1"><a href="#æ‰¹é‡æ›´æ–°-1" class="headerlink" title="æ‰¹é‡æ›´æ–°"></a>æ‰¹é‡æ›´æ–°</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testUpdateBulkDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æ‰¹é‡æ›´æ–°</span>updateBulkDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">UpdateBulkDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"h1"</span><span class="token punctuation">,</span> <span class="token string">"h3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"check_status"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"updated_at"</span><span class="token punctuation">:</span>   <span class="token function">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"site_id"</span><span class="token punctuation">:</span>    <span class="token number">20</span><span class="token punctuation">,</span><span class="token string">"updated_at"</span><span class="token punctuation">:</span> <span class="token function">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// UpdateBulkDoc ==&gt; &amp;{Took:6 Errors:false Items:[map[update:0xc0001e2080] map[update:0xc0001e2100]]}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"UpdateBulkDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> updateBulkDocRet<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡æ–‡æ¡£-id-æ‰¹é‡åˆ é™¤"><a href="#é€šè¿‡æ–‡æ¡£-id-æ‰¹é‡åˆ é™¤" class="headerlink" title="é€šè¿‡æ–‡æ¡£ id æ‰¹é‡åˆ é™¤"></a>é€šè¿‡æ–‡æ¡£ id æ‰¹é‡åˆ é™¤</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteBulkDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// é€šè¿‡æ–‡æ¡£ id æ‰¹é‡åˆ é™¤</span>deleteBulkDocRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DeleteBulkDoc</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"h2"</span><span class="token punctuation">,</span> <span class="token string">"h3_goods_id"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"DeleteBulkDoc ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteBulkDocRet<span class="token punctuation">)</span><span class="token comment">// DeleteBulkDoc ==&gt; &amp;{Took:36 Errors:false Items:[map[delete:0xc0000ea080] map[delete:0xc0000ea100]]}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æŒ‰ç…§æ¡ä»¶åˆ é™¤"><a href="#æŒ‰ç…§æ¡ä»¶åˆ é™¤" class="headerlink" title="æŒ‰ç…§æ¡ä»¶åˆ é™¤"></a>æŒ‰ç…§æ¡ä»¶åˆ é™¤</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testDeleteByQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æŒ‰ç…§æ¡ä»¶åˆ é™¤</span>deleteDocByQuery<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">DeleteByQuery</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewRangeQuery</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lte</span><span class="token punctuation">(</span><span class="token number">1660579923</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"deleteDocByQuery ==&gt; %+v \n\n"</span><span class="token punctuation">,</span> deleteDocByQuery<span class="token punctuation">)</span><span class="token comment">// deleteDocByQuery ==&gt; &amp;{Header:map[] Took:36 SliceId:&lt;nil&gt; TimedOut:false Total:3 Updated:0 Created:0 Deleted:3 Batches:1 VersionConflicts:0 Noops:0 Retries:{Bulk:0 Search:0} Throttled: ThrottledMillis:0 RequestsPerSecond:-1 Canceled: ThrottledUntil: ThrottledUntilMillis:0 Failures:[]}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="term"><a href="#term" class="headerlink" title="term"></a>term</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testTermQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// term</span>query1 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query1<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "term": {</span><span class="token comment">//    "goods_id": "h2_goods_id"</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 1</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="terms"><a href="#terms" class="headerlink" title="terms"></a>terms</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testTermsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// terms [where goods_id in ('h3_goods_id', 'h2_goods_id')]</span>query2 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewTermsQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"h3_goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">}</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query2<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "terms": {</span><span class="token comment">//    "goods_id": [</span><span class="token comment">//      "h3_goods_id",</span><span class="token comment">//      "h2_goods_id"</span><span class="token comment">//    ]</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 2</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="range-èŒƒå›´æŸ¥æ‰¾"><a href="#range-èŒƒå›´æŸ¥æ‰¾" class="headerlink" title="range èŒƒå›´æŸ¥æ‰¾"></a>range èŒƒå›´æŸ¥æ‰¾</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testRangeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// èŒƒå›´æŸ¥æ‰¾ [where updated_at &gt;= 0 and updated_at &lt;= 1659695758]</span><span class="token comment">// Gtï¼ˆå¤§äºï¼‰ã€Ltï¼ˆå°äºï¼‰ã€Gteï¼ˆå¤§äºç­‰äºï¼‰ã€Lteï¼ˆå°äºç­‰äºï¼‰</span>query3 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewRangeQuery</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lte</span><span class="token punctuation">(</span><span class="token number">1659695758</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query3<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "range": {</span><span class="token comment">//    "updated_at": {</span><span class="token comment">//      "from": 0,</span><span class="token comment">//      "include_lower": true,</span><span class="token comment">//      "include_upper": true,</span><span class="token comment">//      "to": 1659695758</span><span class="token comment">//    }</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 0</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match-all"><a href="#match-all" class="headerlink" title="match_all"></a>match_all</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// match_all</span>query4 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query4<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "match_all": {}</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 4</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; 2_19_alex111</span><span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:18 CheckStatus:23 CreatedAt:1660579517 UpdatedAt:1660579517}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h1</span><span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match"><a href="#match" class="headerlink" title="match"></a>match</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// match</span>query5 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query5<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "match": {</span><span class="token comment">//    "goods_id": {</span><span class="token comment">//      "query": "h2_goods_id"</span><span class="token comment">//    }</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 1</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match-phrase"><a href="#match-phrase" class="headerlink" title="match_phrase"></a>match_phrase</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchPhraseQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// match_phrase</span>query6 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchPhraseQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_goods_id"</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query6<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "match_phrase": {</span><span class="token comment">//    "goods_id": {</span><span class="token comment">//      "query": "h2_goods_id"</span><span class="token comment">//    }</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 1</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="match-phrase-prefix"><a href="#match-phrase-prefix" class="headerlink" title="match_phrase_prefix"></a>match_phrase_prefix</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMatchPhrasePrefixQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// match_phrase_prefix</span><span class="token comment">// è¿™é‡Œå› ä¸ºç±»å‹ä¸æ”¯æŒå‰ç¼€åŒ¹é…ï¼Œå¯èƒ½ä¼šç›´æ¥æŠ¥é”™</span>query7 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewMatchPhrasePrefixQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h2_"</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query7<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testRegexpQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// regexp</span><span class="token comment">// æœç´¢ goods_id å­—æ®µå¯¹åº”çš„å€¼ä»¥ `h` å¼€å¤´çš„æ‰€æœ‰æ–‡æ¡£</span>query8 <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewRegexpQuery</span><span class="token punctuation">(</span><span class="token string">"goods_id"</span><span class="token punctuation">,</span> <span class="token string">"h.*"</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>query8<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "regexp": {</span><span class="token comment">//    "goods_id": {</span><span class="token comment">//      "value": "h.*"</span><span class="token comment">//    }</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 3</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h1</span><span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="bool-ç»„åˆæŸ¥è¯¢"><a href="#bool-ç»„åˆæŸ¥è¯¢" class="headerlink" title="bool ç»„åˆæŸ¥è¯¢"></a>bool ç»„åˆæŸ¥è¯¢</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testBoolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// ç»„åˆæŸ¥è¯¢</span>boolQuery <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewBoolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// must</span>boolQuery<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"check_status"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// should</span>boolQuery<span class="token punctuation">.</span><span class="token function">Should</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"app_name"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// must_not</span>boolQuery<span class="token punctuation">.</span><span class="token function">MustNot</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewTermQuery</span><span class="token punctuation">(</span><span class="token string">"site_id"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// filter</span>boolQuery<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>elastic<span class="token punctuation">.</span><span class="token function">NewRangeQuery</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lte</span><span class="token punctuation">(</span><span class="token number">1660579923</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">querySearch</span><span class="token punctuation">(</span>boolQuery<span class="token punctuation">)</span><span class="token comment">// å¼€å§‹æ‰“å°å‚æ•° ====&gt;</span><span class="token comment">// {</span><span class="token comment">//  "bool": {</span><span class="token comment">//    "filter": {</span><span class="token comment">//      "range": {</span><span class="token comment">//        "updated_at": {</span><span class="token comment">//          "from": 0,</span><span class="token comment">//          "include_lower": true,</span><span class="token comment">//          "include_upper": true,</span><span class="token comment">//          "to": 1660579923</span><span class="token comment">//        }</span><span class="token comment">//      }</span><span class="token comment">//    },</span><span class="token comment">//    "must": {</span><span class="token comment">//      "term": {</span><span class="token comment">//        "check_status": 2</span><span class="token comment">//      }</span><span class="token comment">//    },</span><span class="token comment">//    "must_not": {</span><span class="token comment">//      "term": {</span><span class="token comment">//        "site_id": 18</span><span class="token comment">//      }</span><span class="token comment">//    },</span><span class="token comment">//    "should": {</span><span class="token comment">//      "term": {</span><span class="token comment">//        "app_name": 20</span><span class="token comment">//      }</span><span class="token comment">//    }</span><span class="token comment">//  }</span><span class="token comment">// }</span><span class="token comment">// æ‰“å°å‚æ•°ç»“æŸ ====&gt;</span><span class="token comment">// æŸ¥è¯¢åˆ°çš„ç»“æœæ€»æ•°ä¸º 2</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h1</span><span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// å·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶æ’åº"><a href="#åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶æ’åº" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶æ’åº"></a>åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶æ’åº</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testPageSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶æ’åº</span><span class="token comment">// from ä¸ºèµ·å§‹åç§»é‡ï¼ˆoffsetï¼‰é»˜è®¤ä¸º 0ï¼Œsize ä¸ºæ¯é¡µæ˜¾ç¤ºæ•°ï¼ˆlimitï¼‰é»˜è®¤ä¸º 10</span><span class="token comment">// from ç­‰äºå½“å‰é¡µç æ•°å‡å»ä¸€çš„å•†ç„¶åä¹˜ä»¥æ¯é¡µæ˜¾ç¤ºæ•°</span><span class="token comment">// Sort() ç¬¬äºŒä¸ªå‚æ•°ï¼Œtrue ä¸ºå‡åºã€false ä¸ºé™åº</span>pageRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token string">"updated_at"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> pageRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span><span class="token keyword">var</span> tmp RcpGoodsImgChecksESjson<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"åˆ†é¡µæŸ¥è¯¢ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// åˆ†é¡µæŸ¥è¯¢ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h1</span><span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// åˆ†é¡µæŸ¥è¯¢ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// åˆ†é¡µæŸ¥è¯¢ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token comment">//</span><span class="token comment">// åˆ†é¡µæŸ¥è¯¢ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; 2_19_alex111</span><span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:18 CheckStatus:23 CreatedAt:1660579517 UpdatedAt:1660579517}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¤šå­—æ®µæ’åº"><a href="#å¤šå­—æ®µæ’åº" class="headerlink" title="å¤šå­—æ®µæ’åº"></a>å¤šå­—æ®µæ’åº</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testMultiFieldSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¤šå­—æ®µæ’åº</span>sortsBuilders <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>elastic<span class="token punctuation">.</span>Sorter<span class="token punctuation">{</span>elastic<span class="token punctuation">.</span><span class="token function">NewFieldSort</span><span class="token punctuation">(</span><span class="token string">"check_status"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å‡åº</span>elastic<span class="token punctuation">.</span><span class="token function">NewFieldSort</span><span class="token punctuation">(</span><span class="token string">"created_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// é™åº</span><span class="token punctuation">}</span>sortRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SortBy</span><span class="token punctuation">(</span>sortsBuilders<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> sortRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span><span class="token keyword">var</span> tmp RcpGoodsImgChecksESjson<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å¤šå­—æ®µæ’åºï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å¤šå­—æ®µæ’åºï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h1</span><span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:17 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// å¤šå­—æ®µæ’åºï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:20 CheckStatus:2 CreatedAt:1660579860 UpdatedAt:1660579923}</span><span class="token comment">//</span><span class="token comment">// å¤šå­—æ®µæ’åºï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:19 CheckStatus:4 CreatedAt:1660579860 UpdatedAt:1660579860}</span><span class="token comment">//</span><span class="token comment">// å¤šå­—æ®µæ’åºï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; 2_19_alex111</span><span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:18 CheckStatus:23 CreatedAt:1660579517 UpdatedAt:1660579517}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¿”å›æŒ‡å®šå­—æ®µï¼ˆåªæŸ¥è¯¢æŒ‡å®šå­—æ®µï¼‰"><a href="#è¿”å›æŒ‡å®šå­—æ®µï¼ˆåªæŸ¥è¯¢æŒ‡å®šå­—æ®µï¼‰" class="headerlink" title="è¿”å›æŒ‡å®šå­—æ®µï¼ˆåªæŸ¥è¯¢æŒ‡å®šå­—æ®µï¼‰"></a>è¿”å›æŒ‡å®šå­—æ®µï¼ˆåªæŸ¥è¯¢æŒ‡å®šå­—æ®µï¼‰</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testFetchSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// è¿”å›æŒ‡å®šå­—æ®µ</span>includeFields <span class="token operator">:=</span> elastic<span class="token punctuation">.</span><span class="token function">NewFetchSourceContext</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"app_name"</span><span class="token punctuation">,</span> <span class="token string">"goods_id"</span><span class="token punctuation">}</span><span class="token operator">...</span><span class="token punctuation">)</span>includeRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FetchSourceContext</span><span class="token punctuation">(</span>includeFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> includeRet<span class="token punctuation">.</span>Hits<span class="token punctuation">.</span>Hits <span class="token punctuation">{</span><span class="token keyword">var</span> tmp RcpGoodsImgChecksESjson<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Source<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tmp<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è¿”å›æŒ‡å®šå­—æ®µï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; %+v \n %+v \n\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// è¿”å›æŒ‡å®šå­—æ®µï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; 2_19_alex111</span><span class="token comment">// {AppName:2 GoodsId:alex111 SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span><span class="token comment">//</span><span class="token comment">// è¿”å›æŒ‡å®šå­—æ®µï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h2</span><span class="token comment">// {AppName:1 GoodsId:h2_goods_id SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span><span class="token comment">//</span><span class="token comment">// è¿”å›æŒ‡å®šå­—æ®µï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h1</span><span class="token comment">// {AppName:2 GoodsId:h1_goods_id SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span><span class="token comment">//</span><span class="token comment">// è¿”å›æŒ‡å®šå­—æ®µï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; h3</span><span class="token comment">// {AppName:3 GoodsId:h3_goods_id SiteId:0 CheckStatus:0 CreatedAt:0 UpdatedAt:0}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æŸ¥è¯¢æ•°æ®æ€»æ•°"><a href="#æŸ¥è¯¢æ•°æ®æ€»æ•°" class="headerlink" title="æŸ¥è¯¢æ•°æ®æ€»æ•°"></a>æŸ¥è¯¢æ•°æ®æ€»æ•°</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">testTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æŸ¥è¯¢æ€»å‘½ä¸­è®¡æ•°</span>total<span class="token punctuation">,</span> err <span class="token operator">:=</span> ESClient<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>RcpGoodsImgChecksESIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// æŸ¥è¯¢æ€»å‘½ä¸­è®¡æ•°ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; 2</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"æŸ¥è¯¢æ€»å‘½ä¸­è®¡æ•°ï¼Œå·²ç»å‘½ä¸­æŸ¥è¯¢çš„æ•°æ®ä¸º ==&gt; %+v \n"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker å®‰è£… ElasticSearch å’Œ Kibana</title>
      <link href="posts/2e9eaf3a.html"/>
      <url>posts/2e9eaf3a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-å®‰è£…-ElasticSearch-å’Œ-Kibana"><a href="#Docker-å®‰è£…-ElasticSearch-å’Œ-Kibana" class="headerlink" title="Docker å®‰è£… ElasticSearch å’Œ Kibana"></a>Docker å®‰è£… ElasticSearch å’Œ Kibana</h1><blockquote><p>å®‰è£…çš„æ—¶å€™ï¼ŒElasticSearch å’Œ Kibana çš„ç‰ˆæœ¬ä¸€å®šè¦ä¸€è‡´ã€‚</p></blockquote><h2 id="åˆ›å»ºä¸€ä¸ªç½‘ç»œ"><a href="#åˆ›å»ºä¸€ä¸ªç½‘ç»œ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç½‘ç»œ"></a>åˆ›å»ºä¸€ä¸ªç½‘ç»œ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºä¸€ä¸ªç½‘ç»œ</span><span class="token function">docker</span> network create alex-network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å®‰è£…-ElasticSearch"><a href="#å®‰è£…-ElasticSearch" class="headerlink" title="å®‰è£… ElasticSearch"></a>å®‰è£… ElasticSearch</h2><ul><li>æ‹‰å–é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull elasticsearch:7.9.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ›å»ºå®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®ä¸ºå•èŠ‚ç‚¹ï¼ˆéé›†ç¾¤æ¨¡å¼ï¼‰</span><span class="token comment"># -e "discovery.type=single-node"</span><span class="token comment"># è®¾ç½® es çš„åˆå§‹å†…å­˜å’Œæœ€å¤§å†…å­˜ï¼Œå¦åˆ™å¯¼è‡´è¿‡å¤§å¯åŠ¨ä¸äº† es æˆ–è€… kibana è¿æ¥ es æ—¶ï¼Œå¯¼è‡´ es ç›´æ¥æ­»æœº</span><span class="token comment"># -e ES_JAVA_OPTS="-Xms512m -Xmx512m"</span><span class="token comment"># æŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ•°æ®ç›®å½•</span><span class="token comment"># -v ~/es-data:/usr/share/elasticsearch/data</span><span class="token comment"># æŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„æ’ä»¶ç›®å½•</span><span class="token comment"># -v ~/es-plugins:/usr/share/elasticsearch/plugins</span><span class="token comment"># æŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®š es çš„é…ç½®ç›®å½•</span><span class="token comment"># -v ~/es-config:/usr/share/elasticsearch/config</span><span class="token comment"># æˆæƒé€»è¾‘å·è®¿é—®æƒé™</span><span class="token comment"># --privileged</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> alex-es <span class="token punctuation">\</span><span class="token parameter variable">--net</span> alex-network <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms512m -Xmx512m"</span> <span class="token punctuation">\</span>elasticsearch:7.9.3<span class="token comment"># å¦‚æœè¦æŒ‚è½½ç›®å½•æ—¶ï¼Œå¯èƒ½ä¼šæŠ¥é”™ `Exception in thread "main" java.nio.file.NoSuchFileException: /usr/share/elasticsearch/config/jvm.options`</span><span class="token comment"># è§£å†³æ–¹æ¡ˆæ˜¯ï¼šå…ˆéšä¾¿åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œç„¶åå°†éšä¾¿åˆ›å»ºçš„å®¹å™¨çš„é…ç½®æ–‡ä»¶å…ˆå¤åˆ¶ä¸€ä»½åˆ°å®¿æœºä¸Šï¼Œç„¶ååˆ é™¤æ‰è¿™ä¸ªå®¹å™¨ï¼Œé‡æ–°å†åˆ›å»ºå®¹å™¨ï¼Œæ¯”å¦‚ï¼Œå¦‚ä¸‹æ­¥éª¤</span><span class="token comment"># 1. å…ˆéšä¾¿åˆ›å»ºä¸€ä¸ªå®¹å™¨</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> es_service_1 <span class="token punctuation">\</span><span class="token parameter variable">--net</span> alex-network <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms512m -Xmx512m"</span> <span class="token punctuation">\</span>elasticsearch:7.9.3<span class="token comment"># 2. ç„¶åå¤åˆ¶è¯¥å®¹å™¨çš„é…ç½®æ–‡ä»¶åˆ°å®¿æœºä¸Š</span><span class="token function">docker</span> <span class="token function">cp</span> <span class="token punctuation">{</span>es_service_1_container_id<span class="token punctuation">}</span>:/usr/share/elasticsearch/config/ ~/es-config<span class="token comment"># 3. ç„¶åå†åˆ é™¤åˆ°è¿™ä¸ªä¸´æ—¶å®¹å™¨</span><span class="token function">docker</span> <span class="token function">rm</span> es_service_1<span class="token comment"># 4. æœ€åå†æºå¸¦æŒ‚è½½å‚æ•°åˆ›å»ºæ–°å®¹å™¨</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> es_service_1 <span class="token punctuation">\</span><span class="token parameter variable">--net</span> alex-network <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms512m -Xmx512m"</span> <span class="token punctuation">\</span><span class="token parameter variable">-v</span> ~/es-data:/usr/share/elasticsearch/data <span class="token punctuation">\</span><span class="token parameter variable">-v</span> ~/es-plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span><span class="token parameter variable">-v</span> ~/es-config:/usr/share/elasticsearch/config <span class="token punctuation">\</span><span class="token parameter variable">--privileged</span> <span class="token parameter variable">-u</span> root <span class="token punctuation">\</span>elasticsearch:7.9.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼–è¾‘ es çš„é…ç½®æ–‡ä»¶</span><span class="token function">vi</span> /usr/share/elasticsearch/config/elasticsearch.yml<span class="token comment"># å¦‚æœéœ€è¦è§£å†³è·¨åŸŸé—®é¢˜ï¼Œé‚£ä¹ˆåˆ™åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ å†™å…¥ä»¥ä¸‹å†…å®¹</span>http.cors.enabled: <span class="token boolean">true</span>http.cors.allow-origin: <span class="token string">"*"</span><span class="token comment"># ç¼–è¾‘ jvm ç›¸å…³é…ç½®</span><span class="token function">vi</span> /usr/share/elasticsearch/config/jvm.options<span class="token comment"># å¦‚æœ es å®¹å™¨è€æ˜¯ä¼šå®•æœºï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è°ƒæ•´ä»¥ä¸‹å‚æ•°</span><span class="token comment"># ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼ˆæŒ‰ç…§è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼‰</span><span class="token parameter variable">-Xms512m</span><span class="token parameter variable">-Xmx512m</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‡ºç°ç‰ˆæœ¬å·å³è¡¨ç¤ºæˆåŠŸ</span><span class="token function">curl</span> <span class="token number">127.0</span>.0.1:9200<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å®‰è£…-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶"><a href="#å®‰è£…-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶" class="headerlink" title="å®‰è£… ik ä¸­æ–‡åˆ†è¯æ’ä»¶"></a>å®‰è£… ik ä¸­æ–‡åˆ†è¯æ’ä»¶</h3><blockquote><p>æ³¨æ„ ik åˆ†è¯æ’ä»¶çš„ç‰ˆæœ¬è¦å’Œ es çš„ç‰ˆæœ¬ä¸€è‡´</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@63d697bd738f elasticsearch<span class="token punctuation">]</span><span class="token comment"># pwd</span>/usr/share/elasticsearch<span class="token punctuation">[</span>root@63d697bd738f elasticsearch<span class="token punctuation">]</span><span class="token comment"># ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.3/elasticsearch-analysis-ik-7.9.3.zip</span>-<span class="token operator">&gt;</span> Installing https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.3/elasticsearch-analysis-ik-7.9.3.zip-<span class="token operator">&gt;</span> Downloading https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.3/elasticsearch-analysis-ik-7.9.3.zip<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">]</span> <span class="token number">100</span>%??@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     WARNING: plugin requires additional permissions     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@* java.net.SocketPermission * connect,resolveSee http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html<span class="token keyword">for</span> descriptions of what these permissions allow and the associated risks.Continue with installation? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>y-<span class="token operator">&gt;</span> Installed analysis-ik<span class="token punctuation">[</span>root@63d697bd738f elasticsearch<span class="token punctuation">]</span><span class="token comment"># ./bin/elasticsearch-plugin list</span>analysis-ik<span class="token punctuation">[</span>root@63d697bd738f elasticsearch<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…-Kibana"><a href="#å®‰è£…-Kibana" class="headerlink" title="å®‰è£… Kibana"></a>å®‰è£… Kibana</h2><ul><li>æ‹‰å–é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull kibana:7.9.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ›å»ºå®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›¸å…³å‚æ•°</span><span class="token comment"># è®¾ç½® es è¯·æ±‚åœ°å€</span><span class="token comment"># -e ELASTICSEARCH_HOSTS=http://localhost:9200</span><span class="token comment"># è®¾ç½®æ±‰åŒ–</span><span class="token comment"># -e I18N_LOCALE=zh-CN</span><span class="token comment"># è®¾ç½®æ—¶åŒºï¼Œå¦åˆ™æŸ¥è¯¢æ—¶é—´éœ€è¦åŠ  8 ä¸ªå°æ—¶</span><span class="token comment"># -e TZ='Asia/Shanghai'</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> alex-kibana <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">5601</span>:5601 <span class="token punctuation">\</span><span class="token parameter variable">--net</span> alex-network <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://alex-es:9200 <span class="token punctuation">\</span><span class="token parameter variable">-e</span> <span class="token assign-left variable">I18N_LOCALE</span><span class="token operator">=</span>zh-CN <span class="token punctuation">\</span>kibana:7.9.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¹Ÿå¯ä»¥ç›´æ¥å»ç¼–è¾‘ kibana çš„é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span><span class="token function">vi</span> /usr/share/kibana/config/kibana.yml<span class="token comment"># é€‚å½“ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å°† alex-es å®¹å™¨å’Œ alex-kibana å®¹å™¨åŒæ—¶éƒ½åŠ å…¥åˆ°äº† alex-network ç½‘ç»œä¸­ï¼Œå› æ­¤è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å®¹å™¨åç§°è¿›è¡Œè®¿é—®åˆ°å®¹å™¨å¯¹åº”çš„ IP åœ°å€</span>elasticsearch.hosts: <span class="token punctuation">[</span> <span class="token string">"http://alex-es:9200"</span> <span class="token punctuation">]</span>i18n.locale: zh-CN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æµè§ˆå™¨è¯·æ±‚</span><span class="token number">127.0</span>.0.1:5601<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> ElasticSearch </tag>
            
            <tag> Kibana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–°</title>
      <link href="posts/84fd0244.html"/>
      <url>posts/84fd0244.html</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-ä½¿ç”¨-CASE-WHEN-è¿›è¡Œæ‰¹é‡æ›´æ–°"><a href="#Golang-ä½¿ç”¨-CASE-WHEN-è¿›è¡Œæ‰¹é‡æ›´æ–°" class="headerlink" title="Golang ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–°"></a>Golang ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–°</h1><blockquote><p>è¿™æ˜¯ä½¿ç”¨ <code>Go</code> è¯­è¨€å†™çš„ <code>CASE WHEN</code> æ‹¼æ¥è¯­å¥ï¼Œå¦‚æœéœ€è¦ <code>PHP</code> ç‰ˆæœ¬çš„ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç«  <a href="https://pudongping.github.io/posts/eaf6377d.html">PHP ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–° ï¼ˆå½“å‰åŸºäº laravel ç¼–å†™ï¼‰</a></p></blockquote><h2 id="ä»¥ä¸‹ä»£ç æœ€ç»ˆè¿”å›çš„-sql-è¯­å¥ä¸º"><a href="#ä»¥ä¸‹ä»£ç æœ€ç»ˆè¿”å›çš„-sql-è¯­å¥ä¸º" class="headerlink" title="ä»¥ä¸‹ä»£ç æœ€ç»ˆè¿”å›çš„ sql è¯­å¥ä¸º"></a>ä»¥ä¸‹ä»£ç æœ€ç»ˆè¿”å›çš„ sql è¯­å¥ä¸º</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE articles SET view_count = CASEWHEN id = 180 AND user_id = 5  THEN 11 WHEN id = 181 AND user_id = 15 THEN 22 WHEN id = 182 AND user_id = 11 THEN 33 WHEN id = 183 AND user_id = 1  THEN 44 ELSE view_count END,updated_at = CASEWHEN id = 180 AND user_id = 5  THEN 1653147405 WHEN id = 181 AND user_id = 15 THEN 1653147406 WHEN id = 182 AND user_id = 11 THEN 1653147407 WHEN id = 183 AND user_id = 1  THEN 1653147408 ELSE updated_at END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å°è£…æˆæ–¹æ³•ä¸º"><a href="#å°è£…æˆæ–¹æ³•ä¸º" class="headerlink" title="å°è£…æˆæ–¹æ³•ä¸º"></a>å°è£…æˆæ–¹æ³•ä¸º</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// BatchUpdate ä½¿ç”¨ case when è¿›è¡Œæ‰¹é‡æ›´æ–°</span><span class="token comment">// æœ€ç»ˆæ‰§è¡Œçš„ sql è¯­å¥ä¸ºï¼š</span><span class="token comment">// UPDATE articles SET</span><span class="token comment">// view_count = CASE</span><span class="token comment">//WHEN id = 180 AND user_id = 5  THEN 11</span><span class="token comment">//WHEN id = 181 AND user_id = 15 THEN 22</span><span class="token comment">//WHEN id = 182 AND user_id = 11 THEN 33</span><span class="token comment">//WHEN id = 183 AND user_id = 1  THEN 44</span><span class="token comment">//ELSE view_count END,</span><span class="token comment">// updated_at = CASE</span><span class="token comment">//WHEN id = 180 AND user_id = 5  THEN 1653147405</span><span class="token comment">//WHEN id = 181 AND user_id = 15 THEN 1653147406</span><span class="token comment">//WHEN id = 182 AND user_id = 11 THEN 1653147407</span><span class="token comment">//WHEN id = 183 AND user_id = 1  THEN 1653147408</span><span class="token comment">//ELSE updated_at</span><span class="token comment">// END</span><span class="token comment">//</span><span class="token comment">//</span><span class="token comment">// tableName := "articles"</span><span class="token comment">// where := make(map[string][]int)</span><span class="token comment">// where["id"] = []int{180, 181, 182, 183}</span><span class="token comment">// where["user_id"] = []int{5, 15, 11, 1}</span><span class="token comment">// needUpdateFields := make(map[string][]int)</span><span class="token comment">// needUpdateFields["view_count"] = []int{11, 22, 33, 44}</span><span class="token comment">// needUpdateFields["updated_at"] = []int{1653147405, 1653147405, 1653147405, 1653147405}</span><span class="token keyword">func</span> <span class="token function">BatchUpdate</span><span class="token punctuation">(</span>tableName <span class="token builtin">string</span><span class="token punctuation">,</span> where<span class="token punctuation">,</span> needUpdateFields <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>where<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">len</span><span class="token punctuation">(</span>needUpdateFields<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token comment">// æ‰€æœ‰çš„æ¡ä»¶å­—æ®µæ•°ç»„</span><span class="token keyword">var</span> whereKeys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token keyword">range</span> where <span class="token punctuation">{</span>whereKeys <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>whereKeys<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ç¬¬ä¸€ä¸ª where æ¡ä»¶æ‰€æœ‰çš„å€¼</span>firstWhere <span class="token operator">:=</span> where<span class="token punctuation">[</span>whereKeys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment">// æ‰€æœ‰éœ€è¦æ›´æ–°çš„å­—æ®µæ•°ç»„</span><span class="token keyword">var</span> needUpdateFieldsKeys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token keyword">range</span> needUpdateFields <span class="token punctuation">{</span>needUpdateFieldsKeys <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>needUpdateFieldsKeys<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>firstWhere<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>needUpdateFields<span class="token punctuation">[</span>needUpdateFieldsKeys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æ›´æ–°çš„æ¡ä»¶ä¸æ›´æ–°çš„å­—æ®µå€¼æ•°é‡ä¸ç›¸ç­‰</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token keyword">var</span> s1 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token keyword">range</span> firstWhere <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vv <span class="token operator">:=</span> <span class="token keyword">range</span> whereKeys <span class="token punctuation">{</span>s1 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s = %v AND "</span><span class="token punctuation">,</span> vv<span class="token punctuation">,</span> where<span class="token punctuation">[</span>vv<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// æŒ‰ç…§ where æ¡ä»¶å­—æ®µæ•°é‡åšåˆ‡å‰²</span>whereSize <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>whereKeys<span class="token punctuation">)</span>batches <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">+</span>whereSize<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>whereSize<span class="token punctuation">)</span><span class="token keyword">for</span> whereSize <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token punctuation">{</span>s1<span class="token punctuation">,</span> batches <span class="token operator">=</span> s1<span class="token punctuation">[</span>whereSize<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">append</span><span class="token punctuation">(</span>batches<span class="token punctuation">,</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>whereSize<span class="token punctuation">:</span>whereSize<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>batches <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>batches<span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token keyword">var</span> whereArr <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> batches <span class="token punctuation">{</span>whereArr <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>whereArr<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">TrimSuffix</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"AND "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// æ‹¼æ¥ sql è¯­å¥</span>sqlStr <span class="token operator">:=</span> <span class="token string">""</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> needUpdateFieldsKeys <span class="token punctuation">{</span>str <span class="token operator">:=</span> <span class="token string">""</span><span class="token keyword">for</span> kk<span class="token punctuation">,</span> vv <span class="token operator">:=</span> <span class="token keyword">range</span> whereArr <span class="token punctuation">{</span>str <span class="token operator">+=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">" WHEN %v THEN %v "</span><span class="token punctuation">,</span> vv<span class="token punctuation">,</span> needUpdateFields<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>kk<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>sqlStr <span class="token operator">+=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s = CASE %s ELSE %s END, "</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> str<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å»é™¤æ‰æœ€åé¢çš„é€—å·åŠç©ºæ ¼</span>sqlStr <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSuffix</span><span class="token punctuation">(</span>sqlStr<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span>caseWhenSql <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"UPDATE %s SET %s"</span><span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> sqlStr<span class="token punctuation">)</span><span class="token keyword">return</span> caseWhenSql<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>tableName <span class="token operator">:=</span> <span class="token string">"articles"</span>where <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>where<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">}</span>where<span class="token punctuation">[</span><span class="token string">"user_id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span>needUpdateFields <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>needUpdateFields<span class="token punctuation">[</span><span class="token string">"view_count"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">}</span>needUpdateFields<span class="token punctuation">[</span><span class="token string">"updated_at"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1653147405</span><span class="token punctuation">,</span> <span class="token number">1653147406</span><span class="token punctuation">,</span> <span class="token number">1653147407</span><span class="token punctuation">,</span> <span class="token number">1653147408</span><span class="token punctuation">}</span>sql <span class="token operator">:=</span> <span class="token function">BatchUpdate</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> where<span class="token punctuation">,</span> needUpdateFields<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€èˆ¬ orm éƒ½ä¼šæ”¯æŒåŸç”Ÿ sql æ‰§è¡Œï¼Œåœ¨è¿™é‡Œæˆ‘åªè¿”å›äº†æ‹¼æ¥å¥½çš„ sql è¯­å¥ï¼Œæœ€ååªéœ€è¦å°† sql è¯­å¥æ‹¿å»æ‰§è¡Œå³å¯ã€‚å½“ç„¶ï¼Œå¦‚æœå­—æ®µå€¼ç±»å‹éœ€è¦è°ƒæ•´çš„ï¼Œåˆ™éœ€è¦æŒ‰éœ€è°ƒæ•´ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> æ‰¹é‡æ›´æ–° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin æ¡†æ¶ä¼˜é›…çš„è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°</title>
      <link href="posts/ccb188ca.html"/>
      <url>posts/ccb188ca.html</url>
      
        <content type="html"><![CDATA[<h1 id="Gin-æ¡†æ¶ä¼˜é›…çš„è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°"><a href="#Gin-æ¡†æ¶ä¼˜é›…çš„è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°" class="headerlink" title="Gin æ¡†æ¶ä¼˜é›…çš„è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°"></a>Gin æ¡†æ¶ä¼˜é›…çš„è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°</h1><p>å—¯ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥çœ‹ä»£ç  ^_^</p><p>å°†ä»¥ä¸‹ä»£ç å†™å…¥æŸä¸ª <code>.go</code> æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚ï¼Œæˆ‘è¿™é‡Œå†™å…¥ <code>gin_demo.go</code> æ–‡ä»¶ä¸­ï¼Œç„¶åæ‰§è¡Œ <code>go run gin_demo.go</code></p><h2 id="ä¸»è¦ä»£ç "><a href="#ä¸»è¦ä»£ç " class="headerlink" title="ä¸»è¦ä»£ç "></a>ä¸»è¦ä»£ç </h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"bytes"</span><span class="token string">"encoding/json"</span><span class="token string">"fmt"</span><span class="token string">"io/ioutil"</span><span class="token string">"net/http"</span><span class="token string">"sync"</span><span class="token string">"github.com/gin-gonic/gin"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token string">"/foo"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>inputs<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">RequestInputs</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"msg"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>data <span class="token operator">:=</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"method"</span><span class="token punctuation">:</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Method<span class="token punctuation">,</span><span class="token string">"params"</span><span class="token punctuation">:</span> inputs<span class="token punctuation">,</span><span class="token punctuation">}</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"è¿”å›å€¼ä¸º ====&gt; %#v \n"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":9501"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// RequestInputs è·å–æ‰€æœ‰å‚æ•°</span><span class="token keyword">func</span> <span class="token function">RequestInputs</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">const</span> defaultMemory <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span>contentType <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> <span class="token punctuation">(</span>dataMap  <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>queryMap <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>postMap  <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// @see gin@v1.7.7/binding/query.go ==&gt; func (queryBinding) Bind(req *http.Request, obj interface{})</span><span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>queryMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token string">"application/json"</span> <span class="token operator">==</span> contentType <span class="token punctuation">{</span><span class="token keyword">var</span> bodyBytes <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Body <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>bodyBytes<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Body <span class="token operator">=</span> ioutil<span class="token punctuation">.</span><span class="token function">NopCloser</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>bodyBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// @see gin@v1.7.7/binding/json.go ==&gt; func (jsonBinding) Bind(req *http.Request, obj interface{})</span><span class="token keyword">if</span> c<span class="token punctuation">.</span>Request <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Body <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>postMap<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token punctuation">}</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Body <span class="token operator">=</span> ioutil<span class="token punctuation">.</span><span class="token function">NopCloser</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>bodyBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token string">"multipart/form-data"</span> <span class="token operator">==</span> contentType <span class="token punctuation">{</span><span class="token comment">// @see gin@v1.7.7/binding/form.go ==&gt; func (formMultipartBinding) Bind(req *http.Request, obj interface{})</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">ParseMultipartForm</span><span class="token punctuation">(</span>defaultMemory<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>PostForm <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>postMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>postMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// ParseForm è§£æ URL ä¸­çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶å°†è§£æç»“æœæ›´æ–°åˆ° r.Form å­—æ®µ</span><span class="token comment">// å¯¹äº POST æˆ– PUT è¯·æ±‚ï¼ŒParseForm è¿˜ä¼šå°† body å½“ä½œè¡¨å•è§£æï¼Œ</span><span class="token comment">// å¹¶å°†ç»“æœæ—¢æ›´æ–°åˆ° r.PostForm ä¹Ÿæ›´æ–°åˆ° r.Formã€‚è§£æç»“æœä¸­ï¼Œ</span><span class="token comment">// POST æˆ– PUT è¯·æ±‚ä¸»ä½“è¦ä¼˜å…ˆäº URL æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåŒåå˜é‡ï¼Œä¸»ä½“çš„å€¼åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²çš„å€¼å‰é¢ï¼‰</span><span class="token comment">// @see gin@v1.7.7/binding/form.go ==&gt; func (formBinding) Bind(req *http.Request, obj interface{})</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">ParseMultipartForm</span><span class="token punctuation">(</span>defaultMemory<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">if</span> err <span class="token operator">!=</span> http<span class="token punctuation">.</span>ErrNotMultipart <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>PostForm <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>postMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>postMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>RWMutex<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> queryMap <span class="token punctuation">{</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>dataMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> vmu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> postMap <span class="token punctuation">{</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>dataMap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> vmu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">return</span> dataMap<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><ul><li>get è¯·æ±‚ï¼Œåªæœ‰ query å‚æ•°æ—¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'127.0.0.1:9501/foo?field1=value1&amp;field2=false&amp;field3=12&amp;field4=4.78'</span><span class="token comment"># è¿”å›å€¼ä¸º ====&gt; gin.H{"method":"GET", "params":map[string]interface {}{"field1":"value1", "field2":"false", "field3":"12", "field4":"4.78"}}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>get è¯·æ±‚ï¼Œæœ‰ query å‚æ•°ï¼Œä¸”æœ‰ <code>multipart/form-data</code> å‚æ•°æ—¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> GET <span class="token string">'127.0.0.1:9501/foo?field1=value1&amp;field2=false&amp;field3=12&amp;field4=4.78'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f1="vv1"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f2="vv2"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f3="false"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f4="7.08"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f5="å¼ ä¸‰"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f6="88"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f7[]="hello"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'f7[]="world"'</span> <span class="token punctuation">\</span><span class="token parameter variable">--form</span> <span class="token string">'field1="è¦†ç›–äº† field1"'</span><span class="token comment"># è¿”å›å€¼ä¸º ====&gt; gin.H{"method":"GET", "params":map[string]interface {}{"f1":"vv1", "f2":"vv2", "f3":"false", "f4":"7.08", "f5":"å¼ ä¸‰", "f6":"88", "f7[]":[]string{"hello", "world"}, "field1":"è¦†ç›–äº† field1", "field2":"false", "field3":"12", "field4":"4.78"}}</span><span class="token comment">#{</span><span class="token comment">#   "method": "GET",</span><span class="token comment">#   "params": {</span><span class="token comment">#       "f1": "vv1",</span><span class="token comment">#       "f2": "vv2",</span><span class="token comment">#       "f3": "false",</span><span class="token comment">#       "f4": "7.08",</span><span class="token comment">#       "f5": "å¼ ä¸‰",</span><span class="token comment">#       "f6": "88",</span><span class="token comment">#       "f7[]": [</span><span class="token comment">#           "hello",</span><span class="token comment">#           "world"</span><span class="token comment">#       ],</span><span class="token comment">#       "field1": "è¦†ç›–äº† field1",</span><span class="token comment">#       "field2": "false",</span><span class="token comment">#       "field3": "12",</span><span class="token comment">#       "field4": "4.78"</span><span class="token comment">#   }</span><span class="token comment">#}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>post è¯·æ±‚ï¼Œæ—¢æœ‰ query å‚æ•°ï¼Œä¹Ÿæœ‰ <code>application/x-www-form-urlencoded</code> å‚æ•°æ—¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> POST <span class="token string">'127.0.0.1:9501/foo?field1=value1&amp;field2=false&amp;field3=12&amp;field4=4.78'</span> <span class="token punctuation">\</span><span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/x-www-form-urlencoded'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f1=vv1'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f2=vv2'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f3=false'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f4=7.08'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f5=å¼ ä¸‰'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f6=88'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f7[]=hello'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'f7[]=world'</span> <span class="token punctuation">\</span>--data-urlencode <span class="token string">'field1=è¦†ç›–äº† field1'</span><span class="token comment"># è¿”å›å€¼ä¸º ====&gt; gin.H{"method":"POST", "params":map[string]interface {}{"f1":"vv1", "f2":"vv2", "f3":"false", "f4":"7.08", "f5":"å¼ ä¸‰", "f6":"88", "f7[]":[]string{"hello", "world"}, "field1":"è¦†ç›–äº† field1", "field2":"false", "field3":"12", "field4":"4.78"}}</span><span class="token comment">#{</span><span class="token comment">#   "method": "POST",</span><span class="token comment">#   "params": {</span><span class="token comment">#       "f1": "vv1",</span><span class="token comment">#       "f2": "vv2",</span><span class="token comment">#       "f3": "false",</span><span class="token comment">#       "f4": "7.08",</span><span class="token comment">#       "f5": "å¼ ä¸‰",</span><span class="token comment">#       "f6": "88",</span><span class="token comment">#       "f7[]": [</span><span class="token comment">#           "hello",</span><span class="token comment">#           "world"</span><span class="token comment">#       ],</span><span class="token comment">#       "field1": "è¦†ç›–äº† field1",</span><span class="token comment">#       "field2": "false",</span><span class="token comment">#       "field3": "12",</span><span class="token comment">#       "field4": "4.78"</span><span class="token comment">#   }</span><span class="token comment">#}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>post è¯·æ±‚ï¼Œæ—¢æœ‰ query å‚æ•°ï¼Œä¹Ÿæœ‰ <code>application/json</code> å‚æ•°æ—¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> POST <span class="token string">'127.0.0.1:9501/foo?field1=value1&amp;field2=false&amp;field3=12&amp;field4=4.78'</span> <span class="token punctuation">\</span><span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>--data-raw <span class="token string">'{    "name": "å¼ t",    "account": "",    "introduction": null,    "avatar": "/avatar/2022/05/11/ruQvUHOF-6512bd43d9caa6e02c990b0a82652dca-20220511111053.jpg",    "favorite": [        "football",        "basketball",        "pingpong-ball"    ],    "num": [        1,        5,        8    ],    "books": {        "name": "bookA",        "price": 18.98    },    "students": [        {            "name": "å¼ ä¸‰",            "age": 18,            "height": 180.00        },        {            "name": "æå››",            "age": 24.5,            "height": 165.55        }    ],    "field1": "è¦†ç›–äº† field1"}'</span><span class="token comment"># è¿”å›å€¼ä¸º ====&gt; gin.H{"method":"POST", "params":map[string]interface {}{"account":"", "avatar":"/avatar/2022/05/11/ruQvUHOF-6512bd43d9caa6e02c990b0a82652dca-20220511111053.jpg", "books":map[string]interface {}{"name":"bookA", "price":18.98}, "favorite":[]interface {ootball", "basketball", "pingpong-ball"}, "field1":"è¦†ç›–äº† field1", "field2":"false", "field3":"12", "field4":"4.78", "introduction":interface {}(nil), "name":"å¼ t", "num":[]interface {}{1, 5, 8}, "students":[]interface {}{map[string]interface {}{"age":18, "height", "name":"å¼ ä¸‰"}, map[string]interface {}{"age":24.5, "height":165.55, "name":"æå››"}}}}</span><span class="token comment">#{</span><span class="token comment">#    "method": "POST",</span><span class="token comment">#    "params": {</span><span class="token comment">#        "account": "",</span><span class="token comment">#        "avatar": "/avatar/2022/05/11/ruQvUHOF-6512bd43d9caa6e02c990b0a82652dca-20220511111053.jpg",</span><span class="token comment">#        "books": {</span><span class="token comment">#            "name": "bookA",</span><span class="token comment">#            "price": 18.98</span><span class="token comment">#        },</span><span class="token comment">#        "favorite": [</span><span class="token comment">#            "football",</span><span class="token comment">#            "basketball",</span><span class="token comment">#            "pingpong-ball"</span><span class="token comment">#        ],</span><span class="token comment">#        "field1": "è¦†ç›–äº† field1",</span><span class="token comment">#        "field2": "false",</span><span class="token comment">#        "field3": "12",</span><span class="token comment">#        "field4": "4.78",</span><span class="token comment">#        "introduction": null,</span><span class="token comment">#        "name": "å¼ t",</span><span class="token comment">#        "num": [</span><span class="token comment">#            1,</span><span class="token comment">#            5,</span><span class="token comment">#            8</span><span class="token comment">#        ],</span><span class="token comment">#        "students": [</span><span class="token comment">#            {</span><span class="token comment">#                "age": 18,</span><span class="token comment">#                "height": 180,</span><span class="token comment">#                "name": "å¼ ä¸‰"</span><span class="token comment">#            },</span><span class="token comment">#            {</span><span class="token comment">#                "age": 24.5,</span><span class="token comment">#                "height": 165.55,</span><span class="token comment">#                "name": "æå››"</span><span class="token comment">#            }</span><span class="token comment">#        ]</span><span class="token comment">#    }</span><span class="token comment">#}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šä»£ç é€šè¿‡é˜…è¯» <code>gin</code> æ¡†æ¶ <code>ShouldBind</code> æ–¹æ³•ç»‘å®šå‚æ•°é€»è¾‘ç¼–å†™ã€‚ç»è¿‡ç²—ç•¥æµ‹è¯•ï¼Œå‡å¯ä»¥è·å–æ‰€æœ‰çš„å‚æ•°ï¼Œå¹¶å°†ç»“æœç»‘å®šåˆ° <code>map[string]interface{}</code> ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Golang </tag>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux å’Œ Mac ä¸‹æ—¶é—´æˆ³ä¸æ—¶é—´äº’è½¬</title>
      <link href="posts/fe92d324.html"/>
      <url>posts/fe92d324.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-å’Œ-Mac-ä¸‹æ—¶é—´æˆ³ä¸æ—¶é—´äº’è½¬"><a href="#Linux-å’Œ-Mac-ä¸‹æ—¶é—´æˆ³ä¸æ—¶é—´äº’è½¬" class="headerlink" title="Linux å’Œ Mac ä¸‹æ—¶é—´æˆ³ä¸æ—¶é—´äº’è½¬"></a>Linux å’Œ Mac ä¸‹æ—¶é—´æˆ³ä¸æ—¶é—´äº’è½¬</h1><h2 id="æŸ¥çœ‹å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³"><a href="#æŸ¥çœ‹å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³" class="headerlink" title="æŸ¥çœ‹å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³"></a>æŸ¥çœ‹å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># linux å’Œ mac ä¸‹éƒ½æ˜¯ä¸€æ ·çš„å‘½ä»¤</span><span class="token comment"># eg outputï¼š1650428766</span><span class="token function">date</span> +%s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹æŒ‡å®šæ—¶é—´çš„æ—¶é—´æˆ³"><a href="#æŸ¥çœ‹æŒ‡å®šæ—¶é—´çš„æ—¶é—´æˆ³" class="headerlink" title="æŸ¥çœ‹æŒ‡å®šæ—¶é—´çš„æ—¶é—´æˆ³"></a>æŸ¥çœ‹æŒ‡å®šæ—¶é—´çš„æ—¶é—´æˆ³</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># eg outputï¼š1650427279</span><span class="token comment"># linux ä¸‹ï¼š</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"2022-04-20 12:01:19"</span> +%s<span class="token comment"># mac ä¸‹ï¼š</span><span class="token function">date</span> <span class="token parameter variable">-jf</span> <span class="token string">"%Y-%m-%d %H:%M:%S"</span> <span class="token string">"2022-04-20 12:01:19"</span> <span class="token string">"+%s"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ—¶é—´æˆ³è½¬æ—¶é—´æ ¼å¼"><a href="#æ—¶é—´æˆ³è½¬æ—¶é—´æ ¼å¼" class="headerlink" title="æ—¶é—´æˆ³è½¬æ—¶é—´æ ¼å¼"></a>æ—¶é—´æˆ³è½¬æ—¶é—´æ ¼å¼</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># eg outputï¼š2022-04-20 12:01:19</span><span class="token comment"># linux ä¸‹ï¼š</span><span class="token function">date</span> <span class="token string">"+%Y-%m-%d %H:%M:%S"</span> -d@1650427279<span class="token comment"># mac ä¸‹ï¼š</span><span class="token function">date</span> <span class="token parameter variable">-r</span> <span class="token number">1650427279</span> <span class="token string">"+%Y-%m-%d %H:%M:%S"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®— PHP ç¤ºä¾‹ä»£ç </title>
      <link href="posts/c63afd43.html"/>
      <url>posts/c63afd43.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®—-PHP-ç¤ºä¾‹ä»£ç "><a href="#æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®—-PHP-ç¤ºä¾‹ä»£ç " class="headerlink" title="æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®— PHP ç¤ºä¾‹ä»£ç "></a>æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®— PHP ç¤ºä¾‹ä»£ç </h1><h2 id="æ”¯ä»˜å®-èŠ±å‘—åˆ†æœŸ-è®¡è´¹ç»“æœç¤ºä¾‹"><a href="#æ”¯ä»˜å®-èŠ±å‘—åˆ†æœŸ-è®¡è´¹ç»“æœç¤ºä¾‹" class="headerlink" title="æ”¯ä»˜å®-èŠ±å‘—åˆ†æœŸ-è®¡è´¹ç»“æœç¤ºä¾‹"></a>æ”¯ä»˜å®-èŠ±å‘—åˆ†æœŸ-è®¡è´¹ç»“æœç¤ºä¾‹</h2><blockquote><p>å½“å¤©æ±‡ç‡ä¸ºï¼šæ±‡ç‡ 1 æ—¥å…ƒ = 0.05548 äººæ°‘å¸ã€‚</p></blockquote><p>å•†æˆ·æ‰¿æ‹…æ‰‹ç»­è´¹èŠ±å‘—åˆ†æœŸè´¹ç‡</p><table><thead><tr><th>æœŸæ•°</th><th>è´¹ç‡</th></tr></thead><tbody><tr><td>3</td><td>1.80%</td></tr><tr><td>6</td><td>4.5%</td></tr><tr><td>12</td><td>7.5%</td></tr></tbody></table><p>ç”¨æˆ·æ‰¿æ‹…æ‰‹ç»­è´¹èŠ±å‘—åˆ†æœŸè´¹ç‡</p><table><thead><tr><th>æœŸæ•°</th><th>è´¹ç‡</th></tr></thead><tbody><tr><td>3</td><td>2.30%</td></tr><tr><td>6</td><td>4.50%</td></tr><tr><td>12</td><td>7.50%</td></tr></tbody></table><p>è®¡ç®—ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p><blockquote><p>ä»¥ä¸‹è®¡ç®—ç»“æœç¤ºä¾‹ä»¥ç”¨æˆ·æ‰¿æ‹…æ‰‹ç»­è´¹èŠ±å‘—åˆ†æœŸè´¹ç‡è®¡ç®—å¾—å‡ºã€‚è®¡ç®—æ—¶é—´ä¸ºï¼š2022 å¹´ 1 æœˆ 6 æ—¥ã€‚</p></blockquote><table><thead><tr><th>æœŸæ•°</th><th>æœ¬é‡‘ï¼ˆäººæ°‘å¸ï¼‰</th><th>æœ¬é‡‘ï¼ˆæ—¥å…ƒï¼‰</th><th>æ¯æœˆåº”è¿˜æ¬¾é‡‘é¢ï¼ˆäººæ°‘å¸ï¼Œå•ä½ï¼šå…ƒï¼‰</th><th>æ€»æ‰‹ç»­è´¹ï¼ˆäººæ°‘å¸ï¼Œå•ä½ï¼šå…ƒï¼‰</th><th>æŠ˜ç®—å¹´åŒ–ç‡ï¼ˆå•åˆ©ï¼‰çº¦ä¸º</th></tr></thead><tbody><tr><td>3</td><td>5.45</td><td>98.00</td><td>1.85</td><td>0.13</td><td>13.7%</td></tr><tr><td>3</td><td>3.45</td><td>62.00</td><td>1.17</td><td>0.08</td><td>13.7%</td></tr><tr><td>6</td><td>3.45</td><td>62.00</td><td>0.59</td><td>0.16</td><td>15.3%</td></tr><tr><td>12</td><td>3.45</td><td>62.00</td><td>0.30</td><td>0.26</td><td>13.6%</td></tr><tr><td>3</td><td>1111.11</td><td>20027.00</td><td>378.89</td><td>25.56</td><td>13.7%</td></tr><tr><td>6</td><td>1111.11</td><td>20027.00</td><td>193.51</td><td>50.00</td><td>15.3%</td></tr><tr><td>12</td><td>1111.11</td><td>20027.00</td><td>99.53</td><td>83.33</td><td>13.6%</td></tr><tr><td>3</td><td>123.67</td><td>2229.00</td><td>42.16</td><td>2.84</td><td>13.7%</td></tr><tr><td>6</td><td>123.67</td><td>2229.00</td><td>21.53</td><td>5.57</td><td>15.3%</td></tr><tr><td>12</td><td>123.67</td><td>2229.00</td><td>11.07</td><td>9.28</td><td>13.6%</td></tr></tbody></table><h2 id="æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®—-PHP-ç¤ºä¾‹ä»£ç -1"><a href="#æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®—-PHP-ç¤ºä¾‹ä»£ç -1" class="headerlink" title="æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®— PHP ç¤ºä¾‹ä»£ç "></a>æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸè´¹ç”¨è®¡ç®— PHP ç¤ºä¾‹ä»£ç </h2><blockquote><p>ä»¥ä¸‹ä»£ç æ‘˜æŠ„è‡ª <a href="https://github.com/pudongping/global-pay">pudongping/global-pay è·¨å¢ƒæ”¯ä»˜å® PHP æ”¯ä»˜æ’ä»¶åŒ…</a></p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * document linkï¼š https://opendocs.alipay.com/mini/introduce/antcreditpay-istallment * document linkï¼š https://opendocs.alipay.com/open/277/105952 * * Created by PhpStorm * User: Alex * Date: 2021-08-29 16:03 * E-mail: &lt;276558492@qq.com&gt; */</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HbFqCost</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token constant">USER_ASSUME</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// ç”¨æˆ·æ‰¿æ‹…æ‰‹ç»­è´¹</span>    <span class="token keyword">const</span> <span class="token constant">SELLER_ASSUME</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>  <span class="token comment">// å•†å®¶æ‰¿æ‹…æ‰‹ç»­è´¹</span>    <span class="token keyword">const</span> <span class="token constant">VALIDATE_NPER</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// èŠ±å‘—åˆ†æœŸåˆæ³•çš„åˆ†æœŸæ•°</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token variable">$rate</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">USER_ASSUME</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>            <span class="token number">3</span> <span class="token operator">=&gt;</span> <span class="token number">0.023</span><span class="token punctuation">,</span>            <span class="token number">6</span> <span class="token operator">=&gt;</span> <span class="token number">0.045</span><span class="token punctuation">,</span>            <span class="token number">12</span> <span class="token operator">=&gt;</span> <span class="token number">0.075</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">SELLER_ASSUME</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>            <span class="token number">3</span> <span class="token operator">=&gt;</span> <span class="token number">0.018</span><span class="token punctuation">,</span>            <span class="token number">6</span> <span class="token operator">=&gt;</span> <span class="token number">0.045</span><span class="token punctuation">,</span>            <span class="token number">12</span> <span class="token operator">=&gt;</span> <span class="token number">0.075</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è·å–èŠ±å‘—åˆ†æœŸè®¡è´¹æƒ…å†µ     *     * @param float $totalAmount  æœ¬é‡‘     * @param bool $isShowAll  æ˜¯å¦æ˜¾ç¤ºæ¯ä¸€æœŸçš„è¿˜æ¬¾æ•°     * @param bool $isSellerPercent  æ˜¯å¦å•†å®¶æ‰¿æ‹…æ‰€æœ‰çš„æ‰‹ç»­è´¹     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fetchHbFqCost</span><span class="token punctuation">(</span><span class="token keyword type-hint">float</span> <span class="token variable">$totalAmount</span><span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$isShowAll</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$isSellerPercent</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>    <span class="token punctuation">{</span>        <span class="token variable">$assume</span> <span class="token operator">=</span> <span class="token variable">$isSellerPercent</span> <span class="token operator">?</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">SELLER_ASSUME</span> <span class="token punctuation">:</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">USER_ASSUME</span><span class="token punctuation">;</span>        <span class="token variable">$rates</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$rate</span><span class="token punctuation">[</span><span class="token variable">$assume</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$rates</span> <span class="token keyword">as</span> <span class="token variable">$nper</span> <span class="token operator">=&gt;</span> <span class="token variable">$rate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">calHbFqCost</span><span class="token punctuation">(</span><span class="token variable">$nper</span><span class="token punctuation">,</span> <span class="token variable">$rate</span><span class="token punctuation">,</span> <span class="token variable">$totalAmount</span><span class="token punctuation">,</span> <span class="token variable">$isShowAll</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¡ç®—èŠ±å‘—åˆ†æœŸæ‰‹ç»­è´¹     *     * @param int $nper  æœŸæ•°     * @param float $rate  è´¹ç‡     * @param float $totalAmount  æœ¬é‡‘     * @param bool $showAll  æ˜¯å¦æ˜¾ç¤ºæ¯ä¸€æœŸçš„è¿˜æ¬¾æ•°     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">calHbFqCost</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$nper</span><span class="token punctuation">,</span> <span class="token keyword type-hint">float</span> <span class="token variable">$rate</span><span class="token punctuation">,</span> <span class="token keyword type-hint">float</span> <span class="token variable">$totalAmount</span><span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$showAll</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$totalAmountCent</span> <span class="token operator">=</span> <span class="token function">bcmul</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$totalAmount</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'100'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1. æŠŠé‡‘é¢å•ä½è½¬åŒ–æˆåˆ† cent</span>        <span class="token comment">// ç”¨æˆ·æ¯æœŸæœ¬é‡‘</span>        <span class="token variable">$perAmount</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcdiv</span><span class="token punctuation">(</span><span class="token variable">$totalAmountCent</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$nper</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2. è®¡ç®—æ¯æœŸæœ¬é‡‘ï¼ˆç”¨æ€»é‡‘é¢/æ€»æœŸæ•°ï¼Œç»“æœä»¥åˆ†è¡¨ç¤ºï¼Œå‘ä¸‹å–æ•´ï¼‰</span>        <span class="token comment">// ç”¨æˆ·æ¯æœŸæ‰‹ç»­è´¹</span>        <span class="token variable">$buyerTotalCost</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">float</span><span class="token punctuation">)</span><span class="token function">bcmul</span><span class="token punctuation">(</span><span class="token variable">$totalAmountCent</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$rate</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  2. ç”¨è½¬åŒ–ä¸ºåˆ†åçš„é‡‘é¢ä¹˜ä»¥ä¹°å®¶è´¹ç‡ï¼Œå¾—åˆ°ä»¥åˆ†è¡¨ç¤ºçš„ä¹°å®¶æ€»è´¹ç”¨ï¼ˆæ€»æ‰‹ç»­è´¹ï¼‰</span>        <span class="token variable">$roundTotalCost</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$buyerTotalCost</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">PHP_ROUND_HALF_EVEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3. å¯¹è´¹ç”¨è¿›è¡Œå–æ•´ï¼ˆå–æ•´è§„åˆ™ä¸º ROUND_HALF_EVEN ï¼‰</span>        <span class="token variable">$perCharge</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcdiv</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$roundTotalCost</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$nper</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 4. è®¡ç®—æ¯æœŸè´¹ç”¨ï¼ˆç”¨æ€»è´¹ç”¨/æ€»æœŸæ•°ï¼Œç»“æœä»¥åˆ†è¡¨ç¤ºï¼Œå‘ä¸‹å–æ•´ï¼‰</span>        <span class="token comment">// ç”¨æˆ·æ¯æœŸæ€»è´¹ç”¨</span>        <span class="token variable">$perTotalAmount</span> <span class="token operator">=</span> <span class="token function">bcadd</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$perAmount</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$perCharge</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é‡‘é¢ä»¥ [å…ƒ] ä¸ºå•ä½</span>        <span class="token variable">$perAmountYuan</span> <span class="token operator">=</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcdiv</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$perAmount</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'100'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$perChargeYuan</span> <span class="token operator">=</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcdiv</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$perCharge</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'100'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$perTotalAmountYuan</span> <span class="token operator">=</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcdiv</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$perTotalAmount</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'100'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$buyerTotalCostYuan</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcdiv</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$buyerTotalCost</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'100'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// èŠ±å‘—åˆ†æœŸçš„æ€»æ‰‹ç»­è´¹å®è¡Œâ€œå››èˆäº”å…¥â€çš„åŸåˆ™è¿›è¡Œè®¡ç®—</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'nper'</span> <span class="token operator">=&gt;</span> <span class="token variable">$nper</span><span class="token punctuation">,</span>  <span class="token comment">// æœŸæ•°</span>            <span class="token string single-quoted-string">'total_amount'</span> <span class="token operator">=&gt;</span> <span class="token variable">$totalAmount</span><span class="token punctuation">,</span>  <span class="token comment">// æœ¬é‡‘</span>            <span class="token string single-quoted-string">'total_charge'</span> <span class="token operator">=&gt;</span> <span class="token variable">$buyerTotalCostYuan</span><span class="token punctuation">,</span>  <span class="token comment">// æ€»æ‰‹ç»­è´¹</span>            <span class="token string single-quoted-string">'rate'</span> <span class="token operator">=&gt;</span> <span class="token variable">$rate</span><span class="token punctuation">,</span>  <span class="token comment">// åˆ©ç‡</span>            <span class="token string single-quoted-string">'per_charge'</span> <span class="token operator">=&gt;</span> <span class="token variable">$perChargeYuan</span><span class="token punctuation">,</span>  <span class="token comment">// æ¯æœŸæ‰‹ç»­è´¹</span>            <span class="token string single-quoted-string">'per_amount'</span> <span class="token operator">=&gt;</span> <span class="token variable">$perAmountYuan</span><span class="token punctuation">,</span>  <span class="token comment">// æ¯æœŸæœ¬é‡‘</span>            <span class="token string single-quoted-string">'per_total_amount'</span> <span class="token operator">=&gt;</span> <span class="token variable">$perTotalAmountYuan</span><span class="token punctuation">,</span>  <span class="token comment">// æ¯æœŸæ€»è´¹ç”¨</span>            <span class="token string single-quoted-string">'refund_list'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// è¿˜æ¬¾åˆ—è¡¨</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$showAll</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'refund_list'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getRefundList</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–è¿˜æ¬¾çš„åˆ—è¡¨     *     * @param array $params     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getRefundList</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$params</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$nper</span> <span class="token operator">=</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nper'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// æœŸæ•°</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$nper</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$item</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nper'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$i</span><span class="token punctuation">;</span>  <span class="token comment">// ç¬¬å‡ æœŸ</span>            <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'charge'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'per_charge'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰æœŸæ•°æ‰€éœ€è¦æ”¯ä»˜çš„æ‰‹ç»­è´¹</span>            <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'per_amount'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰æœŸæ•°æ‰€éœ€è¦æ”¯ä»˜çš„æœ¬é‡‘æ•°</span>            <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'current_total_amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'per_total_amount'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰æœŸæ•°æ‰€éœ€è¦æ”¯ä»˜çš„æ€»è´¹ç”¨</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$charges</span> <span class="token operator">=</span> <span class="token function">array_column</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'charge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡ç®—çš„æ‰€æœ‰æ‰‹ç»­è´¹æ€»å’Œ</span>        <span class="token variable">$chargesSum</span> <span class="token operator">=</span> <span class="token function">array_reduce</span><span class="token punctuation">(</span><span class="token variable">$charges</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$carry</span><span class="token punctuation">,</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">bcadd</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$carry</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$amounts</span> <span class="token operator">=</span> <span class="token function">array_column</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'amount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡ç®—çš„æ‰€æœ‰æœ¬é‡‘æ€»å’Œ</span>        <span class="token variable">$amountsSum</span> <span class="token operator">=</span> <span class="token function">array_reduce</span><span class="token punctuation">(</span><span class="token variable">$amounts</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$carry</span><span class="token punctuation">,</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">bcadd</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$carry</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœæ‰€éœ€æ”¯ä»˜çš„æ€»æ‰‹ç»­è´¹å¤§äºè®¡ç®—åçš„æ‰‹ç»­è´¹æ€»å’Œï¼Œé‚£ä¹ˆåˆ™éœ€è¦å°†ç¼ºå°‘çš„æ‰‹ç»­è´¹è¡¥åŠ åˆ°ç¬¬ä¸€æœŸ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'total_charge'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword type-casting">float</span><span class="token punctuation">)</span><span class="token variable">$chargesSum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'charge'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcadd</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'charge'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bcsub</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'total_charge'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$chargesSum</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¦‚æœæ‰€éœ€è¦æ”¯ä»˜çš„æœ¬é‡‘å¤§äºè®¡ç®—åçš„æœ¬é‡‘æ€»å’Œï¼Œé‚£ä¹ˆåˆ™éœ€è¦å°†ç¼ºå°‘çš„æœ¬é‡‘è¡¥åŠ åˆ°ç¬¬ä¸€æœŸ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'total_amount'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword type-casting">float</span><span class="token punctuation">)</span><span class="token variable">$amountsSum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcadd</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'amount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bcsub</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'total_amount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$amountsSum</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// ç¬¬ä¸€æœŸæ‰€éœ€è¦æ”¯ä»˜çš„æ€»é‡‘é¢</span>        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'current_total_amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token function">bcadd</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'charge'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'amount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$istallment</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HbFqCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$istallment</span><span class="token operator">-&gt;</span><span class="token function">fetchHbFqCost</span><span class="token punctuation">(</span><span class="token number">123.67</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Pay </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ”¯ä»˜å®èŠ±å‘—åˆ†æœŸ </tag>
            
            <tag> æ”¯ä»˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•æ˜“ç”¨ä¸”ä¼˜é›…çš„è·¨å¢ƒæ”¯ä»˜ PHP SDK æ‰©å±•åŒ…</title>
      <link href="posts/1c7fe35b.html"/>
      <url>posts/1c7fe35b.html</url>
      
        <content type="html"><![CDATA[<h1 align="center"><a href="https://github.com/pudongping/global-pay">GlobalPay</a></h1><p>æ”¯æŒå›½é™…ç‰ˆæ”¯ä»˜çš„ PHP SDKï¼Œç›®å‰<strong>åªæ”¯æŒæ”¯ä»˜å®å›½é™…ç‰ˆ</strong>ã€‚å› ç›®å‰æ”¯ä»˜å®è·¨å¢ƒåœ¨çº¿æ”¯ä»˜æœåŠ¡åªæ”¯æŒ appã€wapã€web å’ŒæŠ¥å…³è¿™å››ç§ï¼Œæœ¬ SDK æä¾›äº† appã€wapã€web è¿™ä¸‰ç§è·¨å¢ƒæ”¯ä»˜ï¼Œ<a href="https://global.alipay.com/docs/ac/legacy/legacydoc">è¯¦è§å›½é™…æ”¯ä»˜å®å®˜æ–¹æ–‡æ¡£</a> ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">composer</span> require pudongping/global-pay <span class="token parameter variable">-vvv</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul><li>å‘½åè§„èŒƒ</li><li>éšè—å¼€å‘è€…ä¸éœ€è¦å…³æ³¨çš„ç»†ææœ«èŠ‚</li><li>ç¬¦åˆ PSR è§„èŒƒï¼Œå¯ä»¥æ–¹ä¾¿çš„ä¸å„ç§ PHP æ¡†æ¶é›†æˆ</li><li>æœ‰è‰¯å¥½çš„æ–‡æ¡£ï¼ŒåŒ…å«å„ç§ç¤ºä¾‹æ–¹æ³•ä»¥åŠå®˜æ–¹è¿”å›ç»“æœã€‚<a href="https://pudongping.github.io/global-pay-doc">æ–‡æ¡£åœ°å€</a> ï¼š <a href="https://pudongping.github.io/global-pay-doc">https://pudongping.github.io/global-pay-doc</a></li></ul><h2 id="è¿è¡Œç¯å¢ƒ"><a href="#è¿è¡Œç¯å¢ƒ" class="headerlink" title="è¿è¡Œç¯å¢ƒ"></a>è¿è¡Œç¯å¢ƒ</h2><ul><li>PHP &gt;= 7.1.3</li><li>Composer</li></ul><h2 id="æ”¯æŒçš„æ”¯ä»˜æ–¹æ³•"><a href="#æ”¯æŒçš„æ”¯ä»˜æ–¹æ³•" class="headerlink" title="æ”¯æŒçš„æ”¯ä»˜æ–¹æ³•"></a>æ”¯æŒçš„æ”¯ä»˜æ–¹æ³•</h2><h3 id="æ”¯ä»˜å®"><a href="#æ”¯ä»˜å®" class="headerlink" title="æ”¯ä»˜å®"></a>æ”¯ä»˜å®</h3><ul><li>ç”µè„‘æ”¯ä»˜</li><li>æ‰‹æœºç½‘ç«™æ”¯ä»˜</li><li>APP æ”¯ä»˜</li></ul><table><thead><tr><th align="center">method</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">web</td><td align="center">ç”µè„‘æ”¯ä»˜</td></tr><tr><td align="center">wap</td><td align="center">æ‰‹æœºç½‘ç«™æ”¯ä»˜</td></tr><tr><td align="center">app</td><td align="center">APP æ”¯ä»˜</td></tr></tbody></table><h2 id="æ”¯æŒçš„æ–¹æ³•"><a href="#æ”¯æŒçš„æ–¹æ³•" class="headerlink" title="æ”¯æŒçš„æ–¹æ³•"></a>æ”¯æŒçš„æ–¹æ³•</h2><blockquote><p>æ‰€æœ‰ç½‘å…³å‡æ”¯æŒä»¥ä¸‹æ–¹æ³•</p></blockquote><ul><li><p>find(array|string $order)<br><strong>è¯´æ˜ï¼š</strong> æŸ¥æ‰¾è®¢å•æ¥å£<br><strong>å‚æ•°ï¼š</strong> <code>$order</code> ä¸º <code>string</code> ç±»å‹æ—¶ï¼Œè¯·ä¼ å…¥ç³»ç»Ÿè®¢å•å·ï¼Œå¯¹åº”è·¨å¢ƒæ”¯ä»˜å®ä¸­çš„ <code>out_trade_no</code> å‚æ•°ï¼› <code>array</code> ç±»å‹æ—¶ï¼Œå‚æ•°è¯·å‚è€ƒ<a href="https://global.alipay.com/docs/ac/global/single_trade_query_cn">æ”¯ä»˜å®å¢ƒå¤–è®¢å•å•ç¬”æŸ¥è¯¢æ–‡æ¡£</a> ã€‚<br><strong>è¿”å›ï¼š</strong> æŸ¥è¯¢æˆåŠŸï¼Œè¿”å› <code>Illuminate\Support\Collection</code> å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ <code>$collection-&gt;toArray()</code> æˆ–è€… <code>$collection-&gt;all()</code> æˆ–è€… <code>$collection-&gt;get('field')</code> è®¿é—®æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p></li><li><p>refund(array $order)<br><strong>è¯´æ˜ï¼š</strong> é€€æ¬¾æ¥å£<br><strong>å‚æ•°ï¼š</strong>  <code>$order</code> æ•°ç»„æ ¼å¼ï¼Œé€€æ¬¾å‚æ•°è¯·å‚è€ƒ<a href="https://global.alipay.com/docs/ac/global/forex_refund_cn">æ”¯ä»˜å®å¢ƒå¤–é€€æ¬¾æ¥å£æ–‡æ¡£</a> ã€‚<br><strong>è¿”å›ï¼š</strong> é€€æ¬¾æˆåŠŸï¼Œè¿”å› <code>Illuminate\Support\Collection</code> å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ <code>$collection-&gt;toArray()</code> æˆ–è€… <code>$collection-&gt;all()</code> æˆ–è€… <code>$collection-&gt;get('field')</code> è®¿é—®æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p></li><li><p>verify()<br><strong>è¯´æ˜ï¼š</strong> éªŒè¯æœåŠ¡å™¨è¿”å›æ•°æ®æ˜¯å¦åˆæ³•<br><strong>è¿”å›ï¼š</strong> éªŒè¯æˆåŠŸï¼Œè¿”å› <code>Illuminate\Support\Collection</code> å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ <code>$collection-&gt;toArray()</code> æˆ–è€… <code>$collection-&gt;all()</code> æˆ–è€… <code>$collection-&gt;get('field')</code> è®¿é—®æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p></li></ul><h2 id="å…¶ä»–é€šç”¨æ–¹æ³•"><a href="#å…¶ä»–é€šç”¨æ–¹æ³•" class="headerlink" title="å…¶ä»–é€šç”¨æ–¹æ³•"></a>å…¶ä»–é€šç”¨æ–¹æ³•</h2><ul><li><p>getExchangeRate()<br><strong>è¯´æ˜ï¼š</strong> è·å–æ±‡ç‡ã€‚è¯¦è§<a href="https://global.alipay.com/docs/ac/global/forex_rate_file_cn">æ”¯ä»˜å®å¢ƒå¤–æ±‡ç‡æŸ¥è¯¢æ¥å£</a> ã€‚<br><strong>è¿”å›ï¼š</strong> è·å–æˆåŠŸï¼Œè¿”å› <code>Illuminate\Support\Collection</code> å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ <code>$collection-&gt;toArray()</code> æˆ–è€… <code>$collection-&gt;all()</code> æˆ–è€… <code>$collection-&gt;get('field')</code> è®¿é—®æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚<br><strong>æ³¨æ„ï¼š</strong> 1ã€è´§å¸é—´çš„æ±‡ç‡ä¼šåœ¨åŒ—äº¬æ—¶é—´æ¯æ—¥ 9ï¼š00 åˆ° 11:00 é—´å˜åŠ¨ä¸€æ¬¡ï¼›  2ã€æ±‡ç‡æ¯æ—¥è·å–ä¸Šé™ä¸º 100 æ¬¡ã€‚ ï¼ˆå¯èƒ½éœ€è¦è€ƒè™‘é€šè¿‡ç¼“å­˜ä¿å­˜æ±‡ç‡ï¼Œé˜²æ­¢æ¥å£å‡ºç°å¼‚å¸¸ï¼Œå› ä¸ºæœ¬ SDK æ²¡æœ‰åšç¼“å­˜å¤„ç†ï¼‰</p></li><li><p>getHbFqCost(float $totalAmount, bool $isShowAll = false, bool $isSellerPercent = false)<br><strong>è¯´æ˜ï¼š</strong> è·å–èŠ±å‘—åˆ†æœŸè®¡è´¹æƒ…å†µ<br><strong>å‚æ•°ï¼š</strong> <code>$totalAmount</code> ä¸ºåˆ†æœŸçš„æœ¬é‡‘ï¼Œ<code>$isShowAll</code> ä¸ºæ˜¯å¦æ˜¾ç¤ºæ¯ä¸€æœŸçš„è¿˜æ¬¾æ•°ï¼Œ<code>$isSellerPercent</code> ä¸º <code>true</code> è¡¨ç¤ºå•†å®¶æ‰¿æ‹…å…¨éƒ¨æ‰‹ç»­è´¹ï¼Œä¸º <code>false</code> è¡¨ç¤ºç”¨æˆ·æ‰¿æ‹…å…¨éƒ¨æ‰‹ç»­è´¹ã€‚<br><strong>è¿”å›ï¼š</strong> è·å–æˆåŠŸï¼Œè¿”å› <code>Illuminate\Support\Collection</code> å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ <code>$collection-&gt;toArray()</code> æˆ–è€… <code>$collection-&gt;all()</code> æˆ–è€… <code>$collection-&gt;get('field')</code> è®¿é—®æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p></li></ul><p>è¿”å›å‚æ•°è¯´æ˜</p><table><thead><tr><th>å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td>nper</td><td align="center">æœŸæ•°</td></tr><tr><td>total_amount</td><td align="center">æœ¬é‡‘</td></tr><tr><td>total_charge</td><td align="center">æ€»æ‰‹ç»­è´¹</td></tr><tr><td>rate</td><td align="center">åˆ©ç‡</td></tr><tr><td>per_charge</td><td align="center">æ¯æœŸæ‰‹ç»­è´¹</td></tr><tr><td>per_amount</td><td align="center">æ¯æœŸæœ¬é‡‘</td></tr><tr><td>per_total_amount</td><td align="center">æ¯æœŸæ€»è´¹ç”¨</td></tr><tr><td>refund_list</td><td align="center">è¿˜æ¬¾åˆ—è¡¨</td></tr><tr><td>refund_list.nper</td><td align="center">ç¬¬å‡ æœŸ</td></tr><tr><td>refund_list.charge</td><td align="center">å½“å‰æœŸæ•°æ‰€éœ€è¦æ”¯ä»˜çš„æ‰‹ç»­è´¹</td></tr><tr><td>refund_list.amount</td><td align="center">å½“å‰æœŸæ•°æ‰€éœ€è¦æ”¯ä»˜çš„æœ¬é‡‘æ•°</td></tr><tr><td>refund_list.current_total_amount</td><td align="center">å½“å‰æœŸæ•°æ‰€éœ€è¦æ”¯ä»˜çš„æ€»è´¹ç”¨</td></tr></tbody></table><h2 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h2><h3 id="éèŠ±å‘—åˆ†æœŸæ”¯ä»˜"><a href="#éèŠ±å‘—åˆ†æœŸæ”¯ä»˜" class="headerlink" title="éèŠ±å‘—åˆ†æœŸæ”¯ä»˜"></a>éèŠ±å‘—åˆ†æœŸæ”¯ä»˜</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Pudongping<span class="token punctuation">\</span>GlobalPay<span class="token punctuation">\</span>GlobalPay</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Pudongping<span class="token punctuation">\</span>GlobalPay<span class="token punctuation">\</span>Log</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">PayController</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'partner'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'2088000000000000'</span><span class="token punctuation">,</span>  <span class="token comment">// åˆä½œèº«ä»½è€… idï¼Œä»¥ 2088 å¼€å¤´çš„ 16 ä½çº¯æ•°å­—</span>        <span class="token string single-quoted-string">'notify_url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'http://a90b-8-37-43-168.demo.io/index/notify_url'</span><span class="token punctuation">,</span>  <span class="token comment">// å¼‚æ­¥å›è°ƒåœ°å€</span>        <span class="token string single-quoted-string">'return_url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'http://a90b-8-37-43-168.demo.io/index/return_url'</span><span class="token punctuation">,</span>  <span class="token comment">// åŒæ­¥å›è°ƒåœ°å€</span>        <span class="token string single-quoted-string">'refer_url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'https://www.demo.net'</span><span class="token punctuation">,</span>  <span class="token comment">// äºŒçº§å•†æˆ·ç½‘ç«™åœ°å€</span>        <span class="token string single-quoted-string">'seller_email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'xxxx@gmail.com'</span><span class="token punctuation">,</span>  <span class="token comment">// ç­¾çº¦æ”¯ä»˜å®è´¦å·æˆ–å–å®¶æ”¯ä»˜å®å¸æˆ·</span>        <span class="token string single-quoted-string">'key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'xxxx'</span><span class="token punctuation">,</span>  <span class="token comment">// å®‰å…¨æ£€éªŒç ï¼Œä»¥æ•°å­—å’Œå­—æ¯ç»„æˆçš„ 32 ä½å­—ç¬¦</span>        <span class="token string single-quoted-string">'sign_type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'RSA'</span><span class="token punctuation">,</span>  <span class="token comment">// ä¸éœ€è¦ä¿®æ”¹</span>        <span class="token string single-quoted-string">'input_charset'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'UTF-8'</span><span class="token punctuation">,</span>  <span class="token comment">// å•†æˆ·ç½‘ç«™ä½¿ç”¨çš„ç¼–ç æ ¼å¼ï¼Œå»ºè®®ä¸éœ€è¦ä¿®æ”¹</span>        <span class="token string single-quoted-string">'transport'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'http'</span><span class="token punctuation">,</span>  <span class="token comment">// è®¿é—®æ¨¡å¼,æ ¹æ®è‡ªå·±çš„æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ ssl è®¿é—®ï¼Œè‹¥æ”¯æŒè¯·é€‰æ‹© httpsï¼›è‹¥ä¸æ”¯æŒè¯·é€‰æ‹© http</span>        <span class="token string single-quoted-string">'split_fund'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'2088000000000000:0.10'</span><span class="token punctuation">,</span>  <span class="token comment">// æ¥å—åˆ†è´¦èµ„é‡‘çš„æ”¯ä»˜å®è´¦æˆ· ID å’Œæ¯”ä¾‹ï¼Œç”¨é€—å·åˆ†éš”å…¶ä»–å¸å·ä¿¡æ¯ã€‚ID æ˜¯ä»¥ 2088 å¼€å¤´çš„çº¯ 16 ä½æ•°å­—ã€‚</span>        <span class="token string single-quoted-string">'private_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'/Users/pudongping/glory/key/alipay_private_key.pem'</span><span class="token punctuation">,</span>  <span class="token comment">// ç§é’¥è·¯å¾„</span>        <span class="token string single-quoted-string">'public_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'/Users/pudongping/glory/key/alipay_public_key.pem'</span><span class="token punctuation">,</span>  <span class="token comment">// å…¬é’¥è·¯å¾„</span>        <span class="token string single-quoted-string">'log'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">// optional</span>            <span class="token string single-quoted-string">'file'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alipay.log'</span><span class="token punctuation">,</span>  <span class="token comment">// å½“å‰ç›®å½•ä¸‹</span>            <span class="token string single-quoted-string">'level'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'debug'</span><span class="token punctuation">,</span> <span class="token comment">// å»ºè®®ç”Ÿäº§ç¯å¢ƒç­‰çº§è°ƒæ•´ä¸º infoï¼Œå¼€å‘ç¯å¢ƒä¸º debug</span>            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'single'</span><span class="token punctuation">,</span> <span class="token comment">// optional, å¯é€‰ daily.</span>            <span class="token string single-quoted-string">'max_file'</span> <span class="token operator">=&gt;</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// optional, å½“ type ä¸º daily æ—¶æœ‰æ•ˆï¼Œé»˜è®¤ 30 å¤©</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'http'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">// optional</span>            <span class="token string single-quoted-string">'timeout'</span> <span class="token operator">=&gt;</span> <span class="token number">5.0</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'connect_timeout'</span> <span class="token operator">=&gt;</span> <span class="token number">5.0</span><span class="token punctuation">,</span>            <span class="token comment">// æ›´å¤šé…ç½®é¡¹è¯·å‚è€ƒ [Guzzle](https://guzzle-cn.readthedocs.io/zh_CN/latest/request-options.html)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'mode'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'dev'</span><span class="token punctuation">,</span> <span class="token comment">// optional,è®¾ç½®æ­¤å‚æ•°ï¼Œå°†è¿›å…¥æ²™ç®±æ¨¡å¼</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/**     * document link: https://global.alipay.com/docs/ac/web_cn/about     *     * @return mixed     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">web</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'subject'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“ alex '</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'rmb_fee'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'0.20'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'trade_information'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'business_type'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'goods_info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'å¤‰èº«ãƒ™...^1'</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'total_quantity'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// '_only_args' =&gt; true  // åªéœ€è¦è¿”å›å‚æ•°æ¨¡å¼æ—¶å¢åŠ </span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">web</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœè®¾ç½®äº† `_only_args` ä¸º trueï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–æ‰€æœ‰çš„å‚æ•°</span>        <span class="token comment">// var_dump($globalPay-&gt;getContent());</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * document link:  https://global.alipay.com/docs/ac/wap_cn/start     *     * @return mixed     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">wap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'subject'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“ alex '</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'rmb_fee'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'0.10'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'trade_information'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'business_type'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'goods_info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'å¤‰èº«ãƒ™...^1'</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'total_quantity'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// '_only_args' =&gt; true  // åªéœ€è¦è¿”å›å‚æ•°æ¨¡å¼æ—¶å¢åŠ </span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">wap</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœè®¾ç½®äº† `_only_args` ä¸º trueï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–æ‰€æœ‰çš„å‚æ•°</span>        <span class="token comment">// var_dump($globalPay-&gt;getContent());</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * document link: https://global.alipay.com/docs/ac/app_cn/about     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_'</span> <span class="token operator">.</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'subject'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“ 5200'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'rmb_fee'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'1.01'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'trade_information'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'business_type'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'goods_info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'å¤§æµ·ã«ã¦^1'</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'total_quantity'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å•ç¬”æŸ¥è¯¢æ¥å£ document link: https://global.alipay.com/docs/ac/global/single_trade_query_cn     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// out_trade_no å’Œ trade_no å‚æ•°å¯ä»¥åŒæ—¶å«æœ‰ï¼Œä¹Ÿå¯ä»¥äºŒé€‰ä¸€</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_1629950066'</span><span class="token punctuation">,</span>            <span class="token comment">// 'trade_no' =&gt; '2021082622001364941434754996',</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é€€æ¬¾æ¥å£ document linkï¼š https://global.alipay.com/docs/ac/global/forex_refund_cn     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">refund</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_return_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_refund_'</span> <span class="token operator">.</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_1629950066'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'return_rmb_amount'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'1.01'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'reason'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'é€€æ¬¾æµ‹è¯•'</span><span class="token punctuation">,</span>            <span class="token comment">// 'is_sync' =&gt; 'N',  // å¦‚æœ is_sync =&gt; N åˆ™å¼€å¯å¼‚æ­¥é€šçŸ¥ï¼Œå¦åˆ™ä¸å¼€å¯å¼‚æ­¥é€šçŸ¥ï¼Œä¸å¼€å¯å¼‚æ­¥é€šçŸ¥ notify_url å‚æ•°å°†ä¼šå¤±æ•ˆï¼ˆä¸éœ€è¦å¼€å¯æ—¶ï¼Œåˆ™ä¸éœ€è¦è®¾ç½®ï¼‰</span>            <span class="token comment">// 'notify_url' =&gt; 'http://api.demo.com:8016/v2/alipay/forexNotify',  // $order['notify_url'] è®¾ç½®äº†ï¼Œåˆ™ä½¿ç”¨ $order['notify_url'] çš„å€¼ï¼Œå¦åˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ notify_url å‚æ•°</span>            <span class="token comment">// 'type' =&gt; 'pc',  // å¦‚æœæ˜¯ç½‘ç«™æ”¯ä»˜ï¼Œåˆ™éœ€è¦è®¾ç½® type å‚æ•°ä¸º pcï¼Œæ‰‹æœºæµè§ˆå™¨æˆ–æ”¯ä»˜å®é’±åŒ…æ”¯ä»˜æ—¶ï¼Œä¸éœ€è¦è®¾ç½®</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">refund</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åŒæ­¥éªŒç­¾     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¼‚æ­¥éªŒç­¾     *     * @return mixed     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// éªŒç­¾</span>            <span class="token comment">// å»ºè®®å¿…é¡»å¯¹ä»¥ä¸‹å‡ ä¸ªå‚æ•°è¿›è¡Œä¸šåŠ¡é€»è¾‘éªŒè¯</span>            <span class="token variable">$outTradeNo</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'out_trade_no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å•†æˆ·éœ€è¦éªŒè¯è¯¥é€šçŸ¥æ•°æ®ä¸­çš„ out_trade_no æ˜¯å¦ä¸ºå•†æˆ·ç³»ç»Ÿä¸­åˆ›å»ºçš„è®¢å•å·ã€‚</span>            <span class="token variable">$tradeStatus</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'trade_status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åœ¨æ”¯ä»˜å®çš„ä¸šåŠ¡é€šçŸ¥ä¸­ï¼Œåªæœ‰äº¤æ˜“é€šçŸ¥çŠ¶æ€ä¸º TRADE_FINISHED æ—¶ï¼Œæ”¯ä»˜å®æ‰ä¼šè®¤å®šä¸ºä¹°å®¶ä»˜æ¬¾æˆåŠŸã€‚</span>            <span class="token variable">$totalFee</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'total_fee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¯¥ç¬”è®¢å•çš„æ€»é‡‘é¢ã€‚è¯·æ±‚æ—¶å¯¹åº”çš„å‚æ•°ï¼ŒåŸæ ·é€šçŸ¥å›æ¥ã€‚ï¼ˆå¤–å¸é‡‘é¢ï¼‰</span>            <span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'GlobalPay Notify ===&gt; '</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$exception</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¼‚æ­¥é€šçŸ¥å¼‚å¸¸ ===&gt; '</span> <span class="token operator">.</span> <span class="token variable">$exception</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…¶ä»–æ¡†æ¶</span>            <span class="token comment">// return $globalPay-&gt;fail();  // Laravel æ¡†æ¶å¯ä»¥ç›´æ¥è¿™æ ·</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…¶ä»–æ¡†æ¶</span>        <span class="token comment">// return $globalPay-&gt;success();  //  Laravel æ¡†æ¶å¯ä»¥ç›´æ¥è¿™æ ·</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–æ±‡ç‡     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getExchangeRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getExchangeRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="èŠ±å‘—åˆ†æœŸæ”¯ä»˜"><a href="#èŠ±å‘—åˆ†æœŸæ”¯ä»˜" class="headerlink" title="èŠ±å‘—åˆ†æœŸæ”¯ä»˜"></a>èŠ±å‘—åˆ†æœŸæ”¯ä»˜</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Pudongping<span class="token punctuation">\</span>GlobalPay<span class="token punctuation">\</span>GlobalPay</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Pudongping<span class="token punctuation">\</span>GlobalPay<span class="token punctuation">\</span>Log</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HbfqPayController</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">web</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'subject'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“ alex'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'rmb_fee'</span> <span class="token operator">=&gt;</span> <span class="token number">5.45</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'trade_information'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'business_type'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'goods_info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“è´¹ç”¨^1'</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'total_quantity'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'hb_fq_param'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>                <span class="token string single-quoted-string">'num'</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">// èŠ±å‘—åˆ†æœŸåˆ†æœŸæ•°ï¼Œåªæ”¯æŒ 3ã€6ã€12 æœŸ</span>                <span class="token comment">// åªæœ‰ is_has_household ä¸º trueï¼Œ is_seller_percent æ‰èƒ½è®¾ç½®ä¸º true</span>                <span class="token string single-quoted-string">'is_has_household'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦æ‹¥æœ‰å‡ºèµ„æˆ·ï¼Œåªæœ‰æ‹¥æœ‰å‡ºèµ„æˆ·ï¼Œå•†å®¶æ‰èƒ½è´´æ¯ï¼Œå¦åˆ™åªèƒ½ç”¨æˆ·è´´æ¯</span>                <span class="token string single-quoted-string">'is_seller_percent'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦å•†å®¶è´´æ¯</span>                <span class="token comment">// èŠ±å‘—åˆ†æœŸå¼€å¯è®¢å•ä¼ å‚è´´æ¯æ´»åŠ¨ï¼ˆä¸æ”¯æŒ PC æ”¯ä»˜ï¼Œæ— è®ºæ˜¯å›½é™…è¿˜æ˜¯å›½å†…çš„äº¤æ˜“éƒ½ä¸æ”¯æŒï¼‰</span>                <span class="token comment">// å› æ­¤ç›¸æ¯” app æ”¯ä»˜ï¼Œä¸èƒ½ä¼ é€’ is_order_subsidy å‚æ•°</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment">// '_only_args' =&gt; true  // åªéœ€è¦è¿”å›å‚æ•°æ¨¡å¼æ—¶å¢åŠ </span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">web</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœè®¾ç½®äº† `_only_args` ä¸º trueï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–æ‰€æœ‰çš„å‚æ•°</span>        <span class="token comment">// var_dump($globalPay-&gt;getContent());</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">wap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'subject'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“ alex'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'rmb_fee'</span> <span class="token operator">=&gt;</span> <span class="token number">5.45</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'trade_information'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'business_type'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'goods_info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“è´¹ç”¨^1'</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'total_quantity'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'hb_fq_param'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>                <span class="token string single-quoted-string">'num'</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">// èŠ±å‘—åˆ†æœŸåˆ†æœŸæ•°ï¼Œåªæ”¯æŒ 3ã€6ã€12 æœŸ</span>                <span class="token comment">// åªæœ‰ is_has_household ä¸º trueï¼Œ is_seller_percent æ‰èƒ½è®¾ç½®ä¸º true</span>                <span class="token string single-quoted-string">'is_has_household'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦æ‹¥æœ‰å‡ºèµ„æˆ·ï¼Œåªæœ‰æ‹¥æœ‰å‡ºèµ„æˆ·ï¼Œå•†å®¶æ‰èƒ½è´´æ¯ï¼Œå¦åˆ™åªèƒ½ç”¨æˆ·è´´æ¯</span>                <span class="token string single-quoted-string">'is_seller_percent'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦å•†å®¶è´´æ¯</span>                <span class="token comment">// èŠ±å‘—åˆ†æœŸå¼€å¯è®¢å•ä¼ å‚è´´æ¯æ´»åŠ¨ï¼ˆä¸æ”¯æŒ PC æ”¯ä»˜ï¼Œæ— è®ºæ˜¯å›½é™…è¿˜æ˜¯å›½å†…çš„äº¤æ˜“éƒ½ä¸æ”¯æŒï¼‰</span>                <span class="token comment">// å› æ­¤ç›¸æ¯” app æ”¯ä»˜ï¼Œä¸èƒ½ä¼ é€’ is_order_subsidy å‚æ•°</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment">// '_only_args' =&gt; true  // åªéœ€è¦è¿”å›å‚æ•°æ¨¡å¼æ—¶å¢åŠ </span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">wap</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœè®¾ç½®äº† `_only_args` ä¸º trueï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–æ‰€æœ‰çš„å‚æ•°</span>        <span class="token comment">// var_dump($globalPay-&gt;getContent());</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'subject'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“ alex'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'rmb_fee'</span> <span class="token operator">=&gt;</span> <span class="token number">3.45</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'trade_information'</span> <span class="token operator">=&gt;</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token string single-quoted-string">'business_type'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'goods_info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'äº¤æ˜“è´¹ç”¨^1'</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'total_quantity'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'hb_fq_param'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>                <span class="token string single-quoted-string">'num'</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">// èŠ±å‘—åˆ†æœŸåˆ†æœŸæ•°ï¼Œåªæ”¯æŒ 3ã€6ã€12 æœŸ</span>                <span class="token comment">// åªæœ‰ is_has_household ä¸º trueï¼Œ is_seller_percent æ‰èƒ½è®¾ç½®ä¸º trueï¼Œå¦åˆ™ is_seller_percent åªèƒ½è®¾ç½®ä¸º false</span>                <span class="token string single-quoted-string">'is_has_household'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦æ‹¥æœ‰å‡ºèµ„æˆ·ï¼Œåªæœ‰æ‹¥æœ‰å‡ºèµ„æˆ·ï¼Œå•†å®¶æ‰èƒ½è´´æ¯ï¼Œå¦åˆ™åªèƒ½ç”¨æˆ·è´´æ¯</span>                <span class="token string single-quoted-string">'is_seller_percent'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦å•†å®¶è´´æ¯ï¼Œ true ä¸ºå•†å®¶è´´æ¯ï¼Œ false ä¸ºç”¨æˆ·è´´æ¯</span>                <span class="token string single-quoted-string">'is_order_subsidy'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦å¼€å¯è®¢å•ä¼ å‚è´´æ¯æ´»åŠ¨</span>                <span class="token comment">// å‡ºèµ„æˆ·è´´æ¯å’Œè®¢å•ä¼ å‚è´´æ¯åªèƒ½å…è®¸ä¸€ä¸ªä¸º true</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// out_trade_no å’Œ trade_no å‚æ•°å¯ä»¥åŒæ—¶å«æœ‰ï¼Œä¹Ÿå¯ä»¥äºŒé€‰ä¸€</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_1629950066'</span><span class="token punctuation">,</span>            <span class="token comment">// 'trade_no' =&gt; '2021082622001364941434754996',</span>            <span class="token string single-quoted-string">'is_hbfq'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// è¯¥ç¬”è®¢å•æ˜¯å¦ä¸ºèŠ±å‘—åˆ†æœŸæ”¯ä»˜ï¼Œè®¢å•æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¼šå«æœ‰ hb_fq_num å‚æ•°ï¼Œä¸æ˜¯èŠ±å‘—åˆ†æœŸè®¢å•åˆ™æ²¡æœ‰è¿™ä¸ªå‚æ•°</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">refund</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// èŠ±å‘—åˆ†æœŸé€€æ¬¾å’ŒéèŠ±å‘—åˆ†æœŸé€€æ¬¾æ“ä½œæµç¨‹ä¸€è‡´</span>        <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'out_return_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_refund_'</span> <span class="token operator">.</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'out_trade_no'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'alex_1629950066'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'return_rmb_amount'</span> <span class="token operator">=&gt;</span> <span class="token number">3.45</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'currency'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'JPY'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'reason'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'é€€æ¬¾æµ‹è¯•'</span><span class="token punctuation">,</span>            <span class="token comment">// 'is_sync' =&gt; 'N',  // å¦‚æœ is_sync =&gt; N åˆ™å¼€å¯å¼‚æ­¥é€šçŸ¥ï¼Œå¦åˆ™ä¸å¼€å¯å¼‚æ­¥é€šçŸ¥ï¼Œä¸å¼€å¯å¼‚æ­¥é€šçŸ¥ notify_url å‚æ•°å°†ä¼šå¤±æ•ˆï¼ˆä¸éœ€è¦å¼€å¯æ—¶ï¼Œåˆ™ä¸éœ€è¦è®¾ç½®ï¼‰</span>            <span class="token comment">// 'notify_url' =&gt; 'http://api.demo.com:8016/v2/alipay/forexNotify',  // $order['notify_url'] è®¾ç½®äº†ï¼Œåˆ™ä½¿ç”¨ $order['notify_url'] çš„å€¼ï¼Œå¦åˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ notify_url å‚æ•°</span>            <span class="token comment">// 'type' =&gt; 'pc',  // å¦‚æœæ˜¯ç½‘ç«™æ”¯ä»˜ï¼Œåˆ™éœ€è¦è®¾ç½® type å‚æ•°ä¸º pcï¼Œæ‰‹æœºæµè§ˆå™¨æˆ–æ”¯ä»˜å®é’±åŒ…æ”¯ä»˜æ—¶ï¼Œä¸éœ€è¦è®¾ç½®</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">refund</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// éªŒç­¾</span>            <span class="token comment">// å»ºè®®å¿…é¡»å¯¹ä»¥ä¸‹å‡ ä¸ªå‚æ•°è¿›è¡Œä¸šåŠ¡é€»è¾‘éªŒè¯</span>            <span class="token variable">$outTradeNo</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'out_trade_no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å•†æˆ·éœ€è¦éªŒè¯è¯¥é€šçŸ¥æ•°æ®ä¸­çš„ out_trade_no æ˜¯å¦ä¸ºå•†æˆ·ç³»ç»Ÿä¸­åˆ›å»ºçš„è®¢å•å·ã€‚</span>            <span class="token variable">$tradeStatus</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'trade_status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åœ¨æ”¯ä»˜å®çš„ä¸šåŠ¡é€šçŸ¥ä¸­ï¼Œåªæœ‰äº¤æ˜“é€šçŸ¥çŠ¶æ€ä¸º TRADE_FINISHED æ—¶ï¼Œæ”¯ä»˜å®æ‰ä¼šè®¤å®šä¸ºä¹°å®¶ä»˜æ¬¾æˆåŠŸã€‚</span>            <span class="token variable">$totalFee</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'total_fee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¯¥ç¬”è®¢å•çš„æ€»é‡‘é¢ã€‚è¯·æ±‚æ—¶å¯¹åº”çš„å‚æ•°ï¼ŒåŸæ ·é€šçŸ¥å›æ¥ã€‚ï¼ˆå¤–å¸é‡‘é¢ï¼‰</span>            <span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'GlobalPay Notify ===&gt; '</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$exception</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¼‚æ­¥é€šçŸ¥å¼‚å¸¸ ===&gt; '</span> <span class="token operator">.</span> <span class="token variable">$exception</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…¶ä»–æ¡†æ¶</span>            <span class="token comment">// return $globalPay-&gt;fail();  // Laravel æ¡†æ¶å¯ä»¥ç›´æ¥è¿™æ ·</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…¶ä»–æ¡†æ¶</span>        <span class="token comment">// return $globalPay-&gt;success();  //  Laravel æ¡†æ¶å¯ä»¥ç›´æ¥è¿™æ ·</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–èŠ±å‘—åˆ†æœŸè®¡è´¹æƒ…å†µ     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getHbFqCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$totalAmount</span> <span class="token operator">=</span> <span class="token number">100.88</span><span class="token punctuation">;</span>        <span class="token comment">// åªéœ€è¦è·å– 3 6 12 æœŸç›¸å¯¹åº”çš„è¿˜æ¬¾æ•°</span>        <span class="token comment">// $globalPay = GlobalPay::alipay($this-&gt;config)-&gt;getHbFqCost($totalAmount);</span>        <span class="token comment">// è·å– 3 6 12 æœŸç›¸å¯¹åº”åˆ°è¿˜æ¬¾æ•°ä¸”æ˜¾ç¤ºå‡ºæ¯ä¸€æœŸçš„è¿˜æ¬¾æƒ…å†µï¼ˆç”¨æˆ·æ‰¿æ‹…æ‰€æœ‰çš„æ‰‹ç»­è´¹ï¼‰</span>        <span class="token comment">// $globalPay = GlobalPay::alipay($this-&gt;config)-&gt;getHbFqCost($totalAmount, true);</span>        <span class="token comment">// è·å– 3 6 12 æœŸç›¸å¯¹åº”åˆ°è¿˜æ¬¾æ•°ä¸”æ˜¾ç¤ºå‡ºæ¯ä¸€æœŸçš„è¿˜æ¬¾æƒ…å†µï¼ˆå•†å®¶æ‰¿æ‹…æ‰€æœ‰çš„æ‰‹ç»­è´¹ï¼‰</span>        <span class="token variable">$globalPay</span> <span class="token operator">=</span> <span class="token class-name static-context">GlobalPay</span><span class="token operator">::</span><span class="token function">alipay</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">config</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getHbFqCost</span><span class="token punctuation">(</span><span class="token variable">$totalAmount</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$globalPay</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="LICENSE"><a href="#LICENSE" class="headerlink" title="LICENSE"></a>LICENSE</h2><p>MIT</p>]]></content>
      
      
      <categories>
          
          <category> Pay </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> æ”¯ä»˜ </tag>
            
            <tag> è·¨å¢ƒæ”¯ä»˜ </tag>
            
            <tag> SDK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperf å¯åŠ¨æœåŠ¡è„šæœ¬ start ã€ status ã€stop ã€restart</title>
      <link href="posts/46a98e74.html"/>
      <url>posts/46a98e74.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hyperf-å¯åŠ¨æœåŠ¡è„šæœ¬-start-ã€-status-ã€stop-ã€restart"><a href="#Hyperf-å¯åŠ¨æœåŠ¡è„šæœ¬-start-ã€-status-ã€stop-ã€restart" class="headerlink" title="Hyperf å¯åŠ¨æœåŠ¡è„šæœ¬ start ã€ status ã€stop ã€restart"></a>Hyperf å¯åŠ¨æœåŠ¡è„šæœ¬ start ã€ status ã€stop ã€restart</h1><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ol><li>åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œåˆ›å»ºæ–°çš„è„šæœ¬æ–‡ä»¶ <code>server.sh</code> ï¼Œå°†ä»¥ä¸‹å†…å®¹å¤åˆ¶è¿›å»</li><li>è®¾ç½®æ‰§è¡Œæƒé™ <code>chmod u+x server.sh</code></li><li>æ‰§è¡Œå‘½ä»¤ <code>./server.sh status</code> å³å¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ hyperf æœåŠ¡çŠ¶æ€</span>./server.sh status<span class="token comment"># å¼€å¯ hyperf æœåŠ¡</span>./server.sh start<span class="token comment"># å…³é—­ hyperf æœåŠ¡</span>./server.sh stop<span class="token comment"># é‡å¯ hyperf æœåŠ¡</span>./server.sh restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è„šæœ¬å†…å®¹å¦‚ä¸‹"><a href="#è„šæœ¬å†…å®¹å¦‚ä¸‹" class="headerlink" title="è„šæœ¬å†…å®¹å¦‚ä¸‹"></a>è„šæœ¬å†…å®¹å¦‚ä¸‹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#!/bin/bash</span><span class="token comment">#Author: Alex</span><span class="token comment">#server manager script based on hyperf 2.2.0</span><span class="token assign-left variable">base_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> `dirname $0`<span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">)</span></span><span class="token assign-left variable">server_file</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${base_path}</span>/bin/hyperf.php"</span><span class="token assign-left variable">pid_path</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${base_path}</span>/runtime/hyperf.pid"</span><span class="token assign-left variable">php_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">which</span> php<span class="token variable">)</span></span><span class="token assign-left variable">env_path</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${base_path}</span>/.env"</span><span class="token assign-left variable">runtime_container</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${base_path}</span>/runtime/container"</span><span class="token builtin class-name">cd</span> <span class="token variable">$base_path</span><span class="token keyword">function</span> <span class="token function-name function">console_blue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[36m[ <span class="token variable">$1</span> ]<span class="token entity" title="\033">\033</span>[0m"</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">console_green</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[32m[ <span class="token variable">$1</span> ]<span class="token entity" title="\033">\033</span>[0m"</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">console_orangered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[31m<span class="token entity" title="\033">\033</span>[01m[ <span class="token variable">$1</span> ]<span class="token entity" title="\033">\033</span>[0m"</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">console_yellow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[33m<span class="token entity" title="\033">\033</span>[01m[ <span class="token variable">$1</span> ]<span class="token entity" title="\033">\033</span>[0m"</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$env_path</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">then</span>    console_orangered <span class="token string">'You should copy the .env.example file and name it .env or create a new file and rename .env'</span>    <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token builtin class-name">source</span> <span class="token string">"<span class="token variable">$env_path</span>"</span><span class="token assign-left variable">project_name</span><span class="token operator">=</span><span class="token variable">${APP_NAME}</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$php_path</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>    console_orangered <span class="token string">'Please check if the PHP has been installed '</span>    <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token keyword">function</span> <span class="token function-name function">master_process_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${pid_path}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">then</span>        <span class="token assign-left variable">hyperf_pid</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $<span class="token punctuation">{</span>pid_path<span class="token punctuation">}</span><span class="token variable">`</span></span>        <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"<span class="token variable">${hyperf_pid}</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span>    <span class="token keyword">fi</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">master_process_name_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"<span class="token variable">${project_name}</span>.Master"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">fetch_server_master_pid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"<span class="token variable">${project_name}</span>.Master"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">force_kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"<span class="token variable">${project_name}</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token operator">&gt;&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">process_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>`master_process_count`<span class="token operator">+</span>`master_process_name_count`<span class="token variable">))</span></span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$process_count</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>        console_yellow <span class="token string">'The server has been stopped !'</span>        <span class="token builtin class-name">exit</span> <span class="token number">0</span>    <span class="token keyword">fi</span>    console_green <span class="token string">"The server is running ! Master pid is <span class="token variable"><span class="token variable">$(</span>fetch_server_master_pid<span class="token variable">)</span></span>"</span>    <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">process_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>`master_process_count`<span class="token operator">+</span>`master_process_name_count`<span class="token variable">))</span></span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$process_count</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>        console_yellow <span class="token string">'The server has been stopped !'</span>        <span class="token builtin class-name">exit</span> <span class="token number">0</span>    <span class="token keyword">fi</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${pid_path}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>        <span class="token function">cat</span> <span class="token string">"<span class="token variable">${pid_path}</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token string">"<span class="token variable">${pid_path}</span>"</span>    <span class="token keyword">fi</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span>master_process_name_count<span class="token variable">)</span></span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>        force_kill    <span class="token keyword">fi</span>    console_green <span class="token string">'The server is stopped !'</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">process_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>`master_process_count`<span class="token operator">+</span>`master_process_name_count`<span class="token variable">))</span></span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$process_count</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>        console_yellow <span class="token string">"The server has been started, Don't need start again ! "</span>        console_blue <span class="token string">"Master pid is : <span class="token variable"><span class="token variable">$(</span>fetch_server_master_pid<span class="token variable">)</span></span> "</span>        <span class="token builtin class-name">exit</span> <span class="token number">0</span>    <span class="token keyword">fi</span>    <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token string">"<span class="token variable">$runtime_container</span>"</span>    console_blue <span class="token string">'Starting now, please just a moment !'</span>    <span class="token comment"># change the parent process to init process</span>    setsid php <span class="token string">"<span class="token variable">${server_file}</span>"</span> start <span class="token operator">&gt;&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>    <span class="token function">sleep</span> <span class="token number">1</span>    console_green <span class="token string">"Started successful !"</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${pid_path}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>        console_blue <span class="token string">"Master pid is : <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $<span class="token punctuation">{</span>pid_path<span class="token punctuation">}</span><span class="token variable">`</span></span> "</span>    <span class="token keyword">fi</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function-name function">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">cat</span> <span class="token operator">&lt;&lt;-</span> <span class="token string">EOF    Usage:        ./server.sh [options]    Options:        stop        Stop server        start       Start server        restart     Restart server        status      Check server status        help        Help documentEOF</span><span class="token punctuation">}</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>  <span class="token string">'stop'</span><span class="token punctuation">)</span>    stop  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">'start'</span><span class="token punctuation">)</span>    start  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">'restart'</span><span class="token punctuation">)</span>    stop    start  <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">'status'</span><span class="token punctuation">)</span>    status  <span class="token punctuation">;</span><span class="token punctuation">;</span>  *<span class="token punctuation">)</span>    <span class="token builtin class-name">help</span>  <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperf </tag>
            
            <tag> Swoole </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperf æ¡†æ¶ä¸­å¼€åç¨‹çš„å‡ ç§æ–¹å¼</title>
      <link href="posts/b5fcf661.html"/>
      <url>posts/b5fcf661.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hyperf-æ¡†æ¶ä¸­å¼€åç¨‹çš„å‡ ç§æ–¹å¼"><a href="#Hyperf-æ¡†æ¶ä¸­å¼€åç¨‹çš„å‡ ç§æ–¹å¼" class="headerlink" title="Hyperf æ¡†æ¶ä¸­å¼€åç¨‹çš„å‡ ç§æ–¹å¼"></a>Hyperf æ¡†æ¶ä¸­å¼€åç¨‹çš„å‡ ç§æ–¹å¼</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * å¼€åç¨‹åšè¯·æ±‚ * * Created by PhpStorm * User: Alex * Date: 2021-09-21 19:22 * E-mail: &lt;276558492@qq.com&gt; */</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Utils<span class="token punctuation">\</span>Parallel</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Utils<span class="token punctuation">\</span>WaitGroup</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Swoole<span class="token punctuation">\</span>Coroutine<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Guzzle<span class="token punctuation">\</span>ClientFactory</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>AutoController</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Contract<span class="token punctuation">\</span>RequestInterface</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Di<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Inject</span><span class="token punctuation">;</span><span class="token comment">/** * @AutoController * Class CoController * @package App\Controller */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CoController</span><span class="token punctuation">{</span>    <span class="token comment">/**     * @Inject     * @var ClientFactory     */</span>    <span class="token keyword">private</span> <span class="token variable">$clientFactory</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ–¹ä¾¿æµ‹è¯•è¶…æ—¶æ“ä½œ     *     * @param RequestInterface $request     * @return mixed     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">sleep</span><span class="token punctuation">(</span><span class="token class-name type-declaration">RequestInterface</span> <span class="token variable">$request</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$seconds</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'seconds'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sleep hello ====&gt; '</span> <span class="token operator">.</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$seconds</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ä½¿ç”¨ Channel åšåç¨‹è¯·æ±‚     *     * @return array     * @throws \GuzzleHttp\Exception\GuzzleException     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$channel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$channel</span><span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$channel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$channel</span><span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$channel</span><span class="token operator">-&gt;</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¬¬ä¸€ä¸ªåç¨‹è¿”å›çš„ç»“æœ</span>        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$channel</span><span class="token operator">-&gt;</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¬¬äºŒä¸ªåç¨‹è¿”å›çš„ç»“æœ</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>  <span class="token comment">// [123, 321]</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ä½¿ç”¨ WaitGroup åšåç¨‹è¯·æ±‚     *     * @return array     * @throws \GuzzleHttp\Exception\GuzzleException     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// é€šè¿‡å­åç¨‹å¹¶è¡Œçš„å‘èµ·å¤šä¸ªè¯·æ±‚å®ç°å¹¶è¡Œè¯·æ±‚</span>        <span class="token variable">$wg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WaitGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$wg</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å› ä¸ºå¼€äº†ä¸¤ä¸ªåç¨‹ï¼Œå› æ­¤å°±è¦æ·»åŠ  2</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$wg</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>            <span class="token variable">$wg</span><span class="token operator">-&gt;</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$wg</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">321</span><span class="token punctuation">;</span>            <span class="token variable">$wg</span><span class="token operator">-&gt;</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$wg</span><span class="token operator">-&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç­‰å¾… add è®¡æ•°å™¨å˜ä¸º 0</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>  <span class="token comment">// [321, 123]</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ä½¿ç”¨ Parallel ç±»ï¼Œåšåç¨‹è¯·æ±‚     *     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$parallel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$parallel</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$parallel</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">321</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$parallel</span><span class="token operator">-&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>  <span class="token comment">// {"foo":123,"bar":321}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ä½¿ç”¨ parallel åŠ©æ‰‹å‡½æ•°ï¼Œåšåç¨‹è¯·æ±‚     *     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>            <span class="token string single-quoted-string">'foo'</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'bar'</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">clientFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1:9516/co/sleep?seconds=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token number">321</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>  <span class="token comment">// {"foo":123,"bar":321}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperf </tag>
            
            <tag> Swoole </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux é¢‘ç¹ä½¿ç”¨å‘½ä»¤</title>
      <link href="posts/6f6880af.html"/>
      <url>posts/6f6880af.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-é¢‘ç¹ä½¿ç”¨å‘½ä»¤"><a href="#Linux-é¢‘ç¹ä½¿ç”¨å‘½ä»¤" class="headerlink" title="Linux é¢‘ç¹ä½¿ç”¨å‘½ä»¤"></a>Linux é¢‘ç¹ä½¿ç”¨å‘½ä»¤</h1><!-- TOC --><ul><li><a href="#date">date</a></li><li><a href="#timedatectl">timedatectl</a></li><li><a href="#reboot">reboot</a></li><li><a href="#poweroff">poweroff</a></li><li><a href="#wget">wget</a></li><li><a href="#ps">ps</a></li><li><a href="#pstree">pstree</a></li><li><a href="#nice">nice</a></li><li><a href="#pidof">pidof</a></li><li><a href="#kill">kill</a></li><li><a href="#killall">killall</a></li><li><a href="#uname">uname</a></li><li><a href="#uptime">uptime</a></li><li><a href="#free">free</a></li><li><a href="#who">who</a></li><li><a href="#last">last</a></li><li><a href="#ping">ping</a></li><li><a href="#tracepath">tracepath</a></li><li><a href="#netstat">netstat</a></li><li><a href="#history">history</a></li><li><a href="#sosreport">sosreport</a></li><li><a href="#find">find</a></li><li><a href="#locate">locate</a></li><li><a href="#whereis">whereis</a></li><li><a href="#which">which</a></li><li><a href="#cat">cat</a></li><li><a href="#more">more</a></li><li><a href="#less">less</a></li><li><a href="#head">head</a></li><li><a href="#tail">tail</a></li><li><a href="#tr">tr</a></li><li><a href="#wc">wc</a></li><li><a href="#stat">stat</a></li><li><a href="#grep">grep</a></li><li><a href="#cut">cut</a></li><li><a href="#diff">diff</a></li><li><a href="#uniq">uniq</a></li><li><a href="#sort">sort</a></li><li><a href="#touch">touch</a></li><li><a href="#cp">cp</a></li><li><a href="#rm">rm</a></li><li><a href="#dd">dd</a></li><li><a href="#file">file</a></li></ul><!-- /TOC --><h2 id="date"><a href="#date" class="headerlink" title="date"></a>date</h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>%S</td><td>ç§’ï¼ˆ00ï½59ï¼‰</td></tr><tr><td>%M</td><td>åˆ†é’Ÿï¼ˆ00ï½59ï¼‰</td></tr><tr><td>%H</td><td>å°æ—¶ï¼ˆ00ï½23ï¼‰</td></tr><tr><td>%I</td><td>å°æ—¶ï¼ˆ00ï½12ï¼‰</td></tr><tr><td>%m</td><td>æœˆä»½ï¼ˆ1~12ï¼‰</td></tr><tr><td>%p</td><td>æ˜¾ç¤ºå‡ºAMæˆ–PM</td></tr><tr><td>%a</td><td>ç¼©å†™çš„å·¥ä½œæ—¥åç§°ï¼ˆä¾‹å¦‚ï¼šSunï¼‰</td></tr><tr><td>%A</td><td>å®Œæ•´çš„å·¥ä½œæ—¥åç§°ï¼ˆä¾‹å¦‚ï¼šSundayï¼‰</td></tr><tr><td>%b</td><td>ç¼©å†™çš„æœˆä»½åç§°ï¼ˆä¾‹å¦‚ï¼šJanï¼‰</td></tr><tr><td>%B</td><td>å®Œæ•´çš„æœˆä»½åç§°ï¼ˆä¾‹å¦‚ï¼šJanuaryï¼‰</td></tr><tr><td>%q</td><td>å­£åº¦ï¼ˆ1~4ï¼‰</td></tr><tr><td>%y</td><td>ç®€å†™å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š20ï¼‰</td></tr><tr><td>%Y</td><td>å®Œæ•´å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2020ï¼‰</td></tr><tr><td>%d</td><td>æœ¬æœˆä¸­çš„ç¬¬å‡ å¤©</td></tr><tr><td>%j</td><td>ä»Šå¹´ä¸­çš„ç¬¬å‡ å¤©</td></tr><tr><td>%n</td><td>æ¢è¡Œç¬¦ï¼ˆç›¸å½“äºæŒ‰ä¸‹å›è½¦é”®ï¼‰</td></tr><tr><td>%t</td><td>è·³æ ¼ï¼ˆç›¸å½“äºæŒ‰ä¸‹Tabé”®ï¼‰</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶é—´</span><span class="token function">date</span><span class="token comment"># Sat Sep 5 09:13:45 CST 2020</span><span class="token comment"># æŒ‰ç…§â€œå¹´-æœˆ-æ—¥ å°æ—¶:åˆ†é’Ÿ:ç§’â€çš„æ ¼å¼æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶é—´çš„ date</span><span class="token function">date</span> <span class="token string">"+%Y-%m-%d %H:%M:%S"</span><span class="token comment"># 2020-09-05 09:14:35</span><span class="token comment"># å°†ç³»ç»Ÿçš„å½“å‰æ—¶é—´è®¾ç½®ä¸º 2020 å¹´ 11 æœˆ 1 æ—¥ 8 ç‚¹ 30 åˆ†</span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">"20201101 8:30:00"</span><span class="token comment"># Sun Nov 1 08:30:00 CST 2020</span><span class="token function">date</span><span class="token comment"># Sun Nov 1 08:30:08 CST 2020</span><span class="token comment"># date å‘½ä»¤ä¸­çš„å‚æ•° %j å¯ç”¨æ¥æŸ¥çœ‹ä»Šå¤©æ˜¯å½“å¹´ä¸­çš„ç¬¬å‡ å¤©ã€‚è¿™ä¸ªå‚æ•°èƒ½å¤Ÿå¾ˆå¥½åœ°åŒºåˆ†å¤‡ä»½æ—¶é—´çš„æ—©æ™šï¼Œå³æ•°å­—è¶Šå¤§ï¼Œè¶Šé è¿‘å½“å‰æ—¶é—´ã€‚</span><span class="token function">date</span> <span class="token string">"+%j"</span><span class="token comment"># 305</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a><span id="timedatectl">timedatectl</span></h2><blockquote><p>time date control</p></blockquote><p>timedatectl å‘½ä»¤ç”¨äºè®¾ç½®ç³»ç»Ÿçš„æ—¶é—´ï¼Œå‘ç°ç”µè„‘æ—¶é—´è·Ÿå®é™…æ—¶é—´ä¸ç¬¦ï¼Ÿå¦‚æœåªå·®å‡ åˆ†é’Ÿçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒæ•´ã€‚ä½†æ˜¯ï¼Œå¦‚æœå·®å‡ ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆé™¤äº†è°ƒæ•´å½“å‰çš„æ—¶é—´ï¼Œè¿˜æœ‰å¿…è¦æ£€æŸ¥ä¸€ä¸‹æ—¶åŒºäº†ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>status</td><td>æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯</td></tr><tr><td>list-timezones</td><td>åˆ—å‡ºå·²çŸ¥æ—¶åŒº</td></tr><tr><td>set-time</td><td>è®¾ç½®ç³»ç»Ÿæ—¶é—´</td></tr><tr><td>set-timezone</td><td>è®¾ç½®ç”Ÿæ•ˆæ—¶åŒº</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¿®æ”¹æ—¶åŒº</span>timedatectl set-timezone Asia/Shanghai<span class="token comment"># ä¿®æ”¹ç³»ç»Ÿæ—¥æœŸ</span>timedatectl set-time <span class="token number">2021</span>-05-18<span class="token comment"># ä¿®æ”¹ç³»ç»Ÿæ—¶é—´</span>timedatectl set-time <span class="token number">9</span>:30<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="reboot"><a href="#reboot" class="headerlink" title="reboot"></a>reboot</h2><p>é‡å¯ç³»ç»Ÿ</p><h2 id="poweroff"><a href="#poweroff" class="headerlink" title="poweroff"></a>poweroff</h2><p>å…³é—­ç³»ç»Ÿ</p><h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><blockquote><p>web get</p></blockquote><p>wget å‘½ä»¤ç”¨äºåœ¨ç»ˆç«¯å‘½ä»¤è¡Œä¸­ä¸‹è½½ç½‘ç»œæ–‡ä»¶</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-b</td><td>åå°ä¸‹è½½æ¨¡å¼</td></tr><tr><td>-P</td><td>ä¸‹è½½åˆ°æŒ‡å®šç›®å½•</td></tr><tr><td>-t</td><td>æœ€å¤§å°è¯•æ¬¡æ•°</td></tr><tr><td>-c</td><td>æ–­ç‚¹ç»­ä¼ </td></tr><tr><td>-p</td><td>ä¸‹è½½é¡µé¢å†…æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ç­‰</td></tr><tr><td>-r</td><td>é€’å½’ä¸‹è½½</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é€’å½’ä¸‹è½½ www.linuxprobe.com ç½‘ç«™å†…çš„æ‰€æœ‰é¡µé¢æ•°æ®ä»¥åŠæ–‡ä»¶ï¼Œä¸‹è½½å®Œåä¼šè‡ªåŠ¨ä¿å­˜åˆ°å½“å‰è·¯å¾„ä¸‹ä¸€ä¸ªåä¸º www.linuxprobe.com çš„ç›®å½•ä¸­</span><span class="token function">wget</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-p</span> https://www.linuxprobe.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><blockquote><p>processes</p></blockquote><p>ç”¨äºæŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹çŠ¶æ€</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-a</td><td>æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ï¼‰</td></tr><tr><td>-u</td><td>ç”¨æˆ·ä»¥åŠå…¶ä»–è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>-x</td><td>æ˜¾ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹</td></tr></tbody></table><h2 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h2><blockquote><p>process tree</p></blockquote><p>ç”¨äºä»¥æ ‘çŠ¶å›¾çš„å½¢å¼å±•ç¤ºè¿›ç¨‹ä¹‹é—´çš„å…³ç³»</p><h2 id="nice"><a href="#nice" class="headerlink" title="nice"></a>nice</h2><p>ç”¨äºè°ƒæ•´è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œè¯­æ³•æ ¼å¼ä¸ºâ€œniceä¼˜å…ˆçº§æ•°å­— æœåŠ¡åç§°â€</p><p>åœ¨ top å‘½ä»¤è¾“å‡ºçš„ç»“æœä¸­ï¼ŒPR å’Œ NI å€¼ä»£è¡¨çš„æ˜¯è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šä½ï¼ˆå–å€¼èŒƒå›´æ˜¯-20ï½19ï¼‰ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚åœ¨æ—¥å¸¸çš„ç”Ÿäº§å·¥ä½œä¸­ï¼Œå¯ä»¥å°†ä¸€äº›ä¸é‡è¦è¿›ç¨‹çš„ä¼˜å…ˆçº§è°ƒä½ï¼Œè®©ç´§è¿«çš„æœåŠ¡æ›´å¤šåœ°åˆ©ç”¨ CPU å’Œå†…å­˜èµ„æºï¼Œä»¥è¾¾åˆ°åˆç†åˆ†é…ç³»ç»Ÿèµ„æºçš„ç›®çš„ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°† bash æœåŠ¡çš„ä¼˜å…ˆçº§è°ƒæ•´åˆ°æœ€é«˜</span><span class="token function">nice</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-20</span> <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="pidof"><a href="#pidof" class="headerlink" title="pidof"></a>pidof</h2><p>ç”¨äºæŸ¥è¯¢æŸä¸ªæŒ‡å®šæœåŠ¡è¿›ç¨‹çš„ PID å·ç å€¼ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œpidof [å‚æ•°] æœåŠ¡åç§°â€</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·ç å€¼ï¼ˆPIDï¼‰æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥ç”¨äºåŒºåˆ†ä¸åŒçš„è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥æŸ¥è¯¢æœ¬æœºä¸Š sshd æœåŠ¡ç¨‹åºçš„ PIDï¼š</span>pidof sshd<span class="token comment"># 2156</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æœ‰æ—¶ç³»ç»Ÿä¼šæç¤ºè¿›ç¨‹æ— æ³•è¢«ç»ˆæ­¢ï¼Œæ­¤æ—¶å¯ä»¥åŠ å‚æ•° -9ï¼Œè¡¨ç¤ºæœ€é«˜çº§åˆ«åœ°å¼ºåˆ¶æ€æ­»è¿›ç¨‹</span><span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token number">2156</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="killall"><a href="#killall" class="headerlink" title="killall"></a>killall</h2><p>ç”¨äºç»ˆæ­¢æŸä¸ªæŒ‡å®šåç§°çš„æœåŠ¡æ‰€å¯¹åº”çš„å…¨éƒ¨è¿›ç¨‹ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œkillall [å‚æ•°] æœåŠ¡åç§°â€</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pidof httpd<span class="token comment"># 13581 13580 13579 13578 13577 13576</span><span class="token function">killall</span> httpd<span class="token comment"># å†æ¬¡æŸ¥çœ‹</span>pidof httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h2><p>uname å‘½ä»¤ç”¨äºæŸ¥çœ‹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸ç³»ç»Ÿæ¶æ„ç­‰ä¿¡æ¯ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œunix nameâ€ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œuname [-a]â€ ã€‚åœ¨ä½¿ç”¨ uname å‘½ä»¤æ—¶ï¼Œä¸€èˆ¬è¦å›ºå®šæ­é…ä¸Š -a å‚æ•°æ¥å®Œæ•´åœ°æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„å†…æ ¸åç§°ã€ä¸»æœºåã€å†…æ ¸å‘è¡Œç‰ˆæœ¬ã€èŠ‚ç‚¹åã€å‹åˆ¶æ—¶é—´ã€ç¡¬ä»¶åç§°ã€ç¡¬ä»¶å¹³å°ã€å¤„ç†å™¨ç±»å‹ä»¥åŠæ“ä½œç³»ç»Ÿåç§°ç­‰ä¿¡æ¯ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uname</span> <span class="token parameter variable">-a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœè¦æŸ¥çœ‹å½“å‰ç³»ç»Ÿç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œåˆ™éœ€è¦æŸ¥çœ‹ redhat-release æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/redhat-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h2><blockquote><p>å»ºè®®è´Ÿè½½å€¼ä¿æŒåœ¨ 1 å·¦å³ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸è¦è¶…è¿‡ 5 å°±å¥½ã€‚</p></blockquote><p>uptime å‘½ä»¤ç”¨äºæŸ¥çœ‹ç³»ç»Ÿçš„è´Ÿè½½ä¿¡æ¯ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´ã€ç³»ç»Ÿå·²è¿è¡Œæ—¶é—´ã€å¯ç”¨ç»ˆç«¯æ•°é‡ä»¥åŠå¹³å‡è´Ÿè½½å€¼ç­‰ä¿¡æ¯ã€‚å¹³å‡è´Ÿè½½å€¼æŒ‡çš„æ˜¯ç³»ç»Ÿåœ¨æœ€è¿‘ 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå†…çš„å‹åŠ›æƒ…å†µï¼Œè´Ÿè½½å€¼è¶Šä½è¶Šå¥½ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uptime</span><span class="token comment">#  0:16  up 5 days, 14:47, 8 users, load averages: 1.41 1.44 1.56</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>free å‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å†…å­˜çš„ä½¿ç”¨é‡ä¿¡æ¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">free</span> <span class="token parameter variable">-h</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="who"><a href="#who" class="headerlink" title="who"></a>who</h2><p>who å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰ç™»å…¥ä¸»æœºçš„ç”¨æˆ·ç»ˆç«¯ä¿¡æ¯ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">who</span><span class="token comment"># ç™»å½•çš„ç”¨æˆ·å ç»ˆç«¯è®¾å¤‡ ç™»å½•åˆ°ç³»ç»Ÿçš„æ—¶é—´</span><span class="token comment"># pudongping console  Sep  6 09:29</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="last"><a href="#last" class="headerlink" title="last"></a>last</h2><p>last å‘½ä»¤ç”¨äºè°ƒå–ä¸»æœºçš„è¢«è®¿è®°å½•ï¼ŒLinux ç³»ç»Ÿä¼šå°†æ¯æ¬¡çš„ç™»å½•ä¿¡æ¯éƒ½è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœå“ªå¤©æƒ³ç¿»é˜…äº†ï¼Œç›´æ¥æ‰§è¡Œè¿™æ¡å‘½ä»¤å°±è¡Œã€‚</p><h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><p>ping å‘½ä»¤ç”¨äºæµ‹è¯•ä¸»æœºä¹‹é—´çš„ç½‘ç»œè¿é€šæ€§ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-c</td><td>æ€»å…±å‘é€æ¬¡æ•°</td></tr><tr><td>-l</td><td>æŒ‡å®šç½‘å¡åç§°</td></tr><tr><td>-i</td><td>æ¯æ¬¡é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰</td></tr><tr><td>-W</td><td>æœ€é•¿ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">4</span> www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="tracepath"><a href="#tracepath" class="headerlink" title="tracepath"></a>tracepath</h2><p>tracepath å‘½ä»¤ç”¨äºæ˜¾ç¤ºæ•°æ®åŒ…åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶é€”ä¸­ç»è¿‡çš„æ‰€æœ‰è·¯ç”±ä¿¡æ¯ã€‚å½“ä¸¤å°ä¸»æœºä¹‹é—´æ— æ³•æ­£å¸¸ ping é€šæ—¶ï¼Œè¦è€ƒè™‘ä¸¤å°ä¸»æœºä¹‹é—´æ˜¯å¦æœ‰é”™è¯¯çš„è·¯ç”±ä¿¡æ¯ï¼Œå¯¼è‡´æ•°æ®è¢«æŸä¸€å°è®¾å¤‡é”™è¯¯åœ°ä¸¢å¼ƒã€‚è¿™æ—¶ä¾¿å¯ä»¥ä½¿ç”¨ tracepath å‘½ä»¤è¿½è¸ªæ•°æ®åŒ…åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶é€”ä¸­çš„æ‰€æœ‰è·¯ç”±ä¿¡æ¯ï¼Œä»¥åˆ†ææ˜¯å“ªå°è®¾å¤‡å‡ºäº†é—®é¢˜ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tracepath www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><p>netstat å‘½ä»¤ç”¨äºæ˜¾ç¤ºå¦‚ç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€æ¥å£çŠ¶æ€ç­‰çš„ç½‘ç»œç›¸å…³ä¿¡æ¯ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œnetwork statusâ€</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-a</td><td>æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ä¸­çš„Socket</td></tr><tr><td>-p</td><td>æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨çš„Socketä¿¡æ¯</td></tr><tr><td>-t</td><td>æ˜¾ç¤ºTCPåè®®çš„è¿æ¥çŠ¶æ€</td></tr><tr><td>-u</td><td>æ˜¾ç¤ºUDPåè®®çš„è¿æ¥çŠ¶æ€</td></tr><tr><td>-n</td><td>ä½¿ç”¨IPåœ°å€ï¼Œä¸ä½¿ç”¨åŸŸå</td></tr><tr><td>-l</td><td>ä»…åˆ—å‡ºæ­£åœ¨ç›‘å¬çš„æœåŠ¡çŠ¶æ€</td></tr><tr><td>-i</td><td>ç°åœ¨ç½‘å¡åˆ—è¡¨ä¿¡æ¯</td></tr><tr><td>-r</td><td>æ˜¾ç¤ºè·¯ç”±è¡¨ä¿¡æ¯</td></tr></tbody></table><h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><p>é»˜è®¤ä¼šæ˜¾ç¤ºå‡ºç”¨æˆ·åœ¨æœ¬åœ°è®¡ç®—æœºä¸­æ‰§è¡Œè¿‡çš„æœ€è¿‘ 1000 æ¡å‘½ä»¤è®°å½•ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>/etc/profile</code> æ–‡ä»¶ä¸­çš„ <code>HISTSIZE</code> å˜é‡å€¼æ¥æ”¹å˜é»˜è®¤æ•°é‡ã€‚å†å²å‘½ä»¤éƒ½ä¼šè¢«è®°å½•åˆ° <code>~/.bash_history</code> æ–‡ä»¶ä¸­ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¸…ç©ºå‘½ä»¤å†å²è®°å½•</span><span class="token function">history</span> <span class="token parameter variable">-c</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="sosreport"><a href="#sosreport" class="headerlink" title="sosreport"></a>sosreport</h2><p>sosreport å‘½ä»¤ç”¨äºæ”¶é›†ç³»ç»Ÿé…ç½®åŠæ¶æ„ä¿¡æ¯å¹¶è¾“å‡ºè¯Šæ–­æ–‡æ¡£ã€‚</p><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-name</td><td>åŒ¹é…åç§°</td></tr><tr><td>-perm</td><td>åŒ¹é…æƒé™ï¼ˆmodeä¸ºå®Œå…¨åŒ¹é…ï¼Œ-modeä¸ºåŒ…å«å³å¯ï¼‰</td></tr><tr><td>-user</td><td>åŒ¹é…æ‰€æœ‰è€…</td></tr><tr><td>-group</td><td>åŒ¹é…æ‰€æœ‰ç»„</td></tr><tr><td>-mtime -n +n</td><td>åŒ¹é…ä¿®æ”¹å†…å®¹çš„æ—¶é—´ï¼ˆ-næŒ‡nå¤©ä»¥å†…ï¼Œ+næŒ‡nå¤©ä»¥å‰ï¼‰</td></tr><tr><td>-atime -n +n</td><td>åŒ¹é…è®¿é—®æ–‡ä»¶çš„æ—¶é—´ï¼ˆ-næŒ‡nå¤©ä»¥å†…ï¼Œ+næŒ‡nå¤©ä»¥å‰ï¼‰</td></tr><tr><td>-ctime -n +n</td><td>åŒ¹é…ä¿®æ”¹æ–‡ä»¶æƒé™çš„æ—¶é—´ï¼ˆ-næŒ‡nå¤©ä»¥å†…ï¼Œ+næŒ‡nå¤©ä»¥å‰ï¼‰</td></tr><tr><td>-nouser</td><td>åŒ¹é…æ— æ‰€æœ‰è€…çš„æ–‡ä»¶</td></tr><tr><td>-nogroup</td><td>åŒ¹é…æ— æ‰€æœ‰ç»„çš„æ–‡ä»¶</td></tr><tr><td>-newer f1 !f2</td><td>åŒ¹é…æ¯”æ–‡ä»¶f1æ–°ä½†æ¯”f2æ—§çš„æ–‡ä»¶</td></tr><tr><td>â€“type b/d/c/p/l/f</td><td>åŒ¹é…æ–‡ä»¶ç±»å‹ï¼ˆåé¢çš„å­—å¹•å­—æ¯ä¾æ¬¡è¡¨ç¤ºå—è®¾å¤‡ã€ç›®å½•ã€å­—ç¬¦è®¾å¤‡ã€ç®¡é“ã€é“¾æ¥æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶ï¼‰</td></tr><tr><td>-size</td><td>åŒ¹é…æ–‡ä»¶çš„å¤§å°ï¼ˆ+50KBä¸ºæŸ¥æ‰¾è¶…è¿‡50KBçš„æ–‡ä»¶ï¼Œè€Œ-50KBä¸ºæŸ¥æ‰¾å°äº50KBçš„æ–‡ä»¶ï¼‰</td></tr><tr><td>-prune</td><td>å¿½ç•¥æŸä¸ªç›®å½•</td></tr><tr><td>-exec â€¦â€¦ {};</td><td>åé¢å¯è·Ÿç”¨äºè¿›ä¸€æ­¥å¤„ç†æœç´¢ç»“æœçš„å‘½ä»¤</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è·å– /etc ç›®å½•ä¸­æ‰€æœ‰ä»¥ host å¼€å¤´çš„æ–‡ä»¶åˆ—è¡¨</span><span class="token function">find</span> /etc <span class="token parameter variable">-name</span> <span class="token string">"host*"</span> <span class="token parameter variable">-print</span><span class="token comment"># æœç´¢æ•´ä¸ªç³»ç»Ÿä¸­åŒ…å« SUID æƒé™çš„æ‰€æœ‰æ–‡ä»¶</span><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span><span class="token comment"># åœ¨æ•´ä¸ªç³»ç»Ÿä¸­æ‰¾å‡ºæ‰€æœ‰å½’å±äº alex ç”¨æˆ·çš„æ–‡ä»¶ï¼Œå¹¶å¤åˆ¶åˆ° /home/alex/findresults ç›®å½•ä¸­</span><span class="token function">find</span> / <span class="token parameter variable">-user</span> alex <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token parameter variable">-a</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> /home/alex/findresults/<span class="token punctuation">\</span><span class="token punctuation">;</span><span class="token comment"># å…¶ä¸­çš„ `{}` è¡¨ç¤º find å‘½ä»¤æœç´¢å‡ºçš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å‘½ä»¤çš„ç»“å°¾å¿…é¡»æ˜¯ `\;`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h2><p>locate å‘½ä»¤ç”¨äºæŒ‰ç…§åç§°å¿«é€Ÿæœç´¢æ–‡ä»¶æ‰€å¯¹åº”çš„ä½ç½®ã€‚ä½¿ç”¨ find å‘½ä»¤è¿›è¡Œå…¨ç›˜æœç´¢è™½ç„¶æ›´å‡†ç¡®ï¼Œä½†æ˜¯æ•ˆç‡æœ‰ç‚¹ä½ã€‚å¦‚æœä»…ä»…æ˜¯æƒ³æ‰¾ä¸€äº›å¸¸è§çš„ä¸”åˆçŸ¥é“å¤§æ¦‚åç§°çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ locate å‘½ä»¤ã€‚åœ¨ä½¿ç”¨ locate å‘½ä»¤æ—¶ï¼Œå…ˆä½¿ç”¨ updatedb å‘½ä»¤ç”Ÿæˆä¸€ä¸ªç´¢å¼•åº“æ–‡ä»¶ï¼Œè¿™ä¸ªåº“æ–‡ä»¶çš„åå­—æ˜¯ <code>/var/lib/mlocate/mlocate.db</code> ï¼Œåç»­åœ¨ä½¿ç”¨ locate å‘½ä»¤æœç´¢æ–‡ä»¶æ—¶å°±æ˜¯åœ¨è¯¥åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾æ“ä½œï¼Œé€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">updatedb<span class="token function">ls</span> <span class="token parameter variable">-l</span> /var/lib/mlocate/mlocate.db<span class="token comment"># ä½¿ç”¨ locate å‘½ä»¤æœç´¢å‡ºæ‰€æœ‰åŒ…å« alex åç§°çš„æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®</span><span class="token function">locate</span> alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h2><p>whereis å‘½ä»¤ç”¨äºæŒ‰ç…§åç§°å¿«é€Ÿæœç´¢äºŒè¿›åˆ¶ç¨‹åºï¼ˆå‘½ä»¤ï¼‰ã€æºä»£ç ä»¥åŠå¸®åŠ©æ–‡ä»¶æ‰€å¯¹åº”çš„ä½ç½®ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œwhereis å‘½ä»¤åç§°â€ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œwhereis å‘½ä»¤ä¹Ÿæ˜¯åŸºäº updatedb å‘½ä»¤æ‰€ç”Ÿæˆçš„ç´¢å¼•åº“æ–‡ä»¶è¿›è¡Œæœç´¢ï¼Œå®ƒä¸ locate å‘½ä»¤çš„åŒºåˆ«æ˜¯ä¸å…³å¿ƒé‚£äº›ç›¸åŒåç§°çš„æ–‡ä»¶ï¼Œä»…ä»…æ˜¯å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤æ–‡ä»¶åŠå…¶å¸®åŠ©æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚</p><h2 id="which"><a href="#which" class="headerlink" title="which"></a>which</h2><p>which å‘½ä»¤ç”¨äºæŒ‰ç…§æŒ‡å®šåç§°å¿«é€Ÿæœç´¢äºŒè¿›åˆ¶ç¨‹åºï¼ˆå‘½ä»¤ï¼‰æ‰€å¯¹åº”çš„ä½ç½®ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œwhich å‘½ä»¤åç§°â€ã€‚</p><p>which å‘½ä»¤æ˜¯åœ¨ PATH å˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­ï¼ŒæŒ‰ç…§æŒ‡å®šæ¡ä»¶æœç´¢å‘½ä»¤æ‰€åœ¨çš„è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ—¢ä¸å…³å¿ƒåŒåæ–‡ä»¶ï¼ˆfind ä¸ locateï¼‰ï¼Œä¹Ÿä¸å…³å¿ƒå‘½ä»¤æ‰€å¯¹åº”çš„æºä»£ç å’Œå¸®åŠ©æ–‡ä»¶ï¼ˆwhereisï¼‰ï¼Œä»…ä»…æ˜¯æƒ³æ‰¾åˆ°å‘½ä»¤æœ¬èº«æ‰€åœ¨çš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ª which å‘½ä»¤å°±å¤ªåˆé€‚äº†ã€‚</p><h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><blockquote><p>cat æ˜¯ concatenateï¼ˆè¿æ¥ã€è¿ç»­ï¼‰çš„ç®€å†™</p></blockquote><ul><li>è¿æ¥åˆå¹¶æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token number">11</span> <span class="token operator">&gt;</span> a.txt<span class="token builtin class-name">echo</span> <span class="token number">22</span> <span class="token operator">&gt;</span> b.txt<span class="token comment"># åˆå¹¶ a.txt å’Œ b.txt æ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹åˆ° c.txt æ–‡ä»¶ä¸­</span><span class="token function">cat</span> a.txt b.txt <span class="token operator">&gt;</span> c.txt<span class="token comment"># æŸ¥çœ‹ c.txt æ–‡ä»¶ä¸­çš„å†…å®¹</span><span class="token function">cat</span> c.txt  <span class="token comment"># 11 22</span><span class="token comment"># -n å‚æ•°å¯ä»¥æ˜¾ç¤ºè¡Œå·</span><span class="token function">cat</span> <span class="token parameter variable">-n</span> c.txt<span class="token comment"># 1 11</span><span class="token comment"># 2 22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="more"><a href="#more" class="headerlink" title="more"></a>more</h2><h2 id="less"><a href="#less" class="headerlink" title="less"></a>less</h2><table><thead><tr><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-N</td><td>æ˜¾ç¤ºæ¯è¡Œçš„è¡Œå·</td></tr><tr><td>-S</td><td>è¡Œè¿‡é•¿æ—¶å°†è¶…å‡ºéƒ¨åˆ†èˆå¼ƒ</td></tr><tr><td>-m</td><td>æ˜¾ç¤ºç±»ä¼¼ more å‘½ä»¤çš„ç™¾åˆ†æ¯”</td></tr></tbody></table><p>less è¿›å…¥äº¤äº’ç•Œé¢æ—¶çš„æŒ‡ä»¤åŠåŠŸèƒ½</p><table><thead><tr><th>äº¤äº’æŒ‡ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>/å­—ç¬¦ä¸²</td><td>å‘ä¸‹æœç´¢â€œå­—ç¬¦ä¸²â€çš„åŠŸèƒ½</td></tr><tr><td>?å­—ç¬¦ä¸²</td><td>å‘ä¸Šæœç´¢â€œå­—ç¬¦ä¸²â€çš„åŠŸèƒ½</td></tr><tr><td>n</td><td>é‡å¤*å‰ä¸€ä¸ªæœç´¢</td></tr><tr><td>N</td><td>åå‘é‡å¤å‰ä¸€ä¸ªæœç´¢</td></tr><tr><td>k</td><td>å‘ä¸Šç§»åŠ¨ä¸€è¡Œ</td></tr><tr><td>j</td><td>å‘ä¸‹ç§»åŠ¨ä¸€è¡Œ</td></tr><tr><td>u</td><td>å‘ä¸Šç§»åŠ¨åŠé¡µ</td></tr><tr><td>d</td><td>å‘ä¸‹ç§»åŠ¨åŠé¡µ</td></tr><tr><td>b</td><td>å‘ä¸Šç§»åŠ¨ä¸€é¡µ</td></tr><tr><td>ç©ºæ ¼é”®</td><td>å‘ä¸‹ç§»åŠ¨ä¸€é¡µ</td></tr><tr><td>g</td><td>ç§»åŠ¨åˆ°ç¬¬ä¸€è¡Œ</td></tr><tr><td>G</td><td>ç§»åŠ¨è‡³æœ€åä¸€è¡Œ</td></tr><tr><td>h æˆ– H</td><td>æ˜¾ç¤ºå¸®åŠ©ç•Œé¢</td></tr><tr><td>q æˆ– Q æˆ– ZZ</td><td>é€€å‡º less å‘½ä»¤</td></tr><tr><td>v</td><td>ä½¿ç”¨é…ç½®çš„ç¼–è¾‘å™¨ç¼–è¾‘å½“å‰æ–‡ä»¶</td></tr></tbody></table><h2 id="head"><a href="#head" class="headerlink" title="head"></a>head</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åªæƒ³æŸ¥çœ‹æ–‡æœ¬ä¸­å‰ 10 è¡Œçš„å†…å®¹</span><span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span> test.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åªæƒ³æŸ¥çœ‹æ–‡æœ¬å†…å®¹çš„æœ€å 10 è¡Œ</span><span class="token function">tail</span> <span class="token parameter variable">-n</span> <span class="token number">10</span> test.log<span class="token comment"># å®æ—¶æŸ¥çœ‹æ–‡æœ¬</span><span class="token function">tail</span> <span class="token parameter variable">-f</span> test.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h2><p>tr å‘½ä»¤ç”¨äºæ›¿æ¢æ–‡æœ¬å†…å®¹ä¸­çš„å­—ç¬¦ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œtranslateâ€ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œtr [åŸå§‹å­—ç¬¦] [ç›®æ ‡å­—ç¬¦]â€</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŠŠæ–‡æœ¬å†…å®¹ä¸­çš„è‹±æ–‡å…¨éƒ¨æ›¿æ¢æˆå¤§å†™</span><span class="token function">cat</span> test.log <span class="token operator">|</span> <span class="token function">tr</span> <span class="token punctuation">[</span>a-z<span class="token punctuation">]</span> <span class="token punctuation">[</span>A-Z<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h2><p>wc å‘½ä»¤ç”¨äºç»Ÿè®¡æŒ‡å®šæ–‡æœ¬æ–‡ä»¶çš„è¡Œæ•°ã€å­—æ•°æˆ–å­—èŠ‚æ•°ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œword countsâ€ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œwc [å‚æ•°] æ–‡ä»¶åç§°â€</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-l</td><td>åªæ˜¾ç¤ºè¡Œæ•°</td></tr><tr><td>-w</td><td>åªæ˜¾ç¤ºå•è¯æ•°</td></tr><tr><td>-c</td><td>åªæ˜¾ç¤ºå­—èŠ‚æ•°</td></tr></tbody></table><pre class="line-numbers language-none"><code class="language-none"># ç»Ÿè®¡å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘ä¸ªç”¨æˆ·wc -l /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h2><p>stat å‘½ä»¤ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„å…·ä½“å­˜å‚¨ç»†èŠ‚å’Œæ—¶é—´ç­‰ä¿¡æ¯ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œstatusâ€ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œstat æ–‡ä»¶åç§°â€ã€‚<br>é™¤äº†ä¿®æ”¹æ—¶é—´ä¹‹å¤–ï¼ŒLinux ç³»ç»Ÿä¸­çš„æ–‡ä»¶åŒ…å« 3 ç§æ—¶é—´çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ Access Timeï¼ˆå†…å®¹æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´ï¼Œç®€ç§°ä¸º <strong>Atime</strong>ï¼‰ï¼ŒModify Timeï¼ˆå†…å®¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´ï¼Œç®€ç§°ä¸º <strong>Mtime</strong>ï¼‰ä»¥åŠChange Timeï¼ˆæ–‡ä»¶å±æ€§æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´ï¼Œç®€ç§°ä¸º <strong>Ctime</strong>ï¼‰ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">stat</span> test.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>grep å‘½ä»¤ç”¨äºæŒ‰è¡Œæå–æ–‡æœ¬å†…å®¹ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œgrep [å‚æ•°] æ–‡ä»¶åç§°â€</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-b</td><td>å°†å¯æ‰§è¡Œæ–‡ä»¶(binary)å½“ä½œæ–‡æœ¬æ–‡ä»¶ï¼ˆtextï¼‰æ¥æœç´¢</td></tr><tr><td>-c</td><td>ä»…æ˜¾ç¤ºæ‰¾åˆ°çš„è¡Œæ•°</td></tr><tr><td>-i</td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td>-n</td><td>æ˜¾ç¤ºè¡Œå·</td></tr><tr><td>-v</td><td>åå‘é€‰æ‹©â€”â€”ä»…åˆ—å‡ºæ²¡æœ‰â€œå…³é”®è¯â€çš„è¡Œã€‚</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰¾å‡ºå½“å‰ç³»ç»Ÿä¸­ä¸å…è®¸ç™»å½•ç³»ç»Ÿçš„æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</span><span class="token function">grep</span> /sbin/nologin /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h2><p>cut å‘½ä»¤ç”¨äºæŒ‰ <strong>â€œåˆ—â€</strong> æå–æ–‡æœ¬å†…å®¹ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œcut [å‚æ•°] æ–‡ä»¶åç§°â€ï¼ŒæŒ‰â€œåˆ—â€æœç´¢ï¼Œä¸ä»…è¦ä½¿ç”¨ <code>-f</code> å‚æ•°è®¾ç½®éœ€è¦æŸ¥çœ‹çš„åˆ—æ•°ï¼Œè¿˜éœ€è¦ä½¿ç”¨ <code>-d</code> å‚æ•°æ¥è®¾ç½®é—´éš”ç¬¦å·ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æå– /etc/passwd æ–‡ä»¶ä¸­çš„ç”¨æˆ·åä¿¡æ¯ï¼Œå³æå–ä»¥å†’å·ä¸ºé—´éš”ç¬¦å·çš„ç¬¬ä¸€åˆ—å†…å®¹</span><span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-f</span> <span class="token number">1</span> /etc/passwd<span class="token comment"># æˆ–è€…ï¼ˆåªæå–å‰ 5 ä¸ªç”¨æˆ·ä¿¡æ¯ï¼‰</span><span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'#'</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-f</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h2><p>diff å‘½ä»¤ç”¨äºæ¯”è¾ƒå¤šä¸ªæ–‡ä»¶ä¹‹é—´å†…å®¹çš„å·®å¼‚ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œdifferentâ€ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œdiff [å‚æ•°] æ–‡ä»¶åç§°A æ–‡ä»¶åç§°Bâ€ã€‚</p><p>åœ¨ä½¿ç”¨ diff å‘½ä»¤æ—¶ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨ â€“brief å‚æ•°æ¥ç¡®è®¤ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒï¼Œè¿˜å¯ä»¥ä½¿ç”¨ -c å‚æ•°æ¥è¯¦ç»†æ¯”è¾ƒå‡ºå¤šä¸ªæ–‡ä»¶çš„å·®å¼‚ä¹‹å¤„ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ¤æ–­ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒ</span><span class="token function">diff</span> <span class="token parameter variable">--brief</span> a.txt b.txt<span class="token comment"># æŸ¥çœ‹æ–‡ä»¶å†…å®¹çš„å…·ä½“ä¸åŒ</span><span class="token function">diff</span> <span class="token parameter variable">-c</span> a.txt b.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="uniq"><a href="#uniq" class="headerlink" title="uniq"></a>uniq</h2><p>uniq å‘½ä»¤ç”¨äºå»é™¤æ–‡æœ¬ä¸­è¿ç»­çš„é‡å¤è¡Œï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œuniqueâ€ï¼Œè¯­æ³•æ ¼å¼ä¸ºâ€œuniq [å‚æ•°] æ–‡ä»¶åç§°â€ã€‚ <strong>ä¸­é—´ä¸èƒ½å¤¹æ‚å…¶ä»–æ–‡æœ¬è¡Œï¼ˆéç›¸é‚»çš„é»˜è®¤ä¸ä¼šå»é‡ï¼‰</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uniq</span> alex.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h2><p>sort å‘½ä»¤ç”¨äºå¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œå†æ’åºï¼Œè¯­æ³•æ ¼å¼ä¸º â€œsort [å‚æ•°] æ–‡ä»¶åç§°â€ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-f</td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td>-b</td><td>å¿½ç•¥ç¼©è¿›ä¸ç©ºæ ¼</td></tr><tr><td>-n</td><td>ä»¥æ•°å€¼å‹æ’åº</td></tr><tr><td>-r</td><td>åå‘æ’åº</td></tr><tr><td>-u</td><td>å»é™¤é‡å¤è¡Œ</td></tr><tr><td>-t</td><td>æŒ‡å®šé—´éš”ç¬¦</td></tr><tr><td>-k</td><td>è®¾ç½®å­—æ®µèŒƒå›´</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†æ–‡æœ¬ä¸­çš„å†…å®¹æŒ‰ç…§å­—æ¯é¡ºåºè¿›è¡Œæ’åº</span><span class="token function">sort</span> alex.txt<span class="token comment"># å°†æ–‡æœ¬å†…å®¹è¿›è¡Œå»é‡æ“ä½œ</span><span class="token function">sort</span> <span class="token parameter variable">-u</span> alex.txt<span class="token comment"># ä»¥ç¬¬ 3 ä¸ªå­—æ®µä¸­çš„æ•°å­—ä½œä¸ºæ’åºä¾æ®ï¼Œä»¥å†’å· : æŒ‡å®šåˆ†éš”ç¬¦ï¼Œä»¥æ•°å­—è§„åˆ™è¿›è¡Œæ’åº</span><span class="token function">sort</span> <span class="token parameter variable">-t</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-k</span> <span class="token number">3</span> <span class="token parameter variable">-n</span> alex.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h2><p>touch å‘½ä»¤ç”¨äºåˆ›å»ºç©ºç™½æ–‡ä»¶æˆ–è®¾ç½®æ–‡ä»¶çš„æ—¶é—´ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œtouch [å‚æ•°] æ–‡ä»¶åç§°â€ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-a</td><td>ä»…ä¿®æ”¹â€œè¯»å–æ—¶é—´â€ï¼ˆatimeï¼‰</td></tr><tr><td>-m</td><td>ä»…ä¿®æ”¹â€œä¿®æ”¹æ—¶é—´â€ï¼ˆmtimeï¼‰</td></tr><tr><td>-d</td><td>åŒæ—¶ä¿®æ”¹ atime ä¸ mtime</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¿®æ”¹æ–‡ä»¶çš„è¯»å–æ—¶é—´å’Œä¿®æ”¹æ—¶é—´</span><span class="token function">touch</span> <span class="token parameter variable">-d</span> <span class="token string">"2021-09-12 15:44"</span> alex.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><p>cp å‘½ä»¤ç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼Œè‹±æ–‡å…¨ç§°ä¸º â€œcopyâ€ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œcp [å‚æ•°] æºæ–‡ä»¶åç§° ç›®æ ‡æ–‡ä»¶åç§°â€ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-p</td><td>ä¿ç•™åŸå§‹æ–‡ä»¶çš„å±æ€§</td></tr><tr><td>-d</td><td>è‹¥å¯¹è±¡ä¸ºâ€œé“¾æ¥æ–‡ä»¶â€ï¼Œåˆ™ä¿ç•™è¯¥â€œé“¾æ¥æ–‡ä»¶â€çš„å±æ€§</td></tr><tr><td>-r</td><td>é€’å½’æŒç»­å¤åˆ¶ï¼ˆç”¨äºç›®å½•ï¼‰</td></tr><tr><td>-i</td><td>è‹¥ç›®æ ‡æ–‡ä»¶å­˜åœ¨åˆ™è¯¢é—®æ˜¯å¦è¦†ç›–</td></tr><tr><td>-a</td><td>ç›¸å½“äº -pdrï¼ˆpã€dã€rä¸ºä¸Šè¿°å‚æ•°ï¼‰</td></tr></tbody></table><h2 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-f</td><td>å¼ºåˆ¶æ‰§è¡Œ</td></tr><tr><td>-i</td><td>åˆ é™¤å‰è¯¢é—®</td></tr><tr><td>-r</td><td>åˆ é™¤ç›®å½•</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºè¿‡ç¨‹</td></tr></tbody></table><h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><p>dd å‘½ä»¤ç”¨äºæŒ‰ç…§æŒ‡å®šå¤§å°å’Œä¸ªæ•°çš„æ•°æ®å—æ¥å¤åˆ¶æ–‡ä»¶æˆ–è½¬æ¢æ–‡ä»¶ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œdd if=å‚æ•°å€¼of=å‚æ•°å€¼count=å‚æ•°å€¼bs=å‚æ•°å€¼â€ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>if</td><td>è¾“å…¥çš„æ–‡ä»¶åç§°</td></tr><tr><td>of</td><td>è¾“å‡ºçš„æ–‡ä»¶åç§°</td></tr><tr><td>bs</td><td>è®¾ç½®æ¯ä¸ªâ€œå—â€çš„å¤§å°</td></tr><tr><td>count</td><td>è®¾ç½®è¦å¤åˆ¶â€œå—â€çš„ä¸ªæ•°</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä» /dev/zero è®¾å¤‡æ–‡ä»¶ä¸­å–å‡º 1 ä¸ªå¤§å°ä¸º 560M çš„æ•°æ®å—ï¼Œä¿å­˜æˆåä¸º 560_file çš„æ–‡ä»¶</span><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>560_file <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">bs</span><span class="token operator">=</span>560M<span class="token comment"># å°†å…‰é©±è®¾å¤‡ä¸­çš„å…‰ç›˜åˆ¶ä½œæˆ iso æ ¼å¼çš„é•œåƒæ–‡ä»¶</span><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/cdrom <span class="token assign-left variable">of</span><span class="token operator">=</span>RHEL.iso<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="file"><a href="#file" class="headerlink" title="file"></a>file</h2><p>file å‘½ä»¤ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„ç±»å‹ï¼Œè¯­æ³•æ ¼å¼ä¸º â€œfile æ–‡ä»¶åç§°â€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€’å½’è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯</title>
      <link href="posts/1e1630f3.html"/>
      <url>posts/1e1630f3.html</url>
      
        <content type="html"><![CDATA[<h1 id="é€’å½’è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯"><a href="#é€’å½’è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯" class="headerlink" title="é€’å½’è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯"></a>é€’å½’è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯</h1><blockquote><p>å¦‚æœä½¿ç”¨ <code>laravel</code> çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ <code>collect</code> çš„ <code>crossJoin</code> æ–¹æ³•ä¹Ÿå¯ä»¥å®ç°</p></blockquote><h2 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * é€’å½’è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯ * * Created by PhpStorm. * User: Alex * Date: 2020/3/5 * Time: 20:35 */</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Handlers</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CarteSianHandler</span><span class="token punctuation">{</span>    <span class="token comment">/**     * ä¿å­˜ç»“æœ     *     * @var array     */</span>    <span class="token keyword">public</span> <span class="token variable">$products</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è®¡ç®—ç¬›å¡å°”ä¹˜ç§¯çš„ç»“æœ     *     * @param array $params     * @param array $temporary     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">carteSian</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$temporary</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$temporary</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$params</span> <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">carteSian</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">,</span> <span class="token variable">$temporary</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token class-name return-type">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token punctuation">,</span> <span class="token variable">$temporary</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$temporary</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token string single-quoted-string">'é¢œè‰²_é»‘è‰²'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'é¢œè‰²_ç™½è‰²'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'é¢œè‰²_å’–å•¡è‰²'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string single-quoted-string">'å°ºå¯¸_S'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'å°ºå¯¸_M'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'å°ºå¯¸_L'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string single-quoted-string">'æè´¨_ç¾½ç»’'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'æè´¨_é¹…ç»’'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$cartSian</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarteSian</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cartSian</span><span class="token operator">-&gt;</span><span class="token function">carteSian</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$cartSian</span><span class="token operator">-&gt;</span><span class="token property">products</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¿”å›ç»“æœ"><a href="#è¿”å›ç»“æœ" class="headerlink" title="è¿”å›ç»“æœ"></a>è¿”å›ç»“æœ</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">18</span> <span class="token punctuation">[</span>  <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_é»‘è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_S"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_é»‘è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_S"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_é»‘è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_M"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">3</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_é»‘è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_M"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">4</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_é»‘è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_L"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_é»‘è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_L"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">6</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_ç™½è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_S"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_ç™½è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_S"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">8</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_ç™½è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_M"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">9</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_ç™½è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_M"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">10</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_ç™½è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_L"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_ç™½è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_L"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">12</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_å’–å•¡è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_S"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">13</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_å’–å•¡è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_S"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">14</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_å’–å•¡è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_M"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">15</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_å’–å•¡è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_M"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">16</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_å’–å•¡è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_L"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_ç¾½ç»’"</span>  <span class="token punctuation">]</span>  <span class="token number">17</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">array</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">[</span>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"é¢œè‰²_å’–å•¡è‰²"</span>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"å°ºå¯¸_L"</span>    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"æè´¨_é¹…ç»’"</span>  <span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿæ’åº</title>
      <link href="posts/ff8068c0.html"/>
      <url>posts/ff8068c0.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¸¸è§„æ–¹æ³•ï¼Œå¿«é€Ÿæ’åº"><a href="#å¸¸è§„æ–¹æ³•ï¼Œå¿«é€Ÿæ’åº" class="headerlink" title="å¸¸è§„æ–¹æ³•ï¼Œå¿«é€Ÿæ’åº"></a>å¸¸è§„æ–¹æ³•ï¼Œå¿«é€Ÿæ’åº</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * æ€è·¯ï¼š * 1ã€æ‰¾åˆ°å½“å‰æ•°ç»„ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ ï¼ˆä¸€èˆ¬é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå› ä¸ºé€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ è¾ƒä¸ºç®€å•ï¼Œé€‰æ‹©å…¶ä»–å…ƒç´ è¿˜éœ€è¦å¤šå†™ä¸€äº›ä¸å¿…è¦çš„ä»£ç ï¼Œå¹²å˜›éè¦ç»™è‡ªå·±æ‰¾éº»çƒ¦å“©ï¼‰ä½œä¸ºæ¯”è¾ƒçš„æ ‡å‡† * 2ã€æ–°å»ºä¸¤ä¸ªç©ºæ•°ç»„ï¼Œç”¨äºå­˜æ”¾æ¯”æ¯”è¾ƒçš„å…ƒç´ å¤§æˆ–è€…å°çš„å…ƒç´ ï¼Œå½“éå†æ•´ä¸ªæ•°ç»„å…ƒç´ æ—¶ï¼Œå¦‚æœéå†åˆ°çš„å…ƒç´ æ¯”å½“å‰å…ƒç´ è¦å°ï¼Œåˆ™å°†æ­¤å…ƒç´ æ”¾åˆ°å·¦è¾¹çš„æ•°ç»„ï¼Œæ¯”å½“å‰å…ƒç´ å¤§ï¼Œåˆ™æ”¾åˆ°å³è¾¹çš„æ•°ç»„ä¸­ * 3ã€å†ä»¥åŒæ ·çš„æ–¹å¼å»éå†å·¦è¾¹çš„æ•°ç»„å’Œå³è¾¹çš„æ•°ç»„ * * é€’å½’ç‚¹ï¼šåªè¦æ˜¯éœ€è¦æ¯”è¾ƒçš„æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°å¤§äº 1ï¼Œé‚£ä¹ˆå°±éœ€è¦é€’å½’ï¼Œåªæœ‰å½“æ•°ç»„ä¸­çš„å…ƒç´ çš„ä¸ªæ•°ç­‰äº 1 çš„æ—¶å€™ï¼Œåˆ™åœæ­¢é€’å½’ï¼Œä¸éœ€è¦æ¯”è¾ƒ * * @param array $arr * @return array */</span><span class="token keyword">function</span> <span class="token function-definition function">quick_sort</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">{</span>    <span class="token comment">// åˆ¤æ–­å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// é€’å½’å‡ºå£ï¼šæ•°ç»„é•¿åº¦ä¸º 1 ï¼Œåˆ™ç›´æ¥è¿”å›æ•°ç»„</span>    <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>    <span class="token comment">// æ•°ç»„å…ƒç´ æœ‰å¤šä¸ªï¼Œåˆ™å®šä¹‰ä¸¤ä¸ªç©ºæ•°ç»„</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// æŠŠç¬¬ä¸€ä¸ªå…ƒç´ å½“ä½œæ¯”è¾ƒçš„å¯¹è±¡</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ¤æ–­å½“å‰å…ƒç´ çš„å¤§å°</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$left</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$right</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// é€’å½’è°ƒç”¨</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆå¹¶æ‰€æœ‰çš„ç»“æœ</span>    <span class="token keyword">return</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//$arr = [4, 7, 6, 5, 3, 2, 8, 1];</span><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">435</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">523</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">654</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="â€œæŒ–å‘æ³•â€-å¿«é€Ÿæ’åº"><a href="#â€œæŒ–å‘æ³•â€-å¿«é€Ÿæ’åº" class="headerlink" title="â€œæŒ–å‘æ³•â€ å¿«é€Ÿæ’åº"></a>â€œæŒ–å‘æ³•â€ å¿«é€Ÿæ’åº</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * "æŒ–å‘æ³•" å¿«é€Ÿæ’åº * * @param array $arr * @return array */</span><span class="token keyword">function</span> <span class="token function-definition function">quick_sort</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">{</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token number">0</span> <span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token number">1</span> <span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token number">2</span> <span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$pivot</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$leftHead</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$rightHead</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$index</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// éœ€è¦å¡«å……å¤„</span>    <span class="token variable">$compare</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'right'</span><span class="token punctuation">;</span>  <span class="token comment">// æ‹¿æ•°ç»„å·¦ä¾§çš„æ•°æ®ä¸æ•°ç»„å³ä¾§çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒ</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$leftHead</span> <span class="token operator">==</span> <span class="token variable">$rightHead</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$leftHead</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$leftHead</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$mid</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$pivot</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$mid</span><span class="token punctuation">,</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'right'</span> <span class="token operator">==</span> <span class="token variable">$compare</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// å¦‚æœå³æŒ‡é’ˆçš„æ•°å°äºåŸºå‡†æ•°ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªæ•°å¡«å…¥åŸºå‡†æ•°é‡Œé¢</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$rightHead</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token variable">$pivot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$rightHead</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$leftHead</span><span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token variable">$index</span> <span class="token operator">=</span> <span class="token variable">$rightHead</span><span class="token punctuation">;</span>                <span class="token variable">$compare</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'left'</span><span class="token punctuation">;</span>  <span class="token comment">// æ‹¿å·¦ä¾§çš„æ•°æ®å¼€å§‹è¿›è¡Œæ’åº</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token variable">$rightHead</span><span class="token operator">--</span><span class="token punctuation">;</span>  <span class="token comment">// å¦‚æœæ¯”ä»–å¤§</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// $compare == 'left'</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$leftHead</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token variable">$pivot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// å¦‚æœå¤§äºåŸºå‡†æ•°ï¼Œå¡«å……å³è¾¹çš„ index</span>                <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$leftHead</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$index</span> <span class="token operator">=</span> <span class="token variable">$leftHead</span><span class="token punctuation">;</span>                <span class="token variable">$rightHead</span><span class="token operator">--</span><span class="token punctuation">;</span>                <span class="token variable">$compare</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'right'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token variable">$leftHead</span><span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//$arr = [4, 7, 6, 5, 3, 2, 8, 1];</span><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">435</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">523</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">654</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨é˜¶ä¹˜åŸç†é€šè¿‡é˜¶ä¹˜è·å–ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ</title>
      <link href="posts/dfcf0c33.html"/>
      <url>posts/dfcf0c33.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨é˜¶ä¹˜åŸç†é€šè¿‡é˜¶ä¹˜è·å–ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ"><a href="#ä½¿ç”¨é˜¶ä¹˜åŸç†é€šè¿‡é˜¶ä¹˜è·å–ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ" class="headerlink" title="ä½¿ç”¨é˜¶ä¹˜åŸç†é€šè¿‡é˜¶ä¹˜è·å–ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ"></a>ä½¿ç”¨é˜¶ä¹˜åŸç†é€šè¿‡é˜¶ä¹˜è·å–ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ</h1><h2 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * ä½¿ç”¨é˜¶ä¹˜åŸç†ï¼Œé€šè¿‡é˜¶ä¹˜è·å–ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ * * Created by PhpStorm. * User: Alex * Date: 2020/3/9 * Time: 13:08 */</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Handlers</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FactorialHandler</span><span class="token punctuation">{</span>    <span class="token comment">/**     * ä½¿ç”¨é˜¶ä¹˜åŸç†è·å–ä¸€ç»´æ•°ç»„ä¸­å…¨éƒ¨çš„ç»„åˆæƒ…å†µ     *     * @param array $arr     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getArrAllCombineByFactor</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span>    <span class="token punctuation">{</span>        <span class="token comment">// å¤§äºç­‰äº1 =&gt; n! = 1*2*3*4*5â€¦â€¦â€¦â€¦*(n-1)*n</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$combineArr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// é™¤å½“å‰ key ä»¥å¤–çš„å•å…ƒæ•°ç»„</span>                <span class="token variable">$temArr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">arrRmoveValueByKey</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span> <span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$sonCombineArr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getArrAllCombineByFactor</span><span class="token punctuation">(</span><span class="token variable">$temArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sonCombineArr</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$combineArr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'|'</span> <span class="token operator">.</span> <span class="token variable">$value</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token variable">$combineArr</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é€šè¿‡æ•°ç»„çš„ key ç§»é™¤æ‰å½“å‰ key æ‰€åœ¨çš„å•å…ƒï¼Œè¿”å›é™¤ key å•å…ƒä»¥å¤–çš„å•å…ƒæ•°ç»„     *     * @param array $arr  åŸå§‹æ•°ç»„     * @param $k  éœ€è¦ç§»é™¤æ•°ç»„å•å…ƒçš„ key     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">arrRmoveValueByKey</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$arr</span><span class="token punctuation">,</span> <span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span>    <span class="token punctuation">{</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">array_values</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'1_1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'2_3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'4_6'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$factorialInstance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FactorialHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$factorialInstance</span><span class="token operator">-&gt;</span><span class="token function">getArrAllCombineByFactor</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿”å›ç»“æœ"><a href="#è¿”å›ç»“æœ" class="headerlink" title="è¿”å›ç»“æœ"></a>è¿”å›ç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">array:6 [  0 =&gt; "1_1|2_3|4_6"  1 =&gt; "1_1|4_6|2_3"  2 =&gt; "2_3|1_1|4_6"  3 =&gt; "2_3|4_6|1_1"  4 =&gt; "4_6|1_1|2_3"  5 =&gt; "4_6|2_3|1_1"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸€ç»´æ•°ç»„æ‰€æœ‰çš„ç»„åˆæƒ…å†µï¼ˆæ’åˆ—ç»„åˆï¼‰"><a href="#ä¸€ç»´æ•°ç»„æ‰€æœ‰çš„ç»„åˆæƒ…å†µï¼ˆæ’åˆ—ç»„åˆï¼‰" class="headerlink" title="ä¸€ç»´æ•°ç»„æ‰€æœ‰çš„ç»„åˆæƒ…å†µï¼ˆæ’åˆ—ç»„åˆï¼‰"></a>ä¸€ç»´æ•°ç»„æ‰€æœ‰çš„ç»„åˆæƒ…å†µï¼ˆæ’åˆ—ç»„åˆï¼‰</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Alpha'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Beta'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Gamma'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Sigma'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">depth_picker</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span> <span class="token variable">$temp_string</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$collect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$temp_string</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span>         <span class="token variable">$collect</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$temp_string</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$arrcopy</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>        <span class="token variable">$elem</span> <span class="token operator">=</span> <span class="token function">array_splice</span><span class="token punctuation">(</span><span class="token variable">$arrcopy</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// removes and returns the i'th element</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$arrcopy</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">depth_picker</span><span class="token punctuation">(</span><span class="token variable">$arrcopy</span><span class="token punctuation">,</span> <span class="token variable">$temp_string</span> <span class="token operator">.</span><span class="token string double-quoted-string">" "</span> <span class="token operator">.</span> <span class="token variable">$elem</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$collect</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$collect</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$temp_string</span><span class="token operator">.</span> <span class="token string double-quoted-string">" "</span> <span class="token operator">.</span> <span class="token variable">$elem</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span class="token variable">$collect</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">depth_picker</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$collect</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$collect</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿”å›çš„ç»“æœ"><a href="#è¿”å›çš„ç»“æœ" class="headerlink" title="è¿”å›çš„ç»“æœ"></a>è¿”å›çš„ç»“æœ</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">Array</span><span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Beta    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Beta Gamma    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Beta Gamma Sigma    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Beta Sigma    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Beta Sigma Gamma    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Gamma    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Gamma Beta    <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Gamma Beta Sigma    <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Gamma Sigma    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Gamma Sigma Beta    <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Sigma    <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Sigma Beta    <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Sigma Beta Gamma    <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Sigma Gamma    <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Alpha Sigma Gamma Beta    <span class="token operator">.</span>    <span class="token operator">.</span>    <span class="token operator">.</span>    <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Sigma Gamma    <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Sigma Gamma Alpha    <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Sigma Gamma Alpha Beta    <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Sigma Gamma Beta    <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span>  Sigma Gamma Beta Alpha<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> é˜¶ä¹˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NVM åŒ…ç®¡ç†å™¨</title>
      <link href="posts/63668a37.html"/>
      <url>posts/63668a37.html</url>
      
        <content type="html"><![CDATA[<h1 id="nvm-åŒ…ç®¡ç†å™¨"><a href="#nvm-åŒ…ç®¡ç†å™¨" class="headerlink" title="nvm åŒ…ç®¡ç†å™¨"></a>nvm åŒ…ç®¡ç†å™¨</h1><ul><li><a href="https://github.com/nvm-sh/nvm">å®˜ç½‘</a></li><li><a href="https://github.com/coreybutler/nvm-windows/releases">Windows ç›´æ¥é€‰æ‹© nvm-setup.zip å®‰è£…</a></li><li><a href="https://nodejs.org/en/blog/">æŸ¥çœ‹ nodejs çš„ç‰ˆæœ¬å·åºåˆ—</a></li></ul><h2 id="npm-æ›´æ”¹ä¸‹è½½æºä¸ºæ·˜å®é•œåƒ"><a href="#npm-æ›´æ”¹ä¸‹è½½æºä¸ºæ·˜å®é•œåƒ" class="headerlink" title="npm æ›´æ”¹ä¸‹è½½æºä¸ºæ·˜å®é•œåƒ"></a>npm æ›´æ”¹ä¸‹è½½æºä¸ºæ·˜å®é•œåƒ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å•æ¬¡ä½¿ç”¨</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--registry</span><span class="token operator">=</span>https://registry.npm.taobao.org<span class="token comment"># æ°¸ä¹…ä½¿ç”¨</span><span class="token function">npm</span> config <span class="token builtin class-name">set</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span>https://registry.npm.taobao.org<span class="token comment"># æ£€æµ‹æ˜¯å¦æˆåŠŸ</span><span class="token function">npm</span> config get registry æˆ–è€… <span class="token function">npm</span> info express<span class="token comment"># è¿˜åŸ npm çš„ä»“åº“åœ°å€</span><span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npmjs.org/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="mac-ä¸‹å®‰è£…-nvm"><a href="#mac-ä¸‹å®‰è£…-nvm" class="headerlink" title="mac ä¸‹å®‰è£… nvm"></a>mac ä¸‹å®‰è£… nvm</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~<span class="token function">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh <span class="token operator">|</span> <span class="token function">bash</span><span class="token comment"># æ·»åŠ ç¯å¢ƒå˜é‡</span><span class="token function">vim</span> ~/.zshrc<span class="token comment"># æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå¦‚æœæ˜¯å®‰è£…è¿‡ oh-my-zsh </span><span class="token builtin class-name">export</span> <span class="token assign-left variable">NVM_DIR</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">${XDG_CONFIG_HOME-}</span>"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">printf</span> %s <span class="token string">"<span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.nvm"</span> <span class="token operator">||</span> <span class="token builtin class-name">printf</span> %s <span class="token string">"<span class="token variable">${XDG_CONFIG_HOME}</span>/nvm"</span><span class="token variable">)</span></span>"</span><span class="token punctuation">[</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$NVM_DIR</span>/nvm.sh"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>. <span class="token string">"<span class="token variable">$NVM_DIR</span>/nvm.sh"</span> <span class="token comment"># This loads nvm</span><span class="token comment"># å¦‚æœæ²¡æœ‰å®‰è£… oh-my-zsh æ—¶ï¼Œç›´æ¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ·»åŠ ä¹Ÿå¯ä»¥ï¼Œå°±ç®—æ˜¯å·²ç»å®‰è£…äº† oh-my-zsh ä¹Ÿå¯ä»¥è¿™ä¹ˆæ“ä½œï¼Œä¸å†²çª</span><span class="token function">vim</span> ~/.bashrc<span class="token builtin class-name">export</span> <span class="token assign-left variable">NVM_DIR</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$HOME</span>/.nvm"</span><span class="token punctuation">[</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$NVM_DIR</span>/nvm.sh"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>. <span class="token string">"<span class="token variable">$NVM_DIR</span>/nvm.sh"</span>  <span class="token comment"># This loads nvm</span><span class="token punctuation">[</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$NVM_DIR</span>/bash_completion"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>. <span class="token string">"<span class="token variable">$NVM_DIR</span>/bash_completion"</span>  <span class="token comment"># This loads nvm bash_completion</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="nvm-ç›¸å…³å‘½ä»¤"><a href="#nvm-ç›¸å…³å‘½ä»¤" class="headerlink" title="nvm ç›¸å…³å‘½ä»¤"></a>nvm ç›¸å…³å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ nvm ç‰ˆæœ¬å·</span>nvm <span class="token parameter variable">-v</span><span class="token comment"># windows ä¸‹æŸ¥çœ‹å¯å®‰è£…çš„ node.js ç‰ˆæœ¬</span>nvm list available<span class="token comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ node.js</span>nvm <span class="token function">install</span> <span class="token number">10.15</span>.0<span class="token comment"># ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ node.js</span>nvm use <span class="token number">10.15</span>.0<span class="token comment"># ç‰ˆæœ¬åˆ‡æ¢</span>nvm <span class="token function">install</span> <span class="token number">8.11</span>.2  <span class="token comment"># æ¯”å¦‚å…ˆå®‰è£… 8.11.2 çš„ç‰ˆæœ¬ï¼Œç„¶ååˆ‡æ¢åˆ° 8.11.2</span>nvm use <span class="token number">8.11</span>.2<span class="token comment"># æŸ¥çœ‹å½“å‰å·²å®‰è£…çš„ node.js</span>nvm list<span class="token comment"># åˆ é™¤æŒ‡å®šç‰ˆæœ¬çš„ node.js</span>nvm uninstall <span class="token number">8.11</span>.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> NPM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NVM </tag>
            
            <tag> NPM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python æ›´æ”¹ pip æºè‡³å›½å†…é•œåƒ</title>
      <link href="posts/fbd0fa96.html"/>
      <url>posts/fbd0fa96.html</url>
      
        <content type="html"><![CDATA[<h1 id="Windows-æˆ–-Linux-æ›´æ”¹-pip-æºè‡³å›½å†…é•œåƒ"><a href="#Windows-æˆ–-Linux-æ›´æ”¹-pip-æºè‡³å›½å†…é•œåƒ" class="headerlink" title="Windows æˆ– Linux æ›´æ”¹ pip æºè‡³å›½å†…é•œåƒ"></a>Windows æˆ– Linux æ›´æ”¹ pip æºè‡³å›½å†…é•œåƒ</h1><h2 id="Linuxï¼š"><a href="#Linuxï¼š" class="headerlink" title="Linuxï¼š"></a>Linuxï¼š</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/.pip<span class="token function">cat</span> <span class="token operator">&gt;</span> ~/.pip/pip.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF[global]trusted-host=mirrors.aliyun.comindex-url=https://mirrors.aliyun.com/pypi/simple/EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ä¸‹è½½å®‰è£…åŒ…çš„æ—¶å€™ç›´æ¥æ¥æºä¿¡æ¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip3 <span class="token function">install</span> <span class="token assign-left variable">aiohttp</span><span class="token operator">==</span><span class="token number">3.6</span>.2 <span class="token parameter variable">-i</span> https://pypi.douban.com/simple/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Windowsï¼š"><a href="#Windowsï¼š" class="headerlink" title="Windowsï¼š"></a>Windowsï¼š</h2><p>é¦–å…ˆåœ¨ window çš„æ–‡ä»¶å¤¹çª—å£è¾“å…¥ ï¼š %APPDATA%<br>ç„¶ååˆ›å»º pip æ–‡ä»¶å¤¹<br>æœ€ååˆ›å»º pip.ini æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">[global]index-url = https://mirrors.aliyun.com/pypi/simple/[install]trusted-host=mirrors.aliyun.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å››èˆå…­å…¥äº”æˆåŒ-é“¶è¡Œå®¶èˆå…¥ç®—æ³•</title>
      <link href="posts/277fd645.html"/>
      <url>posts/277fd645.html</url>
      
        <content type="html"><![CDATA[<h1 id="å››èˆå…­å…¥äº”æˆåŒ-é“¶è¡Œå®¶ç®—æ³•"><a href="#å››èˆå…­å…¥äº”æˆåŒ-é“¶è¡Œå®¶ç®—æ³•" class="headerlink" title="å››èˆå…­å…¥äº”æˆåŒ-é“¶è¡Œå®¶ç®—æ³•"></a>å››èˆå…­å…¥äº”æˆåŒ-é“¶è¡Œå®¶ç®—æ³•</h1><p>å››èˆå…­å…¥äº”æˆåŒæ˜¯ä¸€ç§æ¯”è¾ƒç²¾ç¡®æ¯”è¾ƒç§‘å­¦çš„è®¡æ•°ä¿ç•™æ³•ï¼Œæ˜¯ç”± <code>IEEE 754</code> æ ‡å‡†è§„å®šçš„æµ®ç‚¹æ•°å–æ•´ç®—æ³•, æ˜¯ä¸€ç§æ•°å­—ä¿®çº¦è§„åˆ™ã€‚</p><p>å½“èˆå»ä½çš„æ•°å€¼ï¼š</p><ul><li>å°äºç­‰äº 4 æ—¶ï¼šç›´æ¥èˆå»è¯¥ä½</li><li>å¤§äºç­‰äº 6 æ—¶ï¼šå‘å‰ä½è¿› 1</li><li>ç­‰äº 5 æ—¶ï¼š<ul><li>5 åæœ‰æ•°ï¼Œå‘å‰ä½è¿› 1</li><li>5 åå…¨éƒ¨ä¸º 0 æ—¶ï¼š<ul><li>5 å‰çš„æ•°å€¼ä¸ºå¥‡æ•°æ—¶ï¼šåˆ™å‘å‰ä½è¿› 1 ï¼ˆå°†å‰ä½å‡‘æˆå¶æ•°ï¼‰</li><li>5 å‰çš„æ•°å€¼ä¸ºå¶æ•°æ—¶ï¼šåˆ™ç›´æ¥èˆå»è¯¥ä½</li></ul></li></ul></li></ul><p>å£è¯€ï¼š</p><p>å››èˆå…­å…¥äº”è€ƒè™‘ï¼Œ<br>äº”åéé›¶å°±è¿›ä¸€ï¼Œ<br>äº”åçš†é›¶çœ‹å¥‡å¶ï¼Œ<br>äº”å‰ä¸ºå¶åº”èˆå»ï¼Œ<br>äº”å‰ä¸ºå¥‡è¦è¿›ä¸€ã€‚</p><h2 id="php-å®ç°"><a href="#php-å®ç°" class="headerlink" title="php å®ç°"></a>php å®ç°</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">formatFloat</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token variable">$precision</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token variable">$precision</span><span class="token punctuation">,</span> <span class="token constant">PHP_ROUND_HALF_EVEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">formatFloat</span><span class="token punctuation">(</span><span class="token number">9.8249</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// outputï¼š9.82  å››èˆ</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">formatFloat</span><span class="token punctuation">(</span><span class="token number">9.82671</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// outputï¼š9.83  å…­å…¥</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">formatFloat</span><span class="token punctuation">(</span><span class="token number">9.8351</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// outputï¼š9.84  äº”åéé›¶å°±è¿›ä¸€</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">formatFloat</span><span class="token punctuation">(</span><span class="token number">9.82501</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// outputï¼š9.83  äº”åéé›¶å°±è¿›ä¸€</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">formatFloat</span><span class="token punctuation">(</span><span class="token number">9.8250</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// outputï¼š9.82  äº”åä¸ºé›¶çœ‹å¥‡å¶ï¼Œäº”å‰ä¸ºå¶åº”èˆå»ï¼ˆè¿™é‡Œå°±è¿èƒŒäº†å››èˆäº”å…¥ï¼‰</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">formatFloat</span><span class="token punctuation">(</span><span class="token number">9.8350</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>  <span class="token comment">// outputï¼š9.84  äº”åä¸ºé›¶çœ‹å¥‡å¶ï¼Œäº”å‰ä¸ºå¥‡è¦è¿›ä¸€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="js-å®ç°"><a href="#js-å®ç°" class="headerlink" title="js å®ç°"></a>js å®ç°</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fomatFloat</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> precision</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>num <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python æ­å»ºç¯å¢ƒä¸å®‰è£… pip æ‰©å±•</title>
      <link href="posts/ee47ba79.html"/>
      <url>posts/ee47ba79.html</url>
      
        <content type="html"><![CDATA[<h1 id="Python-æ­å»ºç¯å¢ƒä¸å®‰è£…-pip-æ‰©å±•"><a href="#Python-æ­å»ºç¯å¢ƒä¸å®‰è£…-pip-æ‰©å±•" class="headerlink" title="Python æ­å»ºç¯å¢ƒä¸å®‰è£… pip æ‰©å±•"></a>Python æ­å»ºç¯å¢ƒä¸å®‰è£… pip æ‰©å±•</h1><blockquote><p><a href="http://www.pythontutor.com/live.html#mode=edit">python åœ¨çº¿è¿è¡Œç½‘ç«™</a></p></blockquote><h2 id="Mac-ä¸‹å®‰è£…"><a href="#Mac-ä¸‹å®‰è£…" class="headerlink" title="Mac ä¸‹å®‰è£…"></a>Mac ä¸‹å®‰è£…</h2><h3 id="mac-ä¸Šå®‰è£…-python"><a href="#mac-ä¸Šå®‰è£…-python" class="headerlink" title="mac ä¸Šå®‰è£… python"></a><a href="https://www.python.org/downloads/">mac ä¸Šå®‰è£… python</a></h3><p>å¯ä»¥ç›´æ¥é€šè¿‡ä¸‹è½½å®˜ç½‘çš„<a href="https://docs.python.org/zh-cn/3/using/mac.html">å®‰è£…å™¨</a>è¿›è¡Œå®‰è£…ã€‚</p><p>æˆ–è€…ä½¿ç”¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> python3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="mac-ä¸‹ä½¿ç”¨-pip"><a href="#mac-ä¸‹ä½¿ç”¨-pip" class="headerlink" title="mac ä¸‹ä½¿ç”¨ pip"></a><a href="https://pip.pypa.io/en/stable/quickstart/">mac ä¸‹ä½¿ç”¨ pip</a></h3><p>å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>python3 -m pip â€¦â€¦</code> å‘½ä»¤</p><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹ pip ç‰ˆæœ¬python3 -m pip --version# å‡çº§ pip ç‰ˆæœ¬/Library/Frameworks/Python.framework/Versions/3.8/bin/python3 -m pip install --upgrade pip# æœç´¢æ’ä»¶åŒ… querypython -m pip search "query"# å®‰è£… SomePackage åŒ…python3 -m pip install SomePackage            # latest versionpython3 -m pip install SomePackage==1.0.4     # specific versionpython3 -m pip install 'SomePackage&gt;=1.0.4'     # minimum version# å®‰è£…å·²ç»é€šè¿‡ [PyPI](https://pypi.org/) ä¸‹è½½å¥½çš„åŒ…ï¼ˆè¿™åœ¨æ²¡æœ‰ç½‘çš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼‰python3 -m pip install SomePackage-1.0-py2.py3-none-any.whl# æ˜¾ç¤ºå·²å®‰è£…åŒ…çš„è¯¦ç»†ä¿¡æ¯python3 -m pip show --files SomePackage# åˆ—å‡ºå“ªäº›åŒ…å·²ç»å­˜åœ¨äº†æ–°ç‰ˆæœ¬python3 -m pip list --outdated# å‡çº§åŒ…ç‰ˆæœ¬python3 -m pip install --upgrade SomePackage# å¸è½½åŒ…python3 -m pip uninstall SomePackage<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæƒ³ç›´æ¥ä½¿ç”¨ <code>pip</code> å‘½ä»¤æ—¶ï¼Œåˆ™éœ€è¦å¦‚ä¸‹æ“ä½œï¼Œ<a href="https://pip.pypa.io/en/stable/installing/">å®˜ç½‘å®‰è£… pip æ­¥éª¤æ–‡æ¡£</a></p><pre class="line-numbers language-none"><code class="language-none"># å®‰è£… get-pip.py è„šæœ¬curl https://bootstrap.pypa.io/get-pip.py | python3# æŸ¥çœ‹ pip ç‰ˆæœ¬pip --version æˆ–è€… pip3 --version# æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…pip list æˆ–è€… pip3 list# æ›´æ–° pip ç‰ˆæœ¬pip install --upgrade pip æˆ–è€… pip3 install --upgrade pip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ç”Ÿæˆ requirements æ–‡ä»¶</span>pip freeze <span class="token operator">&gt;</span> requirements<span class="token punctuation">.</span>txt<span class="token comment"># å®‰è£… requirements.txt ä¾èµ–å‘½ä»¤</span>pip install <span class="token operator">-</span>r requirements<span class="token punctuation">.</span>txt<span class="token comment"># å¸è½½ requirements.txt æ–‡ä»¶ä¸­çš„ä¾èµ–</span>pip uninstall <span class="token operator">-</span>y <span class="token operator">-</span>r requirements<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Windows-ä¸‹å®‰è£…èƒŒæ™¯"><a href="#Windows-ä¸‹å®‰è£…èƒŒæ™¯" class="headerlink" title="Windows ä¸‹å®‰è£…èƒŒæ™¯"></a>Windows ä¸‹å®‰è£…èƒŒæ™¯</h2><p>ç³»ç»Ÿ windows7 64ä½ï¼Œå®‰è£…çš„ python ç‰ˆæœ¬ä¸º 3.6.7 ï¼Œæ­¤æ–‡æ¡£ä¸ºè¿‡ç¨‹æ€»ç»“ã€‚</p><h2 id="Python-ä¸-pip-ä¸‹è½½ä¸å®‰è£…"><a href="#Python-ä¸-pip-ä¸‹è½½ä¸å®‰è£…" class="headerlink" title="Python ä¸ pip ä¸‹è½½ä¸å®‰è£…"></a>Python ä¸ pip ä¸‹è½½ä¸å®‰è£…</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><ul><li>è¿›å…¥ <code>https://www.python.org/</code> é€‰æ‹©  <code>downloads</code></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0e913bc27da7cfc2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®˜ç½‘é¦–é¡µ"></p><ul><li>é€‰æ‹© 3.6.7 ç‰ˆæœ¬</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-da7102d7d5108480.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©3.6.7ç‰ˆæœ¬"></p><ul><li>æ‹‰åˆ°å±å¹•åº•éƒ¨ï¼Œé€‰æ‹©<ul><li>Windows x86-64 executable installer<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4a7bf34585ea3e31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©64ä½å®‰è£…åŒ…"></li></ul></li></ul><h3 id="Windows-ä¸‹å®‰è£…"><a href="#Windows-ä¸‹å®‰è£…" class="headerlink" title="Windows ä¸‹å®‰è£…"></a>Windows ä¸‹å®‰è£…</h3><ul><li>ç›´æ¥å¯¹ä¸‹è½½å¥½çš„å®‰è£…åŒ…åŒè¿›è¿è¡Œ (Install Python 3.6.7(64-bit) )<ul><li>é€‰æ‹©è‡ªå®šä¹‰å®‰è£…ï¼ˆCustomize installationï¼‰</li><li>å‹¾é€‰ add python3.6 to pathï¼ˆè‡ªåŠ¨æ·»åŠ ç¯å¢ƒå˜é‡ï¼‰</li><li>ä¸‹ä¸€æ­¥</li></ul></li><li>å‹¾é€‰ (Optional Features)<ul><li>document</li><li>pipï¼ˆå¿…é¡»é€‰ï¼‰</li><li>.. å…¶ä»–çš„å¤šè£…æ€»æ¯”å°‘è£…å¼º</li><li>ä¸‹ä¸€æ­¥</li></ul></li><li>é€‰æ‹©å®‰è£…è·¯å¾„ ï¼ˆAdvanced Optionsï¼‰<ul><li>å®‰è£…è·¯å¾„ï¼Œc:\python\Python3.6ï¼ˆå¯è‡ªè¡Œå®šä¹‰ Browseï¼‰</li><li>å®‰è£… ï¼ˆInstallï¼‰</li></ul></li><li>å®‰è£…å®Œæˆ</li></ul><h3 id="æ£€æŸ¥å®‰è£…æ•ˆæœ"><a href="#æ£€æŸ¥å®‰è£…æ•ˆæœ" class="headerlink" title="æ£€æŸ¥å®‰è£…æ•ˆæœ"></a>æ£€æŸ¥å®‰è£…æ•ˆæœ</h3><ul><li>å¼€å§‹ï¼Œè¿è¡Œï¼Œè¿›å…¥cmdå‘½ä»¤è¡Œ</li><li>æ•²å‘½ä»¤ python<ul><li>windodws ç”¨ ctrl+z é€€å‡ºäº¤äº’ç•Œé¢</li></ul></li><li>æ•²å‘½ä»¤ pip<ul><li>å‘½ä»¤å­˜åœ¨</li></ul></li><li>å¦‚æœæç¤ºå‘½ä»¤ä¸å­˜åœ¨<ul><li>å¾ˆå¯èƒ½æ˜¯ä½ çš„ ç¯å¢ƒå˜é‡æœªè®¾ç½®å¥½</li></ul></li></ul><h2 id="å®‰è£…-pipenv"><a href="#å®‰è£…-pipenv" class="headerlink" title="å®‰è£… pipenv"></a>å®‰è£… pipenv</h2><p>å®ƒæ˜¯ä¸€ä¸ªé¡¹ç›®è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ã€‚</p><h3 id="åˆ©ç”¨-pip-å®‰è£…"><a href="#åˆ©ç”¨-pip-å®‰è£…" class="headerlink" title="åˆ©ç”¨ pip å®‰è£…"></a>åˆ©ç”¨ pip å®‰è£…</h3><p><code>pip install pipenv</code></p><p>æ‰§è¡Œè¯¥å‘½ä»¤è‡ªåŠ¨è¿›å…¥ä¸‹è½½å®‰è£…è¿‡ç¨‹ã€‚</p><h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><ul><li>åœ¨ç”µè„‘ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ I:\Python\test</li><li>åœ¨å‘½ä»¤è¡Œåˆ‡æ¢åˆ°æ­¤<ul><li>cmd: cd  I:\Python\test</li></ul></li><li>æ‰§è¡Œ pipenv çš„åˆå§‹åŒ–å‘½ä»¤<ul><li>pipenv â€“python 3.6</li></ul></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0742c148428484a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰§è¡Œ pipenv åˆå§‹åŒ–å‘½ä»¤ä¹‹åçš„ç”»é¢"></p><ul><li>è¿›å…¥ pipenv çš„è™šæ‹Ÿç¯å¢ƒ<ul><li>pipenv shell</li></ul></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b40a5bcc9c69f618.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿›å…¥ pipenv çš„è™šæ‹Ÿç¯å¢ƒ"></p><ul><li>å®‰è£…ä¸€ä¸ªåº“è¯•è¯•<ul><li>pip install requests</li></ul></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d2ac78cb65d7f691.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£… requests åº“ç•Œé¢"></p><ul><li>è™šæ‹ŸåŒ–ç¯å¢ƒå­˜æ”¾è·¯å¾„<ul><li>é»˜è®¤ c:\users\administrator.vi*****</li></ul></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1cd80d6ed3238a66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ¬æ¬¡å®‰è£…è™šæ‹ŸåŒ–ç¯å¢ƒå­˜æ”¾è·¯å¾„"></p><ul><li>OK End</li></ul><h2 id="ä¸‹è½½ä½¿ç”¨-pycharm"><a href="#ä¸‹è½½ä½¿ç”¨-pycharm" class="headerlink" title="ä¸‹è½½ä½¿ç”¨ pycharm"></a>ä¸‹è½½ä½¿ç”¨ pycharm</h2><p>ç›´æ¥å»å®˜ç½‘ä¸‹è½½ windows çš„ proç‰ˆæœ¬ã€‚</p><p>åœ°å€ <a href="http://www.jetbrains.com/pycharm/download/">http://www.jetbrains.com/pycharm/download/</a><br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-120aa374788beefc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½ Pro ç‰ˆæœ¬"></p><h3 id="åˆ›å»ºé¡¹ç›®-1"><a href="#åˆ›å»ºé¡¹ç›®-1" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><p>ç›´æ¥é€‰æ‹©æˆ‘ä»¬åˆšåˆšçš„é¡¹ç›®è·¯å¾„ <code>I:\Python\test</code></p><h3 id="è®©é¡¹ç›®ä½¿ç”¨pipenvçš„è™šæ‹Ÿç¯å¢ƒ"><a href="#è®©é¡¹ç›®ä½¿ç”¨pipenvçš„è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="è®©é¡¹ç›®ä½¿ç”¨pipenvçš„è™šæ‹Ÿç¯å¢ƒ"></a>è®©é¡¹ç›®ä½¿ç”¨pipenvçš„è™šæ‹Ÿç¯å¢ƒ</h3><p><code>file -&gt; setting -&gt; project:test</code></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ac306de03f065e51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¦‚å›¾æ‰€ç¤º"></p><p>è¿›ä¸€æ­¥é€‰æ‹© <code>interperter</code> åœ¨ä¸‹æ‹‰é€‰å•ä¸­é€‰ä¸­æˆ‘ä»¬åˆšåˆšçš„è™šæ‹ŸåŒ–ç¯å¢ƒç›®å½•å³å¯ã€‚<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-175faf09036cc3a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©ä¸Šæ–‡ä¸­åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒç›®å½•"></p><h3 id="interperter-ä¸­æ²¡æœ‰æ€ä¹ˆåŠï¼Ÿ"><a href="#interperter-ä¸­æ²¡æœ‰æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="interperter ä¸­æ²¡æœ‰æ€ä¹ˆåŠï¼Ÿ"></a>interperter ä¸­æ²¡æœ‰æ€ä¹ˆåŠï¼Ÿ</h3><p>ä¸‹æ‹‰é€‰å•ä¸­ï¼Œé€‰æ‹© <code>show all</code><br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6828f88cd9937443.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¬¬ä¸€æ­¥ï¼š interperter ä¸­æ²¡æœ‰çš„è¯ï¼Œç‚¹å‡»ä¸‹æ‹‰é€‰å•ä¹‹åé€‰æ‹© show all"><br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6171dcff4886c3bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¬¬äºŒæ­¥ï¼šç‚¹å‡»åŠ å·+"><br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e6d11f9351337be9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©å·²ç»å­˜åœ¨çš„ï¼Œä¸è¦é€‰æ‹©æ–°å»ºçš„"></p><p>ç„¶ååœ¨ existing environmentï¼Œåœ¨å³ä¾§<code>...</code>é€‰ä¸­è™šæ‹Ÿç¯å¢ƒçš„ python.exe å³å¯ã€‚<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3b5e2bdbeb07032e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¬¬å››æ­¥ï¼šé€‰æ‹©å·²å­˜åœ¨çš„ä¹‹åç‚¹å‡»æœ€å³è¾¹çš„ â€¦"><br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-87dab8f9313b439e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¬¬äº”æ­¥ï¼šé€‰æ‹© python.exe æ—¢å¯"><br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤è·¯å¾„ï¼š</p><p><code>c:\users\administrator\.virtualenvs\é¡¹ç›®å\Scripts\python.exe</code></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-61e21223cf87bdf2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ‡è®°åˆ‡è®°ï¼ï¼ï¼"></p><p>ç„¶åä¸€ç›´ç‚¹ ok å³å¯<br>æ•ˆæœå¦‚ä¸‹<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-78490ce15425ed18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯ä»¥çœ‹åˆ°ä¼šå‡ºç°ä¸¤ä¸ªè™šæ‹Ÿç¯å¢ƒçš„é€‰é¡¹"><br>æœ€ç»ˆå¯ä»¥çœ‹åˆ°ç¼–è¾‘å™¨ä¸­åŒ…å«äº†åˆšåˆšåˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8260285f4c846b36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="çœ‹åˆ°è¿™é‡Œè¯æ˜ç¼–è¾‘å™¨é…ç½®æˆåŠŸäº†"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæ•´ä¸ªé¡¹ç›®ç¯å¢ƒé…ç½®å®Œæ¯•ã€‚</p><p>ä»¥åæˆ‘ä»¬æ‰€æœ‰å¯¹é¡¹ç›®çš„å‘½ä»¤è¡Œæ“ä½œéƒ½éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•å…ˆè¿›å…¥ <code>pipenv shell</code> ç„¶åå†æ‰§è¡Œå‘½ä»¤æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥ä½¿å¾—æ¯ä¸€ä¸ªé¡¹ç›®å®‰è£…ç‹¬ç«‹çš„å®‰è£…åŒ…ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx å¼€å¯ gzip å‹ç¼©</title>
      <link href="posts/63bed376.html"/>
      <url>posts/63bed376.html</url>
      
        <content type="html"><![CDATA[<h1 id="nginx-å¼€å¯-gzip-å‹ç¼©"><a href="#nginx-å¼€å¯-gzip-å‹ç¼©" class="headerlink" title="nginx å¼€å¯ gzip å‹ç¼©"></a>nginx å¼€å¯ gzip å‹ç¼©</h1><blockquote><p>åœ¨æœåŠ¡å™¨ Nginx å¼€å¯ gzip å‹ç¼©æ˜¯ä¼˜åŒ–ç½‘ç«™æ€§èƒ½çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘æœåŠ¡å™¨å¸¦å®½çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯ä¼šå¢å¤§ CPU çš„å ç”¨ç‡ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ CPU å¾€å¾€æ˜¯ç©ºé—²æœ€å¤šçš„ã€‚</p></blockquote><p>åœ¨ nginx ä¸­å¼€å¯ gzip å‹ç¼©ï¼Œéœ€è¦ç¼–è¾‘ nginx.conf æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1k</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">64k</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">9</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="gzip-å‚æ•°ä»‹ç»"><a href="#gzip-å‚æ•°ä»‹ç»" class="headerlink" title="gzip å‚æ•°ä»‹ç»"></a>gzip å‚æ•°ä»‹ç»</h2><h3 id="gizp-on-off"><a href="#gizp-on-off" class="headerlink" title="gizp on|off;"></a>gizp on|off;</h3><p>å¼€å¯æˆ–è€…å…³é—­ gzip æ¨¡å—</p><h3 id="gzip-min-length-1k"><a href="#gzip-min-length-1k" class="headerlink" title="gzip_min_length 1k;"></a>gzip_min_length 1k;</h3><p>è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä» header å¤´ä¸­çš„ Content-Length ä¸­è¿›è¡Œè·å–ã€‚é»˜è®¤å€¼æ˜¯ 0ï¼Œä¸ç®¡é¡µé¢å¤šå¤§éƒ½å‹ç¼©ã€‚å»ºè®®è®¾ç½®æˆå¤§äº 1k çš„å­—èŠ‚æ•°ï¼Œå°äº 1k å¯èƒ½ä¼šè¶Šå‹è¶Šå¤§ã€‚ å³: gzip_min_length 1024</p><h3 id="gzip-proxied-expired-no-cache-no-store-private-auth"><a href="#gzip-proxied-expired-no-cache-no-store-private-auth" class="headerlink" title="gzip_proxied expired no-cache no-store private auth;"></a>gzip_proxied expired no-cache no-store private auth;</h3><p>Nginx ä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™å¯ç”¨ï¼Œå¼€å¯æˆ–è€…å…³é—­åç«¯æœåŠ¡å™¨è¿”å›çš„ç»“æœï¼ŒåŒ¹é…çš„å‰ææ˜¯åç«¯æœåŠ¡å™¨å¿…é¡»è¦è¿”å›åŒ…å«â€Viaâ€ çš„ header å¤´ã€‚</p><h3 id="gzip-types-text-plain-application-xml"><a href="#gzip-types-text-plain-application-xml" class="headerlink" title="gzip_types text/plain application/xml;"></a>gzip_types text/plain application/xml;</h3><p>åŒ¹é… MIME ç±»å‹è¿›è¡Œå‹ç¼©ï¼Œï¼ˆæ— è®ºæ˜¯å¦æŒ‡å®šï¼‰â€text/htmlâ€ ç±»å‹æ€»æ˜¯ä¼šè¢«å‹ç¼©çš„ã€‚</p><h2 id="å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²ç»å¼€å¯äº†-gzip-å‹ç¼©ï¼Ÿ"><a href="#å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²ç»å¼€å¯äº†-gzip-å‹ç¼©ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²ç»å¼€å¯äº† gzip å‹ç¼©ï¼Ÿ"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²ç»å¼€å¯äº† gzip å‹ç¼©ï¼Ÿ</h2><p>æ‰“å¼€æµè§ˆå™¨ï¼ŒæŒ‰ä½ f12 æŸ¥çœ‹ Content-Encoding å­—æ®µå¦‚æœæ˜¯ gzipï¼Œè¡¨ç¤ºè¯¥ç½‘é¡µçš„ body æ•°æ®æ˜¯ç»è¿‡ gzip å‹ç¼©çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> gzip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP RSA åŠ è§£å¯†</title>
      <link href="posts/f7924170.html"/>
      <url>posts/f7924170.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP-RSA-åŠ è§£å¯†"><a href="#PHP-RSA-åŠ è§£å¯†" class="headerlink" title="PHP RSA åŠ è§£å¯†"></a>PHP RSA åŠ è§£å¯†</h1><p>æœ€è¿‘åœ¨åšæ”¯ä»˜å®çš„è·¨å¢ƒæ”¯ä»˜ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ª composer åŒ…ï¼Œé‡Œé¢æ¶‰åŠåˆ° RSA åŠ å¯†ï¼Œä»¥åŠéªŒç­¾ï¼Œæ•…åˆ†äº«ä¹‹ã€‚ä¹Ÿæ–¹ä¾¿ä»¥åè‡ªå·±éšæ—¶æ‹¿è¿‡æ¥ç”¨ ğŸ˜ƒ</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * RSA åŠ è§£å¯† * * å¯ä»¥çº¿ä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥çš„ç½‘ç«™ï¼š http://www.metools.info/code/c80.html */</span><span class="token comment">/** * RSA ç­¾å * * @param string $data å¾…ç­¾åæ•°æ® * @param string $privateKeyPath ç§é’¥æ–‡ä»¶è·¯å¾„ * @return string */</span><span class="token keyword">function</span> <span class="token function-definition function">rsaSign</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$privateKeyPath</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">{</span>    <span class="token variable">$priKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$privateKeyPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">openssl_get_privatekey</span><span class="token punctuation">(</span><span class="token variable">$priKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">openssl_sign</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$sign</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">openssl_free_key</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sign</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$sign</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$sign</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * RSA éªŒç­¾ * * @param string $data å¾…ç­¾åæ•°æ® * @param string $aliPublicKeyPath å…¬é’¥æ–‡ä»¶è·¯å¾„ * @param string $sign è¦æ ¡å¯¹çš„ç­¾åæ•°æ® * @return bool */</span><span class="token keyword">function</span> <span class="token function-definition function">rsaVerify</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$aliPublicKeyPath</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$sign</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token punctuation">{</span>    <span class="token variable">$pubKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$aliPublicKeyPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">openssl_get_publickey</span><span class="token punctuation">(</span><span class="token variable">$pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">bool</span><span class="token punctuation">)</span><span class="token function">openssl_verify</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$sign</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">openssl_free_key</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * RSA è§£å¯† * * @param string $content éœ€è¦è§£å¯†çš„å¯†æ–‡æ•°æ® * @param string $privateKeyPath  ç§é’¥æ–‡ä»¶è·¯å¾„ * @return string  è§£å¯†åçš„æ˜æ–‡å†…å®¹ */</span><span class="token keyword">function</span> <span class="token function-definition function">rsaDecrypt</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$privateKeyPath</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">{</span>    <span class="token variable">$priKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$privateKeyPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">openssl_get_privatekey</span><span class="token punctuation">(</span><span class="token variable">$priKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç”¨ base64 å°†å†…å®¹è¿˜åŸæˆäºŒè¿›åˆ¶</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æŠŠéœ€è¦è§£å¯†çš„å†…å®¹ï¼ŒæŒ‰ 128 ä½æ‹†å¼€è§£å¯†</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">openssl_private_decrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$decrypt</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token variable">$decrypt</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">openssl_free_key</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å‡è®¾éœ€è¦å¯¹å¦‚ä¸‹è¿™æ®µå­—ç¬¦ä¸²åŠ è§£å¯†</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'aa=123&amp;bb=456&amp;cc=789&amp;dd=1212'</span><span class="token punctuation">;</span><span class="token comment">// osrx0siWqK0+5C6ANNk/2pqEYoWa74UzFsUPFfv5FnhrOU9abyup+h2AY/4LqlSnvH9ztBcx//EpdJI9yI/xnfB14LdiDrPH1bJUJ5oJMafAo4QxL47eAPKT8ZKbufKg+YTf8kx7xnJ5kSyxcHzzhZyVvth4pGstFTUeL/5RpGRxlOQj/viHLkocYM2h1hzunqvcHWKzQqTdmi8g9atxDLPrASdTdolsD0TYbFj4Bn1S/0ziomcesz3IFi0CO6UsSM2N1jBOdtmhrecxv6WcUAgy3y9B7o4vF3hGG7HuhD437bO0XVWMrJ2NcRHhiQolMi6zmeX50ZLUSI63ve7ucA==</span><span class="token variable">$mySign</span> <span class="token operator">=</span> <span class="token function">rsaSign</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'./private_key.pem'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$is</span> <span class="token operator">=</span> <span class="token function">rsaVerify</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'./public_key.pem'</span><span class="token punctuation">,</span> <span class="token variable">$mySign</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$decryptStr</span> <span class="token operator">=</span> <span class="token function">rsaDecrypt</span><span class="token punctuation">(</span><span class="token variable">$mySign</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'./private_key.pem'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$mySign</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$is</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$decryptStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ laradock å®‰è£… elasticsearch</title>
      <link href="posts/deba288d.html"/>
      <url>posts/deba288d.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-Laradock-å®‰è£…-ElasticSearch"><a href="#ä½¿ç”¨-Laradock-å®‰è£…-ElasticSearch" class="headerlink" title="ä½¿ç”¨ Laradock å®‰è£… ElasticSearch"></a>ä½¿ç”¨ Laradock å®‰è£… ElasticSearch</h1><ul><li><a href="https://github.com/ElasticHQ/elasticsearch-HQ">ElasticSearch å¯è§†åŒ–å·¥å…· ElasticHQ</a> / <a href="http://www.elastichq.org/">å®˜ç½‘åœ°å€</a></li></ul><h2 id="å®‰è£…å’Œä½¿ç”¨"><a href="#å®‰è£…å’Œä½¿ç”¨" class="headerlink" title="å®‰è£…å’Œä½¿ç”¨"></a>å®‰è£…å’Œä½¿ç”¨</h2><ol><li>ä½¿ç”¨ <code>docker-compose up</code> å‘½ä»¤è¿è¡Œ <code>ElasticSearch</code> å®¹å™¨</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> elasticsearch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>æ‰“å¼€æµè§ˆå™¨å¹¶é€šè¿‡ç«¯å£ <code>9200</code> è®¿é—®æœ¬åœ°ä¸»æœº <a href="http://localhost:9200/">http://localhost:9200</a></li></ol><blockquote><p>é»˜è®¤ç”¨æˆ·æ˜¯ user ï¼Œé»˜è®¤å¯†ç æ˜¯ changeme</p></blockquote><h2 id="å¦‚æœæ˜¯åœ¨-laradock-ä¸­ä½¿ç”¨æ—¶"><a href="#å¦‚æœæ˜¯åœ¨-laradock-ä¸­ä½¿ç”¨æ—¶" class="headerlink" title="å¦‚æœæ˜¯åœ¨ laradock ä¸­ä½¿ç”¨æ—¶"></a>å¦‚æœæ˜¯åœ¨ laradock ä¸­ä½¿ç”¨æ—¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://elasticsearch:9200<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å®‰è£…-ElasticSearch-æ’ä»¶"><a href="#å®‰è£…-ElasticSearch-æ’ä»¶" class="headerlink" title="å®‰è£… ElasticSearch æ’ä»¶"></a>å®‰è£… ElasticSearch æ’ä»¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…ä¸€ä¸ª ElasticSearch æ’ä»¶</span><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> elasticsearch /usr/share/elasticsearch/bin/elasticsearch-plugin <span class="token function">install</span> <span class="token punctuation">{</span>plugin-name<span class="token punctuation">}</span><span class="token comment"># é‡å¯å®¹å™¨</span><span class="token function">docker-compose</span> restart elasticsearch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-elasticsearch-analysis-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶"><a href="#å®‰è£…-elasticsearch-analysis-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶" class="headerlink" title="å®‰è£… elasticsearch-analysis-ik ä¸­æ–‡åˆ†è¯æ’ä»¶"></a>å®‰è£… <a href="https://github.com/medcl/elasticsearch-analysis-ik">elasticsearch-analysis-ik</a> ä¸­æ–‡åˆ†è¯æ’ä»¶</h3><p>æ¯”å¦‚ï¼Œæ­¤æ—¶éœ€è¦å®‰è£… <a href="https://github.com/medcl/elasticsearch-analysis-ik">elasticsearch-analysis-ik</a> ä¸­æ–‡åˆ†è¯æ’ä»¶ï¼Œéœ€è¦ä¸‹è½½ ik çš„ <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">releases</a> æºç  zip åŒ…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ–¹å¼1ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ elasticsearch å®¹å™¨å¤–ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> elasticsearch /usr/share/elasticsearch/bin/elasticsearch-plugin <span class="token function">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.1/elasticsearch-analysis-ik-7.9.1.zip<span class="token comment"># æ–¹å¼2ï¼Œä½ å¯ä»¥ç›´æ¥è¿›å…¥åˆ° elasticsearch å®¹å™¨å†…ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span>./bin/elasticsearch-plugin <span class="token function">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.1/elasticsearch-analysis-ik-7.9.1.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½ çš„ elasticsearch çš„ç‰ˆæœ¬æ˜¯ 7.9.1 é‚£ä¹ˆï¼Œä½ å®‰è£…çš„ ik æ’ä»¶ä¹Ÿå¿…é¡»æ˜¯ 7.9.1 çš„ç‰ˆæœ¬</strong>ï¼Œelasticsearch çš„ç‰ˆæœ¬å·å¯ä»¥é€šè¿‡è®¿é—® <a href="http://localhost:9200/">http://localhost:9200/</a> æŸ¥çœ‹ <code>version.number</code> å­—æ®µæŸ¥çœ‹ï¼Œç„¶å <code>docker-compose restart elasticsearch</code> é‡å¯ elasticsearch å®¹å™¨å³å¯</p><h4 id="å®‰è£…-elasticsearch-analysis-ik-è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º"><a href="#å®‰è£…-elasticsearch-analysis-ik-è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º" class="headerlink" title="å®‰è£… elasticsearch-analysis-ik è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º"></a>å®‰è£… elasticsearch-analysis-ik è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@f1831cb3b4dd elasticsearch<span class="token punctuation">]</span><span class="token comment"># ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.1/elasticsearch-analysis-ik-7.9.1.zip</span>-<span class="token operator">&gt;</span> Installing https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.1/elasticsearch-analysis-ik-7.9.1.zip-<span class="token operator">&gt;</span> Downloading https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.9.1/elasticsearch-analysis-ik-7.9.1.zip<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">]</span> <span class="token number">100</span>%??@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     WARNING: plugin requires additional permissions     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@* java.net.SocketPermission * connect,resolveSee http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html<span class="token keyword">for</span> descriptions of what these permissions allow and the associated risks.Continue with installation? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>y-<span class="token operator">&gt;</span> Installed analysis-ik<span class="token punctuation">[</span>root@f1831cb3b4dd elasticsearch<span class="token punctuation">]</span><span class="token comment"># ./bin/elasticsearch-plugin list</span>analysis-ik<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹æ’ä»¶åˆ—è¡¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./bin/elasticsearch-plugin list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ElasticSearch-å’Œ-mysql-æ•°æ®åº“çš„æ¦‚å¿µå¯¹æ¯”"><a href="#ElasticSearch-å’Œ-mysql-æ•°æ®åº“çš„æ¦‚å¿µå¯¹æ¯”" class="headerlink" title="ElasticSearch å’Œ mysql æ•°æ®åº“çš„æ¦‚å¿µå¯¹æ¯”"></a>ElasticSearch å’Œ mysql æ•°æ®åº“çš„æ¦‚å¿µå¯¹æ¯”</h2><table><thead><tr><th>MySQL</th><th>Elasticsearch</th></tr></thead><tbody><tr><td>è¡¨ï¼ˆTableï¼‰</td><td>ç´¢å¼•ï¼ˆIndexï¼‰</td></tr><tr><td>è®°å½•ï¼ˆRowï¼‰</td><td>æ–‡æ¡£ï¼ˆDocumentï¼‰</td></tr><tr><td>å­—æ®µï¼ˆColumnï¼‰</td><td>å­—æ®µï¼ˆFieldsï¼‰</td></tr></tbody></table><h2 id="ElasticSearch-çš„ç®€å•ä½¿ç”¨"><a href="#ElasticSearch-çš„ç®€å•ä½¿ç”¨" class="headerlink" title="ElasticSearch çš„ç®€å•ä½¿ç”¨"></a>ElasticSearch çš„ç®€å•ä½¿ç”¨</h2><h3 id="æ–°å»ºç´¢å¼•-index-ï¼ˆåˆ›å»ºè¡¨ï¼‰"><a href="#æ–°å»ºç´¢å¼•-index-ï¼ˆåˆ›å»ºè¡¨ï¼‰" class="headerlink" title="æ–°å»ºç´¢å¼• index ï¼ˆåˆ›å»ºè¡¨ï¼‰"></a>æ–°å»ºç´¢å¼• index ï¼ˆåˆ›å»ºè¡¨ï¼‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-XPUT</span> http://localhost:9200/test_index  <span class="token comment"># åœ¨ Elasticsearch çš„è¿”å›ä¸­å¦‚æœåŒ…å«äº† "acknowledged" : true, åˆ™ä»£è¡¨è¯·æ±‚æˆåŠŸã€‚</span><span class="token punctuation">{</span><span class="token string">"acknowledged"</span>:true,<span class="token string">"shards_acknowledged"</span>:true,<span class="token string">"index"</span><span class="token builtin class-name">:</span><span class="token string">"test_index"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://localhost:9200/test_index<span class="token punctuation">{</span><span class="token string">"test_index"</span>:<span class="token punctuation">{</span><span class="token string">"aliases"</span>:<span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token string">"mappings"</span>:<span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token string">"settings"</span>:<span class="token punctuation">{</span><span class="token string">"index"</span>:<span class="token punctuation">{</span><span class="token string">"creation_date"</span><span class="token builtin class-name">:</span><span class="token string">"1617069458624"</span>,<span class="token string">"number_of_shards"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span>,<span class="token string">"number_of_replicas"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span>,<span class="token string">"uuid"</span><span class="token builtin class-name">:</span><span class="token string">"XKjqatZTSOu9I_PiwzaNOQ"</span>,<span class="token string">"version"</span>:<span class="token punctuation">{</span><span class="token string">"created"</span><span class="token builtin class-name">:</span><span class="token string">"7090199"</span><span class="token punctuation">}</span>,<span class="token string">"provided_name"</span><span class="token builtin class-name">:</span><span class="token string">"test_index"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment"># å¯ä»¥åŠ ä¸Š pretty å‚æ•°ï¼Œè¿”å›æ¯”è¾ƒäººæ€§åŒ–çš„ç»“æ„</span><span class="token function">curl</span> http://localhost:9200/test_index<span class="token punctuation">\</span>?pretty                                                                           <span class="token punctuation">{</span>  <span class="token string">"test_index"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"aliases"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>,    <span class="token string">"mappings"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>,    <span class="token string">"settings"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>      <span class="token string">"index"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>        <span class="token string">"creation_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"1617069458624"</span>,        <span class="token string">"number_of_shards"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,        <span class="token string">"number_of_replicas"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,        <span class="token string">"uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"XKjqatZTSOu9I_PiwzaNOQ"</span>,        <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>          <span class="token string">"created"</span> <span class="token builtin class-name">:</span> <span class="token string">"7090199"</span>        <span class="token punctuation">}</span>,        <span class="token string">"provided_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"test_index"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ›å»ºç±»å‹"><a href="#åˆ›å»ºç±»å‹" class="headerlink" title="åˆ›å»ºç±»å‹"></a>åˆ›å»ºç±»å‹</h3><p>å¯¹åº”çš„æ¥å£åœ°å€æ˜¯ /{index_name}/_mapping</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> -H<span class="token string">'Content-Type: application/json'</span> <span class="token parameter variable">-XPUT</span> http://localhost:9200/test_index/_mapping?pretty -d<span class="token string">'{  "properties": {    "title": { "type": "text", "analyzer": "ik_smart" },     "description": { "type": "text", "analyzer": "ik_smart" },    "price": { "type": "scaled_float", "scaling_factor": 100 }  }}'</span><span class="token comment"># ä¼šè¿”å›</span><span class="token punctuation">{</span>  <span class="token string">"acknowledged"</span> <span class="token builtin class-name">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token function">curl</span> -H<span class="token string">'Content-Type: application/json'</span> <span class="token parameter variable">-XPUT</span> http://localhost:9200/products/_mapping/?pretty -d<span class="token string">'{  "properties": {    "brand_id": { "type": "integer" },    "type": { "type": "integer" },    "title": { "type": "text", "analyzer": "ik_smart" },     "unit": { "type": "keyword" },    "sketch": { "type": "text", "analyzer": "ik_smart" },     "keywords": { "type": "text", "analyzer": "ik_smart" },    "tags": { "type": "keyword" },    "barcode": { "type": "keyword" },    "price": { "type": "scaled_float", "scaling_factor": 100 },    "market_price": { "type": "scaled_float", "scaling_factor": 100 },    "rating": { "type": "float" },    "sold_count": { "type": "integer" },    "review_count": { "type": "integer" },        "virtual_retail_num": { "type": "integer" },    "description": { "type": "text", "analyzer": "ik_smart" },    "stock": { "type": "integer" },        "warning_stock": { "type": "integer" },       "main_image": { "type": "keyword" },    "slider_image": { "type": "keyword" },    "status": { "type": "integer" },    "is_hot": { "type": "integer" },    "sort": { "type": "integer" },    "categories": {      "type": "nested",      "properties": {        "id": { "type": "integer", "copy_to": "categories_id" },        "pid": { "type": "integer" },        "name": { "type": "text", "analyzer": "ik_smart", "copy_to": "categories_name" },         "description": { "type": "text", "analyzer": "ik_smart", "copy_to": "categories_description" },        "status": { "type": "integer" },        "level": { "type": "integer" },        "img": { "type": "keyword" }      }    },        "brand": {      "type": "nested",      "properties": {        "id": { "type": "integer" },        "name": { "type": "text", "analyzer": "ik_smart", "copy_to": "brand_name" },         "description": { "type": "text", "analyzer": "ik_smart", "copy_to": "brand_description" },        "log_url": { "type": "keyword" },        "img": { "type": "keyword" }      }    },          "attrs": {      "type": "nested",      "properties": {        "id": { "type": "integer" },        "name": { "type": "keyword", "copy_to": "attrs_name" }      }    },      "skus": {      "type": "nested",      "properties": {        "id": { "type": "integer" },        "name": { "type": "text", "analyzer": "ik_smart"},         "main_url": { "type": "keyword" },        "price": { "type": "scaled_float", "scaling_factor": 100 },        "sold_count": { "type": "integer" }      }    }  }}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æäº¤æ•°æ®ä¸­çš„ <code>properties</code> ä»£è¡¨è¿™ä¸ªç´¢å¼•ä¸­å„ä¸ªå­—æ®µçš„å®šä¹‰ï¼Œå…¶ä¸­ key ä¸ºå­—æ®µåç§°ï¼Œvalue æ˜¯å­—æ®µçš„ç±»å‹å®šä¹‰</li><li><code>type</code> å®šä¹‰äº†å­—æ®µçš„æ•°æ®ç±»å‹ï¼Œå¸¸ç”¨çš„æœ‰ <code>text</code> / <code>integer</code> / <code>date</code> / <code>boolean</code> ï¼Œè¿˜æœ‰<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">æ›´å¤šç±»å‹</a><ul><li><code>keyword</code>ï¼Œè¿™æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ä¸€ç§ï¼Œè¿™ç§ç±»å‹æ˜¯å‘Šè¯‰ Elasticsearch ä¸éœ€è¦å¯¹è¿™ä¸ªå­—æ®µåšåˆ†è¯ï¼Œé€šå¸¸ç”¨äºé‚®ç®±ã€æ ‡ç­¾ã€å±æ€§ç­‰å­—æ®µã€‚</li><li><code>scaled_float</code> ä»£è¡¨ä¸€ä¸ªå°æ•°ä½å›ºå®šçš„æµ®ç‚¹å‹å­—æ®µï¼Œä¸ Mysql çš„ decimal ç±»å‹ç±»ä¼¼ã€‚</li><li><code>scaling_factor</code> ç”¨æ¥æŒ‡å®šå°æ•°ä½ç²¾åº¦ï¼Œ100 å°±ä»£è¡¨ç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚</li><li><code>nested</code> ä»£è¡¨è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œç”±ä¸‹ä¸€çº§çš„ properties å­—æ®µå®šä¹‰è¿™ä¸ªå¯¹è±¡çš„å­—æ®µã€‚</li></ul></li><li><code>analyzer</code>æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œè¿™æ˜¯å‘Šè¯‰ Elasticsearch åº”è¯¥ç”¨ä»€ä¹ˆæ–¹å¼å»ç»™è¿™ä¸ªå­—æ®µåšåˆ†è¯ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨äº† <code>ik_smart</code>ï¼Œæ˜¯ä¸€ä¸ªä¸­æ–‡åˆ†è¯å™¨ã€‚</li><li><code>copy_to</code>ï¼ŒElasticsearch çš„å¤šå­—æ®µåŒ¹é…æŸ¥è¯¢æ˜¯ä¸æ”¯æŒæŸ¥è¯¢ Nested å¯¹è±¡çš„å­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬åˆå¿…é¡»æŸ¥è¯¢ <code>categories.name</code> å­—æ®µï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>copy_to</code> å‚æ•°ï¼Œå¯ä»¥å°†  <code>categories.name</code> å­—æ®µå¤åˆ¶åˆ°ä¸Šå±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>categories_name</code> å­—æ®µåšå¤šå­—æ®µåŒ¹é…æŸ¥è¯¢</li></ul><h3 id="åˆ›å»ºæ–‡æ¡£"><a href="#åˆ›å»ºæ–‡æ¡£" class="headerlink" title="åˆ›å»ºæ–‡æ¡£"></a>åˆ›å»ºæ–‡æ¡£</h3><p>å¯¹åº”çš„æ¥å£åœ°å€æ˜¯ /{index_name}/_doc/{id} è¿™é‡Œçš„ id å’Œ mysql ä¸­çš„ id ä¸ä¸€æ ·ï¼Œä¸æ˜¯è‡ªå¢çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»º id ä¸º 1 çš„æ–‡æ¡£</span><span class="token function">curl</span> -H<span class="token string">'Content-Type: application/json'</span> <span class="token parameter variable">-XPUT</span> http://localhost:9200/test_index/_doc/1?pretty -d<span class="token string">'{    "title": "iPhone 7P",    "description": "iphone ç¬¬ä¸€æ‰¹åŒæ‘„åƒå¤´",    "price": 6799}'</span><span class="token comment"># ä¼šè¿”å›å¦‚ä¸‹å†…å®¹</span><span class="token punctuation">{</span>  <span class="token string">"_index"</span> <span class="token builtin class-name">:</span> <span class="token string">"test_index"</span>,  <span class="token string">"_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"_doc"</span>,  <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,  <span class="token string">"_version"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,  <span class="token string">"result"</span> <span class="token builtin class-name">:</span> <span class="token string">"created"</span>,  <span class="token string">"_shards"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"total"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,    <span class="token string">"successful"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,    <span class="token string">"failed"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span>,  <span class="token string">"_seq_no"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,  <span class="token string">"_primary_term"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token comment"># åˆ›å»º id ä¸º 2 çš„æ–‡æ¡£</span><span class="token function">curl</span> -H<span class="token string">'Content-Type: application/json'</span> <span class="token parameter variable">-XPUT</span> http://localhost:9200/test_index/_doc/2?pretty -d<span class="token string">'{    "title": "OPPO find x",    "description": "é«˜æ¸…åƒç´ ",    "price": 3499}'</span><span class="token comment"># ä¼šè¿”å›å¦‚ä¸‹å†…å®¹</span><span class="token punctuation">{</span>  <span class="token string">"_index"</span> <span class="token builtin class-name">:</span> <span class="token string">"test_index"</span>,  <span class="token string">"_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"_doc"</span>,  <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>,  <span class="token string">"_version"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,  <span class="token string">"result"</span> <span class="token builtin class-name">:</span> <span class="token string">"created"</span>,  <span class="token string">"_shards"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"total"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,    <span class="token string">"successful"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,    <span class="token string">"failed"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span>,  <span class="token string">"_seq_no"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,  <span class="token string">"_primary_term"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯»å–æ–‡æ¡£æ•°æ®"><a href="#è¯»å–æ–‡æ¡£æ•°æ®" class="headerlink" title="è¯»å–æ–‡æ¡£æ•°æ®"></a>è¯»å–æ–‡æ¡£æ•°æ®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://localhost:9200/test_index/_doc/1<span class="token punctuation">\</span>?pretty<span class="token comment"># ä¼šè¿”å›å¦‚ä¸‹å†…å®¹</span><span class="token punctuation">{</span>  <span class="token string">"_index"</span> <span class="token builtin class-name">:</span> <span class="token string">"test_index"</span>,  <span class="token string">"_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"_doc"</span>,  <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,  <span class="token string">"_version"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,  <span class="token string">"_seq_no"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,  <span class="token string">"_primary_term"</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,  <span class="token string">"found"</span> <span class="token builtin class-name">:</span> true,  <span class="token string">"_source"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"title"</span> <span class="token builtin class-name">:</span> <span class="token string">"iPhone 7P"</span>,    <span class="token string">"description"</span> <span class="token builtin class-name">:</span> <span class="token string">"iphone ç¬¬ä¸€æ‰¹åŒæ‘„åƒå¤´"</span>,    <span class="token string">"price"</span> <span class="token builtin class-name">:</span> <span class="token number">6799</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æŸ¥çœ‹-Elasticsearch-ç´¢å¼•ä¸­æœ‰å¤šå°‘æ¡æ•°æ®"><a href="#æŸ¥çœ‹-Elasticsearch-ç´¢å¼•ä¸­æœ‰å¤šå°‘æ¡æ•°æ®" class="headerlink" title="æŸ¥çœ‹ Elasticsearch ç´¢å¼•ä¸­æœ‰å¤šå°‘æ¡æ•°æ®"></a>æŸ¥çœ‹ Elasticsearch ç´¢å¼•ä¸­æœ‰å¤šå°‘æ¡æ•°æ®</h3><p>å¯¹åº”çš„æ¥å£åœ°å€ä¸º /{index_name}/_doc/_count</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://localhost:9200/test_index/_doc/_count<span class="token punctuation">\</span>?pretty<span class="token comment"># ä¼šè¿”å›å¦‚ä¸‹å†…å®¹</span><span class="token punctuation">{</span>  <span class="token string">"count"</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>,  <span class="token string">"_shards"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"total"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,    <span class="token string">"successful"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,    <span class="token string">"skipped"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,    <span class="token string">"failed"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç®€å•æœç´¢"><a href="#ç®€å•æœç´¢" class="headerlink" title="ç®€å•æœç´¢"></a>ç®€å•æœç´¢</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-XPOST</span> -H<span class="token string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_doc/_search<span class="token punctuation">\</span>?pretty -d<span class="token string">'{    "query" : { "match" : { "description" : "iphone" }}}'</span><span class="token comment"># ä¼šè¿”å›å¦‚ä¸‹å†…å®¹</span><span class="token punctuation">{</span>  <span class="token string">"took"</span> <span class="token builtin class-name">:</span> <span class="token number">16</span>,  <span class="token string">"timed_out"</span> <span class="token builtin class-name">:</span> false,  <span class="token string">"_shards"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"total"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,    <span class="token string">"successful"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,    <span class="token string">"skipped"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,    <span class="token string">"failed"</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>  <span class="token punctuation">}</span>,  <span class="token string">"hits"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>    <span class="token string">"total"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>      <span class="token string">"value"</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,      <span class="token string">"relation"</span> <span class="token builtin class-name">:</span> <span class="token string">"eq"</span>    <span class="token punctuation">}</span>,    <span class="token string">"max_score"</span> <span class="token builtin class-name">:</span> <span class="token number">0.60996956</span>,    <span class="token string">"hits"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        <span class="token string">"_index"</span> <span class="token builtin class-name">:</span> <span class="token string">"test_index"</span>,        <span class="token string">"_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"_doc"</span>,        <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,        <span class="token string">"_score"</span> <span class="token builtin class-name">:</span> <span class="token number">0.60996956</span>,        <span class="token string">"_source"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>          <span class="token string">"title"</span> <span class="token builtin class-name">:</span> <span class="token string">"iPhone 7P"</span>,          <span class="token string">"description"</span> <span class="token builtin class-name">:</span> <span class="token string">"iphone ç¬¬ä¸€æ‰¹åŒæ‘„åƒå¤´"</span>,          <span class="token string">"price"</span> <span class="token builtin class-name">:</span> <span class="token number">6799</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> ElasticSearch </tag>
            
            <tag> Laradock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravel ä¸­çš„æ¨¡å‹äº‹ä»¶ä¸ Observer</title>
      <link href="posts/c9de0987.html"/>
      <url>posts/c9de0987.html</url>
      
        <content type="html"><![CDATA[<h1 id="Laravel-ä¸­çš„æ¨¡å‹äº‹ä»¶ä¸-Observer"><a href="#Laravel-ä¸­çš„æ¨¡å‹äº‹ä»¶ä¸-Observer" class="headerlink" title="Laravel ä¸­çš„æ¨¡å‹äº‹ä»¶ä¸ Observer"></a>Laravel ä¸­çš„æ¨¡å‹äº‹ä»¶ä¸ Observer</h1><p>å½“æ¨¡å‹å·²å­˜åœ¨ï¼Œä¸æ˜¯æ–°å»ºçš„æ—¶å€™ï¼Œä¾æ¬¡è§¦å‘çš„é¡ºåºæ˜¯:</p><p>saving -&gt; updating -&gt; updated -&gt; saved</p><p>å½“æ¨¡å‹ä¸å­˜åœ¨ï¼Œéœ€è¦æ–°å¢çš„æ—¶å€™ï¼Œä¾æ¬¡è§¦å‘çš„é¡ºåºåˆ™æ˜¯</p><p>saving -&gt; creating -&gt; created -&gt; saved</p><p>é‚£ä¹ˆ saving,saved å’Œ updating,updated åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>updating å’Œ updated ä¼šåœ¨æ•°æ®åº“ä¸­çš„çœŸå€¼ä¿®æ”¹å‰åè§¦å‘ã€‚</p><p>saving å’Œ saved åˆ™ä¼šåœ¨ Eloquent å®ä¾‹çš„ original æ•°ç»„çœŸå€¼æ›´æ”¹å‰åè§¦å‘ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">UserObserver</span><span class="token punctuation">{</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®å³å°†åˆ›å»ºçš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">creating</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®åˆ›å»ºåçš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">created</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®å³å°†æ›´æ–°çš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">updating</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®æ›´æ–°åçš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">updated</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®å³å°†ä¿å­˜çš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">saving</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®ä¿å­˜åçš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">saved</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®å³å°†åˆ é™¤çš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">deleting</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®åˆ é™¤åçš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">deleted</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®å³å°†ä»è½¯åˆ é™¤çŠ¶æ€æ¢å¤çš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">restoring</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç›‘å¬æ•°æ®ä»è½¯åˆ é™¤çŠ¶æ€æ¢å¤åçš„äº‹ä»¶ã€‚     *     * @param  User $user     * @return void     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">restored</span><span class="token punctuation">(</span><span class="token class-name type-declaration">User</span> <span class="token variable">$user</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>laravel ä½¿ç”¨ ORM å†™å¤æ‚ sql</title>
      <link href="posts/778c83e3.html"/>
      <url>posts/778c83e3.html</url>
      
        <content type="html"><![CDATA[<h1 id="laravel-ä½¿ç”¨-ORM-å†™å¤æ‚-sql"><a href="#laravel-ä½¿ç”¨-ORM-å†™å¤æ‚-sql" class="headerlink" title="laravel ä½¿ç”¨ ORM å†™å¤æ‚ sql"></a>laravel ä½¿ç”¨ ORM å†™å¤æ‚ sql</h1><h2 id="ç›´æ¥å…ˆè´´å‡º-sql-æŸ¥è¯¢è¯­å¥å¦‚ä¸‹"><a href="#ç›´æ¥å…ˆè´´å‡º-sql-æŸ¥è¯¢è¯­å¥å¦‚ä¸‹" class="headerlink" title="ç›´æ¥å…ˆè´´å‡º sql æŸ¥è¯¢è¯­å¥å¦‚ä¸‹"></a>ç›´æ¥å…ˆè´´å‡º sql æŸ¥è¯¢è¯­å¥å¦‚ä¸‹</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT`assets_device`.* FROM((SELECT`id`,`sub_category_id`,`number`,`name`,`location`,`officeBuilding`,`area`,`department`,`rack`,`rack_pos` FROM`assets_device` WHERE`department` IN ( 6, 7, 17, 20 ) AND `assets_device`.`deleted_at` IS NULL ) UNION(SELECT`id`,`sub_category_id`,`number`,`name`,`location`,`officeBuilding`,`area`,`department`,`rack`,`rack_pos` FROM`assets_device` WHERE`area` IN ( 13, 14 ) AND `assets_device`.`deleted_at` IS NULL ) ) AS assets_device<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º"><a href="#å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º" class="headerlink" title="å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º"></a>å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getChoiceAssetsByErOrDt</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æœºæˆ¿ id æ•°ç»„</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'er'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'er'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$erIds</span> <span class="token operator">=</span> <span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'er'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$erIds</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'er'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$erIds</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// ç§‘å®¤ id æ•°ç»„</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$dtIds</span> <span class="token operator">=</span> <span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dt'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$dtIds</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$dtIds</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// id, å­åˆ†ç±»id, èµ„äº§ç¼–å·, èµ„äº§åç§°, ä½ç½®, åŠå…¬æ¥¼, æœºæˆ¿, ç§‘å®¤, æœºæŸœ, æœºæŸœUæ•°</span>        <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sub_category_id'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'officeBuilding'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'area'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'rack'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'rack_pos'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$erIds</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// æ ¹æ®æœºæˆ¿ id æŸ¥è¯¢èµ„äº§</span>            <span class="token variable">$erModel</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">deviceModel</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">)</span>                <span class="token operator">-&gt;</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'area'</span><span class="token punctuation">,</span><span class="token variable">$erIds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dtIds</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// æ ¹æ®ç§‘å®¤ id æŸ¥è¯¢èµ„äº§</span>            <span class="token variable">$dtModel</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">deviceModel</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">)</span>                <span class="token operator">-&gt;</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">,</span><span class="token variable">$dtIds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$model</span> <span class="token operator">=</span> <span class="token variable">$dtModel</span><span class="token operator">-&gt;</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token variable">$erModel</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ³¨æ„åˆå¹¶å‚æ•°æ—¶ $subQuery å¿…é¡»æ˜¯ \Illuminate\Database\Query\Builder ç±»å‹</span><span class="token comment">// å¦‚æœæ˜¯ \Illuminate\Database\Eloquent\Builder ç±»å‹çš„ï¼Œç”¨ getQuery() æ–¹æ³•</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">deviceModel</span><span class="token operator">-&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sub_category'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'zone'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'office_building'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'engineroom'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">mergeBindings</span><span class="token punctuation">(</span><span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"assets_device.*"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"(<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">toSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>) as assets_device"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'assets_device.id'</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                    <span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// ä»¥ä¸‹ä»£ç å¦‚æœä½¿ç”¨ transformer çš„è¯ï¼Œå°±ä¸éœ€è¦å†™ï¼Œç›´æ¥å¯ä»¥åœ¨ transformer é‡Œé¢è½¬æ¢</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token operator">&amp;</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub_category_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub_category'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub_category'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zone_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zone'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zone'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'office_building_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'office_building'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'office_building'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'engineroom'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$erdt</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'engineroom'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$erdt</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$erdt</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'erdt'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$erdt</span><span class="token punctuation">;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub_category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'zone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'office_building'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'engineroom'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>laravel æ€§èƒ½ä¼˜åŒ–</title>
      <link href="posts/183ed0df.html"/>
      <url>posts/183ed0df.html</url>
      
        <content type="html"><![CDATA[<h1 id="laravel-æ€§èƒ½ä¼˜åŒ–"><a href="#laravel-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="laravel æ€§èƒ½ä¼˜åŒ–"></a>laravel æ€§èƒ½ä¼˜åŒ–</h1><h2 id="composer-ä¼˜åŒ–"><a href="#composer-ä¼˜åŒ–" class="headerlink" title="composer ä¼˜åŒ–"></a>composer ä¼˜åŒ–</h2><p>æ­¤å‘½ä»¤ä¼šæŠŠ <code>PSR-0</code> å’Œ <code>PSR-4</code> è½¬åŒ–ä¸ºä¸€ä¸ªæ˜ å°„è¡¨ï¼Œæ¥æé«˜ç±»çš„åŠ è½½é€Ÿåº¦</p><pre class="line-numbers language-none"><code class="language-none">composer dump-autoload --optimize<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å®‰è£…-Debugbar"><a href="#å®‰è£…-Debugbar" class="headerlink" title="å®‰è£… Debugbar"></a>å®‰è£… Debugbar</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">composer</span> require <span class="token string">"barryvdh/laravel-debugbar:~3.2"</span> <span class="token parameter variable">--dev</span><span class="token comment"># ç”Ÿæˆé…ç½®æ–‡ä»¶</span>php artisan vendor:publish <span class="token parameter variable">--provider</span><span class="token operator">=</span><span class="token string">"Barryvdh\Debugbar\ServiceProvider"</span><span class="token comment"># ç¼–è¾‘ config/debugbar.php å°† enable å¾—å€¼è®¾ç½®ä¸º</span><span class="token string">'enable'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> env<span class="token punctuation">(</span><span class="token string">'APP_DEBUG'</span>, <span class="token boolean">false</span><span class="token punctuation">)</span>,<span class="token comment"># å¹¶åœ¨ .env é…ç½®æ–‡ä»¶ä¸­å¼€å¯</span><span class="token assign-left variable">APP_DEBUG</span><span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="laravel-é…ç½®ç¼“å­˜"><a href="#laravel-é…ç½®ç¼“å­˜" class="headerlink" title="laravel é…ç½®ç¼“å­˜"></a>laravel é…ç½®ç¼“å­˜</h2><blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ çš„é…ç½®ä¿¡æ¯é‡Œå­˜åœ¨é—­åŒ…ï¼Œæ‰§è¡Œä»¥ä¸Šå‘½ä»¤æ—¶å°†ä¼šæŠ¥é”™ï¼šYour configuration files are not serializable ã€‚è§£å†³åŠæ³•æ˜¯æ”¹å†™é—­åŒ…å‡½æ•°ä¸ºä¸€èˆ¬çš„å‡½æ•°ï¼Œæˆ–è€…æ”¹å†™ä¸ºç±»æ–¹æ³•ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®é…ç½®ç¼“å­˜ï¼Œä¼šç”Ÿæˆ bootstrap/cache/config.php æ–‡ä»¶</span>php artisan config:cache<span class="token comment"># æ¸…ç©ºé…ç½®ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ bootstrap/cache/config.php æ–‡ä»¶æ¥æ¸…é™¤</span>php artisan config:clear<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰‹åŠ¨åˆ›å»º 200 ä¸ªé…ç½®ä¿¡æ¯</span><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token parameter variable">-f</span> <span class="token string">"app%03g.php"</span> <span class="token number">1</span> <span class="token number">200</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">cp</span> ./config/app.php ./config/<span class="token variable">$i</span><span class="token punctuation">;</span> <span class="token keyword">done</span><span class="token comment"># æ¸…é™¤æ‰ bootstrap/cache/config.php é…ç½®ç¼“å­˜æ–‡ä»¶</span>php artisan config:clear<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="laravel-è·¯ç”±ç¼“å­˜"><a href="#laravel-è·¯ç”±ç¼“å­˜" class="headerlink" title="laravel è·¯ç”±ç¼“å­˜"></a>laravel è·¯ç”±ç¼“å­˜</h2><blockquote><p>åŸºäºé—­åŒ…çš„è·¯ç”±æ— æ³•è¢«ç¼“å­˜ã€‚è¦ä½¿ç”¨è·¯ç”±ç¼“å­˜ã€‚ä½ éœ€è¦å°†ä»»ä½•é—­åŒ…è·¯ç”±è½¬æ¢æˆæ§åˆ¶å™¨è·¯ç”±ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®è·¯ç”±ç¼“å­˜</span>php artisan route:cache<span class="token comment"># æ¸…é™¤è·¯ç”±ç¼“å­˜</span>php artisan route:clear<span class="token comment"># ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ bootstrap/cache/routes.php ç¼“å­˜æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·¯ç”±ç»Ÿè®¡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan route:list <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1 - 4}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”Ÿæˆ 500 ä¸ªæµ‹è¯•è·¯ç”±</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token parameter variable">-f</span> <span class="token string">"%03g"</span> <span class="token number">1</span> <span class="token number">500</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">"Route::get('test<span class="token variable">$i</span>/{id}/{query}','Auth\LoginController@testtest<span class="token variable">$i</span>')-&gt;name('test<span class="token variable">$i</span>')-&gt;middleware('auth');"</span> <span class="token operator">&gt;&gt;</span> routes/web.php<span class="token punctuation">;</span> <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç±»æ˜ å°„åŠ è½½ä¼˜åŒ–"><a href="#ç±»æ˜ å°„åŠ è½½ä¼˜åŒ–" class="headerlink" title="ç±»æ˜ å°„åŠ è½½ä¼˜åŒ–"></a>ç±»æ˜ å°„åŠ è½½ä¼˜åŒ–</h2><p>åœ¨ <code>laravel 6.x</code> ä¸­ï¼Œä¼šç”Ÿæˆ <code>bootstrap/cache/config.php</code> å’Œ <code>bootstrap/cache/packages.php</code> å’Œ <code>bootstrap/cache/routes.php</code> å’Œ <code>bootstrap/cache/services.php</code> è¿™å››ä¸ªæ–‡ä»¶ã€‚</p><p>services.php çš„ä½œç”¨ï¼Œæ˜¯æŠŠ laravel åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­éœ€è¦åŠ è½½çš„æ–‡ä»¶ï¼Œå‘½åç©ºé—´å’Œæ–‡ä»¶è·¯å¾„ä¸€ä¸ªä¸ªåˆ—ä¸¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå½“ laravel å¯åŠ¨çš„æ—¶å€™ï¼Œç›´æ¥é€šè¿‡è¿™ä¸ªæ•°ç»„æ¥è¯»å–æ–‡ä»¶ã€‚</p><p>packages.php åˆ™æ˜¯å°† laravel æ‰©å±•åŒ…çš„ provider å’Œ facade æ•´ç†åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œåœ¨ laravel å¯åŠ¨åŠ è½½çš„æ—¶å€™ï¼Œç›´æ¥æŒ‰ç…§è¿™é‡Œçš„æ•°ç»„è¿›è¡ŒåŠ è½½ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan optimize<span class="token comment"># æ¸…ç©ºç±»æ˜ å°„</span>php artisan optimize:clear<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆç†åˆ’åˆ†å­è§†å›¾"><a href="#åˆç†åˆ’åˆ†å­è§†å›¾" class="headerlink" title="åˆç†åˆ’åˆ†å­è§†å›¾"></a>åˆç†åˆ’åˆ†å­è§†å›¾</h2><blockquote><p>å»ºè®®ä¸è¦å­æ¨¡ç‰ˆåµŒå¥—å­æ¨¡æ¿ï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç° N + 1 çš„é—®é¢˜</p></blockquote><h2 id="ä¼šè¯é©±åŠ¨é€‰æ‹©-redisï¼Œå¹¶ä¸”å¿…é¡»é€‰æ‹©-phpredis-ç±»åº“"><a href="#ä¼šè¯é©±åŠ¨é€‰æ‹©-redisï¼Œå¹¶ä¸”å¿…é¡»é€‰æ‹©-phpredis-ç±»åº“" class="headerlink" title="ä¼šè¯é©±åŠ¨é€‰æ‹© redisï¼Œå¹¶ä¸”å¿…é¡»é€‰æ‹© phpredis ç±»åº“"></a>ä¼šè¯é©±åŠ¨é€‰æ‹© redisï¼Œå¹¶ä¸”å¿…é¡»é€‰æ‹© phpredis ç±»åº“</h2><h2 id="ç´¢å¼•ä¼˜åŒ–"><a href="#ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–"></a>ç´¢å¼•ä¼˜åŒ–</h2><h3 id="å¦‚ä½•åœ¨-laravel-ä¸­æ·»åŠ ç´¢å¼•ï¼Ÿ"><a href="#å¦‚ä½•åœ¨-laravel-ä¸­æ·»åŠ ç´¢å¼•ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ laravel ä¸­æ·»åŠ ç´¢å¼•ï¼Ÿ"></a>å¦‚ä½•åœ¨ laravel ä¸­æ·»åŠ ç´¢å¼•ï¼Ÿ</h3><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>$table-&gt;primary(â€˜idâ€™);</td><td>æ·»åŠ ä¸»é”®</td></tr><tr><td>$table-&gt;primary([â€˜idâ€™, â€˜parent_idâ€™]);</td><td>æ·»åŠ å¤åˆé”®</td></tr><tr><td>$table-&gt;unique(â€˜emailâ€™);</td><td>æ·»åŠ å”¯ä¸€ç´¢å¼•</td></tr><tr><td>$table-&gt;index(â€˜stateâ€™);</td><td>æ·»åŠ æ™®é€šç´¢å¼•</td></tr><tr><td>$table-&gt;spatialIndex(â€˜locationâ€™);</td><td>æ·»åŠ åœ°ç†ä½ç½®ä¿¡æ¯ç´¢å¼•ï¼ˆä¸æ”¯æŒ SQLiteï¼‰</td></tr></tbody></table><p>æ·»åŠ å…¨æ–‡ç´¢å¼•æ—¶ï¼Œä½¿ç”¨</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">statement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ALTER TABLE posts ADD FULLTEXT full(name, content)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹ç´¢å¼•åç§°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameIndex</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'from'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'to'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¦‚ä½•åœ¨-laravel-ä¸­åˆ é™¤ç´¢å¼•ï¼Ÿ"><a href="#å¦‚ä½•åœ¨-laravel-ä¸­åˆ é™¤ç´¢å¼•ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ laravel ä¸­åˆ é™¤ç´¢å¼•ï¼Ÿ"></a>å¦‚ä½•åœ¨ laravel ä¸­åˆ é™¤ç´¢å¼•ï¼Ÿ</h3><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>$table-&gt;dropPrimary(â€˜users_id_primaryâ€™);</td><td>ä» users è¡¨ä¸­åˆ é™¤ä¸»é”®</td></tr><tr><td>$table-&gt;dropUnique(â€˜users_email_uniqueâ€™);</td><td>ä» users è¡¨ä¸­åˆ é™¤å”¯ä¸€ç´¢å¼•</td></tr><tr><td>$table-&gt;dropIndex(â€˜geo_state_indexâ€™);</td><td>ä» geo è¡¨ä¸­åˆ é™¤åŸºæœ¬ç´¢å¼•</td></tr><tr><td>$table-&gt;dropSpatialIndex(â€˜geo_location_spatialindexâ€™);</td><td>ä» geo è¡¨ä¸­åˆ é™¤ç©ºé—´ç´¢å¼•ï¼ˆä¸æ”¯æŒ SQLiteï¼‰</td></tr></tbody></table><h2 id="èµ„æºå‹ç¼©ï¼ˆJS-CSSï¼‰"><a href="#èµ„æºå‹ç¼©ï¼ˆJS-CSSï¼‰" class="headerlink" title="èµ„æºå‹ç¼©ï¼ˆJS/CSSï¼‰"></a>èµ„æºå‹ç¼©ï¼ˆJS/CSSï¼‰</h2><ul><li>å¼€å‘ç¯å¢ƒæ—¶ï¼Œæ‰§è¡Œ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œæ‰§è¡Œ ï¼ˆåªæœ‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰ä¼šå¯¹å†…å®¹è¿›è¡Œå‹ç¼©ï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run prod<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å‹ç¼©-HTML"><a href="#å‹ç¼©-HTML" class="headerlink" title="å‹ç¼© HTML"></a>å‹ç¼© HTML</h2><pre class="line-numbers language-none"><code class="language-none"># å®‰è£… laravel-page-speed æ‰©å±•åŒ…ï¼Œæ¥å»é™¤ html æ³¨é‡Šã€å›è½¦æ¢è¡Œç¬¦å’Œå¤šä½™çš„ç©ºæ ¼composer require renatomarinho/laravel-page-speed# å‘å¸ƒé…ç½®æ–‡ä»¶php artisan vendor:publish --provider="RenatoMarinho\LaravelPageSpeed\ServiceProvider"# åœ¨ Kenel.php =&gt; $middlewareGroups =&gt; web ä¸­æ·»åŠ ä¸­é—´ä»¶\RenatoMarinho\LaravelPageSpeed\Middleware\ElideAttributes::class, // ç§»é™¤æ— ç”¨çš„ HTML å±æ€§\RenatoMarinho\LaravelPageSpeed\Middleware\RemoveComments::class, // ç§»é™¤æ³¨é‡Š\RenatoMarinho\LaravelPageSpeed\Middleware\TrimUrls::class,  // ç§»é™¤ä¸å¿…è¦çš„ URL å‰ç¼€\RenatoMarinho\LaravelPageSpeed\Middleware\CollapseWhitespace::class, // å¤„ç†æ¢è¡Œç¬¦å’Œç©ºæ ¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="swoole-åŠ é€Ÿ"><a href="#swoole-åŠ é€Ÿ" class="headerlink" title="swoole åŠ é€Ÿ"></a>swoole åŠ é€Ÿ</h2><pre class="line-numbers language-none"><code class="language-none"># å®‰è£… laravlescomposer require hhxsv5/laravel-s# å‘å¸ƒé…ç½®php artisan laravels publish# å¯åŠ¨ laravelsphp bin/laravels start# åå°å®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œphp bin/laravels start -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginx é…ç½® laravels</p><pre class="line-numbers language-none"><code class="language-none">upstream swoole {    # å¦‚æœæ˜¯ä½¿ç”¨ laradock ï¼Œè¯·å°† 127.0.0.1 æ›´æ”¹ä¸º workspace    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;    keepalive 16;}server {    listen 80;    listen 443 ssl http2;    server_name larablog.test;    root /var/www/larablog/public;    index index.html index.htm index.php;    charset utf-8;    location / {        try_files $uri @laravels;    }    location = /favicon.ico { access_log off; log_not_found off; }    location = /robots.txt  { access_log off; log_not_found off; }    error_log /var/log/nginx/larablog_error.log;    access_log /var/log/nginx/larablog_access.log;    sendfile off;    client_max_body_size 100m;    location @laravels {        # proxy_connect_timeout 60s;        # proxy_send_timeout 60s;        # proxy_read_timeout 120s;        proxy_http_version 1.1;        proxy_set_header Connection "";        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Real-PORT $remote_port;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header Host $http_host;        proxy_set_header Scheme $scheme;        proxy_set_header Server-Protocol $server_protocol;        proxy_set_header Server-Name $server_name;        proxy_set_header Server-Addr $server_addr;        proxy_set_header Server-Port $server_port;        proxy_pass http://swoole;    }    location ~ /\.ht {        deny all;    }    ssl_certificate     /etc/nginx/ssl/larablog.test.crt;    ssl_certificate_key /etc/nginx/ssl/larablog.test.key;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯ä½¿ç”¨ laradock çš„è¯ï¼Œè¿˜éœ€è¦å°† <code>.env</code> æ·»åŠ ç›‘å¬åœ°å€ä¸º <code>workspace</code></p><pre class="line-numbers language-none"><code class="language-none">LARAVELS_LISTEN_IP=workspace# è®¾ç½®åå°å¯åŠ¨ laravelS æœåŠ¡ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹åˆ™æ‰§è¡Œ ps -ef|grep laravels å‘½ä»¤LARAVELS_DAEMONIZE=true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…¨æ–°æœåŠ¡å™¨ä½¿ç”¨ lnmp æ­å»º laravel é¡¹ç›®</title>
      <link href="posts/73f4393e.html"/>
      <url>posts/73f4393e.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-lnmp-æ­å»º-laravel-é¡¹ç›®"><a href="#ä½¿ç”¨-lnmp-æ­å»º-laravel-é¡¹ç›®" class="headerlink" title="ä½¿ç”¨ lnmp æ­å»º laravel é¡¹ç›®"></a>ä½¿ç”¨ lnmp æ­å»º laravel é¡¹ç›®</h1><ul><li>æ‰“åŒ…æºç </li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…ˆåœ¨æ—§æœåŠ¡å™¨ä¸Šé¢æ‰“åŒ…æºä»£ç </span><span class="token function">tar</span> <span class="token parameter variable">-czvf</span> hello-world.tar.gz hello-world<span class="token comment"># ç„¶åå°†æºç ç›´æ¥å¤åˆ¶åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šé¢</span><span class="token function">scp</span> hello-world.tar.gz root@192.168.1.1:/home/wwwroot/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… screen</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">screen</span><span class="token function">screen</span> <span class="token parameter variable">-S</span> lnmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¸‹è½½å®‰è£… lnmp ç¯å¢ƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://soft.vpser.net/lnmp/lnmp1.7-full.tar.gz<span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> lnmp1.7-full.tar.gz<span class="token builtin class-name">cd</span> lnmp1.7-full/<span class="token comment"># å®‰è£… lnmp</span>./install.sh lnmp<span class="token comment"># é€‰æ‹©äº† php7.4 mysql5.7</span><span class="token comment"># æ£€æŸ¥ lnmp æ˜¯å¦å®‰è£…æˆåŠŸ</span>lnmp status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… swoole æ‰©å±•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… swoole æºç </span><span class="token function">wget</span> https://github.com/swoole/swoole-src/archive/v4.6.4.tar.gz<span class="token comment"># è§£å‹ç¼©æºç </span><span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> v4.6.4.tar.gz<span class="token comment"># ç”Ÿæˆ configure æ–‡ä»¶</span>/usr/local/php/bin/phpize<span class="token comment"># ç¼–è¯‘é…ç½®é¡¹</span>./configure --with-php-config<span class="token operator">=</span>/usr/local/php/bin/php-config --enable-openssl --enable-http2 --enable-sockets --enable-mysqlnd<span class="token comment"># ç¼–è¯‘å®‰è£…</span><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment"># æŸ¥çœ‹ php.ini é…ç½®æ–‡ä»¶</span>php <span class="token parameter variable">--ini</span><span class="token comment"># å¼€å¯ swoole æ‰©å±•</span><span class="token function">vim</span> /usr/local/php/etc/php.ini<span class="token comment"># åœ¨ php.ini é…ç½®æ–‡ä»¶ä¸­å¼€å¯ swoole æ‰©å±•</span><span class="token assign-left variable">extension</span><span class="token operator">=</span>swoole.so<span class="token comment"># æˆ–è€…å†™ç»å¯¹è·¯å¾„</span><span class="token assign-left variable">extension</span><span class="token operator">=</span>/usr/local/php/lib/php/extensions/no-debug-non-zts-20190902/swoole.so<span class="token comment"># é‡å¯ php</span>/etc/init.d/php-fpm restart<span class="token comment"># æŸ¥çœ‹æ‰©å±•æ˜¯å¦å·²ç»å¼€å¯</span>php <span class="token parameter variable">-m</span>  php <span class="token parameter variable">--ri</span> swoole<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… redis</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆ 6.2.1 æºç </span><span class="token function">wget</span> https://download.redis.io/releases/redis-6.2.1.tar.gz<span class="token comment"># è§£å‹ç¼©</span><span class="token function">tar</span> xzf redis-6.2.1.tar.gz<span class="token builtin class-name">cd</span> redis-6.2.1<span class="token comment"># ç¼–è¯‘å®‰è£…</span><span class="token function">make</span><span class="token comment"># å¯åŠ¨ redis æœåŠ¡ç«¯</span>src/redis-server ï¼ˆå¼€å¯åå°ä»»åŠ¡ src/redis-server <span class="token operator">&amp;</span>ï¼‰<span class="token comment"># ä½¿ç”¨ redis å®¢æˆ·ç«¯ä½œä¸ºæµ‹è¯•</span>src/redis-cli æˆ–è€… <span class="token builtin class-name">cd</span> src <span class="token operator">&amp;&amp;</span> ./redis-cli<span class="token comment"># å°† redis-cli åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­</span><span class="token function">cp</span> ~/software/redis-6.2.1/src/redis-cli /usr/local/bin/redis-cli<span class="token comment"># è®¾ç½®æ‰§è¡Œæƒé™</span><span class="token function">chmod</span> u+x redis-cli<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… php redis æ‰©å±•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… redis æ‰©å±•</span><span class="token function">wget</span> https://github.com/phpredis/phpredis/archive/5.3.3.tar.gz<span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> <span class="token number">5.3</span>.3.tar.gz<span class="token builtin class-name">cd</span> phpredis-5.3.3<span class="token comment"># ç”Ÿæˆ configure æ–‡ä»¶</span>/usr/local/php/bin/phpize<span class="token comment"># è®¾ç½®é…ç½®é¡¹</span>./configure --with-php-config<span class="token operator">=</span>/usr/local/php/bin/php-config<span class="token comment"># ç¼–è¯‘å®‰è£…</span><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment"># é‡å¯ php</span>/etc/init.d/php-fpm restart<span class="token comment"># æŸ¥çœ‹æ‰©å±•æ˜¯å¦å·²ç»å¼€å¯</span>php <span class="token parameter variable">-m</span>  php <span class="token parameter variable">--ri</span> redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£… npm</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">npm</span><span class="token function">npm</span> config <span class="token builtin class-name">set</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span>https://registry.npm.taobao.org<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é…ç½®é¡¹ç›®</li></ul><p>vim /usr/local/nginx/conf/vhost/hello-world.com.conf</p><p>æ·»åŠ  nginx é…ç½®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server    <span class="token punctuation">{</span>        listen <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token comment">#listen [::]:80;</span>        server_name www.hello-world.com <span class="token punctuation">;</span>        index index.html index.htm index.php default.html default.htm default.php<span class="token punctuation">;</span>        root  /home/wwwroot/hello-world/public<span class="token punctuation">;</span>        include rewrite/none.conf<span class="token punctuation">;</span>        include enable-php.conf<span class="token punctuation">;</span>        location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$        <span class="token punctuation">{</span>            expires      30d<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token punctuation">)</span>?$        <span class="token punctuation">{</span>            expires      12h<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        location ~ /.well-known <span class="token punctuation">{</span>            allow all<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        location ~ /<span class="token punctuation">\</span>.        <span class="token punctuation">{</span>            deny all<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        location / <span class="token punctuation">{</span>          try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php?<span class="token variable">$query_string</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        access_log  /home/wwwlogs/hello-world.com.access.log<span class="token punctuation">;</span>        error_log  /home/wwwlogs/hello-world.com.error.log<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    server <span class="token punctuation">{</span>  listen <span class="token number">80</span><span class="token punctuation">;</span>  server_name hello-world.com<span class="token punctuation">;</span>  rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> http://www.hello-world.com/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤é˜²è·¨æ–‡ä»¶å¤¹è®¾ç½®<br>vim /usr/local/nginx/conf/fastcgi.conf<br>æ³¨é‡Šæ‰<br><code>fastcgi_param PHP_ADMIN_VALUE "open_basedir=$document_root/:/tmp/:/proc/";</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chattr <span class="token parameter variable">-i</span> /home/wwwroot/hello-world/public/.user.ini<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /home/wwwroot/hello-world/public/.user.ini<span class="token comment"># é‡å¯ php-fpm</span>/etc/init.d/php-fpm restart<span class="token comment"># é‡æ–°åŠ è½½ nginx</span>/etc/init.d/nginx reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>vim .env</p><p>æ›´æ”¹ mysql æ•°æ®åº“ã€redisè¿æ¥ä¿¡æ¯ã€ä»¥åŠé…ç½®åŸŸå</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan jwt:secretphp artisan key:generate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LNMP </tag>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php æŠ½å¥–ç®—æ³•ï¼ˆé€‚åˆä¹å®«æ ¼å’Œå¤§è½¬ç›˜ï¼‰</title>
      <link href="posts/43b98a2e.html"/>
      <url>posts/43b98a2e.html</url>
      
        <content type="html"><![CDATA[<h1 id="php-æŠ½å¥–ç®—æ³•ï¼ˆé€‚åˆä¹å®«æ ¼å’Œå¤§è½¬ç›˜ï¼‰"><a href="#php-æŠ½å¥–ç®—æ³•ï¼ˆé€‚åˆä¹å®«æ ¼å’Œå¤§è½¬ç›˜ï¼‰" class="headerlink" title="php æŠ½å¥–ç®—æ³•ï¼ˆé€‚åˆä¹å®«æ ¼å’Œå¤§è½¬ç›˜ï¼‰"></a>php æŠ½å¥–ç®—æ³•ï¼ˆé€‚åˆä¹å®«æ ¼å’Œå¤§è½¬ç›˜ï¼‰</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">/*  * ä¸åŒæ¦‚ç‡çš„æŠ½å¥–åŸç†å°±æ˜¯æŠŠ0åˆ°*ï¼ˆæ¯”é‡æ€»æ•°ï¼‰çš„åŒºé—´åˆ†å— * åˆ†å—çš„ä¾æ®æ˜¯ç‰©å“å æ•´ä¸ªçš„æ¯”é‡ï¼Œå†æ ¹æ®éšæœºæ•°ç§å­æ¥äº§ç”Ÿ0-* ä¸­çš„æŸä¸ªæ•° * åˆ¤æ–­è¿™ä¸ªæ•°æ˜¯è½åœ¨å“ªä¸ªåŒºé—´ä¸Šï¼ŒåŒºé—´å¯¹åº”çš„å°±æ˜¯æŠ½åˆ°çš„é‚£ä¸ªç‰©å“ã€‚ * éšæœºæ•°ç†è®ºä¸Šæ˜¯æ¦‚ç‡å‡ç­‰çš„ï¼Œé‚£ä¹ˆç›¸åº”çš„åŒºé—´æ‰€å«æ•°çš„å¤šå°‘å°±ä½“ç°äº†æŠ½å¥–ç‰©å“æ¦‚ç‡çš„ä¸åŒã€‚ */</span>      <span class="token comment">/**     * æŠ½å¥–æ–¹æ³•     * @return [array] [æŠ½å¥–æƒ…å†µ]     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">doDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// å¥–å“æ•°ç»„</span>        <span class="token variable">$proArr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token comment">// id =&gt; å¥–å“ç­‰çº§ï¼Œ name =&gt; å¥–å“åç§°, v =&gt; å¥–å“æƒé‡</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'è¶…çº§å¥–å“'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ç‰¹ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ä¸€ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'äºŒç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ä¸‰ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å››ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'äº”ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å…­ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ä¸ƒç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å…«ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'æ²¡ä¸­å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¥–å“ç­‰çº§å¥–å“æƒé‡æ•°ç»„</span>        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$proArr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// ä¸­å¥– id</span>        <span class="token variable">$rid</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">get_rand</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**æ¨¡æ‹ŸæŠ½å¥–æµ‹è¯•**/</span><span class="token comment">/*        $i = 0;        while ( $i &lt; 10000) {          $rid = $this-&gt;get_rand($arr);          $res[] = $rid;          $i++;        }        // ç»Ÿè®¡å¥–å“å‡ºç°æ¬¡æ•°        $result = array_count_values($res);        asort($result);        foreach ($result as $id =&gt; $times) {            foreach ($proArr as $gifts) {                if($id == $gifts['id']){                    $response[$gifts['name']] = $times;                }            }        }        dump($response);        die;*/</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// ä¸­å¥–ç¤¼å“</span>        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'yes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$proArr</span><span class="token punctuation">[</span><span class="token variable">$rid</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// ä»åŸå¥–å“æ•°ç»„ä¸­å‰”é™¤å·²ç»ä¸­å¥–ç¤¼å“</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">[</span><span class="token variable">$rid</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰“ä¹±æ•°ç»„æ’åº</span>        <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'no'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$proArr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// foreach ($proArr as $k =&gt; $v) {</span>        <span class="token comment">//     // æ²¡ä¸­å¥–ç¤¼å“</span>        <span class="token comment">//     $result['no'][] = $v['name'];</span>        <span class="token comment">// }</span>        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æŠ½å¥–ç®—æ³•     * @param  array  $proArr å¥–å“ç­‰çº§å¥–å“æƒé‡æ•°ç»„     * @return [int]         ä¸­å¥–å¥–å“ç­‰çº§     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get_rand</span><span class="token punctuation">(</span><span class="token variable">$proArr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">;</span>        <span class="token variable">$rid</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token comment">// æ¦‚ç‡æ•°ç»„çš„æ€»æƒé‡</span>        <span class="token variable">$proSum</span> <span class="token operator">=</span> <span class="token function">array_sum</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¦‚ç‡æ•°ç»„å¾ªç¯</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$proArr</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$proCur</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// ä» 1 åˆ°æ¦‚ç‡æ€»æ•°ä¸­ä»»æ„å–å€¼</span>            <span class="token variable">$randNum</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$proSum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åˆ¤æ–­éšæœºæ•°æ˜¯å¦åœ¨æ¦‚ç‡æƒé‡ä¸­</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$randNum</span> <span class="token operator">&lt;=</span> <span class="token variable">$proCur</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// å–å‡ºå¥–å“ id</span>                <span class="token variable">$rid</span> <span class="token operator">=</span> <span class="token variable">$k</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment">// å¦‚æœéšæœºæ•°ä¸åœ¨æ¦‚ç‡æƒé™ä¸­ï¼Œåˆ™ä¸æ–­ç¼©å°æ€»æƒé‡ï¼Œç›´åˆ°ä»å¥–å“æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªå¥–å“</span>                <span class="token variable">$proSum</span> <span class="token operator">-=</span> <span class="token variable">$proCur</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$rid</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•æ–¹æ³•ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$proArr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ç‰¹ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ä¸€ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'äºŒç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'ä¸‰ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å››ç­‰å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'æ²¡ä¸­å¥–'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">500</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$proArr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// æ¦‚ç‡æ•°ç»„çš„æ€»æƒé‡</span>    <span class="token variable">$proSum</span> <span class="token operator">=</span> <span class="token function">array_sum</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¦‚ç‡æ•°ç»„å¾ªç¯</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ä» 1 åˆ°æ¦‚ç‡æ€»æ•°ä¸­ä»»æ„å–å€¼</span>        <span class="token variable">$randNum</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$proSum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$aa</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$randNum</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'+'</span> <span class="token operator">.</span> <span class="token variable">$v</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'+'</span> <span class="token operator">.</span> <span class="token variable">$proSum</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$randNum</span> <span class="token operator">&lt;=</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$proArr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å€¼å°±è·³å‡º foreach å¾ªç¯</span>            <span class="token comment">// dump($result);</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$proSum</span> <span class="token operator">=</span> <span class="token variable">$proSum</span> <span class="token operator">-</span> <span class="token variable">$v</span><span class="token punctuation">;</span>            <span class="token variable">$bb</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$randNum</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'+'</span> <span class="token operator">.</span> <span class="token variable">$v</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'+'</span> <span class="token operator">.</span> <span class="token variable">$proSum</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$aa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$bb</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// // dump($result);</span>    <span class="token comment">// // dump(__DIR__);</span>    <span class="token comment">// $path = __DIR__ . DS . 'log';</span>    <span class="token comment">// if(!is_dir($path)){</span>    <span class="token comment">//     mkdir($path);</span>    <span class="token comment">// }</span>    <span class="token comment">// $fileName = $path . DS . 'log.txt';</span>    <span class="token comment">// åˆ›å»ºæ–‡ä»¶å’Œæ‰“å¼€æ–‡ä»¶çš„å‡½æ•°éƒ½æ˜¯ fopen</span>    <span class="token comment">// $cFile = fopen($fileName,'a+');</span>    <span class="token comment">// $a = json_encode($aa) . "\r\n";</span>    <span class="token comment">// $b = json_encode($bb) . "\r\n";</span>    <span class="token comment">// fwrite($cFile,$a);</span>    <span class="token comment">// fwrite($cFile,$b);</span>    <span class="token comment">// fclose($cFile);</span>    <span class="token comment">// è¯»æ–‡ä»¶</span>    <span class="token comment">// $lines = file($fileName);</span>    <span class="token comment">// foreach ($lines as $key =&gt; $value) {</span>    <span class="token comment">//     dump($value.'555555555');</span>    <span class="token comment">// }</span>    <span class="token comment">// dump($lines);</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸‹ä»£ç ä¹Ÿæ˜¯æ„ä¹‰ç¨‹åº¦ä¸Šç›¸åŒçš„ä»£ç ï¼Œä½†æ˜¯è¿™ç§ç®—æ³•ç”¨çš„ä¸å¤š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">/**æˆ‘æ˜¯d1-d2ï¼š0-1æˆ‘æ˜¯d1-d2ï¼š1-51æˆ‘æ˜¯d1-d2ï¼š51-56æˆ‘æ˜¯d1-d2ï¼š56-156æˆ‘æ˜¯d1-d2ï¼š156-166æˆ‘æ˜¯d1-d2ï¼š166-166æˆ‘æ˜¯d1-d2ï¼š166-666æˆ‘æ˜¯d1-d2ï¼š666-688æˆ‘æ˜¯d1-d2ï¼š688-700æˆ‘æ˜¯d1-d2ï¼š700-900**/</span><span class="token keyword">function</span> <span class="token function-definition function">get_rand</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$proArr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>      <span class="token variable">$proSum</span> <span class="token operator">=</span> <span class="token function">array_sum</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// è®¡ç®—æ€»æƒé‡</span>    <span class="token variable">$randNum</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$proSum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$d1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$d2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$d2</span> <span class="token operator">+=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$d1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span>        <span class="token punctuation">{</span>            <span class="token variable">$d1</span> <span class="token operator">+=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$randNum</span> <span class="token operator">&gt;=</span> <span class="token variable">$d1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$randNum</span> <span class="token operator">&lt;=</span> <span class="token variable">$d2</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$proArr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">unset</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€å¯ç™¾åˆ†ç™¾ä¸­å¥–æ¨¡å¼</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/**    *  $prize_arr å‚ä¸æŠ½å¥–äººå‘˜æ•°æ®    *  id: ä¸€èˆ¬æ˜¯æˆå‘˜ID    *  name å§“å    *  v   å¾—å¥–æ¦‚ç‡    ***/</span>    <span class="token variable">$prize_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>         <span class="token string single-quoted-string">'0'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°ç‹'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'1'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°æ'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'2'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°å¼ '</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'3'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°äºŒ'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'4'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èœ'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'6'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'7'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ01'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'8'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ02'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'9'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ03'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'10'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ04'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'11'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ05'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'12'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ06'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'13'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ07'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'14'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ08'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'15'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ09'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token string single-quoted-string">'16'</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'å°èŒƒ10'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token operator">=&gt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$prize_arr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>         <span class="token variable">$total_num</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'8'</span><span class="token punctuation">;</span> <span class="token comment">//è®¾å®šå¾—ä¸­å¥–äººæ•°é‡</span>        <span class="token variable">$temp_rest</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$total_num</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$rid</span> <span class="token operator">=</span> <span class="token function">get_rand</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ ¹æ®æ¦‚ç‡è·å–äººå‘˜ID</span>        <span class="token variable">$temp_rest</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token variable">$prize_arr</span><span class="token punctuation">[</span><span class="token variable">$rid</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//ä¸­å¥–é¡¹</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$prize_arr</span><span class="token punctuation">[</span><span class="token variable">$rid</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$rid</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$temp_rest</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾—å‡ºç»“æœ</span>    <span class="token comment">/****    *   å¾—å‡ºå½“å‰ä¸­å¥–äºº    *   $is_statusæ˜¯å¦å¼€å¯æ¦‚ç‡ä¸º100å¿…ä¸­: é»˜è®¤ä¸å¼€å¯     ***/</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_rand</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">,</span><span class="token variable">$is_status</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$is_status</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$rest</span> <span class="token operator">=</span> <span class="token function">get_100</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//è°ƒç”¨è·å–100å‘½ä¸­</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>             <span class="token variable">$rest</span> <span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$rest</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$rest</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">//æ¦‚ç‡æ•°ç»„çš„æ€»æ¦‚ç‡ç²¾åº¦</span>            <span class="token variable">$proSum</span> <span class="token operator">=</span> <span class="token function">array_sum</span><span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//æ¦‚ç‡æ•°ç»„å¾ªç¯</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$proArr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$proCur</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 <span class="token variable">$randNum</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$proSum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$randNum</span> <span class="token operator">&lt;=</span> <span class="token variable">$proCur</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                     <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>                     <span class="token keyword">break</span><span class="token punctuation">;</span>                 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                     <span class="token variable">$proSum</span> <span class="token operator">-=</span> <span class="token variable">$proCur</span><span class="token punctuation">;</span>                 <span class="token punctuation">}</span>               <span class="token punctuation">}</span>         <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$rest</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">unset</span> <span class="token punctuation">(</span><span class="token variable">$proArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_100</span><span class="token punctuation">(</span><span class="token variable">$arr_mast</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr_mast</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value_mast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value_mast</span><span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>                 <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>                  <span class="token punctuation">}</span>         <span class="token keyword">unset</span> <span class="token punctuation">(</span><span class="token variable">$arr_mast</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP å›¾ç‰‡å¯¹ç§°åŠ è§£å¯†</title>
      <link href="posts/8331d4d3.html"/>
      <url>posts/8331d4d3.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP-å›¾ç‰‡åŠ è§£å¯†"><a href="#PHP-å›¾ç‰‡åŠ è§£å¯†" class="headerlink" title="PHP å›¾ç‰‡åŠ è§£å¯†"></a>PHP å›¾ç‰‡åŠ è§£å¯†</h1><blockquote><p>å¯ä»¥å°†äººå‘˜èº«ä»½è¯å›¾ç‰‡é€šè¿‡ä¿®æ”¹å­—èŠ‚åŠ å¯†ï¼Œå¹¶ä¸”å¯å°†èº«ä»½è¯ä¿¡æ¯ä¹Ÿå†™å…¥å›¾ç‰‡ä¸­</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*** *                    .::::. *                  .::::::::. *                 :::::::::::  FUCK YOU *             ..:::::::::::' *           '::::::::::::' *             .:::::::::: *        '::::::::::::::.. *             ..::::::::::::. *           ``:::::::::::::::: *            ::::``:::::::::'        .:::. *           ::::'   ':::::'       .::::::::. *         .::::'      ::::     .:::::::'::::. *        .:::'       :::::  .:::::::::' ':::::. *       .::'        :::::.:::::::::'      ':::::. *      .::'         ::::::::::::::'         ``::::. *  ...:::           ::::::::::::'              ``::. * ```` ':.          ':::::::::'                  ::::.. *                    '.:::::'                    ':'````.. */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Encrypt</span> <span class="token punctuation">{</span><span class="token comment">/** * å›¾ç‰‡å¯¹ç§°åŠ å¯† * * @param [string] $filePath å›¾ç‰‡è·¯å¾„ * @return void */</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">enc</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// æ–‡æ¡£ä¸­å»ºè®®ï¼šä¸ºç§»æ¤æ€§è€ƒè™‘ï¼Œå¼ºçƒˆå»ºè®®åœ¨ç”¨ fopen() æ‰“å¼€æ–‡ä»¶æ—¶æ€»æ˜¯ä½¿ç”¨ 'b' æ ‡è®°ã€‚</span><span class="token variable">$fileId</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rb+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–å‡ºæ–‡ä»¶å¤§å°çš„å­—èŠ‚æ•° ï¼ˆ29124ï¼‰</span><span class="token variable">$fileSize</span> <span class="token operator">=</span> <span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¯»å–æ–‡ä»¶ï¼Œè¿”å›æ‰€è¯»å–çš„å­—ç¬¦ä¸² ï¼ˆè¯»å‡ºæ¥çš„ä¸ºäºŒè¿›åˆ¶åºåˆ—ï¼‰</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">,</span> <span class="token variable">$fileSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨â€œæ— ç¬¦å·å­—ç¬¦â€ï¼Œä»äºŒè¿›åˆ¶å­—ç¬¦ä¸²å¯¹æ•°æ®è¿›è¡Œè§£åŒ…</span><span class="token comment">// ï¼ˆpackã€unpackç”¨æ³•ï¼‰https://segmentfault.com/a/1190000008305573</span><span class="token variable">$imgUnpack</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// $fileSize é•¿åº¦çš„ä¸€ç»´æ•°ç»„ [ 1=&gt;255, 2=&gt;216, 3=&gt;255, â€¦â€¦, 29124=&gt;217 ]</span><span class="token comment">// å…³é—­ä¸€ä¸ªå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tempArr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// è‡ªå®šä¹‰åŠ å¯†è§„åˆ™</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$fileSize</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token variable">$imgUnpack</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å›¾ç‰‡åŸå§‹å­—èŠ‚</span><span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token variable">$byte</span> <span class="token operator">+</span> <span class="token variable">$value</span><span class="token punctuation">;</span> <span class="token comment">// ç»è¿‡åŠ å¯†è§„åˆ™ä¹‹åçš„å­—èŠ‚</span><span class="token comment">// æ‰“åŒ…æˆäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><span class="token variable">$tempArr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$tempArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å°†è§£åŒ…ä¹‹åçš„ä¸€ç»´æ•°ç»„è£…æ¢æˆå­—ç¬¦ä¸²</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é‡å†™å›¾ç‰‡</span><span class="token punctuation">}</span><span class="token comment">/** * å›¾ç‰‡å¯¹ç§°è§£å¯† * * @param [string] $filePathå›¾ç‰‡è·¯å¾„ * @return void */</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">dec</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$fileId</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rb+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fileSize</span> <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">,</span> <span class="token variable">$fileSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$imgUnpack</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tempArr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å¼€å§‹è§£å¯†</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$fileSize</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token variable">$imgUnpack</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token variable">$byte</span> <span class="token operator">-</span> <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token variable">$tempArr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$tempArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * å›¾ç‰‡è¿½åŠ ä¿¡æ¯ * * @param [string] $filePathå›¾ç‰‡è·¯å¾„ * @param [array] $cardmsgéœ€è¦æ·»åŠ çš„ä¿¡æ¯æ•°ç»„ * @param [array] $separateåˆ†éš”æ•°ç»„ï¼ˆç±»ä¼¼äºåšä¸€ä¸ªåŠ å¯†åˆ†éš” keyï¼‰ * @return void */</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">encmsg</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token variable">$cardmsg</span><span class="token punctuation">,</span> <span class="token variable">$separate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// æ–‡æ¡£ä¸­å»ºè®®ï¼šä¸ºç§»æ¤æ€§è€ƒè™‘ï¼Œå¼ºçƒˆå»ºè®®åœ¨ç”¨ fopen() æ‰“å¼€æ–‡ä»¶æ—¶æ€»æ˜¯ä½¿ç”¨ 'b' æ ‡è®°ã€‚</span><span class="token variable">$fileId</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rb+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–å‡ºæ–‡ä»¶å¤§å°çš„å­—èŠ‚æ•° ï¼ˆ29124ï¼‰</span><span class="token variable">$fileSize</span> <span class="token operator">=</span> <span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¯»å–æ–‡ä»¶ï¼Œè¿”å›æ‰€è¯»å–çš„å­—ç¬¦ä¸² ï¼ˆè¯»å‡ºæ¥çš„ä¸ºäºŒè¿›åˆ¶åºåˆ—ï¼‰</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">,</span> <span class="token variable">$fileSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨â€œæ— ç¬¦å·å­—ç¬¦â€ï¼Œä»äºŒè¿›åˆ¶å­—ç¬¦ä¸²å¯¹æ•°æ®è¿›è¡Œè§£åŒ…</span><span class="token comment">// ï¼ˆpackã€unpackç”¨æ³•ï¼‰https://segmentfault.com/a/1190000008305573</span><span class="token variable">$imgUnpack</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// $fileSize é•¿åº¦çš„ä¸€ç»´æ•°ç»„ [ 1=&gt;255, 2=&gt;216, 3=&gt;255, â€¦â€¦, 29124=&gt;217 ]</span><span class="token comment">// å…³é—­ä¸€ä¸ªå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¤„ç†èº«ä»½ä¿¡æ¯</span><span class="token variable">$cardmsgJson</span> <span class="token operator">=</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$cardmsg</span><span class="token punctuation">,</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cardmsgUnpack</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$cardmsgJson</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆå¹¶å›¾ç‰‡å­—èŠ‚ã€è‡ªå®šä¹‰åˆ†éš”æ•°ç»„ï¼ˆç±»ä¼¼æ‰‹åŠ¨åŠ  key å€¼ï¼‰ã€èº«ä»½ä¿¡æ¯å­—èŠ‚</span><span class="token variable">$mergeArr</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$imgUnpack</span><span class="token punctuation">,</span> <span class="token variable">$separate</span><span class="token punctuation">,</span> <span class="token variable">$cardmsgUnpack</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$pack</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$mergeArr</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$pack</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$packStr</span> <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$pack</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token variable">$packStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é‡å†™å›¾ç‰‡</span><span class="token punctuation">}</span><span class="token comment">/** * è·å–è¿½åŠ è¿›å›¾ç‰‡çš„ä¿¡æ¯ * * @param [string] $filePathå›¾ç‰‡è·¯å¾„ * @param [array] $separateå®šä¹‰çš„åˆ†éš”æ•°ç»„ï¼ˆåˆ†éš” keyï¼‰ * @return [string] è¿½åŠ è¿›çš„å›¾ç‰‡ä¿¡æ¯ */</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">decmsg</span> <span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token variable">$separate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æ–‡æ¡£ä¸­å»ºè®®ï¼šä¸ºç§»æ¤æ€§è€ƒè™‘ï¼Œå¼ºçƒˆå»ºè®®åœ¨ç”¨ fopen() æ‰“å¼€æ–‡ä»¶æ—¶æ€»æ˜¯ä½¿ç”¨ 'b' æ ‡è®°ã€‚</span><span class="token variable">$fileId</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rb+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–å‡ºæ–‡ä»¶å¤§å°çš„å­—èŠ‚æ•° (29192)</span><span class="token variable">$fileSize</span> <span class="token operator">=</span> <span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¯»å–æ–‡ä»¶ï¼Œè¿”å›æ‰€è¯»å–çš„å­—ç¬¦ä¸² ï¼ˆè¯»å‡ºæ¥çš„ä¸ºäºŒè¿›åˆ¶åºåˆ—ï¼‰</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">,</span> <span class="token variable">$fileSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨â€œæ— ç¬¦å·å­—ç¬¦â€ï¼Œä»äºŒè¿›åˆ¶å­—ç¬¦ä¸²å¯¹æ•°æ®è¿›è¡Œè§£åŒ…</span><span class="token variable">$imgUnpack</span> <span class="token operator">=</span> <span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// $fileSize é•¿åº¦çš„ä¸€ç»´æ•°ç»„ [ 1=&gt;255, 2=&gt;216, 3=&gt;255, â€¦â€¦, 29192=&gt;217 ]</span><span class="token comment">// å…³é—­ä¸€ä¸ªå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fileId</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$imgUnpackStr</span> <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span><span class="token variable">$imgUnpack</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†ä¸€ç»´æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><span class="token variable">$separateStr</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$separate</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†ä¸€ç»´æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><span class="token variable">$imgAndCardmsgArr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token variable">$separateStr</span><span class="token punctuation">,</span> <span class="token variable">$imgUnpackStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»¥è‡ªå®šä¹‰åˆ†éš”ç¬¦åˆ†éš”å‡ºå›¾ç‰‡å­—èŠ‚å’Œèº«ä»½ä¿¡æ¯å­—èŠ‚</span><span class="token variable">$cardmsgArr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$imgAndCardmsgArr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å–å‡ºèº«ä»½ä¿¡æ¯å­—èŠ‚</span><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$cardmsgArr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å»é™¤èº«ä»½ä¿¡æ¯å­—èŠ‚é¦–ä½ç©ºç™½ ï¼ˆå­—ç¬¦ä¸²è½¬æ•°ç»„æ—¶æ‰€ç•™ï¼‰</span><span class="token variable">$cardmsg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$cardmsgArr</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$cardmsg</span> <span class="token operator">.=</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'C*'</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰“åŒ…æˆäºŒè¿›åˆ¶æ–‡ä»¶å­—ç¬¦ä¸²</span><span class="token punctuation">}</span> <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$cardmsg</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$encrypt</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./001.jpg'</span><span class="token punctuation">;</span><span class="token variable">$separate</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">206</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">,</span> <span class="token number">214</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 15å­—èŠ‚</span><span class="token variable">$cardmsg</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'gender'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ç”·'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'idcard'</span> <span class="token operator">=&gt;</span> <span class="token number">12345678910</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 53å­—èŠ‚</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> å›¾ç‰‡åŠ è§£å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP AES åŠ è§£å¯†</title>
      <link href="posts/ebe0be72.html"/>
      <url>posts/ebe0be72.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP-AES-åŠ è§£å¯†"><a href="#PHP-AES-åŠ è§£å¯†" class="headerlink" title="PHP AES åŠ è§£å¯†"></a>PHP AES åŠ è§£å¯†</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Aesmcrypt</span><span class="token punctuation">{</span>    <span class="token comment">/**     * MCRYPT_ciphername å¸¸é‡ä¸­çš„ä¸€ä¸ªï¼Œæˆ–è€…æ˜¯å­—ç¬¦ä¸²å€¼çš„ç®—æ³•åç§°ã€‚     */</span>    <span class="token keyword">const</span> <span class="token constant">CIPHER</span> <span class="token operator">=</span> <span class="token constant">MCRYPT_RIJNDAEL_128</span><span class="token punctuation">;</span>    <span class="token comment">/**     * MCRYPT_MODE_modename å¸¸é‡ä¸­çš„ä¸€ä¸ªï¼Œæˆ–ä»¥ä¸‹å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªï¼š     * "ecb"ï¼Œ"cbc"ï¼Œ"cfb"ï¼Œ"ofb"ï¼Œ"nofb" å’Œ "stream"ã€‚     */</span>    <span class="token keyword">const</span> <span class="token constant">MODE</span> <span class="token operator">=</span> <span class="token constant">MCRYPT_MODE_CBC</span><span class="token punctuation">;</span>    <span class="token comment">/**     * åŠ å¯†å¯†é’¥ã€‚å¦‚æœå¯†é’¥é•¿åº¦ä¸æ˜¯è¯¥ç®—æ³•æ‰€èƒ½å¤Ÿæ”¯æŒçš„æœ‰æ•ˆé•¿åº¦ï¼Œåˆ™å‡½æ•°å°†ä¼šå‘å‡ºè­¦å‘Šå¹¶è¿”å› FALSE     */</span>    <span class="token keyword">const</span> <span class="token constant">KEY</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'bcb04b7e103a0cd8b54763051'</span><span class="token punctuation">;</span>    <span class="token comment">/**     * aes åŠ å¯†     *     * @param string $str éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²     * @param string $key åŠ å¯†ç”¨åˆ°çš„ key     * @return string åŠ å¯†åçš„å­—ç¬¦ä¸²     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">encryptAes</span> <span class="token punctuation">(</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">KEY</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$keyArr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getLegalKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$encrypted</span> <span class="token operator">=</span> <span class="token function">mcrypt_encrypt</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">CIPHER</span><span class="token punctuation">,</span> <span class="token variable">$keyArr</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">MODE</span><span class="token punctuation">,</span> <span class="token variable">$keyArr</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'iv'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * aes è§£å¯†     *     * @param string $str åŠ å¯†åçš„å­—ç¬¦ä¸²     * @param string $key åŠ å¯†ç”¨åˆ°çš„ key     * @return string è§£å¯†åçš„å­—ç¬¦ä¸²     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">decryptAes</span> <span class="token punctuation">(</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">KEY</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$keyArr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getLegalKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$decrypted</span> <span class="token operator">=</span> <span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token function">mcrypt_decrypt</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">CIPHER</span><span class="token punctuation">,</span> <span class="token variable">$keyArr</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">MODE</span><span class="token punctuation">,</span> <span class="token variable">$keyArr</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'iv'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$decrypted</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç”Ÿæˆæœ‰æ•ˆçš„ key     *     * @param $key åŸå§‹ key     * @return array     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">getLegalKey</span> <span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¿…é¡»ä¸º16ï¼Œ24ï¼Œ32ä¸ªå­—ç¬¦</span>        <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span> <span class="token operator">=&gt;</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'iv'</span> <span class="token operator">=&gt;</span> <span class="token variable">$iv</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> AES </tag>
            
            <tag> åŠ è§£å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–° ï¼ˆå½“å‰åŸºäº laravel ç¼–å†™ï¼‰</title>
      <link href="posts/eaf6377d.html"/>
      <url>posts/eaf6377d.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-CASE-WHEN-è¿›è¡Œæ‰¹é‡æ›´æ–°-ï¼ˆå½“å‰åŸºäº-laravel-ç¼–å†™ï¼‰"><a href="#ä½¿ç”¨-CASE-WHEN-è¿›è¡Œæ‰¹é‡æ›´æ–°-ï¼ˆå½“å‰åŸºäº-laravel-ç¼–å†™ï¼‰" class="headerlink" title="ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–° ï¼ˆå½“å‰åŸºäº laravel ç¼–å†™ï¼‰"></a>ä½¿ç”¨ CASE WHEN è¿›è¡Œæ‰¹é‡æ›´æ–° ï¼ˆå½“å‰åŸºäº laravel ç¼–å†™ï¼‰</h1><h2 id="æœ€ç»ˆæ‰§è¡Œçš„-sql-è¯­å¥ä¸º"><a href="#æœ€ç»ˆæ‰§è¡Œçš„-sql-è¯­å¥ä¸º" class="headerlink" title="æœ€ç»ˆæ‰§è¡Œçš„ sql è¯­å¥ä¸º"></a>æœ€ç»ˆæ‰§è¡Œçš„ sql è¯­å¥ä¸º</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE articles SET view_count = CASEWHEN id = 183 AND user_id = 1 THEN 6WHEN id = 182 AND user_id = 11 THEN 4WHEN id = 181 AND user_id = 15 THEN 4WHEN id = 180 AND user_id = 5 THEN 1ELSE view_count END,updated_at = CASE WHEN id = 183 AND user_id = 1 THEN '2020-11-06 06:44:58'WHEN id = 182 AND user_id = 11 THEN '2020-11-06 06:44:58'WHEN id = 181 AND user_id = 15 THEN '2020-11-06 06:44:58'WHEN id = 180 AND user_id = 5 THEN '2020-11-06 06:44:58'ELSE updated_at END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å°è£…æˆæ–¹æ³•ä¸º"><a href="#å°è£…æˆæ–¹æ³•ä¸º" class="headerlink" title="å°è£…æˆæ–¹æ³•ä¸º"></a>å°è£…æˆæ–¹æ³•ä¸º</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'batch_update'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * $where = [ 'id' =&gt; [180, 181, 182, 183], 'user_id' =&gt; [5, 15, 11, 1]];     * $needUpdateFields = [ 'view_count' =&gt; [11, 22, 33, 44], 'updated_at' =&gt; ['2019-11-06 06:44:58', '2019-11-30 19:59:34', '2019-11-05 11:58:41', '2019-12-13 01:27:59']];     *     * æœ€ç»ˆæ‰§è¡Œçš„ sql è¯­å¥å¦‚ä¸‹æ‰€ç¤º     *     * UPDATE articles SET     * view_count = CASE     * WHEN id = 183 AND user_id = 1 THEN 44     * WHEN id = 182 AND user_id = 11 THEN 33     * WHEN id = 181 AND user_id = 15 THEN 22     * WHEN id = 180 AND user_id = 5 THEN 11     * ELSE view_count END,     * updated_at = CASE     * WHEN id = 183 AND user_id = 1 THEN '2019-12-13 01:27:59'     * WHEN id = 182 AND user_id = 11 THEN '2019-11-05 11:58:41'     * WHEN id = 181 AND user_id = 15 THEN '2019-11-30 19:59:34'     * WHEN id = 180 AND user_id = 5 THEN '2019-11-06 06:44:58'     * ELSE updated_at END     *     *     * æ‰¹é‡æ›´æ–°æ•°æ®     *     * @param string $tableName  éœ€è¦æ›´æ–°çš„è¡¨åç§°     * @param array $where  éœ€è¦æ›´æ–°çš„æ¡ä»¶     * @param array $needUpdateFields  éœ€è¦æ›´æ–°çš„å­—æ®µ     * @return bool|int  æ›´æ–°æ•°æ®çš„æ¡æ•°     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">batch_update</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$tableName</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$where</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$needUpdateFields</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$needUpdateFields</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token comment">// ç¬¬ä¸€ä¸ªæ¡ä»¶æ•°ç»„çš„å€¼</span>        <span class="token variable">$firstWhere</span> <span class="token operator">=</span> <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token function">array_key_first</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// ç¬¬ä¸€ä¸ªæ¡ä»¶æ•°ç»„çš„å€¼çš„æ€»æ•°é‡</span>        <span class="token variable">$whereFirstValCount</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$firstWhere</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éœ€è¦æ›´æ–°çš„ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼çš„æ€»æ•°é‡</span>        <span class="token variable">$needUpdateFieldsValCount</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$needUpdateFields</span><span class="token punctuation">[</span><span class="token function">array_key_first</span><span class="token punctuation">(</span><span class="token variable">$needUpdateFields</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$whereFirstValCount</span> <span class="token operator">!==</span> <span class="token variable">$needUpdateFieldsValCount</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰€æœ‰çš„æ¡ä»¶å­—æ®µæ•°ç»„</span>        <span class="token variable">$whereKeys</span> <span class="token operator">=</span> <span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç»‘å®šå‚æ•°</span>        <span class="token variable">$building</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//        $whereArr = [</span><span class="token comment">//          0 =&gt; "id = 180 AND ",</span><span class="token comment">//          1 =&gt; "user_id = 5 AND ",</span><span class="token comment">//          2 =&gt; "id = 181 AND ",</span><span class="token comment">//          3 =&gt; "user_id = 15 AND ",</span><span class="token comment">//          4 =&gt; "id = 182 AND ",</span><span class="token comment">//          5 =&gt; "user_id = 11 AND ",</span><span class="token comment">//          6 =&gt; "id = 183 AND ",</span><span class="token comment">//          7 =&gt; "user_id = 1 AND ",</span><span class="token comment">//        ]</span>        <span class="token variable">$whereArr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$whereBuilding</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$firstWhere</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$whereKeys</span> <span class="token keyword">as</span> <span class="token variable">$whereKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//                $whereArr[] = "{$whereKey} = {$where[$whereKey][$k]} AND ";</span>                <span class="token variable">$whereArr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$whereKey</span><span class="token punctuation">}</span></span> = ? AND "</span><span class="token punctuation">;</span>                <span class="token variable">$whereBuilding</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$where</span><span class="token punctuation">[</span><span class="token variable">$whereKey</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token comment">//        $whereArray = [</span><span class="token comment">//            0 =&gt; "id = 180 AND user_id = 5",</span><span class="token comment">//            1 =&gt; "id = 181 AND user_id = 15",</span><span class="token comment">//            2 =&gt; "id = 182 AND user_id = 11",</span><span class="token comment">//            3 =&gt; "id = 183 AND user_id = 1",</span><span class="token comment">//        ]</span>        <span class="token variable">$whereArrChunck</span> <span class="token operator">=</span> <span class="token function">array_chunk</span><span class="token punctuation">(</span><span class="token variable">$whereArr</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$whereKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$whereBuildingChunck</span> <span class="token operator">=</span> <span class="token function">array_chunk</span><span class="token punctuation">(</span><span class="token variable">$whereBuilding</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$whereKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$whereArray</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$whereArrChunck</span> <span class="token keyword">as</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$valStr</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token keyword">as</span> <span class="token variable">$vv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$valStr</span> <span class="token operator">.=</span> <span class="token variable">$vv</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// å»é™¤æ‰åé¢çš„ AND å­—ç¬¦åŠç©ºæ ¼</span>            <span class="token variable">$whereArray</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token variable">$valStr</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"AND "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// éœ€è¦æ›´æ–°çš„å­—æ®µæ•°ç»„</span>        <span class="token variable">$needUpdateFieldsKeys</span> <span class="token operator">=</span> <span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$needUpdateFields</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‹¼æ¥ sql è¯­å¥</span>        <span class="token variable">$sqlStr</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$needUpdateFieldsKeys</span> <span class="token keyword">as</span> <span class="token variable">$needUpdateFieldsKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$whereArray</span> <span class="token keyword">as</span> <span class="token variable">$kk</span> <span class="token operator">=&gt;</span> <span class="token variable">$vv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//                $str .= ' WHEN ' . $vv . ' THEN ' . $needUpdateFields[$needUpdateFieldsKey][$kk];</span>                <span class="token variable">$str</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">' WHEN '</span> <span class="token operator">.</span> <span class="token variable">$vv</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' THEN ? '</span><span class="token punctuation">;</span>                <span class="token comment">// åˆå¹¶éœ€è¦ç»‘å®šçš„å‚æ•°</span>                <span class="token variable">$building</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$whereBuildingChunck</span><span class="token punctuation">[</span><span class="token variable">$kk</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$needUpdateFields</span><span class="token punctuation">[</span><span class="token variable">$needUpdateFieldsKey</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$kk</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$sqlStr</span> <span class="token operator">.=</span> <span class="token variable">$needUpdateFieldsKey</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' = CASE '</span> <span class="token operator">.</span> <span class="token variable">$str</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' ELSE '</span> <span class="token operator">.</span> <span class="token variable">$needUpdateFieldsKey</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' END, '</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// å»é™¤æ‰åé¢çš„é€—å·åŠç©ºæ ¼</span>        <span class="token variable">$sqlStr</span> <span class="token operator">=</span> <span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token variable">$sqlStr</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$tblSql</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'UPDATE '</span> <span class="token operator">.</span> <span class="token variable">$tableName</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' SET '</span><span class="token punctuation">;</span>        <span class="token variable">$tblSql</span> <span class="token operator">=</span> <span class="token variable">$tblSql</span> <span class="token operator">.</span> <span class="token variable">$sqlStr</span><span class="token punctuation">;</span>        <span class="token variable">$building</span> <span class="token operator">=</span> <span class="token function">array_reduce</span><span class="token punctuation">(</span><span class="token variable">$building</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_merge"</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        return [$tblSql, $building];</span>        <span class="token keyword">return</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>DB</span><span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$tblSql</span><span class="token punctuation">,</span> <span class="token variable">$building</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP æ— é™éå†æ•°ç»„</title>
      <link href="posts/65e7f3e8.html"/>
      <url>posts/65e7f3e8.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ— é™éå†æ•°ç»„"><a href="#æ— é™éå†æ•°ç»„" class="headerlink" title="æ— é™éå†æ•°ç»„"></a>æ— é™éå†æ•°ç»„</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">function</span> <span class="token function-definition function">fun</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">fun</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>   <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'123'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'b'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'456'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'666'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'d'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'8888'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'e'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'4578'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'f'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'484878'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">fun</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯¹æ— é™æ•°ç»„æ ¼å¼åŒ–æ•°ç»„ä¸­çš„å€¼"><a href="#å¯¹æ— é™æ•°ç»„æ ¼å¼åŒ–æ•°ç»„ä¸­çš„å€¼" class="headerlink" title="å¯¹æ— é™æ•°ç»„æ ¼å¼åŒ–æ•°ç»„ä¸­çš„å€¼"></a>å¯¹æ— é™æ•°ç»„æ ¼å¼åŒ–æ•°ç»„ä¸­çš„å€¼</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'2'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'3'</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'a'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'333'</span><span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'111'</span><span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">recursion</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">recursion</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">{</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$res</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">recursion</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$res</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$v</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// æˆ–è€…è¿™ç§</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">recursion</span><span class="token punctuation">(</span><span class="token keyword type-declaration">array</span> <span class="token operator">&amp;</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token operator">&amp;</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$v</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token function">recursion</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ— é™éå†ä¸åˆ†ç±»-ä¸€"><a href="#æ— é™éå†ä¸åˆ†ç±»-ä¸€" class="headerlink" title="æ— é™éå†ä¸åˆ†ç±»(ä¸€)"></a>æ— é™éå†ä¸åˆ†ç±»(ä¸€)</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'123456'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SET NAMES UTF8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select * from menus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$items</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token constant">MYSQLI_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$items</span><span class="token punctuation">[</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$tree</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$items</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$items</span><span class="token punctuation">[</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pid'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'son'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token variable">$items</span><span class="token punctuation">[</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// æ‰€æœ‰æ•°æ®å †æˆçš„æ•°æ®æ ‘</span><span class="token variable">$tree</span> <span class="token operator">=</span> <span class="token variable">$items</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'son'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">a</span> <span class="token punctuation">(</span><span class="token variable">$tree</span> <span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$level</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$tree</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$level</span><span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tree</span> <span class="token keyword">as</span> <span class="token variable">$id</span> <span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$level</span><span class="token punctuation">;</span>            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token variable">$id</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'son'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">a</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'son'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token variable">$level</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'son'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$level</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$newtree</span> <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token variable">$tree</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$newtree</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ— é™éå†ä¸åˆ†ç±»-äºŒ"><a href="#æ— é™éå†ä¸åˆ†ç±»-äºŒ" class="headerlink" title="æ— é™éå†ä¸åˆ†ç±»(äºŒ)"></a>æ— é™éå†ä¸åˆ†ç±»(äºŒ)</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'123456'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SET NAMES UTF8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select * from menus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$items</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token constant">MYSQLI_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$items</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">menulist</span><span class="token punctuation">(</span><span class="token variable">$menu</span><span class="token punctuation">,</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$level</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">static</span> <span class="token variable">$menus</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$menu</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pid'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$level</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$level</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$level</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;'</span><span class="token operator">.</span><span class="token string single-quoted-string">'â”” '</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$level</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;'</span><span class="token operator">.</span><span class="token string single-quoted-string">'â”” '</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&amp;emsp;&amp;emsp;'</span><span class="token operator">.</span><span class="token string single-quoted-string">'â”” '</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$menus</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">menulist</span><span class="token punctuation">(</span><span class="token variable">$menu</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token variable">$menus</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$newRows</span> <span class="token operator">=</span> <span class="token function">menulist</span><span class="token punctuation">(</span><span class="token variable">$items</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ— é™éå†ä¸åˆ†ç±»-ï¼ˆä¸‰ï¼‰"><a href="#æ— é™éå†ä¸åˆ†ç±»-ï¼ˆä¸‰ï¼‰" class="headerlink" title="æ— é™éå†ä¸åˆ†ç±» ï¼ˆä¸‰ï¼‰"></a>æ— é™éå†ä¸åˆ†ç±» ï¼ˆä¸‰ï¼‰</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$arrs</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'parent_id'</span><span class="token operator">=&gt;</span><span class="token number">0</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">2</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'parent_id'</span><span class="token operator">=&gt;</span><span class="token number">1</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">3</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'parent_id'</span><span class="token operator">=&gt;</span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">4</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'parent_id'</span><span class="token operator">=&gt;</span><span class="token number">2</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token number">5</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'parent_id'</span><span class="token operator">=&gt;</span><span class="token number">0</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">getTree</span><span class="token punctuation">(</span><span class="token variable">$arrs</span><span class="token punctuation">,</span><span class="token variable">$root</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$level</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$tree</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arrs</span> <span class="token keyword">as</span> <span class="token variable">$foo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$foo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'parent_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$level</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                           <span class="token variable">$foo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'children'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getTree</span><span class="token punctuation">(</span><span class="token variable">$arrs</span><span class="token punctuation">,</span><span class="token variable">$foo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$level</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token variable">$tree</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$foo</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token operator">--</span><span class="token variable">$level</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$tree</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">var_export</span> <span class="token punctuation">(</span><span class="token variable">$arrs</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// ä¸€çº§</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ— é™éå†ä¸åˆ†ç±»-ï¼ˆå››ï¼‰"><a href="#æ— é™éå†ä¸åˆ†ç±»-ï¼ˆå››ï¼‰" class="headerlink" title="æ— é™éå†ä¸åˆ†ç±» ï¼ˆå››ï¼‰"></a>æ— é™éå†ä¸åˆ†ç±» ï¼ˆå››ï¼‰</h2><p>å¯¹å…·æœ‰çˆ¶å­å…³ç³»çš„æ•°ç»„è¿›è¡Œé‡æ–°æ’åºï¼Œä¸æ”¹å˜æ•°æ®ç»“æ„</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$permissions</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'a-1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'a-2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'c-1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'c-2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'a-1-2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'a-1-1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">permissionTree</span><span class="token punctuation">(</span><span class="token variable">$permissions</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/** * æ ¹æ®çˆ¶å­å…³ç³»é‡æ–°æ’åº * * @param $data  å…·æœ‰çˆ¶å­å…³ç³»çš„äºŒç»´æ•°ç»„ * @param int $root  è·å–æŒ‡å®šå±‚çº§æ ‡è¯† * @param array $result  ç”¨äºä¿å­˜æ•°æ®çš„æ•°ç»„ * @return array */</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">permissionTree</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$root</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// æ’é™¤æ‰éç›´æ¥å­é›†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pid'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">permissionTree</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPè¿”å›å¯è¯»æ€§æ›´å¥½çš„æ–‡ä»¶å¤§å°æ˜¾ç¤º</title>
      <link href="posts/3676e41e.html"/>
      <url>posts/3676e41e.html</url>
      
        <content type="html"><![CDATA[<h1 id="è¿”å›å¯è¯»æ€§æ›´å¥½çš„æ–‡ä»¶å¤§å°æ˜¾ç¤º"><a href="#è¿”å›å¯è¯»æ€§æ›´å¥½çš„æ–‡ä»¶å¤§å°æ˜¾ç¤º" class="headerlink" title="è¿”å›å¯è¯»æ€§æ›´å¥½çš„æ–‡ä»¶å¤§å°æ˜¾ç¤º"></a>è¿”å›å¯è¯»æ€§æ›´å¥½çš„æ–‡ä»¶å¤§å°æ˜¾ç¤º</h1><ul><li>æ–¹æ³•ä¸€</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/**     * è¿”å›å¯è¯»æ€§æ›´å¥½çš„æ–‡ä»¶å¤§å°     *      * @param $bytes  int æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰     * @param int $decimals ä¿ç•™å¤šå°‘ä½æ•°     * @return string å¸¦å•ä½çš„æ–‡ä»¶å¤§å°å­—ç¬¦ä¸²     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">human_filesize</span> <span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">,</span> <span class="token variable">$decimals</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'B'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'kB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'MB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'GB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'TB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'PB'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// èˆå»æ³•å–æ•´</span>        <span class="token variable">$factor</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%.<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$decimals</span><span class="token punctuation">}</span></span>f"</span><span class="token punctuation">,</span> <span class="token variable">$bytes</span> <span class="token operator">/</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token variable">$factor</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> @<span class="token variable">$size</span><span class="token punctuation">[</span><span class="token variable">$factor</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»¥ä¸Šä»£ç åšè¯¦ç»†è§£é‡Šå¦‚ä¸‹"><a href="#ä»¥ä¸Šä»£ç åšè¯¦ç»†è§£é‡Šå¦‚ä¸‹" class="headerlink" title="ä»¥ä¸Šä»£ç åšè¯¦ç»†è§£é‡Šå¦‚ä¸‹"></a>ä»¥ä¸Šä»£ç åšè¯¦ç»†è§£é‡Šå¦‚ä¸‹</h3><p>æ¯ç›¸é‚»çš„ä¸¤ä¸ªå­˜å‚¨å•ä½ä¹‹é—´ä»¥å­—èŠ‚æ•°é•¿åº¦çš„ <code>3</code> å€åšé—´éš”ï¼Œæ¯”å¦‚çœ‹ä»¥ä¸‹è¡¨ä¸­æ‰€ç¤º</p><table><thead><tr><th>å­—èŠ‚é•¿åº¦</th><th>å­—èŠ‚æ•°</th><th>æ¢ç®—</th><th>Bçº§</th><th>KBçº§</th><th>MBçº§</th><th>GBçº§</th></tr></thead><tbody><tr><td>4</td><td>1000</td><td>1000 / 1024</td><td>0.98 B</td><td></td><td></td><td></td></tr><tr><td>5</td><td>10000</td><td>10000 / 1024</td><td>9.8 B</td><td></td><td></td><td></td></tr><tr><td>6</td><td>10000 0</td><td>10000 0 / 1024</td><td>98 B</td><td></td><td></td><td></td></tr><tr><td>7</td><td>10000 00</td><td>10000 00 / 1024</td><td>980 B</td><td>0.95 KB</td><td></td><td></td></tr><tr><td>8</td><td>10000 000</td><td>10000 000 / 1024</td><td>9800 B</td><td>9.5 KB</td><td></td><td></td></tr><tr><td>9</td><td>10000 0000</td><td>10000 0000 / 1024</td><td>98000 B</td><td>95 KB</td><td></td><td></td></tr><tr><td>10</td><td>10000 0000 0</td><td>10000 0000 0 / 1024</td><td>980000 B</td><td>950 KB</td><td>0.93 MB</td><td></td></tr><tr><td>11</td><td>10000 0000 00</td><td>10000 0000 00 / 1024</td><td>980000 0 B</td><td>950 KB</td><td>9.3 MB</td><td></td></tr><tr><td>12</td><td>10000 0000 000</td><td>10000 0000 000 / 1024</td><td>980000 00 B</td><td>9500 KB</td><td>93 MB</td><td></td></tr><tr><td>13</td><td>10000 0000 0000</td><td>10000 0000 0000 / 1024</td><td>980000B</td><td>95000 KB</td><td>930 MB</td><td>0.91 GB</td></tr></tbody></table><p>é€šè¿‡ä»¥ä¸Šçš„è§„å¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¯ä¸¤ä¸ªç›¸é‚»çš„é‡çº§ä¹‹é—´å¯ä»¥é€šè¿‡å­—èŠ‚é•¿åº¦çš„ <code>3</code> å€æ¥åˆ’åˆ†ï¼Œå‡ 1 çš„è¯ç±»æ¯”åˆ†é¡µçš„é¡µç è®¡ç®—ï¼Œå¦‚æœå­—èŠ‚æ•°é•¿åº¦åˆšå¥½æ˜¯ 3 çš„å€æ•°ï¼Œåº”è¯¥å½’åˆ°å‰ä¸€ä¸ªé‡çº§ï¼Œæ¯”å¦‚å­—èŠ‚æ•°æ˜¯ 100 bytesï¼Œå¯¹åº”é•¿åº¦æ˜¯ 3ï¼Œæ˜¾ç„¶åº”è¯¥æ˜¾ç¤ºä¸º 100B æ›´å¥½ï¼Œè€Œä¸æ˜¯ç”¨ KB æ¥æ˜¾ç¤ºã€‚</p><ul><li>æ–¹æ³•äºŒ</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/**    * å¯¹æ–‡ä»¶å¤§å°åšå¯è¯»æ€§æ›´å¥½çš„æ˜¾ç¤º    *    * @param integer $bytes    å­—èŠ‚æ•°  éœ€è¦æ ¼å¼è½¬æ¢çš„å­—èŠ‚æ•°    * @param integer $decimals ä¿ç•™å‡ ä½å°æ•°    * @return float  å¤„ç†å¥½çš„å­—èŠ‚æ•°    */</span>    <span class="token keyword">function</span> <span class="token function-definition function">format_bytes</span><span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">,</span> <span class="token variable">$decimals</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$units</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'B'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'KB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'MB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'GB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'TB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'PB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$bytes</span> <span class="token operator">&gt;=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token variable">$bytes</span> <span class="token operator">/=</span> <span class="token number">1024</span><span class="token punctuation">;</span>            <span class="token comment">// ç­‰åŒäºä»¥ä¸‹ä»£ç </span>            <span class="token comment">// $size = $bytes = $bytes / 1024;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token variable">$decimals</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$units</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token operator">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è°ƒç”¨æ–¹å¼"><a href="#è°ƒç”¨æ–¹å¼" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h3><blockquote><p>ç›¸æ¯”è€Œè¨€ï¼Œæ–¹å¼ä¸€ä¼šæ¯”æ–¹å¼äºŒå¯è¯»æ€§æ›´åŠ å¥½ä¸€äº›</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$bytes1</span> <span class="token operator">=</span> <span class="token function">human_filesize</span><span class="token punctuation">(</span><span class="token number">94875468</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output: =&gt;  90.48MB</span>    <span class="token variable">$bytes2</span> <span class="token operator">=</span> <span class="token function">format_bytes</span><span class="token punctuation">(</span><span class="token number">94875468</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output:  =&gt;  90.48MB</span>    <span class="token variable">$bytes3</span> <span class="token operator">=</span> <span class="token function">human_filesize</span><span class="token punctuation">(</span><span class="token number">1024000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output:  =&gt;  0.98MB</span>    <span class="token variable">$bytes4</span> <span class="token operator">=</span> <span class="token function">format_bytes</span><span class="token punctuation">(</span><span class="token number">1024000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output:  =&gt;  1000KB</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$bytes1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$bytes2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$bytes3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$bytes4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP-FPM æ€§èƒ½é…ç½®ä¼˜åŒ–</title>
      <link href="posts/6643f286.html"/>
      <url>posts/6643f286.html</url>
      
        <content type="html"><![CDATA[<h1 id="PHP-FPM-æ€§èƒ½é…ç½®ä¼˜åŒ–"><a href="#PHP-FPM-æ€§èƒ½é…ç½®ä¼˜åŒ–" class="headerlink" title="PHP-FPM æ€§èƒ½é…ç½®ä¼˜åŒ–"></a>PHP-FPM æ€§èƒ½é…ç½®ä¼˜åŒ–</h1><blockquote><p>4 æ ¸ 8 G æœåŠ¡å™¨å¤§çº¦å¯ä»¥å¼€å¯ 500 ä¸ª PHP-FPMï¼Œæé™ååé‡åœ¨ 580 qps ï¼ˆQuery Per Second æ¯ç§’æŸ¥è¯¢æ•°ï¼‰å·¦å³ã€‚</p></blockquote><h2 id="Nginx-php-fpm-æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"><a href="#Nginx-php-fpm-æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ" class="headerlink" title="Nginx + php-fpm æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"></a>Nginx + php-fpm æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h2><p>php-fpm å…¨ç§°æ˜¯ <strong>PHP FastCGI Process Manager</strong> çš„ç®€ç§°ï¼Œä»åå­—å¯å¾—çŸ¥ï¼Œæ˜¯ä¸€ä¸ª FastCGI çš„ç®¡ç†å™¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-FastCGIï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-FastCGIï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ FastCGIï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ FastCGIï¼Ÿ</h3><p>FastCGI æ˜¯ <strong>Fast Common Gateway Interface</strong> çš„ç®€ç§°ï¼Œæ˜¯ä¸€ç§äº¤äº’ç¨‹åºï¼ˆæ­¤å¤„æ˜¯ PHPï¼‰ä¸ Web æœåŠ¡å™¨ä¹‹é—´çš„ é€šä¿¡åè®®ã€‚FastCGI æ˜¯æ—©æœŸé€šç”¨ç½‘å…³æ¥å£ï¼ˆCGIï¼‰çš„å¢å¼ºç‰ˆæœ¬ã€‚</p><p>æ³¨æ„ FastCGI å’Œ CGI éƒ½æ˜¯ä¸€ç§ <strong>é€šä¿¡åè®®</strong>ï¼Œç‹¬ç«‹äºä»»ä½•è¯­è¨€ã€‚Web æœåŠ¡å™¨æ— é¡»å¯¹è¯­è¨€æœ‰ä»»ä½•äº†è§£ã€‚é™¤ PHP æœ‰ php-fpm å¤–ï¼Œåƒ Python, Ruby, Perl, Tcl, C/C++, å’Œ Visual Basic éƒ½æœ‰å…¶å„è‡ªçš„ CGI å’Œ FastCGI å®ç°ã€‚</p><h3 id="CGI-å’Œ-FastCGI-çš„åŒºåˆ«ï¼Ÿ"><a href="#CGI-å’Œ-FastCGI-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="CGI å’Œ FastCGI çš„åŒºåˆ«ï¼Ÿ"></a>CGI å’Œ FastCGI çš„åŒºåˆ«ï¼Ÿ</h3><p>CGI ç¨‹åºè¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œå¹¶å¯¹æ¯ä¸ª Web è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ç§æ–¹æ³•éå¸¸å®¹æ˜“å®ç°ï¼Œä½†æ•ˆç‡å¾ˆå·®ï¼Œéš¾ä»¥æ‰©å±•ã€‚ <strong>é¢å¯¹å¤§é‡è¯·æ±‚ï¼Œè¿›ç¨‹çš„å¤§é‡åˆ›å»ºå’Œæ¶ˆäº¡ä½¿æ“ä½œç³»ç»Ÿæ€§èƒ½å¤§å¤§ä¸‹é™ã€‚</strong> æ­¤å¤–ï¼Œç”±äºåœ°å€ç©ºé—´æ— æ³•å…±äº«ï¼Œä¹Ÿé™åˆ¶äº†èµ„æºé‡ç”¨ã€‚</p><p>FastCGI è‡´åŠ›äºå‡å°‘ç½‘é¡µæœåŠ¡å™¨ä¸ CGI ç¨‹åºä¹‹é—´äº¤äº’çš„å¼€é”€ï¼Œä»è€Œä½¿æœåŠ¡å™¨å¯ä»¥åŒæ—¶å¤„ç†æ›´å¤šçš„ç½‘é¡µè¯·æ±‚ã€‚ä¸ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ä¸åŒï¼ŒFastCGI ä½¿ç”¨æŒç»­çš„è¿›ç¨‹æ¥å¤„ç†ä¸€è¿ä¸²çš„è¯·æ±‚ã€‚è¿™äº›è¿›ç¨‹ç”± FastCGI æœåŠ¡å™¨ç®¡ç†ï¼ˆFPMï¼‰ï¼Œè€Œä¸æ˜¯ Web æœåŠ¡å™¨ã€‚å½“è¿›æ¥ä¸€ä¸ªè¯·æ±‚æ—¶ï¼ŒWeb æœåŠ¡å™¨æŠŠç¯å¢ƒå˜é‡å’Œè¿™ä¸ªé¡µé¢è¯·æ±‚é€šè¿‡ä¸€ä¸ª Socket æˆ–è€… TCP Connection ä¼ é€’ç»™ FastCGI è¿›ç¨‹ï¼š</p><p><img src="/medias/loading.gif" data-original="https://cdn.learnku.com/uploads/images/201909/23/1/3PvNql1Ri5.png!large" alt="nginx + php-fpm å·¥ä½œæ¨¡å¼"></p><h2 id="php-fpm-è¿›ç¨‹æ•°è°ƒä¼˜"><a href="#php-fpm-è¿›ç¨‹æ•°è°ƒä¼˜" class="headerlink" title="php-fpm è¿›ç¨‹æ•°è°ƒä¼˜"></a>php-fpm è¿›ç¨‹æ•°è°ƒä¼˜</h2><p>fpm æœåŠ¡å¯åŠ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šæ ¹æ®é…ç½®ä¿¡æ¯é‡Œè®¾ç½®çš„è¿è¡Œæ¨¡å¼ï¼Œæ¥é€‰æ‹©æ˜¯å¦åˆ›å»ºã€ä»¥åŠåˆ›å»ºå¤šå°‘ CGI è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹éšæ—¶å¾…å‘½ï¼Œç­‰å¾…å¤„ç†ä» Web æœåŠ¡å™¨ä¼ é€è¿‡æ¥çš„è¯·æ±‚ï¼š</p><p><img src="/medias/loading.gif" data-original="https://cdn.learnku.com/uploads/images/201909/23/1/6J4kGKBzVL.png!large" alt="nginx é…åˆ php-cgi çš„è¿è¡Œ"></p><p>PHP 7.2 FPM è¿›ç¨‹æ± çš„é…ç½®ä¿¡æ¯ä½äºï¼š</p><pre class="line-numbers language-none"><code class="language-none">/etc/php/7.2/fpm/pool.d/www.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœå¯»ä¸‹ pm è¿è¡Œæ¨¡å¼çš„é…ç½®ï¼Œé»˜è®¤æ˜¯ dynamic ï¼š</p><pre class="line-numbers language-none"><code class="language-none">pm = dynamic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>fpm çš„è¿è¡Œæ¨¡å¼æœ‰ä¸‰ç§ï¼š</p><ul><li>ondemand æŒ‰éœ€åˆ›å»º</li><li>dynamic åŠ¨æ€åˆ›å»º</li><li>static å›ºå®šæ•°é‡</li></ul><p><strong>ondemand</strong></p><p>ondemand åˆå§‹åŒ–æ—¶ä¸ä¼šåˆ›å»ºå¾…å‘½çš„è¿›ç¨‹ã€‚å¹¶ä¸”ä¼šåœ¨ç©ºé—²æ—¶å°†è¿›ç¨‹é”€æ¯ï¼Œè¯·æ±‚è¿›æ¥æ—¶å†å¼€å¯ã€‚ä¸€èˆ¬æ˜¯åœ¨å…±äº«çš„ VPS ä¸Šä½¿ç”¨ã€‚æ˜¯ä¸€ç§æ¯”è¾ƒ èŠ‚çœå†…å­˜ çš„ FPM è¿è¡Œæ–¹å¼ï¼Œä¸è¿‡å› ä¸ºå…¶é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿›ç¨‹ï¼Œæ€§èƒ½è¡¨ç°ä¸ä½³ã€‚</p><p>ç›¸å…³å‚æ•°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">; é»˜è®¤æ˜¯ 10 ç§’ï¼Œè¶…è¿‡ 10 ç§’å³é”€æ¯pm.process_idle_timeout = 10s;; æœ€å¤§å¹¶å­˜è¿›ç¨‹æ•°ï¼Œè¶…è¿‡æ­¤å€¼å°†ä¸å†åˆ›å»ºpm.max_children = 50; æ¯ä¸ªè¿›ç¨‹æœ€å¤šå¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ï¼Œè¶…è¿‡æ­¤å€¼å°†è‡ªåŠ¨é”€æ¯pm.max_requests = 1000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>dynamic</strong></p><p>åŠ¨æ€åˆ›å»ºï¼Œè¿™ä¸ªæ˜¯é»˜è®¤é€‰é¡¹ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒçµæ´»çš„é€‰é¡¹ã€‚å…¼é¡¾ç¨³å®šå’Œå¿«é€Ÿå“åº”ã€‚åŒæ—¶æœ‰å››ä¸ªå‚æ•°ä¼šå½±å“æ­¤é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">; FPM å¯åŠ¨æ—¶åˆ›å»ºçš„è¿›ç¨‹æ•°pm.start_servers = 10; æœ€å¤§å¹¶å­˜è¿›ç¨‹æ•°ï¼Œè¶…è¿‡æ­¤å€¼å°†ä¸å†åˆ›å»ºpm.max_children = 50; ç©ºé—²è¿›ç¨‹æ•°æœ€å°å€¼ï¼Œå¦‚æœç©ºé—²è¿›ç¨‹å°äºæ­¤å€¼ï¼Œåˆ™åˆ›å»ºæ–°çš„å­è¿›ç¨‹pm.min_spare_servers = 10; ç©ºé—²è¿›ç¨‹æ•°æœ€å¤§å€¼ï¼Œå¦‚æœç©ºé—²è¿›ç¨‹å¤§äºæ­¤å€¼ï¼Œåˆ™è¿›è¡Œæ¸…ç†pm.max_spare_servers = 40; æ¯ä¸ªè¿›ç¨‹æœ€å¤šå¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ï¼Œè¶…è¿‡æ­¤å€¼å°†è‡ªåŠ¨é”€æ¯pm.max_requests = 1000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„æ³¨é‡Šå·²ç»å¾ˆé‡Šä¹‰ï¼Œç©ºé—²è¿›ç¨‹çš„æ¦‚å¿µéœ€è¦è®²ä¸‹ã€‚æŒ‰ç…§ä¸Šé¢çš„è®¾ç½®ï¼Œfpm å¯åŠ¨æ—¶ä¼šæœ‰ 10 ä¸ªè¿›ç¨‹å¯åŠ¨ï¼Œæ­¤æ—¶è¿™ 10 ä¸ªè¿›ç¨‹éƒ½å±äºã€Œç©ºé—²è¿›ç¨‹ã€ï¼Œéšæ—¶å¾…å‘½ã€‚</p><p>è¿›æ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œä¸€ä¸ªè¿›ç¨‹å‰å¾€å¤„ç†ï¼Œæ­¤æ—¶å‰©ä¸‹ 9 ä¸ªã€Œç©ºé—²è¿›ç¨‹ã€ï¼Œfpm å‘ç°å°‘äº min_spare_servers è®¾ç½®çš„å€¼ 10 ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªè¿›ç¨‹ä½œä¸ºã€Œç©ºé—²è¿›ç¨‹ã€ï¼Œæ­¤æ—¶ç³»ç»Ÿå­˜åœ¨ 11 ä¸ªè¿›ç¨‹ï¼Œè¿˜æ˜¯ 10 ä¸ªç©ºé—²è¿›ç¨‹ã€‚</p><p>åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚è¿˜æœªå¤„ç†å®Œæˆæ—¶ï¼Œçªç„¶ä¸€æ³¢æµé‡è¿›æ¥ï¼Œä¸€å£æ°”è¿›æ¥äº† 50 ä¸ªè¯·æ±‚ï¼Œå› ä¸º max_children è®¾ç½®äº† 50 ä¸ªå°é¡¶ï¼Œæ‰€ä»¥ FPM ä¼šæ–°å»º 39 ä¸ªè¿›ç¨‹ï¼ŒåŠ ä¸Š 10 ä¸ªè¿›è¡Œè¿›ç¨‹ä¸€èµ·å¤„ç†è¿™æ³¢è¯·æ±‚ï¼Œæ­¤æ—¶ç³»ç»Ÿä¸­æ€»å…± 50 ä¸ªè¿›ç¨‹å…±å­˜ï¼Œ50 ä¸ªè¿›ç¨‹éƒ½å±äºç¹å¿™ä¸­ï¼Œæœªåˆ†é…åˆ°è¿›ç¨‹çš„è¯·æ±‚ä¼šç­‰å¾…ç€ã€‚</p><p>ç­‰æ‰€æœ‰çš„è¯·æ±‚å¤„ç†å®Œæˆåï¼Œç³»ç»Ÿä¸­å…±å­˜çš„ 50 ä¸ªè¿›ç¨‹å˜æˆã€Œç©ºé—²è¿›ç¨‹ã€ï¼Œè¶…è¿‡äº† max_spare_servers å€¼ 40 ä¸ªçš„é™åˆ¶ï¼Œè¶…å‡ºçš„ 10 ä¸ªä¼šè¢«é”€æ¯ï¼Œç³»ç»Ÿæ­¤æ—¶å­˜åœ¨ 40 ä¸ªã€Œç©ºé—²è¿›ç¨‹ã€ï¼Œéšæ—¶å¾…å‘½ã€‚</p><p>å› ä¸ºä¸€ç›´ä¿è¯æœ‰ã€Œç©ºé—²è¿›ç¨‹ã€å¯ä¾›ä½¿ç”¨ï¼Œæ‰€ä»¥ <strong>dynamic</strong> çš„é…ç½®ï¼Œç›¸æ¯” <strong>ondemand</strong> è¿›ç¨‹è¦åŒæ—¶åˆ›å»ºï¼Œå“åº”é€Ÿåº¦è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ã€‚ç„¶è€Œåœ¨è¿˜æ˜¯é¿å…ä¸äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿›ç¨‹å¯¹ç³»ç»Ÿé€ æˆçš„æ¶ˆè€—ã€‚</p><p><strong>static</strong></p><p>å›ºå®šè¿›ç¨‹æ•°é‡æ˜¯æ€§èƒ½æœ€å¥½ï¼Œèµ„æºåˆ©ç”¨ç‡æœ€é«˜çš„è¿è¡Œæ–¹å¼ï¼Œä¸€èˆ¬åœ¨è¦æ±‚å•æœºæ€§èƒ½æœ€é«˜çš„æ—¶å€™ä½¿ç”¨ï¼Œä¾‹å¦‚ä½ å‡†å¤‡åˆ›å»º PHP æœåŠ¡å™¨é›†ç¾¤ï¼Œå¸Œæœ›æ¯å°æœºå™¨éƒ½èƒ½ç‰©å°½å…¶ç”¨ã€‚</p><p>ç›¸å…³é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">; FPM å¯åŠ¨æ—¶åˆ›å»ºçš„è¿›ç¨‹æ•°ï¼Œå¹¶ä¸”ä¼šä¸€ç›´ä¿æŒè¿™ä¸ªæ•°pm.max_children = 50; æ¯ä¸ªè¿›ç¨‹æœ€å¤šå¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ï¼Œè¶…è¿‡æ­¤å€¼å°†è‡ªåŠ¨é”€æ¯pm.max_requests = 1000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>pm.max_children</code> çš„è®¾ç½®ï¼Œéœ€è¦æˆ‘ä»¬æ¯ä¸€ä¸ªè¿›ç¨‹è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼Œéœ€è¦æ¶ˆè€—å¤šå°‘å†…å­˜ï¼Œä»¥åŠæœºå™¨ä¸Šæœ‰å¤šå°‘å†…å­˜å¯ä¾›ä½¿ç”¨ã€‚</p><p>è®¡ç®—å…¬å¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">pm.max_children = å¯ç”¨å†…å­˜ / æ¯ä¸ªè¿›ç¨‹æš‚ç”¨å†…å­˜å¤§å°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ³¨æ„å¯ç”¨å†…å­˜ä¸æ˜¯æœ¬æœºæ‰€æœ‰å†…å­˜ï¼Œè¦é™¤å»å…¶ä»–ç¨‹åºè¿è¡Œï¼Œä¾‹å¦‚è¯´ä½ åº”è¯¥é™¤å» Elasticsearch å ç”¨äº† 2G å†…å­˜ã€‚</p><p>è°ƒè¯•æœŸé—´ï¼Œè¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®æˆ˜è§‚å¯Ÿï¼Œä¸€èˆ¬å»ºè®®ä½¿ç”¨ 80% çš„å†…å­˜ä½¿ç”¨ç‡ï¼Œç•™ 20% ç»™å†…å­˜æ³„éœ²çš„ç©ºé—´å’Œå…¶ä»–è½¯ä»¶è¿è¡Œã€‚</p><p>æœ€åæ˜¯ pm.max_requests å€¼ï¼Œéœ€è¦æˆ‘ä»¬è§‚å¯Ÿåº”ç”¨æ˜¯å¦æœ‰ <strong>å†…å­˜æ³„æ¼</strong>ã€‚ç°ä»£çš„ PHP ç¨‹åºï¼Œå°¤å…¶æ˜¯ Laravel ï¼Œä¼šä¾èµ–äºéå¸¸å¤šçš„æ‰©å±•åŒ…ï¼Œè¿™äº›æ‰©å±•åŒ…ä»£ç è´¨é‡å‚å·®ä¸é½ï¼Œå¤šå°‘ä¼šå‡ºç°å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚å¦‚æœå†…å­˜æ³„éœ²ä¸ä¸¥é‡ï¼Œé‚£ä¹ˆæŠŠå€¼è®¾ç½®é«˜ä¸€ç‚¹ï¼Œè®©å•ä¸ªè¿›ç¨‹åœ¨å­˜æ´»æœŸé—´ <strong>å¤šå¤„ç†ä¸€äº›è¯·æ±‚</strong>ï¼Œå¦‚æœå†…å­˜æ³„éœ²æ¯”è¾ƒä¸¥é‡ï¼Œåº”å½“é…Œæƒ…è®¾ç½®ä½ä¸€ç‚¹ã€‚å¦åˆ™ä¼šå‡ºç°ç³»ç»Ÿ <strong>å†…å­˜ä¸å¤Ÿç”¨</strong>ï¼Œç„¶åå»ä½¿ç”¨ Swap ç‰©ç†å†…å­˜ çš„çª˜å¢ƒã€‚</p><p>ä¿®æ”¹åè¯·è®°å¾—é‡å¯ FPMï¼š</p><pre class="line-numbers language-none"><code class="language-none">sudo service php7.2-fpm restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Unix-Socket-å’Œ-TCP-Socket"><a href="#Unix-Socket-å’Œ-TCP-Socket" class="headerlink" title="Unix Socket å’Œ TCP Socket"></a>Unix Socket å’Œ TCP Socket</h2><p>Nginx è¿æ¥ FPM æœ‰ Unix Socket å’Œ TCP Socket ä¸¤ç§æ–¹å¼ï¼š</p><p>Unix Socketï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>    fastcgi_pass unix:/run/php/php7.2-fpm.sock<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>TCP Socketï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p><p>Unix Socket æ–¹å¼ <strong>æ¯”è¾ƒå¿«</strong> è€Œä¸” <strong>æ¶ˆè€—èµ„æºå°‘</strong>ï¼ˆå·®è·ä¸ä¼šå¤ªå¤§ 0.1% ~ 5% çš„å·®åˆ«ï¼‰ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯åªèƒ½æœ¬æœºä½¿ç”¨ï¼Œæ²¡æœ‰ TCP çµæ´»ã€‚</p><p>å¦‚æœ Nginx å’Œ FPM éƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæ¨èä½¿ç”¨ Unix Socketã€‚å¦‚æœæ˜¯åš PHP æœåŠ¡å™¨é›†ç¾¤ï¼Œä½¿ç”¨ Nginx åšè´Ÿè½½å‡è¡¡çš„è¯ï¼Œåªèƒ½é‡‡ç”¨ TCP çš„é“¾æ¥æ–¹å¼ã€‚</p><p><strong>å¦‚ä½•è®¾ç½®æˆ TCP Socket çš„è¿æ¥æ–¹å¼ï¼Ÿ</strong></p><p>ä»¥ PHP-FPM 7.2 ä¸ºä¾‹ï¼š</p><p>/etc/php/7.2/fpm/pool.d/<a href="http://www.conf/">www.conf</a></p><pre class="line-numbers language-none"><code class="language-none">listen = 127.0.0.1:9000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åŒæ—¶é…ç½® Nginx é‡Œçš„ <code>fastcgi_pass 127.0.0.1:9000;</code> ï¼Œå¹¶é‡å¯ FPM å’Œ Nginxï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> php7.2-fpm restart<span class="token function">sudo</span> <span class="token function">service</span> nginx restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å¦‚ä½•è®¾ç½®æˆ Unix Socket çš„è¿æ¥æ–¹å¼ï¼Ÿ</strong></p><p>ä¿®æ”¹ FPM è¿›ç¨‹æ± é…ç½®ï¼š</p><p>/etc/php/7.2/fpm/pool.d/<a href="http://www.conf/">www.conf</a></p><pre class="line-numbers language-none"><code class="language-none">listen = /run/php/php7.2-fpm.sock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åŒæ—¶é…ç½® Nginx é‡Œçš„ fastcgi_pass unix:/run/php/php7.2-fpm.sock; ï¼Œå¹¶é‡å¯ FPM å’Œ Nginxï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> php7.2-fpm restart<span class="token function">sudo</span> <span class="token function">service</span> nginx restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ–‡ä»¶ <code>/var/run/php/php7.2-fpm.sock</code> ä¼šåœ¨ FPM å¯åŠ¨æ—¶åˆ›å»ºã€‚</p><h2 id="ç”Ÿäº§ç¯å¢ƒä¸­ä¸€å®šè¦å…³é—­æ‰-Xdebug-æ‰©å±•"><a href="#ç”Ÿäº§ç¯å¢ƒä¸­ä¸€å®šè¦å…³é—­æ‰-Xdebug-æ‰©å±•" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒä¸­ä¸€å®šè¦å…³é—­æ‰ Xdebug æ‰©å±•"></a>ç”Ÿäº§ç¯å¢ƒä¸­ä¸€å®šè¦å…³é—­æ‰ Xdebug æ‰©å±•</h2><p>æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒçš„ PHP åŸç”Ÿæ‰©å±•æ–‡ä»¶å¤¹é‡Œæ˜¯å¦å­˜åœ¨ï¼Œä»¥ PHP 7.2 ä¸ºä¾‹å­˜æ”¾è·¯å¾„ä¸ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">/etc/php/7.2/mods-available/xdebug.ini<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰¾åˆ°ä»¥åç¡®ä¿ä½¿ç”¨ <code>;</code> ç¬¦æ³¨é‡Šæ‰ï¼š</p><p>/etc/php/7.2/mods-available/xdebug.ini</p><pre class="line-numbers language-none"><code class="language-none">;zend_extension=xdebug.so<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‡å¯ fpm</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> php7.2-fpm restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ£€æŸ¥ php-fpm çš„è¿›ç¨‹æ•°é‡</p><pre class="line-numbers language-none"><code class="language-none"># ä¼šå¤šå‡ºä¸¤ä¸ªè¿›ç¨‹æ•°ï¼Œæ˜¯å› ä¸ºæœ‰ä¸€ä¸ªä¸è´Ÿè´£å¤„ç†è¯·æ±‚çš„ php-fpm master è¿›ç¨‹å’Œä¸€ä¸ª grep è¿›ç¨‹ps -aux | grep php-fpm | wc -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å¼€å¯-Slow-log-å®šä½æ…¢è„šæœ¬"><a href="#å¼€å¯-Slow-log-å®šä½æ…¢è„šæœ¬" class="headerlink" title="å¼€å¯ Slow log å®šä½æ…¢è„šæœ¬"></a>å¼€å¯ Slow log å®šä½æ…¢è„šæœ¬</h2><h3 id="å¦‚ä½•å¼€å¯ï¼Ÿ"><a href="#å¦‚ä½•å¼€å¯ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¼€å¯ï¼Ÿ"></a>å¦‚ä½•å¼€å¯ï¼Ÿ</h3><p>PHP-FPM æä¾›ä¸€ä¸ªå« <strong>æ…¢æ—¥å¿—</strong> (slowlog) çš„åŠŸèƒ½ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å®šä½æ‰§è¡Œæ…¢çš„è„šæœ¬ã€‚ä»¥ PHP 7.2 ä¸ºä¾‹ï¼ŒFPM çš„é…ç½®ä¿¡æ¯ä½äºï¼š</p><pre class="line-numbers language-none"><code class="language-none">/etc/php/7.2/fpm/pool.d/www.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›¸å…³é…ç½®é¡¹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">; æ…¢æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤ `$pool` è®¾ç½®ä¸º `www`slowlog = /var/log/$pool.slow.log; è®¾ç½®æ…¢æ—¥å¿—è¶…æ—¶æ ‡å‡†ï¼Œè®¾ç½®ä¸º 0 ä»£è¡¨å…³é—­æ…¢æ—¥å¿—request_slowlog_timeout = 1s; æ…¢æ—¥å¿—è®°å½•è„šæœ¬å †æ ˆçš„æ·±åº¦request_slowlog_trace_depth = 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šçš„é…ç½®ç¿»è¯‘è¿‡æ¥ï¼šæŒ‡å®š FPM å½“å‘ç°æœ‰è¯·æ±‚æ‰§è¡Œè¶…è¿‡ 1 ç§’é’Ÿçš„æ—¶å€™ï¼Œå°†æ•´ä¸ªè°ƒç”¨å †æ ˆè®°å½•åˆ° <code>/var/log/www.slow.log</code> æ–‡ä»¶é‡Œï¼Œå †æ ˆçš„æ·±åº¦ä¸è¶…è¿‡ 20ã€‚</p><p>ä½ å¯ä»¥æŠŠ 1s æ”¹æˆå…¶ä»–å€¼ï¼Œå¦‚ 10sã€‚æœ‰äº†ä»¥ä¸Šçš„è®¾ç½®ï¼Œè£å‰ªå›¾åƒå°ºå¯¸çš„æ–¹æ³•ã€ ç½‘ç»œ I/O ç›¸å…³çš„ä¸€äº›è¯·æ±‚éƒ½ç»å¸¸å‡ºç°åœ¨ PHP æ…¢æ—¥å¿—ä¸­ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µæ¥é€‰æ‹©è°ƒæ•´æˆ–è€…å¿½ç•¥ã€‚</p><h3 id="å¦‚ä½•åˆ†æï¼Ÿ"><a href="#å¦‚ä½•åˆ†æï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†æï¼Ÿ"></a>å¦‚ä½•åˆ†æï¼Ÿ</h3><p>å¯ä»¥ä½¿ç”¨ grep å‘½ä»¤æ¥å¿«é€Ÿå®šä½æŸä¸ªå‡½æ•°è°ƒç”¨ã€æˆ–è€…è„šæœ¬åç§°è¢«è®°å½•çš„æ¬¡æ•°ï¼Œè®°å½•çš„æ¬¡æ•°è¶Šå¤šï¼Œä¼˜åŒ–çš„ä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚ä»¥ä¸‹æ˜¯ç®€å•çš„ ç¤ºä¾‹</p><pre class="line-numbers language-none"><code class="language-none">grep -o 'fetch_github_user' /var/log/www.slow.log | wc -lgrep -o 'sendEmail' /var/log/www.slow.log | wc -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›‘æ§ Slowlog å’Œè®°å½•æ—¥å¿—çš„è¿‡ç¨‹ä¼šå¯¹ PHP é€ æˆæ¶ˆè€—ï¼Œ åˆ‡è®° è°ƒè¯•ç»“æŸåï¼ŒåŠ¡å¿…å°†å…¶å…³é—­ã€‚</strong></p><h2 id="å¼€å¯-OPcache"><a href="#å¼€å¯-OPcache" class="headerlink" title="å¼€å¯ OPcache"></a>å¼€å¯ OPcache</h2><p>OPcache æ˜¯ç”± PHP å®˜æ–¹å…¬å¸ Zend å¼€å‘çš„ä¸€æ¬¾å…è´¹ä½¿ç”¨çš„ PHP ä¼˜åŒ–åŠ é€Ÿæ‹“å±•ã€‚ä»–å¯ä»¥å°† PHP è„šæœ¬ç¼–è¯‘åçš„ bytecode ç¼“å­˜åœ¨å…±äº«å†…å­˜ä¸­ä¾›ä»¥ååå¤ä½¿ç”¨ï¼Œä»è€Œé¿å…äº†ä»ç£ç›˜è¯»å–ä»£ç å†æ¬¡ç¼–è¯‘çš„æ¶ˆè€—ã€‚åŒæ—¶ï¼Œå®ƒè¿˜åº”ç”¨äº†ä¸€äº›ä»£ç ä¼˜åŒ–æ¨¡å¼ï¼Œä½¿å¾—ä»£ç æ‰§è¡Œæ›´å¿«ã€‚ä»è€ŒåŠ é€Ÿ PHP åº”ç”¨å“åº”ã€‚</p><p>PHP è‡ª 5.5 ç‰ˆå¼€å§‹ï¼Œå°±å·²ç»å†…ç½®äº† OPcache æ‰©å±•ã€‚ä¸è¿‡é»˜è®¤æ˜¯å…³é—­çŠ¶æ€çš„ã€‚</p><h3 id="å¼€å¯-OPcache-1"><a href="#å¼€å¯-OPcache-1" class="headerlink" title="å¼€å¯ OPcache"></a>å¼€å¯ OPcache</h3><p>PHP 7.2 FPM çš„é…ç½®ä¿¡æ¯ä½äºï¼š</p><pre class="line-numbers language-none"><code class="language-none">/etc/php/7.2/fpm/php.ini<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¼–è¾‘ä»¥ä¸Šæ–‡ä»¶ï¼Œæœç´¢ <code>opcache.enable</code> å°†å€¼è®¾ä¸º <code>1</code> å³ä¸ºå¼€å¯</p><pre class="line-numbers language-none"><code class="language-none">opcache.enable=1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>php.ini</code> é‡Œç›¸å…³çš„é…ç½®ä»¥ä¸‹ï¼Œæ³¨é‡Šé‡ŒåŒ…æ‹¬è¯´æ˜å’Œæ¨èè®¾ç½®çš„å€¼ï¼Œè¯·è¯¦ç»†é˜…è¯»ï¼š</p><pre class="line-numbers language-none"><code class="language-none">; æ˜¯å¦åœ¨å‘½ä»¤è¡Œå¼€å¯ï¼Œè¿™é‡Œé»˜è®¤è®¾ç½®ä¸º 0 ï¼Œæš‚ä¸”å…³é—­;opcache.enable_cli=0; è¿™ä¸ªå†…å­˜æ˜¯ç”¨æ¥å­˜å‚¨ç¼–è¯‘åçš„å­—èŠ‚ç çš„ï¼Œè§†ä½ çš„ç¨‹åº; ä»£ç é‡è€Œå®šï¼ŒLaravel åº”ç”¨ä¸€èˆ¬å»ºè®®è®¾ç½®ä¸º 256ï¼Œå•ä½ MBï¼Œ; é»˜è®¤æ˜¯ 128opcache.memory_consumption=256; ä¼šå¯¹ç¨‹åºæ‰€æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œç»Ÿä¸€å­˜å‚¨ä»¥åŠ å¿«å­˜å–é€Ÿåº¦ï¼Œ; é»˜è®¤æ˜¯ 8mï¼Œå»ºè®® 32 æˆ–è€…ä¸è¶…è¿‡ 64ã€‚opcache.interned_strings_buffer=32; æœ€å¤§åŠ é€Ÿå¤šå°‘ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œè§†é¡¹ç›®è„šæœ¬æ–‡ä»¶æ•°è€Œå®šï¼Œ; åˆç†åŒºé—´ 200~1000000 ï¼Œé»˜è®¤æ˜¯ 10000 ï¼Œå»ºè®® 500000opcache.max_accelerated_files=1000000; æœ€å¤§ä½œåºŸæ¯”ä¾‹ç™¾åˆ†æ¯”ï¼Œåˆ°è¾¾è¿™ä¸ªæ¯”ä¾‹ä¼šé‡å¯ï¼Œé»˜è®¤æ˜¯ 5 ï¼Œå»ºè®® 10opcache.max_wasted_percentage=10; å¼€å¯æƒ…å†µä¸‹ä¼šåœ¨è„šæœ¬åç§°å‰åŠ ä¸Šå½“å‰ç›®å½•ä¿¡æ¯åšä¸ºç¼“å­˜çš„ Keyï¼Œå…³é—­å¯ä»¥; æé«˜æ€§èƒ½ï¼Œä½†æ˜¯ä¼šé¢ä¸´å‡ºé”™çš„é£é™©ï¼ˆæ–‡ä»¶åä¸€è‡´æ—¶ï¼‰ï¼Œå»ºè®®å¼€å¯ï¼Œå…³é—­ä½¿ç”¨ 0opcache.use_cwd=1; å¼€å¯çš„è¯ï¼Œä¼šæŒ‰ç…§ opcache.revalidate_freq è®¾ç½®çš„é¢‘ç‡å»æ£€æŸ¥æ–‡ä»¶; æ˜¯å¦ä¿®æ”¹ä»¥ä¾¿é‡æ–°ç¼“å­˜ï¼Œé»˜è®¤å¼€å¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹è¯·è®¾ç½®ä¸ºå…³é—­ï¼Œç„¶å; å†™è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œåœ¨æ¯æ¬¡æ›´æ–°ä»£ç åè‡ªåŠ¨é‡å¯ OPcacheopcache.validate_timestamps=0; æ–‡ä»¶æ›´æ–°æ£€æµ‹é¢‘ç‡ï¼Œå•ä½ç§’ï¼Œåªæœ‰åœ¨ opcache.validate_timestamps ; å¼€å¯æ—¶æ‰æœ‰æ•ˆã€‚é»˜è®¤ä¸º 2ï¼Œæ„å‘³ç€ 2 ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼Œä¼šå¯¹æ–‡ä»¶ç³»ç»Ÿé€ ; æˆè´Ÿæ‹…ï¼Œå¦‚æœæ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸­è¯·é…Œæƒ…ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒéšæ„è®¾ç½®ï¼Œå› ä¸º; æˆ‘ä»¬ä¼šè®¾ç½® validate_timestamps ä¸ºå…³é—­ã€‚opcache.revalidate_freq=2200; æ–‡ä»¶åŠ è½½çš„é€»è¾‘ï¼Œé»˜è®¤å…³é—­ï¼Œæ— éœ€ä¿®æ”¹;opcache.revalidate_path=0; å¼€å¯çš„è¯ä¼šæŠŠä»£ç æ³¨é‡Šä¸€èµ·ç¼“å­˜ï¼Œå…³é—­å¯å‡ä½å†…å­˜ä½¿ç”¨ï¼Œä½†æ˜¯; å¦‚æœæœ‰ä¸€äº›ä»£ç ä¾èµ–äºæ³¨é‡Šé‡Œçš„æŒ‡ä»¤ï¼Œä¾‹å¦‚ Doctrine, ; Zend Framework 2 å’Œ PHPUnitï¼Œå°†ä¼šå‡ºç°é—®é¢˜ã€‚å»ºè®®å¼€å¯opcache.save_comments=1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹å®Œæˆåï¼Œéœ€è¦é‡å¯ FPM ç”Ÿæ•ˆï¼š</p><pre class="line-numbers language-none"><code class="language-none">sudo service php7.2-fpm restart <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°† <code>opcache.validate_timestamp</code> è®¾ç½®ä¸º 0 ä»¥è·å–æœ€å¤§æ€§èƒ½ã€‚ç„¶ååœ¨ä»£ç å˜æ›´æ—¶å€™ï¼Œå†é‡ç½® OPcacheã€‚</p><p>æœ‰ä¸¤ç§é‡ç½® OPcache çš„æ–¹æ³•ï¼Œä¸€ç§æ˜¯é‡å¯ FPMã€‚æ­¤æ–¹æ³•è™½ç„¶å¾ˆæœ‰æ•ˆï¼Œä½†æ˜¯ä¼šä¸­æ–­æ­£åœ¨å¤„ç†çš„è¯·æ±‚ï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>å¦ä¸€ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨ <code>opcache_reset()</code> æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šé‡ç½® OPcache ç¼“å­˜å¹¶ä¸”ä¸éœ€è¦é‡å¯ FPMã€‚ç„¶è€Œï¼ŒOPcache æ˜¯è¿è¡Œåœ¨ FPM ç¯å¢ƒä¸­çš„ï¼Œåœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸­è°ƒç”¨æ­¤å‡½æ•°æ— æ•ˆã€‚å¿…é¡»æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ HTTP è®¿é—®åˆ°çš„è„šæœ¬ä¸Šæ¥è°ƒç”¨ <code>opcache_reset()</code> æ‰è¡Œã€‚æ— æ³•åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œã€‚</p><h3 id="åœ¨-laravel-ä¸­ä½¿ç”¨-OPcache-ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨-laravel-opcache"><a href="#åœ¨-laravel-ä¸­ä½¿ç”¨-OPcache-ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨-laravel-opcache" class="headerlink" title="åœ¨ laravel ä¸­ä½¿ç”¨ OPcache ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ laravel-opcache"></a>åœ¨ laravel ä¸­ä½¿ç”¨ OPcache ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://github.com/appstract/laravel-opcache">laravel-opcache</a></h3><blockquote><p>OPcache æ˜¯å¯¹ PHP è„šæœ¬çš„ç¼“å­˜ï¼Œæ¯æ¬¡æ›´æ”¹ä»»ä½• PHP ä»£ç æ—¶ä½ éƒ½éœ€è¦æ¸…é™¤ç¼“å­˜</p></blockquote><pre class="line-numbers language-none"><code class="language-none"># å®‰è£…composer require appstract/laravel-opcache# æ¸…ç©º fpm é‡Œçš„ OPcachephp artisan opcache:clear# æŸ¥çœ‹ OPcache çš„é…ç½®ä¿¡æ¯php artisan opcache:config# æŸ¥çœ‹ OPcache è¿è¡ŒçŠ¶æ€ï¼ˆå†…å­˜ä½¿ç”¨ã€ç¼“å­˜äº†å¤šå°‘æ–‡ä»¶ç­‰ï¼‰php artisan opcache:status# æå‰ç¼–è¯‘æ–‡ä»¶php artisan opcache:compile {--force}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> PHP-FPM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>composer ä½¿ç”¨</title>
      <link href="posts/9b3c7295.html"/>
      <url>posts/9b3c7295.html</url>
      
        <content type="html"><![CDATA[<h1 id="composer-ä½¿ç”¨"><a href="#composer-ä½¿ç”¨" class="headerlink" title="composer ä½¿ç”¨"></a>composer ä½¿ç”¨</h1><h2 id="è¯­ä¹‰åŒ–ç‰ˆæœ¬"><a href="#è¯­ä¹‰åŒ–ç‰ˆæœ¬" class="headerlink" title="è¯­ä¹‰åŒ–ç‰ˆæœ¬"></a><a href="http://semver.org/">è¯­ä¹‰åŒ–ç‰ˆæœ¬</a></h2><h3 id="ç‰ˆæœ¬å·çš„ç»„æˆ"><a href="#ç‰ˆæœ¬å·çš„ç»„æˆ" class="headerlink" title="ç‰ˆæœ¬å·çš„ç»„æˆ"></a>ç‰ˆæœ¬å·çš„ç»„æˆ</h3><p>major.minor.patch =&gt; ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</p><ul><li>majorï¼šé€šå¸¸ä¼šå‘ç”Ÿ api å˜æ›´ï¼Œä¸å‘åå…¼å®¹</li><li>minorï¼šæ–°å¢åŠŸèƒ½ï¼Œä½†æ˜¯å‘åå…¼å®¹</li><li>patchï¼šè¡¥ä¸ï¼Œå‘åå…¼å®¹ï¼Œä¿®å¤ bug</li></ul><h3 id="ç‰ˆæœ¬ç¬¦å·"><a href="#ç‰ˆæœ¬ç¬¦å·" class="headerlink" title="ç‰ˆæœ¬ç¬¦å·"></a>ç‰ˆæœ¬ç¬¦å·</h3><ul><li><code>~</code>ï¼šæŒ‡å®šå‘åå…¼å®¹çš„æœ€å°ç‰ˆæœ¬<ul><li><code>~1.2</code> ç­‰äº &gt;=1.2 &amp;&amp; &lt;2.0.0</li><li><code>~1.2.3</code> ç­‰äº &gt;=1.2.3 &amp;&amp; &lt;1.3.0</li></ul></li><li><code>^</code>ï¼šå…è®¸å¤§ç‰ˆæœ¬å‰çš„æ‰€æœ‰ç‰ˆæœ¬<ul><li><code>^1.2</code> ç­‰äº &gt;=1.2 &amp;&amp; &lt;2.0.0</li><li><code>^1.2.3</code> ç­‰äº &gt;=1.2.3 &amp;&amp; &lt;2.0 ï¼ˆåŒºåˆ«åœ¨è¿™é‡Œï¼‰</li></ul></li></ul><h3 id="ä½¿ç”¨ç‰ˆæœ¬å·"><a href="#ä½¿ç”¨ç‰ˆæœ¬å·" class="headerlink" title="ä½¿ç”¨ç‰ˆæœ¬å·"></a>ä½¿ç”¨ç‰ˆæœ¬å·</h3><ul><li>ç¡®åˆ‡ç‰ˆæœ¬ï¼š1.0.2</li><li>èŒƒå›´ï¼š&gt;=1.0ã€&gt;=1.0 &lt;2.0ã€&gt;=1.0 &lt;1.1 || &gt;=1.2</li><li>è¿å­—ç¬¦èŒƒå›´ï¼š1.0 - 2.0</li><li>é€šé…ç¬¦ï¼š1.0.*</li><li>æ³¢æµªè¿ç®—ç¬¦ï¼š~1.2.3</li><li>^è¿ç®—ç¬¦ï¼š^1.2.3</li></ul><blockquote><p><a href="https://packagist.org/">packagist åŒ…ç®¡ç†å®˜æ–¹ç½‘ç«™</a></p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="linux-ä¸‹å®‰è£…-composer"><a href="#linux-ä¸‹å®‰è£…-composer" class="headerlink" title="linux ä¸‹å®‰è£… composer"></a>linux ä¸‹å®‰è£… composer</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥ä»é˜¿é‡Œäº‘é•œåƒä¸­ä¸‹è½½ composer.phar</span><span class="token function">wget</span> https://mirrors.aliyun.com/composer/composer.phar<span class="token comment"># æˆ–è€…ç›´æ¥ä»å®˜ç½‘ä¸‹è½½ composer.phar äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶</span><span class="token function">wget</span> https://getcomposer.org/download/2.0.11/composer.phar<span class="token comment"># æˆ–è€…ä½¿ç”¨ composer ä¸­å›½é•œåƒå®‰è£…å™¨å®‰è£…</span><span class="token function">curl</span> <span class="token parameter variable">-sS</span> http://install.phpcomposer.com/installer <span class="token operator">|</span> <span class="token function">sudo</span> php -- --install-dir<span class="token operator">=</span>/usr/local/bin <span class="token parameter variable">--filename</span><span class="token operator">=</span>composer<span class="token comment"># æ·»åŠ æ‰§è¡Œæƒé™</span><span class="token function">chmod</span> u+x composer.phar<span class="token comment"># å°† composer.phar ç§»åŠ¨åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥æ–¹ä¾¿åœ¨ä»»æ„ä½ç½®éƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œ composer å‘½ä»¤</span><span class="token function">mv</span> composer.phar /usr/local/bin/composer<span class="token comment"># å¦‚æœæ²¡æœ‰ /usr/local/bin ç›®å½•ï¼Œåˆ™éœ€è¦è‡ªå·±åˆ›å»º</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/bin<span class="token comment"># å¦‚æœä½ åªæƒ³ä¸ºä½ çš„ç”¨æˆ·å®‰è£… composer å¹¶é¿å…éœ€è¦ root æƒé™ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå‰ææ˜¯ä½ å¾—æœ‰ ~/local/bin ç›®å½•</span><span class="token function">mv</span> composer.phar ~/local/bin<span class="token comment"># æ·»åŠ é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</span><span class="token function">composer</span> config <span class="token parameter variable">-g</span> repo.packagist <span class="token function">composer</span> https://mirrors.aliyun.com/composer<span class="token comment"># æˆ–è€…æ·»åŠ ä¸­å›½é•œåƒ</span><span class="token function">composer</span> config <span class="token parameter variable">-g</span> repo.packagist <span class="token function">composer</span> https://packagist.phpcomposer.com<span class="token comment"># è§£é™¤é•œåƒ</span><span class="token function">composer</span> config <span class="token parameter variable">-g</span> <span class="token parameter variable">--unset</span> repos.packagist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="windows-ä¸‹å®‰è£…-composer"><a href="#windows-ä¸‹å®‰è£…-composer" class="headerlink" title="windows ä¸‹å®‰è£… composer"></a>windows ä¸‹å®‰è£… composer</h3><pre class="line-numbers language-none"><code class="language-none"># åœ¨ D ç›˜ä¸­æ–°å»ºä¸€ä¸ª composer ç›®å½•# ç›´æ¥ä»å®˜ç½‘ä¸‹è½½ composer.phar äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶wget https://getcomposer.org/download/2.0.11/composer.phar# ä½¿ç”¨ php.exe æ‰§è¡Œ composer.phar æµ‹è¯•æ˜¯å¦æ­£å¸¸I:\xampp\php\php.exe composer.phar -V# ç®€åŒ–å‘½ä»¤echo @I:\xampp\php\php.exe "d:\composer\composer.phar" %*&gt;composer.bat# å°† D:/composer ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­å»# æŸ¥çœ‹ composer ç‰ˆæœ¬å·ï¼Œç¡®å®šæ˜¯å¦å·²ç»å®‰è£…æˆåŠŸcomposer -V ï¼ˆå¤§å†™çš„ Vï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="composer-json-å’Œ-composer-lock"><a href="#composer-json-å’Œ-composer-lock" class="headerlink" title="composer.json å’Œ composer.lock"></a>composer.json å’Œ composer.lock</h3><p>å½“é¡¹ç›®ä¸­å­˜åœ¨ composer.lock æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ <code>composer install</code> å‘½ä»¤å®‰è£…ä¾èµ–æ—¶ï¼Œ<code>composer.lock</code> éƒ½ä¼šè§£æå¹¶å®‰è£…ä½ åœ¨ <code>composer.json</code> ä¸­æ‰€åˆ—å‡ºæ¥çš„ä¾èµ–ï¼Œä½†æ˜¯ <code>composer</code> ä¼šä¸¥æ ¼ä½¿ç”¨ <code>composer.lock</code> æ–‡ä»¶æ‰€åˆ—å‡ºæ¥çš„ç‰ˆæœ¬ä»¥ç¡®ä¿é¡¹ç›®ä¸­å¾—æ‰€æœ‰æˆå‘˜æ‰€å®‰è£…çš„ç‰ˆæœ¬éƒ½æ˜¯ä¸€è‡´çš„ã€‚<strong>éœ€è¦å°† composer.lock</strong> æ–‡ä»¶æäº¤åˆ°ä»£ç ç®¡ç†ä¸­ã€‚</p><h3 id="è‡ªåŠ¨åŠ è½½"><a href="#è‡ªåŠ¨åŠ è½½" class="headerlink" title="è‡ªåŠ¨åŠ è½½"></a>è‡ªåŠ¨åŠ è½½</h3><p>æ‰§è¡Œ <code>composer install</code> å‘½ä»¤æ—¶ï¼Œä¼šç”Ÿæˆ <code>vendor/autoload.php</code>  æ–‡ä»¶ï¼Œåªéœ€ include è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨è¿™äº›åŒ…æ‰€æä¾›çš„ç±»</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span><span class="token variable">$log</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Monolog<span class="token punctuation">\</span>Logger</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$log</span><span class="token operator">-&gt;</span><span class="token function">pushHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Monolog<span class="token punctuation">\</span>Handler<span class="token punctuation">\</span>StreamHandler</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'app.log'</span><span class="token punctuation">,</span> <span class="token class-name class-name-fully-qualified static-context">Monolog<span class="token punctuation">\</span>Logger</span><span class="token operator">::</span><span class="token constant">WARNING</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$log</span><span class="token operator">-&gt;</span><span class="token function">addWarning</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>composer.json</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª <code>autoload</code> æŒ‡ä»¤æ¥æ·»åŠ è‡ªå·±çš„è‡ªåŠ¨åŠ è½½å£°æ˜</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token punctuation">{</span>    <span class="token string double-quoted-string">"autoload"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string double-quoted-string">"psr-4"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string double-quoted-string">"Acme\\"</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"src/"</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>composer ä¼šä¸º Acme å‘½åç©ºé—´æ³¨å†Œä¸€ä¸ª <code>PSR-4</code> çš„è‡ªåŠ¨åŠ è½½ã€‚<br>ä½ å®šä¹‰ä¸€ä¸ªå‘½åç©ºé—´æŒ‡å‘ç›®å½•çš„æ˜ å°„ã€‚ åœ¨ vendor ç›®å½•åŒçº§çš„ src ç›®å½•å°†æˆä¸ºä½ é¡¹ç›®çš„æ ¹ç›®å½•ã€‚ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ–‡ä»¶å src/Foo.php éœ€åŒ…å« Acme\Foo ç±»ã€‚<br>æ·»åŠ  <code>autoload</code> æŒ‡ä»¤ä¹‹åï¼Œä½ å¿…éœ€é‡æ–°è¿è¡Œ <code>composer dump-autoload</code>æ¥é‡æ–°ç”Ÿæˆ vendor/autoload.php æ–‡ä»¶ã€‚</p><h3 id="composer-å‘½ä»¤çš„ä½¿ç”¨"><a href="#composer-å‘½ä»¤çš„ä½¿ç”¨" class="headerlink" title="composer å‘½ä»¤çš„ä½¿ç”¨"></a><a href="https://learnku.com/docs/composer/2018/03-cli/2084">composer å‘½ä»¤çš„ä½¿ç”¨</a></h3><ul><li>æŸ¥çœ‹ composer å…¨å±€é…ç½®</li></ul><pre class="line-numbers language-none"><code class="language-none">composer config -l -g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆå§‹åŒ– composer.json</li></ul><pre class="line-numbers language-none"><code class="language-none"># åˆ›å»ºæ‰©å±•åŒ…æ—¶ï¼Œåˆå§‹åŒ– composer.jsoncomposer init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å®‰è£…æ‰€æœ‰æ‰©å±•åŒ…</li></ul><pre class="line-numbers language-none"><code class="language-none"># ä¼šè¯»å–å½“å‰ç›®å½•çš„ composer.json æ–‡ä»¶ï¼Œè§£å†³ä¾èµ–å…³ç³»ï¼Œå¹¶å°†ä»–ä»¬å®‰è£…åˆ° vendor æ–‡ä»¶å¤¹ä¸­composer install# åˆ¶å®š composer ç•¥è¿‡ require-dev é€‰é¡¹é‡Œçš„æ‰©å±•åŒ…ï¼ŒåªåŠ è½½éœ€è¦çš„æ‰©å±•åŒ…composer install --no-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£…æŒ‡å®šçš„æ‰©å±•åŒ…</li></ul><pre class="line-numbers language-none"><code class="language-none">composer require &lt;package-name&gt;# æ¯”å¦‚å®‰è£… vendor/package:2.* æ‰©å±•åŒ…composer require vendor/package:2.*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ›´æ–°æ‰©å±•åŒ…ï¼ˆæ›´æ–°å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼ŒåŒæ—¶ä¹Ÿä¼šæ›´æ–° composer.lock æ–‡ä»¶ï¼Œä¸è¦ä¹±ç”¨ composer update ï¼Œå¦‚æœéœ€è¦æ›´æ–°åŒ…ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ composer require å‘½ä»¤ï¼‰</li></ul><pre class="line-numbers language-none"><code class="language-none"># æ›´æ–°æ‰€æœ‰çš„ä¾èµ–åŒ…composer update# æ›´æ–°æŒ‡å®šçš„åŒ…composer update &lt;package-name&gt;# æ¯”å¦‚æ›´æ–° vendor/package åŒ…composer update vendor/package# ä¸€æ¬¡æ€§æ›´æ–°å¤šä¸ªåŒ…composer update example/example1 example/example2# æ›´æ–°æŒ‡å®šåŒ…åˆ°æŒ‡å®šç‰ˆæœ¬composer require example/example3:1.2.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç§»é™¤æ‰©å±•åŒ…</li></ul><pre class="line-numbers language-none"><code class="language-none">composer remove &lt;package-name&gt;# æ¯”å¦‚ç§»é™¤ vendor/package:2.*  æ‰©å±•åŒ…composer remove vendor/package:2.* <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æœç´¢æ‰©å±•åŒ…</li></ul><pre class="line-numbers language-none"><code class="language-none">composer search &lt;package-name&gt;# æ¯”å¦‚æœç´¢ monolog æ‰©å±•åŒ…composer search monolog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>åˆ—å‡ºæ‰€æœ‰çš„å¯ç”¨çš„åŒ…</li></ul><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹æ‰€æœ‰çš„åŒ…ä¿¡æ¯composer show# æŸ¥çœ‹åŒ…è¯¦ç»†ä¿¡æ¯composer show &lt;package-name&gt;# æ¯”å¦‚æŸ¥çœ‹ monolog/monolog åŒ…è¯¦ç»†ä¿¡æ¯composer show monolog/monolog 1.0.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>éªŒè¯ composer.json æ–‡ä»¶æ˜¯å¦åˆæ³•</li></ul><pre class="line-numbers language-none"><code class="language-none">composer validate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ›´æ–° composer</li></ul><pre class="line-numbers language-none"><code class="language-none"># æ›´æ–° composer åˆ°æœ€æ–°ç‰ˆæœ¬composer self-update# æ›´æ–° composer åˆ°æŒ‡å®šç‰ˆæœ¬composer self-update 1.0.0# å›æ»šåˆ°ä¸Šä¸€ä¸ªå®‰è£…ç‰ˆæœ¬composer self-update -r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Composer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git å¸¸ç”¨å‘½ä»¤</title>
      <link href="posts/5fddf106.html"/>
      <url>posts/5fddf106.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-å‘½ä»¤"><a href="#Git-å‘½ä»¤" class="headerlink" title="Git å‘½ä»¤"></a>Git å‘½ä»¤</h1><h2 id="ç”Ÿæˆ-SSH-Key"><a href="#ç”Ÿæˆ-SSH-Key" class="headerlink" title="ç”Ÿæˆ SSH Key"></a>ç”Ÿæˆ SSH Key</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">ssh-keygen -t rsa -C <span class="token string">"youremail@xxx.com"</span><span class="token comment"># è¾“å…¥ä¹‹åç›´æ¥ä¸¤æ¬¡å›è½¦å³å¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹-git-ç”¨æˆ·åå’Œé‚®ç®±åœ°å€"><a href="#æŸ¥çœ‹-git-ç”¨æˆ·åå’Œé‚®ç®±åœ°å€" class="headerlink" title="æŸ¥çœ‹ git ç”¨æˆ·åå’Œé‚®ç®±åœ°å€"></a>æŸ¥çœ‹ git ç”¨æˆ·åå’Œé‚®ç®±åœ°å€</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æŸ¥çœ‹ç”¨æˆ·å</span>git config user.name<span class="token comment"># æŸ¥çœ‹é‚®ç®±åœ°å€</span>git config user.email<span class="token comment"># æŸ¥çœ‹é…ç½®ä¿¡æ¯</span>git config --list<span class="token comment"># å½“å‰ç”¨æˆ·å…¨å±€</span>git config --global<span class="token comment"># å½“å‰ç³»ç»Ÿå…¨å±€</span>git config --system<span class="token comment"># ä¿®æ”¹ç”¨æˆ·å</span>git config --global user.name <span class="token string">"username"</span><span class="token comment"># ä¿®æ”¹é‚®ç®±åœ°å€</span>git config --global user.email <span class="token string">"email"</span><span class="token comment"># é‡æ–°è¾“å…¥è´¦å·å¯†ç </span>git config --system --unset credential.helper<span class="token comment"># æŸ¥çœ‹ git é…ç½®ä¿¡æ¯</span>git config --list æˆ–è€… git config -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆå§‹åŒ–ä¸€ä¸ª-git-ä»“åº“"><a href="#åˆå§‹åŒ–ä¸€ä¸ª-git-ä»“åº“" class="headerlink" title="åˆå§‹åŒ–ä¸€ä¸ª git ä»“åº“"></a>åˆå§‹åŒ–ä¸€ä¸ª git ä»“åº“</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ·»åŠ æ–‡ä»¶åˆ°-git-ä»“åº“"><a href="#æ·»åŠ æ–‡ä»¶åˆ°-git-ä»“åº“" class="headerlink" title="æ·»åŠ æ–‡ä»¶åˆ° git ä»“åº“"></a>æ·»åŠ æ–‡ä»¶åˆ° git ä»“åº“</h2><h3 id="1-æ·»åŠ æ–‡ä»¶åˆ°ç¼“å­˜åŒº"><a href="#1-æ·»åŠ æ–‡ä»¶åˆ°ç¼“å­˜åŒº" class="headerlink" title="1. æ·»åŠ æ–‡ä»¶åˆ°ç¼“å­˜åŒº"></a>1. æ·»åŠ æ–‡ä»¶åˆ°ç¼“å­˜åŒº</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git add &lt;filename&gt;<span class="token comment"># æ¯”å¦‚æ·»åŠ  file.txt æ–‡ä»¶ï¼š git add file.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-å°†ç¼“å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“"><a href="#2-å°†ç¼“å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“" class="headerlink" title="2. å°†ç¼“å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“"></a>2. å°†ç¼“å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git commit -m <span class="token string">"add_file_message"</span><span class="token comment"># æ¯”å¦‚æäº¤ file.txt æ–‡ä»¶ï¼šgit commit -m "add file.txt"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹ä¿®æ”¹å†…å®¹å¯¹æ¯”ï¼Œæäº¤åˆ°ç¼“å­˜åŒºæˆ–è€…å·²ç»æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œä½¿ç”¨-git-diff-ä¼šæ²¡æœ‰å†…å®¹æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ä¿®æ”¹äº†ï¼Œåœ¨æäº¤åˆ°ç¼“å­˜åŒºä¹‹å‰ä½¿ç”¨-git-diff-æ‰æœ‰ç”¨-ï¼ˆæŸ¥çœ‹å·¥ä½œåŒºçš„æ”¹å˜ï¼‰"><a href="#æŸ¥çœ‹ä¿®æ”¹å†…å®¹å¯¹æ¯”ï¼Œæäº¤åˆ°ç¼“å­˜åŒºæˆ–è€…å·²ç»æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œä½¿ç”¨-git-diff-ä¼šæ²¡æœ‰å†…å®¹æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ä¿®æ”¹äº†ï¼Œåœ¨æäº¤åˆ°ç¼“å­˜åŒºä¹‹å‰ä½¿ç”¨-git-diff-æ‰æœ‰ç”¨-ï¼ˆæŸ¥çœ‹å·¥ä½œåŒºçš„æ”¹å˜ï¼‰" class="headerlink" title="æŸ¥çœ‹ä¿®æ”¹å†…å®¹å¯¹æ¯”ï¼Œæäº¤åˆ°ç¼“å­˜åŒºæˆ–è€…å·²ç»æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œä½¿ç”¨ git diff ä¼šæ²¡æœ‰å†…å®¹æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ä¿®æ”¹äº†ï¼Œåœ¨æäº¤åˆ°ç¼“å­˜åŒºä¹‹å‰ä½¿ç”¨ git diff æ‰æœ‰ç”¨ ï¼ˆæŸ¥çœ‹å·¥ä½œåŒºçš„æ”¹å˜ï¼‰"></a>æŸ¥çœ‹ä¿®æ”¹å†…å®¹å¯¹æ¯”ï¼Œæäº¤åˆ°ç¼“å­˜åŒºæˆ–è€…å·²ç»æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œä½¿ç”¨ git diff ä¼šæ²¡æœ‰å†…å®¹æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ä¿®æ”¹äº†ï¼Œåœ¨æäº¤åˆ°ç¼“å­˜åŒºä¹‹å‰ä½¿ç”¨ git diff æ‰æœ‰ç”¨ ï¼ˆæŸ¥çœ‹å·¥ä½œåŒºçš„æ”¹å˜ï¼‰</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git diff<span class="token comment"># è¿˜å¯ä»¥æŸ¥çœ‹å…·ä½“å“ªä¸ªæ–‡ä»¶åšäº†ä»€ä¹ˆä¿®æ”¹</span><span class="token comment"># æ¯”å¦‚æŸ¥çœ‹ readme.txt åšäº†ä»€ä¹ˆä¿®æ”¹</span>git diff HEAD -- readme.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹å½“å‰ä»“åº“çŠ¶æ€ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨"><a href="#æŸ¥çœ‹å½“å‰ä»“åº“çŠ¶æ€ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨" class="headerlink" title="æŸ¥çœ‹å½“å‰ä»“åº“çŠ¶æ€ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨"></a>æŸ¥çœ‹å½“å‰ä»“åº“çŠ¶æ€ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æŸ¥çœ‹æäº¤æ—¥å¿—"><a href="#æŸ¥çœ‹æäº¤æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æäº¤æ—¥å¿—"></a>æŸ¥çœ‹æäº¤æ—¥å¿—</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æŸ¥çœ‹å…¨éƒ¨ </span>git log<span class="token comment"># æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤</span>git show<span class="token comment"># æŸ¥çœ‹å€’æ•°5æ¡</span>git log -5<span class="token comment"># ç®€åŒ–æ—¥å¿—æ˜¾ç¤ºæ–¹å¼ï¼Œå¹¶å«æœ‰æäº¤ç‰ˆæœ¬å·</span>git log --pretty=oneline<span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token comment"># $ git log --pretty=oneline</span><span class="token comment"># 44c9beb4c58543b89181829755be2c5e9781ba28 (HEAD -&gt; master) append GPL</span><span class="token comment"># 03112bdf101655c30df9b61e4bd325b2cbe3c090 add distributed</span><span class="token comment"># 8a1386bd0fe677bca99d5a4ef26e87772a3eca71 wrote a readme file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è®¾ç½®åˆ«å-Alias"><a href="#è®¾ç½®åˆ«å-Alias" class="headerlink" title="è®¾ç½®åˆ«å Alias"></a>è®¾ç½®åˆ«å Alias</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># åˆ›å»º/æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</span>git config --global alias.br <span class="token string">"branch"</span><span class="token comment"># åˆ‡æ¢åˆ†æ”¯</span>git config --global alias.co <span class="token string">"checkout"</span><span class="token comment"># åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯</span>git config --global alias.cb <span class="token string">"checkout -b"</span><span class="token comment"># æäº¤</span>git config --global alias.cm <span class="token string">"commit -m"</span><span class="token comment"># æŸ¥çœ‹çŠ¶æ€</span>git config --global alias.st <span class="token string">"status"</span><span class="token comment"># æ‹‰å–åˆ†æ”¯</span>git config --global alias.pullm <span class="token string">"pull origin master"</span><span class="token comment"># æäº¤åˆ†æ”¯</span>git config --global alias.pushm <span class="token string">"push origin master"</span><span class="token comment"># å•è¡Œã€åˆ†é¢œè‰²æ˜¾ç¤ºè®°å½•</span>git config --global alias.log <span class="token string">"log --oneline --graph --decorate --color=always"</span><span class="token comment"># å¤æ‚æ˜¾ç¤º</span>git config --global alias.logg <span class="token string">"log --graph --all --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(bold white)â€” %an%C(reset)%C(bold yellow)%d%C(reset)' --abbrev-commit --date=relative"</span>git config --global alias.lg <span class="token string">"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å›é€€ç‰ˆæœ¬"><a href="#å›é€€ç‰ˆæœ¬" class="headerlink" title="å›é€€ç‰ˆæœ¬"></a>å›é€€ç‰ˆæœ¬</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># å›é€€å½“å‰ç‰ˆæœ¬çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬</span>git reset --hard HEAD^<span class="token comment"># å›é€€å½“å‰ç‰ˆæœ¬çš„ä¸Šä¸‰ä¸ªç‰ˆæœ¬</span>git reset --hard HEAD^^^<span class="token comment"># å›é€€å½“å‰ç‰ˆæœ¬çš„ä¸Š 100 ä¸ªç‰ˆæœ¬</span>git reset --hard HEAD~100<span class="token comment"># å›é€€æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶å°† ã€Œå›é€€ã€åŠ¨ä½œä½œä¸ºä¸€ä¸ªç‰ˆæœ¬æäº¤</span>git revert &lt;commit id&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å›é€€æŒ‡å®šç‰ˆæœ¬ï¼ˆå¤šåŠæ˜¯å› ä¸ºå›é€€ç‰ˆæœ¬å›é€€å¤šäº†ï¼‰"><a href="#å›é€€æŒ‡å®šç‰ˆæœ¬ï¼ˆå¤šåŠæ˜¯å› ä¸ºå›é€€ç‰ˆæœ¬å›é€€å¤šäº†ï¼‰" class="headerlink" title="å›é€€æŒ‡å®šç‰ˆæœ¬ï¼ˆå¤šåŠæ˜¯å› ä¸ºå›é€€ç‰ˆæœ¬å›é€€å¤šäº†ï¼‰"></a>å›é€€æŒ‡å®šç‰ˆæœ¬ï¼ˆå¤šåŠæ˜¯å› ä¸ºå›é€€ç‰ˆæœ¬å›é€€å¤šäº†ï¼‰</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git reset --hard ç‰ˆæœ¬å·å‰å‡ ä½<span class="token comment"># æ¯”å¦‚å›é€€åˆ° ä»¥ä¸ŠæŸ¥çœ‹æ—¥å¿—ä¸­çš„ add distributed è¿™ä¸ªæäº¤ç‰ˆæœ¬</span>git reset --hard 44c9beb4c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹æäº¤ç‰ˆæœ¬å·-commit-id"><a href="#æŸ¥çœ‹æäº¤ç‰ˆæœ¬å·-commit-id" class="headerlink" title="æŸ¥çœ‹æäº¤ç‰ˆæœ¬å· commit id"></a>æŸ¥çœ‹æäº¤ç‰ˆæœ¬å· commit id</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># è¦é‡è¿”æœªæ¥ï¼Œç”¨ `git reflog` æŸ¥çœ‹å‘½ä»¤å†å²ï¼Œä»¥ä¾¿ç¡®å®šè¦å›åˆ°æœªæ¥çš„å“ªä¸ªç‰ˆæœ¬ã€‚</span>git reflog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="æ’¤é”€ä¿®æ”¹"><a href="#æ’¤é”€ä¿®æ”¹" class="headerlink" title="æ’¤é”€ä¿®æ”¹"></a>æ’¤é”€ä¿®æ”¹</h2><h3 id="1-ä¿®æ”¹åªåœ¨å·¥ä½œåŒºï¼Œè¿˜æ²¡æœ‰æ·»åŠ åˆ°ç¼“å­˜åŒº-ï¼ˆè¿˜æ²¡æœ‰-git-addï¼‰"><a href="#1-ä¿®æ”¹åªåœ¨å·¥ä½œåŒºï¼Œè¿˜æ²¡æœ‰æ·»åŠ åˆ°ç¼“å­˜åŒº-ï¼ˆè¿˜æ²¡æœ‰-git-addï¼‰" class="headerlink" title="1. ä¿®æ”¹åªåœ¨å·¥ä½œåŒºï¼Œè¿˜æ²¡æœ‰æ·»åŠ åˆ°ç¼“å­˜åŒº ï¼ˆè¿˜æ²¡æœ‰ git addï¼‰"></a>1. ä¿®æ”¹åªåœ¨å·¥ä½œåŒºï¼Œè¿˜æ²¡æœ‰æ·»åŠ åˆ°ç¼“å­˜åŒº ï¼ˆè¿˜æ²¡æœ‰ git addï¼‰</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout -- filename<span class="token comment"># æ¯”å¦‚ readme.txt æ–‡ä»¶åªæ˜¯åœ¨å·¥ä½œåŒºä¿®æ”¹äº†ï¼Œæƒ³å›é€€åˆ°ä¿®æ”¹ä¹‹å‰çš„æäº¤çš„ç‰ˆæœ¬</span>git checkout -- readme.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-ä¿®æ”¹ä»å·¥ä½œåŒºå·²ç»æäº¤åˆ°äº†ç¼“å­˜åŒº-ï¼ˆå·²ç»-git-addï¼‰"><a href="#2-ä¿®æ”¹ä»å·¥ä½œåŒºå·²ç»æäº¤åˆ°äº†ç¼“å­˜åŒº-ï¼ˆå·²ç»-git-addï¼‰" class="headerlink" title="2. ä¿®æ”¹ä»å·¥ä½œåŒºå·²ç»æäº¤åˆ°äº†ç¼“å­˜åŒº ï¼ˆå·²ç» git addï¼‰"></a>2. ä¿®æ”¹ä»å·¥ä½œåŒºå·²ç»æäº¤åˆ°äº†ç¼“å­˜åŒº ï¼ˆå·²ç» git addï¼‰</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># å°†ç¼“å­˜åŒºçš„ä¿®æ”¹å›é€€åˆ°å·¥ä½œåŒº</span>git reset HEAD filename<span class="token comment"># æ¯”å¦‚ readme.txt æ–‡ä»¶çš„ä¿®æ”¹å·²ç»æäº¤åˆ°ç¼“å­˜åŒºäº†ï¼Œä½†æ˜¯æƒ³æ’¤é”€ä¿®æ”¹åˆ†ä¸ºä¸¤æ­¥</span><span class="token comment"># 01.å°†ç¼“å­˜åŒºçš„ä¿®æ”¹å›é€€åˆ°å·¥ä½œåŒº</span>git reset HEAD readme.txt<span class="token comment"># 02.å°†åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹å›é€€åˆ°å’Œä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸€æ ·</span>git checkout -- readme.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-ä¿®æ”¹å·²ç»ä»ç¼“å­˜åŒºæäº¤åˆ°äº†æœ¬åœ°ä»“åº“-ï¼ˆå·²ç»-git-commitï¼‰"><a href="#3-ä¿®æ”¹å·²ç»ä»ç¼“å­˜åŒºæäº¤åˆ°äº†æœ¬åœ°ä»“åº“-ï¼ˆå·²ç»-git-commitï¼‰" class="headerlink" title="3. ä¿®æ”¹å·²ç»ä»ç¼“å­˜åŒºæäº¤åˆ°äº†æœ¬åœ°ä»“åº“ ï¼ˆå·²ç» git commitï¼‰"></a>3. ä¿®æ”¹å·²ç»ä»ç¼“å­˜åŒºæäº¤åˆ°äº†æœ¬åœ°ä»“åº“ ï¼ˆå·²ç» git commitï¼‰</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># å›é€€å½“å‰ç‰ˆæœ¬çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬</span>git reset --hard HEAD^<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4-å°†åœ¨æš‚å­˜åŒºçš„æ›´æ”¹æ–‡ä»¶è¿›è¡Œå¼ºåˆ¶æ’¤é”€ã€‚ï¼ˆæƒ³è®©ä¹‹å‰å·²ç»æäº¤åˆ°ç¼“å­˜åŒºçš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºçš„æ–‡ä»¶ï¼‰"><a href="#4-å°†åœ¨æš‚å­˜åŒºçš„æ›´æ”¹æ–‡ä»¶è¿›è¡Œå¼ºåˆ¶æ’¤é”€ã€‚ï¼ˆæƒ³è®©ä¹‹å‰å·²ç»æäº¤åˆ°ç¼“å­˜åŒºçš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºçš„æ–‡ä»¶ï¼‰" class="headerlink" title="4. å°†åœ¨æš‚å­˜åŒºçš„æ›´æ”¹æ–‡ä»¶è¿›è¡Œå¼ºåˆ¶æ’¤é”€ã€‚ï¼ˆæƒ³è®©ä¹‹å‰å·²ç»æäº¤åˆ°ç¼“å­˜åŒºçš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºçš„æ–‡ä»¶ï¼‰"></a>4. å°†åœ¨æš‚å­˜åŒºçš„æ›´æ”¹æ–‡ä»¶è¿›è¡Œå¼ºåˆ¶æ’¤é”€ã€‚ï¼ˆæƒ³è®©ä¹‹å‰å·²ç»æäº¤åˆ°ç¼“å­˜åŒºçš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºçš„æ–‡ä»¶ï¼‰</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout -f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-å‘½ä»¤-git-clean-ä½œç”¨æ˜¯æ¸…ç†é¡¹ç›®ï¼Œ-f-æ˜¯å¼ºåˆ¶æ¸…ç†æ–‡ä»¶çš„è®¾ç½®ï¼Œ-d-é€‰é¡¹å‘½ä»¤è¿æ–‡ä»¶å¤¹ä¸€å¹¶æ¸…é™¤"><a href="#5-å‘½ä»¤-git-clean-ä½œç”¨æ˜¯æ¸…ç†é¡¹ç›®ï¼Œ-f-æ˜¯å¼ºåˆ¶æ¸…ç†æ–‡ä»¶çš„è®¾ç½®ï¼Œ-d-é€‰é¡¹å‘½ä»¤è¿æ–‡ä»¶å¤¹ä¸€å¹¶æ¸…é™¤" class="headerlink" title="5. å‘½ä»¤ git clean ä½œç”¨æ˜¯æ¸…ç†é¡¹ç›®ï¼Œ-f æ˜¯å¼ºåˆ¶æ¸…ç†æ–‡ä»¶çš„è®¾ç½®ï¼Œ-d é€‰é¡¹å‘½ä»¤è¿æ–‡ä»¶å¤¹ä¸€å¹¶æ¸…é™¤"></a>5. å‘½ä»¤ git clean ä½œç”¨æ˜¯æ¸…ç†é¡¹ç›®ï¼Œ-f æ˜¯å¼ºåˆ¶æ¸…ç†æ–‡ä»¶çš„è®¾ç½®ï¼Œ-d é€‰é¡¹å‘½ä»¤è¿æ–‡ä»¶å¤¹ä¸€å¹¶æ¸…é™¤</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git clean -f -d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="6-å‡å¦‚ä½ æƒ³è¦ä¸¢å¼ƒä½ æ‰€æœ‰çš„æœ¬åœ°æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘åˆ°å®ƒï¼š"><a href="#6-å‡å¦‚ä½ æƒ³è¦ä¸¢å¼ƒä½ æ‰€æœ‰çš„æœ¬åœ°æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘åˆ°å®ƒï¼š" class="headerlink" title="6. å‡å¦‚ä½ æƒ³è¦ä¸¢å¼ƒä½ æ‰€æœ‰çš„æœ¬åœ°æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘åˆ°å®ƒï¼š"></a>6. å‡å¦‚ä½ æƒ³è¦ä¸¢å¼ƒä½ æ‰€æœ‰çš„æœ¬åœ°æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘åˆ°å®ƒï¼š</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git fetch origin git reset --hard origin/master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h2><h3 id="1-ç¡®å®è¦åˆ é™¤è¯¥æ–‡ä»¶"><a href="#1-ç¡®å®è¦åˆ é™¤è¯¥æ–‡ä»¶" class="headerlink" title="1. ç¡®å®è¦åˆ é™¤è¯¥æ–‡ä»¶"></a>1. ç¡®å®è¦åˆ é™¤è¯¥æ–‡ä»¶</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æ¯”å¦‚ä»¥ test.txt ä¸ºä¾‹å­</span><span class="token comment"># 01 æœ¬åœ°æ‰‹åŠ¨åˆ é™¤ test.txt æ–‡ä»¶</span>rm test.txt æˆ–è€… rm -rf test.txt<span class="token comment"># 02 æ·»åŠ è¢«åˆ é™¤çš„çŠ¶æ€ç¼“å­˜åŒº</span>git rm test.txt æˆ–è€… git add test.txt<span class="token comment"># 03 æäº¤çŠ¶æ€åˆ°æœ¬åœ°ä»“åº“</span>git commit -m <span class="token string">"remove test.txt"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-å·¥ä½œåŒºè¯¯åˆ äº†æ–‡ä»¶"><a href="#2-å·¥ä½œåŒºè¯¯åˆ äº†æ–‡ä»¶" class="headerlink" title="2. å·¥ä½œåŒºè¯¯åˆ äº†æ–‡ä»¶"></a>2. å·¥ä½œåŒºè¯¯åˆ äº†æ–‡ä»¶</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># 01 å·¥ä½œåŒºè¯¯åˆ äº† test.txt æ–‡ä»¶</span>rm test.txt<span class="token comment"># 02 æ‰¾å›è¢«è¯¯åˆ çš„æ–‡ä»¶ï¼ˆæ’¤é”€ä¿®æ”¹ï¼‰</span>git checkout -- test.txt<span class="token comment"># ç”¨ç‰ˆæœ¬åº“ä¸­çš„ç‰ˆæœ¬æ›¿æ¢æ‰å·¥ä½œåŒºçš„ç‰ˆæœ¬</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯"><a href="#åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯" class="headerlink" title="åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯"></a>åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout -b alex  æˆ–è€… git switch -c alex<span class="token comment"># åˆ›å»º alex åˆ†æ”¯å¹¶åˆ‡æ¢åˆ° alex åˆ†æ”¯</span><span class="token comment"># ç­‰åŒäºä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤</span><span class="token comment"># åˆ›å»º alex åˆ†æ”¯</span>git branch alex<span class="token comment"># åˆ‡æ¢åˆ° alex åˆ†æ”¯</span>git checkout alex  æˆ–è€… git switch alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯"><a href="#åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯" class="headerlink" title="åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯"></a>åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æ¯”å¦‚å½“å‰ä½äº master åˆ†æ”¯ï¼Œæ¬²å°† alex åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯</span>git merge alex<span class="token comment"># å¦‚æœæœ‰å†²çªï¼Œè§£å†³æ­¥éª¤å¦‚ä¸‹ï¼š</span><span class="token comment"># 01 å…ˆæŸ¥çœ‹å†²çªæ–‡ä»¶</span>git status<span class="token comment"># 02 æ‰‹åŠ¨è§£å†³å†²çªæ–‡ä»¶</span><span class="token comment"># 03 å†æ¬¡åˆå¹¶åˆ†æ”¯</span>git merge alex<span class="token comment"># 04 æ·»åŠ ä¿®æ”¹åˆ°ç¼“å­˜åŒº</span>git add .<span class="token comment"># 05 æäº¤åˆ°æœ¬åœ°ä»“åº“</span>git commit -m <span class="token string">"merge fixed"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹åˆ†æ”¯çš„åˆå¹¶æƒ…å†µ"><a href="#æŸ¥çœ‹åˆ†æ”¯çš„åˆå¹¶æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯çš„åˆå¹¶æƒ…å†µ"></a>æŸ¥çœ‹åˆ†æ”¯çš„åˆå¹¶æƒ…å†µ</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git log --graph --pretty=oneline --abbrev-commitæˆ–è€…ç›´æ¥ä½¿ç”¨ git log --graph å‘½ä»¤å¯ä»¥çœ‹åˆ°åˆ†æ”¯åˆå¹¶å›¾ã€‚<span class="token comment"># è®¾ç½®åˆ«åæŸ¥çœ‹æ‰€æœ‰çš„æäº¤è®°å½•</span>git config --global alias.lg <span class="token string">"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ é™¤åˆ†æ”¯"><a href="#åˆ é™¤åˆ†æ”¯" class="headerlink" title="åˆ é™¤åˆ†æ”¯"></a>åˆ é™¤åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># åˆå¹¶ä»£ç ä¹‹ååˆ é™¤åˆ†æ”¯ </span>git branch -d åˆ†æ”¯å<span class="token comment"># æ²¡æœ‰åˆå¹¶ä»£ç åˆ é™¤åˆ†æ”¯ </span>git branch -D åˆ†æ”¯å<span class="token comment"># åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼ˆæœ¬åœ°åˆ†æ”¯éœ€è¦å†æ¬¡æ‰‹åŠ¨åˆ é™¤ï¼‰</span>git push origin -d åˆ†æ”¯å<span class="token comment"># æ¯”å¦‚åˆ é™¤ alex åˆ†æ”¯</span>git branch -d alex<span class="token comment"># åˆ é™¤è¿œç¨‹ alex åˆ†æ”¯</span>git push origin -d alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹åˆ†æ”¯"><a href="#æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯"></a>æŸ¥çœ‹åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># åªæŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</span>git branch -r<span class="token comment"># åªæŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</span>git branch<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯</span>git branch -a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‹‰å–è¿œç¨‹åˆ†æ”¯å¹¶åˆ›å»ºåŒåæœ¬åœ°åˆ†æ”¯"><a href="#æ‹‰å–è¿œç¨‹åˆ†æ”¯å¹¶åˆ›å»ºåŒåæœ¬åœ°åˆ†æ”¯" class="headerlink" title="æ‹‰å–è¿œç¨‹åˆ†æ”¯å¹¶åˆ›å»ºåŒåæœ¬åœ°åˆ†æ”¯"></a>æ‹‰å–è¿œç¨‹åˆ†æ”¯å¹¶åˆ›å»ºåŒåæœ¬åœ°åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æ–¹æ³•ä¸€ï¼ˆæ­¤æ–¹æ³•å»ºç«‹çš„æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ä¼šæœ‰æ˜ å°„å…³ç³»ï¼‰</span>git checkout -b [æœ¬åœ°åˆ†æ”¯å] origin/[è¿œç¨‹åˆ†æ”¯å]ä¸¾ä¾‹ï¼šgit checkout -b alex origin/alex<span class="token comment"># æ–¹æ³•äºŒï¼ˆæ­¤æ–¹æ³•å»ºç«‹çš„æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯æ²¡æœ‰æ˜ å°„å…³ç³»ï¼‰</span>git fetch origin [è¿œç¨‹åˆ†æ”¯å]:[æœ¬åœ°åˆ†æ”¯å]ä¸¾ä¾‹ï¼šgit fetch origin alex:alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»ï¼ˆè¿œç¨‹æœ‰çš„åˆ†æ”¯è€Œæœ¬åœ°æ²¡æœ‰çš„åˆ†æ”¯ä¸ä¼šå‡ºç°ï¼‰"><a href="#æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»ï¼ˆè¿œç¨‹æœ‰çš„åˆ†æ”¯è€Œæœ¬åœ°æ²¡æœ‰çš„åˆ†æ”¯ä¸ä¼šå‡ºç°ï¼‰" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»ï¼ˆè¿œç¨‹æœ‰çš„åˆ†æ”¯è€Œæœ¬åœ°æ²¡æœ‰çš„åˆ†æ”¯ä¸ä¼šå‡ºç°ï¼‰"></a>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»ï¼ˆè¿œç¨‹æœ‰çš„åˆ†æ”¯è€Œæœ¬åœ°æ²¡æœ‰çš„åˆ†æ”¯ä¸ä¼šå‡ºç°ï¼‰</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git branch -vv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ‰‹åŠ¨å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»"><a href="#æ‰‹åŠ¨å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»" class="headerlink" title="æ‰‹åŠ¨å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»"></a>æ‰‹åŠ¨å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git branch -u origin/[åˆ†æ”¯å]æˆ–è€…git branch --set-upstream-to origin/[åˆ†æ”¯å]æˆ–è€…git branch --set-upstream-to=origin/[è¿œç¨‹åˆ†æ”¯å] [æœ¬åœ°åˆ†æ”¯å]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¨é€åˆ†æ”¯"><a href="#æ¨é€åˆ†æ”¯" class="headerlink" title="æ¨é€åˆ†æ”¯"></a>æ¨é€åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git push -u origin &lt;branch name&gt; <span class="token comment"># ç¬¬ä¸€æ¬¡æ¨é€çš„æ—¶å€™æ·»åŠ  -u å‚æ•°ï¼Œç»™æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯åˆ›å»ºè¿æ¥å…³ç³»ï¼Œå½“ç¬¬äºŒæ¬¡å†æ¬¡æ¨é€æ—¶ï¼Œåˆ™ä¸éœ€è¦æ·»åŠ  -u å‚æ•°</span><span class="token comment"># æ¯”å¦‚ï¼šæ¨é€ dev åˆ†æ”¯</span>git push origin dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯"><a href="#æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯"></a>æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git remote<span class="token comment"># æŸ¥çœ‹è¿œç¨‹åº“æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯</span><span class="token comment"># è¿™é‡Œå¯ä»¥çœ‹åˆ°æŠ“å–å’Œæ¨é€çš„ origin çš„åœ°å€</span>git remote -v ï¼ˆå°å†™çš„vï¼‰<span class="token comment"># åˆ é™¤è¿œç¨‹åº“è¿æ¥</span>git remote rm &lt;origin name&gt;<span class="token comment"># egï¼šåˆ é™¤è¿œç¨‹ origin è¿æ¥</span>git remote rm origin<span class="token comment"># æ·»åŠ è¿œç¨‹åº“è¿æ¥</span>git remote add &lt;origin name&gt; &lt;ssh or http&gt;<span class="token comment"># eg: å…³è”æœ¬äºº GitHub è¿æ¥ï¼Œå¹¶è¿æ¥åä¸º myGitHub</span>git remote add myGitHub git@github.com:Alex66668888/demo.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šå¤„å¤‡ä»½"><a href="#å¤šå¤„å¤‡ä»½" class="headerlink" title="å¤šå¤„å¤‡ä»½"></a>å¤šå¤„å¤‡ä»½</h2><h3 id="ä¸€ä¸ª-pull-å¤šä¸ª-push"><a href="#ä¸€ä¸ª-pull-å¤šä¸ª-push" class="headerlink" title="ä¸€ä¸ª pull + å¤šä¸ª push"></a>ä¸€ä¸ª pull + å¤šä¸ª push</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æ·»åŠ è¿œç¨‹è¿æ¥</span><span class="token command">$ git remote add origin git@gitee.com:pudongping/tt.git</span><span class="token comment"># æŸ¥çœ‹è¿œç¨‹è¿æ¥åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ª fetch åœ°å€å’Œä¸€ä¸ª push åœ°å€</span><span class="token command">$ git remote<span class="token parameter"> -v</span></span>origin  git@gitee.com:pudongping/tt.git (fetch)origin  git@gitee.com:pudongping/tt.git (push)<span class="token comment"># æ·»åŠ  github æ¨é€åœ°å€</span><span class="token command">$ git remote set-url<span class="token parameter"> --add</span> origin git@github.com:pudongping/tt.git</span><span class="token comment"># æŸ¥çœ‹è¿œç¨‹è¿æ¥åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ª fetch åœ°å€å’Œä¸¤ä¸ª push åœ°å€</span><span class="token command">$ git remote<span class="token parameter"> -v</span></span>origin  git@gitee.com:pudongping/tt.git (fetch)origin  git@gitee.com:pudongping/tt.git (push)origin  git@github.com:pudongping/tt.git (push)<span class="token comment"># æ·»åŠ  gitlab æ¨é€åœ°å€</span><span class="token command">$ git remote set-url<span class="token parameter"> --add</span> origin git@gitlab.com:pudongping/t1.git</span><span class="token comment"># æŸ¥çœ‹è¿œç¨‹è¿æ¥åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ª fetch åœ°å€å’Œä¸‰ä¸ª push åœ°å€</span><span class="token command">$ git remote<span class="token parameter"> -v</span></span>origin  git@gitee.com:pudongping/tt.git (fetch)origin  git@gitee.com:pudongping/tt.git (push)origin  git@github.com:pudongping/t1.git (push)origin  git@gitlab.com:pudongping/tt.git (push)<span class="token comment"># æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œå°±å¯ä»¥çœ‹åˆ°å·²ç»åŒæ­¥åˆ°å¤šä¸ªå¹³å°ä¸Šå»äº†ï¼Œä¸€æ¬¡ push åˆ°å¤šä¸ªè¿œç¨‹ä»“åº“</span>git push<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="git-add-ä¸‰ç§çŠ¶æ€å‘½ä»¤æ¯”è¾ƒ"><a href="#git-add-ä¸‰ç§çŠ¶æ€å‘½ä»¤æ¯”è¾ƒ" class="headerlink" title="git add ä¸‰ç§çŠ¶æ€å‘½ä»¤æ¯”è¾ƒ"></a>git add ä¸‰ç§çŠ¶æ€å‘½ä»¤æ¯”è¾ƒ</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>git add .</td><td>æäº¤æ‰€æœ‰ä¿®æ”¹çš„å’Œæ–°å»ºçš„æ•°æ®æš‚å­˜åŒº (æäº¤å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰ä¿®æ”¹)</td></tr><tr><td>git add -u</td><td>æäº¤æ‰€æœ‰è¢«åˆ é™¤å’Œä¿®æ”¹çš„æ–‡ä»¶åˆ°æ•°æ®æš‚å­˜åŒºï¼ˆç­‰åŒäºgit add -updateï¼‰</td></tr><tr><td>git add -A</td><td>æäº¤æ‰€æœ‰è¢«åˆ é™¤ã€è¢«æ›¿æ¢ã€è¢«ä¿®æ”¹å’Œæ–°å¢çš„æ–‡ä»¶åˆ°æ•°æ®æš‚å­˜åŒºï¼ˆç­‰åŒäºgit add â€“allï¼‰</td></tr></tbody></table><h2 id="å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³ä»-git-è¿œç¨‹åº“ä¸­åˆ é™¤ï¼Œå¹¶åœ¨ä»¥åçš„æäº¤ä¸­å¿½ç•¥ï¼Œä½†æ˜¯å´è¿˜æƒ³åœ¨æœ¬åœ°ä¿ç•™è¿™ä¸ªæ–‡ä»¶"><a href="#å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³ä»-git-è¿œç¨‹åº“ä¸­åˆ é™¤ï¼Œå¹¶åœ¨ä»¥åçš„æäº¤ä¸­å¿½ç•¥ï¼Œä½†æ˜¯å´è¿˜æƒ³åœ¨æœ¬åœ°ä¿ç•™è¿™ä¸ªæ–‡ä»¶" class="headerlink" title="å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³ä» git è¿œç¨‹åº“ä¸­åˆ é™¤ï¼Œå¹¶åœ¨ä»¥åçš„æäº¤ä¸­å¿½ç•¥ï¼Œä½†æ˜¯å´è¿˜æƒ³åœ¨æœ¬åœ°ä¿ç•™è¿™ä¸ªæ–‡ä»¶"></a>å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³ä» git è¿œç¨‹åº“ä¸­åˆ é™¤ï¼Œå¹¶åœ¨ä»¥åçš„æäº¤ä¸­å¿½ç•¥ï¼Œä½†æ˜¯å´è¿˜æƒ³åœ¨æœ¬åœ°ä¿ç•™è¿™ä¸ªæ–‡ä»¶</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git">git rm --cached [file-path]git rm --cached config/pay.php<span class="token comment"># å¦‚æœæ˜¯ç›®å½•çš„è¯ï¼Œåˆ™éœ€è¦</span>git rm -r --cached [dir_name]git push<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³åœ¨ä»¥åçš„æäº¤æ—¶å¿½ç•¥æ­¤æ–‡ä»¶ï¼Œå³ä½¿æœ¬åœ°å·²ç»ä¿®æ”¹è¿‡ï¼Œè€Œä¸”ä¸åˆ é™¤-git-è¿œç¨‹åº“ä¸­ç›¸åº”çš„æ–‡ä»¶"><a href="#å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³åœ¨ä»¥åçš„æäº¤æ—¶å¿½ç•¥æ­¤æ–‡ä»¶ï¼Œå³ä½¿æœ¬åœ°å·²ç»ä¿®æ”¹è¿‡ï¼Œè€Œä¸”ä¸åˆ é™¤-git-è¿œç¨‹åº“ä¸­ç›¸åº”çš„æ–‡ä»¶" class="headerlink" title="å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³åœ¨ä»¥åçš„æäº¤æ—¶å¿½ç•¥æ­¤æ–‡ä»¶ï¼Œå³ä½¿æœ¬åœ°å·²ç»ä¿®æ”¹è¿‡ï¼Œè€Œä¸”ä¸åˆ é™¤ git è¿œç¨‹åº“ä¸­ç›¸åº”çš„æ–‡ä»¶"></a>å·²ç»æ¨é€ï¼ˆpushï¼‰è¿‡çš„æ–‡ä»¶ï¼Œæƒ³åœ¨ä»¥åçš„æäº¤æ—¶å¿½ç•¥æ­¤æ–‡ä»¶ï¼Œå³ä½¿æœ¬åœ°å·²ç»ä¿®æ”¹è¿‡ï¼Œè€Œä¸”ä¸åˆ é™¤ git è¿œç¨‹åº“ä¸­ç›¸åº”çš„æ–‡ä»¶</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># åªå¯¹æ–‡ä»¶æœ‰æ•ˆ</span>git update-index --assume-unchanged [file-path]git update-index --assume-unchanged config/pay.php<span class="token comment"># å¦‚æœéœ€è¦æ¢å¤æäº¤</span>git update-index --no-assume-unchanged [file-path]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆå¹¶ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯"><a href="#åˆå¹¶ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯" class="headerlink" title="åˆå¹¶ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯"></a>åˆå¹¶ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯</h2><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æ¯”å¦‚è¯´ test1 åˆ†æ”¯ä¸Šæœ‰ä¸€ä¸ªæäº¤ 512d725 ç°åœ¨æƒ³å°†è¿™ä¸ªæäº¤åˆå¹¶åˆ° test2 åˆ†æ”¯ä¸Š</span><span class="token comment"># å…ˆåˆ‡æ¢åˆ° test2 åˆ†æ”¯ä¸Š</span>git checkout test2<span class="token comment"># æ‹©ä¼˜æŒ‘é€‰ï¼ˆæ­¤æ—¶è¿˜æ˜¯åœ¨ test2 åˆ†æ”¯ä¸Šï¼‰</span>git cherry-pick 512d725 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git åŠå°æ—¶å…¥é—¨ &lt;ç¬¬äºŒç« &gt;</title>
      <link href="posts/13c0012.html"/>
      <url>posts/13c0012.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-åŠå°æ—¶å…¥é—¨"><a href="#Git-åŠå°æ—¶å…¥é—¨" class="headerlink" title="Git åŠå°æ—¶å…¥é—¨ <ç¬¬äºŒç« >"></a>Git åŠå°æ—¶å…¥é—¨ &lt;ç¬¬äºŒç« &gt;</h1><h2 id="ä½¿ç”¨-Git"><a href="#ä½¿ç”¨-Git" class="headerlink" title="ä½¿ç”¨ Git"></a>ä½¿ç”¨ Git</h2><ol><li>æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨ git ï¼Ÿ</li><li>å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨ git ç®¡ç†ä»£ç ï¼Ÿ</li><li>å¦‚ä½•å›é€€ç‰ˆæœ¬ï¼Ÿ</li><li>å¦‚ä½•æ’¤é”€ä¿®æ”¹ï¼Ÿ</li><li>åˆ†æ”¯ç®¡ç†</li><li>å¤šäººåä½œ</li><li>å¿½ç•¥æ–‡ä»¶çš„å†™æ³•</li></ol><h3 id="æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨Git"><a href="#æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨Git" class="headerlink" title="æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨Git"></a>æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨Git</h3><ol><li>åˆ›å»º gitdemo ç›®å½•ï¼ˆåˆ›å»ºç‰ˆæœ¬åº“ï¼‰</li></ol>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">mkdir gitdemo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>åˆ‡æ¢åˆ°ç‰ˆæœ¬åº“ä¸­ï¼Œå¹¶åˆå§‹åŒ– git ï¼ˆåˆå§‹åŒ–çš„æ„æ€æ˜¯å°†å½“å‰ç›®å½•äº¤ç»™ git ç®¡ç†ï¼‰</li></ol>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">cd gitdemo &amp;&amp; git init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f250d2a5e2802918.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯ä»¥çœ‹åˆ°å½“å‰æ–‡ä»¶å¤¹å‡ºç° .git ç›®å½•"></p><ol start="3"><li>å†™å…¥æµ‹è¯•æ–‡ä»¶  <pre class="line-numbers language-git" data-language="git"><code class="language-git">echo 123 &gt; demo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>æŸ¥çœ‹å½“å‰ git ä»“åº“çŠ¶æ€ ï¼ˆæ­¤æ—¶çš„çŠ¶æ€ä¸º ã€Œæœªæäº¤ã€ï¼‰</li></ol>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">git status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-525075aa4e3a14fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ­¤æ—¶çš„çŠ¶æ€ä¸ºæ²¡æœ‰å°†æ–‡ä»¶æ·»åŠ åˆ° git ä¸­"></p><ol start="5"><li>æäº¤å½“å‰ ã€å½“å‰ä¿®æ”¹ã€åˆ°æš‚å­˜åŒº</li></ol><ul><li>æäº¤å•ä¸ªæ–‡ä»¶<pre class="line-numbers language-git" data-language="git"><code class="language-git">git add demo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>æäº¤å¤šä¸ªæ–‡ä»¶ <pre class="line-numbers language-git" data-language="git"><code class="language-git">git add demo.txt other.txt text.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>æäº¤æ‰€æœ‰ä¿®æ”¹   <pre class="line-numbers language-git" data-language="git"><code class="language-git">git add -A # æäº¤æ‰€æœ‰ä¿®æ”¹<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><ol start="6"><li>æäº¤åˆ°ä»“åº“ä¸­ï¼ˆå°†æš‚å­˜åŒºä¸­çš„å†…å®¹åŒæ­¥åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼‰ <pre class="line-numbers language-git" data-language="git"><code class="language-git">git commit -m â€œ&lt;description current commit&gt;â€<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a2a7007346846470.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ol start="7"><li>åˆ›å»ºè¿œç¨‹åº“ï¼ˆè¿™é‡Œä½¿ç”¨å…¨çƒæœ€å¤§çš„ git ä»“åº“ GitHub ä½œä¸ºç¤ºèŒƒï¼‰</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a3d1feac668ed82a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ad92163aeb466d05.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8103d08391732d57.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è‡³æ­¤ï¼Œåœ¨ GitHub ä¸Šé¢åˆ›å»ºè¿œç¨‹ä»“åº“å·²ç»å®Œæ¯•ã€‚"></p><ol start="8"><li>æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“åˆ›å»ºå…³è”å…³ç³»  <pre class="line-numbers language-git" data-language="git"><code class="language-git">git remote add origin git@github.com:&lt;Your name&gt;/demogit.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>å°†æœ¬åœ°ä»“åº“ä¸­çš„ä»£ç æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­  <pre class="line-numbers language-git" data-language="git"><code class="language-git">git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>ä»è¿œç¨‹ä»“åº“ä¸­æ‹‰å–ä»£ç åˆ°æœ¬åœ°ä»“åº“ä¸­  <pre class="line-numbers language-git" data-language="git"><code class="language-git">git fetch origin master &amp;&amp; git pull <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ git pull</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a9df74b0b3da3cc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ol start="11"><li>ç”Ÿæˆ SSH Keyã€‚</li></ol><p>æˆ‘ä»¬çŸ¥é“ GitHub è¿œç¨‹åº“æ”¯æŒ HTTPS å’Œ SSH ä¸¤ç§æ–¹å¼é€šè®¯ï¼Œå¦‚æœä½ å°±æƒ³é‡‡ç”¨ HTTPS çš„è¯ï¼Œé‚£ä¹ˆè¯·å¿½ç•¥è¿™ä¸€æ­¥ï¼Œä½†æ˜¯å¦‚æœé‡‡ç”¨ HTTPS é€šè®¯ï¼Œæ¯æ¬¡æäº¤çš„æ—¶å€™å°±éœ€è¦è¾“å…¥ä¸€æ¬¡è´¦å·å’Œå¯†ç ï¼Œä¹ŸæŒºçƒ¦çš„ã€‚æ¥ä¸‹æ¥è®²è§£ï¼Œå¦‚ä½•é‡‡ç”¨ SSH åè®®é€šè®¯ã€‚</p><p>ç”Ÿæˆ SSH Key å¯†é’¥å¯¹</p>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">ssh-keygen -t rsa -C <span class="token string">"youremail@example.com"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œå¯ä»¥åœ¨ç”¨æˆ·ä¸»ç›®å½•é‡Œæ‰¾åˆ° .ssh ç›®å½•ï¼Œé‡Œé¢æœ‰ id_rsa å’Œ id_rsa.pub ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªå°±æ˜¯ SSH Key çš„ç§˜é’¥å¯¹ï¼Œid_rsa æ˜¯ç§é’¥ï¼Œä¸èƒ½æ³„éœ²å‡ºå»ï¼Œid_rsa.pub æ˜¯å…¬é’¥ï¼Œå¯ä»¥æ”¾å¿ƒåœ°å‘Šè¯‰ä»»ä½•äººã€‚<br>å°†ç”Ÿæˆçš„ id_rsa.pub å…¬é’¥å†…å®¹æ·»åŠ åˆ° GitHub ä¸­</p><p>ç”Ÿæˆ SSH å¯†é’¥å¯¹</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-11d85bb5fe6494d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>æŸ¥çœ‹ç”Ÿæˆçš„å¯†é’¥å¯¹ï¼Œç”Ÿæˆçš„è·¯å¾„åœ¨ ã€Œç”¨æˆ·å®¶ç›®å½•/.sshã€</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7e60b43f07906de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8d9715611944f0a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-17283add08b5bad4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a79d366fc59768a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>å°†å…¬é’¥æ·»åŠ åˆ° GitHub ä¸­ï¼Œè‡³æ­¤æˆ‘ä»¬å†æ¬¡å»æ¨é€ä¸€æ¬¡æœ¬åœ°ä»£ç åˆ°è¿œç¨‹åº“ï¼Œå³å¯çœ‹è§å¯ä»¥æ¨é€æˆåŠŸäº†ï¼</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1d6bd88c7c40f6b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h3 id="æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨-Git-ï¼ˆæ€»ç»“ï¼‰"><a href="#æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨-Git-ï¼ˆæ€»ç»“ï¼‰" class="headerlink" title="æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨ Git ï¼ˆæ€»ç»“ï¼‰"></a>æ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨ Git ï¼ˆæ€»ç»“ï¼‰</h3><p>ä¸€ä¸ªæ–°é¡¹ç›®å¦‚ä½•ä½¿ç”¨ git æ¥ç®¡ç†ï¼Œå¹¶åˆ›å»ºè¿œç¨‹ä»“åº“ï¼Ÿ</p><ol><li>ä½¿ç”¨ GitHubã€giteeã€coding åˆ›å»ºå¥½è¿œç¨‹ä»“åº“</li><li>å¦‚æœé‡‡ç”¨ ssh åè®®é€šè®¯çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å…ˆåœ¨æœ¬åœ°ç”Ÿæˆ ssh key å¯†é’¥å¯¹ï¼Œå¹¶ä¸”å°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹åº“è´¦å· ssh ç›¸å…³è®¾ç½®ä¸­ï¼Œå¦‚æœé‡‡ç”¨ https åè®®é€šè®¯çš„è¯ï¼Œåˆ™è·³è¿‡æ­¤æ­¥éª¤ã€‚<br><code>ssh-keygen -t rsa -C "youremail@example.com" </code></li><li>å°†ä»£ç é€šè¿‡è¿œç¨‹åº“æ¥ç®¡ç†<br>å¯ä»¥ç›´æ¥å°†è¿œç¨‹ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼Œæ­¤ç§æ–¹æ³•æœ€ä¸ºç®€å•ã€‚<br><code>git clone git@github.com:&lt;Your GitHub account name&gt;/demogit.git</code><br>å¯ä»¥å…ˆåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªä»“åº“ä¹‹åï¼Œå†å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“åˆ›å»ºå…³è”å…³ç³»ï¼Œç¨è®¸å¤æ‚ã€‚</li></ol><ul><li><p>åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶ git åˆå§‹åŒ–é¡¹ç›®</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">mkdir -p ~/demogit &amp;&amp; cd ~/demogit &amp;&amp; git init <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ›å»ºè¿œç¨‹è¿æ¥</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git remote add origin git@github.com:&lt;Your GitHub account name&gt;/demogit.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹è¿œç¨‹è¿æ¥æ˜¯å¦åˆ›å»ºæˆåŠŸ</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git remote -vv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><ol start="4"><li>åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¹¶æäº¤ä»£ç åˆ°æœ¬åœ°ä»“åº“  <pre class="line-numbers language-git" data-language="git"><code class="language-git">cd ~/demogit &amp;&amp; echo 123 &gt; demo.txt &amp;&amp; git add -A &amp;&amp; git commit -m â€œcommit for testâ€ <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>å°†æœ¬åœ°ä»£ç æ¨é€åˆ°è¿œç¨‹åº“  <pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># ç¬¬ä¸€æ¬¡æ¨é€çš„æ—¶å€™éœ€è¦åŠ ä¸Š ã€Œ-uã€å‚æ•°ï¼Œåç»­æ¨é€çš„æ—¶å€™ï¼Œå¯ä»¥ä¸ç”¨åŠ </span>git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h3 id="å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨gitç®¡ç†ä»£ç ï¼Ÿ"><a href="#å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨gitç®¡ç†ä»£ç ï¼Ÿ" class="headerlink" title="å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨gitç®¡ç†ä»£ç ï¼Ÿ"></a>å·²æœ‰é¡¹ç›®å¦‚ä½•ä½¿ç”¨gitç®¡ç†ä»£ç ï¼Ÿ</h3><ol><li>å…ˆåˆ›å»ºè¿œç¨‹ä»“åº“ï¼Œç„¶åå°†è¿œç¨‹ç©ºä»“åº“æ‹‰åˆ°æœ¬åœ°ï¼Œä¹‹åå°†å·²æœ‰çš„é¡¹ç›®å…¨éƒ¨å¤åˆ¶åˆ°ç©ºæœ¬åœ°ä»“åº“ä¸­</li><li>æœ¬åœ°ç›´æ¥åœ¨é¡¹ç›®ä¸­ git åˆå§‹åŒ–é¡¹ç›®ï¼Œç„¶ååˆ›å»ºè¿œç¨‹è¿æ¥ï¼Œä¹‹åå°†æœ¬åœ°ä»£ç å…¨éƒ¨æ·»åŠ åˆ° ã€Œæš‚å­˜åŒºã€ï¼Œå†æäº¤åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œä¹‹åå†æ¨é€ã€‚</li></ol><h3 id="å¦‚ä½•å›é€€ç‰ˆæœ¬ï¼Ÿ"><a href="#å¦‚ä½•å›é€€ç‰ˆæœ¬ï¼Ÿ" class="headerlink" title="å¦‚ä½•å›é€€ç‰ˆæœ¬ï¼Ÿ"></a>å¦‚ä½•å›é€€ç‰ˆæœ¬ï¼Ÿ</h3><ol><li>reset ï¼ˆç›´æ¥å›é€€ç‰ˆæœ¬ï¼‰<pre class="line-numbers language-git" data-language="git"><code class="language-git">git reset --hard HEAD^  # å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬git reset --hard HEAD^^^  # å›é€€åˆ°ä¸Šä¸‰ä¸ªç‰ˆæœ¬git reset --hard HEAD~100  # å›é€€åˆ°ä¸Š 100 ä¸ªç‰ˆæœ¬git reset --hard &lt;commit id&gt; # å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>revert ï¼ˆå°†å›é€€è¿‡ç¨‹å½“æˆä¸€ä¸ªç‰ˆæœ¬æäº¤ï¼‰<pre class="line-numbers language-git" data-language="git"><code class="language-git">git revert &lt;commit id&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p>å¦‚ä½•æŸ¥çœ‹æäº¤ç‰ˆæœ¬å·ï¼Ÿ<br>  </p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git log -2  # æŸ¥çœ‹å€’æ•° 2 æ¡æäº¤è®°å½•ï¼Œæäº¤è®°å½•ä¸­å«æœ‰ç‰ˆæœ¬å·git reflog  # æŸ¥çœ‹æ‰€æœ‰çš„æäº¤ç‰ˆæœ¬å·ï¼Œå¦‚æœè¦é‡è¿”æœªæ¥ï¼Œç”¨git reflogæŸ¥çœ‹å‘½ä»¤å†å²ï¼Œä»¥ä¾¿ç¡®å®šè¦å›åˆ°æœªæ¥çš„å“ªä¸ªç‰ˆæœ¬ã€‚git log --pretty=oneline<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p></p><h3 id="å¦‚ä½•æ’¤é”€ä¿®æ”¹ï¼Ÿ"><a href="#å¦‚ä½•æ’¤é”€ä¿®æ”¹ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ’¤é”€ä¿®æ”¹ï¼Ÿ"></a>å¦‚ä½•æ’¤é”€ä¿®æ”¹ï¼Ÿ</h3><p>å› ä¸º git ä¸»è¦æœ‰ä¸‰ç§çŠ¶æ€ï¼Œå› æ­¤å°±æœ‰ä¸‰ç§å¯èƒ½æ€§ï¼Œå·¥ä½œåŒºã€æš‚å­˜åŒºã€ç‰ˆæœ¬åº“</p><ol><li><p>å½“ä¿®æ”¹åªåœ¨å·¥ä½œåŒºï¼Œè¿˜æ²¡æœ‰ git add æ—¶ï¼š ï¼ˆä¸€å®šè¦æ³¨æ„æœ‰ ã€Œâ€“ã€ï¼‰</p>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout -- &lt;filename&gt;  æ¯”å¦‚ï¼š git checkout -- example.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å½“ä¿®æ”¹åœ¨æš‚å­˜åŒºæ—¶ï¼Œå·²ç» git addï¼š</p>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">2.1. git reset HEAD &lt;filename&gt;  æ¯”å¦‚ï¼šgit reset HEAD example.txt2.2. git checkout -- &lt;filename&gt;  æ¯”å¦‚ï¼šgit checkout -- example.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å½“ä¿®æ”¹å·²ç»ä»æš‚å­˜åŒºæäº¤åˆ°äº†æœ¬åœ°ä»“åº“ï¼Œå·²ç» git commitï¼š</p>  <pre class="line-numbers language-git" data-language="git"><code class="language-git">git reset --hard HEAD^<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="åˆ†æ”¯ç®¡ç†"><a href="#åˆ†æ”¯ç®¡ç†" class="headerlink" title="åˆ†æ”¯ç®¡ç†"></a>åˆ†æ”¯ç®¡ç†</h3><h4 id="ä»€ä¹ˆæ˜¯åˆ†æ”¯ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åˆ†æ”¯ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†æ”¯ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åˆ†æ”¯ï¼Ÿ</h4><p>åˆ†æ”¯æ˜¯ç”¨æ¥å°†ç‰¹æ€§å¼€å‘ç»ç¼˜å¼€æ¥çš„ã€‚åœ¨ä½ åˆ›å»ºä»“åº“çš„æ—¶å€™ï¼Œmaster æ˜¯â€œé»˜è®¤çš„â€ã€‚åœ¨å…¶ä»–åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œå®Œæˆåå†å°†å®ƒä»¬åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1ebabe114f060966.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½ æ­£åœ¨å­¦ä¹ gitï¼ŒåŒæ—¶å¼‚æ­¥ç©ºé—´çš„ä½ åˆåœ¨å­¦ä¹ svnï¼Œæœ€ååˆå¹¶ï¼ŒäºŒè€…ä½ éƒ½ä¼šäº†"></p><ul><li><p>åˆ›å»ºä¸€ä¸ªå«åš ã€Œfeature_xã€ åˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ° ã€Œfeature_xã€ åˆ†æ”¯</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout -b feature_x  æˆ–è€… git switch -c feature_x <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ›å»ºåˆ†æ”¯</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git branch feature_x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä»å½“å‰åˆ†æ”¯åˆ‡æ¢åˆ°æ–°çš„åˆ†æ”¯</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git checkout feature_x  æˆ–è€… git switch feature_x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹åˆ†æ”¯</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git branch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ é™¤åˆ†æ”¯</p><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># å°†æ–°å»ºçš„åˆ†æ”¯åˆ é™¤ï¼ˆå·²ç»åˆå¹¶åï¼‰</span>git branch -d feature_x<span class="token comment"># ï¼ˆæœªåˆå¹¶ï¼Œå¼ºåˆ ï¼‰</span>git branch -D feature_x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git merge &lt;branch name&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>é™¤éå°†åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œä¸ç„¶è¯¥åˆ†æ”¯å…¶ä»–äººä¸å¯è§</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git push origin &lt;branch&gt;  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git log --graph <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7a1ec719f624521e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h3 id="å¤šäººåä½œ"><a href="#å¤šäººåä½œ" class="headerlink" title="å¤šäººåä½œ"></a>å¤šäººåä½œ</h3><ol><li>é¦–å…ˆï¼Œå¯ä»¥è¯•å›¾ç”¨ <strong>git push origin <branch-name></branch-name></strong> æ¨é€è‡ªå·±çš„ä¿®æ”¹ï¼›</li><li>å¦‚æœæ¨é€å¤±è´¥ï¼Œåˆ™å› ä¸ºè¿œç¨‹åˆ†æ”¯æ¯”ä½ çš„æœ¬åœ°æ›´æ–°ï¼Œéœ€è¦å…ˆç”¨ <strong>git pull</strong> è¯•å›¾åˆå¹¶ï¼›</li><li>å¦‚æœåˆå¹¶æœ‰å†²çªï¼Œåˆ™è§£å†³å†²çªï¼Œå¹¶åœ¨æœ¬åœ°æäº¤ï¼›</li><li>æ²¡æœ‰å†²çªæˆ–è€…è§£å†³æ‰å†²çªåï¼Œå†ç”¨ <strong>git push origin <branch-name></branch-name></strong> æ¨é€å°±èƒ½æˆåŠŸï¼</li></ol><p>å¦‚æœ git pull æç¤º no tracking informationï¼Œåˆ™è¯´æ˜æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„é“¾æ¥å…³ç³»æ²¡æœ‰åˆ›å»ºï¼Œç”¨å‘½ä»¤ **git branch â€“set-upstream-to <branch-name> origin/<branch-name>**ã€‚<br>ç›´æ¥ä»è¿œç¨‹ä»“åº“æ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶åœ¨æœ¬åœ°åˆ›å»ºå’Œè¿œç¨‹åŒååˆ†æ”¯</branch-name></branch-name></p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git branch --set-upstream branch-name origin/branch-name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¿½ç•¥æ–‡ä»¶çš„å†™æ³•-ï¼ˆ-gitignoreï¼‰"><a href="#å¿½ç•¥æ–‡ä»¶çš„å†™æ³•-ï¼ˆ-gitignoreï¼‰" class="headerlink" title="å¿½ç•¥æ–‡ä»¶çš„å†™æ³• ï¼ˆ.gitignoreï¼‰"></a>å¿½ç•¥æ–‡ä»¶çš„å†™æ³• ï¼ˆ.gitignoreï¼‰</h3><ol><li>å¿½ç•¥æ–‡ä»¶çš„ä½œç”¨<br>å¿½ç•¥ä¸æƒ³æäº¤çš„æ–‡ä»¶</li><li>å¿½ç•¥æ–‡ä»¶çš„å†™æ³•<br>ç›´æ¥åœ¨ .gitignore æ–‡ä»¶ä¸­å†™ test.txt  # è¡¨ç¤ºå¿½ç•¥å’Œ .gitignore å¹³çº§çš„ test.txt æ–‡ä»¶<br>ç›´æ¥å†™ upload/  # è¡¨ç¤ºå¿½ç•¥å’Œ .gitignore å¹³çº§çš„ upload ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ç­‰åŒäº upload/*<br>ç›´æ¥å†™ upload/*.txt  # è¡¨ç¤ºå¿½ç•¥å’Œ .gitignore å¹³çº§çš„ upload æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„ä»¥ .txt å‘½åçš„æ–‡ä»¶<br>ç›´æ¥å†™ *.py[cod] huâ€™lue # è¡¨ç¤ºå¿½ç•¥å’Œ .gitignore å¹³çº§çš„ æ‰€æœ‰æ–‡ä»¶åæ˜¯ .pyc æˆ– .pyo æˆ– .pyd çš„æ–‡ä»¶<br>å¿½ç•¥æ‰€æœ‰ .txt çš„æ–‡ä»¶ï¼Œä½†æ˜¯é™¤äº† a.txt çš„æ–‡ä»¶çš„å†™æ³• *.txt !a.txt</li><li>å¦‚æœæŸä¸ªæ–‡ä»¶å·²ç»åœ¨å¿½ç•¥æ–‡ä»¶ä¸­å¿½ç•¥ï¼Œä½†æ˜¯åˆæƒ³è¦æäº¤è¯¥æ–‡ä»¶<br>git  add -f <file name="">  # å¼ºåˆ¶æäº¤ force.txt æ–‡ä»¶ =&gt; git add -f force.txt</file></li><li>æ£€æŸ¥æŸä¸ªæ–‡ä»¶æ˜¯å¦è¢«å¿½ç•¥æ–‡ä»¶æ‰€å¿½ç•¥<br>git check-ignore -v <file name=""> # æŸ¥çœ‹ force.txt æ˜¯å¦è¢«å¿½ç•¥ =&gt;  git check-ignore -v force.txt</file></li></ol>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git åŠå°æ—¶å…¥é—¨ &lt;ç¬¬ä¸€ç« &gt;</title>
      <link href="posts/89044c18.html"/>
      <url>posts/89044c18.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-åŠå°æ—¶å…¥é—¨"><a href="#Git-åŠå°æ—¶å…¥é—¨" class="headerlink" title="Git åŠå°æ—¶å…¥é—¨ <ç¬¬ä¸€ç« >"></a>Git åŠå°æ—¶å…¥é—¨ &lt;ç¬¬ä¸€ç« &gt;</h1><h2 id="é‚‚é€…-Git"><a href="#é‚‚é€…-Git" class="headerlink" title="é‚‚é€… Git"></a>é‚‚é€… Git</h2><ol><li>git æ˜¯ä»€ä¹ˆï¼Ÿ<br>Git æ˜¯ç›®å‰ä¸–ç•Œä¸Šæœ€å…ˆè¿›çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆæ²¡æœ‰ä¹‹ä¸€ï¼‰ã€‚</li><li>git å¯ä»¥å¹²ä»€ä¹ˆï¼Ÿ<br>å¯¹æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚</li><li>git çš„ä¼˜ç‚¹ï¼Ÿ<br>é«˜ç«¯å¤§æ°”ä¸Šæ¡£æ¬¡ï¼ï¼ˆé€Ÿåº¦æœ€å¿«ï¼Œæ“ä½œç®€å•ï¼‰</li><li>git å’Œ CVSã€SVN è¿™äº›ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br>æœ€å¤§çš„ä¸€ä¸ªåŒºåˆ«åœ¨äº CVSã€SVN â€¦â€¦è¿™äº›ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯ ã€Œé›†ä¸­å¼ã€çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè€Œ Git æ˜¯ ã€Œåˆ†å¸ƒå¼ã€çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</li><li>git èµ·æºåŸå› <br>å¾ˆå¤šäººéƒ½çŸ¥é“ï¼ŒLinus åœ¨ 1991 å¹´åˆ›å»ºäº†å¼€æºçš„ Linux ç³»ç»Ÿï¼Œèµ·åˆ Linus é€šè¿‡æ‰‹å·¥åˆå¹¶ä»£ç ï¼Œä½†éšåéšç€ä»£ç é‡è¶Šæ¥è¶Šå¤§ï¼ŒLinus æ— æ³•å†é€šè¿‡æ‰‹å·¥åˆå¹¶ä»£ç ï¼Œå› æ­¤é‡‡ç”¨äº†å•†ä¸šçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ BitKeeperï¼Œèµ·åˆ BitKeeper çš„ä¸œå®¶å…è´¹å°†è¯¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæä¾›ç»™ Linux ç¤¾åŒºä½¿ç”¨ï¼Œä½†å¼€å‘ Samba çš„ Andrew è¯•å›¾ç ´è§£ BitKeeper çš„åè®®ï¼Œè¿™ä¸‹æŠŠ BitKeeper çš„ä¸œå®¶ç»™æƒ¹æ€’äº†ï¼Œè¦æ”¶å› Linux ç¤¾åŒºçš„å…è´¹ä½¿ç”¨æƒï¼Œç»“æœ Linus èŠ±äº†ä¸¤å‘¨æ—¶é—´è‡ªå·±ç”¨ C å†™äº†ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè¿™å°±æ˜¯ Gitï¼éšååœ¨ 2008å¹´ï¼ŒGitHub ç½‘ç«™ä¸Šçº¿äº†ï¼Œå®ƒä¸ºå¼€æºé¡¹ç›®å…è´¹æä¾› Git å­˜å‚¨ï¼Œæ— æ•°å¼€æºé¡¹ç›®å¼€å§‹è¿ç§»è‡³ GitHubï¼ŒåŒ…æ‹¬ jQueryï¼ŒPHPï¼ŒRuby ç­‰ç­‰ã€‚</li></ol><h3 id="é›†ä¸­å¼å’Œåˆ†å¸ƒå¼çš„åŒºåˆ«"><a href="#é›†ä¸­å¼å’Œåˆ†å¸ƒå¼çš„åŒºåˆ«" class="headerlink" title="é›†ä¸­å¼å’Œåˆ†å¸ƒå¼çš„åŒºåˆ«"></a>é›†ä¸­å¼å’Œåˆ†å¸ƒå¼çš„åŒºåˆ«</h3><p><strong>é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong>ï¼Œç‰ˆæœ¬åº“æ˜¯é›†ä¸­å­˜æ”¾åœ¨ä¸­å¤®æœåŠ¡å™¨çš„ï¼Œ<br>è€Œå¹²æ´»çš„æ—¶å€™ï¼Œç”¨çš„éƒ½æ˜¯è‡ªå·±çš„ç”µè„‘ï¼Œæ‰€ä»¥è¦å…ˆä»ä¸­å¤®æœåŠ¡å™¨<br>å–å¾—æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶åå¼€å§‹å¹²æ´»ï¼Œå¹²å®Œæ´»äº†ï¼Œå†æŠŠè‡ªå·±çš„æ´»<br>æ¨é€ç»™ä¸­å¤®æœåŠ¡å™¨ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2aa9d28c6ff90e8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ"></p><blockquote><p>æœ€å¤§çš„æ¯›ç—…å°±æ˜¯å¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼Œå¹¶ä¸”å¦‚æœä¸­å¤®æœåŠ¡å™¨å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆæ‰€æœ‰äººéƒ½æ²¡æ³•å¹²æ´»å„¿äº†</p></blockquote><p><strong>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong>æ ¹æœ¬æ²¡æœ‰â€œä¸­å¤®æœåŠ¡å™¨â€ï¼Œæ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œè¿™æ ·ï¼Œä½ å·¥ä½œçš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦è”ç½‘äº†ï¼Œå› ä¸ºç‰ˆæœ¬åº“å°±åœ¨ä½ è‡ªå·±çš„ç”µè„‘ä¸Šã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8265e227f4d5f25b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ"></p><h2 id="å®‰è£…-Git"><a href="#å®‰è£…-Git" class="headerlink" title="å®‰è£… Git"></a>å®‰è£… Git</h2><ol><li>åœ¨ Linux ä¸Šå®‰è£… Git<br>Debian æˆ– Ubuntu ç³»åˆ—ï¼š sudo apt-get install git æˆ–è€… sudo apt-get install git-coreï¼ˆå› ä¸ºä»¥å‰æœ‰ä¸ªè½¯ä»¶ä¹Ÿå« GITï¼ˆGNU Interactive Toolsï¼‰ï¼Œç»“æœ Git å°±åªèƒ½å« git-core äº†ã€‚ç”±äº Git åæ°”å®åœ¨å¤ªå¤§ï¼Œåæ¥å°±æŠŠ GNU Interactive Tools æ”¹æˆ gnuitï¼Œgit-core æ­£å¼æ”¹ä¸º gitã€‚ï¼‰</li></ol><ul><li>Redhat æˆ– CentOS ç³»åˆ—ï¼šyum install git</li><li>Mac OS X ä¸Šå®‰è£… gitæœ‰ä¸¤ç§æ–¹æ³•<ul><li>ä¸€æ˜¯å®‰è£…homebrewï¼Œç„¶åé€šè¿‡homebrewå®‰è£…Gitï¼Œå…·ä½“æ–¹æ³•è¯·å‚è€ƒhomebrewçš„æ–‡æ¡£ï¼š<a href="http://brew.sh/">http://brew.sh/</a></li><li>äºŒæ˜¯ç›´æ¥ä»AppStoreå®‰è£…Xcodeï¼ŒXcodeé›†æˆäº†Gitï¼Œä¸è¿‡é»˜è®¤æ²¡æœ‰å®‰è£…ï¼Œä½ éœ€è¦è¿è¡ŒXcodeï¼Œé€‰æ‹©èœå•â€œXcodeâ€-&gt;â€œPreferencesâ€ï¼Œåœ¨å¼¹å‡ºçª—å£ä¸­æ‰¾åˆ°â€œDownloadsâ€ï¼Œé€‰æ‹©â€œCommand Line Toolsâ€ï¼Œç‚¹â€œInstallâ€å°±å¯ä»¥å®Œæˆå®‰è£…äº†ã€‚</li></ul></li></ul><ol start="2"><li>åœ¨ Windows ä¸Šå®‰è£… git<br>ç›´æ¥åœ¨ git å®˜ç½‘ <a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a> ä¸Šé¢ä¸‹è½½ .exe è½¯ä»¶ï¼Œç„¶åä¸€ç›´ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚</li></ol><h3 id="ä»¥ä¸‹è®²è§£åœ¨-Windows-ç³»ç»Ÿä¸‹å®‰è£…"><a href="#ä»¥ä¸‹è®²è§£åœ¨-Windows-ç³»ç»Ÿä¸‹å®‰è£…" class="headerlink" title="ä»¥ä¸‹è®²è§£åœ¨ Windows ç³»ç»Ÿä¸‹å®‰è£…"></a>ä»¥ä¸‹è®²è§£åœ¨ Windows ç³»ç»Ÿä¸‹å®‰è£…</h3><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-abc8c279ef435fc6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®˜ç½‘ä¸‹è½½ Git "></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-76eb47be74fdfd67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸€ç›´ç‚¹å‡»â€œNextâ€å³å¯å®‰è£…"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7e64397183b9823b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¼ æ ‡å³é”®æˆ–è€…ä»»åŠ¡æ ä¸­å‡ºç° â€œGit Bashâ€åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ"></p><h4 id="é…ç½®-GIT"><a href="#é…ç½®-GIT" class="headerlink" title="é…ç½® GIT"></a>é…ç½® GIT</h4><blockquote><p>å› ä¸º Git æ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªæœºå™¨éƒ½å¿…é¡»è‡ªæŠ¥å®¶é—¨ï¼šä½ çš„åå­—å’Œ Email åœ°å€ã€‚</p></blockquote><ul><li><p>é…ç½®ç”¨æˆ·å</p><pre class="line-numbers language-git" data-language="git"><code class="language-git">git config --global user.name <span class="token string">"&lt;Your Name&gt;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2cab46c99eac9e15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®ç”¨æˆ·å"></p><ul><li>é…ç½® Email åœ°å€</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git config --global user.email <span class="token string">"&lt;email@example.com&gt;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-912cdc2fb3e06ec5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½® Email åœ°å€"></p><h3 id="ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé¡»çŸ¥"><a href="#ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé¡»çŸ¥" class="headerlink" title="ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé¡»çŸ¥"></a>ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé¡»çŸ¥</h3><p><strong>æ‰€æœ‰çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå…¶å®åªèƒ½è·Ÿè¸ªæ–‡æœ¬æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œ</strong> æ¯”å¦‚ TXT æ–‡ä»¶ï¼Œç½‘é¡µï¼Œæ‰€æœ‰çš„ç¨‹åºä»£ç ç­‰ç­‰ï¼ŒGit ä¹Ÿä¸ä¾‹å¤–ã€‚<br>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¯ä»¥å‘Šè¯‰ä½ æ¯æ¬¡çš„æ”¹åŠ¨ï¼Œæ¯”å¦‚åœ¨ç¬¬ 5 è¡ŒåŠ äº†ä¸€ä¸ªå•è¯â€œLinuxâ€ï¼Œåœ¨ç¬¬ 8 è¡Œåˆ äº†ä¸€ä¸ªå•è¯â€œWindowsâ€ã€‚<br>è€Œ <strong>å›¾ç‰‡ã€è§†é¢‘è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè™½ç„¶ä¹Ÿèƒ½ç”±ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç®¡ç†ï¼Œä½†æ²¡æ³•è·Ÿè¸ªæ–‡ä»¶çš„å˜åŒ–ï¼Œ</strong> åªèƒ½æŠŠäºŒè¿›åˆ¶æ–‡ä»¶æ¯æ¬¡æ”¹åŠ¨ä¸²èµ·æ¥ï¼Œ<br>ä¹Ÿå°±æ˜¯åªçŸ¥é“å›¾ç‰‡ä» 100KB æ”¹æˆäº† 120KBï¼Œä½†åˆ°åº•æ”¹äº†å•¥ï¼Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸çŸ¥é“ï¼Œä¹Ÿæ²¡æ³•çŸ¥é“ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼ŒMicrosoft çš„ Word æ ¼å¼æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œå› æ­¤ï¼Œ <strong>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯æ²¡æ³•è·Ÿè¸ª Word æ–‡ä»¶çš„æ”¹åŠ¨çš„ï¼Œ</strong> å¦‚æœè¦çœŸæ­£ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œ<br>å°±è¦ä»¥çº¯æ–‡æœ¬æ–¹å¼ç¼–å†™æ–‡ä»¶ã€‚</p><p>å› ä¸ºæ–‡æœ¬æ˜¯æœ‰ç¼–ç çš„ï¼Œæ¯”å¦‚ä¸­æ–‡æœ‰å¸¸ç”¨çš„ GBK ç¼–ç ï¼Œæ—¥æ–‡æœ‰ Shift_JIS ç¼–ç ï¼Œå¦‚æœæ²¡æœ‰å†å²é—ç•™é—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨æ ‡å‡†çš„ UTF-8 ç¼–ç ï¼Œ<br>æ‰€æœ‰è¯­è¨€ä½¿ç”¨åŒä¸€ç§ç¼–ç ï¼Œæ—¢æ²¡æœ‰å†²çªï¼Œåˆè¢«æ‰€æœ‰å¹³å°æ‰€æ”¯æŒã€‚</p><p>ä½¿ç”¨ Windows çš„ç«¥é‹è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><p><strong>åƒä¸‡ä¸è¦ä½¿ç”¨ Windows è‡ªå¸¦çš„è®°äº‹æœ¬ç¼–è¾‘ä»»ä½•æ–‡æœ¬æ–‡ä»¶ã€‚</strong> åŸå› æ˜¯ Microsoft å¼€å‘è®°äº‹æœ¬çš„å›¢é˜Ÿä½¿ç”¨äº†ä¸€ä¸ªéå¸¸å¼±æ™ºçš„è¡Œä¸ºæ¥ä¿å­˜ UTF-8 ç¼–ç çš„æ–‡ä»¶ï¼Œ<br>ä»–ä»¬è‡ªä½œèªæ˜åœ°åœ¨æ¯ä¸ªæ–‡ä»¶å¼€å¤´æ·»åŠ äº† 0xefbbbfï¼ˆåå…­è¿›åˆ¶ï¼‰çš„å­—ç¬¦ï¼Œä½ ä¼šé‡åˆ°å¾ˆå¤šä¸å¯æ€è®®çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œç½‘é¡µç¬¬ä¸€è¡Œå¯èƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªâ€œ?â€ï¼Œ<br>æ˜æ˜æ­£ç¡®çš„ç¨‹åºä¸€ç¼–è¯‘å°±æŠ¥è¯­æ³•é”™è¯¯ï¼Œç­‰ç­‰ï¼Œéƒ½æ˜¯ç”±è®°äº‹æœ¬çš„å¼±æ™ºè¡Œä¸ºå¸¦æ¥çš„ã€‚å»ºè®®ä½ ä¸‹è½½ Notepad++ ä»£æ›¿è®°äº‹æœ¬ï¼Œä¸ä½†åŠŸèƒ½å¼ºå¤§ï¼Œè€Œä¸”å…è´¹ï¼<br>è®°å¾—æŠŠ Notepad++ çš„é»˜è®¤ç¼–ç è®¾ç½®ä¸º UTF-8 without BOM å³å¯ï¼š</p><h3 id="Git-å·¥ä½œæµ"><a href="#Git-å·¥ä½œæµ" class="headerlink" title="Git å·¥ä½œæµ"></a>Git å·¥ä½œæµ</h3><p>ä½ çš„æœ¬åœ°ä»“åº“ç”± git ç»´æŠ¤çš„ä¸‰æ£µâ€œæ ‘â€ç»„æˆã€‚<br>ç¬¬ä¸€ä¸ªæ˜¯ä½ çš„ å·¥ä½œç›®å½•ï¼Œå®ƒæŒæœ‰å®é™…æ–‡ä»¶ï¼›<br>ç¬¬äºŒä¸ªæ˜¯ ç¼“å­˜åŒºï¼ˆIndexï¼‰ï¼Œå®ƒåƒä¸ªç¼“å­˜åŒºåŸŸï¼Œä¸´æ—¶ä¿å­˜ä½ çš„æ”¹åŠ¨ï¼›<br>æœ€åæ˜¯ HEADï¼ŒæŒ‡å‘ä½ æœ€è¿‘ä¸€æ¬¡æäº¤åçš„ç»“æœã€‚å¹¶ä¸” git ä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„<br>ç¬¬ä¸€ä¸ªåˆ†æ”¯ masterï¼Œä»¥åŠæŒ‡å‘ master çš„ä¸€ä¸ªæŒ‡é’ˆå« HEADã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8fb97ab7eaf4a408.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Gitå·¥ä½œæµ"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-963c15ac783353df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Gitå·¥ä½œæµ"></p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨ php å†™ä¸€ä¸ªç±»ä¼¼äº laravel æ¡†æ¶çš„æœåŠ¡å®¹å™¨ï¼Ÿ</title>
      <link href="posts/de7d71ca.html"/>
      <url>posts/de7d71ca.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•ä½¿ç”¨-php-å†™ä¸€ä¸ªç±»ä¼¼äº-laravel-æ¡†æ¶çš„æœåŠ¡å®¹å™¨ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨-php-å†™ä¸€ä¸ªç±»ä¼¼äº-laravel-æ¡†æ¶çš„æœåŠ¡å®¹å™¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ php å†™ä¸€ä¸ªç±»ä¼¼äº laravel æ¡†æ¶çš„æœåŠ¡å®¹å™¨ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ php å†™ä¸€ä¸ªç±»ä¼¼äº laravel æ¡†æ¶çš„æœåŠ¡å®¹å™¨ï¼Ÿ</h1><blockquote><p>è¿™ç¯‡æ–‡ç« å¯èƒ½æ–‡å­—ä¸ä¼šå¤ªå¤šï¼Œæ¯•ç«Ÿè¯´å†å¤šéƒ½è¿˜ä¸å¦‚ç›´æ¥çœ‹ä»£ç æ¥çš„å®åœ¨ ğŸ˜€ï¼Œä»¥ä¸‹æˆ‘ä¼šæŠŠæ ¸å¿ƒçš„ä»£ç éƒ½å…ˆè´´å‡ºæ¥ï¼Œé‡Œé¢éƒ½æœ‰æ¯”è¾ƒå®Œå–„çš„æ³¨é‡Šä¿¡æ¯ï¼Œå¯ä»¥å¯¹ç€çœ‹ã€‚å¦å¤–å¦‚æœè‡ªå·±æµ‹è¯•çš„è¯ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½æˆ‘çš„æºç ï¼Œå…³äºå¦‚ä½•æµ‹è¯•ï¼Œæºç ä¸­éƒ½æœ‰ç¤ºä¾‹ä»£ç ã€‚</p></blockquote><ul><li><a href="https://gitee.com/pudongping/php-base-container#/pudongping/php-base-container">Gitee åœ°å€</a></li><li><a href="https://github.com/pudongping/php-base-container">GitHub åœ°å€</a></li></ul><h2 id="ä»¥ä¸‹æ˜¯å®ç°å®¹å™¨çš„æ ¸å¿ƒä»£ç "><a href="#ä»¥ä¸‹æ˜¯å®ç°å®¹å™¨çš„æ ¸å¿ƒä»£ç " class="headerlink" title="ä»¥ä¸‹æ˜¯å®ç°å®¹å™¨çš„æ ¸å¿ƒä»£ç "></a>ä»¥ä¸‹æ˜¯å®ç°å®¹å™¨çš„æ ¸å¿ƒä»£ç </h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * å®ç°ä¸€ä¸ªç®€å•çš„ php å®¹å™¨ * * Created by PhpStorm * User: Alex * Date: 2021-08-03 17:51 * E-mail: &lt;276558492@qq.com&gt; */</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Container</span><span class="token punctuation">{</span>    <span class="token comment">/**     * å½“å‰å…¨å±€å¯ç”¨çš„å®¹å™¨(å¦‚æœæœ‰)     *     * @var static     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>    <span class="token comment">/**     * å®¹å™¨çš„ç»‘å®š     *     * @var array[]     */</span>    <span class="token keyword">private</span> <span class="token variable">$bindings</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/**     * å®¹å™¨çš„å…±äº«å®ä¾‹     *     * @var object[]     */</span>    <span class="token keyword">private</span> <span class="token variable">$instances</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token class-name static-context">Container</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">self</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token class-name static-context">Container</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$instance</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åœ¨å®¹å™¨ä¸­æ³¨å†Œå…±äº«ç»‘å®š     *     * @param $abstract     * @param $concrete     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">singleton</span><span class="token punctuation">(</span><span class="token variable">$abstract</span><span class="token punctuation">,</span> <span class="token variable">$concrete</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token variable">$abstract</span><span class="token punctuation">,</span> <span class="token variable">$concrete</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å‘å®¹å™¨æ³¨å†Œç»‘å®š     *     * @param $abstract     * @param $concrete     * @param false $shared     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">bind</span><span class="token punctuation">(</span><span class="token variable">$abstract</span><span class="token punctuation">,</span> <span class="token variable">$concrete</span><span class="token punctuation">,</span> <span class="token variable">$shared</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$concrete</span> <span class="token keyword">instanceof</span> <span class="token class-name">Closure</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'concrete'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'shared'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$concrete</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span> <span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$concrete</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidArgumentException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Argument 2 must be callback or class.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'concrete'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'shared'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†ç°æœ‰å®ä¾‹æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„å…±äº«å®ä¾‹     *     * @param string $abstract     * @param mixed $instance     * @return mixed     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">instance</span><span class="token punctuation">(</span><span class="token variable">$abstract</span><span class="token punctuation">,</span> <span class="token variable">$instance</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ä»å®¹å™¨è§£æç»™å®šç±»å‹     *     * @param string $abstract  ç›®æ ‡ç±»çš„åç§°     * @param array $parameters  å®ä¾‹åŒ–ç›®æ ‡ç±»æ—¶æ‰€éœ€è¦çš„å‚æ•°ï¼ˆéå¯¹è±¡ç±»å‹çº¦æŸå‚æ•°æ•°ç»„ï¼‰     * @return mixed|object     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">make</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$abstract</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$parameters</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$abstract</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidArgumentException</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Target class [<span class="token interpolation"><span class="token variable">$abstract</span></span>] does not exist."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$concrete</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'concrete'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_callable</span><span class="token punctuation">(</span><span class="token variable">$concrete</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveCallable</span><span class="token punctuation">(</span><span class="token variable">$concrete</span><span class="token punctuation">,</span> <span class="token variable">$parameters</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token variable">$concrete</span><span class="token punctuation">,</span> <span class="token variable">$parameters</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token variable">$abstract</span><span class="token punctuation">,</span> <span class="token variable">$parameters</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shared'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">instances</span><span class="token punctuation">[</span><span class="token variable">$abstract</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token variable">$instance</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$exception</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$exception</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$exception</span><span class="token operator">-&gt;</span><span class="token function">getTraceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è§£å†³å›è°ƒå‡½æ•°æ—¶çš„ä¾èµ–     *     * @param callable $callbackName  ç›®æ ‡å›è°ƒå‡½æ•°     * @param array $realArgs     * @return mixed     * @throws ReflectionException     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">resolveCallable</span><span class="token punctuation">(</span><span class="token keyword type-hint">callable</span> <span class="token variable">$callbackName</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$realArgs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$reflector</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionFunction</span><span class="token punctuation">(</span><span class="token variable">$callbackName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–å›è°ƒå‡½æ•°çš„å‚æ•°åˆ—è¡¨</span>        <span class="token variable">$parameters</span> <span class="token operator">=</span> <span class="token variable">$reflector</span><span class="token operator">-&gt;</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveDependencies</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">,</span> <span class="token variable">$realArgs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// è°ƒç”¨å‡½æ•°å‚æ•°</span>        <span class="token keyword">return</span> <span class="token variable">$reflector</span><span class="token operator">-&gt;</span><span class="token function">invokeArgs</span><span class="token punctuation">(</span><span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è§£å†³å¯¹è±¡æ—¶çš„ä¾èµ–     *     * @param string|object $className  ç›®æ ‡ç±»çš„åç§°     * @param array $realArgs     * @return object  ç›®æ ‡ç±»å¯¹åº”çš„å®ä¾‹å¯¹è±¡     * @throws ReflectionException     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">resolveClass</span><span class="token punctuation">(</span><span class="token variable">$className</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$realArgs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// å¯¹ç›®æ ‡ç±»è¿›è¡Œåå°„ï¼ˆè§£æå…¶æ–¹æ³•ã€å±æ€§ï¼‰</span>            <span class="token variable">$reflector</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionClass</span><span class="token punctuation">(</span><span class="token variable">$className</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ReflectionException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Target class [<span class="token interpolation"><span class="token variable">$className</span></span>] does not exist."</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$reflector</span><span class="token operator">-&gt;</span><span class="token function">isInstantiable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// æ£€æŸ¥ç±»æ˜¯å¦å¯ä»¥å®ä¾‹åŒ–</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Target class [<span class="token interpolation"><span class="token variable">$className</span></span>] is not instantiable."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// è·å–ç›®æ ‡ç±»çš„æ„é€ å‡½æ•°ï¼Œå½“ç±»ä¸å­˜åœ¨æ„é€ å‡½æ•°æ—¶è¿”å› null</span>        <span class="token variable">$constructor</span> <span class="token operator">=</span> <span class="token variable">$reflector</span><span class="token operator">-&gt;</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œåˆ™ç›´æ¥å®ä¾‹åŒ–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$constructor</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// return new $className;  // æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥è¿™æ ·å»å®ä¾‹åŒ–ï¼Œå› ä¸ºç›®æ ‡ç±»æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸éœ€è¦ä¼ å‚æ•°</span>            <span class="token keyword">return</span> <span class="token variable">$reflector</span><span class="token operator">-&gt;</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// è·å–æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨</span>        <span class="token variable">$parameters</span> <span class="token operator">=</span> <span class="token variable">$constructor</span><span class="token operator">-&gt;</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€’å½’è§£ææ„é€ å‡½æ•°çš„å‚æ•°</span>        <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveDependencies</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">,</span> <span class="token variable">$realArgs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä»ç»™å‡ºçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹</span>        <span class="token keyword">return</span> <span class="token variable">$reflector</span><span class="token operator">-&gt;</span><span class="token function">newInstanceArgs</span><span class="token punctuation">(</span><span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é€’å½’è§£æä¾èµ–æ ‘     *     * @param array $dependencies  ç›®æ ‡ç±»çš„æ„é€ å‡½æ•°å‚æ•°åˆ—è¡¨     * @param array $parameters  å®ä¾‹åŒ–ç›®æ ‡ç±»æ—¶çš„å…¶ä»–å‚æ•°ï¼ˆéç±»å‹æç¤ºå‚æ•°ï¼‰     * @return array  å®ä¾‹åŒ–ç›®æ ‡ç±»æ—¶æ„é€ å‡½æ•°æ‰€éœ€çš„æ‰€æœ‰å‚æ•°     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">resolveDependencies</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$dependencies</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$parameters</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// ç”¨äºå­˜å‚¨æ‰€æœ‰çš„å‚æ•°</span>        <span class="token variable">$results</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dependencies</span> <span class="token keyword">as</span> <span class="token variable">$dependency</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è·å–ç±»å‹æç¤ºç±»</span>            <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token variable">$dependency</span><span class="token operator">-&gt;</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¦‚æœç±»ä¸º nullï¼Œåˆ™è¡¨ç¤ºä¾èµ–é¡¹æ˜¯å­—ç¬¦ä¸²æˆ–å…¶ä»–ç±»å‹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$parameterName</span> <span class="token operator">=</span> <span class="token variable">$dependency</span><span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å‚æ•°çš„åç§°</span>                <span class="token comment">// æ£€æŸ¥å‚æ•°æ˜¯å¦æœ‰é»˜è®¤å€¼</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$dependency</span><span class="token operator">-&gt;</span><span class="token function">isDefaultValueAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token variable">$parameterName</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token variable">$parameterName</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' has no value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token variable">$parameterName</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// å‚æ•°æœ‰é»˜è®¤å€¼çš„æ—¶å€™</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token variable">$parameterName</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token variable">$parameterName</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$dependency</span><span class="token operator">-&gt;</span><span class="token function">getDefaultValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å‚æ•°çš„é»˜è®¤å€¼</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// ç±»å‹æç¤ºç¡®å®šæ˜¯ä¸€ä¸ªç±»æ—¶ï¼Œåˆ™éœ€è¦é€’å½’å¤„ç†ä¾èµ–é¡¹</span>                <span class="token variable">$objName</span> <span class="token operator">=</span> <span class="token variable">$obj</span><span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–ä¾èµ–é¡¹çš„ç±»å</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$objName</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unable to load class: '</span> <span class="token operator">.</span> <span class="token variable">$objName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$objName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Laravel </tag>
            
            <tag> æœåŠ¡å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Tag æ ‡ç­¾</title>
      <link href="posts/68649176.html"/>
      <url>posts/68649176.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-Tag-æ ‡ç­¾"><a href="#Git-Tag-æ ‡ç­¾" class="headerlink" title="Git Tag æ ‡ç­¾"></a>Git Tag æ ‡ç­¾</h1><p>æ ‡ç­¾æ€»æ˜¯å’ŒæŸä¸ª commit æŒ‚é’©ã€‚å¦‚æœè¿™ä¸ª commit æ—¢å‡ºç°åœ¨ master åˆ†æ”¯ï¼Œåˆå‡ºç°åœ¨ dev åˆ†æ”¯ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸¤ä¸ªåˆ†æ”¯ä¸Šéƒ½å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ ‡ç­¾ã€‚</p><ul><li>åˆ›å»ºæ ‡ç­¾</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># ç»™å½“å‰æäº¤ç‰ˆæœ¬æ‰“æ ‡ç­¾</span>git tag &lt;tag name&gt;<span class="token comment"># eg: æ‰“ä¸€ä¸ªåç§°ä¸º v1.0 çš„æ ‡ç­¾ï¼Œæ­¤æ—¶é»˜è®¤å°†æ ‡ç­¾æ‰“åˆ°æœ€æ–°æäº¤çš„ commit ä¸Š</span>git tag v1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç»™æŒ‡å®šæäº¤ç‰ˆæœ¬æ‰“æ ‡ç­¾</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git"><span class="token comment"># æŸ¥çœ‹å†å²æäº¤çš„ commit id</span>git log --pretty=oneline --abbrev-commit<span class="token comment"># ç»™æŒ‡å®šæäº¤ç‰ˆæœ¬æ‰“æ ‡ç­¾</span>git tag &lt;tag name&gt; &lt;commit id&gt;<span class="token comment"># eg: ç»™æäº¤ç‰ˆæœ¬å·ä¸º c53b867 çš„ç‰ˆæœ¬ï¼Œæ‰“ä¸€ä¸ªåç§°ä¸º v0.8 çš„æ ‡ç­¾</span>git tag v0.8 c53b867<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ›å»ºå¸¦æœ‰è¯´æ˜çš„æ ‡ç­¾ï¼Œç”¨ <code>-a</code> æŒ‡å®šæ ‡ç­¾åï¼Œ<code>-m</code> æŒ‡å®šè¯´æ˜æ–‡å­—ï¼š</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git tag -a &lt;tag name&gt; -m &lt;tag description&gt; &lt;commit id&gt;<span class="token comment"># egï¼šç»™ç‰ˆæœ¬å·ä¸º c53b867 çš„ç‰ˆæœ¬ï¼Œæ‰“ä¸€ä¸ªåç§°ä¸º v0.8 çš„æ ‡ç­¾ï¼Œå¹¶å¯¹ v0.8 è¿™ä¸ªæ ‡ç­¾æ·»åŠ è¯´æ˜æ–‡å­—ä¸º "add v0.8 tag"</span>git tag -a v0.8 -m <span class="token string">"add v0.8 tag"</span> c53b867<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰çš„æ ‡ç­¾ ï¼ˆæ ‡ç­¾ä¸æ˜¯æŒ‰æ—¶é—´é¡ºåºåˆ—å‡ºï¼Œè€Œæ˜¯æŒ‰å­—æ¯æ’åºçš„ã€‚ï¼‰</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git tag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git show &lt;tag name&gt;<span class="token comment"># egï¼šæŸ¥çœ‹æ ‡ç­¾åå¾— v0.9 çš„æ ‡ç­¾ä¿¡æ¯</span>git show v0.9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ é™¤æ ‡ç­¾</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git tag -d &lt;tag name&gt;<span class="token comment"># egï¼šåˆ é™¤æ ‡ç­¾åä¸º v0.1 çš„æ ‡ç­¾</span>git tag -d v0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¨é€æœ¬åœ°æ ‡ç­¾åˆ°è¿œç¨‹åº“</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git push origin &lt;tag name&gt;<span class="token comment"># egï¼š æ¨é€æœ¬åœ°æ ‡ç­¾åä¸º v0.1 çš„æ ‡ç­¾åˆ°è¿œç¨‹åº“ä¸­</span>git push origin v0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¸€æ¬¡æ€§æ¨é€å…¨éƒ¨å°šæœªæ¨é€åˆ°è¿œç¨‹çš„æœ¬åœ°æ ‡ç­¾</li></ul><pre class="line-numbers language-git" data-language="git"><code class="language-git">git push origin --tags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ ‡ç­¾å·²ç»æ¨é€åˆ°è¿œç¨‹ï¼Œæƒ³è¦åˆ é™¤è¿œç¨‹æ ‡ç­¾</li></ul><pre class="line-numbers language-none"><code class="language-none"># ç¬¬ä¸€æ­¥ï¼šåˆ é™¤æœ¬åœ°æ ‡ç­¾git tag -d v0.1# ç¬¬äºŒæ­¥ï¼šä»è¿œç¨‹åˆ é™¤git push origin :refs/tags/v0.1# ç¬¬ä¸‰æ­¥ï¼šåœ¨è¿œç¨‹åº“ä¸­æŸ¥çœ‹æ˜¯å¦è¢«åˆ é™¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows ä¸‹æ­å»º git æœåŠ¡å™¨ gogs</title>
      <link href="posts/a90b1e44.html"/>
      <url>posts/a90b1e44.html</url>
      
        <content type="html"><![CDATA[<h1 id="æœ¬æ–‡åŸºäº-windows7-64ä½-æ­å»º-gogs"><a href="#æœ¬æ–‡åŸºäº-windows7-64ä½-æ­å»º-gogs" class="headerlink" title="æœ¬æ–‡åŸºäº windows7 64ä½ æ­å»º gogs"></a>æœ¬æ–‡åŸºäº windows7 64ä½ æ­å»º gogs</h1><blockquote><p>gogs å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://gogs.io/docs">https://gogs.io/docs</a><br>è½¯ä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://dl.gogs.io/">https://dl.gogs.io/</a></p></blockquote><h1 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="headerlink" title="ç¯å¢ƒè¦æ±‚"></a>ç¯å¢ƒè¦æ±‚</h1><ul><li>æ•°æ®åº“ï¼ˆé€‰æ‹©ä»¥ä¸‹ä¸€é¡¹ï¼‰ï¼š<ul><li><a href="http://dev.mysql.com/">MySQL</a>ï¼šç‰ˆæœ¬ &gt;= 5.7</li><li><a href="http://www.postgresql.org/">PostgreSQL</a></li><li><a href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">MSSQL</a></li><li><a href="https://github.com/pingcap/tidb">TiDB</a>ï¼ˆå®éªŒæ€§æ”¯æŒï¼Œä½¿ç”¨ MySQL åè®®è¿æ¥ï¼‰</li><li>æˆ–è€…&nbsp;<strong>ä»€ä¹ˆéƒ½ä¸å®‰è£…</strong>&nbsp;ç›´æ¥ä½¿ç”¨ SQLite3</li></ul></li><li><a href="http://git-scm.com/">git</a>ï¼ˆbashï¼‰ï¼š<ul><li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å‡éœ€ç‰ˆæœ¬ &gt;= 1.7.1</li><li>Windows ç³»ç»Ÿå»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆ</li></ul></li><li>SSH æœåŠ¡å™¨ï¼š<ul><li><strong>å¦‚æœæ‚¨åªä½¿ç”¨ HTTP/HTTPS çš„è¯è¯·å¿½ç•¥æ­¤é¡¹</strong></li><li>å¦‚æœæ‚¨é€‰æ‹©åœ¨ Windows ç³»ç»Ÿä½¿ç”¨å†…ç½® SSH æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿æ·»åŠ &nbsp;<code>ssh-keygen</code>&nbsp;åˆ°æ‚¨çš„&nbsp;<code>%PATH%</code>&nbsp;ç¯å¢ƒå˜é‡ä¸­</li><li>æ¨è Windows ç³»ç»Ÿä½¿ç”¨&nbsp;<a href="http://docs.oracle.com/cd/E24628_01/install.121/e22624/preinstall_req_cygwin_ssh.htm">Cygwin OpenSSH</a>&nbsp;æˆ–&nbsp;<a href="https://www.itefix.net/copssh">Copssh</a></li><li>Windows ç³»ç»Ÿ è¯·ç¡®ä¿ Bash æ˜¯é»˜è®¤çš„ Shell ç¨‹åºï¼Œè€Œä¸æ˜¯ PowerShell</li></ul></li></ul><h1 id="æ‰€éœ€è½¯ä»¶"><a href="#æ‰€éœ€è½¯ä»¶" class="headerlink" title="æ‰€éœ€è½¯ä»¶"></a>æ‰€éœ€è½¯ä»¶</h1><ul><li>å¿…é¡»è½¯ä»¶<ul><li><a href="http://nssm.cc/download">NSSM</a></li><li><a href="https://git-scm.com/downloads">git</a>  æœ€å¥½ä¸‹è½½æœ€æ–°ç‰ˆ</li><li><a href="https://dev.mysql.com/downloads/mysql/">MySQL</a> å®˜æ–¹è¯´çš„æ˜¯ç‰ˆæœ¬éœ€è¦å¤§äº5.7ï¼Œæˆ‘çš„ç‰ˆæœ¬æ˜¯ 5.5.3 å‘ç°ä¹Ÿå¹¶æ— å½±å“ã€‚<strong>ä½†æ˜¯å­˜å‚¨å¼•æ“ä¸€å®šè¦ä½¿ç”¨ï¼šINNODBï¼</strong><br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ef2d29505d1077d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ­¤æ—¶çš„ç‰ˆæœ¬ä¸º5.5.3"></li><li><a href="https://dl.gogs.io/0.10.1/windows_amd64.zip">gogsè½¯ä»¶åŒ…</a> windows-64ä½ç‰ˆæœ¬</li></ul></li></ul><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><ol><li>å°†ä¸‹è½½çš„ gogs_0.11.86_windows_amd64.zip å‹ç¼©åŒ…æ–‡ä»¶è§£å‹ã€‚<blockquote><p>æœ¬æ–‡è§£å‹åœ¨ E:\soft-exe ç›®å½•ä¸‹</p></blockquote></li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-90a40366e1de646b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è§£å‹å‡ºæ¥æ˜¯ gogs æ–‡ä»¶å¤¹"></p><ol start="2"><li>åˆ›å»ºæ•°æ®åº“<blockquote><p>å¯ä»¥ç›´æ¥å»æ‰§è¡Œ E:\soft-exe\gogs\scripts\mysql.sql æ–‡ä»¶ï¼Œåˆ›å»º gogs æ•°æ®åº“ã€‚ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±å»åˆ›å»ºæ•°æ®åº“åä¸º gogs çš„æ•°æ®åº“ï¼Œä½†æ˜¯å»ºè®®è¿˜æ˜¯ç›´æ¥æ‰§è¡Œ mysql.sql è„šæœ¬ï¼Œæ¯•ç«Ÿå®˜æ–¹å»ºè®®ï¼‰</p></blockquote></li></ol><p>mysql.sql ä¸­çš„å†…å®¹ä¸ºä»¥ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">SET GLOBAL innodb_file_per_table = ON,           innodb_file_format = Barracuda,           innodb_large_prefix = ON;DROP DATABASE IF EXISTS gogs;CREATE DATABASE IF NOT EXISTS gogs CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å®‰è£… git<br>è¿™ä¸ªè²Œä¼¼æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šéœ€è¦è®²çš„ï¼Œç›´æ¥æ ¹æ®ä¸Šé¢æä¾›çš„é“¾æ¥åœ°å€ä¸‹è½½ git æœ€æ–°ç‰ˆï¼Œä¹‹åä¸€ç›´ä¸‹ä¸€æ­¥å®‰è£…å³å¯ã€‚</li><li>æ³¨å†Œ gogs æœåŠ¡</li></ol><ul><li>ä¿®æ”¹ E:\soft-exe\gogs\scripts\windows\install-as-service.bat ,å°†å…¶ä¸­çš„<pre class="line-numbers language-none"><code class="language-none">SET gogspath=C:/gogs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>ä¿®æ”¹æˆä½ æœ¬åœ°çš„ gogs å®‰è£…è·¯å¾„ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8b353dd27ef518c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰¾åˆ° install-as-service.bat æ–‡ä»¶"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9a7e1d01a357ff69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¿®æ”¹ gogspath çš„å€¼ä¸º gogs.exe æ‰€åœ¨æ–‡ä»¶è·¯å¾„"></p><ul><li>è§£å‹ç¼© nssm å‹ç¼©åŒ…ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-85a99004000632e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=" ä»¥ä¸Šä¸ºè§£å‹ç¼© nssm ä¹‹åçš„çŠ¶æ€"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-eefbd6e6aee7c319.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å°† nssm.exe æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶ç»å¯¹è·¯å¾„åŠ å…¥åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­"></p><ul><li>ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ  install-as-service.bat</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0ba62def3fe97198.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯¹ç€ install-as-service.bat æ–‡ä»¶é¼ æ ‡å³å‡»ï¼Œä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œ"></p><blockquote><p>åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å»æ‰§è¡Œ install-as-service.bat æ–‡ä»¶<br>æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤çš„æ–¹æ³•ä¸ºï¼šåœ¨ install-as-service.bat æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹ï¼Œéšä¾¿ç‚¹å‡»ä¸€ä¸‹ç©ºç™½å¤„ï¼Œç„¶åæŒ‰ä½ shifté”®ï¼Œç‚¹å‡»é¼ æ ‡å³é”®ï¼Œç‚¹å‡» <strong>åœ¨æ­¤å¤„æ‰“å¼€å‘½ä»¤çª—å£</strong> è¾“å…¥ gogs web å‘½ä»¤ï¼Œå›è½¦å³å¯ã€‚</p></blockquote><ol start="5"><li>æµ‹è¯•<br>æµè§ˆå™¨è®¿é—®ï¼š127.0.0.1:3000 å³å¯è¿›å…¥é…ç½®é¡µé¢ï¼ˆæˆ‘åªä¿®æ”¹äº†ä»£ç ä»“åº“å­˜æ”¾è·¯å¾„è¿™ä¸€é¡¹ï¼‰ã€‚ï¼ˆåœ¨æ­¤é¡µé¢å¹¶ä¸ä¸€å®šéè¦æ³¨å†Œç”¨æˆ·ï¼Œæˆ‘æµ‹è¯•çš„æ—¶å€™ï¼Œè™½ç„¶æ³¨å†Œäº†ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯æœ€åå‘ç°è¿˜æ˜¯éœ€è¦å†é‡æ–°æ³¨å†Œï¼‰å®Œæˆé…ç½®åï¼ŒE:\soft-exe\gogs\custom\conf ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ app.ini é…ç½®æ–‡ä»¶ã€‚</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-585db4ac286d6008.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="E:\soft-exe\gogs\custom\conf è·¯å¾„ä¸‹ç”Ÿæˆäº† app.ini é…ç½®æ–‡ä»¶"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-02ed41e662d49c21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰“å¼€ app.ini é…ç½®æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢çš„å†…å®¹ä¸ºåœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„å†…å®¹"></p><ol start="6"><li>æ³¨å†Œç”¨æˆ·ï¼ˆç³»ç»Ÿé»˜è®¤ç¬¬ä¸€ä¸ªç”¨æˆ·ä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼‰<br>å†æ¬¡è®¿é—® 127.0.0.1:3000 ï¼Œç‚¹å‡»æ³¨å†Œã€‚</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d80ab87d33fc9f1b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æˆ‘æœ¬åœ°æµ‹è¯•çš„ç”µè„‘æœªå®‰è£… .net æ¡†æ¶ï¼Œå› æ­¤æ ·å¼ä¹±æ‰äº†"></p><ol start="7"><li>åˆ›å»ºæµ‹è¯•ä»“åº“</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-387e54229c30b0c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Gogs </tag>
            
            <tag> Git æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 æ­å»º gogs Git æœåŠ¡å™¨</title>
      <link href="posts/7aeb56a9.html"/>
      <url>posts/7aeb56a9.html</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS-7-æ­å»º-gogs-Git-æœåŠ¡å™¨"><a href="#CentOS-7-æ­å»º-gogs-Git-æœåŠ¡å™¨" class="headerlink" title="CentOS 7 æ­å»º gogs Git æœåŠ¡å™¨"></a>CentOS 7 æ­å»º gogs Git æœåŠ¡å™¨</h1><h2 id="æœ¬åœ°ç¯å¢ƒå¦‚ä¸‹ï¼š"><a href="#æœ¬åœ°ç¯å¢ƒå¦‚ä¸‹ï¼š" class="headerlink" title="æœ¬åœ°ç¯å¢ƒå¦‚ä¸‹ï¼š"></a>æœ¬åœ°ç¯å¢ƒå¦‚ä¸‹ï¼š</h2><blockquote><p>Linux ç³»ç»Ÿç¯å¢ƒä¸ºï¼šCentOS Linux release 7.4.1708 (Core)<br>MySQL ç‰ˆæœ¬ä¸ºï¼š mysql  Ver 14.14 Distrib 5.7.23, for Linux (x86_64) using  EditLine wrapper<br>Git ç‰ˆæœ¬ä¸ºï¼š git version 1.8.3.1<br>Gogs å½“å‰æœ€æ–°ç‰ˆæœ¬ä¸ºï¼š0.11.86</p></blockquote><h2 id="æ‰€éœ€è½¯ä»¶"><a href="#æ‰€éœ€è½¯ä»¶" class="headerlink" title="æ‰€éœ€è½¯ä»¶"></a>æ‰€éœ€è½¯ä»¶</h2><ul><li><a href="https://gogs.io/docs">Gogs</a></li><li>Git</li><li>MySQL</li></ul><h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><ol><li><p>åˆ›å»ºç”¨æˆ·åä¸º git çš„è´¦æˆ·ï¼Œç”¨äºç®¡ç† git</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> adduser <span class="token function">git</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ‡æ¢åˆ° git ç”¨æˆ·ï¼Œå¹¶åœ¨å…¶è´¦æˆ·æ‰€åœ¨å®¶ç›®å½•ï¼Œä¸‹è½½ Gogs</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ‡æ¢åˆ° git ç”¨æˆ·</span><span class="token function">su</span> <span class="token function">git</span>  <span class="token comment"># åˆ‡æ¢åˆ° git ç”¨æˆ·æ‰€åœ¨å®¶ç›®å½•</span><span class="token builtin class-name">cd</span> ~  <span class="token comment"># ä¸‹è½½ gogs å‹ç¼©åŒ…</span><span class="token function">wget</span> https://dl.gogs.io/0.11.86/gogs_0.11.86_linux_amd64.tar.gz<span class="token comment"># è§£å‹ç¼© ï¼ˆè§£å‹ç¼©ä¹‹åçš„æ–‡ä»¶å¤¹åä¸º gogs ï¼‰</span><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> gogs_0.11.86_linux_amd64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ‰§è¡Œ gogs æ•°æ®åº“æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ‡æ¢åˆ° /home/git/gogs/scripts ç›®å½•</span><span class="token builtin class-name">cd</span> /home/git/gogs/scripts<span class="token comment"># ç™»å½•æ•°æ®åº“ ï¼ˆè¿™é‡Œé‡‡ç”¨ MySQL ï¼‰</span>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span><span class="token comment"># åˆ›å»º gogs ç”¨æˆ·</span>create user <span class="token string">'gogs'</span>@<span class="token string">'localhost'</span> identified by <span class="token string">'å¯†ç '</span><span class="token punctuation">;</span><span class="token comment"># èµ‹äºˆ gogs æ•°æ®åº“ç”¨æˆ·èƒ½å¤Ÿè®¿é—® gogs æ•°æ®åº“æ‰€æœ‰æƒé™</span>grant all privileges on gogs.* to <span class="token string">'gogs'</span>@<span class="token string">'localhost'</span><span class="token punctuation">;</span><span class="token comment"># åˆ·æ–°æƒé™</span>flush privileges<span class="token punctuation">;</span><span class="token comment"># æ‰§è¡Œ gogs æ•°æ®åº“è„šæœ¬æ–‡ä»¶ </span><span class="token builtin class-name">source</span> mysql.sql<span class="token comment"># æµ‹è¯•ï¼ˆæ‰§è¡Œå®Œäº†ä¹‹åå¯ä»¥çœ‹åˆ°å·²ç»åˆ›å»ºå¥½äº† gogs æ•°æ®åº“ï¼‰</span>show databases<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é…ç½®ä¸è¿è¡Œ</p></li></ol><ul><li>æ‰“å¼€ gogs æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /home/git/gogs/scripts/init/centos/gogs   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ ¸å¯¹æ–‡ä»¶ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">19</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/sbin:/usr/sbin:/bin:/usr/bin  <span class="token number">20</span> <span class="token assign-left variable">DESC</span><span class="token operator">=</span><span class="token string">"Gogs"</span>  <span class="token number">21</span> <span class="token assign-left variable">NAME</span><span class="token operator">=</span>gogs  <span class="token number">22</span> <span class="token assign-left variable">SERVICEVERBOSE</span><span class="token operator">=</span>yes  <span class="token number">23</span> <span class="token assign-left variable">PIDFILE</span><span class="token operator">=</span>/var/run/<span class="token variable">$NAME</span>.pid  <span class="token number">24</span> <span class="token assign-left variable">SCRIPTNAME</span><span class="token operator">=</span>/etc/init.d/<span class="token variable">$NAME</span>  <span class="token number">25</span> <span class="token assign-left variable">WORKINGDIR</span><span class="token operator">=</span>/home/git/gogs      <span class="token comment"># ä»“åº“åœ°å€ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹</span><span class="token number">26</span> <span class="token assign-left variable">DAEMON</span><span class="token operator">=</span><span class="token variable">$WORKINGDIR</span>/<span class="token variable">$NAME</span>  <span class="token number">27</span> <span class="token assign-left variable">DAEMON_ARGS</span><span class="token operator">=</span><span class="token string">"web"</span>  <span class="token number">28</span> <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span>git     <span class="token comment"># å¦‚æœè¿è¡Œ gogs ä¸æ˜¯åä¸º git çš„è´¦æˆ·ï¼Œåˆ™éœ€è¦ä¿®æ”¹ã€‚ </span><span class="token comment"># å¦‚æ˜¯ç”¨ root è´¦æˆ·è¿è¡Œ gogsï¼Œåˆ™è¿™é‡Œä¿®æ”¹æˆ root</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>åˆ‡æ¢åˆ° root è´¦æˆ·ï¼Œç„¶åå¤åˆ¶åˆ° /etc/init.d/ ç›®å½•ä¸‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ‡æ¢åˆ° root è´¦æˆ·</span><span class="token function">su</span> root<span class="token comment"># å°† gogs æ–‡ä»¶å¤åˆ¶åˆ° /etc/init.d ç›®å½•ä¸‹</span><span class="token function">sudo</span> <span class="token function">cp</span> /home/git/gogs/scripts/init/centos/gogs /etc/init.d/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¢åŠ æ‰§è¡Œæƒé™</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/init.d/gogs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¤åˆ¶ service</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /home/git/gogs/scripts/systemd/gogs.service /etc/systemd/system/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¼€å¯ gogs æœåŠ¡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> gogs start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è¿è¡Œ gogs web</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ‡æ¢åˆ° gogs ç›®å½•</span><span class="token builtin class-name">cd</span> /home/git/gogs<span class="token comment"># è¿è¡Œ gogs web ï¼ˆå¦‚æœæ­¤æ—¶ Ctrl + C å…³é—­æ‰å‘½ä»¤ï¼Œæ­¤æ—¶åˆ·æ–°æµè§ˆå™¨æ—¶ï¼Œä¼šæ— å†…å®¹ï¼‰</span><span class="token comment"># æ‰§è¡Œå‘½ä»¤åï¼Œçœ‹åˆ°æœ‰æ—¥å¿—è¾“å‡ºï¼Œåˆ™è¯æ˜å¯åŠ¨æˆåŠŸï¼</span>./gogs web<span class="token comment"># åå°è¿è¡Œ gogs</span>./gogs web <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¿…é¡»å¼€å¯ 3000 ç«¯å£ ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„ ECS ï¼Œç›´æ¥åœ¨é˜¿é‡Œäº‘åå°æ·»åŠ  3000 çš„å®‰å…¨ç»„è§„åˆ™å³å¯ï¼‰</p></li><li><p>æµ‹è¯•ã€‚ï¼ˆ æµè§ˆå™¨è®¿é—® http://è¿œç¨‹ä¸»æœº IP åœ°å€ :3000 ï¼‰</p></li></ul><ol start="5"><li>é…ç½®åå‘ä»£ç†</li></ol><ul><li>åœ¨ nginx é…ç½®æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º git.drling.xin.conf æ–‡ä»¶</li></ul><pre class="line-numbers language-none"><code class="language-none">vim /etc/nginx/conf.d/git.drling.xin.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¡«å…¥ä»¥ä¸‹å†…å®¹</li></ul><pre class="line-numbers language-none"><code class="language-none">server {    listen 80;    server_name git.drling.xin;    location / {            proxy_pass http://127.0.0.1:3000/;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>å…³äºè‡ªå®šä¹‰é…ç½®</li></ol><ul><li>ç¬¬ä¸€æ¬¡è®¿é—® <strong>http://è¿œç¨‹ä¸»æœº IP åœ°å€ :3000</strong> çš„æ—¶å€™ï¼Œä¼šæç¤ºä½ å¡«å…¥ä¸€äº›è‡ªå®šä¹‰é¡¹ï¼Œè¿™äº›è‡ªå®šä¹‰é¡¹ä¼šåœ¨ä½  <code>&lt;gogs path&gt;/custom/conf/app.ini</code> æ–‡ä»¶ä¸­ï¼Œåªæœ‰ä½ åœ¨ç½‘é¡µä¸­å¡«å…¥è‡ªå®šä¹‰é¡¹ä¹‹åæ‰ä¼šæœ‰æ­¤æ–‡ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆåœ¨ä½  <code>gogs</code> ç›®å½•ä¸‹åˆ›å»º <code>custom/conf/app.ini</code> æ–‡ä»¶ï¼Œç„¶åå¡«å…¥è‡ªå®šä¹‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">APP_NAME <span class="token operator">=</span> Semir-git<span class="token comment"># è¿™é‡Œçš„ç”¨æˆ·ååœ¨ Linux ç³»ç»Ÿä¸­å¿…é¡»å­˜åœ¨ï¼Œä¸”è¿™é‡Œçš„ç”¨æˆ·åä¸º ssh ä»“åº“åœ°å€çš„ç”¨æˆ·å</span>RUN_USER <span class="token operator">=</span> <span class="token function">git</span>RUN_MODE <span class="token operator">=</span> prod<span class="token comment"># ä»£ç ä»“åº“åœ°å€</span><span class="token punctuation">[</span>repository<span class="token punctuation">]</span>ROOT      <span class="token operator">=</span> /extend-disk/partition2/git-repositories<span class="token comment"># if you use nginx to proxy, suggest you set 127.0.0.1, otherwise you set 0.0.0.0 is ok</span>HTTP_ADDR <span class="token operator">=</span> <span class="token number">127.0</span>.0.1<span class="token punctuation">[</span>database<span class="token punctuation">]</span>DB_TYPE  <span class="token operator">=</span> mysqlHOST     <span class="token operator">=</span> <span class="token number">127.0</span>.0.1:3306NAME     <span class="token operator">=</span> gogs<span class="token environment constant">USER</span>     <span class="token operator">=</span> gogsPASSWD   <span class="token operator">=</span> <span class="token number">123456</span>SSL_MODE <span class="token operator">=</span> disable<span class="token environment constant">PATH</span>     <span class="token operator">=</span> data/gogs.db<span class="token punctuation">[</span>server<span class="token punctuation">]</span><span class="token comment"># ä»“åº“åŸŸåå¦‚ï¼šgit.drling.xin</span>DOMAIN           <span class="token operator">=</span> <span class="token number">10.90</span>.60.6HTTP_PORT        <span class="token operator">=</span> <span class="token number">3000</span><span class="token comment"># ä»“åº“ url å¦‚ï¼šhttp://git.drling.xin/</span>ROOT_URL         <span class="token operator">=</span> http://10.90.60.6:3000/DISABLE_SSH      <span class="token operator">=</span> <span class="token boolean">false</span>SSH_PORT         <span class="token operator">=</span> <span class="token number">22</span>START_SSH_SERVER <span class="token operator">=</span> <span class="token boolean">false</span>OFFLINE_MODE     <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">[</span>mailer<span class="token punctuation">]</span>ENABLED <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">[</span>service<span class="token punctuation">]</span>REGISTER_EMAIL_CONFIRM <span class="token operator">=</span> <span class="token boolean">false</span>ENABLE_NOTIFY_MAIL     <span class="token operator">=</span> <span class="token boolean">false</span>DISABLE_REGISTRATION   <span class="token operator">=</span> <span class="token boolean">false</span>ENABLE_CAPTCHA         <span class="token operator">=</span> <span class="token boolean">true</span>REQUIRE_SIGNIN_VIEW    <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">[</span>picture<span class="token punctuation">]</span>DISABLE_GRAVATAR        <span class="token operator">=</span> <span class="token boolean">false</span>ENABLE_FEDERATED_AVATAR <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">[</span>session<span class="token punctuation">]</span>PROVIDER <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">[</span>log<span class="token punctuation">]</span>MODE      <span class="token operator">=</span> console, <span class="token function">file</span>LEVEL     <span class="token operator">=</span> InfoROOT_PATH <span class="token operator">=</span> /extend-disk/partition2/software/gogs/log<span class="token punctuation">[</span>security<span class="token punctuation">]</span>INSTALL_LOCK <span class="token operator">=</span> <span class="token boolean">true</span>SECRET_KEY   <span class="token operator">=</span> 3WWzvF7wpDsBvvP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Gogs </tag>
            
            <tag> Git æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ä¹‹ç´¢å¼•ã€è§†å›¾ã€è§¦å‘å™¨</title>
      <link href="posts/b1cb609d.html"/>
      <url>posts/b1cb609d.html</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-ä¹‹ç´¢å¼•ã€è§†å›¾ã€è§¦å‘å™¨"><a href="#MySQL-ä¹‹ç´¢å¼•ã€è§†å›¾ã€è§¦å‘å™¨" class="headerlink" title="MySQL ä¹‹ç´¢å¼•ã€è§†å›¾ã€è§¦å‘å™¨"></a>MySQL ä¹‹ç´¢å¼•ã€è§†å›¾ã€è§¦å‘å™¨</h1><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><ul><li>ç´¢å¼•çš„å¼•å…¥</li></ul><p>ç´¢å¼•æ˜¯ç”±æ•°æ®åº“è¡¨ä¸­ä¸€åˆ—æˆ–è€…å¤šåˆ—ç»„åˆè€Œæˆï¼Œå…¶ä½œç”¨æ˜¯æé«˜å¯¹è¡¨ä¸­æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ï¼›ç±»ä¼¼äºå›¾ä¹¦çš„ç›®å½•ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½ï¼Œå¯»æ‰¾æŒ‡å®šçš„å†…å®¹ã€‚</p><ul><li>ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</li></ul><p>ä¼˜ç‚¹ï¼šæé«˜æŸ¥è¯¢æ•°æ®çš„é€Ÿåº¦<br>ç¼ºç‚¹ï¼šåˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•çš„æ—¶é—´å¢åŠ äº†</p><ul><li>å»ºç«‹ç´¢å¼•çš„å»ºè®®</li></ul><ol><li>ä¸€å¼ è¡¨å»ºè®®æœ€å¤šå»ºç«‹ 5 ä¸ªç´¢å¼•</li><li>å»ºç«‹å¤åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•å ç”¨ç©ºé—´å°ï¼‰</li></ol><ul><li>å»ºç«‹ç´¢å¼•çš„æŠ€å·§</li></ul><ol><li>å¦‚æœæ˜¯å·¦è¿æ¥åˆ™éœ€è¦åœ¨å³è¡¨å…³è”å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºå·¦è¡¨æ˜¯æŸ¥çš„å…¨éƒ¨æ•°æ®ã€‚å¦‚æœæ˜¯å³è¿æ¥åˆ™éœ€è¦åœ¨å·¦è¡¨å…³è”å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ã€‚</li><li>å°½å¯èƒ½å‡å°‘ join è¯­å¥ä¸­çš„ NestedLoop çš„å¾ªç¯æ€»æ¬¡æ•°ã€‚ï¼ˆæ°¸è¿œç”¨å°ç»“æœé›†é©±åŠ¨å¤§çš„ç»“æœé›†ï¼‰</li><li>ä¼˜å…ˆä¼˜åŒ– NestedLoop çš„å†…å±‚å¾ªç¯ã€‚</li><li>ä¿è¯ join è¯­å¥ä¸­è¢«é©±åŠ¨è¡¨ä¸Š join æ¡ä»¶å­—æ®µå·²ç»è¢«ç´¢å¼•ã€‚</li><li>å½“æ— æ³•ä¿è¯è¢«é©±åŠ¨è¡¨çš„ join æ¡ä»¶å­—æ®µè¢«ç´¢å¼•ä¸”å†…å­˜èµ„æºå……è¶³çš„å‰æä¸‹ï¼Œä¸è¦å¤ªåå•¬ JoinBuffer çš„è®¾ç½®ã€‚</li></ol><ul><li>ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åŸå› </li></ul><ol><li>æŸ¥è¯¢å…¨éƒ¨åˆ—ï¼Œä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼ˆselect *ï¼‰</li><li>ä¸éµå®ˆæœ€ä½³å·¦å‰ç¼€æ³•åˆ™ï¼ˆå¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”<strong>ä¸è·³è¿‡ç´¢å¼•çš„åˆ—</strong>ï¼‰</li><li>åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ã€å‡½æ•°ã€ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰ç±»å‹è½¬æ¢ï¼‰ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æ</li><li>å­˜å‚¨å¼•æ“ä½¿ç”¨äº†ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ï¼Œä¼šå¯¼è‡´ä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•</li><li>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆç´¢å¼•åˆ—å’ŒæŸ¥è¯¢åˆ—ä¸€è‡´ï¼‰ï¼‰ï¼Œå‡å°‘ select *</li><li>mysql åœ¨ä½¿ç”¨ä¸ç­‰äº ï¼ˆ!= æˆ– &lt;&gt;ï¼‰çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</li><li>is null,is not null ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•</li><li>like ä»¥é€šé…ç¬¦å¼€å¤´ ï¼ˆâ€™%abcâ€™ æˆ–è€… â€˜%abc%â€™ï¼‰mysql ç´¢å¼•å¤±æ•ˆä¼šå˜æˆå…¨è¡¨æ‰«æçš„æ“ä½œï¼Œå½“ç™¾åˆ†å·å†™åœ¨å³è¾¹çš„æ—¶å€™ç´¢å¼•ä¸ä¼šå¤±æ•ˆã€‚è§£å†³ â€˜%abc%â€™ ç´¢å¼•å¤±æ•ˆçš„æ–¹æ³•æ˜¯ï¼Œåœ¨è¦æ¨¡ç³ŠæŸ¥è¯¢å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ–¹å¼æŸ¥è¯¢ï¼Œåˆ™ç´¢å¼•åˆ™ä¸ä¼šå¤±æ•ˆã€‚</li><li>varchar ç±»å‹ ï¼ˆå­—ç¬¦ä¸²ï¼‰ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆï¼ˆå¦‚æœæ˜¯ InnoDB å­˜å‚¨ç±»å‹ï¼Œä¼šå¯¼è‡´è¡Œé”å˜è¡¨é”ï¼‰</li><li>å°‘ç”¨ orï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ç´¢å¼•ä¼šå¤±æ•ˆï¼Œå³ä½¿å…¶ä¸­çš„æ¡ä»¶å¸¦æœ‰ç´¢å¼•ä¹Ÿä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œå¦‚æœè¦æƒ³ä½¿ç”¨ orï¼Œåˆæƒ³è®©ç´¢å¼•ç”Ÿæ•ˆï¼Œåªèƒ½å°† or æ¡ä»¶ä¸­çš„æ¯ä¸€åˆ—éƒ½åŠ ä¸Šç´¢å¼•ã€‚å¦‚æœå‡ºç° or çš„è¯­å¥ä¸­æ²¡æœ‰ä¸€ä¸ªåˆ—åŠ äº†ç´¢å¼•ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ union æ‹¼æ¥å¤šä¸ªæŸ¥è¯¢è¯­å¥ã€‚</li><li>not in å’Œ not exist ä¸ä¼šèµ°ç´¢å¼•</li></ol><ul><li><p>ä¼˜åŒ–å£è¯€<br>å…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±ï¼Œæœ€å·¦å‰ç¼€è¦éµå®ˆï¼›<br>å¸¦å¤´å¤§å“¥ä¸èƒ½æ­»ï¼Œä¸­é—´å…„å¼Ÿä¸èƒ½æ–­ï¼›<br>ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—ï¼ŒèŒƒå›´ä¹‹åå…¨å¤±æ•ˆï¼›<br>likeç™¾åˆ†å†™æœ€å³ï¼Œè¦†ç›–ç´¢å¼•ä¸å†™*ï¼›<br>ä¸ç­‰ç©ºå€¼è¿˜æœ‰orï¼Œç´¢å¼•å¤±æ•ˆè¦å°‘ç”¨ã€‚</p></li><li><p>åˆ›å»ºç´¢å¼•çš„å‰æ</p></li></ul><p>ç´¢å¼•çš„æ•ˆç‡å–å†³äº<strong>ç´¢å¼•åˆ—çš„å€¼æ˜¯å¦ä¸ºæ•£åˆ—</strong>ï¼Œå³è¯¥åˆ—çš„å€¼å¦‚æœè¶Šäº’ä¸ç›¸åŒï¼Œé‚£ä¹ˆç´¢å¼•æ•ˆç‡è¶Šé«˜ã€‚åè¿‡æ¥ï¼Œå¦‚æœè®°å½•çš„åˆ—å­˜åœ¨å¤§é‡ç›¸åŒçš„å€¼ï¼Œä¾‹å¦‚ gender åˆ—ï¼Œå¤§çº¦ä¸€åŠçš„è®°å½•å€¼æ˜¯ Mï¼Œå¦ä¸€åŠæ˜¯ Fï¼Œå› æ­¤ï¼Œå¯¹è¯¥åˆ—åˆ›å»ºç´¢å¼•å°±æ²¡æœ‰æ„ä¹‰ã€‚åŒºåˆ†åº¦çš„å…¬å¼æ˜¯ <code>count(distinct col)/count(*)</code>ï¼Œè¡¨ç¤ºå­—æ®µä¸é‡å¤çš„æ¯”ä¾‹ï¼Œæ¯”ä¾‹è¶Šå¤§æˆ‘ä»¬æ‰«æçš„è®°å½•æ•°è¶Šå°‘ã€‚</p><p>å¯ä»¥å¯¹ä¸€å¼ è¡¨åˆ›å»ºå¤šä¸ªç´¢å¼•ã€‚ç´¢å¼•çš„ä¼˜ç‚¹æ˜¯æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼Œç¼ºç‚¹æ˜¯åœ¨æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤è®°å½•æ—¶ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹ç´¢å¼•ï¼Œå› æ­¤ï¼Œç´¢å¼•è¶Šå¤šï¼Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤è®°å½•çš„é€Ÿåº¦å°±è¶Šæ…¢ã€‚</p><p><em><strong>å¯¹äºä¸»é”®ï¼Œå…³ç³»æ•°æ®åº“ä¼šè‡ªåŠ¨å¯¹å…¶åˆ›å»ºä¸»é”®ç´¢å¼•ã€‚ä½¿ç”¨ä¸»é”®ç´¢å¼•çš„æ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå› ä¸ºä¸»é”®ä¼šä¿è¯ç»å¯¹å”¯ä¸€ã€‚</strong></em></p><ul><li>åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•ï¼š</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">-- åˆ›å»ºæ™®é€šç´¢å¼•CREATE TABLE t_user1 (id INT,userName VARCHAR (20),PASSWORD VARCHAR (20),INDEX (userName));-- åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•å¹¶ä¸ºç´¢å¼•å–åˆ«åCREATE TABLE t_user2 (id INT,userName VARCHAR (20),PASSWORD VARCHAR (20),UNIQUE INDEX usrn (userName));-- åˆ›å»ºå¤šåˆ—ç´¢å¼•CREATE TABLE t_user3 (id INT,userName VARCHAR (20),PASSWORD VARCHAR (20),INDEX index_user_pwd (userName,PASSWORD));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åœ¨å·²æœ‰è¡¨ä¸­åˆ›å»ºç´¢å¼•</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">-- åœ¨å·²æœ‰è¡¨ä¸­åˆ›å»ºæ™®é€šç´¢å¼•CREATE INDEX index_userName ON t_user4(userName);-- åœ¨å·²æœ‰è¡¨ä¸­åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•CREATE UNIQUE INDEX index_userName ON t_user4(userName);-- åœ¨å·²æœ‰è¡¨ä¸­åˆ›å»ºå¤šåˆ—ç´¢å¼•CREATE INDEX index_userName_pwd ON t_user4(userName,PASSWORD);// æˆ–è€…é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼ALTER TABLE studentsADD INDEX idx_name_score (name, score);-- ä½¿ç”¨ ALTER åˆ é™¤ç´¢å¼•ALTER TABLE t_user5 ADD INDEX index_user(userName)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹ç´¢å¼•</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">show index from table_name\G;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>åˆ é™¤ç´¢å¼•</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">-- åˆ é™¤ç´¢å¼•-- DROP INDEX ç´¢å¼•å ON è¡¨å;DROP INDEX index_user ON t_user5;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç´¢å¼•æ£€ç´¢åŸç†</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8dbf9172d1163963.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç´¢å¼•æ£€ç´¢åŸç†"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7b8ef85580ae6d04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç´¢å¼•çš„åˆ†æ"></p><ul><li>å“ªäº›æƒ…å†µä¸‹åº”è¯¥å»ºç«‹ç´¢å¼• ï¼Ÿ</li></ul><ol><li>ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•</li><li>é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼•</li><li>æŸ¥è¯¢ä¸­ä¸å…¶å®ƒè¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•</li><li>é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ï¼ˆå› ä¸ºæ¯æ¬¡æ›´æ–°ä¸å•å•æ˜¯æ›´æ–°äº†è®°å½•è¿˜ä¼šæ›´æ–°ç´¢å¼•ï¼‰</li><li>where æ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•</li><li>å•é”®ç´¢å¼•è¿˜æ˜¯ç»„åˆç´¢å¼•çš„é€‰æ‹©é—®é¢˜ï¼Ÿï¼ˆåœ¨é«˜å¹¶å‘ä¸‹å€¾å‘åˆ›å»ºç»„åˆç´¢å¼•ï¼‰</li><li>æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µï¼Œæ’åºå­—æ®µè‹¥é€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºé€Ÿåº¦</li><li>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–è€…åˆ†ç»„å­—æ®µ</li></ol><ul><li>å“ªäº›æƒ…å†µä¸‹ä¸è¦å»ºç«‹ç´¢å¼•ï¼Ÿ</li></ul><ol><li>è¡¨è®°å½•å¤ªå°‘</li><li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨</li><li>æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„è¡¨å­—æ®µï¼Œå› æ­¤åº”è¯¥åªä¸ºæœ€ç»å¸¸æŸ¥è¯¢å’Œæœ€ç»å¸¸æ’åºçš„æ•°æ®åˆ—å»ºç«‹ç´¢å¼•ã€‚æ³¨æ„ï¼šå¦‚æœæŸä¸ªæ•°æ®åˆ—åŒ…å«è®¸å¤šé‡å¤çš„å†…å®¹ï¼Œä¸ºå®ƒå»ºç«‹ç´¢å¼•å°±æ²¡æœ‰å¤ªå¤§çš„å®é™…æ•ˆæœã€‚</li></ol><h2 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h2><ul><li>è§†å›¾çš„å¼•å…¥</li></ul><ol><li>è¯•å›¾æ˜¯ä¸€ç§è™šæ‹Ÿçš„è¡¨ï¼Œæ˜¯ä»æ•°æ®åº“ä¸­ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¡¨ä¸­å¯¼å‡ºæ¥çš„è¡¨ã€‚</li><li>æ•°æ®åº“ä¸­åªå­˜æ”¾äº†è§†å›¾çš„å®šä¹‰ï¼Œè€Œå¹¶æ²¡æœ‰å­˜æ”¾è§†å›¾ä¸­çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å­˜æ”¾åœ¨åŸæ¥çš„è¡¨ä¸­ã€‚</li><li>ä½¿ç”¨è§†å›¾æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šä»åŸæ¥çš„è¡¨ä¸­å–å‡ºå¯¹åº”çš„æ•°æ®ã€‚</li></ol><ul><li>è§†å›¾çš„ä½œç”¨</li></ul><ol><li>ä½¿æ“ä½œç®€ä¾¿åŒ–ï¼›egï¼šå¦‚æœä¸€å¼ è¡¨ä¸­æœ‰ 100 ä¸ªå­—æ®µï¼Œéœ€æ±‚åªéœ€è¦ 20 ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå¯ä»¥å®šä¹‰ä¸€ä¸ªè§†å›¾åªå–å‡º 20 ä¸ªå­—æ®µã€‚</li><li>å¢åŠ æ•°æ®çš„å®‰å…¨æ€§ï¼›egï¼šå¦‚æœå†™ä»£ç çš„æ—¶å€™ä¸æƒ³è¦åˆ«äººçŸ¥é“æŸäº›å­—æ®µï¼Œé‚£ä¹ˆå¯ä»¥å®šä¹‰è§†å›¾ï¼Œåªå–å‡ºå®‰å…¨ç³»æ•°ä½çš„å­—æ®µ</li><li>æé«˜è¡¨çš„é€»è¾‘ç‹¬ç«‹æ€§ï¼›</li></ol><ul><li>åˆ›å»ºè§†å›¾</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE [ALGORITHM = {UNDEFIEND | MERGE | TEMPTABLE}]    VIEW è§†å›¾å [(å±æ€§æ¸…å•)]    AS SELECT è¯­å¥    [WITH [CASCADED | LOCAL] CHECK OPTION]    -- åˆ›å»ºå•è¡¨è§†å›¾CREATE VIEW v1 AS SELECT userName,password FROM t_user4-- åˆ›å»ºå•è¡¨è§†å›¾å¹¶ç»™è§†å›¾å­—æ®µå–åˆ«åCREATE VIEW v1(u,p) AS SELECT userName,password FROM t_user4-- æŸ¥è¯¢è§†å›¾ç»“æœSELECT * FROM v1-- åœ¨å¤šè¡¨ä¸Šåˆ›å»ºè§†å›¾CREATE VIEW v2 AS SELECT bookName.bookTypeName FROM t_book,t_booktype WHERE t_book.bookTypeId = t_booktype.id        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§¦å‘å™¨"><a href="#è§¦å‘å™¨" class="headerlink" title="è§¦å‘å™¨"></a>è§¦å‘å™¨</h2><ul><li>è§¦å‘å™¨çš„å¼•å…¥</li></ul><p>è§¦å‘å™¨ï¼ˆtriggerï¼‰æ˜¯ç”±äº‹ä»¶æ¥è§¦å‘æŸä¸ªæ“ä½œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬ insert è¯­å¥ã€ update è¯­å¥å’Œ delete è¯­å¥ã€‚å½“æ•°æ®åº“ç³»ç»Ÿæ‰§è¡Œè¿™äº›äº‹ä»¶æ—¶ï¼Œå°±ä¼šæ¿€æ´»è§¦å‘å™¨æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p><ul><li>åˆ›å»ºä¸ä½¿ç”¨è§¦å‘å™¨</li></ul><ol><li>åˆ›å»ºåªæœ‰ä¸€ä¸ªæ‰§è¡Œè¯­å¥çš„è§¦å‘å™¨</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TRIGGER è§¦å‘å™¨å BEFORE | AFTER è§¦å‘äº‹ä»¶ ON è¡¨å FOR EACH ROW æ‰§è¡Œè¯­å¥-- å…¶ä¸­ new å’Œ old ä¸ºè¿‡æ¸¡å˜é‡ï¼Œ new ä»£è¡¨æ–°çš„æ•°æ®ï¼Œold ä»£è¡¨æ—§çš„æ•°æ®egï¼šCREATE TRIGGER trig_book AFTER INSERTON t_book FOR EACH ROWUPDATE t_booktype SET bookNum=bookNum+1 WHERE new.bookTypeId=t_booktype.id-- æ‰§è¡Œä»¥ä¸‹è¯­å¥ä¹‹åå°†ä¼šè§¦å‘è§¦å‘å™¨INSERT INTO t_book VALUES(NULL,'phpå­¦ä¹ ',100,'ke',1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åˆ›å»ºæœ‰å¤šä¸ªæ‰§è¡Œè¯­å¥çš„è§¦å‘å™¨</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TRIGGER è§¦å‘å™¨å BEFORE | AFTER è§¦å‘äº‹ä»¶    ON è¡¨å FOR EACH ROW    BEGIN        æ‰§è¡Œè¯­å¥åˆ—è¡¨    END  -- å…¶ä¸­ï¼Œå› ä¸º mysql é‡åˆ°åˆ†å·ï¼ˆ;ï¼‰ä¹‹åä¼šè®¤ä¸ºè¯­å¥ç»ˆæ­¢ï¼ˆåˆ†å·å‰é¢çš„è¯­å¥ä¸ºæ‰§è¡Œè¯­å¥ï¼‰ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ delimiter æ¥æ‰‹åŠ¨å®šä¹‰åœ¨ | ç¬¦å·ä¸­é—´çš„è¯­å¥æ‰ä¸ºæ‰§è¡Œè¯­å¥   egï¼šdelimiter |CREATE TRIGGER trig_book2 AFTER DELETEON t_book FOR EACH ROWBEGIN UPDATE t_booktype SET bookNum=bookNum-1 WHERE old.bookTypeId=t_booktype.id;INSERT INTO t_log VALUES (NULL,NULL,'åœ¨bookè¡¨é‡Œåˆ é™¤äº†ä¸€æ¡æ•°æ®');DELETE FROM t_test WHERE old.bookTypeId=t_test.id;END|delimiter;-- æ‰§è¡Œä»¥ä¸‹è¯­å¥ä¹‹åå°†ä¼šè§¦å‘è§¦å‘å™¨DELETE FROM t_book WHERE id=3;    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹è§¦å‘å™¨</li></ul><ol><li>ç›´æ¥æ‰§è¡Œ sql è¯­å¥</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW TRIGGERS;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨ç³»ç»Ÿæ•°æ®åº“ä¸­ information_schema åº“ä¸­æŸ¥çœ‹ TRIGGERS è¡¨</li></ol><ul><li>åˆ é™¤è§¦å‘å™¨</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP TRIGGER [è§¦å‘å™¨å];eg:DROP TRIGGER trig_book2;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> ç´¢å¼• </tag>
            
            <tag> è§†å›¾ </tag>
            
            <tag> è§¦å‘å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL æ€§èƒ½åˆ†æ</title>
      <link href="posts/1e4459df.html"/>
      <url>posts/1e4459df.html</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-æ€§èƒ½åˆ†æ"><a href="#MySQL-æ€§èƒ½åˆ†æ" class="headerlink" title="MySQL æ€§èƒ½åˆ†æ"></a>MySQL æ€§èƒ½åˆ†æ</h1><h2 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">explain select * from users;-- æœ¬æ„ä¸ºæ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚ä½†æ˜¯å’Œ explain ä¸€å—å„¿ä½¿ç”¨ï¼Œå°±ä¼šæ˜¾ç¤ºå‡ºä¼˜åŒ–åçš„ sqlã€‚éœ€è¦æ³¨æ„ä½¿ç”¨é¡ºåºã€‚ï¼ˆåªèƒ½åœ¨ mysql cli ä¸­æ‰ä¼šæœ‰ç»“æœï¼‰show warnings;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æœ€é‡è¦çš„ 5 ä¸ªå­—æ®µæ˜¯ï¼šidã€typeã€keyã€rowsã€Extra</p></blockquote><ul><li><strong>id</strong>ï¼š select æŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œ select å­å¥æˆ–æ“ä½œè¡¨çš„é¡ºåº</li></ul><ol><li>id ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹</li><li>id ä¸åŒï¼Œå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œid çš„åºå·ä¼šé€’å¢ï¼Œid å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ</li><li>id æœ‰ç›¸åŒä¹Ÿæœ‰ä¸åŒçš„ï¼Œid å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜è¶Šå…ˆè¢«æ‰§è¡Œï¼Œid å€¼ç›¸åŒçš„æŒ‰ç”±ä¸Šåˆ°ä¸‹æ‰§è¡Œ</li></ol><ul><li><strong>select_type</strong>ï¼šæŸ¥è¯¢çš„ç±»å‹ï¼Œä¸»è¦æ˜¯ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ï¼Œè”åˆæŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢</li></ul><ol><li>simple ï¼š ç®€å•çš„ select æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€… union</li><li>primary ï¼šæŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨ä»½ï¼Œæœ€ å¤–å±‚æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸º primary</li><li>subquery ï¼š åœ¨ select æˆ– where åˆ—è¡¨ä¸­åŒ…å«å­æŸ¥è¯¢</li><li>derived ï¼š åœ¨ from åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º derivedï¼ˆè¡ç”Ÿï¼‰MySQL ä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚</li><li>union ï¼š è‹¥ç¬¬äºŒä¸ª select å‡ºç°åœ¨ union ä¹‹åï¼Œåˆ™è¢«æ ‡è®°ä¸º unionï¼šè‹¥ union åŒ…å«åœ¨ from å­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚ select å°†è¢«æ ‡è®°ä¸ºï¼š derived</li><li>union result ï¼š ä» union è¡¨è·å–ç»“æœçš„ select</li></ol><ul><li><strong>table</strong> ï¼š æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„</li><li><strong>type</strong> ï¼š è®¿é—®ç±»å‹æ’åº<ul><li>å¸¸ç”¨çš„ä»æœ€å¥½åˆ°æœ€å·®ä¾æ¬¡æ˜¯ï¼Œsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</li><li>å®Œæ•´çš„ä»æœ€å¥½åˆ°æœ€å·®ä¾æ¬¡æ˜¯ system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; ALL</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œ å¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° range çº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ° ref çº§åˆ«</li></ul></li></ul><ol><li>system ï¼šè¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯ const ç±»å‹çš„ç‰¹ä¾‹ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡</li><li>const ï¼š è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconst ç”¨äºæ¯”è¾ƒ primary key æˆ–è€… unique ç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äº where åˆ—è¡¨ä¸­ï¼ŒMySQL å°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡</li><li>eq_ref : å”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æã€‚</li><li>ref ï¼š éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œï¼Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä»–åº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚</li><li>range ï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œï¼Œkey åˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„ where è¯­å¥ä¸­å‡ºç°äº† between ã€&lt; ã€&gt; ã€in ç­‰çš„æŸ¥è¯¢ã€‚è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ‰«ææ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸäºå¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•</li><li>index ï¼š Full Index Scanï¼ŒIndex ä¸ ALL åŒºåˆ«ä¸º index ç±»å‹åªéå†ç´¢å¼•æ ‘ã€‚è¿™é€šå¸¸æ¯” ALL å¿«ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´è™½ç„¶ all å’Œ index éƒ½æ˜¯è¯»å…¨è¡¨ï¼Œä½† index æ˜¯ä»ç´¢å¼•ä¸­è¯»å–çš„ï¼Œè€Œ all æ˜¯ä»ç¡¬ç›˜ä¸­è¯»çš„ï¼‰</li><li>all ï¼š Full Table Scanï¼Œå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ</li></ol><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° range çº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ° ref</strong></p><ul><li><strong>possible_keys</strong> ï¼šæ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œ<strong>ä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨</strong></li><li><strong>key</strong> ï¼š å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸º nullï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨ key åˆ—è¡¨ä¸­ã€‚</li><li><strong>key_len</strong> : è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚key_len æ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³ key_len æ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„</li><li><strong>ref</strong> ï¼š æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</li><li><strong>rows</strong> ï¼šæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ï¼ˆè¡Œæ•°è¶Šå°è¶Šå¥½ï¼‰</li><li><strong>Extra</strong> ï¼šåŒ…å«ä¸é€‚åˆåœ¨å…¶å®ƒåˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯</li></ul><ol><li>Using filesort ï¼š è¯´æ˜ mysql ä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MySQL ä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€ã€‚<strong>ä¹æ­»ä¸€ç”Ÿäº†ï¼Œæ•ˆç‡æ¯”è¾ƒå·®</strong></li><li>Using temporary ï¼šä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQL åœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸ç”¨äºæ’åº order by å’Œåˆ†ç»„æŸ¥è¯¢ group byã€‚<strong>åæ­»æ— ç”Ÿï¼Œæ•ˆç‡æœ€å·®ï¼</strong></li><li>Using index ï¼š è¡¨ç¤ºç›¸åº”çš„ select æ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆCovering indexï¼‰ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ï¼å¦‚æœåŒæ—¶å‡ºç° using where ï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç° using where ï¼Œè¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚</li><li>Using where ï¼šè¡¨æ˜ä½¿ç”¨äº† where è¿‡æ»¤</li><li>using join buffer ï¼šä½¿ç”¨äº†è¿æ¥ç¼“å­˜</li><li>impossible where ï¼š where å­å¥çš„å€¼æ€»æ˜¯ falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„</li><li>select tables optimized away ï¼šåœ¨æ²¡æœ‰ group by å­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ– min/max æ“ä½œæˆ–è€…å¯¹äº MyISAM å­˜å‚¨å¼•æ“ä¼˜åŒ– count(*) æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆçš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–ã€‚</li><li>distinct ï¼šä¼˜åŒ– distinct æ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œ</li></ol><h2 id="æŸ¥è¯¢æˆªå–åˆ†æ"><a href="#æŸ¥è¯¢æˆªå–åˆ†æ" class="headerlink" title="æŸ¥è¯¢æˆªå–åˆ†æ"></a>æŸ¥è¯¢æˆªå–åˆ†æ</h2><ul><li>é€šä¿—æ¥è®²</li></ul><ol><li>è§‚å¯Ÿï¼Œè‡³å°‘è·‘ 1 å¤© ï¼Œçœ‹çœ‹ç”Ÿäº§çš„æ…¢ sql æƒ…å†µã€‚</li><li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½®é˜ˆå€¼ï¼Œæ¯”å¦‚è¶…è¿‡ 5 ç§’é’Ÿçš„å°±æ˜¯æ…¢ sqlï¼Œå¹¶å°†å®ƒæŠ“å–å‡ºæ¥ã€‚</li><li>explain + æ…¢ sql åˆ†æ</li><li>show profile</li><li>è¿ç»´ç»ç†æˆ–è€… DBAï¼Œè¿›è¡Œ sql æ•°æ®åº“æœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜ã€‚</li></ol><ul><li>å­¦æœ¯è¯´æ³•</li></ul><ol><li>æ…¢æŸ¥è¯¢çš„å¼€å¯å¹¶æ•è·</li><li>explain + æ…¢ sql åˆ†æ</li><li>show profile æŸ¥è¯¢ sql åœ¨ mysql æœåŠ¡å™¨é‡Œé¢çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µ</li><li>sql æ•°æ®åº“æœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜</li></ol><h3 id="æé«˜-order-by-çš„é€Ÿåº¦"><a href="#æé«˜-order-by-çš„é€Ÿåº¦" class="headerlink" title="æé«˜ order by çš„é€Ÿåº¦"></a>æé«˜ order by çš„é€Ÿåº¦</h3><ol><li>order by æ—¶ï¼Œselect * æ˜¯ä¸€ä¸ªå¤§å¿Œï¼ŒåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œè¿™ç‚¹éå¸¸é‡è¦ã€‚åœ¨è¿™é‡Œçš„å½±å“æ˜¯ï¼š</li></ol><ul><li>å½“æŸ¥è¯¢çš„å­—æ®µå¤§å°æ€»å’Œå°äº max_length_for_sort_data è€Œä¸”æ’åºå­—æ®µä¸æ˜¯ text|blob ç±»å‹æ—¶ï¼Œä¼šç”¨æ”¹è¿›åçš„ç®—æ³•â€”â€”å•è·¯æ’åºï¼Œå¦åˆ™ç”¨è€ç®—æ³•â€”â€”å¤šè·¯æ’åºã€‚</li><li>ä¸¤ç§ç®—æ³•çš„æ•°æ®éƒ½æœ‰å¯èƒ½è¶…å‡º sort_buffer çš„å®¹é‡ï¼Œè¶…å‡ºä¹‹åï¼Œä¼šåˆ›å»º tmp æ–‡ä»¶è¿›è¡Œåˆå¹¶æ’åºï¼Œå¯¼è‡´å¤šæ¬¡ I/Oï¼Œä½†æ˜¯ç”¨å•è·¯æ’åºç®—æ³•çš„é£é™©ä¼šæ›´å¤§ä¸€äº›ï¼Œæ‰€ä»¥è¦æé«˜ sort_buffer_size</li></ul><ol start="2"><li>å°è¯•æé«˜ sort_buffer_size ä¸ç®¡ç”¨å“ªç§ç®—æ³•ï¼Œæé«˜è¿™ä¸ªå‚æ•°éƒ½ä¼šæé«˜æ•ˆç‡ï¼Œå½“ç„¶ï¼Œè¦æ ¹æ®ç³»ç»Ÿçš„èƒ½åŠ›å»æé«˜ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿›ç¨‹çš„</li><li>å°è¯•æé«˜ max_length_for_sort_data æé«˜è¿™ä¸ªå‚æ•°ï¼Œä¼šå¢åŠ ç”¨æ”¹è¿›ç®—æ³•çš„æ¦‚ç‡ï¼Œä½†æ˜¯å¦‚æœè®¾çš„å¤ªé«˜ï¼Œæ•°æ®æ€»å®¹é‡è¶…å‡º sort_buffer_size çš„æ¦‚ç‡å°±å¢å¤§ï¼Œæ˜æ˜¾ç—‡çŠ¶æ˜¯é«˜çš„ç£ç›˜ I/O æ´»åŠ¨å’Œä½çš„å¤„ç†å™¨ä½¿ç”¨ç‡ã€‚</li></ol><h3 id="ä¸ºæ’åºä½¿ç”¨ç´¢å¼•"><a href="#ä¸ºæ’åºä½¿ç”¨ç´¢å¼•" class="headerlink" title="ä¸ºæ’åºä½¿ç”¨ç´¢å¼•"></a>ä¸ºæ’åºä½¿ç”¨ç´¢å¼•</h3><ul><li>MySQL ä¸¤ç§æ’åºæ–¹å¼ï¼šæ–‡ä»¶æ’åºæˆ–æ‰«ææœ‰åºç´¢å¼•æ’åº</li><li>MySQL èƒ½ä¸ºæ’åºä¸æŸ¥è¯¢ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•</li></ul><p>KEY a_b_c (a,b,c)</p><ol><li>order by èƒ½ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰ç¼€<br>ORDER BY a<br>ORDER BY a,b<br>ORDER BY a,b,c<br>ORDER BY a DESC, b DESC, c DESC</li><li>å¦‚æœ where ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€å®šä¹‰ä¸ºå¸¸é‡ï¼Œåˆ™ order by èƒ½ä½¿ç”¨ç´¢å¼•<br>WHERE a = const ORDER BY b,c<br>WHERE a = const AND b = const ORDER BY c<br>WHERE a = const ORDER BY b,c<br>WHERE a = const AND b &gt; const ORDER BY b,c</li></ol><h2 id="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"></a>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</h2><ul><li>æŸ¥çœ‹æ˜¯å¦å¼€å¯åŠå¦‚ä½•å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</li></ul><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—show variables like '%slow_query_log%';# å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆä¸´æ—¶å¼€å¯ï¼‰set global slow_query_log = 1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œå°±å¿…é¡»ä¿®æ”¹é…ç½®æ–‡ä»¶ my.cnf ï¼ˆå…¶ä»–ç³»ç»Ÿå˜é‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰<br>ä¿®æ”¹ my.cnf æ–‡ä»¶ï¼Œ[mysqld] ä¸‹å¢åŠ æˆ–ä¿®æ”¹å‚æ•° slow_query_log å’Œ slow_query_log_file åï¼Œç„¶åé‡å¯ MySQL æœåŠ¡å™¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">slow_query_log = 1 slow_query_log_file = /var/lib/mysql/slow-query.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ç”±å‚æ•° long_query_time æ§åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ long_query_time çš„å€¼ä¸º 10 ç§’ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</p><pre class="line-numbers language-none"><code class="language-none">show variables like 'long_query_time%';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨ my.cnf å‚æ•°é‡Œé¢ä¿®æ”¹ã€‚<br>å‡å¦‚è¿è¡Œæ—¶é—´æ­£å¥½ç­‰äº long_query_time çš„æƒ…å†µï¼Œå¹¶ä¸ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ mysql æºç é‡Œæ˜¯ <strong>åˆ¤æ–­å¤§äº long_query_timeï¼Œè€Œéå¤§äºç­‰äº</strong></p><p>è®¾ç½®é˜™å€¼åˆ° 3 ç§’é’Ÿçš„å°±æ˜¯æ…¢ sql</p><pre class="line-numbers language-none"><code class="language-none">set global long_query_time = 3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—é˜™å€¼åçœ‹ä¸å‡ºå˜åŒ–ï¼Ÿ</p><ol><li>éœ€è¦é‡æ–°è¿æ¥æˆ–æ–°å¼€ä¸€ä¸ªä¼šè¯æ‰èƒ½çœ‹åˆ°ä¿®æ”¹å€¼</li><li>æˆ–è€…ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹Ÿå¯ä»¥çœ‹åˆ°ä¿®æ”¹åçš„ç»“æœ</li></ol><pre class="line-numbers language-none"><code class="language-none">show global variables like 'long_query_time';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚ä½•æµ‹è¯•ï¼Ÿ</p><pre class="line-numbers language-none"><code class="language-none"># æ¨¡æ‹ŸæŸ¥è¯¢è¶…è¿‡ 4 ç§’é’Ÿselect sleep(4);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†æœ‰å¤šå°‘æ¡æ…¢ sql</p><pre class="line-numbers language-none"><code class="language-none">show global status like '%Slow_queries%';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ…¢æŸ¥è¯¢åˆ†æå·¥å…·-mysqldumpslow"><a href="#æ…¢æŸ¥è¯¢åˆ†æå·¥å…·-mysqldumpslow" class="headerlink" title="æ…¢æŸ¥è¯¢åˆ†æå·¥å…· mysqldumpslow"></a>æ…¢æŸ¥è¯¢åˆ†æå·¥å…· mysqldumpslow</h3><p>å¯ç”¨å‚æ•°ï¼š</p><ul><li>s : è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åº</li><li>c ï¼šè®¿é—®æ¬¡æ•°</li><li>l ï¼šé”å®šæ—¶é—´</li><li>r ï¼šè¿”å›è®°å½•</li><li>t ï¼šæŸ¥è¯¢æ—¶é—´</li><li>al ï¼šå¹³å‡é”å®šæ—¶é—´</li><li>ar ï¼šå¹³å‡è¿”å›è®°å½•æ•°</li><li>at ï¼šå¹³å‡æŸ¥è¯¢æ—¶é—´</li><li>t ï¼šå³è¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®</li><li>g ï¼šåè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„</li></ul><pre class="line-numbers language-none"><code class="language-none"># å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„ 10 æ¡ sqlmysqldumpslow -s r -t 10 /var/lib/mysql/slow-query.log# å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„ 10 æ¡ sqlmysqldumpslow -s c -t 10 /var/lib/mysql/slow-query.log# å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰ 10 æ¡é‡Œé¢åŒ…å«å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥mysqldumpslow -s t -t 10 -g "left join" /var/lib/mysql/slow-query.logå¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œ more ä½¿ç”¨ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µmysqldumpslow -s r -t 10 /var/lib/mysql/slow-query.log | more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Show-Profile-ï¼ˆå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡-sql-æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼‰"><a href="#Show-Profile-ï¼ˆå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡-sql-æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼‰" class="headerlink" title="Show Profile ï¼ˆå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡ sql æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼‰"></a>Show Profile ï¼ˆå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡ sql æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼‰</h2><p>æ˜¯ mysql æä¾›å¯ä»¥ç”¨æ¥åˆ†æå½“å‰ä¼šè¯ä¸­è¯­å¥æ‰§è¡Œçš„èµ„æºæ¶ˆè€—æƒ…å†µã€‚å¯ä»¥ç”¨äº sql çš„è°ƒä¼˜çš„æµ‹é‡ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¤„äºå…³é—­çŠ¶æ€ï¼Œå¹¶ä¿å­˜æœ€è¿‘ 15 æ¬¡çš„è¿è¡Œç»“æœã€‚</p><ol><li>æŸ¥çœ‹æ˜¯å¦å·²ç»å¼€å¯</li></ol><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹æ˜¯å¦å·²ç»å¼€å¯show VARIABLES like 'profiling';# å¦‚æœæ²¡æœ‰å¼€å¯çš„è¯ï¼Œåˆ™å¼€å¯set profiling = on;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è¿è¡Œå„ç§æŸ¥è¯¢è¯­å¥</li><li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯çœ‹åˆ°ä»¥ä¸Šçš„æŸ¥è¯¢è¯­å¥</li></ol><pre class="line-numbers language-none"><code class="language-none">show profiles;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>è¯Šæ–­ sql</li></ol><pre class="line-numbers language-none"><code class="language-none">show profile cpu,block io for query 1;ï¼ˆä¸Šä¸€æ­¥é—®é¢˜ sql å‰é¢çš„æ•°å­—å·ç ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>show profile çš„å¯ç”¨å‚æ•°ä¸ºï¼š</p><ul><li>all ï¼šæ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯</li><li>block io ï¼šæ˜¾ç¤ºå— io ç›¸å…³å¼€é”€</li><li>context switches ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸å…³å¼€é”€</li><li>cpu ï¼šæ˜¾ç¤º cpu ç›¸å…³å¼€é”€ä¿¡æ¯</li><li>ipc ï¼šæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶ç›¸å…³å¼€é”€ä¿¡æ¯</li><li>memory ï¼šæ˜¾ç¤ºå†…å­˜ç›¸å…³å¼€é”€ä¿¡æ¯</li><li>page faults ï¼š æ˜¾ç¤ºé¡µé¢é”™è¯¯ç›¸å…³å¼€é”€ä¿¡æ¯</li><li>source ï¼šæ˜¾ç¤ºå’Œ Source_functionï¼ŒSource_fileï¼ŒSource_line ç›¸å…³çš„å¼€é”€ä¿¡æ¯</li><li>swaps ï¼šæ˜¾ç¤ºäº¤æ¢æ¬¡æ•°ç›¸å…³å¼€é”€çš„ä¿¡æ¯</li></ul><h3 id="æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„é¡¹"><a href="#æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„é¡¹" class="headerlink" title="æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„é¡¹"></a>æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„é¡¹</h3><ol><li>converting HEAP to MyISAM æŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œå†…å­˜éƒ½ä¸å¤Ÿç”¨äº†å¾€ç£ç›˜ä¸Šæ¬äº†ã€‚</li><li>Creating tmp table åˆ›å»ºä¸´æ—¶è¡¨ã€‚ï¼ˆæ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œç”¨å®Œå†åˆ é™¤ï¼‰</li><li>Copying to tmp table on disk æŠŠå†…å­˜ä¸­ä¸´æ—¶è¡¨å¤åˆ¶åˆ°ç£ç›˜ï¼Œå±é™©ï¼</li><li>locked é”è¡¨äº†</li></ol><h2 id="å…¨å±€æŸ¥è¯¢æ—¥å¿—"><a href="#å…¨å±€æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="å…¨å±€æŸ¥è¯¢æ—¥å¿—"></a>å…¨å±€æŸ¥è¯¢æ—¥å¿—</h2><blockquote><p>æ°¸è¿œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼</p></blockquote><ul><li>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯<br>åœ¨ mysql çš„ my.cnf ä¸­ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-none"><code class="language-none"># å¼€å¯general_log = 1# è®°å½•æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„general_log_file = /path/logfile# è¾“å‡ºæ ¼å¼log_output = FILE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç›´æ¥æ‰§è¡Œ sql è¯­å¥å¼€å¯</li></ul><pre class="line-numbers language-none"><code class="language-none"># å¼€å¯set global general_log=1;# ç”¨è¡¨æ ¼çš„æ–¹å¼è®°å½•æŸ¥è¯¢æ—¥å¿—set global log_output = 'TABLE';# æ­¤åï¼Œä½ æ‰€ç¼–å†™çš„ sql è¯­å¥ï¼Œå°†ä¼šè®°å½•åˆ° mysql åº“é‡Œçš„ general_log è¡¨select * from mysql.general_log;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> explain </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL æ‰§è¡ŒåŠ è½½é¡ºåº</title>
      <link href="posts/3b8d5b86.html"/>
      <url>posts/3b8d5b86.html</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-æ‰§è¡ŒåŠ è½½é¡ºåº"><a href="#MySQL-æ‰§è¡ŒåŠ è½½é¡ºåº" class="headerlink" title="MySQL æ‰§è¡ŒåŠ è½½é¡ºåº"></a>MySQL æ‰§è¡ŒåŠ è½½é¡ºåº</h1><blockquote><p>è¿™ç¯‡æ–‡ç« ç®—æ˜¯ â€œæ°´â€ ä¸€ä¸‹å§ï¼Œæœ¬æƒ³ä»¥æ–‡å­—çš„æ–¹å¼å±•ç¤ºå‡ºæ¥çš„ï¼Œå‘ç°ä»¥æ–‡å­—çš„æ–¹å¼å†™å‡ºæ¥å¤ªä¹±äº†ï¼Œåˆšå¥½æ‰¾åˆ°äº†å‡ å¼ æˆªå›¾ï¼Œç´¢æ€§å°±ç›´æ¥æˆªå›¾äº†ã€‚æˆªå›¾ä¹Ÿæ›´åŠ æ¸…æ™°æ˜äº†ã€‚</p></blockquote><ul><li>MySQL æ‰‹å†™ sql æ—¶çš„è¯­å¥</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c265c44851c61cbe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MySQL æ‰‹å†™ sql æ—¶çš„è¯­å¥"></p><ul><li>MySQL æœºè¯» sql é¡ºåº</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f245cb1b54a6a9a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MySQL æœºè¯» sql é¡ºåº"></p><ul><li>MySQL æ‰§è¡Œé¡ºåº</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9c169ebd6af288dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MySQL æ‰§è¡Œé¡ºåº"></p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL é”æœºåˆ¶</title>
      <link href="posts/eee5658b.html"/>
      <url>posts/eee5658b.html</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-é”æœºåˆ¶"><a href="#MySQL-é”æœºåˆ¶" class="headerlink" title="MySQL é”æœºåˆ¶"></a>MySQL é”æœºåˆ¶</h1><h2 id="é”çš„æ¦‚å¿µ"><a href="#é”çš„æ¦‚å¿µ" class="headerlink" title="é”çš„æ¦‚å¿µ"></a>é”çš„æ¦‚å¿µ</h2><ul><li><p>ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»/å†™ï¼‰æ¥åˆ†</p><ul><li>è¯»é”ï¼ˆå…±äº«é”ï¼‰ï¼šé’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ã€‚</li><li>å†™é”ï¼ˆæ’å®ƒé”ï¼‰ï¼šå½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚</li></ul></li><li><p>é”ç›¸å…³å‘½ä»¤</p></li></ul><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹æ˜¯å¦æœ‰è¡¨å·²ç»è¢«ä¸Šé”show open tables;# ç»™ table1 ä¸Šè¯»é”ï¼Œç»™ table2 ä¸Šå†™é”lock table table1 read,table2 write;# ç»™æ‰€æœ‰è¡¨è§£é”unlock tables;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¡¨é”ï¼ˆåå‘äº-MyISAMï¼‰"><a href="#è¡¨é”ï¼ˆåå‘äº-MyISAMï¼‰" class="headerlink" title="è¡¨é”ï¼ˆåå‘äº MyISAMï¼‰"></a>è¡¨é”ï¼ˆåå‘äº MyISAMï¼‰</h3><p>ç»™è¡¨åŠ <strong>è¯»</strong>é”çš„æƒ…å†µï¼š</p><ol><li>session-1</li></ol><pre class="line-numbers language-none"><code class="language-none"># å¯¹ table1 åŠ è¯»é”lock table table1 read; # å› ä¸ºè¯»é”æ˜¯å…±äº«é”ï¼Œå› æ­¤å¯ä»¥æŸ¥å‡ºæ•°æ®select * from table1;# ä½†æ˜¯æ— æ³•ä¿®æ”¹å’Œæ’å…¥æ–°æ•°æ®update table1 set name = 'a1' where id = 1;# ä½†æ˜¯ä¸èƒ½è¯»å–å…¶ä»–çš„è¡¨select * from table2;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>session-2</li></ol><pre class="line-numbers language-none"><code class="language-none"># å› ä¸ºè¯»é”æ˜¯å…±äº«é”ï¼Œå› æ­¤å¯ä»¥æŸ¥å‡ºæ•°æ®select * from table1;# ä¹Ÿå¯ä»¥è¯»å…¶ä»–çš„è¡¨select * from table2;# å½“ session-2 æƒ³è¦ä¿®æ”¹ session-1 å·²ç»é”çš„è¡¨ table1 æ—¶ï¼Œå·²ç»è¢«é˜»å¡ï¼Œéœ€è¦ç­‰åˆ° table1 è¢«è§£é”ä¹‹åæ‰å¯ä»¥å°†æ•°æ®æ›´æ–°update table1 set name = 'a1' where id = 1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»™è¡¨åŠ <strong>å†™</strong>é”çš„æƒ…å†µï¼š</p><ol><li>session-1</li></ol><pre class="line-numbers language-none"><code class="language-none"># ç»™ table1 åŠ å†™é”lock table table1 write;# èƒ½å¤ŸæŸ¥è¯¢ table1select * from table1;# è‡ªå·±èƒ½å¤Ÿæ›´æ–° table1 çš„æ•°æ®update table1 set name = 'a1' where id = 1;# ä½†æ˜¯ä¸èƒ½è¯»å–å…¶ä»–çš„è¡¨select * from table2;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>session-2</li></ol><pre class="line-numbers language-none"><code class="language-none"># å¯ä»¥æŸ¥è¯¢å…¶ä»–æ²¡æœ‰ä¸Šå†™é”çš„è¡¨select * from table2;# æŸ¥è¯¢ session-1 ä¸­å·²ç»ä¸Šå†™é”çš„ table1 æ—¶ï¼Œä¼šå‘ç”Ÿé˜»å¡ï¼Œéœ€è¦ç­‰åˆ° session-1 å°† table1 è§£é”æ‰ä¼šæŸ¥å¾—å‡ºæ¥ç»“æœselect * from table1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MyISAM åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ ï¼ˆselectï¼‰ å‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œå‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ã€‚<br>MySQLçš„è¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼ï¼š<br>è¡¨å…±äº«è¯»é”ï¼ˆTable Read Lockï¼‰<br>è¡¨ç‹¬å å†™é”ï¼ˆTable Write Lockï¼‰</p><table><thead><tr><th>é”ç±»å‹</th><th>å¯å¦å…¼å®¹</th><th>è¯»é”</th><th>å†™é”</th></tr></thead><tbody><tr><td>è¯»é”</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>å†™é”</td><td>æ˜¯</td><td>å¦</td><td>å¦</td></tr></tbody></table><p><strong>ç»“è®º</strong><br>ç»“åˆä¸Šè¡¨ï¼Œæ‰€æœ‰å¯¹ MyISAM è¡¨è¿›è¡Œæ“ä½œï¼Œä¼šæœ‰ä»¥ä¸‹æƒ…å†µï¼š</p><ol><li>å¯¹ MyISAM è¡¨çš„è¯»æ“ä½œï¼ˆåŠ è¯»é”ï¼‰ï¼Œä¸ä¼šé˜»å¡å…¶ä»–è¿›ç¨‹å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚ã€‚åªæœ‰å½“è¯»é”é‡Šæ”¾åï¼Œæ‰ä¼šæ‰§è¡Œå…¶å®ƒè¿›ç¨‹çš„å†™æ“ä½œã€‚</li><li>å¯¹ MyISAM è¡¨çš„å†™æ“ä½œï¼ˆåŠ å†™é”ï¼‰ï¼Œä¼šé˜»å¡å…¶ä»–è¿›ç¨‹å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œï¼Œåªæœ‰å½“å†™é”é‡Šæ”¾åï¼Œæ‰ä¼šæ‰§è¡Œå…¶ä»–è¿›ç¨‹çš„è¯»å†™æ“ä½œã€‚</li></ol><p><strong>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»é”ä¼šé˜»å¡å†™ï¼Œä½†æ˜¯ä¸ä¼šé˜»å¡è¯»ã€‚è€Œå†™é”åˆ™ä¼šæŠŠè¯»å’Œå†™éƒ½é˜»å¡</strong></p><h4 id="å¦‚ä½•åˆ†æè¡¨é”-ï¼Ÿ"><a href="#å¦‚ä½•åˆ†æè¡¨é”-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†æè¡¨é” ï¼Ÿ"></a>å¦‚ä½•åˆ†æè¡¨é” ï¼Ÿ</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">show status like 'table%';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œæœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡è®°å½• MySQL å†…éƒ¨è¡¨çº§é”å®šçš„æƒ…å†µï¼Œä¸¤ä¸ªå˜é‡è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>Table_locks_immediate ï¼š  äº§ç”Ÿè¡¨çº§é”å®šçš„æ¬¡æ•°ï¼Œè¡¨ç¤ºå¯ä»¥ç«‹å³è·å–é”çš„æŸ¥è¯¢æ¬¡æ•°ï¼Œæ¯ç«‹å³è·å–é”å€¼åŠ  1ï¼›</li><li>Table_locks_waited ï¼š å‡ºç°è¡¨çº§é”å®šäº‰ç”¨è€Œå‘ç”Ÿç­‰å¾…çš„æ¬¡æ•°ï¼ˆä¸èƒ½ç«‹å³è·å–é”çš„æ¬¡æ•°ï¼Œæ¯ç­‰å¾…ä¸€æ¬¡é”å€¼åŠ  1ï¼‰ï¼Œæ­¤å€¼é«˜åˆ™è¯´æ˜å­˜åœ¨ç€è¾ƒä¸¥é‡çš„è¡¨çº§é”äº‰ç”¨æƒ…å†µã€‚</li></ul><p><strong>æ­¤å¤–ï¼ŒMyISAM çš„è¯»å†™é”è°ƒåº¦æ˜¯å†™ä¼˜å…ˆï¼Œè¿™ä¹Ÿæ˜¯ MyISAM ä¸é€‚åˆåšå†™ä¸ºä¸»è¡¨çš„å¼•æ“ã€‚å› ä¸ºå†™é”åï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½åšä»»ä½•æ“ä½œï¼Œå¤§é‡çš„æ›´æ–°ä¼šä½¿æŸ¥è¯¢å¾ˆéš¾å¾—åˆ°é”ï¼Œä»è€Œé€ æˆæ°¸è¿œé˜»å¡</strong></p><h3 id="è¡Œé”-ï¼ˆåå‘äº-InnoDBï¼‰"><a href="#è¡Œé”-ï¼ˆåå‘äº-InnoDBï¼‰" class="headerlink" title="è¡Œé” ï¼ˆåå‘äº InnoDBï¼‰"></a>è¡Œé” ï¼ˆåå‘äº InnoDBï¼‰</h3><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</li><li>InnoDB ä¸ MyISAM çš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼ˆTRANSACTIONï¼‰ï¼ŒäºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”</li></ol><p><strong>äº‹åŠ¡çš„ 4 ä¸ªç‰¹æ€§ï¼š ACID</strong></p><ol><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œå•å…ƒï¼Œå…¶å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistentï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹å’Œå®Œæˆæ—¶ï¼Œæ•°æ®éƒ½å¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ç›¸å…³çš„æ•°æ®è§„åˆ™éƒ½å¿…é¡»åº”ç”¨äºäº‹åŠ¡çš„ä¿®æ”¹ï¼Œä»¥ä¿æŒæ•°æ®çš„å®Œæ•´æ€§ï¼šäº‹åŠ¡ç»“æŸæ—¶ï¼Œæ‰€æœ‰çš„å†…éƒ¨æ•°æ®ç»“æ„ï¼ˆå¦‚ Bæ ‘ç´¢å¼•æˆ–åŒå‘é“¾è¡¨ï¼‰ä¹Ÿéƒ½å¿…é¡»æ˜¯æ­£ç¡®çš„ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›ä¸€å®šçš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„â€œç‹¬ç«‹â€ç¯å¢ƒæ‰§è¡Œã€‚è¿™æ„å‘³ç€äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€å¯¹å¤–éƒ¨æ˜¯ä¸å¯è§çš„ï¼Œåä¹‹äº¦ç„¶ã€‚</li><li>æŒä¹…æ€§ï¼ˆDurableï¼‰ï¼šäº‹åŠ¡å®Œæˆä¹‹åï¼Œå®ƒå¯¹äºæ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿å‡ºç°ç³»ç»Ÿæ•…éšœä¹Ÿèƒ½å¤Ÿä¿æŒã€‚</li></ol><ul><li><p>é—´éš™é”<br>å½“æˆ‘ä»¬ç”¨<strong>èŒƒå›´æ¡ä»¶</strong>è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDB ä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ï¼›ï¼ˆå®å¯é”™æ€ä¸€åƒï¼Œä¹Ÿä¸å¯æ”¾è¿‡ä¸€ä¸ªï¼‰å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€œé—´éš™ï¼ˆGAPï¼‰â€ï¼ŒInnoDB ä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ï¼ˆNext-Keyé”ï¼‰ã€‚</p></li><li><p>é—´éš™é”çš„å±å®³<br>å› ä¸º query æ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œä»–ä¼šé”å®šæ•´ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„ç´¢å¼•é”®å€¼ï¼Œå³ä½¿è¿™ä¸ªé”®å€¼å¹¶ä¸å­˜åœ¨ã€‚é—´éš™é”æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å½“é”å®šä¸€ä¸ªèŒƒå›´å€¼ä¹‹åï¼Œå³ä½¿æŸäº›ä¸å­˜åœ¨çš„é”®å€¼ä¹Ÿä¼šè¢«æ— è¾œçš„é”å®šï¼Œè€Œé€ æˆåœ¨é”å®šçš„æ—¶å€™æ— æ³•æ’å…¥é”å®šé”®å€¼èŒƒå›´å†…çš„ä»»ä½•æ•°æ®ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹è¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å±å®³ã€‚</p></li><li><p>å¦‚ä½•ç»™å¢åŠ ä¸€æ¡è¡Œé” ï¼Ÿ</p></li></ul><pre class="line-numbers language-none"><code class="language-none"># è®¾ç½®ä¸€ä¸ªèµ·ç‚¹begin;# ç»™æŒ‡å®šè¡Œä¸Šé”select * from table1 where a = 8 for update;# ä¸Šé”ä¹‹åï¼Œåšä¸€äº›ä½ æƒ³è¦åšçš„æ“ä½œï¼Œæ¯”å¦‚è¯´éœ€è¦æ›´æ–°å½“å‰æ•°æ®update table1 set b = 123 where a = 8;# åšå®Œä½ æƒ³è¦åšçš„æ“ä½œä¹‹åï¼Œä¸€å®šè¦æäº¤commit;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Innodb å­˜å‚¨å¼•æ“ç”±äºå®ç°äº†è¡Œçº§é”å®šï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢æ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨çº§é”å®šè¦æ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯åœ¨æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œä¼˜äº MyISAM çš„è¡¨çº§é”å®šçš„ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼ŒInnoDB çš„æ•´ä½“æ€§èƒ½å’Œ MyISAM ç›¸æ¯”å°±ä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¼˜åŠ¿äº†ã€‚<br>ä½†æ˜¯ï¼ŒInnoDB çš„è¡Œçº§é”åŒæ ·ä¹Ÿæœ‰å…¶è„†å¼±çš„ä¸€é¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè®© InnoDB çš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯” MyISAM é«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®ã€‚</p><h4 id="å¦‚ä½•åˆ†æè¡Œé”-ï¼Ÿ"><a href="#å¦‚ä½•åˆ†æè¡Œé”-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†æè¡Œé” ï¼Ÿ"></a>å¦‚ä½•åˆ†æè¡Œé” ï¼Ÿ</h4><p>é€šè¿‡æ£€æŸ¥ InnoDB_row_lock çŠ¶æ€å˜é‡æ¥åˆ†æç³»ç»Ÿä¸Šçš„è¡Œé”çš„äº‰å¤ºæƒ…å†µ</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">show status like 'innodb_row_lock%';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯¹å„ä¸ªçŠ¶æ€é‡çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>innodb_row_lock_current_waits ï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡</li><li>innodb_row_lock_time ï¼š ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦</li><li>innodb_row_lock_time_avg ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´</li><li>innodb_row_lock_time_max ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€å¸¸çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´</li><li>innodb_row_lock_waits ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°</li></ul><p>å¯¹äºè¿™ 5 ä¸ªçŠ¶æ€å˜é‡ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸»è¦æ˜¯ innodb_row_lock_time_avg ï¼ˆç­‰å¾…å¹³å‡æ—¶é•¿ï¼‰ã€innodb_row_lock_waits ï¼ˆç­‰å¾…æ€»æ¬¡æ•°ï¼‰ã€innodb_row_lock_time ï¼ˆç­‰å¾…æ€»æ—¶é•¿ï¼‰è¿™ä¸‰é¡¹ã€‚å°¤å…¶æ˜¯å½“ç­‰å¾…æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…æ—¶é•¿ä¹Ÿä¸å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœç€æ‰‹æŒ‡å®šä¼˜åŒ–è®¡åˆ’ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ä¸‰èŒƒå¼</title>
      <link href="posts/b17a8184.html"/>
      <url>posts/b17a8184.html</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-ä¸‰èŒƒå¼"><a href="#MySQL-ä¸‰èŒƒå¼" class="headerlink" title="MySQL ä¸‰èŒƒå¼"></a>MySQL ä¸‰èŒƒå¼</h1><h2 id="ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šè¡¨ä¸­çš„æ¯åˆ—çš„å±æ€§ä¸å¯å†åˆ†"><a href="#ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šè¡¨ä¸­çš„æ¯åˆ—çš„å±æ€§ä¸å¯å†åˆ†" class="headerlink" title="ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šè¡¨ä¸­çš„æ¯åˆ—çš„å±æ€§ä¸å¯å†åˆ†"></a>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šè¡¨ä¸­çš„æ¯åˆ—çš„å±æ€§ä¸å¯å†åˆ†</h2><p>æ¯”å¦‚ï¼š</p><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>å§“å</th><th>æ€§åˆ«</th><th>å°±è¯»ä¿¡æ¯</th></tr></thead><tbody><tr><td>20200101</td><td>å¼ ä¸‰</td><td>ç”·</td><td>å¤§ä¸€ï¼ŒåœŸæœ¨å·¥ç¨‹</td></tr></tbody></table><blockquote><p>ä¸Šè¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œï¼ˆå°±è¯»ä¿¡æ¯ï¼‰è¿™ä¸€åˆ—ï¼Œå…¶å®è¿˜å¯ä»¥åˆ†è§£æˆï¼ˆå¹´çº§ï¼‰å’Œï¼ˆä¸“ä¸šï¼‰ï¼Œå› æ­¤ï¼ˆå°±è¯»ä¿¡æ¯ï¼‰è¿™ä¸€å±æ€§è¿˜å¯ä»¥å†åˆ†ï¼Œæ•…ä¸æ»¡è¶³ç¬¬ä¸€èŒƒå¼</p></blockquote><p>ä¿®æ”¹æˆï¼š</p><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>å§“å</th><th>æ€§åˆ«</th><th>å¹´çº§</th><th>ä¸“ä¸š</th></tr></thead><tbody><tr><td>20200101</td><td>å¼ ä¸‰</td><td>ç”·</td><td>å¤§ä¸€</td><td>åœŸæœ¨å·¥ç¨‹</td></tr></tbody></table><h2 id="ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨é‡Œçš„éä¸»é”®å±æ€§å¿…é¡»éƒ½ä¾èµ–äºä¸»é”®ï¼ˆè”åˆä¸»é”®ï¼‰"><a href="#ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨é‡Œçš„éä¸»é”®å±æ€§å¿…é¡»éƒ½ä¾èµ–äºä¸»é”®ï¼ˆè”åˆä¸»é”®ï¼‰" class="headerlink" title="ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨é‡Œçš„éä¸»é”®å±æ€§å¿…é¡»éƒ½ä¾èµ–äºä¸»é”®ï¼ˆè”åˆä¸»é”®ï¼‰"></a>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨é‡Œçš„éä¸»é”®å±æ€§å¿…é¡»éƒ½ä¾èµ–äºä¸»é”®ï¼ˆè”åˆä¸»é”®ï¼‰</h2><p>æ¯”å¦‚ï¼š</p><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>è¯¾ç¨‹ï¼ˆä¸»é”®ï¼‰</th><th>æ•™å¸ˆå§“å</th><th>æˆç»©</th><th>å­¦ç”Ÿå§“å</th><th>ä¸“ä¸š</th></tr></thead><tbody><tr><td>20200101</td><td>Cè¯­è¨€ç¨‹åºè®¾è®¡</td><td>è€å¼ </td><td>80</td><td>å¼ ä¸‰</td><td>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</td></tr><tr><td>20200102</td><td>JAVAç¨‹åºè®¾è®¡</td><td>è€æ</td><td>87</td><td>æå››</td><td>ç½‘ç»œå·¥ç¨‹</td></tr><tr><td>20200103</td><td>æ•°æ®ç»“æ„</td><td>è€ç‹</td><td>90</td><td>ç‹äº”</td><td>è½¯ä»¶å·¥ç¨‹</td></tr></tbody></table><blockquote><p>ä¸Šè¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œï¼ˆæ•™å¸ˆå§“åã€æˆç»©ï¼‰ä¸¤ä¸ªå±æ€§éƒ½ä¾èµ–äºï¼ˆå­¦å·ï¼‰å’Œï¼ˆè¯¾ç¨‹ï¼‰ï¼Œä½†æ˜¯ï¼ˆå­¦ç”Ÿå§“åã€ä¸“ä¸šï¼‰è¿™ä¸¤ä¸ªå±æ€§å´åªä¾èµ–äºï¼ˆå­¦å·ï¼‰ï¼Œä¸ä¾èµ–äºï¼ˆè¯¾ç¨‹ï¼‰ï¼Œå³ <strong>åªéœ€è¦çŸ¥é“ï¼ˆå­¦å·ï¼‰ä¾¿å¯ä»¥çŸ¥é“ï¼ˆå­¦ç”Ÿå§“åå’Œä¸“ä¸šä¸¤ä¸ªå±æ€§ï¼‰</strong>ï¼Œæ‰€ä»¥ï¼Œå¯¼è‡´éä¸»é”®å±æ€§ï¼ˆå­¦ç”Ÿå§“åã€ä¸“ä¸šï¼‰ä¸å®Œå…¨ä¾èµ–äºä¸»é”®ï¼ˆå­¦å·ã€è¯¾ç¨‹ï¼‰ï¼Œæ•…ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼</p></blockquote><p>ä¿®æ”¹æˆï¼š</p><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>è¯¾ç¨‹ï¼ˆä¸»é”®ï¼‰</th><th>æ•™å¸ˆå§“å</th><th>æˆç»©</th></tr></thead><tbody><tr><td>20200101</td><td>Cè¯­è¨€ç¨‹åºè®¾è®¡</td><td>è€å¼ </td><td>80</td></tr><tr><td>20200102</td><td>JAVAç¨‹åºè®¾è®¡</td><td>è€æ</td><td>87</td></tr><tr><td>20200103</td><td>æ•°æ®ç»“æ„</td><td>è€ç‹</td><td>90</td></tr></tbody></table><hr><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>å­¦ç”Ÿå§“å</th><th>ä¸“ä¸š</th></tr></thead><tbody><tr><td>20200101</td><td>å¼ ä¸‰</td><td>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</td></tr><tr><td>20200102</td><td>æå››</td><td>ç½‘ç»œå·¥ç¨‹</td></tr><tr><td>20200103</td><td>ç‹äº”</td><td>è½¯ä»¶å·¥ç¨‹</td></tr></tbody></table><h2 id="ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨ä¸­çš„éä¸»å±æ€§ä¸å¯ä»¥å­˜åœ¨ä¾èµ–å…³ç³»"><a href="#ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨ä¸­çš„éä¸»å±æ€§ä¸å¯ä»¥å­˜åœ¨ä¾èµ–å…³ç³»" class="headerlink" title="ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨ä¸­çš„éä¸»å±æ€§ä¸å¯ä»¥å­˜åœ¨ä¾èµ–å…³ç³»"></a>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨ä¸­çš„éä¸»å±æ€§ä¸å¯ä»¥å­˜åœ¨ä¾èµ–å…³ç³»</h2><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>å§“å</th><th>æ€§åˆ«</th><th>å¹´çº§</th><th>ä¸“ä¸š</th><th>ç­ä¸»ä»»å§“å</th><th>ç­ä¸»ä»»æ€§åˆ«</th><th>ç­ä¸»ä»»å¹´é¾„</th></tr></thead><tbody><tr><td>20200101</td><td>å¼ ä¸‰</td><td>ç”·</td><td>å¤§ä¸€</td><td>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</td><td>è€å¼ </td><td>ç”·</td><td>33</td></tr><tr><td>20200102</td><td>æå››</td><td>ç”·</td><td>å¤§äºŒ</td><td>ç½‘ç»œå·¥ç¨‹</td><td>è€æ</td><td>ç”·</td><td>34</td></tr><tr><td>20200103</td><td>ç‹äº”</td><td>å¥³</td><td>å¤§ä¸‰</td><td>è½¯ä»¶å·¥ç¨‹</td><td>è€ç‹</td><td>ç”·</td><td>35</td></tr></tbody></table><blockquote><p>ä¸Šè¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œéä¸»é”®å±æ€§éƒ½ä¾èµ–äºï¼ˆå­¦å·ï¼‰ï¼Œæ»¡è¶³äº†ç¬¬äºŒèŒƒå¼ã€‚ä½†æ˜¯ï¼ˆç­ä¸»ä»»æ€§åˆ«ã€ç­ä¸»ä»»å¹´é¾„ï¼‰è¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯ç›´æ¥ä¾èµ–äºï¼ˆç­ä¸»ä»»å§“åï¼‰è¿™ä¸€å±æ€§çš„ï¼Œä¸ï¼ˆå­¦å·ï¼‰å±äºé—´æ¥ä¾èµ–ï¼Œè¿™å°±å¯¼è‡´äº†è¡¨ä¸­çš„éä¸»é”®å±æ€§å­˜åœ¨ç€ä¾èµ–å…³ç³»ï¼Œä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼</p></blockquote><table><thead><tr><th>å­¦å·ï¼ˆä¸»é”®ï¼‰</th><th>å§“å</th><th>æ€§åˆ«</th><th>å¹´çº§</th><th>ä¸“ä¸š</th></tr></thead><tbody><tr><td>20200101</td><td>å¼ ä¸‰</td><td>ç”·</td><td>å¤§ä¸€</td><td>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</td></tr><tr><td>20200102</td><td>æå››</td><td>ç”·</td><td>å¤§äºŒ</td><td>ç½‘ç»œå·¥ç¨‹</td></tr><tr><td>20200103</td><td>ç‹äº”</td><td>å¥³</td><td>å¤§ä¸‰</td><td>è½¯ä»¶å·¥ç¨‹</td></tr></tbody></table><hr><table><thead><tr><th>ç­ä¸»ä»»å§“åï¼ˆä¸»é”®ï¼‰</th><th>ç­ä¸»ä»»æ€§åˆ«</th><th>ç­ä¸»ä»»å¹´é¾„</th></tr></thead><tbody><tr><td>è€å¼ </td><td>ç”·</td><td>33</td></tr><tr><td>è€æ</td><td>ç”·</td><td>34</td></tr><tr><td>è€ç‹</td><td>ç”·</td><td>35</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ä¸»ä»å¤åˆ¶</title>
      <link href="posts/6b30c31b.html"/>
      <url>posts/6b30c31b.html</url>
      
        <content type="html"><![CDATA[<h2 id="MySQL-ä¸»ä»å¤åˆ¶"><a href="#MySQL-ä¸»ä»å¤åˆ¶" class="headerlink" title="MySQL ä¸»ä»å¤åˆ¶"></a>MySQL ä¸»ä»å¤åˆ¶</h2><ul><li>ä¸»ä»å¤åˆ¶åŸç†</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e70a71423894062b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸»ä»å¤åˆ¶åŸç†"></p><ul><li>ä¸»ä»å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</li></ul><ol><li>æ¯ä¸ª slave åªæœ‰ä¸€ä¸ª master</li><li>æ¯ä¸ª slave åªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ ID</li><li>æ¯ä¸ª master å¯ä»¥æœ‰å¤šä¸ª salve</li></ol><h3 id="ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®"><a href="#ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®" class="headerlink" title="ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®"></a>ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®</h3><ul><li>mysql ç‰ˆæœ¬ä¸€è‡´ä¸”åå°ä»¥æœåŠ¡è¿è¡Œ</li><li>ä¸»ä»éƒ½é…ç½®åœ¨ [mysqld] èŠ‚ç‚¹ä¸‹ï¼Œéƒ½æ˜¯å°å†™</li></ul><h4 id="ä¸»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹-etc-my-cnf-é…ç½®æ–‡ä»¶"><a href="#ä¸»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹-etc-my-cnf-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¸»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹ /etc/my.cnf é…ç½®æ–‡ä»¶"></a>ä¸»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹ /etc/my.cnf é…ç½®æ–‡ä»¶</h4><ol><li>ä¸»æœåŠ¡å™¨å”¯ä¸€ ID <strong>å¿…é¡»</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">server-id=1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿— <strong>å¿…é¡»</strong></li></ol><pre class="line-numbers language-none"><code class="language-none"># mysqlbin ä¸ºå®˜æ–¹æ¨èçš„æ–‡ä»¶ålog-bin=è‡ªå·±çš„æœ¬åœ°è·¯å¾„/mysqlbinlog-bin=/var/local/mysql-server5.7/data/mysqlbin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å¯ç”¨é”™è¯¯æ—¥å¿— <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none"># mysqlerr ä¸ºå®˜æ–¹æ¨èçš„æ–‡ä»¶ålog-err=è‡ªå·±çš„æœ¬åœ°è·¯å¾„/mysqlerrlog-err=/var/local/mysql-server5.7/data/mysqlerr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>æ ¹ç›®å½• <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">basedir="è‡ªå·±çš„æœ¬åœ°è·¯å¾„"basedir="/var/local/mysql-server5.7/"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="5"><li>ä¸´æ—¶ç›®å½• <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">tmpdir="è‡ªå·±çš„æœ¬åœ°è·¯å¾„"tmpdir="/var/local/mysql-server5.7/"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="6"><li>æ•°æ®ç›®å½• <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">datadir="è‡ªå·±çš„æœ¬åœ°è·¯å¾„"datadir="/var/local/mysql-server5.7/"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="7"><li>ä¸»æœºï¼Œè¯»å†™éƒ½å¯ä»¥ <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">read-only=0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="8"><li>è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“ <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">binlog-ignore-db=mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="9"><li>è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ <strong>å¯é€‰</strong></li></ol><pre class="line-numbers language-none"><code class="language-none">binlog-do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®Œæ•´çš„é…ç½®ä¸ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">[mysqld]port=3306server-id=1log-bin=/var/local/mysql-server5.7/data/mysqlbinlog-err=/var/local/mysql-server5.7/data/mysqlerrbasedir="/var/local/mysql-server5.7/"tmpdir="/var/local/mysql-server5.7/"datadir="/var/local/mysql-server5.7/"read-only=0binlog-ignore-db=mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹-etc-my-cnf-é…ç½®æ–‡ä»¶"><a href="#ä»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹-etc-my-cnf-é…ç½®æ–‡ä»¶" class="headerlink" title="ä»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹ /etc/my.cnf é…ç½®æ–‡ä»¶"></a>ä»æ•°æ®åº“é…ç½®ï¼Œä¿®æ”¹ /etc/my.cnf é…ç½®æ–‡ä»¶</h4><ol><li>ä»æœåŠ¡å™¨å”¯ä¸€ ID <strong>å¿…é¡»</strong></li></ol><pre class="line-numbers language-none"><code class="language-none"># é»˜è®¤é…ç½®æ–‡ä»¶ä¸­å°†æ­¤è¡Œæ³¨é‡Šæ‰äº†ï¼Œå¯ä»¥ç›´æ¥å–æ¶ˆæ³¨é‡Šå³å¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ·»åŠ server-id=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿— <strong>å¿…é¡»</strong></li></ol><pre class="line-numbers language-none"><code class="language-none"># é»˜è®¤é…ç½®æ–‡ä»¶ä¸­å°†æ­¤è¡Œæ³¨é‡Šæ‰äº†ï¼Œå¯ä»¥ç›´æ¥å–æ¶ˆæ³¨é‡Šå³å¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ·»åŠ log-bin=mysql-bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>ä¸»ä»æœºå™¨éƒ½å…³é—­æ‰é˜²ç«å¢™</li><li>åœ¨ä¸»æ•°æ®åº“ä¸Šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ slave</li></ul><pre class="line-numbers language-none"><code class="language-none"># ä»æ•°æ®åº“ç”¨äºæ‹·è´çš„è´¦å·ä¸ºï¼šalex# ä»æ•°æ®åº“ç”¨äºæ‹·è´çš„å¯†ç ä¸ºï¼š123456# ä»æ•°æ®åº“æ‰€åœ¨æœåŠ¡å™¨çš„ ip åœ°å€ä¸ºï¼š127.0.0.12grant replication slave on *.* to 'alex'@'127.0.0.12' identified by '123456';# åˆ·æ–°æƒé™flush privileges;# æŸ¥è¯¢ master çš„çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹ File å’Œ Position çš„å€¼show master status;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åœ¨ä»æ•°æ®åº“ä¸Šé…ç½®</li></ul><pre class="line-numbers language-none"><code class="language-none"># ä¸»æ•°æ®åº“æ‰€åœ¨æœåŠ¡å™¨çš„ ip åœ°å€ä¸ºï¼š127.0.0.1# åœ¨ä¸»æ•°æ®åº“å»ºç«‹ç”¨äºä»æ•°æ®åº“æ‹·è´çš„è´¦å·ä¸ºï¼šalex# åœ¨ä¸»æ•°æ®åº“å»ºç«‹ç”¨äºä»æ•°æ®åº“æ‹·è´çš„å¯†ç ä¸ºï¼š123456# ä¸»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºçš„ File å€¼ä¸ºï¼šmysqlbin.000035# ä¸»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºçš„ Position çš„å€¼ä¸ºï¼š341change master to master_host='127.0.0.1', master_user='alex',master_password='123456',master_log_file='mysqlbin.000035',master_log_pos=341; # å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½start slave;# æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå½“ Slave_IO_Running: Yes å’Œ Slave_SQL_Running: Yes åŒæ—¶ä¸º yes æ—¶ï¼Œè¡¨ç¤ºä¸»ä»å¤åˆ¶å·²ç»æ‰“é€šäº†show slave status\G<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>æµ‹è¯•ä¸»ä»å¤åˆ¶æ˜¯å¦æˆåŠŸï¼Ÿ</p><ul><li>ä¸»æ•°æ®åº“æ–°å»ºä¸€ä¸ªåº“ã€æ–°å»ºè¡¨ã€æ’å…¥ä¸€æ¡è®°å½•ï¼Œä»æ•°æ®åº“å»æŸ¥è¯¢æ˜¯å¦å«æœ‰ä»¥ä¸Šæ•°æ®å³å¯</li></ul></li><li><p>å¦‚ä½•åœæ­¢ä»æ•°æ®åº“å¤åˆ¶åŠŸèƒ½ï¼Ÿ</p></li></ul><pre class="line-numbers language-none"><code class="language-none"># ä»æ•°æ®åº“ä¸Šstop slave;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å½“ Slave_IO_Running å’Œ Slave_SQL_Running å‚æ•°ä¸åŒæ—¶ä¸º yes æ—¶ï¼Ÿ</li></ul><pre class="line-numbers language-none"><code class="language-none"># å…ˆåœæ­¢ä»æ•°æ®åº“å¤åˆ¶åŠŸèƒ½ï¼ˆä»æ•°æ®åº“ä¸Šæ‰§è¡Œï¼‰stop slave;# æŸ¥è¯¢ master çš„çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹ File å’Œ Position çš„å€¼ ï¼ˆä¸»æ•°æ®åº“ä¸Šæ‰§è¡Œï¼Œè¿™æ¬¡ä¼šæœ‰æ–°çš„ File å€¼å’Œ Position å€¼ï¼‰show master status;change master to master_host='ä¸»æ•°æ®åº“æ‰€åœ¨æœåŠ¡å™¨çš„ ip åœ°å€', master_user='alex',master_password='123456',master_log_file='æ–°çš„ File å€¼',master_log_pos=æ–°çš„Position å€¼;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> ä¸»ä»å¤åˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å¯ redis è¿œç¨‹è¿æ¥</title>
      <link href="posts/a15ba792.html"/>
      <url>posts/a15ba792.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å¯-redis-è¿œç¨‹è¿æ¥"><a href="#å¼€å¯-redis-è¿œç¨‹è¿æ¥" class="headerlink" title="å¼€å¯ redis è¿œç¨‹è¿æ¥"></a>å¼€å¯ redis è¿œç¨‹è¿æ¥</h1><ol><li>ç¼–è¾‘ redis é…ç½®æ–‡ä»¶ redis.conf</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœéœ€è¦å¼€å¯è¿ä¸ªè®¿é—®è¿æ¥æ—¶ï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°è¿æ¥ï¼Œä¸€ä¸ªæ˜¯è¿œç¨‹è¿æ¥</span><span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 <span class="token number">192.168</span>.174.174<span class="token comment"># å¦‚æœæ˜¯å¸Œæœ›ä»»ä½•ä¸€å°ä¸»æœºéƒ½å¯ä»¥è¿æ¥ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æ³¨é‡Šä»¥ä¸‹è¿™ä¸€è¡Œï¼Œæ¯”å¦‚</span><span class="token comment"># bind 127.0.0.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å¼€å¯å…¬ç½‘è¿æ¥ redis</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">protected-mode no<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>é‡å¯ redis</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /etc/init.d/redis restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis çš„æŒä¹…åŒ–</title>
      <link href="posts/6d929828.html"/>
      <url>posts/6d929828.html</url>
      
        <content type="html"><![CDATA[<h1 id="Redis-çš„æŒä¹…åŒ–"><a href="#Redis-çš„æŒä¹…åŒ–" class="headerlink" title="Redis çš„æŒä¹…åŒ–"></a>Redis çš„æŒä¹…åŒ–</h1><h2 id="ä¸¤ç§æŒä¹…åŒ–æ–¹å¼"><a href="#ä¸¤ç§æŒä¹…åŒ–æ–¹å¼" class="headerlink" title="ä¸¤ç§æŒä¹…åŒ–æ–¹å¼"></a>ä¸¤ç§æŒä¹…åŒ–æ–¹å¼</h2><ul><li>RDB æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ä¿å­˜æ•°æ®å¿«ç…§</li><li>AOF å…ˆæŠŠå‘½ä»¤è¿½åŠ åˆ°æ“ä½œæ—¥å¿—çš„å°¾éƒ¨ï¼Œä¿å­˜æ‰€æœ‰å†å²æ“ä½œå‘½ä»¤</li></ul><h3 id="RDB-æ¨¡å¼"><a href="#RDB-æ¨¡å¼" class="headerlink" title="RDB æ¨¡å¼"></a>RDB æ¨¡å¼</h3><ul><li><strong>ä¼˜ç‚¹</strong></li></ul><ol><li>é€‚åˆç”¨äºè¿›è¡Œå¤‡ä»½</li><li>fork å‡ºå­è¿›ç¨‹è¿›è¡Œå¤‡ä»½ï¼Œä¸»è¿›ç¨‹æ²¡æœ‰ä»»ä½• IO æ“ä½œ</li><li>æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦å¿«</li></ol><ul><li><strong>ç¼ºç‚¹</strong></li></ul><ol><li>ç‰¹å®šæ¡ä»¶ä¸‹è¿›è¡Œä¸€æ¬¡æŒä¹…åŒ–ï¼Œæ˜“ä¸¢å¤±æ•°æ®</li><li>åºå¤§æ•°æ®æ—¶ï¼Œä¿å­˜æ—¶ä¼šå‡ºç°æ€§èƒ½é—®é¢˜</li></ol><p>è®¾ç½®æ–¹å¼</p><p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š sudo vim /etc/redis/redis.conf</p><pre class="line-numbers language-none"><code class="language-none"># å¤‡ä»½çš„é¢‘æ¬¡save 900 1    # 900 ç§’å†…ï¼Œæœ‰ 1 æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶save 300 10save 60 10000# å¤‡ä»½çš„æ–‡ä»¶å 253 dbfilename dump.rdb# å¤‡ä»½çš„ç›®å½•è·¯å¾„ 263 dir /var/lib/redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é»˜è®¤çš„å¤‡ä»½æ–‡ä»¶ä¸ºï¼š vim /var/lib/redis/dump.rdb</p><h3 id="AOF-æ¨¡å¼"><a href="#AOF-æ¨¡å¼" class="headerlink" title="AOF æ¨¡å¼"></a>AOF æ¨¡å¼</h3><ul><li><strong>ä¼˜ç‚¹</strong></li></ul><ol><li>æ•°æ®éå¸¸å®Œæ•´ï¼Œæ•…éšœæ¢å¤ä¸¢å¤±æ•°æ®å°‘</li><li>å¯å¯¹å†å²æ“ä½œè¿›è¡Œå¤„ç†</li></ol><ul><li><strong>ç¼ºç‚¹</strong></li></ul><ol><li>æ–‡ä»¶çš„ä½“ç§¯å¤§</li><li>é€Ÿåº¦ä½äº RDB ä¸”æ•…éšœæ¢å¤é€Ÿåº¦æ…¢</li></ol><p>è®¾ç½®æ–¹å¼</p><p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š sudo vim /etc/redis/redis.conf</p><pre class="line-numbers language-none"><code class="language-none"># å½“ appendonly å‚æ•°ä¸º yes æ—¶ï¼Œåˆ™å¼€å¯ AOF æ¨¡å¼ 672 appendonly yes# å¤‡ä»½çš„æ–‡ä»¶å 676 appendfilename "appendonly.aof"# åŒæ­¥çš„æ–¹å¼ 701 # appendfsync always  // åŒæ­¥æŒä¹…åŒ–ï¼Œæ¯æ¬¡æ•°æ®å˜æ›´éƒ½ä¼šç«‹åˆ»ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œéœ€è¦å®æ—¶è®°å½•ï¼Œå› æ­¤æ•ˆç‡ä¸é«˜ï¼Œä½†æ˜¯æ•°æ®ååˆ†å®Œæ•´ 702 appendfsync everysec  // å¼‚æ­¥æŒä¹…åŒ–ï¼Œæ¯éš” 1s è®°å½•ä¸€æ¬¡ 703 # appendfsync no  // ä¸åŒæ­¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é»˜è®¤çš„å¤‡ä»½æ–‡ä»¶ä¸ºï¼š vim /var/lib/redis/appendonly.aof</p><blockquote><p>ä¸¤ç§æ¨¡å¼å¯ä»¥åŒæ—¶å¼€å¯ï¼ŒåŒæ—¶å¼€å¯çš„æ—¶å€™ä¼šä¼˜å…ˆæ‰§è¡Œ AOF æ¨¡å¼çš„å¤‡ä»½æ–‡ä»¶ï¼Œè¿›è¡Œ AOF æ¨¡å¼æ¢å¤ï¼ŒåŒæ—¶å¼€å¯çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„åœ¨ redis ä½¿ç”¨ä¹‹åˆå°±è¦å…ˆå¼€å¯ AOF æ¨¡å¼ï¼Œä»¥å… AOF æ¨¡å¼ï¼Œåªä¼šè®°å½•éƒ¨åˆ†å‘½ä»¤ï¼Œå¯¼è‡´æ¢å¤æ•°æ®ä¸å®Œæ•´ã€‚</p></blockquote><h2 id="åˆç†åœ°ä½¿ç”¨-Redis"><a href="#åˆç†åœ°ä½¿ç”¨-Redis" class="headerlink" title="åˆç†åœ°ä½¿ç”¨ Redis"></a>åˆç†åœ°ä½¿ç”¨ Redis</h2><ul><li>é˜²æ­¢å†…å­˜å æ»¡ï¼š</li></ul><ol><li>è®¾ç½®è¶…æ—¶æ—¶é—´</li><li>ä¸å­˜æ”¾è¿‡å¤§æ–‡ä»¶ï¼ˆæœ€å¥½ä¸è¦è¶…è¿‡ 500 å­—èŠ‚ï¼‰</li><li>ä¸å­˜æ”¾ä¸å¸¸ç”¨æ•°æ®</li></ol><ul><li>æé«˜ä½¿ç”¨æ•ˆç‡</li></ul><ol><li>åˆç†ä½¿ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ç±»å‹</li><li>æ…ç”¨æ­£åˆ™å¤„ç†æˆ–è€…æ‰¹é‡æ“ä½œ Hashã€Set ç­‰ã€‚ï¼ˆå› ä¸º redis æ˜¯å•çº¿ç¨‹ï¼Œå¦‚æœæ­£åˆ™åŒ¹é… key çš„è¯ï¼Œå¯èƒ½ä¼šå½±å“å…¶ä»–å‘½ä»¤çš„ä½¿ç”¨ï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis Cluster é›†ç¾¤è§£å†³æ–¹æ¡ˆ</title>
      <link href="posts/663a091e.html"/>
      <url>posts/663a091e.html</url>
      
        <content type="html"><![CDATA[<h1 id="Redis-Cluster-é›†ç¾¤è§£å†³æ–¹æ¡ˆ"><a href="#Redis-Cluster-é›†ç¾¤è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redis Cluster é›†ç¾¤è§£å†³æ–¹æ¡ˆ"></a>Redis Cluster é›†ç¾¤è§£å†³æ–¹æ¡ˆ</h1><ul><li>å¤šä¸ª Redis å®ä¾‹ååŒè¿›è¡Œ</li><li>é‡‡ç”¨ slot ï¼ˆæ§½ï¼‰åˆ†å‰²æ•°æ®ï¼Œæ˜¯ CRC16 ä¸ 16384 å–æ¨¡ååˆ†æ•£</li><li>ä¸»ä»ç»“æ„å’Œé€‰ä¸¾ç®—æ³•ï¼Œä¿è¯æ¯ä¸ªèŠ‚ç‚¹çš„å¯é æ€§</li><li>å®¢æˆ·ç«¯å¯ä»¥è¿æ¥ä»»æ„ä¸€ä¸ª node è¿›è¡Œæ“ä½œ</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a6ad3bca1885917a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸»ä»ååŒè¿›è¡Œ"></p><ul><li>æ‰€æœ‰çš„ redis èŠ‚ç‚¹å½¼æ­¤äº’è”ï¼ˆPING-PONG æœºåˆ¶ï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚</li><li>èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚</li><li>å®¢æˆ·ç«¯ä¸ redis èŠ‚ç‚¹ç›´è¿ï¼Œä¸éœ€è¦ä¸­é—´ proxy å±‚ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</li><li>redis-cluster æŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ° [0-16383] slot ä¸Šï¼Œcluster è´Ÿè´£ç»´æŠ¤ node &lt;-&gt; slot &lt;-&gt; value</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-51f56d899218929f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å½“æœ‰ä¸€å°æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶"></p><h2 id="Redis-Cluster-æ³¨æ„äº‹é¡¹"><a href="#Redis-Cluster-æ³¨æ„äº‹é¡¹" class="headerlink" title="Redis Cluster æ³¨æ„äº‹é¡¹"></a>Redis Cluster æ³¨æ„äº‹é¡¹</h2><ul><li>ä¸å®Œå…¨æ”¯æŒæ‰¹é‡æ“ä½œï¼šmsetã€mget</li><li>äº‹åŠ¡ä¸èƒ½è·¨èŠ‚ç‚¹æ”¯æŒ</li><li>ä¸æ”¯æŒå¤šå®ä¾‹</li><li>key æ˜¯æœ€å°ç²’åº¦</li><li>æœ€å°‘ 6 ä¸ªæ‰èƒ½ä¿è¯ç»„æˆå®Œæ•´é«˜å¯ç”¨çš„é›†ç¾¤</li><li>è¿æ¥çš„æ—¶å€™åªéœ€è¦è¿æ¥ 1 å°æœåŠ¡å™¨å³å¯ã€‚</li><li>å¦‚æœ 1 ä¸ªä¸»ä»è¿æ¥å®•æœºçš„è¯ï¼Œé‚£ä¹ˆé›†ç¾¤å°±å®•æœºäº†ã€‚</li></ul><h2 id="Redis-Cluster-é…ç½®æ­¥éª¤"><a href="#Redis-Cluster-é…ç½®æ­¥éª¤" class="headerlink" title="Redis Cluster é…ç½®æ­¥éª¤"></a>Redis Cluster é…ç½®æ­¥éª¤</h2><p><em><strong>ï¼ˆå»ºè®®ä½¿ç”¨å®˜æ–¹å®‰è£…åŒ…çš„æ–¹å¼å®‰è£… redisï¼Œä¸è¦ä½¿ç”¨ apt-get install æˆ–è€… yum ç›´æ¥å®‰è£…ï¼‰</strong></em></p><ol><li>åˆ†åˆ«å®‰è£… <strong>6 å°</strong> æœåŠ¡å™¨ï¼Œä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸‰ä¸ªä»èŠ‚ç‚¹</li></ol><p>æˆ‘è¿™é‡Œé‡‡ç”¨çš„æ˜¯è™šæ‹Ÿæœºï¼Œç›¸åº”çš„ ip åœ°å€åˆ†åˆ«ä¸ºï¼š</p><ul><li>192.168.174.128  ï¼ˆ28 å·æœåŠ¡å™¨ï¼‰</li><li>192.168.174.129  ï¼ˆ29 å·æœåŠ¡å™¨ï¼‰</li><li>192.168.174.130  ï¼ˆ30 å·æœåŠ¡å™¨ï¼‰</li><li>192.168.174.131  ï¼ˆ31 å·æœåŠ¡å™¨ï¼‰</li><li>192.168.174.132  ï¼ˆ32 å·æœåŠ¡å™¨ï¼‰</li><li>192.168.174.133  ï¼ˆ33 å·æœåŠ¡å™¨ï¼‰</li></ul><ol start="2"><li>é…ç½® <code>redis.conf</code> é…ç½®æ–‡ä»¶ <em><strong>ï¼ˆåœ¨æ‰€æœ‰çš„æœåŠ¡å™¨ä¸Šæ“ä½œï¼‰</strong></em></li></ol><p>vim /etc/redis/redis.conf</p><ul><li>ç¬¬ä¸€æ­¥ï¼š</li></ul><pre class="line-numbers language-none"><code class="language-none"># é»˜è®¤ä¸ºæœ¬åœ° ip åœ°å€ï¼Œéœ€è¦æ”¹æˆå½“å‰æœåŠ¡å™¨çš„ ip åœ°å€ï¼Œä»¥ä¾¿å…¶ä»–æœåŠ¡å™¨å¯ä»¥æ­£å¸¸è®¿é—®  69 bind 127.0.0.1 ::1  # æ¯”å¦‚ 28 å·æœåŠ¡å™¨æ›´æ”¹ä¸ºä»¥ä¸‹ ip åœ°å€bind 192.168.174.128<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬äºŒæ­¥ï¼š</li></ul><pre class="line-numbers language-none"><code class="language-none"># è¿™ä¸ªå‚æ•°çš„å«ä¹‰æ˜¯æŒ‡ï¼šç¦æ­¢å…¬ç½‘è¿æ¥ redis ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥åŠ å¼º redis å®‰å…¨æ€§ã€‚å¦‚æœæ˜¯åœ¨çº¿ä¸Šç¯å¢ƒçš„è¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ›´æ”¹æ­¤å‚æ•°å€¼ï¼Œç„¶åéœ€è¦è¿›è¡Œè®¾ç½®è´¦å·å¯†ç ï¼Œè¿›è¡Œ auth è®¤è¯ã€‚è¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥æ”¹æˆ no  89 protected-mode yes  # éœ€è¦æ›´æ”¹ä¸ºä»¥ä¸‹protected-mode no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬ä¸‰æ­¥ï¼šå¼€å¯é›†ç¾¤ç›¸å…³å‚æ•°</li></ul><pre class="line-numbers language-none"><code class="language-none"># é»˜è®¤é›†ç¾¤æ˜¯å…³é—­çš„ 815 # cluster-enabled yes# éœ€è¦æ›´æ”¹ä¸ºä»¥ä¸‹ï¼ˆå»é™¤æ‰ # å·æ³¨é‡Šå³å¯ï¼‰ 815 cluster-enabled yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬å››æ­¥ï¼šå¼€å¯é›†ç¾¤é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-none"><code class="language-none"># é»˜è®¤é›†ç¾¤é…ç½®æ–‡ä»¶æ˜¯å…³é—­çš„ 823 # cluster-config-file nodes-6379.conf # éœ€è¦æ›´æ”¹ä¸ºä»¥ä¸‹ï¼ˆå»é™¤æ‰ # å·æ³¨é‡Šå³å¯ï¼‰  823 cluster-config-file nodes-6379.conf  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬äº”æ­¥ï¼šå¼€å¯é›†ç¾¤è¶…æ—¶æ—¶é—´</li></ul><pre class="line-numbers language-none"><code class="language-none"># å½“ä¸€ä¸ªèŠ‚ç‚¹å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œæœ€å¤§è¶…æ—¶è¿æ¥æ—¶é—´ä¸º 15s ï¼Œå½“è¶…è¿‡ 15s è¿˜æ²¡æœ‰è¿æ¥çš„æ—¶å€™ï¼Œå°±ä¼šè®¤ä¸ºè¯¥èŠ‚ç‚¹å‡ºç°æ•…éšœäº†ï¼Œå°±ä¼šé€šè¿‡é€‰ä¸¾ç®—æ³•ï¼Œå°†ä»æœåŠ¡å™¨æå‡ä¸ºä¸»æœåŠ¡å™¨ã€‚è¯¥å‚æ•°é»˜è®¤æ˜¯å…³é—­çš„ã€‚ 829 # cluster-node-timeout 15000 # éœ€è¦æ›´æ”¹ä¸ºä»¥ä¸‹ï¼ˆå»é™¤æ‰ # å·æ³¨é‡Šå³å¯ï¼‰ 829 cluster-node-timeout 15000 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å®‰è£… <code>ruby</code> ç»„ä»¶ã€‚å¦‚æœä¸å®‰è£…è¿™ä¸ªè½¯ä»¶ï¼Œé›†ç¾¤çš„æ—¶å€™ï¼Œä¼šæŠ¥ç»„ä»¶é”™è¯¯ã€‚ä½ éœ€è¦åœ¨é‚£å°æœåŠ¡å™¨ä¸Šé¢åšé›†ç¾¤ï¼Œä½ å°±éœ€è¦åœ¨å“ªå°æœåŠ¡å™¨ä¸Šå®‰è£…è¿™ä¸ªç»„ä»¶ï¼Œå¹¶ä¸æ˜¯æ¯å°æœåŠ¡å™¨ä¸Šé¢éƒ½å®‰è£…ã€‚è¿™é‡Œé‡‡ç”¨ç¬¬ä¸€å°æœåŠ¡å™¨åšé›†ç¾¤ï¼Œå› æ­¤åœ¨ç¬¬ä¸€å°æœåŠ¡å™¨ä¸Šå®‰è£… <code>ruby</code> ç»„ä»¶ã€‚<em><strong>ï¼ˆåœ¨ 28 å·æœåŠ¡å™¨ä¸Šæ“ä½œï¼‰</strong></em></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ruby<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>å®‰è£…å…¶ä»–ç»„ä»¶  <em><strong>ï¼ˆåœ¨ 28 å·æœåŠ¡å™¨ä¸Šæ“ä½œï¼‰</strong></em></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gem <span class="token function">install</span> redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>é…ç½®é›†ç¾¤  <em><strong>ï¼ˆåœ¨ 28 å·æœåŠ¡å™¨ä¸Šæ“ä½œï¼‰</strong></em></li></ol><p>å› ä¸ºæˆ‘æ˜¯ç›´æ¥é‡‡ç”¨çš„ <code>apt-get install</code> çš„æ–¹å¼å®‰è£…çš„ <code>redis</code> å› æ­¤ï¼ŒæœåŠ¡å™¨ä¸Šé¢çš„ <code>redis</code> å·¥å…· <code>redis-trib.rb</code> åœ¨ <code>/usr/share/doc/redis-tools/examples</code> ç›®å½•ä¸‹ã€‚å¦‚æœä½ æ˜¯é€šè¿‡å®‰è£…åŒ…å®‰è£…çš„ <code>redis</code> é‚£ä¹ˆè¯·ç›´æ¥åˆ° <code>redis</code> è§£å‹ç›®å½•ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚ï¼š <code>~/redis-4.0.9/src/redis-trib.rb</code></p><pre class="line-numbers language-none"><code class="language-none">/usr/share/doc/redis-tools/examples/redis-trib.rb create --replicas 1 192.168.174.128:6379 192.168.174.129:6379 192.168.174.130:6379 192.168.174.131:6379 192.168.174.132:6379 192.168.174.133:6379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d756993ee1a78b0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®é›†ç¾¤"></p><h3 id="å¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™æ—¶"><a href="#å¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™æ—¶" class="headerlink" title="å¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™æ—¶"></a>å¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™æ—¶</h3><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-398cfd78326a863f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ’æ§½èŠ‚ç‚¹è¢«å ç”¨"></p><p><strong>é—®é¢˜åŸå› ï¼š</strong><br>slot æ’æ§½è¢«å ç”¨äº†ï¼ˆè¿™æ˜¯æ­å»ºé›†ç¾¤å‰æ—¶ï¼Œä»¥å‰ redis çš„æ—§æ•°æ®å’Œé…ç½®ä¿¡æ¯æ²¡æœ‰æ¸…ç†å¹²å‡€ã€‚ï¼‰<br><strong>è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</strong><br>ç”¨ redis-cli ç™»å½•åˆ°æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œ  flushall  å’Œ cluster reset  å°±å¯ä»¥äº†</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-460623a9e0c0186b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è§£å†³æ–¹æ¡ˆå¦‚å›¾æ‰€ç¤º"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f2ae4a85d4fd0304.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å†æ¬¡è®¾ç½®é›†ç¾¤ï¼Œåˆ™å¯ä»¥è¿æ¥æˆåŠŸ"></p><ol start="6"><li>è¿æ¥é›†ç¾¤ <em><strong>ï¼ˆåœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨ä¸Šæ“ä½œï¼‰</strong></em></li></ol><p>è¿™é‡Œæˆ‘æŒ‘é€‰çš„æ˜¯ ip åœ°å€ä¸º ï¼š 192.168.174.131 çš„æœåŠ¡å™¨ï¼Œç‰¹åˆ«è¯´æ˜ä¸‹ï¼Œå½“æ‰§è¡Œ <code>keys</code> å‘½ä»¤çš„æ—¶å€™ï¼Œåªé’ˆå¯¹äºå½“å‰æœåŠ¡å™¨</p><pre class="line-numbers language-none"><code class="language-none"># å¸¦ -c å‚æ•°è¡¨ç¤ºè¿æ¥é›†ç¾¤redis-cli -h 192.168.174.131 -c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li>æµ‹è¯•</li></ol><pre class="line-numbers language-none"><code class="language-none">alex@alex-virtual-machine:~$ redis-cli -h 192.168.174.131 -c    # è¿æ¥çš„ 31 å·æœåŠ¡å™¨192.168.174.131:6379&gt; keys *  # è¿™é‡Œçš„ keys ä¹Ÿåªèƒ½æŸ¥çœ‹æ‰€æœ‰åœ¨ 31 å·æœåŠ¡å™¨ä¸Šé¢çš„ keys(empty list or set)192.168.174.131:6379&gt; set aa 111  # éšä¾¿è®¾ç½®ä¸€ä¸ª key-&gt; Redirected to slot [1180] located at 192.168.174.128:6379  # æ•°æ®å´åœ¨ 28 å·æœåŠ¡å™¨ä¸Šè¢«ä¿å­˜OK192.168.174.128:6379&gt;   # å¹¶ä¸”æ­¤æ—¶çš„çŠ¶æ€ç›´æ¥è·³åˆ°äº† 28 å·æœåŠ¡å™¨ä¸Šé¢<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1f41460e9f146d8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿æ¥ 31 å·æœåŠ¡å™¨ï¼Œæ•°æ®å­˜åˆ°äº† 28 å·æœåŠ¡å™¨ä¸Š"></p><pre class="line-numbers language-none"><code class="language-none">alex@alex-virtual-machine:~$ redis-cli -h 192.168.174.129 -c  # é€šè¿‡ 29 å·æœåŠ¡å™¨è¿æ¥é›†ç¾¤192.168.174.129:6379&gt; get aa  # ä» 29 å·æœåŠ¡å™¨ä¸­å»å–å€¼-&gt; Redirected to slot [1180] located at 192.168.174.128:6379  # ä¼šç›´æ¥ä» 28 å·æœåŠ¡å™¨ä¸­è¿”å›å€¼"111"192.168.174.128:6379&gt;   # å¹¶ä¸”æ­¤æ—¶çš„çŠ¶æ€ç›´æ¥è·³åˆ°äº† 28 å·æœåŠ¡å™¨ä¸Šé¢<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-56e8e278da0250a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä» 30 å·æœåŠ¡å™¨ä¸Šé¢å–åˆšåˆšè®¾ç½®çš„å€¼ï¼Œä¼šç›´æ¥è·³åˆ° 28 å·æœåŠ¡å™¨è¿”å›å€¼"></p><pre class="line-numbers language-none"><code class="language-none">alex@alex-virtual-machine:~$ redis-cli -h 192.168.174.130 -c  # é€šè¿‡ 30 å·æœåŠ¡å™¨è¿æ¥é›†ç¾¤192.168.174.130:6379&gt; keys *  # 30 å·æœåŠ¡å™¨ä¸­å¹¶æ²¡æœ‰è®¾ç½®è¿‡ keyï¼Œå¦‚æœ 30 å·æœåŠ¡å™¨å¯ä»¥å–å‡ºå€¼ï¼Œè¯æ˜å¯ä»¥è·¨æœåŠ¡å™¨å–å‡º keysï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ•°æ®ï¼Œè¯æ˜ keys åªèƒ½å–å‡ºå½“å‰æœåŠ¡å™¨ä¸­çš„ keys(empty list or set)192.168.174.130:6379&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a8098e86eba5fc31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="keys åªèƒ½å–å‡ºå½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰ key"></p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Cache </tag>
            
            <tag> åˆ†å¸ƒå¼é›†ç¾¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Memcached å®ç°åˆ†å¸ƒå¼ç®—æ³•</title>
      <link href="posts/aa516918.html"/>
      <url>posts/aa516918.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-Memcached-å®ç°åˆ†å¸ƒå¼ç®—æ³•"><a href="#ä½¿ç”¨-Memcached-å®ç°åˆ†å¸ƒå¼ç®—æ³•" class="headerlink" title="ä½¿ç”¨ Memcached å®ç°åˆ†å¸ƒå¼ç®—æ³•"></a>ä½¿ç”¨ Memcached å®ç°åˆ†å¸ƒå¼ç®—æ³•</h1><h2 id="åˆ†å¸ƒå¼ç®—æ³•"><a href="#åˆ†å¸ƒå¼ç®—æ³•" class="headerlink" title="åˆ†å¸ƒå¼ç®—æ³•"></a>åˆ†å¸ƒå¼ç®—æ³•</h2><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e26290372bf4ec4b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="éœ€è¦é€šè¿‡åº”ç”¨ç¨‹åºæ¥å®ç°åˆ†å¸ƒå¼ç®—æ³•"></p><h3 id="ä½™æ•°è®¡ç®—åˆ†æ•£æ³•"><a href="#ä½™æ•°è®¡ç®—åˆ†æ•£æ³•" class="headerlink" title="ä½™æ•°è®¡ç®—åˆ†æ•£æ³•"></a>ä½™æ•°è®¡ç®—åˆ†æ•£æ³•</h3><blockquote><p>æ ¹æ® key æ¥è®¡ç®— CRCï¼Œç„¶åç»“æœå¯¹æœåŠ¡å™¨æ•°è¿›è¡Œå–æ¨¡å¾—åˆ° memcached æœåŠ¡å™¨èŠ‚ç‚¹ã€‚  æœåŠ¡å™¨æ— æ³•è¿æ¥çš„æ—¶å€™ï¼Œå°†å°è¯•çš„è¿æ¥æ¬¡æ•°åŠ åˆ° key åé¢é‡æ–°è®¡ç®—ã€‚</p></blockquote><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6e626d05ecb0cb98.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½™æ•°è®¡ç®—åˆ†æ•£æ³•"></p><h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><p>æ·»åŠ æˆ–ç§»é™¤æœåŠ¡å™¨æ—¶ï¼Œå‡ ä¹æ‰€æœ‰ç¼“å­˜è¦é‡å»ºï¼Œè¿˜éœ€è¦è€ƒè™‘é›ªå´©å¼å´©æºƒé—®é¢˜ã€‚</p><p>16 ä¸ª Keyã€5 ä¸ªæœåŠ¡å™¨</p><table><thead><tr><th>æœåŠ¡å™¨</th><th>key å€¼</th><th>key å€¼</th><th>key å€¼</th><th>key å€¼</th></tr></thead><tbody><tr><td>S0</td><td></td><td>5</td><td>10</td><td>15</td></tr><tr><td>S1</td><td>1</td><td>6</td><td>11</td><td>16</td></tr><tr><td>S2</td><td>2</td><td>7</td><td>12</td><td></td></tr><tr><td>S3</td><td>3</td><td>8</td><td>13</td><td></td></tr><tr><td>S4</td><td>4</td><td>9</td><td>14</td><td></td></tr></tbody></table><p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼šå¦‚æœ S3 æœåŠ¡å™¨ç›´æ¥æŒ‚æ‰çš„è¯ï¼Œé‚£ä¹ˆ S3 æœåŠ¡å™¨çš„æµé‡ä¼šå…¨éƒ¨å¹¶ç»™ S4 æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ S4 æœåŠ¡å™¨è¦æ‰¿å—ä¹‹å‰ä¸€å€çš„å‹åŠ›ï¼Œå¦‚æœæ­¤æ—¶ S4 æœåŠ¡å™¨å·²ç»æ— æ³•æ‰¿å—ï¼Œç›´æ¥å´©æ‰çš„è¯ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯ä¼šå°†åŸæœ¬ S3ã€S4 çš„æµé‡å…¨éƒ¨åœ¨å¹¶ç»™ S0 æœåŠ¡å™¨</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b39308b35ba20703.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½™æ•°è®¡ç®—åˆ†æ•£æ³•"></p><table><thead><tr><th>æœåŠ¡å™¨</th><th>key å€¼</th><th>key å€¼</th><th>key å€¼</th><th>key å€¼</th><th>key å€¼</th></tr></thead><tbody><tr><td>S0</td><td></td><td>4</td><td>8</td><td>12</td><td>16</td></tr><tr><td>S1</td><td>1</td><td>5</td><td>9</td><td>13</td><td></td></tr><tr><td>S2</td><td>2</td><td>6</td><td>10</td><td>14</td><td></td></tr><tr><td>S3ï¼ˆå‡è®¾ç§»é™¤äº† S3 æœåŠ¡å™¨ï¼‰</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>S4(3)</td><td>3</td><td>7</td><td>11</td><td>15</td><td></td></tr></tbody></table><p>ä»¥ä¸Šä¾‹å­è¯´æ˜ï¼šå½“ç§»é™¤ä¸€å°æœåŠ¡å™¨ä¹‹åï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„ç¼“å­˜éƒ½éœ€è¦é‡å»ºï¼Œkey å€¼ï¼Œé™¤äº† S1 æœåŠ¡å™¨çš„ 1 å’Œ S2 æœåŠ¡å™¨çš„ 2ï¼Œå‰©ä¸‹çš„å…¨éƒ¨éƒ½ä¹±å¥—äº†</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d57efed81911e414.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½™æ•°è®¡ç®—åˆ†æ•£æ³•"></p><h3 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h3><ul><li>æ±‚å‡ºæœåŠ¡å™¨èŠ‚ç‚¹çš„å“ˆå¸Œå€¼åˆ†é…åˆ° 0~2^32 çš„åœ†ä¸Š</li><li>æ±‚å‡ºå­˜å‚¨æ•°æ®é”®çš„å“ˆå¸Œå€¼æ˜ å°„åˆ°åœ†ä¸Š</li><li>ä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾ï¼Œå°†æ•°æ®ä¿å­˜åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¸Š</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e59269f6a1f321ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-27ffaa9971199a33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></p><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ul><li>å†—ä½™å°‘</li><li>è´Ÿè½½å‡è¡¡</li><li>è¿‡æ¸¡å¹³æ»‘</li><li>å­˜å‚¨å‡è¡¡</li></ul><h4 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><p>ä¾ç„¶æ— æ³•è§£å†³é›ªå´©é—®é¢˜</p>]]></content>
      
      
      <categories>
          
          <category> Cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
            <tag> Memcached </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>memcached ç®€å•ä½¿ç”¨</title>
      <link href="posts/afc71251.html"/>
      <url>posts/afc71251.html</url>
      
        <content type="html"><![CDATA[<h1 id="memcached-ç®€å•ä½¿ç”¨"><a href="#memcached-ç®€å•ä½¿ç”¨" class="headerlink" title="memcached ç®€å•ä½¿ç”¨"></a>memcached ç®€å•ä½¿ç”¨</h1><h2 id="Memcached-å·¥ä½œåŸç†å’Œå†…å­˜ç®¡ç†"><a href="#Memcached-å·¥ä½œåŸç†å’Œå†…å­˜ç®¡ç†" class="headerlink" title="Memcached å·¥ä½œåŸç†å’Œå†…å­˜ç®¡ç†"></a>Memcached å·¥ä½œåŸç†å’Œå†…å­˜ç®¡ç†</h2><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9d44ed2ff2c9251a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Memcached å·¥ä½œåŸç†å’Œå†…å­˜ç®¡ç†"></p><blockquote><p>memcache çš„å›æ”¶æœºåˆ¶ä¼šé‡‡ç”¨ <strong>æœ€è¿‘æœ€å°‘ç®—æ³•</strong> å°†å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„æ•°æ®è¿›è¡Œæ¸…é™¤</p></blockquote><ul><li>Ubuntu ä¸‹å®‰è£…</li></ul><blockquote><p>å¦‚æœéœ€è¦ç¼–è¯‘å®‰è£…çš„è¯ï¼Œéœ€è¦å…ˆå®‰è£… libmemcached ç»„ä»¶æ‰å¯ä»¥</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… memcached</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> memcached<span class="token comment"># å®‰è£… php-memcached æ‰©å±•</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> php-memcached<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿›å…¥ memecached ç¯å¢ƒï¼Œç›´æ¥ä½¿ç”¨ telnet è®¿é—® 11211 ç«¯å£</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">telnet <span class="token number">127.0</span>.0.1 <span class="token number">11211</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æµ‹è¯•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®é”®åä¸º user1 å¯¹å€¼ä¸è¿›è¡Œå‹ç¼© è¿‡æœŸæ—¶é—´ä¸º 900s é•¿åº¦ä¸º 8 å­—èŠ‚</span><span class="token builtin class-name">set</span> user1 <span class="token number">0</span> <span class="token number">900</span> <span class="token number">8</span>   <span class="token operator">&lt;</span>ç›´æ¥å›è½¦<span class="token operator">&gt;</span>alex   <span class="token operator">&lt;</span>ç›´æ¥å›è½¦<span class="token operator">&gt;</span>get user1  <span class="token operator">&lt;</span>ç›´æ¥å›è½¦<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¦å¤–è¿˜éœ€è¦å» phpinfo() ä¸­å»æŸ¥è¯¢ä¸€ä¸‹ memcached æ‰©å±•æ˜¯å¦å®‰è£…å®Œæ¯•ï¼</p></blockquote><ul><li>æ¸…ç©º memcached ä¸­æ‰€æœ‰æ•°æ®</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥é‡å¯ memcached æœåŠ¡å³å¯</span><span class="token function">service</span> memcached restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
            <tag> Memcached </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Memcached å®ç° Session å…±äº«</title>
      <link href="posts/af14a477.html"/>
      <url>posts/af14a477.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-Memcached-å®ç°-Session-å…±äº«"><a href="#ä½¿ç”¨-Memcached-å®ç°-Session-å…±äº«" class="headerlink" title="ä½¿ç”¨ Memcached å®ç° Session å…±äº«"></a>ä½¿ç”¨ Memcached å®ç° Session å…±äº«</h1><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7b30b73812fde12f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®ç° Session å…±äº«"></p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><blockquote><p>å½“æœ‰å¾ˆå¤šç”¨æˆ·çš„æ—¶å€™ï¼Œè¿™äº›ç”¨æˆ·çš„ç™»å½•ä½ç½®åœ¨å„ä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå› ä¸º session æ˜¯ç”Ÿæˆåœ¨æœåŠ¡å™¨ä¸Šçš„ï¼Œå½“ç”¨æˆ·äº’è®¿çš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™å‘ç°è‡ªå·±æœ‰æƒé™ï¼Œæœ‰æ—¶å€™å‘ç°è‡ªå·±æ²¡æœ‰æƒé™ã€‚å› ä¸ºç¼“å­˜æ˜¯é›†ä¸­å¼çš„ï¼Œæ‰€æœ‰çš„ç¼“å­˜éƒ½åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠ session æ”¾åˆ° memcached ç¼“å­˜ä¸­ã€‚æ‰€æœ‰æœåŠ¡å™¨éƒ½å¯ä»¥åœ¨å…¬ç”¨çš„æœåŠ¡å™¨ä¸Šé¢æ¥å– sessionï¼Œè¿™æ ·æ— è®ºç”¨æˆ·åœ¨å“ªä¸€å°æœåŠ¡å™¨ä¸Šé¢ç™»å½•ï¼Œéƒ½æœ‰æ­£ç¡®çš„ sessionã€‚è¿™æ ·çš„è¯ï¼Œæœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼Œç¬¬ä¸€ï¼Œè§£å†³äº† session å…±äº«çš„é—®é¢˜ã€‚ç¬¬äºŒï¼Œå½“ç”¨æˆ·é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œsession æ˜¯å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Šé¢çš„ï¼Œå› æ­¤å°±ä¼šå¢åŠ äº†ç£ç›˜çš„ IOï¼Œä½†æ˜¯å¦‚æœæ”¾åœ¨ç¼“å­˜ä¸­ï¼Œæ€§è´¨åˆ™å®Œå…¨ä¸ä¸€æ ·ã€‚</p></blockquote><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ul><li><h3 id="è®¾ç½®-php-ini-é…ç½®æ–‡ä»¶"><a href="#è®¾ç½®-php-ini-é…ç½®æ–‡ä»¶" class="headerlink" title="è®¾ç½® php.ini é…ç½®æ–‡ä»¶"></a>è®¾ç½® php.ini é…ç½®æ–‡ä»¶</h3></li></ul><p>vim /etc/php/7.2/fpm/php.ini</p><ol><li>å°† seesion å­˜å‚¨æ–¹å¼æ”¹ä¸º memcached</li></ol><p>é»˜è®¤ php æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜æ”¾ session çš„</p><pre class="line-numbers language-none"><code class="language-none">1337 session.save_handler = files<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å› æ­¤éœ€è¦ä¿®æ”¹æˆ memcached</p><pre class="line-numbers language-none"><code class="language-none">session.save_handler = "memcached"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>ä¿®æ”¹ session å­˜æ”¾ä½ç½®</li></ol><p>é»˜è®¤ php æ³¨é‡Šæ‰äº†</p><pre class="line-numbers language-none"><code class="language-none">1366 ;session.save_path = "/var/lib/php/sessions"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹ä¸º</p><blockquote><p>æ³¨æ„ï¼š192.168.174.128 æ˜¯æˆ‘è™šæ‹Ÿæœºçš„ ip åœ°å€ï¼Œè¿™é‡Œéœ€è¦ä¿®æ”¹æˆä½  memcached æœåŠ¡å™¨çš„ ip åœ°å€</p></blockquote><pre class="line-numbers language-none"><code class="language-none"># å¯¹äº php 5.6 åŠä»¥ä¸‹ï¼Œéœ€è¦å†™æˆå¦‚ä¸‹session.save_path = "tcp://192.168.174.128:11211"# å¯¹äº php 7 ä»¥ä¸Šå¯ä»¥ç›´æ¥å†™æˆsession.save_path = "192.168.174.128:11211"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><h3 id="å¦‚æœåªæƒ³å•ä¸ª-php-æ–‡ä»¶ï¼Œå–-session-çš„æ—¶å€™ç›´æ¥å–ç¼“å­˜ä¸­å–çš„è¯ï¼Œå¯ä»¥å¦‚ä¸‹è®¾ç½®"><a href="#å¦‚æœåªæƒ³å•ä¸ª-php-æ–‡ä»¶ï¼Œå–-session-çš„æ—¶å€™ç›´æ¥å–ç¼“å­˜ä¸­å–çš„è¯ï¼Œå¯ä»¥å¦‚ä¸‹è®¾ç½®" class="headerlink" title="å¦‚æœåªæƒ³å•ä¸ª php æ–‡ä»¶ï¼Œå– session çš„æ—¶å€™ç›´æ¥å–ç¼“å­˜ä¸­å–çš„è¯ï¼Œå¯ä»¥å¦‚ä¸‹è®¾ç½®"></a>å¦‚æœåªæƒ³å•ä¸ª php æ–‡ä»¶ï¼Œå– session çš„æ—¶å€™ç›´æ¥å–ç¼“å­˜ä¸­å–çš„è¯ï¼Œå¯ä»¥å¦‚ä¸‹è®¾ç½®</h3></li></ul><p>vim test.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"session.save_hander"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"memcached"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"session.save_path"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"192.168.174.128:11211"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><h3 id="å¦å¤–è¿˜å¯ä»¥é‡‡ç”¨-apache-æˆ–è€…-nginx-çš„æ–¹å¼è®¾ç½®"><a href="#å¦å¤–è¿˜å¯ä»¥é‡‡ç”¨-apache-æˆ–è€…-nginx-çš„æ–¹å¼è®¾ç½®" class="headerlink" title="å¦å¤–è¿˜å¯ä»¥é‡‡ç”¨ apache æˆ–è€… nginx çš„æ–¹å¼è®¾ç½®"></a>å¦å¤–è¿˜å¯ä»¥é‡‡ç”¨ apache æˆ–è€… nginx çš„æ–¹å¼è®¾ç½®</h3></li></ul><h2 id="å°†-session-æ”¾åˆ°-memcached-ä¸­çš„ç¼ºç‚¹ï¼š"><a href="#å°†-session-æ”¾åˆ°-memcached-ä¸­çš„ç¼ºç‚¹ï¼š" class="headerlink" title="å°† session æ”¾åˆ° memcached ä¸­çš„ç¼ºç‚¹ï¼š"></a>å°† session æ”¾åˆ° memcached ä¸­çš„ç¼ºç‚¹ï¼š</h2><p>é›†ç¾¤é”™è¯¯ä¼šå¯¼è‡´ç”¨æˆ·æ— æ³•ç™»é™†ã€memcached çš„å›æ”¶æœºåˆ¶å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·æ‰çº¿</p>]]></content>
      
      
      <categories>
          
          <category> Cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
            <tag> Memcached </tag>
            
            <tag> Session </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ç¼“å­˜ï¼ˆæ¨¡æ¿ç¼“å­˜ï¼‰</title>
      <link href="posts/8a518969.html"/>
      <url>posts/8a518969.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ç¼“å­˜ï¼ˆæ¨¡æ¿ç¼“å­˜ï¼‰"><a href="#æ–‡ä»¶ç¼“å­˜ï¼ˆæ¨¡æ¿ç¼“å­˜ï¼‰" class="headerlink" title="æ–‡ä»¶ç¼“å­˜ï¼ˆæ¨¡æ¿ç¼“å­˜ï¼‰"></a>æ–‡ä»¶ç¼“å­˜ï¼ˆæ¨¡æ¿ç¼“å­˜ï¼‰</h1><h2 id="ä»é¡µé¢ç‰‡æ®µç¼“å­˜åˆ°-facebook-çš„-BigPipe-æŠ€æœ¯"><a href="#ä»é¡µé¢ç‰‡æ®µç¼“å­˜åˆ°-facebook-çš„-BigPipe-æŠ€æœ¯" class="headerlink" title="ä»é¡µé¢ç‰‡æ®µç¼“å­˜åˆ° facebook çš„ BigPipe æŠ€æœ¯"></a>ä»é¡µé¢ç‰‡æ®µç¼“å­˜åˆ° facebook çš„ BigPipe æŠ€æœ¯</h2><ul><li>å°†é¡µé¢åˆ’åˆ†æˆä¸€ä¸ªä¸ªå°å—</li><li>åˆ©ç”¨ ob_flush() ä¸ flush() å°†ç¼“å†²åŒºçš„å†…å®¹æå‰è¾“å‡ºç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ä¸æ–­æ¥æ”¶å¹¶æ¸²æŸ“åˆ°é¡µé¢ï¼Œé€ä¸ªå°å—æ˜¾ç¤ºã€‚<ul><li>æ³¨ï¼šJS éƒ¨åˆ†ï¼Œä¸éœ€è¦ç«‹åˆ»æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œå¯ä»¥æœ€åå† eval è¿›æ¥</li></ul></li></ul><p>ç¨‹åºæ‰§è¡Œçš„æµç¨‹ä¸ºï¼š<br>program data -&gt; php buffer -&gt; tcp buffer -&gt; client browers</p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>ob_start()</td><td>æ‰“å¼€è¾“å‡ºç¼“å†²åŒº</td><td></td></tr><tr><td>ob_flush()</td><td>å°† PHP buffer ä¸­çš„å†…å®¹ï¼Œé€å‡ºåˆ° Tcp buffer ä¸­</td><td>è°ƒç”¨ ob_flush() ä¹‹åç¼“å†²åŒºå†…å®¹å°†è¢«ä¸¢å¼ƒã€‚</td></tr><tr><td>flush()</td><td>å°†å½“å‰ä¸ºæ­¢ Tcp buffer ä¸­å†…å®¹å‘é€åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ã€‚</td><td>flush() å‡½æ•°ä¸ä¼šå¯¹æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç¼“å­˜æ¨¡å¼äº§ç”Ÿå½±å“ã€‚å› æ­¤ï¼Œå¿…é¡»åŒæ—¶ä½¿ç”¨ ob_flush() å’Œ flush() å‡½æ•°æ¥åˆ·æ–°è¾“å‡ºç¼“å†²ã€‚</td></tr><tr><td>ob_get_contents()</td><td>è¿”å›å†…éƒ¨ç¼“å†²åŒºçš„å†…å®¹</td><td>åªæ˜¯å¾—åˆ°è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹ï¼Œä½†ä¸æ¸…é™¤å®ƒï¼Œæ²¡æœ‰æ¿€æ´»ï¼Œåˆ™è¿”å› false</td></tr><tr><td>ob_end_clean()</td><td>åˆ é™¤å†…éƒ¨ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶ä¸”å…³é—­å†…éƒ¨ç¼“å†²åŒºã€‚</td><td></td></tr><tr><td>ob_end_flush()</td><td>å‘é€å†…éƒ¨ç¼“å†²åŒºçš„å†…å®¹åˆ°æµè§ˆå™¨ï¼Œå¹¶ä¸”å…³é—­è¾“å‡ºç¼“å†²åŒº</td><td></td></tr><tr><td>ob_get_length()</td><td>è¿”å›å†…éƒ¨ç¼“å†²åŒºçš„é•¿åº¦</td><td></td></tr></tbody></table><h2 id="å¦‚ä½•ä½¿ç”¨è¿™é—¨æŠ€æœ¯ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨è¿™é—¨æŠ€æœ¯ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è¿™é—¨æŠ€æœ¯ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨è¿™é—¨æŠ€æœ¯ï¼Ÿ</h2><ul><li>nginx éœ€è¦è®¾ç½®</li></ul><p>sudo vim /etc/nginx/nginx.conf</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">fastcgi_keep_conn</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>  // é»˜è®¤æ˜¯å¼€å¯äº†å‹ç¼©ï¼Œéœ€è¦å…³é—­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>php éœ€è¦è®¾ç½®</li></ul><p>sudo vim /etc/php/7.0/fpm/php.ini</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">;</span>output_buffering <span class="token operator">=</span> <span class="token number">4096</span>output_buffering <span class="token operator">=</span> off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>é‡å¯ nginx å’Œ php</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> nginx restart<span class="token function">sudo</span> <span class="token function">service</span> php7.0-fpm restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ¨¡æ¿ä¸­ä½¿ç”¨</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// å¼€å¯ç¼“å†²åŒº</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// æ¨¡æ‹Ÿç¨‹åºæ‰§è¡Œç¼“æ…¢</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å°† php æ‰§è¡Œè¿‡çš„ä¸œè¥¿å‘é€ç»™ nginx æˆ–è€… apache</span><span class="token function">ob_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// nginx æˆ– apache å°†å†…å®¹å‘é€ç»™å®¢æˆ·ç«¯</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// å…³é—­ä¹‹å‰ä¹Ÿéœ€è¦å°†æœ€åçš„å†…å®¹å‘é€ç»™å®¢æˆ·ç«¯</span><span class="token function">ob_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ¸…ç†ç¼“å†²åŒº</span><span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®ç°çš„æ•ˆæœåŠä¼˜åŠ¿"><a href="#å®ç°çš„æ•ˆæœåŠä¼˜åŠ¿" class="headerlink" title="å®ç°çš„æ•ˆæœåŠä¼˜åŠ¿"></a>å®ç°çš„æ•ˆæœåŠä¼˜åŠ¿</h2><blockquote><p>é¡µé¢ä¸­æœ‰å¾ˆå¤šåˆ†å—å†…å®¹çš„æ—¶å€™ï¼Œå¯ä»¥å°†è®¸å¤šä¸ªåˆ†å—å†…å®¹åˆ†æ‰¹æ¬¡çš„åˆ·ç»™å®¢æˆ·ç«¯ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰çš„å†…å®¹åŠ è½½å®Œæ¯•æ‰èƒ½çœ‹åˆ°å†…å®¹ã€‚å¹¶ä¸”è¿™ç§æŠ€æœ¯åªæœ‰ä¸€æ¬¡è¯·æ±‚ï¼Œå¦‚æœé‡‡ç”¨ ajax çš„è¯ï¼Œå¯èƒ½ä¼šæƒ³åˆ°çš„æ˜¯ï¼Œæ¯ä¸ªåˆ†å—å†…å®¹ä½¿ç”¨ ajax è¯·æ±‚ä¸€æ¬¡ï¼Œè¿™æ ·çš„è¯å°±ä¼šæœ‰å¤šä¸ªè¯·æ±‚ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¨‹åºç¼“å­˜</title>
      <link href="posts/4230d41e.html"/>
      <url>posts/4230d41e.html</url>
      
        <content type="html"><![CDATA[<h1 id="æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¨‹åºç¼“å­˜"><a href="#æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¨‹åºç¼“å­˜" class="headerlink" title="æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¨‹åºç¼“å­˜"></a>æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¨‹åºç¼“å­˜</h1><h2 id="Web-Server-æœåŠ¡å™¨ä¹‹-Apache"><a href="#Web-Server-æœåŠ¡å™¨ä¹‹-Apache" class="headerlink" title="Web Server æœåŠ¡å™¨ä¹‹ Apache"></a>Web Server æœåŠ¡å™¨ä¹‹ Apache</h2><ol><li>Apache çš„è¿‡æœŸæ¨¡å— mod_expires.so</li></ol><p>é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ HTTP çš„ â€œExpires:â€ å’Œ â€œCache-Control:â€ å¤´å†…å®¹</p><pre class="line-numbers language-apache" data-language="apache"><code class="language-apache"># å¯ç”¨ expires_module æ¨¡å—LoadModule expires_module modules/mod_expires.so# å¯ç”¨æœ‰æ•ˆæœŸæ§åˆ¶ExpiresActive On# GIF æœ‰æ•ˆæœŸä¸º 1 ä¸ªæœˆï¼Œ2592000 ç§’ä¸º 1 ä¸ªæœˆExpiresByType image/gif A2592000# HTML æ–‡æ¡£çš„æœ‰æ•ˆæœŸæ˜¯æœ€åä¿®æ”¹æ—¶åˆ»åçš„ä¸€æ˜ŸæœŸExpiresByType text/html M604800# ä»¥ä¸‹çš„å«ä¹‰ç±»ä¼¼ExpiresByType text/css "now plus 2 months"ExpiresByType image/jpeg "access plus 2 months"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¦ç»†è§£é‡Š <code>ExpiresByType image/jpeg "access plus 2 months"</code> çš„å«ä¹‰ä¸ºï¼š<br><code>ExpiresByType</code> è¡¨ç¤ºä¸ºï¼šç”± mime å†³å®šè¿‡æœŸé…ç½®<br><code>image/jpeg</code> è¡¨ç¤ºä¸ºï¼šå…·ä½“æ–‡ä»¶çš„ mime ç±»å‹<br><code>access</code> è¡¨ç¤ºï¼šè¿‡æœŸæ—¶é—´ä»è®¿é—®æ—¶å¼€å§‹è®¡ç®—ï¼Œç­‰åŒäº <code>now</code> å’Œ <code>A</code> å‚æ•°ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸º <code>modification</code> æˆ–è€… <code>M</code> å‚æ•°ï¼Œè¡¨ç¤ºä¸ºï¼Œè¢«è®¿é—®æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´å¼€å§‹è®¡ç®—ã€‚<br><code>months</code> è¡¨ç¤ºæœˆä»½ï¼Œå¯ç”¨çš„å‚æ•°æœ‰ï¼š<code>years</code> ã€<code>months</code> ã€ <code>weeks</code> ã€ <code>days</code> ã€<code>hours</code> ã€ <code>minutes</code> ã€ <code>seconds</code></p><ol start="2"><li>Apache çš„ç¼“å­˜æ¨¡å— mod_cache</li></ol><ul><li>mod_cache: åŸºäº uri é”®çš„å†…å®¹åŠ¨æ€ç¼“å†²æ¨¡å—ï¼Œç¼“å­˜å“åº”å¤´å’Œæ­£æ–‡ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶å¿«é€Ÿç›¸åº”å®ƒã€‚<ul><li>mod_disk_cache (Apache2.2) / mod_cache_disk (Apache2.4) åŸºäºç£ç›˜çš„ç¼“å†²æ¨¡å—</li><li>mod_mem_cache.so (Apache2.2) åŸºäºå†…å­˜çš„ç¼“å†²æ¨¡å—ï¼Œ2.4 ç‰ˆæœ¬å·²ç»ç§»é™¤</li></ul></li><li>mod_file_cache æä¾›æ–‡ä»¶æè¿°ç¬¦ç¼“å­˜æ”¯æŒï¼ŒåŠ å¿«ä¸ç¼“æ…¢çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨çš„æ–‡ä»¶è®¿é—®ï¼Œåªèƒ½åº”ç”¨äºé™æ€æ–‡ä»¶ã€‚</li></ul><h2 id="php-çš„-APC-å’Œ-Opcache"><a href="#php-çš„-APC-å’Œ-Opcache" class="headerlink" title="php çš„ APC å’Œ Opcache"></a>php çš„ APC å’Œ Opcache</h2><ul><li>Opcache æ˜¯ä¸€ç§é€šè¿‡å°†è§£æçš„ php è„šæœ¬é¢„ç¼–è¯‘çš„å­—èŠ‚ç å­˜æ”¾åœ¨å…±äº«å†…å­˜ä¸­æ¥é¿å…æ¯æ¬¡åŠ è½½å’Œè§£æ php è„šæœ¬çš„å¼€é”€ã€‚</li><li>è§£æå™¨å¯ä»¥ç›´æ¥ä»å…±äº«å†…å­˜è¯»å–å·²ç»ç¼“å­˜çš„å­—èŠ‚ç ï¼Œä»è€Œå¤§å¤§æé«˜ php çš„æ‰§è¡Œæ•ˆç‡ã€‚</li><li>APC æ˜¯ç¼“å­˜ã€ä¼˜åŒ– php ä¸­é—´ä»£ç çš„æ¶æ„ï¼Œå¯ä»¥ç¼“å­˜ Opcodesã€‚</li><li>php5.5 ä»¥åï¼ŒZend Opcache æ•´åˆåˆ° php ä¸­ï¼Œå¹¶å¯ä»£æ›¿ APC ä½¿ç”¨ã€‚æ­¤åŠŸèƒ½é»˜è®¤å…³é—­ã€‚</li></ul><h3 id="å¦‚ä½•ä½¿ç”¨-Opcache-ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨-Opcache-ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Opcache ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ Opcache ï¼Ÿ</h3><ol><li>è®¿é—® phpinfo(); é¡µé¢ï¼ŒæŸ¥çœ‹ Loaded Configuration File =&gt; /etc/php/7.0/fpm/php.ini ï¼ˆphp é…ç½®æ–‡ä»¶ php.ini æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„ï¼‰ å’Œ Scan this dir for additional .ini files =&gt; /etc/php/7.0/fpm/conf.d ï¼ˆæ‰©å±•é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼‰</li><li>æŸ¥çœ‹ zend_extension=opcache.so æ˜¯å¦å¼€å¯ï¼švim /etc/php/7.0/fpm/conf.d/10-opcache.ini ï¼ˆé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰</li></ol><h3 id="php-æ‰§è¡Œè¿‡ç¨‹"><a href="#php-æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="php æ‰§è¡Œè¿‡ç¨‹"></a>php æ‰§è¡Œè¿‡ç¨‹</h3><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3638cd88c106c12f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="php ä»£ç æ‰§è¡Œæµç¨‹"></p><ul><li>æŸ¥çœ‹ lexing</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$source</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>EOT</span>&lt;?phpecho '1111';<span class="token delimiter symbol">EOT<span class="token punctuation">;</span></span></span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">token_get_all</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="mysql-æŸ¥è¯¢ç¼“å­˜"><a href="#mysql-æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="mysql æŸ¥è¯¢ç¼“å­˜"></a>mysql æŸ¥è¯¢ç¼“å­˜</h2><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-dd846d00e6ebf040.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mysql æŸ¥è¯¢ç¼“å­˜"></p><p>æŸ¥è¯¢ç¼“å­˜ç›¸å…³æœ‰ä¸¤ä¸ªå‚æ•°è®¾ç½®ï¼š</p><ol><li>query_cache_size æŸ¥è¯¢ç¼“å­˜å¤§å°ï¼Œé»˜è®¤ä¸º 16M</li><li>query_cache_type æœ‰ä¸‰ä¸ªå¯ç”¨å€¼ï¼Œ0 è¡¨ç¤ºä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œ1 è¡¨ç¤ºç¼“å­˜æ‰€æœ‰çš„ç»“æœï¼Œ2 è¡¨ç¤ºåœ¨ select è¯­å¥ä¸­ä½¿ç”¨äº† sql cache æŒ‡å®šç¼“å­˜æŸ¥è¯¢çš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œæ²¡æœ‰æŒ‡å®šåˆ™ä¸ç¼“å­˜ã€‚</li></ol><h3 id="è®¾ç½®æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é…ç½®"><a href="#è®¾ç½®æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é…ç½®" class="headerlink" title="è®¾ç½®æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é…ç½®"></a>è®¾ç½®æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é…ç½®</h3><ol><li>è¿›å…¥ä¸»é…ç½®æ–‡ä»¶ä¸­æŸ¥çœ‹ sudo vim /etc/mysql/my.cnf</li><li>è¿›å…¥é…ç½®æ–‡ä»¶ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">query_cache_size = 16M  // é»˜è®¤æŸ¥è¯¢ç¼“å­˜ä¸º 16Mquery_cache_type = 1  // å¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ è¿™ä¸€è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>é‡å¯ mysql æœåŠ¡å™¨ sudo service mysql restart</li><li>è¿›å…¥æ•°æ®åº“ mysql -u root -p</li><li>æŸ¥çœ‹ç¼“å­˜æ˜¯å¦å¼€å¯ show variables like â€œ%query_cache%â€;</li><li>æŸ¥è¯¢ç¼“å­˜æ˜¯å¦æ­£å¸¸è¿è¡Œäº† show status like â€œ%Qcache%â€;</li></ol><h3 id="mysql-Memory-å­˜å‚¨å¼•æ“"><a href="#mysql-Memory-å­˜å‚¨å¼•æ“" class="headerlink" title="mysql Memory å­˜å‚¨å¼•æ“"></a>mysql Memory å­˜å‚¨å¼•æ“</h3><p>åŸç†ï¼š</p><blockquote><p>åˆ›å»ºè¡¨ç»“æ„ä½¿ç”¨ ENGINE = MEMORY ç”Ÿæˆå†…å­˜è¡¨ï¼Œè¡¨ç»“æ„å­˜åœ¨ç£ç›˜ä¸Šçš„ <code>.frm</code> æ–‡ä»¶ä¸­ï¼ŒæœåŠ¡å™¨å¯åŠ¨åï¼Œç”¨æ­¤ç»“æ„åœ¨å†…å­˜ä¸­åˆ›å»ºç©ºç™½è¡¨ï¼Œå¹¶é»˜è®¤ä½¿ç”¨å“ˆå¸Œç´¢å¼•ã€‚</p></blockquote><p>ä¼˜ç‚¹ï¼š</p><ol><li>é€Ÿåº¦æ¯” MyISAM å’Œ Innodb å­˜å‚¨å¼•æ“æ›´å¿«ï¼Œé€‚åˆåšçƒ­ç‚¹è¡¨çš„å‰ç½®ç¼“å­˜ã€‚</li><li>sql æ“ä½œä¸å­˜å‚¨å¼•æ“ä¸€è‡´ã€‚</li></ol><p>ä½¿ç”¨è¦ç‚¹ï¼š</p><ol><li>varchar è¿™æ ·çš„å¯å˜é•¿åº¦ç±»å‹å°†è½¬æ¢ä¸ºå›ºå®šé•¿åº¦</li><li>mysql 4.1.0 ä¹‹å‰ï¼Œä¸æ”¯æŒ auto_increment è‡ªå¢åˆ—</li><li>ä¸èƒ½åŒ…å« blob æˆ– text åˆ—</li><li>é‡å¯æ•°æ®ä¸¢å¤±ï¼Œå¦‚æœæœ‰å¤‡ä»½ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸å¤‡ä»½ä¸ä¸€è‡´</li><li>å†…å­˜è¡¨æ•°æ®å¤§äº max_heap_table_size è®¾å®šå€¼ï¼Œè¶…å‡ºæ•°æ®ä¼šå­˜å‚¨åˆ°ç£ç›˜ä¸Š</li><li>é«˜è´Ÿè½½æ—¶æ‰©å±•æ€§å’Œæ··åˆå†™æ“ä½œçš„å¹¶å‘å¤„ç†æ€§èƒ½ä¸ä½³</li></ol>]]></content>
      
      
      <categories>
          
          <category> Cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨ç¼“å­˜</title>
      <link href="posts/be7c79f7.html"/>
      <url>posts/be7c79f7.html</url>
      
        <content type="html"><![CDATA[<h1 id="æµè§ˆå™¨ç¼“å­˜"><a href="#æµè§ˆå™¨ç¼“å­˜" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜"></a>æµè§ˆå™¨ç¼“å­˜</h1><ul><li>æµè§ˆå™¨å¤„ç†ç½‘é¡µçš„æ–¹å¼</li></ul><ol><li>èµ°åˆ°åå•†ç¼“å­˜ä¼šè¿”å› 304</li><li>èµ°åˆ°å¼ºç¼“å­˜ä¼šè¿”å› 200</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f123261940f40366.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æµè§ˆå™¨ç¼“å­˜æ‰§è¡Œæµç¨‹"></p><ul><li>åˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜</li></ul><ol><li>é¡µé¢è¿æ¥çš„è¯·æ±‚æ— é¡»åšé•¿æ—¶é—´ç¼“å­˜</li><li>æ•æ„Ÿæ•°æ®åƒè®¢å•ç­‰ä¸å®œåšç¼“å­˜</li><li>é™æ€èµ„æºéƒ¨åˆ†ï¼Œé€šå¸¸ä¼šè®¾å®šä¸€ä¸ªè¾ƒé•¿çš„ç¼“å­˜æ—¶é—´</li><li>å†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œå‡å°‘è¯·æ±‚é‡</li><li>ä¸è¦éšæ„ä¿®æ”¹æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨ ?version=** è°ƒç”¨å¤šç‰ˆæœ¬</li><li>ä¸å»ºè®®ä½¿ç”¨ ETag,å°¤å…¶æ˜¯åˆ†å¸ƒå¼</li></ol><ul><li>header å­—æ®µè¾“å‡ºæ–¹å¼</li></ul><ol><li>html è¾“å‡ºæ–¹å¼</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cache-Control<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>max-age=7200<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>php è¾“å‡ºæ–¹å¼</li></ol><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Cache-Control:max-age=7200'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><strong>å¼ºç¼“å­˜é˜¶æ®µçš„ header å­—æ®µ</strong></li></ul><p>å¯ç”¨å¼ºç¼“å­˜çš„çŠ¶æ€ä¸º 200 (from disk cache)</p><p>æ‰§è¡Œåˆ°å¼ºç¼“å­˜çš„æ—¶æœºä¸ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">graph TDA[æµè§ˆå™¨] --&gt; B[æ˜¯å¦æœ‰ç¼“å­˜]B --&gt; C{Yes or No?}C --&gt; |yes| D[æ˜¯å¦è¿‡æœŸ]D --&gt; |no| E[å°±ä½¿ç”¨ç¼“å­˜ä¸­çš„å†…å®¹]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Pragma (HTTP 1.0)</li><li>Expires (HTTP 1.0)  ï¼ˆè®¾å®šçš„æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ—¶é—´ï¼‰</li><li>Cache-control (HTTP 1.1)<ul><li>max-age ï¼ˆç¼“å­˜æœ€å¤§çš„ç§’æ•°ï¼‰</li><li>Public \ private ï¼ˆå½“è®¾ç½®ä¸º public ä¸”é‡‡ç”¨ https åè®®çš„æ—¶å€™ï¼Œä¹Ÿä¼šè½¬æ¢æˆ privateï¼‰</li><li>no-cache \ no-store ï¼ˆä¸å…è®¸å­˜æ”¾åœ¨ç”¨æˆ·çš„ç¡¬ç›˜é‡Œï¼‰ \ must-revalidate ï¼ˆå¿…é¡»è¯·æ±‚è®¤è¯ï¼‰</li></ul></li></ul><blockquote><p>å¦‚æœè¿™ä¸‰ä¸ªå‚æ•°åŒæ—¶å‡ºç°çš„è¯ï¼šé‚£ä¹ˆä¼˜å…ˆé¡ºåºä¸ºï¼Œ1ã€Cache-control 2ã€Pragma 3ã€Expires</p></blockquote><ul><li><strong>åå•†ç¼“å­˜é˜¶æ®µçš„ header å­—æ®µ</strong></li></ul><p>å¯ç”¨åå•†ç¼“å­˜çš„çŠ¶æ€ä¸º 304 Not Modified</p><ol><li>Last-Modifiedï¼šæœ«æ¬¡æ›´æ–°æ ‡è®°ï¼Œæ–‡ä»¶æœ€åä¸€æ¬¡æ›´æ–°çš„å…·ä½“æ—¶é—´ï¼ˆä¸‹è¡Œ responseï¼‰</li><li>If-Modified-Since ï¼šèµ„æºä¸Šæ¬¡çš„ä¿®æ”¹æ—¶é—´ï¼ˆä¸Šè¡Œ requestï¼‰</li><li>E-Tag ï¼š å®ä½“ä¸æ ‡è®°ï¼ˆä¸‹è¡Œï¼‰</li><li>If-None-Match ï¼šèµ„æºå†…å®¹æ ‡è¯†ï¼ˆä¸Šè¡Œï¼‰</li></ol><p>åå•†ç¼“å­˜çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">graph TDA[æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨] --&gt; B[æœåŠ¡å™¨ Response Headers æºå¸¦ last-modified: Mon, 21 Oct 2019 00:44:35 GMT è¿”å›ç»™æµè§ˆå™¨]B --&gt; C[æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚æœåŠ¡å™¨ Request Headers æºå¸¦ If-Modified-Since: Mon, 21 Oct 2019 00:44:35 GMT]C --&gt; D{If-Modified-Since å’Œæ–‡ä»¶çš„ Last-Modified ä½œæ¯”è¾ƒ}D --&gt; |yes| E[æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´æ²¡æœ‰å˜åŒ–]E --&gt; F[Status Code: 304 Not Modified]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸º Last-Modified å’Œ  If-Modified-Since å­—æ®µçš„æœ€å°é¢—ç²’åº¦ä¸ºç§’ ï¼ˆMon, 21 Oct 2019 00:44:35 GMTï¼‰ ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šå½“æŸä¸ªæ–‡ä»¶åœ¨ 1s ä¸­æ›´æ”¹ n æ¬¡æ—¶ï¼ŒæœåŠ¡å™¨å°±å®Œå…¨ä¸çŸ¥é“æ˜¯å¦éœ€è¦æ‰§è¡Œå¼ºåˆ¶ç¼“å­˜ã€‚è¿™å°±å¼•å…¥äº† E-Tag çš„æ¦‚å¿µã€‚å½“æ–‡ä»¶åªè¦ä¿®æ”¹æ—¶ï¼ŒE-Tag å°±ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹‹åæµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œé‡æ–°ç”Ÿæˆçš„å­—ç¬¦ä¸²è¢« If-None-Match å­—æ®µæºå¸¦ã€‚ã€ŒE-Tagã€ã€ã€ŒIf-None-Matchã€ å’Œ ã€ŒLast-Modifiedã€ã€ã€ŒIf-Modified-Sinceã€æ‰§è¡Œæµç¨‹å®Œå…¨ä¸€è‡´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cache </tag>
            
            <tag> ç¼“å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows10 ä¸“ä¸šç‰ˆ 64ä½ç³»ç»Ÿå®‰è£…dockerå¹¶ä½¿ç”¨ laradock æ­å»º laravel ç¯å¢ƒ</title>
      <link href="posts/f59f8f31.html"/>
      <url>posts/f59f8f31.html</url>
      
        <content type="html"><![CDATA[<h1 id="windows10-ä¸“ä¸šç‰ˆ-64-ä½ç³»ç»Ÿå®‰è£…-docker-å¹¶ä½¿ç”¨-laradock-æ­å»º-laravel-ç¯å¢ƒ"><a href="#windows10-ä¸“ä¸šç‰ˆ-64-ä½ç³»ç»Ÿå®‰è£…-docker-å¹¶ä½¿ç”¨-laradock-æ­å»º-laravel-ç¯å¢ƒ" class="headerlink" title="windows10 ä¸“ä¸šç‰ˆ 64 ä½ç³»ç»Ÿå®‰è£… docker å¹¶ä½¿ç”¨ laradock æ­å»º laravel ç¯å¢ƒ"></a>windows10 ä¸“ä¸šç‰ˆ 64 ä½ç³»ç»Ÿå®‰è£… docker å¹¶ä½¿ç”¨ laradock æ­å»º laravel ç¯å¢ƒ</h1><blockquote><p><a href="https://www.docker.com/">dockerå®˜ç½‘</a><br><a href="https://docs.docker.com/install/">dockerå®˜ç½‘å®‰è£…æ–‡æ¡£</a></p></blockquote><h2 id="å®‰è£…è¯´æ˜"><a href="#å®‰è£…è¯´æ˜" class="headerlink" title="å®‰è£…è¯´æ˜"></a>å®‰è£…è¯´æ˜</h2><ul><li><h3 id="windows-10-ç³»ç»Ÿéœ€è¦å¼€å¯-Hyper-V"><a href="#windows-10-ç³»ç»Ÿéœ€è¦å¼€å¯-Hyper-V" class="headerlink" title="windows 10 ç³»ç»Ÿéœ€è¦å¼€å¯ Hyper-V"></a>windows 10 ç³»ç»Ÿéœ€è¦å¼€å¯ Hyper-V</h3></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1c2cfe770c1a9c08.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®˜æ–¹æ–‡æ¡£ä¸­æœ‰å†™åˆ°ï¼Œå¿…é¡»å¼€å¯ Hyper-V"></p><p>å¼€å¯æ–¹å¼å¦‚ä¸‹å›¾ï¼š</p><ol><li><p>æ‰“å¼€æ§åˆ¶é¢æ¿-ç¨‹åº-ç¨‹åºå’ŒåŠŸèƒ½-å¯ç”¨æˆ–å…³é—­ windows åŠŸèƒ½<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8c02d2b070ab1bfd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯ç”¨æˆ–å…³é—­ windows åŠŸèƒ½"></p></li><li><p>æ‰¾åˆ°æœ‰å…³  Hyper-V  çš„é¡¹ï¼Œå…¨éƒ¨é€‰ä¸­<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4a53340ebf3d7ebc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ‰å…³ Hyper-V çš„é€‰é¡¹ï¼Œå…¨éƒ¨å‹¾é€‰"></p></li><li><p>å¦‚æœå‘ç°å…³äº Hyper-V çš„é€‰é¡¹æ— æ³•å¼€å¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›å…¥ bios å¼€å¯è™šæ‹ŸåŒ–ã€‚å¼€å¯æ–¹æ³•è§å¦‚ä¸‹é“¾æ¥ï¼š</p></li></ol><blockquote><p><a href="https://www.windows10.pro/how-to-see-if-the-computer-can-run-hyper-v-virtual-machines/">å¦‚ä½•æŸ¥çœ‹è‡ªå·±çš„Win10ç”µè„‘æ˜¯å¦èƒ½è¿è¡ŒHyper-Vè™šæ‹Ÿæœº</a></p></blockquote><blockquote><p>æŸ¥çœ‹ Hyper-V å›ºä»¶ä¸­å¯ç”¨çš„è™šæ‹ŸåŒ–æ˜¯å¦å¼€å¯çš„æ­¥éª¤ï¼šWin + R è¾“å…¥ â€œmsinfo32 â€ å³å¯çœ‹åˆ°â€œç³»ç»Ÿä¿¡æ¯â€çª—å£ã€‚<br>è¿›å…¥ bios å¼€å¯å›ºä»¶è™šæ‹ŸåŒ–çš„æ–¹æ³•æ­¥éª¤ï¼šè¿›å…¥ bios è®¾ç½®ç•Œé¢ï¼Œåˆ‡æ¢åˆ° Advanced æ ‡ç­¾ï¼Œé€‰ä¸­ CPU Configuration è®¾ç½® Intel Virtualization Technology ä¸º Enabledã€‚ï¼ˆä¸åŒçš„ä¸»æ¿å¯èƒ½ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹æ³•ï¼Œä¸»è¦æ˜¯å°† Intel Virtualization Technology è®¾ç½®ä¸º Enabled å³å¯ï¼‰</p></blockquote><ol start="4"><li>å†æ¬¡æ‰“å¼€ã€å¯ç”¨æˆ–å…³é—­ windows åŠŸèƒ½ç•Œé¢ã€‘å¼€å¯ Hyper-V æ‰€æœ‰é€‰é¡¹ã€‚<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0aded33529879bf5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸ç®¡æ€æ ·ï¼Œä¸»è¦çš„æ­¥éª¤æ˜¯å¼€å¯ Hyper-V æ‰€æœ‰é€‰é¡¹"></li></ol><ul><li><h3 id="ä¸‹è½½-Docker-Desktop-for-Windows-desktop-app"><a href="#ä¸‹è½½-Docker-Desktop-for-Windows-desktop-app" class="headerlink" title="ä¸‹è½½ Docker Desktop for Windows desktop app"></a>ä¸‹è½½ Docker Desktop for Windows desktop app</h3></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f853b71da33b32c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®˜æ–¹æ–‡æ¡£è¯¦ç»†æ­¥éª¤"></p><ol><li><p>ä¸‹è½½ Docker Desktop for Windows app</p><blockquote><p><a href="https://download.docker.com/win/stable/Docker%20for%20Windows%20Installer.exe">Docker Desktop Installer.exe ä¸‹è½½å®‰è£…åœ°å€</a></p></blockquote></li><li><p>ä¸‹è½½å®Œæˆä¹‹åï¼Œç›´æ¥åŒå‡»å®‰è£…<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-901ae0bb45645f92.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…è¿‡ç¨‹å›¾01"></p></li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-922d3317a0152afc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…è¿‡ç¨‹å›¾02"></p><ol start="3"><li><p>å¼€å¯ docker<br>ç›´æ¥å¯ä»¥é€šè¿‡å°å¨œåŠ©æ‰‹æœ docker å…³é”®è¯ï¼Œç„¶åå¯åŠ¨ Docker Desktopï¼Œä¸ç®¡æ€æ ·ï¼Œä¸»è¦æ˜¯æ‰¾åˆ° Docker Desktop åº”ç”¨ï¼Œæ‰“å¼€å°±å¥½ã€‚<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e6b8377c984ee245.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ¬å›¾é€šè¿‡å°å¨œåŠ©æ‰‹æœ docker å…³é”®è¯æ‰“å¼€"></p></li><li><p>æŸ¥çœ‹ docker å¼€å¯çŠ¶æ€ã€‚<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-54e121b6e4f24813.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¡Œé¢å³ä¸‹è§’ä¼šå‡ºç° docker çš„å›¾æ ‡ï¼Œé¼ æ ‡ç§»åˆ°å›¾æ ‡ä¸Šé¢ä¼šå‡ºç° Docker Desktop is running å­—æ ·ï¼Œå³ä¸ºæ‰“å¼€"></p></li></ol><blockquote><p>åˆæ¬¡å®‰è£…æ—¶ï¼Œå¯èƒ½ä¼šæç¤ºä½ ç™»å½• docker çš„è´¦å·ï¼Œå¦‚æœæ²¡æœ‰ docker è´¦å·çš„è¯ï¼Œå¯ä»¥å» docker å®˜ç½‘æ³¨å†Œä¸€ä¸‹ã€‚</p></blockquote><ol start="5"><li>æµ‹è¯•å®‰è£…ã€‚<br>ä»»æ„ä½ç½®æ‰“å¼€ Windows PowerShell<pre class="line-numbers language-none"><code class="language-none">// æŸ¥çœ‹ docker ç‰ˆæœ¬docker --version docker-compose --versiondocker run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e644b75b3cb1da7b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨ PowerShell å’Œ cmdæ˜¯ä¸€æ ·çš„"></li></ol><ul><li><h3 id="ä½¿ç”¨-laradock-æ­å»ºé¡¹ç›®"><a href="#ä½¿ç”¨-laradock-æ­å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨ laradock æ­å»ºé¡¹ç›®"></a>ä½¿ç”¨ laradock æ­å»ºé¡¹ç›®</h3></li></ul><ol><li>å°† laradock é¡¹ç›®ä»£ç å…‹éš†åˆ°æœ¬åœ°ï¼š<pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/Laradock/laradock.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-22cb4a41faae8ed0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½ laradock é¡¹ç›®åˆ°æœ¬åœ°"></p><ol start="2"><li>è¿›å…¥ <code>laradock</code> ç›®å½•å°† <code>env-example</code> å¤åˆ¶ä¸€ä»½å¹¶å‘½åä¸º <code>.env</code><pre class="line-numbers language-none"><code class="language-none">cp env-example .env<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2ba18bf82bcb896a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤åˆ¶é…ç½®æ–‡ä»¶"></p><ol start="3"><li>è¿è¡Œå®¹å™¨ ï¼ˆæ­¤æ—¶åœ¨ laradock ç›®å½•ä¸‹ï¼‰<pre class="line-numbers language-none"><code class="language-none">docker-compose up -d nginx mysql redis workspace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>å¦‚æœæŒ‡å®šç«¯å£å·²ç»è¢«å ç”¨ï¼Œè¿è¡Œä¸Šè¿°å‘½ä»¤ä¼šæŠ¥é”™ï¼Œå…³é—­ç›¸åº”çš„æœåŠ¡å†é‡æ–°è¿è¡Œä¸Šè¿°å‘½ä»¤å³å¯ã€‚</li></ol><blockquote><p>æ³¨ï¼šå®‰è£…è¿‡ç¨‹ä¸­ï¼Œç”±äºæŸäº›èµ„æºéœ€è¦ç¿»å¢™æ‰èƒ½ä¸‹è½½ï¼Œå»ºè®®å®‰è£…å¹¶å¯ç”¨ VPN åå†æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚å¦‚æœå‡ºç°éœ€è¦è®¤è¯çš„ä¸‹è½½èµ„æºæ— æƒä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡ Docker ID/å¯†ç  ç™»å½•åˆ° Docker åº”ç”¨ï¼ˆç‚¹å‡»çŠ¶æ€æ  Docker åº”ç”¨å°å›¾æ ‡å°±èƒ½çœ‹åˆ°ç™»å½•èœå•ï¼‰ï¼Œæ³¨æ„è¿™é‡Œå¿…é¡»ç”¨ Docker IDï¼Œä¸èƒ½ç”¨æ³¨å†Œé‚®ç®±ã€‚åœ¨ Windows ä¸‹å¦‚æœå‡ºç°ç›®å½•æŒ‚è½½å¤±è´¥ï¼Œå¯ä»¥å°è¯•åœ¨ Docker è®¾ç½®ä¸­é‡æ–°è®¾ç½® Shared Drivesã€‚</p></blockquote><ol start="4"><li><p>æ‰“å¼€é¡¹ç›®çš„ <code>.env</code> æ–‡ä»¶å¹¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">DB_HOST=mysqlREDIS_HOST=redisQUEUE_HOST=beanstalkd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨å’Œ laradock åŒçº§ç›®å½•ä¸‹æ–°å»º wwwroot ç›®å½•ï¼Œç”¨äºå­˜æ”¾ä»£ç <br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ec64df8bf3dd4e16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»º wwwroot ç›®å½•"></p></li></ol><p>æ–°å»º demo æ–‡ä»¶å¤¹ï¼Œå¹¶å†™å…¥ phpinfo(); åˆ° index.php ä½œä¸ºæµ‹è¯•ã€‚<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-95be36bbd3077799.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºæµ‹è¯•æ–‡ä»¶"></p><ol start="6"><li>æ­¤æ—¶éœ€è¦å†æ¬¡åœ¨ <code>.env</code> æ–‡ä»¶ä¸­ä¿®æ”¹ <code>APPLICATION</code> é…ç½®é¡¹ï¼ˆæ–°ç‰ˆæœ¬çš„ laradock å¯¹åº”çš„é…ç½®é¡¹æ˜¯ <code>APP_CODE_PATH_HOST</code>ï¼‰</li></ol><pre class="line-numbers language-none"><code class="language-none">APPLICATION=../wwwroot/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-826d4ee6853f37e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®é¡¹ç›®è·¯å¾„"></p><p>è¿™æ ·å°±ç›¸å½“äºä¸º wwwroot ä¸ Docker çš„ /var/www ç›®å½•å»ºç«‹äº†è½¯è¿æ¥ï¼Œç„¶åæˆ‘ä»¬ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œå»ºç«‹æ˜ å°„å…³ç³»ã€‚</p><pre class="line-numbers language-none"><code class="language-none">// å¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶ demo.confcp ./laradock/nginx/sites/default.conf ./laradock/nginx/sites/demo.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¿®æ”¹æˆä»¥ä¸‹å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">server {    listen 80;    listen [::]:80;    server_name demo.test;    root /var/www/demo;    index index.php index.html index.htm;    location / {         try_files $uri $uri/ /index.php$is_args$args;    }    location ~ \.php$ {        try_files $uri /index.php =404;        fastcgi_pass php-upstream;        fastcgi_index index.php;        fastcgi_buffers 16 16k;        fastcgi_buffer_size 32k;        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;        #fixes timeouts        fastcgi_read_timeout 600;        include fastcgi_params;    }    location ~ /\.ht {        deny all;    }    location /.well-known/acme-challenge/ {        root /var/www/letsencrypt/;        log_not_found off;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡å¯ Docker çš„ Nginx</p><pre class="line-numbers language-none"><code class="language-none">docker-compose up -d nginx <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li><p>åœ¨ hosts æ–‡ä»¶ä¸­æ·»åŠ  ï¼ˆWindows ä¸‹å¯¹åº”æ–‡ä»¶è·¯å¾„æ˜¯ <code>C:\Windows\System32\drivers\etc\hosts</code>ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">127.0.0.1 demo.test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨æµè§ˆå™¨ä¸­è®¿é—® demo.test<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-af86d3cc7ce05b58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¦‚å›¾æ‰€ç¤ºï¼Œåˆ™è¡¨ç¤º php ç¯å¢ƒæ­å»ºæˆåŠŸï¼"></p></li><li><p>å®‰è£…å¤šé¡¹ç›®ã€‚æ¯”å¦‚æ­å»º laravel é¡¹ç›®<br>åœ¨ wwwroot ç›®å½•ä¸‹æ‰§è¡Œ composer å‘½ä»¤ ï¼ˆéœ€è¦æå‰åœ¨ Windows ç¯å¢ƒä¸­å®‰è£… composerï¼‰<br>å¯ä»¥æŸ¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç«  <a href="https://www.jianshu.com/p/8eea56dbd246">Windowså®‰è£…composer</a></p></li></ol><pre class="line-numbers language-none"><code class="language-none">composer create-project laravel/laravel blog --prefer-dist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0a826d3e36db460a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ­å»º laravel é¡¹ç›® blog"></p><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5a4382fac6349a5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¡¹ç›®éƒ½åœ¨ wwwroot ç›®å½•ä¸‹"></p><ol start="10"><li><p>æ·»åŠ  nginx é…ç½®æ–‡ä»¶è¿½åŠ  hosts é…ç½®<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-cea8ec0325dba714.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é‡æ–°å¤åˆ¶ä¸€ä»½ default.conf é…ç½®æ–‡ä»¶ï¼Œå¹¶ä½œç›¸åº”çš„é…ç½®ä¿®æ”¹"></p></li><li><p>é‡å¯ docker ä¸­çš„ nginx</p><pre class="line-numbers language-none"><code class="language-none">docker-compose up -d nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å½©è›‹</p></li></ol><ul><li>è¿›å…¥Workspace å®¹å™¨, æ‰§è¡Œæ¯”å¦‚(Artisan, Composer, PHPUnit, Gulp, â€¦)ç­‰å‘½ä»¤</li></ul><pre class="line-numbers language-none"><code class="language-none">docker-compose exec workspace bash æˆ–è€… docker exec -it laradock_workspace_1 bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ—å‡ºæ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨</li></ul><pre class="line-numbers language-none"><code class="language-none">docker ps<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</li></ul><pre class="line-numbers language-none"><code class="language-none">docker-compose stop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>è¿›å…¥ mysql å®¹å™¨</li></ul><pre class="line-numbers language-none"><code class="language-none">docker-compose exec mysql bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>é€€å‡ºå®¹å™¨</li></ul><pre class="line-numbers language-none"><code class="language-none">exit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Laradock </tag>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laradock ç¬”è®°</title>
      <link href="posts/17c35873.html"/>
      <url>posts/17c35873.html</url>
      
        <content type="html"><![CDATA[<h1 id="laradock-ç¬”è®°"><a href="#laradock-ç¬”è®°" class="headerlink" title="laradock ç¬”è®°"></a>laradock ç¬”è®°</h1><ul><li><a href="http://laradock.io/documentation/">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://laradock.linganmin.cn/zh/getting-started/">ä¸­æ–‡æ–‡æ¡£</a></li></ul><h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><ol><li>é¦–å…ˆå°† Laradock é¡¹ç›®ä»£ç å…‹éš†åˆ°æœ¬åœ°ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/Laradock/laradock.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>è¿›å…¥ laradock ç›®å½•å°† env-example é‡å‘½åä¸º .envï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> env-example .env<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶ååœ¨ .env ä¸­ä¿®æ”¹é•œåƒæ„å»ºè¿‡ç¨‹ä¸­ Linux è½¯ä»¶æºä¸ºå›½å†…é•œåƒä»¥å…é•œåƒæ„å»ºè¿‡ç¨‹ä¸­å‡ºç°ç½‘ç»œè¶…æ—¶é—®é¢˜ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CHANGE_SOURCE<span class="token comment"># If you need to change the sources (i.e. to China), set CHANGE_SOURCE to true</span><span class="token assign-left variable">CHANGE_SOURCE</span><span class="token operator">=</span>true<span class="token comment"># Set CHANGE_SOURCE and UBUNTU_SOURCE option if you want to change the Ubuntu system sources.list file.</span><span class="token assign-left variable">UBUNTU_SOURCE</span><span class="token operator">=</span>aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æ„å»ºé•œåƒ &amp; å¯åŠ¨å®¹å™¨ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> nginx mysql redis beanstalkd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>nginx é•œåƒæ„å»ºåœ¨ php-fpm ä¹‹ä¸Šï¼Œphp-fpm æ„å»ºåœ¨ workspace ä¹‹ä¸Šï¼Œæ‰€ä»¥å¯åŠ¨ nginx ä¼šå…ˆå¯åŠ¨ workspace å’Œ php-fpmã€‚</p><p>å¦‚æœæŒ‡å®šç«¯å£å·²ç»è¢«å ç”¨ï¼Œè¿è¡Œä¸Šè¿°å‘½ä»¤ä¼šæŠ¥é”™ï¼Œå…³é—­ç›¸åº”çš„æœåŠ¡å†é‡æ–°è¿è¡Œä¸Šè¿°å‘½ä»¤å³å¯ã€‚</p><p>å¦‚æœåœ¨ Windows ç³»ç»Ÿä¸­ä¸Šè¿°æŒ‡ä»¤æ„å»ºé•œåƒè¿‡ç¨‹ä¸­æŠ¥é”™ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/tmp/sources.sh: not found<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯å‚è€ƒè¿™ä¸ª issue è§£å†³ï¼š<a href="https://github.com/laradock/laradock/issues/2450%E3%80%82">https://github.com/laradock/laradock/issues/2450ã€‚</a></p><ol start="4"><li>æ‰“å¼€ Laravel é¡¹ç›®çš„ .env æ–‡ä»¶å¹¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span>mysql<span class="token comment"># è¿™é‡Œå¡«å†™å®¹å™¨çš„åç§°ï¼ˆæ¯”å¦‚ï¼šlaradock_redis_1ï¼‰æˆ–è€…å®¹å™¨çš„ ip åœ°å€ï¼ˆæ¯”å¦‚ï¼š172.28.0.5ï¼‰ä¹Ÿå¯ä»¥</span><span class="token assign-left variable">REDIS_HOST</span><span class="token operator">=</span>redis<span class="token assign-left variable">QUEUE_HOST</span><span class="token operator">=</span>beanstalkd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h2><ul><li>æ„å»ºé•œåƒ &amp; å¯åŠ¨å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> nginx mysql redis beanstalkd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><a href="https://laradock.linganmin.cn/zh/documentation/#%E6%9E%84%E5%BB%BA%E6%88%96%E9%87%8D%E6%9E%84%E5%AE%B9%E5%99%A8">é‡æ–°æ„å»ºå®¹å™¨</a></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯”å¦‚ï¼šé‡æ–°æ„å»º mysql å®¹å™¨</span><span class="token function">docker-compose</span> build mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¢åŠ ä¸€ä¸ªé¡¹ç›®ä¹‹å,é‡å¯ Docker çš„ nginx</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ—å‡ºå®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><span class="token function">docker</span> <span class="token function">ps</span><span class="token comment"># å¦‚æœä½ åªæƒ³çœ‹å½“å‰è¿™ä¸ªé¡¹ç›®çš„å®¹å™¨ï¼Œä½ ä¹Ÿå¯ä»¥æ‰§è¡Œä¸‹é¢è¿™ä¸ªå‘½ä»¤</span><span class="token function">docker-compose</span> <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é‡å¯å½“å‰è¿™ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼ˆå¦‚æœä½ ä¸æƒ³ä¸€ä¸ªä¸€ä¸ªçš„å¼€å¯æ¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å…³é—­å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><span class="token function">docker-compose</span> stop<span class="token comment"># åœæ­¢å•ä¸ªå®¹å™¨</span><span class="token function">docker-compose</span> stop <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿›å…¥å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›å…¥ä»»æ„å®¹å™¨</span><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span> <span class="token function">bash</span><span class="token comment"># è¿›å…¥ mysql å®¹å™¨</span><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> mysql <span class="token function">bash</span><span class="token comment"># è¿›å…¥ mysql å¹¶åœ¨ mysql å®¹å™¨ä¸­ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦</span><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> mysql mysql <span class="token parameter variable">-u</span> homestead <span class="token parameter variable">-psecret</span><span class="token comment"># è¿›å…¥ workspace å®¹å™¨,æ‰§è¡Œæ¯”å¦‚(Artisan, Composer, PHPUnit, Gulp, ...)ç­‰å‘½ä»¤</span><span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> workspace <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ é™¤æ‰€æœ‰ç°æœ‰å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> down<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶<br>NGINX æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨logs/nginxç›®å½•ä¸­<br>ä½†æ˜¯è¦æŸ¥çœ‹å…¶ä»–å®¹å™¨ï¼ˆMysqlï¼ŒPHP-FPM,â€¦ï¼‰çš„æ—¥å¿—ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> logs <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span><span class="token function">docker-compose</span> logs <span class="token parameter variable">-f</span> <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="åœ¨-laradock-ä¸­å®‰è£…-swoole"><a href="#åœ¨-laradock-ä¸­å®‰è£…-swoole" class="headerlink" title="åœ¨ laradock ä¸­å®‰è£… swoole"></a>åœ¨ laradock ä¸­å®‰è£… swoole</h2><p>åœ¨æœ¬åœ°å®‰è£…çš„è¯ï¼Œä»¥ Laradock ä¸ºä¾‹ï¼Œéœ€è¦åœ¨ laradock ç›®å½•ä¸‹çš„ .env ä¸­å°†ä¸‹é¢ä¸¤è¡Œé…ç½®å€¼è®¾ç½®ä¸º trueï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">WORKSPACE_INSTALL_SWOOLE</span><span class="token operator">=</span>true<span class="token assign-left variable">PHP_FPM_INSTALL_SWOOLE</span><span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åè¿è¡Œ <code>docker-compose build php-fpm workspace</code> é‡æ–°æ„å»º Docker å®¹å™¨ï¼Œæ„å»ºå®Œæˆåé‡å¯è¿™ä¸¤ä¸ªå®¹å™¨ï¼Œè¿›å…¥ workspace å®¹å™¨ï¼Œè¿è¡Œ <code>php -m</code> æŸ¥çœ‹ Swoole æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœæ‰©å±•åˆ—è¡¨åŒ…å« swoole åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p><h2 id="å…¶ä»–éœ€è¦æ³¨æ„äº‹é¡¹"><a href="#å…¶ä»–éœ€è¦æ³¨æ„äº‹é¡¹" class="headerlink" title="å…¶ä»–éœ€è¦æ³¨æ„äº‹é¡¹"></a>å…¶ä»–éœ€è¦æ³¨æ„äº‹é¡¹</h2><h3 id="åœ¨-laravel-æ¡†æ¶ä¸­ï¼Œå¦‚æœé…ç½®ä¸ç”Ÿæ•ˆï¼Œè¯·æ³¨æ„æ¸…ç†ä¸‹-laravel-çš„ç¼“å­˜"><a href="#åœ¨-laravel-æ¡†æ¶ä¸­ï¼Œå¦‚æœé…ç½®ä¸ç”Ÿæ•ˆï¼Œè¯·æ³¨æ„æ¸…ç†ä¸‹-laravel-çš„ç¼“å­˜" class="headerlink" title="åœ¨ laravel æ¡†æ¶ä¸­ï¼Œå¦‚æœé…ç½®ä¸ç”Ÿæ•ˆï¼Œè¯·æ³¨æ„æ¸…ç†ä¸‹ laravel çš„ç¼“å­˜"></a>åœ¨ <code>laravel</code> æ¡†æ¶ä¸­ï¼Œå¦‚æœé…ç½®ä¸ç”Ÿæ•ˆï¼Œè¯·æ³¨æ„æ¸…ç†ä¸‹ <code>laravel</code> çš„ç¼“å­˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan config:clear<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ£€æŸ¥ä¸‹æ˜¯å¦å¼€å¯äº†-5200-ç«¯å£"><a href="#æ£€æŸ¥ä¸‹æ˜¯å¦å¼€å¯äº†-5200-ç«¯å£" class="headerlink" title="æ£€æŸ¥ä¸‹æ˜¯å¦å¼€å¯äº† 5200 ç«¯å£"></a>æ£€æŸ¥ä¸‹æ˜¯å¦å¼€å¯äº† 5200 ç«¯å£</h3><blockquote><p>å®‰è£… netstat å‘½ä»¤ï¼ŒæŸ¥çœ‹ç«¯å£<br>apt-get update<br>apt-get install net-tools<br>netstat -ntlp</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">5200</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ç«¯å£æ˜ å°„å¼€å¯æ–¹å¼"><a href="#ç«¯å£æ˜ å°„å¼€å¯æ–¹å¼" class="headerlink" title="ç«¯å£æ˜ å°„å¼€å¯æ–¹å¼"></a>ç«¯å£æ˜ å°„å¼€å¯æ–¹å¼</h3><ol><li>è¿›å…¥ <code>laradock/docker-compose.yml</code></li></ol><p>åœ¨ <code>workspace</code> ä¸‹çš„ <code>ports</code> ä¸­æ–°å¢</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ports:  - <span class="token string">"<span class="token variable">${WORKSPACE_SSH_PORT}</span>:22"</span>  - <span class="token string">"<span class="token variable">${WORKSPACE_VUE_CLI_SERVE_HOST_PORT}</span>:8080"</span>  - <span class="token string">"<span class="token variable">${WORKSPACE_VUE_CLI_UI_HOST_PORT}</span>:8000"</span>  - <span class="token string">"<span class="token variable">${WORKSPACE_PORT}</span>:5200"</span>     /**è¿™ä¸€è¡Œä¸ºæ–°å¢çš„è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¿™é‡ŒåŠ  <span class="token number">5200</span>:5200 è¿™æ ·åŠ äº†ä¹‹åï¼Œå°±ä¸å†éœ€è¦åœ¨ .env ä¸­è®¾ç½®å˜é‡äº†**/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è¿›å…¥ <code>.env</code> åœ¨ <code>WORKSPACE</code> ä¸‹æœ€åä¸€è¡Œå¢åŠ </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">WORKSPACE_AST_VERSION</span><span class="token operator">=</span><span class="token number">1.0</span>.3<span class="token assign-left variable">WORKSPACE_VUE_CLI_SERVE_HOST_PORT</span><span class="token operator">=</span><span class="token number">8080</span><span class="token assign-left variable">WORKSPACE_VUE_CLI_UI_HOST_PORT</span><span class="token operator">=</span><span class="token number">8001</span><span class="token assign-left variable">WORKSPACE_INSTALL_GIT_PROMPT</span><span class="token operator">=</span>false<span class="token assign-left variable">WORKSPACE_PORT</span><span class="token operator">=</span><span class="token number">5200</span>  /**è¿™ä¸€è¡Œä¸ºæ–°å¢çš„è¡Œï¼Œå…¶å®å°±æ˜¯è®¾ç½®æ­¥éª¤ <span class="token number">1</span> ä¸­çš„å˜é‡**/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æœ‰äº›åšå®¢è¯´è¿˜éœ€è¦åœ¨ laradock/workspace/Dockerfile æ–‡ä»¶çš„æœ€åæ·»åŠ ä¸€è¡Œï¼Œç”³æ˜å¼€æ”¾ç«¯å£ï¼š EXPOSE 5200ï¼Œè¿™é‡Œï¼Œæˆ‘å¹¶æ²¡æœ‰åšè¿™ä¸€æ­¥ï¼ŒåŒæ ·ä¹ŸæˆåŠŸäº†ï¼Œå¦‚æœä½ æ²¡æœ‰æˆåŠŸï¼Œä½ åŠ ä¸Šå»ä¹‹åå†è¯•è¯•çœ‹å§</p></blockquote><ol start="3"><li>å¼ºåˆ¶é‡æ–°åˆ›å»º workspace å®¹å™¨</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> --force-recreate workspace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>é‡å¯ <code>docker-compose</code></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> restart <span class="token function">docker</span> <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="5"><li>æµ‹è¯•ç«¯å£æ˜¯å¦å¼€é€šæˆåŠŸ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">telnet <span class="token number">127.0</span>.0.1 <span class="token number">5200</span><span class="token comment"># æˆ–è€…ç›´æ¥æŸ¥çœ‹å®¹å™¨çš„ç«¯å£åˆ—è¡¨ä¸­æ˜¯å¦å«æœ‰ä½ æ‰€éœ€è¦å¼€é€šçš„ç«¯å£</span><span class="token function">docker</span> port <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span><span class="token comment"># æ¯”å¦‚ï¼Œå¦‚ä¸‹</span><span class="token function">docker</span> port laradock_workspace_1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
            <tag> Laradock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker å¸¸è§å‘½ä»¤</title>
      <link href="posts/59b529b7.html"/>
      <url>posts/59b529b7.html</url>
      
        <content type="html"><![CDATA[<h1 id="docker-å¸¸è§å‘½ä»¤"><a href="#docker-å¸¸è§å‘½ä»¤" class="headerlink" title="docker å¸¸è§å‘½ä»¤"></a>docker å¸¸è§å‘½ä»¤</h1><ul><li>æŸ¥çœ‹ç‰ˆæœ¬</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹è¯¦ç»†ç‰ˆæœ¬</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹ docker åŸºæœ¬ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> info<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="é•œåƒç›¸å…³çš„å‘½ä»¤"><a href="#é•œåƒç›¸å…³çš„å‘½ä»¤" class="headerlink" title="é•œåƒç›¸å…³çš„å‘½ä»¤"></a>é•œåƒç›¸å…³çš„å‘½ä»¤</h2><p>é•œåƒä»“åº“åœ°å€ï¼š<a href="https://hub.docker.com/">https://hub.docker.com</a></p><ul><li>æŸ¥çœ‹æœ¬åœ°å·²ç»å®‰è£…çš„é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> images<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æœç´¢æŒ‡å®šé•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> search <span class="token operator">&lt;</span>image-name<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚æœç´¢ centos é•œåƒ</span><span class="token function">docker</span> search centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‹‰å–é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull <span class="token operator">&lt;</span>image-name<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚æ‹‰å– centos é•œåƒï¼ˆå°†ä¼šæ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼Œå³ latest ç‰ˆæœ¬ï¼‰</span><span class="token function">docker</span> pull centos<span class="token comment"># æ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„é•œåƒ</span><span class="token function">docker</span> pull ubuntu:16.04<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ é™¤é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> rmi <span class="token operator">&lt;</span>image-name<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚åˆ é™¤ centos é•œåƒ</span><span class="token function">docker</span> rmi centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ é™¤æ‰€æœ‰çš„é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span><span class="token variable">)</span></span><span class="token comment"># æŸ¥çœ‹æ‰€æœ‰é•œåƒçš„é•œåƒ id</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ›´æ–°é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›´æ–°é•œåƒå‰ï¼Œéœ€è¦ä½¿ç”¨é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> ubuntu:15.10 <span class="token function">bash</span><span class="token comment"># åœ¨è¿è¡Œçš„å®¹å™¨å†…éƒ¨ä½¿ç”¨ apt-get update æ›´æ–°</span><span class="token comment"># æ›´æ–°å®Œæ¯•ä¹‹åï¼Œè¾“å…¥ exit å‘½ä»¤é€€å‡ºå®¹å™¨</span><span class="token comment"># ä½¿ç”¨ docker commit æ¥æäº¤å®¹å™¨å‰¯æœ¬</span><span class="token function">docker</span> commit <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">"has update"</span> <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">"alex"</span> e218edb10161 alex/ubuntu:v2<span class="token comment"># -m è¡¨ç¤ºæäº¤çš„æè¿°ä¿¡æ¯</span><span class="token comment"># -a è¡¨ç¤ºæäº¤çš„é•œåƒä½œè€…</span><span class="token comment"># e218edb10161 è¡¨ç¤ºå®¹å™¨çš„ id</span><span class="token comment"># alex/ubuntu:v2 è¡¨ç¤ºæŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå</span><span class="token comment"># æŸ¥çœ‹æ–°çš„é•œåƒ</span><span class="token function">docker</span> images<span class="token comment"># ä½¿ç”¨æ–°é•œåƒ alex/ubuntu:v2 æ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> alex/ubuntu:v2 <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ„å»ºé•œåƒ</li></ul><ol><li>vim  ~/glory/codes/book/demo/Dockerfile å¡«å……ä»¥ä¸‹å†…å®¹ï¼Œæ„å»ºä¸€ä¸ª centos 8 ç³»ç»Ÿ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŒ‡å®šä½¿ç”¨å“ªä¸ªé•œåƒæº</span>FROM centos:8<span class="token comment"># å¦‚æœå†™äº† 3 æ¬¡ RUN é‚£ä¹ˆå°†ä¼šåœ¨ docker ä¸Šæ–°å»º 3 å±‚ï¼Œä¼šå¯¼è‡´é•œåƒè†¨èƒ€è¿‡å¤§ï¼Œä¸‹é¢è¿™ç§æ–¹å¼åªä¼šåˆ›å»º 1 å±‚é•œåƒ</span>RUN /bin/echo <span class="token string">'root:123456'</span> <span class="token operator">|</span> chpasswd<span class="token punctuation">;</span> <span class="token punctuation">\</span><span class="token function">useradd</span> alex<span class="token punctuation">;</span> <span class="token punctuation">\</span>/bin/echo <span class="token string">'alex:123456'</span> <span class="token operator">|</span> chpasswd<span class="token punctuation">;</span> <span class="token punctuation">\</span>/bin/echo <span class="token parameter variable">-e</span> <span class="token string">"LANG=<span class="token entity" title="\&quot;">\"</span>en_US.UTF-8<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">&gt;</span> /etc/default/localEXPOSE <span class="token number">22</span>EXPOSE <span class="token number">80</span>CMD /usr/sbin/sshd <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å¼€å§‹æ„å»ºé•œåƒï¼Œæ³¨æ„ä¸è¦åœ¨ <code>~/glory/codes/book/demo</code> ç›®å½•ä¸‹æ”¾æ— ç”¨çš„æ–‡ä»¶ï¼Œå› ä¸ºä¼šæ‰“åŒ…æ‰€æœ‰è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ç„¶åå‘é€ç»™ docker å¼•æ“ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤šä¼šé€ æˆ build è¿‡ç¨‹ç¼“æ…¢</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># -t è¡¨ç¤ºæŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå</span><span class="token comment"># ~/glory/codes/book/demo è¡¨ç¤º Dockerfile æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</span><span class="token function">docker</span> build <span class="token parameter variable">-t</span> alex/centos:8.0 ~/glory/codes/book/demo<span class="token comment"># æŸ¥çœ‹å·²ç»æ„å»ºå¥½çš„é•œåƒä¿¡æ¯</span><span class="token function">docker</span> images<span class="token comment"># ä½¿ç”¨æ–°çš„é•œåƒæ¥åˆ›å»ºæ–°å®¹å™¨</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> alex/centos:8.0 <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è®¾ç½®é•œåƒæ ‡ç­¾</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…ˆæŸ¥çœ‹é•œåƒ</span>$ <span class="token function">docker</span> images                                                                   REPOSITORY            TAG                       IMAGE ID       CREATED          SIZEalex/centos           <span class="token number">8.0</span>                       594ab4747ed4   <span class="token number">14</span> minutes ago   210MB<span class="token comment"># è®¾ç½®é•œåƒæ ‡ç­¾</span>$ <span class="token function">docker</span> tag 594ab4747ed4 alex1/centos1:8.1.1<span class="token comment"># å†æ¬¡æŸ¥çœ‹é•œåƒä¿¡æ¯ä¼šå¤šä¸€ä¸ªæ ‡ç­¾</span>$ <span class="token function">docker</span> imagesREPOSITORY            TAG                       IMAGE ID       CREATED          SIZEalex/centos           <span class="token number">8.0</span>                       594ab4747ed4   <span class="token number">14</span> minutes ago   210MBalex1/centos1         <span class="token number">8.1</span>.1                     594ab4747ed4   <span class="token number">14</span> minutes ago   210MB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="å®¹å™¨ç›¸å…³çš„å‘½ä»¤"><a href="#å®¹å™¨ç›¸å…³çš„å‘½ä»¤" class="headerlink" title="å®¹å™¨ç›¸å…³çš„å‘½ä»¤"></a>å®¹å™¨ç›¸å…³çš„å‘½ä»¤</h2><ul><li>æŸ¥çœ‹å®¹å™¨çš„ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿›å…¥å®¹å™¨åæ‰§è¡Œ</span><span class="token function">cat</span> /proc/version<span class="token comment"># æ¯”å¦‚ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹</span>Linux version <span class="token number">4.19</span>.121-linuxkit <span class="token punctuation">(</span>root@18b3f92ade35<span class="token punctuation">)</span> <span class="token punctuation">(</span>gcc version <span class="token number">9.2</span>.0 <span class="token punctuation">(</span>Alpine <span class="token number">9.2</span>.0<span class="token punctuation">))</span> <span class="token comment">#1 SMP Thu Jan 21 15:36:34 UTC 2021</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span><span class="token comment"># æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œæ˜¯ä¸€æ ·çš„æ•ˆæœ</span><span class="token function">docker</span> container <span class="token function">ls</span> <span class="token parameter variable">-a</span><span class="token comment"># æŸ¥çœ‹æœ€åä¸€æ¬¡åˆ›å»ºçš„å®¹å™¨</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰å·²ç»è¿è¡Œçš„å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹å®¹å™¨ç«¯å£æ˜ å°„</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> port <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹ docker åº•å±‚ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šæŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„ ip åœ°å€ï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ docker å®¹å™¨çš„é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯</span><span class="token function">docker</span> inspect <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span> <span class="token comment"># æŸ¥çœ‹å®¹å™¨çš„ ip åœ°å€</span><span class="token function">docker</span> inspect <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> IPAddress<span class="token comment"># æ¯”å¦‚æŸ¥çœ‹å®¹å™¨ id ä¸º 66204be9fe65 çš„å®¹å™¨æ‰€å¯¹åº”çš„ ip åœ°å€</span><span class="token function">docker</span> inspect 66204be9fe65 <span class="token operator">|</span> <span class="token function">grep</span> IPAddress<span class="token comment"># æ¯”å¦‚æŸ¥çœ‹å®¹å™¨åç§°ä¸º alex æ‰€å¯¹åº”çš„ ip åœ°å€</span><span class="token function">docker</span> inspect alex <span class="token operator">|</span> <span class="token function">grep</span> IPAddress<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ›å»ºå®¹å™¨å¹¶æŠŠé•œåƒæ¢å¤åˆ°å®¹å™¨å½“ä¸­ï¼Œä¸”å¯åŠ¨å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token punctuation">[</span>-i<span class="token punctuation">]</span><span class="token punctuation">[</span>-t<span class="token punctuation">]</span><span class="token punctuation">[</span>-v<span class="token punctuation">]</span><span class="token punctuation">[</span>--name<span class="token punctuation">]</span><span class="token punctuation">[</span>-d<span class="token punctuation">]</span><span class="token punctuation">[</span>-p<span class="token punctuation">]</span><span class="token comment"># -i è¡¨ç¤º interactive äº¤äº’å¼</span><span class="token comment"># -t è¡¨ç¤ºå¾—åˆ°ä¸€ä¸ª terminal</span><span class="token comment"># --name è¡¨ç¤ºä¿®æ”¹å®¹å™¨åç§°</span><span class="token comment"># -d è¡¨ç¤ºä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼ˆé»˜è®¤ä¸ä¼šè¿›å…¥å®¹å™¨ï¼Œæƒ³è¦è¿›å…¥å®¹å™¨åˆ™éœ€è¦ä½¿ç”¨ docker exec å‘½ä»¤ï¼‰</span><span class="token comment"># -p è¡¨ç¤º **æŒ‡å®š** æ˜ å°„ç«¯å£</span><span class="token comment"># -P ï¼ˆå¤§å†™çš„å­—æ¯ p ï¼‰ è¡¨ç¤º **éšæœº** æ˜ å°„ç«¯å£</span><span class="token comment"># /bin/bash å’Œ bash ç­‰æ•ˆ</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>image-name<span class="token operator">&gt;</span> /bin/bash<span class="token comment"># æ¯”å¦‚åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨å¹¶ä¸”è¿›å…¥ ubuntu:16.04 é•œåƒ</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> ubuntu:16.04 <span class="token function">bash</span><span class="token comment"># æˆ–è€…</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> ubuntu:16.04 /bin/bash<span class="token comment"># æˆ–è€…</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> ubuntu:16.04<span class="token comment"># ä»¥ centos é•œåƒåˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼Œå¹¶ä¿®æ”¹æ–°å®¹å™¨åç§°ä¸º alex-container</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> alex-container centos <span class="token function">bash</span>  <span class="token comment"># ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ ï¼ˆåå°è¿è¡Œï¼‰</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> alex-container centos  <span class="token comment"># æˆ–è€…</span><span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">--name</span> alex-container centos<span class="token comment"># æŒ‡å®šå®¹å™¨ç»‘å®šçš„ç½‘ç»œåœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—® 127.0.0.1:5001 æ¥è®¿é—®å®¹å™¨çš„ 5000 ç«¯å£ï¼ˆé»˜è®¤ç»‘å®šçš„éƒ½æ˜¯ tcp ç«¯å£ï¼‰</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:5001:5000 centos:8.0 <span class="token function">bash</span><span class="token comment"># å¦‚æœéœ€è¦ç»‘å®š udp ç«¯å£ï¼Œåˆ™</span><span class="token comment"># ï¼ˆè¿˜å¯ä»¥è¿›å…¥å®¹å™¨å°±ç›´æ¥æ‰§è¡Œ python app.py å‘½ä»¤ï¼‰</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:5001:5000/udp centos:8.0 python app.py<span class="token comment"># æ¯”å¦‚ï¼Œå®‰è£… hyperf é•œåƒå¹¶å¯åŠ¨å®¹å™¨</span><span class="token comment"># å¦‚æœ docker å¯åŠ¨æ—¶å¼€å¯äº† selinux-enabled é€‰é¡¹ï¼Œå®¹å™¨å†…è®¿é—®å®¿ä¸»æœºèµ„æºå°±ä¼šå—é™ï¼Œæ‰€ä»¥å¯åŠ¨å®¹å™¨æ—¶å¯ä»¥å¢åŠ  --privileged -u root é€‰é¡¹</span><span class="token function">docker</span> run <span class="token parameter variable">--name</span> hyperf <span class="token punctuation">\</span><span class="token parameter variable">-v</span> /workspace/skeleton:/data/project <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9501</span>:9501 <span class="token parameter variable">-it</span> <span class="token punctuation">\</span><span class="token parameter variable">--privileged</span> <span class="token parameter variable">-u</span> root <span class="token punctuation">\</span><span class="token parameter variable">--entrypoint</span> /bin/sh <span class="token punctuation">\</span>hyperf/hyperf:7.4-alpine-v3.11-swoole<span class="token comment"># å¦‚æœéœ€è¦å¼€é€šå¤šä¸ªç«¯å£æ—¶ï¼Œå¯ä»¥å‚è€ƒ</span><span class="token function">docker</span> run <span class="token parameter variable">--name</span> api_dfo_hyperf_ws <span class="token punctuation">\</span><span class="token parameter variable">-v</span> /Users/pudongping/glory/codes/dfo/api_dfo_hyperf:/api_dfo_hyperf <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9502</span>:9502 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9503</span>:9503 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9504</span>:9504 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9505</span>:9505 <span class="token parameter variable">-it</span> <span class="token punctuation">\</span><span class="token parameter variable">--entrypoint</span> /bin/sh <span class="token punctuation">\</span>alex/alex_api_dfo:v1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> start <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å¯åŠ¨å®¹å™¨åç§°ä¸º redis-alex çš„å®¹å™¨</span><span class="token function">docker</span> start redis-alex<span class="token comment"># æ¯”å¦‚å¯åŠ¨å®¹å™¨ id ä¸º c8c0c770ac5b çš„å®¹å™¨</span><span class="token function">docker</span> start c8c0c770ac5b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç›´æ¥è¿›å…¥å·²ç»åˆ›å»ºçš„å®¹å™¨ï¼ˆä¸ä¼šå¯åŠ¨å®¹å™¨ï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> start <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚è¿›å…¥å®¹å™¨ id ä¸º 66204be9fe65 çš„å®¹å™¨</span><span class="token function">docker</span> start <span class="token parameter variable">-i</span> 66204be9fe65<span class="token comment"># æ¯”å¦‚è¿›å…¥å®¹å™¨åç§°ä¸º alex çš„å®¹å™¨</span><span class="token function">docker</span> start <span class="token parameter variable">-i</span> alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é‡å¯å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> restart <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚é‡å¯å®¹å™¨åç§°ä¸º redis-alex çš„å®¹å™¨</span><span class="token function">docker</span> restart redis-alex<span class="token comment"># æ¯”å¦‚é‡å¯å®¹å™¨ id ä¸º c8c0c770ac5b çš„å®¹å™¨</span><span class="token function">docker</span> restart c8c0c770ac5b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿›å…¥å·²ç»è¿è¡Œä¸­çš„å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span> <span class="token function">bash</span><span class="token comment"># æ¯”å¦‚è¿›å…¥å®¹å™¨åç§°ä¸º redis-alex çš„å®¹å™¨</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis-alex <span class="token function">bash</span><span class="token comment"># æ¯”å¦‚è¿›å…¥å®¹å™¨ id ä¸º c8c0c770ac5b çš„å®¹å™¨</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> c8c0c770ac5b <span class="token function">bash</span><span class="token comment"># è¿›å…¥å®¹å™¨ä¹‹åæ‰§è¡Œ shell å‘½ä»¤æˆ–è€…æ‰§è¡Œ shell è„šæœ¬</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span>  <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span> /bin/sh <span class="token parameter variable">-c</span> <span class="token string">"while true; do echo hello world; sleep 1; done"</span><span class="token comment"># æ¯”å¦‚è¿›å…¥å®¹å™¨ id ä¸º c8c0c770ac5b çš„å®¹å™¨ï¼Œå¹¶ä¸”è¿›å…¥å®¹å™¨åæ‰§è¡Œ `bash /portal_api_dfo_hyperf/server.sh restart` è„šæœ¬</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> c8c0c770ac5b /bin/sh <span class="token parameter variable">-c</span> <span class="token string">"bash /portal_api_dfo_hyperf/server.sh restart"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åœæ­¢å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> stop <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚åœæ­¢å®¹å™¨åç§°ä¸º redis-alex çš„å®¹å™¨</span><span class="token function">docker</span> stop redis-alex<span class="token comment"># æ¯”å¦‚åœæ­¢å®¹å™¨ id ä¸º c8c0c770ac5b çš„å®¹å™¨</span><span class="token function">docker</span> stop c8c0c770ac5b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€€å‡ºå®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ é™¤å®¹å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">rm</span> <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span class="token comment"># ä¹Ÿå¯ä»¥åŠ å…¥ -f å‚æ•°ï¼Œå¼ºåˆ¶ç§»é™¤æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨</span><span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> 1e560fca3906<span class="token comment"># æ¸…ç†æ‰æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨</span><span class="token function">docker</span> container prune<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¿®æ”¹å®¹å™¨åç§°</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">rename</span> <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>new-container-name<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å°†å®¹å™¨ redis-alex æ”¹åä¸º redis-tt</span><span class="token function">docker</span> <span class="token function">rename</span> redis-alex redis-tt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹å®¹å™¨çš„æ ‡å‡†è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> logs <span class="token operator">&lt;</span>container-name or container-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚æŸ¥çœ‹å®¹å™¨ id ä¸º c8c0c770ac5b çš„å®¹å™¨æ ‡å‡†è¾“å‡ºå†…å®¹</span><span class="token function">docker</span> logs c8c0c770ac5b<span class="token comment"># ä¹Ÿå¯ä»¥åŠ å…¥ -f å‚æ•°ï¼Œåƒä½¿ç”¨ tail -f ä¸€æ ·æ¥è¾“å‡ºå®¹å™¨å†…éƒ¨çš„æ ‡å‡†è¾“å‡º</span><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> c8c0c770ac5b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ‹·è´"><a href="#å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ‹·è´" class="headerlink" title="å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ‹·è´"></a>å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ‹·è´</h2><ul><li>ä»å®¿ä¸»æœºæ‹·è´æ–‡ä»¶åˆ°å®¹å™¨ä¸­</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">cp</span> <span class="token operator">&lt;</span>local-directory-or-file<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>container-name<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>container-directory-or-file<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å°†å®¿ä¸»æœºä¸­çš„ /home/alex/test.txt æ–‡ä»¶æ‹·è´åˆ° centos1 å®¹å™¨ä¸­çš„ /test.txt</span><span class="token function">docker</span> <span class="token function">cp</span> /home/alex/test.txt centos1:/test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä»å®¹å™¨æ‹·è´åˆ°å®¿ä¸»æœºä¸­</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">cp</span> <span class="token operator">&lt;</span>container-name<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>container-directory-or-file<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>local-directory<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å°† centos1 å®¹å™¨ä¸­çš„ /test ç›®å½•æ‹·è´åˆ°å®¿ä¸»æœºçš„ /home/alex ç›®å½•ä¸‹</span><span class="token function">docker</span> <span class="token function">cp</span> centos1:/test /home/alex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç›®å½•æŒ‚è½½ï¼ˆåˆ›å»ºå®¹å™¨çš„æ—¶å€™å°±éœ€è¦è¿›è¡Œç›®å½•æŒ‚è½½ï¼‰"><a href="#ç›®å½•æŒ‚è½½ï¼ˆåˆ›å»ºå®¹å™¨çš„æ—¶å€™å°±éœ€è¦è¿›è¡Œç›®å½•æŒ‚è½½ï¼‰" class="headerlink" title="ç›®å½•æŒ‚è½½ï¼ˆåˆ›å»ºå®¹å™¨çš„æ—¶å€™å°±éœ€è¦è¿›è¡Œç›®å½•æŒ‚è½½ï¼‰"></a>ç›®å½•æŒ‚è½½ï¼ˆåˆ›å»ºå®¹å™¨çš„æ—¶å€™å°±éœ€è¦è¿›è¡Œç›®å½•æŒ‚è½½ï¼‰</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">-v</span> <span class="token operator">&lt;</span>local-directory<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>container-directory<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>image-name<span class="token operator">&gt;</span><span class="token comment"># åœ¨ windows ä¸‹æŒ‚è½½ï¼ˆæ³¨æ„è·¯å¾„çš„ä¹¦å†™æ–¹å¼ï¼‰</span><span class="token comment"># æ¯”å¦‚ä»¥ centos é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†æœ¬åœ° D ç›˜ä¸­çš„ alex ç›®å½•ï¼ŒæŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ /usr/local/demo ç›®å½•</span><span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">-v</span> d:<span class="token punctuation">\</span>alex:/usr/local/demo centos<span class="token comment"># åœ¨ linux ä¸‹æŒ‚è½½</span><span class="token comment"># æ¯”å¦‚ä»¥ centos é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†æœ¬åœ°çš„ /home/alex/alex ç›®å½•ï¼ŒæŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ /usr/local/demo ç›®å½•</span><span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">-v</span> /home/alex/alex:/usr/local/demo centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨"><a href="#å¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨" class="headerlink" title="å¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨"></a>å¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨</h2><ul><li>å¯¼å‡ºå®¹å™¨å¿«ç…§</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">export</span> <span class="token operator">&lt;</span>container-id<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;</span>your-backup-name.tar<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å°†å®¹å™¨ id ä¸º 7691a814370e çš„å®¹å™¨å¯¼å‡ºå¿«ç…§ä¸º alex.tar</span><span class="token function">docker</span> <span class="token builtin class-name">export</span> 7691a814370e <span class="token operator">&gt;</span> alex.tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯¼å…¥å®¹å™¨å¿«ç…§</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">&lt;</span>your-backup-name.tar<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - <span class="token operator">&lt;</span>image-author-name<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>your-new-image-name<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>your-new-image-version<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å°†å®¹å™¨å¿«ç…§æ–‡ä»¶ alex.tar å¯¼å…¥åˆ° alex-demo é•œåƒå¹¶å®šä¹‰ alex-demo é•œåƒçš„ä½œè€…ä¸º alexï¼Œç‰ˆæœ¬å·ä¸º v1.0</span><span class="token function">cat</span> alex.tar <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - alex/alex-demo:v1.0<span class="token comment"># æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š url æˆ–è€…æŸä¸ªç›®å½•æ¥å¯¼å…¥</span><span class="token function">docker</span> <span class="token function">import</span> http://example.com/example-image.tgz example/image-repo:v1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker ç¯å¢ƒæ­å»º</title>
      <link href="posts/a8b7793d.html"/>
      <url>posts/a8b7793d.html</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-ç¯å¢ƒæ­å»º"><a href="#Docker-ç¯å¢ƒæ­å»º" class="headerlink" title="Docker ç¯å¢ƒæ­å»º"></a>Docker ç¯å¢ƒæ­å»º</h1><h2 id="é€‚ç”¨äº-Ubuntuï¼ŒDebianï¼ŒCentos-ç­‰å¤§éƒ¨åˆ†-Linuxï¼ˆä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£…ï¼‰"><a href="#é€‚ç”¨äº-Ubuntuï¼ŒDebianï¼ŒCentos-ç­‰å¤§éƒ¨åˆ†-Linuxï¼ˆä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£…ï¼‰" class="headerlink" title="é€‚ç”¨äº Ubuntuï¼ŒDebianï¼ŒCentos ç­‰å¤§éƒ¨åˆ† Linuxï¼ˆä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£…ï¼‰"></a>é€‚ç”¨äº Ubuntuï¼ŒDebianï¼ŒCentos ç­‰å¤§éƒ¨åˆ† Linuxï¼ˆä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£…ï¼‰</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://get.daocloud.io/docker <span class="token operator">|</span> <span class="token function">sh</span><span class="token comment"># æˆ–è€…æ‰§è¡Œ</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Windows-10-ç³»ç»Ÿä¸Šå¦‚æœä¸æƒ³ç”¨-docker-åˆ™éœ€è¦å…³é—­-hyper"><a href="#Windows-10-ç³»ç»Ÿä¸Šå¦‚æœä¸æƒ³ç”¨-docker-åˆ™éœ€è¦å…³é—­-hyper" class="headerlink" title="Windows 10 ç³»ç»Ÿä¸Šå¦‚æœä¸æƒ³ç”¨ docker åˆ™éœ€è¦å…³é—­ hyper"></a>Windows 10 ç³»ç»Ÿä¸Šå¦‚æœä¸æƒ³ç”¨ docker åˆ™éœ€è¦å…³é—­ hyper</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmd å‘½ä»¤è¡Œæ‰§è¡Œï¼š bcdedit /set hypervisorlaunchtype offpoweroff å‘½ä»¤è¡Œæ‰§è¡Œï¼š Disable-WindowsOptionalFeature <span class="token parameter variable">-Online</span> <span class="token parameter variable">-FeatureName</span> Microsoft-Hyper-V<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="å…³äºæŠ¥é”™"><a href="#å…³äºæŠ¥é”™" class="headerlink" title="å…³äºæŠ¥é”™"></a>å…³äºæŠ¥é”™</h4><ul><li>container-selinux &gt;= 2.9 è§£å†³æ–¹æ¡ˆ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Error: Package: docker-ce-18.03.1.ce-1.el7.centos.x86_64 <span class="token punctuation">(</span>docker-ce-edge<span class="token punctuation">)</span>           Requires: container-selinux <span class="token operator">&gt;=</span> <span class="token number">2.9</span> You could try using --skip-broken to work around the problem You could try running: <span class="token function">rpm</span> <span class="token parameter variable">-Va</span> <span class="token parameter variable">--nofiles</span> <span class="token parameter variable">--nodigest</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™ä¸ªæŠ¥é”™æ˜¯ container-selinux ç‰ˆæœ¬ä½æˆ–è€…æ˜¯æ²¡å®‰è£…çš„åŸå› <br>yum å®‰è£… container-selinux ä¸€èˆ¬çš„ yum æºåˆæ‰¾ä¸åˆ°è¿™ä¸ªåŒ…<br>éœ€è¦å®‰è£… epel æºï¼Œæ‰èƒ½ yum å®‰è£… container-selinux<br>ç„¶ååœ¨å®‰è£… docker-ce å°±å¯ä»¥äº†ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…ˆé…ç½®é˜¿é‡Œäº‘çš„ yum æº</span><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<span class="token comment"># å®‰è£…é˜¿é‡Œäº‘ä¸Šçš„ epel æº</span>yum <span class="token function">install</span> epel-release<span class="token comment"># å®‰è£… container-selinux å³å¯</span>yum <span class="token function">install</span> container-selinux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ"><a href="#æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ" class="headerlink" title="æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ"></a>æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å½“å‰ docker ç‰ˆæœ¬å·ï¼Œå‡ºç°ç‰ˆæœ¬å·å³ä¸ºå®‰è£…æˆåŠŸ</span><span class="token function">docker</span> <span class="token parameter variable">-v</span><span class="token comment"># æŸ¥çœ‹è¯¦ç»†çš„ docker ä¿¡æ¯</span><span class="token function">docker</span> version<span class="token comment"># æŸ¥çœ‹å½“å‰ docker çš„ä¿¡æ¯</span><span class="token function">docker</span> info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¼€å¯-docker-å®ˆæŠ¤è¿›ç¨‹"><a href="#å¼€å¯-docker-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="å¼€å¯ docker å®ˆæŠ¤è¿›ç¨‹"></a>å¼€å¯ docker å®ˆæŠ¤è¿›ç¨‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start <span class="token function">docker</span>systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span><span class="token comment"># é‡è½½é…ç½®</span>systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ·»åŠ å›½å†…é•œåƒæº"><a href="#æ·»åŠ å›½å†…é•œåƒæº" class="headerlink" title="æ·»åŠ å›½å†…é•œåƒæº"></a>æ·»åŠ å›½å†…é•œåƒæº</h3><p>centos æˆ–è€… ubuntu ç³»ç»Ÿæ—¶</p><p>sudo vim /etc/docker/daemon.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://registry.docker-cn.com"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="docker-å›½å†…é•œåƒ"><a href="#docker-å›½å†…é•œåƒ" class="headerlink" title="docker å›½å†…é•œåƒ"></a>docker å›½å†…é•œåƒ</h3><ul><li>ç½‘æ˜“åŠ é€Ÿå™¨ï¼š<a href="http://hub-mirror.c.163.com/">http://hub-mirror.c.163.com</a></li><li>å®˜æ–¹ä¸­å›½åŠ é€Ÿå™¨ï¼š<a href="https://registry.docker-cn.com/">https://registry.docker-cn.com</a></li><li>ustc çš„é•œåƒï¼š<a href="https://docker.mirrors.ustc.edu.cn/">https://docker.mirrors.ustc.edu.cn</a></li></ul><h3 id="å®‰è£…-docker-compose"><a href="#å®‰è£…-docker-compose" class="headerlink" title="å®‰è£… docker-compose"></a>å®‰è£… docker-compose</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨æºç å®‰è£…ï¼ˆæ¨èæ–¹å¼ï¼‰</span><span class="token punctuation">[</span>æœ€æ–°å‘è¡Œçš„ç‰ˆæœ¬åœ°å€<span class="token punctuation">]</span><span class="token punctuation">(</span>https://github.com/docker/compose/releases<span class="token punctuation">)</span><span class="token comment"># å®‰è£… 1.27.4 ç‰ˆæœ¬çš„ docker-compose ï¼ˆä¸‹è½½äº†æºç ï¼Œå¹¶æ”¹åä¸º docker-composeï¼‰</span><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose<span class="token comment"># å¢åŠ æ‰§è¡Œæƒé™</span><span class="token function">sudo</span> <span class="token function">chmod</span> u+x /usr/local/bin/docker-compose<span class="token comment"># å»ºç«‹è½¯è¿æ¥åˆ° /usr/bin ç›®å½•</span><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/bin/docker-compose /usr/bin/docker-compose<span class="token comment"># æŸ¥çœ‹ docker-compose ç‰ˆæœ¬</span><span class="token function">docker-compose</span> version---------------------------------<span class="token comment"># å¦‚æœæ˜¯åœ¨ centos ç³»ç»Ÿä¸­</span><span class="token comment"># å®‰è£…æ‰©å±•æº</span><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> epel-release<span class="token comment"># å®‰è£… python-pip æ¨¡å—</span><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> python-pip<span class="token comment"># å¦‚æœæ˜¯åœ¨ ubuntu ç³»ç»Ÿä¸­</span><span class="token comment"># å®‰è£… python-pip æ¨¡å—</span><span class="token function">apt</span> <span class="token function">install</span> python-pip<span class="token comment"># ä½¿ç”¨ pip å®‰è£… docker-compose</span>pip <span class="token function">install</span> <span class="token function">docker-compose</span><span class="token comment"># åˆ é™¤æ‰æ—§çš„ç¯å¢ƒå˜é‡ docker-compose</span><span class="token function">sudo</span> <span class="token function">rm</span> /usr/bin/docker-compose<span class="token function">sudo</span> <span class="token function">rm</span> /usr/local/bin/docker-compose<span class="token comment"># æˆ–è€…ä½¿ç”¨ pip å‘½ä»¤å¸è½½ docker-compose</span>pip uninstall <span class="token function">docker-compose</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-redis"><a href="#å®‰è£…-redis" class="headerlink" title="å®‰è£… redis"></a>å®‰è£… redis</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull redis:latest<span class="token function">docker</span> images<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span> alex-redis <span class="token parameter variable">-p</span> <span class="token number">6379</span>:6379 redis<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alex-redis /bin/bash<span class="token comment"># å¤–éƒ¨å¯ä»¥ç›´æ¥é€šè¿‡å®¿ä¸»æœºip:6379 è®¿é—®åˆ° redis æœåŠ¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-mysql"><a href="#å®‰è£…-mysql" class="headerlink" title="å®‰è£… mysql"></a>å®‰è£… mysql</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull mysql:5.7.33<span class="token function">docker</span> images<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span> alex-mysql <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> mysql:5.7.32<span class="token comment"># docker å®¹å™¨ä¸­å¯ä»¥ä½¿ç”¨ localhost æˆ–è€… 127.0.0.1 å‡å¯</span><span class="token comment"># å¤–éƒ¨å¯ä»¥ç›´æ¥é€šè¿‡å®¿ä¸»æœºip:3306 è®¿é—®åˆ° mysql æœåŠ¡ï¼Œå¯†ç ä¸º 123456</span>------------<span class="token comment"># å®‰è£… mysql 8 æ—¶</span><span class="token function">docker</span> pull mysql:8.0.23<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span> alex-mysql <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> mysql:8.0.23<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alex-mysql <span class="token function">bash</span><span class="token comment"># ç™»å½• mysql</span>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>alter user <span class="token string">'root'</span>@<span class="token string">'localhost'</span> identified by <span class="token string">'123456'</span><span class="token punctuation">;</span><span class="token comment"># æ·»åŠ è¿œç¨‹ç™»å½•ç”¨æˆ·</span>create user <span class="token string">'root'</span>@<span class="token string">'%'</span> identified with mysql_native_password by <span class="token string">'123456'</span><span class="token punctuation">;</span><span class="token comment"># åˆ·æ–°æƒé™</span>grant all privileges on *.* to <span class="token string">'root'</span>@<span class="token string">'%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 8 å®‰è£… docker</title>
      <link href="posts/de75e5f5.html"/>
      <url>posts/de75e5f5.html</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS-8-å®‰è£…-docker"><a href="#CentOS-8-å®‰è£…-docker" class="headerlink" title="CentOS 8 å®‰è£… docker"></a>CentOS 8 å®‰è£… docker</h1><ol><li>æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/redhat-release<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>egï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">âœ  Downloads <span class="token function">cat</span> /etc/redhat-releaseCentOS Linux release <span class="token number">8.2</span>.2004 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>å®‰è£… gcc ç›¸å…³</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc<span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc-c++<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>æ·»åŠ é˜¿é‡Œé•œåƒä»“åº“</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>æ›´æ–° yum ç´¢å¼•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>CentOS8 é»˜è®¤ä½¿ç”¨ podman ä»£æ›¿ docker</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> https://download.docker.com/linux/fedora/30/x86_64/stable/Packages/containerd.io-1.2.13-3.2.fc30.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li>å®‰è£… docker ce ï¼ˆç¤¾åŒºç‰ˆï¼‰</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> docker-ce<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="8"><li>å¯åŠ¨ docker</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start  <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="9"><li>å°† docker æ·»åŠ åˆ°å¼€æœºå¯åŠ¨</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="10"><li>æŸ¥çœ‹ docker ç‰ˆæœ¬</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token parameter variable">-v</span><span class="token comment"># æˆ–è€…ä½¿ç”¨ docker version æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>egï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">âœ  Downloads <span class="token function">docker</span> <span class="token parameter variable">-v</span>Docker version <span class="token number">20.10</span>.0, build 7287ab3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mitmproxy æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨</title>
      <link href="posts/cd811a58.html"/>
      <url>posts/cd811a58.html</url>
      
        <content type="html"><![CDATA[<h1 id="mitmproxy-æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨"><a href="#mitmproxy-æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="mitmproxy æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨"></a>mitmproxy æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨</h1><blockquote><p><a href="https://mitmproxy.org/">mitmproxy å®˜ç½‘</a><br><a href="https://github.com/mitmproxy/mitmproxy">mitmproxy GitHub</a><br><a href="https://docs.mitmproxy.org/stable/overview-installation/">mitmproxy æ–‡æ¡£</a> </p></blockquote><p>mitmproxy å°±æ˜¯ç”¨äº MITM çš„ proxyï¼ŒMITM å³ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-middle attackï¼‰ã€‚ç”¨äºä¸­é—´äººæ”»å‡»çš„ä»£ç†é¦–å…ˆä¼šå‘æ­£å¸¸çš„ä»£ç†ä¸€æ ·è½¬å‘è¯·æ±‚ï¼Œä¿éšœæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œå…¶æ¬¡ï¼Œä¼šé€‚æ—¶çš„æŸ¥ã€è®°å½•å…¶æˆªè·çš„æ•°æ®ï¼Œæˆ–ç¯¡æ”¹æ•°æ®ï¼Œå¼•å‘æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯ç‰¹å®šçš„è¡Œä¸ºã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä½¿ç”¨ <code>pip</code> å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># --user è¡¨ç¤ºå®‰è£…åˆ°ç”¨æˆ·çš„ç›®å½•ä¸­å»</span>pip3 <span class="token function">install</span> mitmproxy <span class="token parameter variable">--user</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>homebrew</code> å®‰è£…ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®ä½¿ç”¨ <code>pip</code> å®‰è£…ï¼Œä¸”ä½¿ç”¨ <code>pipenv</code> è™šæ‹Ÿç¯å¢ƒå®‰è£…ï¼Œæ–¹ä¾¿ç®¡ç†ä¾èµ–åŒ…ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> mitmproxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªå‘½ä»¤ä¸­çš„ä»»æ„ä¸€ä¸ªå³å¯ï¼Œè¿™ä¸‰ä¸ªå‘½ä»¤è¿”å›çš„ç»“æœå‡ä¸€è‡´</span>mitmproxy <span class="token parameter variable">--version</span>mitmdump <span class="token parameter variable">--version</span>mitmweb <span class="token parameter variable">--version</span><span class="token comment"># Mitmproxy: 6.0.2  # mitmproxy çš„ç‰ˆæœ¬å·</span><span class="token comment"># Python:    3.8.8  # python çš„ç‰ˆæœ¬å·</span><span class="token comment"># OpenSSL:   OpenSSL 1.1.1i  8 Dec 2020  # openssl åè®®</span><span class="token comment"># Platform:  macOS-10.16-x86_64-i386-64bit  # æœ¬åœ°ç”µè„‘å‹å·</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>mitmproxy æœ‰ä¸‰ç§å¯åŠ¨å‘½ä»¤ï¼š</p><ol><li>mitmwebï¼šæä¾›äº†ä¸€ä¸ª web é¡µé¢ï¼Œäº¤äº’ç•Œé¢å¯ä»¥é€šè¿‡ <code>localhost:8081</code> å»è®¿é—®ã€‚</li><li>mitmproxyï¼šæä¾›å‘½ä»¤è¡Œç•Œé¢ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¿‡æ»¤è¯·æ±‚ã€‚</li><li>mitmdumpï¼šå¯ä»¥é€šè¿‡æ‰§è¡Œä¸€ä¸ª <code>python</code> è„šæœ¬å»è¿è¡Œ</li></ol><p>è¿è¡Œåœ¨ 8888 ç«¯å£ä¸Šè¿è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mitmproxy <span class="token parameter variable">-p</span> <span class="token number">8888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ª python è„šæœ¬ï¼Œç„¶åé€šè¿‡ mitmdump å»æ‰§è¡Œè¿™ä¸ª python è„šæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mitmdump <span class="token parameter variable">-p</span> <span class="token number">8888</span> <span class="token parameter variable">-s</span> script.py<span class="token comment"># è¿˜å¯ä»¥å°†æˆªè·çš„æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚å¦‚ä¸‹ï¼Œä¿å­˜åˆ° outfile.txt æ–‡ä»¶ä¸­</span>mitmdump <span class="token parameter variable">-w</span> outfile.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨ç•Œé¢å»è¿è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mitmweb <span class="token parameter variable">-p</span> <span class="token number">8888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="æ‰‹æœºç«¯é…ç½®"><a href="#æ‰‹æœºç«¯é…ç½®" class="headerlink" title="æ‰‹æœºç«¯é…ç½®"></a>æ‰‹æœºç«¯é…ç½®</h2><ol><li>å°†æ‰‹æœºå’Œç”µè„‘è¿æ¥åˆ°åŒä¸€ä¸ª Wi-Fi ä¸­ã€‚</li><li>ç„¶åæ‰¾åˆ°ç”µè„‘çš„ ip åœ°å€ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯ï¼š192.168.0.101</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># macOS ä¸‹å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</span><span class="token function">ifconfig</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"inet"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç»™æ‰‹æœº Wi-Fi é…ç½®ä»£ç†ã€‚</li></ol><blockquote><p>è¿™é‡Œä»¥ iPhone ä½œä¸ºæ¼”ç¤ºè®²è§£ã€‚</p></blockquote><p>åœ¨æ‰‹æœºä¸Šæ‰¾åˆ° Wi-Fi è®¾ç½®ï¼Œç‚¹è¿›å»ï¼Œé€‰æ‹© <code>é…ç½®ä»£ç†</code>ï¼Œæ”¹ä¸º <code>æ‰‹åŠ¨</code>ï¼Œä¿®æ”¹ <code>æœåŠ¡å™¨</code> è¿™ä¸€é¡¹ï¼Œæ”¹ä¸ºç”µè„‘çš„ ip åœ°å€ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯ 192.168.0.101ï¼Œç«¯å£æ”¹æˆ 8888ï¼Œç„¶åç‚¹å³ä¸Šè§’çš„ <code>å­˜å‚¨</code>ï¼Œä¹‹ååœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>mitm.it</code> é“¾æ¥åœ°å€ï¼ˆå»ºè®®ä½¿ç”¨ iPhone è‡ªå¸¦çš„ Safari æµè§ˆå™¨ï¼‰ï¼Œé€‰æ‹©ä½ è‡ªå·±çš„æœºå‹å¯¹åº”çš„ <code>Get mitmproxy-ca-cert.pem</code> è¿›è¡Œä¸‹è½½ï¼ˆæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ Appleï¼‰ï¼Œç„¶åå» <strong>è®¾ç½®-é€šç”¨-æè¿°æ–‡ä»¶</strong> ä¸­æ‰¾åˆ°åˆšåˆšä¸‹è½½çš„æè¿°æ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚</p><ol start="4"><li>å¼€å¯è¯ä¹¦</li></ol><p>æ‰“å¼€ <strong>è®¾ç½®-é€šç”¨-å…³äºæœ¬æœº-è¯ä¹¦ä¿¡ä»»è®¾ç½®</strong>ï¼Œå¼€å¯ mitmproxy è¯ä¹¦ã€‚ç°åœ¨å°±å¯ä»¥æ‰“å¼€ä»»æ„ä¸€ä¸ª app å°è¯•ä¸€ä¸‹æŠ“åŒ…å•¦ï¼</p><h2 id="å…³é—­-mitmproxy"><a href="#å…³é—­-mitmproxy" class="headerlink" title="å…³é—­ mitmproxy"></a>å…³é—­ mitmproxy</h2><p>ç”µè„‘ç«¯å¯ä»¥ç›´æ¥æŒ‰ <code>Ctrl+c</code> é€€å‡º mitmproxyï¼Œæ‰‹æœºç«¯éœ€è¦å…³é—­æ‰åˆšåˆšå¯¹ Wi-Fi è®¾ç½®çš„ä»£ç†ã€‚</p><h2 id="ä½¿ç”¨-mitmproxy-å‘½ä»¤è¡Œè¿è¡Œ-mitmproxy-æ—¶çš„å¿«æ·é”®"><a href="#ä½¿ç”¨-mitmproxy-å‘½ä»¤è¡Œè¿è¡Œ-mitmproxy-æ—¶çš„å¿«æ·é”®" class="headerlink" title="ä½¿ç”¨ mitmproxy å‘½ä»¤è¡Œè¿è¡Œ mitmproxy æ—¶çš„å¿«æ·é”®"></a>ä½¿ç”¨ mitmproxy å‘½ä»¤è¡Œè¿è¡Œ mitmproxy æ—¶çš„å¿«æ·é”®</h2><table><thead><tr><th>å¿«æ·é”®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>j/k</td><td>ä¸Šä¸‹ç§»åŠ¨</td></tr><tr><td>tab æˆ–è€…æ–¹å‘é”®</td><td>è¿›è¡Œç•Œé¢åˆ‡æ¢</td></tr><tr><td>z</td><td>æ¸…å±</td></tr><tr><td>f</td><td>ç”¨æ¥è¿‡æ»¤è¯·æ±‚åœ°å€</td></tr><tr><td>q</td><td>é€€å‡ºå½“å‰ç•Œé¢</td></tr></tbody></table><p>script.py ç¤ºä¾‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json<span class="token keyword">import</span> re<span class="token keyword">from</span> mitmproxy <span class="token keyword">import</span> ctx<span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>flow<span class="token punctuation">)</span><span class="token punctuation">:</span>    flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'MitmProxy'</span>  <span class="token comment"># æ›´æ”¹è¯·æ±‚å¤´</span>    ctx<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ç™½è‰²æ—¥å¿—</span>    ctx<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warn<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># é»„è‰²æ—¥å¿—</span>    ctx<span class="token punctuation">.</span>log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># çº¢è‰²æ—¥å¿—</span>    request <span class="token operator">=</span> flow<span class="token punctuation">.</span>request    info <span class="token operator">=</span> ctx<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info    info<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>    info<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">)</span>    info<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span><span class="token punctuation">)</span>    info<span class="token punctuation">(</span>request<span class="token punctuation">.</span>host<span class="token punctuation">)</span>    info<span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span>    info<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>    info<span class="token punctuation">(</span>request<span class="token punctuation">.</span>scheme<span class="token punctuation">)</span>        <span class="token comment"># å¯ä»¥æ›´æ”¹è¯·æ±‚çš„ url</span>    url <span class="token operator">=</span> <span class="token string">'https://httpbin.org/get'</span>    flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token keyword">def</span> <span class="token function">response</span><span class="token punctuation">(</span>flow<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># æå–è¯·æ±‚çš„ url åœ°å€</span>    request_url <span class="token operator">=</span> flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¯·æ±‚åˆ°çš„åœ°å€ä¸º =====&gt; %s'</span> <span class="token operator">%</span> request_url<span class="token punctuation">)</span>    response_body <span class="token operator">=</span> flow<span class="token punctuation">.</span>response<span class="token punctuation">.</span>text    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿”å›ä½“ä¸º ====&gt; %s'</span> <span class="token operator">%</span> response_body<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ“åŒ…å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> æŠ“åŒ…å·¥å…· </tag>
            
            <tag> mitmproxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu ä¸‹å®‰è£… php7.2</title>
      <link href="posts/98509b56.html"/>
      <url>posts/98509b56.html</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu-ä¸‹å®‰è£…-php7-2"><a href="#Ubuntu-ä¸‹å®‰è£…-php7-2" class="headerlink" title="Ubuntu ä¸‹å®‰è£… php7.2"></a>Ubuntu ä¸‹å®‰è£… php7.2</h1><ol><li>å®‰è£…è½¯ä»¶æºæ‹“å±•å·¥å…·ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> software-properties-common python-software-properties<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æ›´æ–°è½¯ä»¶æºç¼“å­˜å¹¶ä¸”æ·»åŠ  <code>OndÅ™ej SurÃ½</code> çš„ <code>PHP PPA</code> æºï¼Œéœ€è¦æŒ‰ä¸€æ¬¡å›è½¦ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> add-apt-repository ppa:ondrej/php <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>å®‰è£… php7.2</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> php7.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>å¦‚æœä¹‹å‰æœ‰å…¶ä»–ç‰ˆæœ¬PHPï¼Œåœ¨è¿™è¾¹ç¦ç”¨æ‰</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¦ç”¨æ‰ php5.6 çš„ç‰ˆæœ¬</span><span class="token function">sudo</span> a2dismod php5.6<span class="token comment"># å¼€å¯ php7.2 çš„ç‰ˆæœ¬</span><span class="token function">sudo</span> a2enmod php7.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>å®‰è£… php7.2 å¸¸ç”¨æ‰©å±•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> php7.2-fpm php7.2-mysql php7.2-curl php7.2-gd php7.2-mbstring php7.2-xml php7.2-xmlrpc php7.2-zip php7.2-opcache <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹å¯ä»¥å®‰è£…çš„æ‰©å±•æŒ‡ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-cache</span> search php7.2<span class="token comment"># æ¯”å¦‚å¦‚ä¸‹æ‰€ç¤ºï¼š</span>root@iZuf6aig35m8ho0xq75ijnZ:/<span class="token comment"># apt-cache search php7.2</span>php-amqp - AMQP extension <span class="token keyword">for</span> PHPphp-apcu - APC User Cache <span class="token keyword">for</span> PHPphp-geoip - GeoIP module <span class="token keyword">for</span> PHPphp-igbinary - igbinary PHP serializerphp-imagick - Provides a wrapper to the ImageMagick libraryphp7.2-fpm - server-side, HTML-embedded scripting language <span class="token punctuation">(</span>FPM-CGI binary<span class="token punctuation">)</span>php7.2-gd - GD module <span class="token keyword">for</span> PHPphp7.2-gmp - GMP module <span class="token keyword">for</span> PHPphp7.2-imap - IMAP module <span class="token keyword">for</span> PHP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>è®¾ç½® php</li></ol><p>å®‰è£…å®Œæˆåï¼Œç¼–è¾‘ <code>/etc/php/7.2/fpm/php.ini</code> æ›¿æ¢æˆ <code>;cgi.fix_pathinfo=1</code> ä¸º <code>cgi.fix_pathinfo=0</code> å¿«æ·å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥å‘½ä»¤è¡Œè¾“å…¥</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/'</span> /etc/php/7.2/fpm/php.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li>ç®¡ç† php</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart php7.2-fpm <span class="token comment">#é‡å¯</span>systemctl start php7.2-fpm <span class="token comment">#å¯åŠ¨</span>systemctl stop php7.2-fpm <span class="token comment">#å…³é—­</span>systemctl status php7.2-fpm <span class="token comment">#æ£€æŸ¥çŠ¶æ€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>é‡å¯ apache2</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> apache2 restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu å¼€æ”¾æŒ‡å®šç«¯å£</title>
      <link href="posts/ce06863f.html"/>
      <url>posts/ce06863f.html</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu-å¼€æ”¾æŒ‡å®šç«¯å£"><a href="#Ubuntu-å¼€æ”¾æŒ‡å®šç«¯å£" class="headerlink" title="Ubuntu å¼€æ”¾æŒ‡å®šç«¯å£"></a>Ubuntu å¼€æ”¾æŒ‡å®šç«¯å£</h1><ul><li>ä¸€èˆ¬æƒ…å†µä¸‹ <code>ubuntu</code> ç³»ç»Ÿè‡ªå¸¦ <code>iptables</code> é˜²ç«å¢™ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±è£…ä¸Š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> iptables<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¼€æ”¾ tcp åè®® 80 ç«¯å£</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ä¸´æ—¶ä¿å­˜è§„åˆ™</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables-save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æ°¸ä¹…ä¿å­˜è§„åˆ™ï¼Œéœ€è¦å€ŸåŠ© <code>iptables-persistent</code> å·¥å…·</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… iptables-persistent</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> iptables-persistent<span class="token comment"># æŒä¹…åŒ–</span><span class="token function">sudo</span> iptables-persistent save<span class="token function">sudo</span> iptables-persistent reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 16.04.4 LTS æ­å»º LNMP</title>
      <link href="posts/7c353a38.html"/>
      <url>posts/7c353a38.html</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu-16-04-4-LTS-æ­å»º-LNMP"><a href="#Ubuntu-16-04-4-LTS-æ­å»º-LNMP" class="headerlink" title="Ubuntu 16.04.4 LTS æ­å»º LNMP"></a>Ubuntu 16.04.4 LTS æ­å»º LNMP</h1><ul><li><h2 id="å®‰è£…-mysql"><a href="#å®‰è£…-mysql" class="headerlink" title="å®‰è£… mysql"></a>å®‰è£… mysql</h2></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> mysql-server mysql-client<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æµ‹è¯•ï¼šmysql -u root -p</p></blockquote><p>æŸ¥çœ‹ Mysql çŠ¶æ€ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> mysql status/start/stop/retart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹ç›‘å¬ç«¯å£çš„æƒ…å†µï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-tunpl</span> æˆ– <span class="token function">netstat</span> <span class="token parameter variable">-tap</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å¦‚æœä¹‹å‰æœ‰è£…-APACHE-è¦æ”¹ä¸‹ç«¯å£-æˆ–è€…ç›´æ¥ç§»é™¤-apache2"><a href="#å¦‚æœä¹‹å‰æœ‰è£…-APACHE-è¦æ”¹ä¸‹ç«¯å£-æˆ–è€…ç›´æ¥ç§»é™¤-apache2" class="headerlink" title="å¦‚æœä¹‹å‰æœ‰è£… APACHE è¦æ”¹ä¸‹ç«¯å£,æˆ–è€…ç›´æ¥ç§»é™¤ apache2"></a>å¦‚æœä¹‹å‰æœ‰è£… APACHE è¦æ”¹ä¸‹ç«¯å£,æˆ–è€…ç›´æ¥ç§»é™¤ apache2</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> remove apache2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><h2 id="å®‰è£…-Nginx"><a href="#å®‰è£…-Nginx" class="headerlink" title="å®‰è£… Nginx"></a>å®‰è£… Nginx</h2></li></ul><ol><li><p>ä¸ºç¡®ä¿è·å–æœ€æ–°çš„ Nginx å…ˆæ›´æ–°æºåˆ—è¡¨ï¼ˆæœ‰äº›æ–‡æ¡£è¯´çš„æ˜¯æ›´æ–°ç³»ç»Ÿï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å®‰è£… nginx</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ£€æŸ¥ nginx å®‰è£…æ˜¯å¦æˆåŠŸ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ–¹æ³•01ã€ ç›´æ¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ° nginx çš„ç‰ˆæœ¬å·</span>/usr/sbin/nginx <span class="token parameter variable">-v</span><span class="token comment"># æ–¹æ³•02ã€ä½¿ç”¨æµè§ˆå™¨è®¿é—® IP åœ°å€ï¼Œå‡ºç° Nginx çš„æ¬¢è¿é¡µé¢</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><blockquote><p>å¯ä»¥ä½¿ç”¨ dpkg -S nginx å‘½ä»¤æ¥æœç´¢ nginx çš„ç›¸å…³æ–‡ä»¶<br>nginx çš„é…ç½®ç›®å½•ä½äºï¼š/etc/nginx<br>å…¶ä»–æ–‡æ¡£è¯´çš„æ˜¯ Nginx çš„é»˜è®¤ç½‘ç«™ç›®å½•åœ¨ /usr/share/nginx/html/ ä¸‹ï¼Œä½†æ˜¯æˆ‘å®‰è£…çš„åœ¨ /var/www/html ä¸‹ï¼Œå’Œ apache2 é»˜è®¤çš„ç½‘ç«™ç›®å½•ä¸€æ ·<br>é»˜è®¤Nginxç½‘ç«™é…ç½®æ–‡ä»¶ä¸º /etc/nginx/sites-available/default</p></blockquote><h3 id="Nginx-å…¶ä»–å‘½ä»¤"><a href="#Nginx-å…¶ä»–å‘½ä»¤" class="headerlink" title="Nginx å…¶ä»–å‘½ä»¤"></a>Nginx å…¶ä»–å‘½ä»¤</h3><pre class="line-numbers language-none"><code class="language-none">/etc/init.d/nginx status|stop|start|restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Nginx-è™šæ‹Ÿä¸»æœºé…ç½®"><a href="#Nginx-è™šæ‹Ÿä¸»æœºé…ç½®" class="headerlink" title="Nginx è™šæ‹Ÿä¸»æœºé…ç½®"></a>Nginx è™šæ‹Ÿä¸»æœºé…ç½®</h3><ol><li><p>ä¿®æ”¹ user</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/nginx.conf<span class="token comment"># å°† user æ”¹ä¸º www-data å› ä¸º php é»˜è®¤æ˜¯è¿™ä¸ª user</span><span class="token comment"># ä½†æ˜¯æˆ‘çœ‹æˆ‘è‡ªå·±çš„ nginx.conf é…ç½®æ–‡ä»¶ç¬¬ä¸€è¡Œç›´æ¥æ˜¯</span><span class="token comment"># user www-data; å› æ­¤æˆ‘æ²¡æœ‰ä¿®æ”¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Nginx ä¸ php-fpm çš„é›†æˆ<br>è¿™é‡Œé‡‡ç”¨UNIX domain socketæ–¹å¼ï¼šï¼ˆè¿™é‡Œä¸€å®šè¦æ³¨æ„locationçš„ä½ç½®ï¼ï¼ï¼ï¼‰</p></li></ol><blockquote><p>åœ¨ /etc/nginx/sites-available/default é…ç½®æ–‡ä»¶ä¸­ï¼ˆç½‘ç«™æ ¹ç›®å½•ä¹Ÿåœ¨æ˜¯è¿™é‡Œæ›´æ”¹ï¼‰ï¼Œ Nginxå·²ç»ä¸ºä¸ PHP-FPMçš„æ•´åˆå‡†å¤‡å¥½äº†ï¼Œåªéœ€è¦å°†ä¸‹é¢è¿™éƒ¨åˆ†æ”¹å¥½å°±å¯ä»¥äº†ã€‚sockæ–‡ä»¶è·¯å¾„ä¸º /run/php/php7.2-fpm.sock ã€‚</p></blockquote><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">51</span>         location ~ \.php$</span> <span class="token punctuation">{</span><span class="token directive"><span class="token keyword">52</span>                 include snippets/fastcgi-php.conf</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">53</span> <span class="token number">54</span>                 <span class="token comment"># With php7.0-cgi alone:</span><span class="token number">55</span>                 <span class="token comment">#fastcgi_pass 127.0.0.1:9000;</span><span class="token number">56</span>                 <span class="token comment"># With php7.0-fpm:</span><span class="token number">57</span>                 fastcgi_pass unix:/run/php/php7.2-fpm.sock</span><span class="token punctuation">;</span>58         <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ç„¶åå†ä¿®æ”¹ PHP-FPM çš„é…ç½®æ–‡ä»¶ vim  /etc/php/7.2/fpm/pool.d/ <a href="http://www.conf/">www.conf</a><br>ï¼Œå¦‚ä¸‹ï¼š</p></blockquote><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># ä¸ Nginxç›‘å¬åŒä¸€ä¸ª sock</span>36 listen = /run/php/php7.2-fpm.sock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>ç«¯å£-ä»£ç æ˜ å°„ï¼Œæ–¹æ³•æœ‰ä¸‰ç§ï¼š</li></ol><ul><li>æ–¹æ³•01ï¼šåœ¨ /etc/nginx/sites-available/default æ–‡ä»¶æœ«å°¾å¤„ç›´æ¥æ·»åŠ ä»¥ä¸‹å†…å®¹<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/sites-available/default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>æä¾›äº†ä¸¤ç§æ¡†æ¶çš„é…ç½®æ–¹æ³•</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># ä»¥ä¸‹æ˜¯é’ˆå¯¹ thinkphp5.0 æ¡†æ¶é…ç½®</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token comment"># å¦‚æœå¸Œæœ›äºŒçº§åŸŸåæŒ‡å‘åŒä¸€ä¸ªé¡¹ç›®çš„è¯ï¼Œç›´æ¥åœ¨ server_name åé¢æ·»åŠ å³å¯</span>    <span class="token directive"><span class="token keyword">server_name</span>  www.drling.xin drling.xin</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">root</span>     /var/www/html/www.drling.xin/public</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span>    /var/log/nginx/www.drling.xin_access.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span>    /var/log/nginx/www.drling.xin_error.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">index</span> index.html index.php</span><span class="token punctuation">;</span><span class="token comment">## åœ¨Nginxä½ç‰ˆæœ¬ä¸­ï¼Œæ˜¯ä¸æ”¯æŒPATHINFOçš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨Nginx.confä¸­é…ç½®è½¬å‘è§„åˆ™å®ç°</span><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">if</span> (!-e <span class="token variable">$request_filename</span>)</span> <span class="token punctuation">{</span>                <span class="token directive"><span class="token keyword">rewrite</span> ^(.*)$ /index.php?s=<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">break</span></span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">location</span> ~ \.php?.*$</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">fastcgi_pass</span>   unix:/run/php/php7.2-fpm.sock</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">include</span>        fastcgi_params</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment"># ä»¥ä¸‹æ˜¯é’ˆå¯¹ Laravel5.5 æ¡†æ¶é…ç½®</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>  test.drling.xin</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">root</span>     /var/www/html/test.drling.xin/public</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span>    /var/log/nginx/test.drling.xin_access.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span>    /var/log/nginx/test.drling.xin_error.log</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span> index.html index.php</span><span class="token punctuation">;</span><span class="token comment">## å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Nginxï¼Œä½¿ç”¨å¦‚ä¸‹ç«™ç‚¹é…ç½®æŒ‡ä»¤å°±å¯ä»¥æ”¯æŒ URL ç¾åŒ–ï¼š</span><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php?<span class="token variable">$query_string</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">location</span> ~ \.php?.*$</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">fastcgi_pass</span>   unix:/run/php/php7.2-fpm.sock</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">include</span>        fastcgi_params</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ–¹æ³•02ã€ç›´æ¥åœ¨ /etc/nginx/sites-available ç›®å½•ä¸‹ï¼Œå•ç‹¬å†™è‡ªå·±çš„é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œæ“ä½œæ–¹æ³•å¦‚ä¸‹</li></ul><pre class="line-numbers language-none"><code class="language-none"># 01ã€æ¯”å¦‚æˆ‘å†™çš„æ–‡ä»¶æ˜¯ www.drling.xin ä¸éœ€è¦å†™ .conf åç¼€åsudo vim /etc/nginx/sites-available/www.drling.xin# 02ã€å°†ä»¥ä¸Š thinkphp5.0 çš„é…ç½®æ–‡ä»¶æ”¾è¿›å»# ä»¥ä¸‹æ˜¯é’ˆå¯¹ thinkphp5.0 æ¡†æ¶é…ç½®server {    listen       80;    server_name  www.drling.xin;    root     /var/www/html/www.drling.xin/public;        access_log    /var/log/nginx/www.drling.xin_access.log;    error_log    /var/log/nginx/www.drling.xin_error.log;         index index.html index.php;## åœ¨Nginxä½ç‰ˆæœ¬ä¸­ï¼Œæ˜¯ä¸æ”¯æŒPATHINFOçš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨Nginx.confä¸­é…ç½®è½¬å‘è§„åˆ™å®ç°location / {        if (!-e $request_filename) {                rewrite ^(.*)$ /index.php?s=$1 last;                break;        }}    location ~ \.php?.*$ {        fastcgi_pass   unix:/run/php/php7.2-fpm.sock;        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;        include        fastcgi_params;    }}# 03ã€å»ºç«‹è½¯è¿æ¥sudo ln -s /etc/apache2/sites-available/www.drling.xin /etc/apache2/sites-enabled/www.drling.xin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ–¹æ³•03ã€ç›´æ¥åœ¨ /etc/nginx/conf.d/ ç›®å½•ä¸‹å†™ä»¥ .conf ä¸ºåç¼€çš„é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-none"><code class="language-none"># 01ã€æ¯”å¦‚æˆ‘å†™çš„æ–‡ä»¶æ˜¯ test.drling.xin éœ€è¦å†™ .conf åç¼€åsudo vim /etc/nginx/conf.d/test.drling.xin.conf# 02ã€å°†ä»¥ä¸Š Laravel5.5 çš„é…ç½®æ–‡ä»¶æ”¾è¿›å»server {    listen       80;    server_name  test.drling.xin;    root     /var/www/html/test.drling.xin/public;    access_log    /var/log/nginx/test.drling.xin_access.log;    error_log    /var/log/nginx/test.drling.xin_error.log;        index index.html index.php;## å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Nginxï¼Œä½¿ç”¨å¦‚ä¸‹ç«™ç‚¹é…ç½®æŒ‡ä»¤å°±å¯ä»¥æ”¯æŒ URL ç¾åŒ–ï¼šlocation / {    try_files $uri $uri/ /index.php?$query_string;}    location ~ \.php?.*$ {        fastcgi_pass   unix:/run/php/php7.2-fpm.sock;        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;        include        fastcgi_params;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å…¶å® nginx çš„é…ç½®æ”¾ç½®ä½ç½®å¤šåŠå¯ä»¥å‚è€ƒ /etc/nginx/nginx.conf æ–‡ä»¶ä¸­61è¡Œå’Œ62è¡Œ<br> 61         include /etc/nginx/conf.d/<em>.conf;<br> 62         include /etc/nginx/sites-enabled/</em>;</p></blockquote><ul><li><h3 id="æ·»åŠ å®Œäº†ä¹‹åä¸€å®šè¦é‡å¯æœåŠ¡å™¨"><a href="#æ·»åŠ å®Œäº†ä¹‹åä¸€å®šè¦é‡å¯æœåŠ¡å™¨" class="headerlink" title="æ·»åŠ å®Œäº†ä¹‹åä¸€å®šè¦é‡å¯æœåŠ¡å™¨"></a>æ·»åŠ å®Œäº†ä¹‹åä¸€å®šè¦é‡å¯æœåŠ¡å™¨</h3></li></ul><pre class="line-numbers language-none"><code class="language-none">sudo service nginx restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><h3 id="Nginx-é…ç½®æ–‡ä»¶éœ€è¦æ³¨æ„ä½ç½®è®²è§£"><a href="#Nginx-é…ç½®æ–‡ä»¶éœ€è¦æ³¨æ„ä½ç½®è®²è§£" class="headerlink" title="Nginx é…ç½®æ–‡ä»¶éœ€è¦æ³¨æ„ä½ç½®è®²è§£"></a>Nginx é…ç½®æ–‡ä»¶éœ€è¦æ³¨æ„ä½ç½®è®²è§£</h3></li></ul><ol><li><p>å¦‚æœä¸ç¡®å®š fastcgi_pass è¿™ä¸€æ®µæ€ä¹ˆå¡«å†™</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#fastcgi_passä¸ºfpmåœ°å€ï¼Œå¯æŸ¥çœ‹/etc/php/7.2/fpm/pool.d/www.confä¸­çš„listenç¡®å®šï¼ˆwww.confé…ç½®æ–‡ä»¶ä¸­ç¬¬36è¡Œï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å®‰è£… php çš„æ—¶å€™ä¸€å®šè¦å®‰è£… php-fpm æ‰©å±•ï¼ˆä¹Ÿç§°ä¸ºï¼šPHPFastCGIç®¡ç†å™¨ï¼‰ï¼Œè¦è¿æ¥æ•°æ®åº“åˆ™å¿…é¡»å®‰è£… php-mysql æ‰©å±•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æˆ‘åœ¨è¿™é‡Œå®‰è£…çš„ php7.2 å› ä¸º Laravel5.5æ ¸å¿ƒä»£ç ä¸­éœ€è¦php7.1ä»¥ä¸Š</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2-fpm php7.2-mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£ç›‘å¬æƒ…å†µ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-anp</span>// ç›´æ¥æŸ¥çœ‹80ç«¯å£å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š<span class="token function">sudo</span> <span class="token function">lsof</span> <span class="token parameter variable">-i</span> :80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸€å®šè¦åœ¨ php.ini é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ cgi.fix_pathinfo=0</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/php7.2/fpm/php.ini<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥æ‰¾åˆ° cgi.fix_pathinfo å­—æ®µï¼ˆç¬¬776è¡Œï¼‰ï¼Œå°†å€¼è®¾ä¸º0</p><blockquote><p>è¿™ä¸ªå‚æ•°ç”¨æ¥å¯¹è®¾ç½®cgiæ¨¡å¼ä¸‹ä¸ºphpæ˜¯å¦æä¾›ç»å¯¹è·¯å¾„ä¿¡æ¯æˆ–PATH_INFOä¿¡æ¯</p></blockquote></li><li><p>Nginx ä¸ PHP-FPM é›†æˆè¯¦ç»†è®²è§£</p></li></ol><blockquote><p>PHP-FPM ä¸ Nginx é€šä¿¡æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åŸºäºTCPçš„ Internet domain socket æ–¹å¼ï¼Œä¸€ç§æ˜¯ UNIX domain socket æ–¹å¼ã€‚</p><p>UNIX domain socket å¯ä»¥ä½¿åŒä¸€å°æ“ä½œç³»ç»Ÿä¸Šçš„ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹è¿›è¡Œæ•°æ®é€šä¿¡ã€‚UNIX domain socket çš„æ¥å£å’Œ Internet domain socket å¾ˆåƒï¼Œä½†å®ƒä¸ä½¿ç”¨ç½‘ç»œåº•å±‚åè®®æ¥é€šä¿¡ã€‚</p><p>æœåŠ¡å™¨å‹åŠ›ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§æ–¹å¼æ€§èƒ½å·®åˆ«ä¸å¤§ï¼Œä½†åœ¨å‹åŠ›æ¯”è¾ƒæ»¡çš„æ—¶å€™ï¼Œç”¨UNIX domain socketæ–¹å¼ï¼Œæ•ˆæœç¡®å®æ¯”è¾ƒå¥½ã€‚<br>æ¥ä¸‹æ¥åˆ†åˆ«è®²è§£ä¸€ä¸‹ä¸¤ç§æ–¹å¼çš„é…ç½®æ–¹å¼ï¼š</p></blockquote><ul><li>ä½¿ç”¨é»˜è®¤çš„ UNIX Socketæ–¹å¼:</li></ul><ol><li>ä¿®æ”¹ fpm çš„é…ç½®æ–‡ä»¶<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/php/7.2/fpm/pool.d/www.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>ä¿®æ”¹æˆå¦‚ä¸‹ï¼š<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¬¬36è¡Œ</span> listen <span class="token operator">=</span> /run/php/php7.2-fpm.sock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ£€æŸ¥ä¸‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯</p></blockquote></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> php-fpm7.2 <span class="token parameter variable">-t</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ä¿®æ”¹å®Œäº†ä¹‹åé‡å¯ä¸€ä¸‹ php-fpm7.2</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> php-fpm7.2 restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/sites-enabled/default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹æˆå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">51</span>         location ~ \.php$</span> <span class="token punctuation">{</span><span class="token directive"><span class="token keyword">52</span>                 include snippets/fastcgi-php.conf</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">53</span> <span class="token number">54</span>                 <span class="token comment"># With php7.0-cgi alone:</span><span class="token number">55</span>                 <span class="token comment">#fastcgi_pass 127.0.0.1:9000;</span><span class="token number">56</span>                 <span class="token comment"># With php7.0-fpm:</span><span class="token number">57</span>                 fastcgi_pass unix:/run/php/php7.2-fpm.sock</span><span class="token punctuation">;</span>58         <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¿®æ”¹å®Œäº†ä¹‹åé‡å¯ä¸‹ nginx</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> nginx restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å†æ¬¡æ£€æŸ¥ nginx çš„é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> php-fpm7.2 <span class="token parameter variable">-t</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ä½¿ç”¨ TCP æ–¹å¼:</li></ul><ol><li><p>ä¿®æ”¹ fpm çš„é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/php/7.2/fpm/pool.d/www.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹æˆå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®æ–‡ä»¶ç¬¬36è¡Œ</span>listen <span class="token operator">=</span> <span class="token number">127.0</span>.0.1:9000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/sites-enabled/default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹æˆå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">51</span>         location ~ \.php$</span> <span class="token punctuation">{</span><span class="token directive"><span class="token keyword">52</span>                 include snippets/fastcgi-php.conf</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">53</span> <span class="token number">54</span>                 <span class="token comment"># With php7.0-cgi alone:</span><span class="token number">55</span>                 <span class="token comment">#fastcgi_pass 127.0.0.1:9000;</span><span class="token number">56</span>                 <span class="token comment"># With php7.0-fpm:</span><span class="token number">57</span>                 fastcgi_pass 127.0.0.1:9000</span><span class="token punctuation">;</span>58         <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LNMP </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7.4 64ä½ æ­å»ºLAMP</title>
      <link href="posts/10ab7ab8.html"/>
      <url>posts/10ab7ab8.html</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS-7-4-64ä½-æ­å»ºLAMP"><a href="#CentOS-7-4-64ä½-æ­å»ºLAMP" class="headerlink" title="CentOS 7.4 64ä½ æ­å»ºLAMP"></a>CentOS 7.4 64ä½ æ­å»ºLAMP</h1><ul><li><h2 id="å®‰è£…php7-2"><a href="#å®‰è£…php7-2" class="headerlink" title="å®‰è£…php7.2"></a>å®‰è£…php7.2</h2></li></ul><p>è‹¥ç›´æ¥é‡‡ç”¨centosä¸­çš„yumå®‰è£…ï¼šsudo yum -y install phpï¼Œç‰ˆæœ¬æ˜¯5.4ï¼Œè¿œè¿œä¸å¤Ÿï¼Œå› æ­¤æˆ‘ä»¬è¦æ‰‹åŠ¨æ›´æ–°rpmå³å¯ã€‚</p><h3 id="1-é¦–å…ˆè·å–-rpm-ï¼ˆæ·»åŠ -php-çš„-yum-ä»“åº“-ï¼‰ï¼š"><a href="#1-é¦–å…ˆè·å–-rpm-ï¼ˆæ·»åŠ -php-çš„-yum-ä»“åº“-ï¼‰ï¼š" class="headerlink" title="1. é¦–å…ˆè·å– rpm ï¼ˆæ·»åŠ  php çš„ yum ä»“åº“ ï¼‰ï¼š"></a>1. é¦–å…ˆè·å– rpm ï¼ˆæ·»åŠ  php çš„ yum ä»“åº“ ï¼‰ï¼š</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-Uvh</span> https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm   <span class="token function">rpm</span> <span class="token parameter variable">-Uvh</span> https://mirror.webtatic.com/yum/el7/webtatic-release.rpm    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åå¯ä»¥åˆ©ç”¨ sudo yum list php* æŸ¥çœ‹ç›®å‰éƒ½æœ‰ php çš„ä»€ä¹ˆç‰ˆæœ¬äº†ï¼Œå¯ä»¥å‘ç°ä» 4-7.2 çš„ç‰ˆæœ¬éƒ½æœ‰ï¼Œ7.2 ç‰ˆæœ¬åä¸º 72wï¼Œå› æ­¤å®‰è£…è¯¥ç‰ˆæœ¬å³å¯ï¼š</p><h3 id="2-å®‰è£…-php7-2"><a href="#2-å®‰è£…-php7-2" class="headerlink" title="2. å®‰è£… php7.2"></a>2. å®‰è£… php7.2</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> php72w<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†å®‰è£…å®Œæ¯•åï¼Œè¾“å…¥ <code>php -v</code> å‘ç°å¹¶æ²¡æœ‰è¯¥å‘½ä»¤ï¼Œå› ä¸º php72w åªæ˜¯å®‰è£…äº† php æœ€å°çš„åº“ï¼Œä¸€äº›åº”ç”¨è¿˜æœªå®‰è£…ï¼Œå› æ­¤å®‰è£…ä¸€äº›æ‹“å±•åŒ…å³å¯ï¼š</p><h3 id="3-å®‰è£…-php7-2-å…¶å®ƒæ‰©å±•ï¼ˆå®‰è£…è¿‡ç¨‹ä¸­å…¨éƒ¨é€‰-yes-å³å¯ï¼‰"><a href="#3-å®‰è£…-php7-2-å…¶å®ƒæ‰©å±•ï¼ˆå®‰è£…è¿‡ç¨‹ä¸­å…¨éƒ¨é€‰-yes-å³å¯ï¼‰" class="headerlink" title="3. å®‰è£… php7.2 å…¶å®ƒæ‰©å±•ï¼ˆå®‰è£…è¿‡ç¨‹ä¸­å…¨éƒ¨é€‰ yes å³å¯ï¼‰"></a>3. å®‰è£… php7.2 å…¶å®ƒæ‰©å±•ï¼ˆå®‰è£…è¿‡ç¨‹ä¸­å…¨éƒ¨é€‰ yes å³å¯ï¼‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»¥ä¸‹æ‰©å±•ä¸­æœ‰éƒ¨åˆ†å’Œä¸Šé¢çš„æ‰©å±•é‡å¤ï¼Œå®‰è£…çš„æ—¶å€™è¯·æ³¨æ„åŒºåˆ†</span><span class="token function">sudo</span> yum <span class="token function">install</span> php72w.x86_64 php72w-cli.x86_64 php72w-common.x86_64 php72w-gd.x86_64 php72w-ldap.x86_64 php72w-mbstring.x86_64 php72w-mcrypt.x86_64 php72w-mysql.x86_64 php72w-pdo.x86_64 php72w-devel.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="4-å®‰è£…-PHP-7-2-çš„-fpm"><a href="#4-å®‰è£…-PHP-7-2-çš„-fpm" class="headerlink" title="4. å®‰è£… PHP 7.2 çš„ fpm"></a>4. å®‰è£… PHP 7.2 çš„ fpm</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> php72w-fpm.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><h2 id="å®‰è£…-MySQL5-7-æˆ–-MySQL5-6"><a href="#å®‰è£…-MySQL5-7-æˆ–-MySQL5-6" class="headerlink" title="å®‰è£… MySQL5.7 æˆ– MySQL5.6"></a>å®‰è£… MySQL5.7 æˆ– MySQL5.6</h2></li></ul><h3 id="1-é…ç½®-YUM-æº"><a href="#1-é…ç½®-YUM-æº" class="headerlink" title="1. é…ç½® YUM æº"></a>1. é…ç½® YUM æº</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm<span class="token function">sudo</span> yum localinstall mysql57-community-release-el7-8.noarch.rpm<span class="token comment"># æ£€æŸ¥ mysql æºæ˜¯å¦å®‰è£…æˆåŠŸ</span>yum repolist enabled <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"mysql.*-community.*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-ä¿®æ”¹å®‰è£…-mysql-ç‰ˆæœ¬é…ç½®ï¼ˆç°åœ¨é»˜è®¤å®‰è£…æ˜¯-mysql5-7ï¼‰"><a href="#2-ä¿®æ”¹å®‰è£…-mysql-ç‰ˆæœ¬é…ç½®ï¼ˆç°åœ¨é»˜è®¤å®‰è£…æ˜¯-mysql5-7ï¼‰" class="headerlink" title="2. ä¿®æ”¹å®‰è£… mysql ç‰ˆæœ¬é…ç½®ï¼ˆç°åœ¨é»˜è®¤å®‰è£…æ˜¯ mysql5.7ï¼‰"></a>2. ä¿®æ”¹å®‰è£… mysql ç‰ˆæœ¬é…ç½®ï¼ˆç°åœ¨é»˜è®¤å®‰è£…æ˜¯ mysql5.7ï¼‰</h3><p>å¯ä»¥ä¿®æ”¹ <code>vim /etc/yum.repos.d/mysql-community.repo</code>  æºï¼Œæ”¹å˜é»˜è®¤å®‰è£…çš„ mysql ç‰ˆæœ¬ã€‚æ¯”å¦‚è¦å®‰è£… 5.7 ç‰ˆæœ¬ï¼Œå°† 5.6 æºçš„ <code>enabled=1</code> æ”¹æˆ <code>enabled=0</code> ã€‚ç„¶åå†å°† 5.7 æºçš„ <code>enabled=0</code> æ”¹æˆ <code>enabled=1</code> å³å¯ã€‚æ”¹å®Œä¹‹åçš„æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">15</span> <span class="token comment"># Enable to use MySQL 5.5</span><span class="token number">16</span> <span class="token punctuation">[</span>mysql55-community<span class="token punctuation">]</span><span class="token number">17</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>MySQL <span class="token number">5.5</span> Community Server<span class="token number">18</span> <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://repo.mysql.com/yum/mysql-5.5-community/el/7/<span class="token variable">$basearch</span>/<span class="token number">19</span> <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">0</span><span class="token number">20</span> <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span><span class="token number">21</span> <span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<span class="token number">22</span> <span class="token number">23</span> <span class="token comment"># Enable to use MySQL 5.6</span><span class="token number">24</span> <span class="token punctuation">[</span>mysql56-community<span class="token punctuation">]</span><span class="token number">25</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>MySQL <span class="token number">5.6</span> Community Server<span class="token number">26</span> <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://repo.mysql.com/yum/mysql-5.6-community/el/7/<span class="token variable">$basearch</span>/<span class="token number">27</span> <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">0</span><span class="token number">28</span> <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span><span class="token number">29</span> <span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<span class="token number">30</span> <span class="token number">31</span> <span class="token punctuation">[</span>mysql57-community<span class="token punctuation">]</span><span class="token number">32</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>MySQL <span class="token number">5.7</span> Community Server<span class="token number">33</span> <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://repo.mysql.com/yum/mysql-5.7-community/el/7/<span class="token variable">$basearch</span>/<span class="token number">34</span> <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span class="token number">35</span> <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span><span class="token number">36</span> <span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-å®‰è£…-MySQL"><a href="#3-å®‰è£…-MySQL" class="headerlink" title="3. å®‰è£… MySQL"></a>3. å®‰è£… MySQL</h3> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> mysql-community-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-å¯åŠ¨-MySQL"><a href="#4-å¯åŠ¨-MySQL" class="headerlink" title="4. å¯åŠ¨ MySQL"></a>4. å¯åŠ¨ MySQL</h3> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-é…ç½®å¼€æœºå¯åŠ¨"><a href="#5-é…ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="5. é…ç½®å¼€æœºå¯åŠ¨"></a>5. é…ç½®å¼€æœºå¯åŠ¨</h3> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> mysqldsystemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="6-ä¿®æ”¹-root-æœ¬åœ°ç™»å½•å¯†ç "><a href="#6-ä¿®æ”¹-root-æœ¬åœ°ç™»å½•å¯†ç " class="headerlink" title="6. ä¿®æ”¹ root æœ¬åœ°ç™»å½•å¯†ç "></a>6. ä¿®æ”¹ root æœ¬åœ°ç™»å½•å¯†ç </h3><p>mysql å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨ /var/log/mysqld.log æ–‡ä»¶ä¸­ç»™ root ç”Ÿæˆäº†ä¸€ä¸ªé»˜è®¤å¯†ç ã€‚é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ‰¾åˆ° root é»˜è®¤å¯†ç ï¼Œç„¶åç™»å½• mysql è¿›è¡Œä¿®æ”¹ï¼š</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> <span class="token comment"># æŸ¥æ‰¾é»˜è®¤ç”Ÿæˆçš„å¯†ç </span> <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log  <span class="token comment"># ç”¨é»˜è®¤ç”Ÿæˆçš„å¯†ç ç™»å½• mysql</span> mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>  <span class="token comment"># ä¿®æ”¹æ–°å¯†ç ä¸º MyNewPass4! </span> <span class="token comment"># ç”¨è¿™ç§æ–¹å¼ä¿®æ”¹å¯†ç çš„æ—¶å€™éœ€è¦æŠŠå¯†ç ä¿®æ”¹çš„ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä¸ç„¶è€æ˜¯æç¤ºä½ åˆ›å»ºçš„å¯†ç ä¸å®‰å…¨</span>ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'MyNewPass4!'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-é…ç½®é»˜è®¤ç¼–ç ä¸º-utf8"><a href="#7-é…ç½®é»˜è®¤ç¼–ç ä¸º-utf8" class="headerlink" title="7. é…ç½®é»˜è®¤ç¼–ç ä¸º utf8"></a>7. é…ç½®é»˜è®¤ç¼–ç ä¸º utf8</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥å‘½ä»¤è¡Œä¸‹æ•²å‘½ä»¤ï¼Œä¸éœ€è¦ç™»å½• mysql ä¹‹å</span><span class="token assign-left variable">character_set_server</span><span class="token operator">=</span>utf8<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET NAMES utf8'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><h2 id="å®‰è£…-Apache"><a href="#å®‰è£…-Apache" class="headerlink" title="å®‰è£… Apache"></a>å®‰è£… Apache</h2></li></ul><h3 id="1-å®‰è£…-httpd"><a href="#1-å®‰è£…-httpd" class="headerlink" title="1. å®‰è£… httpd"></a>1. å®‰è£… httpd</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> httpd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-ä¿®æ”¹-apache-é…ç½®æ–‡ä»¶"><a href="#2-ä¿®æ”¹-apache-é…ç½®æ–‡ä»¶" class="headerlink" title="2. ä¿®æ”¹ apache é…ç½®æ–‡ä»¶"></a>2. ä¿®æ”¹ apache é…ç½®æ–‡ä»¶</h3><p>ä¸»é…ç½®æ–‡ä»¶çš„è·¯å¾„ä¸º /etc/httpd/conf/httpd.conf<br>æ‰©å±•é…ç½®æ–‡ä»¶è·¯å¾„ä¸º /etc/httpd/conf.d/*.conf</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/httpd/conf.d/sample.conf<span class="token comment"># é…ç½®æ–‡ä»¶ç¼–å†™å¦‚ä¸‹</span> <span class="token operator">&lt;</span>VirtualHost *:8<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>   <span class="token comment"># é¡¹ç›®æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤é¡¹ç›®ç›®å½•åœ¨ /var/www/html/ ä¸‹</span>   DocumentRoot /var/www/html/sample/public   <span class="token comment"># è™šæ‹ŸåŸŸå</span>   ServerName test.drling.xin   <span class="token comment"># å¤šä¸ªè™šæ‹ŸåŸŸå</span>   ServerAlias sample.drling.xin   <span class="token comment"># å¦‚æœè¿˜éœ€è¦é…ç½®ç¬¬ä¸‰ä¸ªè™šæ‹ŸåŸŸå</span>   ServerAlias www.drling.xin   <span class="token comment"># é”™è¯¯æ—¥å¿—ç›®å½•</span>   ErrorLog /var/log/httpd/sample-error_log   <span class="token comment"># è®¿é—®æ—¥å¿—ç›®å½•</span>   Customlog /var/log/httpd/sample-access_log common <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-å¯åŠ¨-httpd"><a href="#3-å¯åŠ¨-httpd" class="headerlink" title="3. å¯åŠ¨ httpd"></a>3. å¯åŠ¨ httpd</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¼€å¯/é‡å¯/åœæ­¢/çŠ¶æ€</span>systemctl start/restart/stop/status httpd <span class="token comment"># å¼€æœºå¯åŠ¨ httpd</span>systemctl <span class="token builtin class-name">enable</span> httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä»¥ä¸‹æ­¥éª¤æˆ‘æ­å»ºæœåŠ¡å™¨çš„æ—¶å€™æ²¡æœ‰æ“ä½œï¼Œå‘ç°é¡¹ç›®ä¹Ÿè¿è¡Œèµ·æ¥äº†</strong></p><h3 id="4-ä¿®æ”¹-httpd-conf-é…ç½®"><a href="#4-ä¿®æ”¹-httpd-conf-é…ç½®" class="headerlink" title="4. ä¿®æ”¹ httpd.conf é…ç½®"></a>4. ä¿®æ”¹ httpd.conf é…ç½®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># line 86: æ”¹å˜ç®¡ç†å‘˜çš„é‚®ç®±åœ°å€</span>ServerAdmin root@linuxprobe.org<span class="token comment"># line 95: æ”¹å˜åŸŸåä¿¡æ¯</span>ServerName www.linuxprobe.org:80<span class="token comment"># line 151: noneå˜æˆAll</span>AllowOverride All<span class="token comment"># line 164: æ·»åŠ åªèƒ½ä½¿ç”¨ç›®å½•åç§°è®¿é—®çš„æ–‡ä»¶å</span>DirectoryIndex index.html index.cgi index.php<span class="token comment"># add follows to the end</span><span class="token comment"># server's response headerï¼ˆå®‰å…¨æ€§ï¼‰</span>ServerTokens Prod<span class="token comment"># keepalive is ON</span>KeepAlive On<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-ä¿®æ”¹é˜²ç«å¢™é…ç½®"><a href="#5-ä¿®æ”¹é˜²ç«å¢™é…ç½®" class="headerlink" title="5. ä¿®æ”¹é˜²ç«å¢™é…ç½®"></a>5. ä¿®æ”¹é˜²ç«å¢™é…ç½®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å¦‚æœ Firewalld æ­£åœ¨è¿è¡Œï¼Œè¯·å…è®¸ HTTP æœåŠ¡ã€‚HTTP ä½¿ç”¨ <span class="token number">80</span>/TCPfirewall-cmd --add-service<span class="token operator">=</span>http <span class="token parameter variable">--permanent</span>firewall-cmd <span class="token parameter variable">--reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="6-è¿è¡Œ-tp5-é¡¹ç›®çš„æ—¶å€™æç¤ºæ²¡æœ‰å†™-session-çš„æƒé™ï¼Œé»˜è®¤-session-æ–‡ä»¶å¤¹å¦‚ä¸‹"><a href="#6-è¿è¡Œ-tp5-é¡¹ç›®çš„æ—¶å€™æç¤ºæ²¡æœ‰å†™-session-çš„æƒé™ï¼Œé»˜è®¤-session-æ–‡ä»¶å¤¹å¦‚ä¸‹" class="headerlink" title="6. è¿è¡Œ tp5 é¡¹ç›®çš„æ—¶å€™æç¤ºæ²¡æœ‰å†™ session çš„æƒé™ï¼Œé»˜è®¤ session æ–‡ä»¶å¤¹å¦‚ä¸‹"></a>6. è¿è¡Œ tp5 é¡¹ç›®çš„æ—¶å€™æç¤ºæ²¡æœ‰å†™ session çš„æƒé™ï¼Œé»˜è®¤ session æ–‡ä»¶å¤¹å¦‚ä¸‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># session æ–‡ä»¶å¤¹è·¯å¾„ï¼š /var/lib/php/session/</span><span class="token comment"># ç»™æœ€å¤§æƒé™ </span><span class="token function">chmod</span> 0777 <span class="token parameter variable">-R</span> /var/lib/php/session<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CentOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> LAMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç»™å·²ç»è¿è¡Œä¸­çš„ docker å®¹å™¨æ·»åŠ æˆ–è€…ä¿®æ”¹ç«¯å£æ˜ å°„ï¼Ÿ</title>
      <link href="posts/2a105f69.html"/>
      <url>posts/2a105f69.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•ç»™å·²ç»è¿è¡Œä¸­çš„-docker-å®¹å™¨æ·»åŠ æˆ–è€…ä¿®æ”¹ç«¯å£æ˜ å°„ï¼Ÿ"><a href="#å¦‚ä½•ç»™å·²ç»è¿è¡Œä¸­çš„-docker-å®¹å™¨æ·»åŠ æˆ–è€…ä¿®æ”¹ç«¯å£æ˜ å°„ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»™å·²ç»è¿è¡Œä¸­çš„ docker å®¹å™¨æ·»åŠ æˆ–è€…ä¿®æ”¹ç«¯å£æ˜ å°„ï¼Ÿ"></a>å¦‚ä½•ç»™å·²ç»è¿è¡Œä¸­çš„ docker å®¹å™¨æ·»åŠ æˆ–è€…ä¿®æ”¹ç«¯å£æ˜ å°„ï¼Ÿ</h1><h2 id="å®¹å™¨è¿˜æ²¡æœ‰æ„å»º"><a href="#å®¹å™¨è¿˜æ²¡æœ‰æ„å»º" class="headerlink" title="å®¹å™¨è¿˜æ²¡æœ‰æ„å»º"></a>å®¹å™¨è¿˜æ²¡æœ‰æ„å»º</h2><p>å¦‚æœä½ çš„å®¹å™¨è¿˜æ²¡æœ‰æ„å»ºæ—¶ï¼Œæƒ³æ·»åŠ ç«¯å£æ˜ å°„æ—¶ï¼Œä½ åªéœ€è¦åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™æ·»åŠ  <code>-p</code> å‚æ•°ï¼Œæƒ³æ·»åŠ å‡ ä¸ªç«¯å£æ˜ å°„å°±è¿½åŠ å‡ ä¸ª <code>-p</code> å‚æ•°ã€‚ç±»ä¼¼äºå¦‚ä¸‹ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> api_dfo_hyperf_ws <span class="token punctuation">\</span><span class="token parameter variable">-v</span> /Users/pudongping/glory/codes/dfo/api_dfo_hyperf:/api_dfo_hyperf <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9502</span>:9502 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9503</span>:9503 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9504</span>:9504 <span class="token punctuation">\</span><span class="token parameter variable">-p</span> <span class="token number">9505</span>:9505 <span class="token parameter variable">-it</span> <span class="token punctuation">\</span><span class="token parameter variable">--entrypoint</span> /bin/sh <span class="token punctuation">\</span>alex/alex_api_dfo:v1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®¹å™¨å·²ç»æ„å»ºï¼Œä½†æ˜¯æƒ³ä¿®æ”¹æˆ–è€…æ·»åŠ ç«¯å£æ—¶"><a href="#å®¹å™¨å·²ç»æ„å»ºï¼Œä½†æ˜¯æƒ³ä¿®æ”¹æˆ–è€…æ·»åŠ ç«¯å£æ—¶" class="headerlink" title="å®¹å™¨å·²ç»æ„å»ºï¼Œä½†æ˜¯æƒ³ä¿®æ”¹æˆ–è€…æ·»åŠ ç«¯å£æ—¶"></a>å®¹å™¨å·²ç»æ„å»ºï¼Œä½†æ˜¯æƒ³ä¿®æ”¹æˆ–è€…æ·»åŠ ç«¯å£æ—¶</h2><h3 id="å…ˆåœæ­¢æ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚"><a href="#å…ˆåœæ­¢æ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚" class="headerlink" title="å…ˆåœæ­¢æ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚"></a>å…ˆåœæ­¢æ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚</h3><blockquote><p>ä»¥ä¸‹å†…å®¹éƒ½æ˜¯ä»¥å®¹å™¨ id ä¸º <code>cbe26510c276</code> è¿›è¡Œæ“ä½œçš„ï¼Œè¯·åŠ¡å¿…å°†å®¹å™¨ id æ¢æˆä½ è‡ªå·±éœ€è¦ä¿®æ”¹çš„å®¹å™¨ idã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> stop <span class="token punctuation">{</span>å®¹å™¨çš„åç§°æˆ–è€… <span class="token function">id</span> <span class="token punctuation">}</span><span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token function">docker</span> stop cbe26510c276<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æŸ¥çœ‹å®¹å™¨å®Œæ•´çš„-hash-of-the-container-æ•°å€¼"><a href="#æŸ¥çœ‹å®¹å™¨å®Œæ•´çš„-hash-of-the-container-æ•°å€¼" class="headerlink" title="æŸ¥çœ‹å®¹å™¨å®Œæ•´çš„ hash_of_the_container æ•°å€¼"></a>æŸ¥çœ‹å®¹å™¨å®Œæ•´çš„ <code>hash_of_the_container</code> æ•°å€¼</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> inspect <span class="token punctuation">{</span>å®¹å™¨çš„åç§°æˆ–è€… <span class="token function">id</span> <span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">grep</span> Id<span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token function">docker</span> inspect cbe26510c276 <span class="token operator">|</span> <span class="token function">grep</span> Id<span class="token comment"># ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</span><span class="token comment"># "Id": "cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰“å¼€-hostconfig-json-é…ç½®æ–‡ä»¶"><a href="#æ‰“å¼€-hostconfig-json-é…ç½®æ–‡ä»¶" class="headerlink" title="æ‰“å¼€ hostconfig.json é…ç½®æ–‡ä»¶"></a>æ‰“å¼€ <code>hostconfig.json</code> é…ç½®æ–‡ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /var/lib/docker/containers/<span class="token punctuation">{</span>hash_of_the_container<span class="token punctuation">}</span>/hostconfig.json<span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token function">vim</span> /var/lib/docker/containers/cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00/hostconfig.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¦‚æœä½ ä¸æƒ³å…ˆæŸ¥çœ‹å®Œæ•´çš„å®¹å™¨ <code>hash_of_the_container</code> æ•°å€¼ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥å…ˆåˆ‡æ¢åˆ°å½“å‰å®¹å™¨ç›¸å…³ç›®å½•ä¸­ <code>cd /var/lib/docker/containers/{hash_of_the_container}*</code> ï¼Œ ç„¶åå†å»ç¼–è¾‘ <code>hostconfig.json</code> é…ç½®æ–‡ä»¶ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /var/lib/docker/containers/<span class="token punctuation">{</span>hash_of_the_container<span class="token punctuation">}</span>*<span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token builtin class-name">cd</span> /var/lib/docker/containers/cbe26510c276*<span class="token comment"># ç„¶åå†å»ç¼–è¾‘ `hostconfig.json` é…ç½®æ–‡ä»¶</span><span class="token function">vim</span> hostconfig.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¿®æ”¹-hostconfig-json-é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹-hostconfig-json-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ hostconfig.json é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ <code>hostconfig.json</code> é…ç½®æ–‡ä»¶</h3><p>åœ¨ <code>hostconfig.json</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ° <code>"PortBindings":{}</code> è¿™ä¸ªé…ç½®é¡¹ï¼Œç„¶åè¿›è¡Œä¿®æ”¹ã€‚æˆ‘è¿™é‡Œæ·»åŠ äº†ä¸¤ä¸ªç«¯å£æ˜ å°„ï¼Œåˆ†åˆ«å°†å®¿ä¸»æœºçš„ <code>8502</code> ç«¯å£ä»¥åŠ <code>8505</code> ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ <code>8502</code> ç«¯å£å’Œ <code>8505</code> ç«¯å£ã€‚</p><p><code>HostPort</code> å¯¹åº”çš„ç«¯å£ä»£è¡¨ <strong>å®¿ä¸»æœº</strong> çš„ç«¯å£ã€‚</p><blockquote><p>å»ºè®®å®¹å™¨ä½¿ç”¨ä»€ä¹ˆç«¯å£ï¼Œå®¿ä¸»æœºå°±æ˜ å°„ä»€ä¹ˆç«¯å£ï¼Œæ–¹ä¾¿ä»¥åç®¡ç†ã€‚å½“ç„¶ï¼Œå…·ä½“æƒ…å†µï¼Œå…·ä½“åˆ†æã€‚</p></blockquote><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"Binds"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"/data/portal_api_dfo_hyperf/:/portal_api_dfo_hyperf"</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"ContainerIDFile"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"LxcConf"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"Memory"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"MemorySwap"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"CpuShares"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"CpusetCpus"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"Privileged"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"PortBindings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"8502/tcp"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                <span class="token property">"HostIp"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>                <span class="token property">"HostPort"</span><span class="token operator">:</span> <span class="token string">"8502"</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"8505/tcp"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>                <span class="token property">"HostIp"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>                <span class="token property">"HostPort"</span><span class="token operator">:</span> <span class="token string">"8505"</span>            <span class="token punctuation">}</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"Links"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"PublishAllPorts"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"Dns"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"DnsSearch"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"ExtraHosts"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"VolumesFrom"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"Devices"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"NetworkMode"</span><span class="token operator">:</span> <span class="token string">"bridge"</span><span class="token punctuation">,</span>    <span class="token property">"IpcMode"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"PidMode"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"CapAdd"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"CapDrop"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"RestartPolicy"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"no"</span><span class="token punctuation">,</span>        <span class="token property">"MaximumRetryCount"</span><span class="token operator">:</span> <span class="token number">0</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"SecurityOpt"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"ReadonlyRootfs"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"Ulimits"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>    <span class="token property">"LogConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"Config"</span><span class="token operator">:</span> <span class="token null keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"CgroupParent"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¦‚æœ-config-v2-json-é…ç½®æ–‡ä»¶æˆ–è€…-config-json-é…ç½®æ–‡ä»¶ä¸­ä¹Ÿè®°å½•äº†ç«¯å£ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦æ”¹ã€‚"><a href="#å¦‚æœ-config-v2-json-é…ç½®æ–‡ä»¶æˆ–è€…-config-json-é…ç½®æ–‡ä»¶ä¸­ä¹Ÿè®°å½•äº†ç«¯å£ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦æ”¹ã€‚" class="headerlink" title="å¦‚æœ config.v2.json é…ç½®æ–‡ä»¶æˆ–è€… config.json é…ç½®æ–‡ä»¶ä¸­ä¹Ÿè®°å½•äº†ç«¯å£ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦æ”¹ã€‚"></a>å¦‚æœ <code>config.v2.json</code> é…ç½®æ–‡ä»¶æˆ–è€… <code>config.json</code> é…ç½®æ–‡ä»¶ä¸­ä¹Ÿè®°å½•äº†ç«¯å£ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦æ”¹ã€‚</h3><blockquote><p>åªéœ€è¦ä¿®æ”¹ <code>"ExposedPorts": {}</code> ç›¸å…³ä¹‹å¤„ã€‚</p></blockquote><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"State"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"Running"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"Paused"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"Restarting"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"OOMKilled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"Dead"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"Pid"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"ExitCode"</span><span class="token operator">:</span> <span class="token number">137</span><span class="token punctuation">,</span>        <span class="token property">"Error"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"StartedAt"</span><span class="token operator">:</span> <span class="token string">"2021-05-17T07:48:26.743090016Z"</span><span class="token punctuation">,</span>        <span class="token property">"FinishedAt"</span><span class="token operator">:</span> <span class="token string">"2021-07-02T06:05:33.025441199Z"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token string">"cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00"</span><span class="token punctuation">,</span>    <span class="token property">"Created"</span><span class="token operator">:</span> <span class="token string">"2020-12-23T07:02:00.997803339Z"</span><span class="token punctuation">,</span>    <span class="token property">"Path"</span><span class="token operator">:</span> <span class="token string">"/bin/sh"</span><span class="token punctuation">,</span>    <span class="token property">"Args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"Config"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"Hostname"</span><span class="token operator">:</span> <span class="token string">"cbe26510c276"</span><span class="token punctuation">,</span>        <span class="token property">"Domainname"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"User"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"Memory"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"MemorySwap"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"CpuShares"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"Cpuset"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"AttachStdin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"AttachStdout"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"AttachStderr"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"PortSpecs"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"ExposedPorts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"8502/tcp"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token property">"8505/tcp"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"Tty"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"OpenStdin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"StdinOnce"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"Env"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><span class="token punctuation">,</span>            <span class="token string">"SW_VERSION=v4.5.10"</span><span class="token punctuation">,</span>            <span class="token string">"COMPOSER_VERSION=2.0.8"</span><span class="token punctuation">,</span>            <span class="token string">"PHPIZE_DEPS=autoconf dpkg-dev dpkg file g++ gcc libc-dev make php7-dev php7-pear pkgconf re2c pcre-dev pcre2-dev zlib-dev libtool automake"</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"Cmd"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"Image"</span><span class="token operator">:</span> <span class="token string">"hyperf/hyperf:7.4-alpine-v3.11-swoole"</span><span class="token punctuation">,</span>        <span class="token property">"Volumes"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"WorkingDir"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"Entrypoint"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"/bin/sh"</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"NetworkDisabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"MacAddress"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"OnBuild"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"Labels"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>            <span class="token property">"maintainer"</span><span class="token operator">:</span> <span class="token string">"Hyperf Developers &lt;group@hyperf.io&gt;"</span><span class="token punctuation">,</span>            <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"Image"</span><span class="token operator">:</span> <span class="token string">"f503e215646f50e5242a6bdf1c6a9a176910c99600b3472b390892f59c87c3a1"</span><span class="token punctuation">,</span>    <span class="token property">"NetworkSettings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"IPAddress"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"IPPrefixLen"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"MacAddress"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"LinkLocalIPv6Address"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"LinkLocalIPv6PrefixLen"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"GlobalIPv6Address"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"GlobalIPv6PrefixLen"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"Gateway"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"IPv6Gateway"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"Bridge"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"PortMapping"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"Ports"</span><span class="token operator">:</span> <span class="token null keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"ResolvConfPath"</span><span class="token operator">:</span> <span class="token string">"/var/lib/docker/containers/cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00/resolv.conf"</span><span class="token punctuation">,</span>    <span class="token property">"HostnamePath"</span><span class="token operator">:</span> <span class="token string">"/var/lib/docker/containers/cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00/hostname"</span><span class="token punctuation">,</span>    <span class="token property">"HostsPath"</span><span class="token operator">:</span> <span class="token string">"/var/lib/docker/containers/cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00/hosts"</span><span class="token punctuation">,</span>    <span class="token property">"LogPath"</span><span class="token operator">:</span> <span class="token string">"/var/lib/docker/containers/cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00/cbe26510c276fa9a4487a8c2af8cbb49410f2a5305149d2b26eb8ce37c777d00-json.log"</span><span class="token punctuation">,</span>    <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"/portal_api_dfo_hyperf"</span><span class="token punctuation">,</span>    <span class="token property">"Driver"</span><span class="token operator">:</span> <span class="token string">"aufs"</span><span class="token punctuation">,</span>    <span class="token property">"ExecDriver"</span><span class="token operator">:</span> <span class="token string">"native-0.2"</span><span class="token punctuation">,</span>    <span class="token property">"MountLabel"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"ProcessLabel"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"AppArmorProfile"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"RestartCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"UpdateDns"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"Volumes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"/portal_api_dfo_hyperf"</span><span class="token operator">:</span> <span class="token string">"/data/portal_api_dfo_hyperf"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"VolumesRW"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"/portal_api_dfo_hyperf"</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"AppliedVolumesFrom"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœ€åé‡å¯-dockerï¼Œç„¶åæŸ¥çœ‹å®¹å™¨ç›¸å…³é…ç½®ä¿¡æ¯æ˜¯å¦å·²ç»ä¿®æ”¹å®Œæ¯•"><a href="#æœ€åé‡å¯-dockerï¼Œç„¶åæŸ¥çœ‹å®¹å™¨ç›¸å…³é…ç½®ä¿¡æ¯æ˜¯å¦å·²ç»ä¿®æ”¹å®Œæ¯•" class="headerlink" title="æœ€åé‡å¯ dockerï¼Œç„¶åæŸ¥çœ‹å®¹å™¨ç›¸å…³é…ç½®ä¿¡æ¯æ˜¯å¦å·²ç»ä¿®æ”¹å®Œæ¯•"></a>æœ€åé‡å¯ dockerï¼Œç„¶åæŸ¥çœ‹å®¹å™¨ç›¸å…³é…ç½®ä¿¡æ¯æ˜¯å¦å·²ç»ä¿®æ”¹å®Œæ¯•</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é‡å¯ docker</span><span class="token function">service</span> <span class="token function">docker</span> restart <span class="token comment"># æˆ–è€…</span>systemctl restart <span class="token function">docker</span><span class="token comment"># æŸ¥çœ‹å®¹å™¨ç›¸å…³é…ç½®ä¿¡æ¯</span><span class="token function">docker</span> inspect <span class="token punctuation">{</span>å®¹å™¨çš„åç§°æˆ–è€… <span class="token function">id</span> <span class="token punctuation">}</span><span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token function">docker</span> inspect cbe26510c276<span class="token comment"># é…ç½®ç¬¦åˆä½ çš„è¦æ±‚åï¼Œå†æ¬¡å¯åŠ¨å®¹å™¨</span><span class="token function">docker</span> start <span class="token punctuation">{</span>å®¹å™¨çš„åç§°æˆ–è€… <span class="token function">id</span> <span class="token punctuation">}</span><span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token function">docker</span> start cbe26510c276<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚æœæ˜¯ä½¿ç”¨çš„-Docker-Desktop-for-Mac-æ—¶"><a href="#å¦‚æœæ˜¯ä½¿ç”¨çš„-Docker-Desktop-for-Mac-æ—¶" class="headerlink" title="å¦‚æœæ˜¯ä½¿ç”¨çš„ Docker Desktop for Mac æ—¶"></a>å¦‚æœæ˜¯ä½¿ç”¨çš„ <code>Docker Desktop for Mac</code> æ—¶</h2><h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><blockquote><p><a href="https://www.modb.pro/db/5458">How to login the VM of Docker Desktop for Mac</a></p></blockquote><p>å› ä¸ºåœ¨ Docker for MacOS ä¸­ï¼Œå®¹å™¨çš„å®¿ä¸»æœºå¹¶ä¸æ˜¯ MacOS æœ¬èº«ï¼Œè€Œæ˜¯åœ¨ MacOS ä¸­è¿è¡Œçš„ä¸€ä¸ª VM è™šæ‹Ÿæœº<br>ã€‚è™šæ‹Ÿæœºçš„è·¯å¾„å¯ä»¥é€šè¿‡æŸ¥çœ‹ Docker Desktop çš„é…ç½®ç•Œé¢ <code>Disk image location</code> é…ç½®è·å¾—ã€‚</p><h3 id="é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›å…¥è¿™ä¸ªè™šæ‹Ÿæœºå‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›å…¥è¿™ä¸ªè™šæ‹Ÿæœºå‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›å…¥è¿™ä¸ªè™šæ‹Ÿæœºå‘¢ï¼Ÿ"></a>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›å…¥è¿™ä¸ªè™šæ‹Ÿæœºå‘¢ï¼Ÿ</h3><p>æœ€ç®€å•çš„æ–¹å¼æ˜¯é‡‡ç”¨ <a href="https://github.com/justincormack/nsenter1">justincormack/nsenter1</a> è¿›å…¥ï¼Œè¿™ä¸ªé•œåƒåªæœ‰ 101KBï¼Œå·²ç»éå¸¸å°äº†ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># â€“rm è¡¨ç¤ºåœ¨é€€å‡ºçš„æ—¶å€™å°±è‡ªåŠ¨åˆ é™¤è¯¥å®¹å™¨ï¼›</span><span class="token comment"># â€“privileged è¡¨ç¤ºå…è®¸è¯¥å®¹å™¨è®¿é—®å®¿ä¸»æœºï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦ç™»å½•çš„ VM ï¼‰ä¸­çš„å„ç§è®¾å¤‡ï¼›</span><span class="token comment"># â€“pid=host è¡¨ç¤ºå…è®¸å®¹å™¨å…±äº«å®¿ä¸»æœºçš„è¿›ç¨‹å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼Œæˆ–è€…é€šä¿—ç‚¹å„¿è§£é‡Šå°±æ˜¯å…è®¸å®¹å™¨çœ‹åˆ°å®¿ä¸»æœºä¸­çš„å„ç§è¿›ç¨‹ï¼›</span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> <span class="token parameter variable">--privileged</span> <span class="token parameter variable">--pid</span><span class="token operator">=</span>host justincormack/nsenter1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå†è¿›å…¥ <code>/var/lib/docker/containers</code> ç›®å½•ä¿®æ”¹ <code>config.v2.json</code> é…ç½®æ–‡ä»¶å’Œ <code>hostconfig.json</code> é…ç½®æ–‡ä»¶å³å¯ã€‚æ•´ä½“æ¥è¯´ï¼Œåœ¨ MacOS ä¸Šé™¤äº†è¿›å…¥  <code>/var/lib/docker/containers</code> ç›®å½•æ—¶ï¼Œè¿›å…¥æ–¹å¼æœ‰æ‰€ä¸åŒä»¥å¤–ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶æ–¹å¼å’Œä¸Šæ–‡ä¸€æ ·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¿®æ”¹çš„æ—¶å€™è¯·ä½¿ç”¨ <code>vi</code> ç¼–è¾‘å™¨ï¼Œå› ä¸ºè¿™ä¸ªé•œåƒæ²¡æœ‰å®‰è£… <code>vim</code> ç¼–è¾‘å™¨çš„ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¯”å¦‚ï¼š</span><span class="token function">vi</span> /var/lib/docker/containers/a7377587b9f08cfe87af9a8ffa4da0f90bf07fb0a1cd6833a5ffcd9c37b842d0/config.v2.json<span class="token function">vi</span> /var/lib/docker/containers/a7377587b9f08cfe87af9a8ffa4da0f90bf07fb0a1cd6833a5ffcd9c37b842d0/hostconfig.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7.4 64ä½ ç¼–è¯‘å®‰è£… LNMP</title>
      <link href="posts/2ccaa736.html"/>
      <url>posts/2ccaa736.html</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS-7-4-64ä½-ç¼–è¯‘å®‰è£…-LNMP"><a href="#CentOS-7-4-64ä½-ç¼–è¯‘å®‰è£…-LNMP" class="headerlink" title="CentOS 7.4 64ä½ ç¼–è¯‘å®‰è£… LNMP"></a>CentOS 7.4 64ä½ ç¼–è¯‘å®‰è£… LNMP</h1><h2 id="æŸ¥çœ‹-Linux-ç‰ˆæœ¬"><a href="#æŸ¥çœ‹-Linux-ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ Linux ç‰ˆæœ¬"></a>æŸ¥çœ‹ Linux ç‰ˆæœ¬</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/redhat-release<span class="token comment"># CentOS Linux release 7.4.1708 (Core)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="1-å®‰è£…-nginx"><a href="#1-å®‰è£…-nginx" class="headerlink" title="1. å®‰è£… nginx"></a>1. å®‰è£… nginx</h2><p>1-1. å®‰è£… nginx æº</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum localinstall http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>1-2. å®‰è£… nginx</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>1-3. å¯åŠ¨ nginx</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-å®‰è£…-MySQL"><a href="#2-å®‰è£…-MySQL" class="headerlink" title="2. å®‰è£… MySQL"></a>2. å®‰è£… MySQL</h2><p>2-1. å®‰è£… MySQL æº</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum localinstall  http://dev.mysql.com/get/mysql57-community-release-el7-7.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2-2. å®‰è£… MySQL</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> mysql-community-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®‰è£… MySQL å¼€å‘åŒ… ï¼ˆ*ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> mysql-community-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2-3. å¯åŠ¨ MySQL</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2-4. æŸ¥çœ‹ MySQL æ˜¯å¦å¯åŠ¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl status mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2-5. æŸ¥çœ‹ MySQL é»˜è®¤å¯†ç </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é¦–æ¬¡å¯åŠ¨,ä¼šæŠŠå¯†ç æ”¾åœ¨ /var/log/mysqld.log é‡Œé¢</span><span class="token comment"># 2018-10-13T15:51:47.482124Z 1 [Note] A temporary password is generated for root@localhost: r)eS,gjku4ts</span><span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>2-6. æ›´æ”¹ MySQL å¯†ç </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 01ã€ç™»å…¥æ•°æ®åº“</span>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> <span class="token comment"># è¾“å…¥å¯†ç </span>r<span class="token punctuation">)</span>eS,gjku4ts<span class="token comment"># è¿™é‡Œçš„å¯†ç  r)eS,gjku4ts æ˜¯ä»ä»¥ä¸Š mysqld.log ä¸­æŸ¥è¯¢å‡ºæ¥çš„</span><span class="token comment"># 02ã€ä¿®æ”¹ root è´¦å·å¯†ç  ï¼ˆå¯†ç å®‰å…¨çº§åˆ«è¦ç¨å¾®é«˜ä¸€ç‚¹ï¼Œä¸ç„¶æ›´æ–°ä¸ä¼šæˆåŠŸï¼‰</span>ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'QAZwsx123!@#'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2-7. å°† root ç”¨æˆ·æ›´æ”¹ä¸ºå¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 01ã€æ‰“å¼€ mysql æ•°æ®è¡¨</span>use mysql<span class="token punctuation">;</span><span class="token comment"># 02ã€æŸ¥çœ‹ mysql æ•°æ®è¡¨ä¸­æ•°æ®</span><span class="token keyword">select</span> user,host from user<span class="token punctuation">;</span><span class="token comment"># 03ã€ % ä»£è¡¨ä»»ä½• ip éƒ½èƒ½è®¿é—®</span>UPDATE user SET <span class="token function">host</span> <span class="token operator">=</span> <span class="token string">'%'</span> WHERE user <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span><span class="token comment"># 04ã€å†æ¬¡æŸ¥çœ‹ mysql æ•°æ®è¡¨ä¸­çš„æ•°æ®</span><span class="token keyword">select</span> user,host from user<span class="token punctuation">;</span><span class="token comment"># 05ã€åˆ·æ–°æƒé™</span>flush privileges<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2-8. æ–°å»ºä¸€ä¸ªç”¨æˆ·å¹¶ä¸”èµ‹äºˆæƒé™ï¼ˆå› ä¸º root ç”¨æˆ·å¼€æ”¾å¤–é¢ä½¿ç”¨æ¯•ç«Ÿä¸å®‰å…¨ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 01ã€æ–°å»º mysql è´¦æˆ·</span>grant all privileges on *.* to  alex@<span class="token string">"%"</span> identified by <span class="token string">"QAZwsx123!@#"</span> with grant option<span class="token punctuation">;</span><span class="token comment"># grant æ˜¯æˆæƒå‘½ä»¤ï¼Œå…¶ä¸­ alex æ˜¯æˆ‘ä»¬è¿æ¥ç”¨çš„ç”¨æˆ·åã€"AZwsx123!@#"æ˜¯è¿æ¥å¯†ç ï¼Œç”¨æˆ·ååé¢çš„ "%" é€šç”¨ç¬¦è¡¨ç¤ºå…è®¸å„ host æ“ä½œã€‚</span><span class="token comment"># ä¸Šé¢è¿™æ¡å‘½ä»¤æ˜¯æŒ‡</span><span class="token comment"># è‡ªåŠ¨åˆ›å»ºç”¨æˆ· alex ,å¯†ç  AZwsx123!@#</span><span class="token comment"># æ ¼å¼ï¼šgrant æƒé™ on æ•°æ®åº“å.è¡¨å to ç”¨æˆ·@ç™»å½•ä¸»æœº identified by "ç”¨æˆ·å¯†ç "; </span><span class="token comment"># @ åé¢æ˜¯è®¿é—®mysqlçš„å®¢æˆ·ç«¯IPåœ°å€ï¼ˆæˆ–æ˜¯ ä¸»æœºåï¼‰ % ä»£è¡¨ä»»æ„çš„å®¢æˆ·ç«¯ï¼Œå¦‚æœå¡«å†™ localhost ä¸ºæœ¬åœ°è®¿é—®ï¼ˆé‚£æ­¤ç”¨æˆ·å°±ä¸èƒ½è¿œç¨‹è®¿é—®è¯¥mysqlæ•°æ®åº“äº†ï¼‰ã€‚</span><span class="token comment"># 02ã€åˆ·æ–°æƒé™</span>flush privileges<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-ç¼–è¯‘å®‰è£…-php7-2"><a href="#3-ç¼–è¯‘å®‰è£…-php7-2" class="headerlink" title="3. ç¼–è¯‘å®‰è£… php7.2"></a>3. ç¼–è¯‘å®‰è£… php7.2</h2><p>3-1. ä¸‹è½½å®‰è£…åŒ…ï¼Œä¸€èˆ¬æƒ…å†µä¸‹,æˆ‘ä»¬éƒ½ä¼šä¸‹è½½åˆ° /usr/local/src ä¸‹é¢</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 01ã€è¿›å…¥ src ç›®å½•</span><span class="token builtin class-name">cd</span> /usr/local/src<span class="token comment"># 02ã€ä¸‹è½½ php7.2 æºç åŒ…</span><span class="token function">wget</span> <span class="token parameter variable">-O</span> php72.tar.gz http://cn2.php.net/get/php-7.2.0.tar.gz/from/this/mirror<span class="token comment"># 03ã€è§£å‹å®‰è£…åŒ…</span><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> php72.tar.gz<span class="token comment"># 04ã€è¿›å…¥è§£å‹åçš„åŒ…</span><span class="token builtin class-name">cd</span> php-7.2.0<span class="token comment"># 05ã€å®‰è£… php çš„ä¾èµ–</span>yum <span class="token function">install</span> libxml2 libxml2-devel openssl openssl-devel <span class="token function">bzip2</span> bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel<span class="token comment"># 06ã€æ–°å»º php è¿™ä¸ªæ–‡ä»¶å¤¹ï¼ˆç¼–è¯‘é…ç½®ä¼šç”¨åˆ°ï¼‰</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/php<span class="token comment"># 07ã€ç¼–è¯‘é…ç½®</span>./configure <span class="token punctuation">\</span><span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/php <span class="token punctuation">\</span>--with-config-file-path<span class="token operator">=</span>/etc <span class="token punctuation">\</span>--enable-fpm <span class="token punctuation">\</span>--with-fpm-user<span class="token operator">=</span>nginx  <span class="token punctuation">\</span>--with-fpm-group<span class="token operator">=</span>nginx <span class="token punctuation">\</span>--enable-inline-optimization <span class="token punctuation">\</span>--disable-debug <span class="token punctuation">\</span>--disable-rpath <span class="token punctuation">\</span>--enable-shared  <span class="token punctuation">\</span>--enable-soap <span class="token punctuation">\</span>--with-libxml-dir <span class="token punctuation">\</span>--with-xmlrpc <span class="token punctuation">\</span>--with-openssl <span class="token punctuation">\</span>--with-mcrypt <span class="token punctuation">\</span>--with-mhash <span class="token punctuation">\</span>--with-pcre-regex <span class="token punctuation">\</span>--with-sqlite3 <span class="token punctuation">\</span>--with-zlib <span class="token punctuation">\</span>--enable-bcmath <span class="token punctuation">\</span>--with-iconv <span class="token punctuation">\</span>--with-bz2 <span class="token punctuation">\</span>--enable-calendar <span class="token punctuation">\</span>--with-curl <span class="token punctuation">\</span>--with-cdb <span class="token punctuation">\</span>--enable-dom <span class="token punctuation">\</span>--enable-exif <span class="token punctuation">\</span>--enable-fileinfo <span class="token punctuation">\</span>--enable-filter <span class="token punctuation">\</span>--with-pcre-dir <span class="token punctuation">\</span>--enable-ftp <span class="token punctuation">\</span>--with-gd <span class="token punctuation">\</span>--with-openssl-dir <span class="token punctuation">\</span>--with-jpeg-dir <span class="token punctuation">\</span>--with-png-dir <span class="token punctuation">\</span>--with-zlib-dir  <span class="token punctuation">\</span>--with-freetype-dir <span class="token punctuation">\</span>--enable-gd-native-ttf <span class="token punctuation">\</span>--enable-gd-jis-conv <span class="token punctuation">\</span>--with-gettext <span class="token punctuation">\</span>--with-gmp <span class="token punctuation">\</span>--with-mhash <span class="token punctuation">\</span>--enable-json <span class="token punctuation">\</span>--enable-mbstring <span class="token punctuation">\</span>--enable-mbregex <span class="token punctuation">\</span>--enable-mbregex-backtrack <span class="token punctuation">\</span>--with-libmbfl <span class="token punctuation">\</span>--with-onig <span class="token punctuation">\</span>--enable-pdo <span class="token punctuation">\</span>--with-mysqli<span class="token operator">=</span>mysqlnd <span class="token punctuation">\</span>--with-pdo-mysql<span class="token operator">=</span>mysqlnd <span class="token punctuation">\</span>--with-zlib-dir <span class="token punctuation">\</span>--with-pdo-sqlite <span class="token punctuation">\</span>--with-readline <span class="token punctuation">\</span>--enable-session <span class="token punctuation">\</span>--enable-shmop <span class="token punctuation">\</span>--enable-simplexml <span class="token punctuation">\</span>--enable-sockets  <span class="token punctuation">\</span>--enable-sysvmsg <span class="token punctuation">\</span>--enable-sysvsem <span class="token punctuation">\</span>--enable-sysvshm <span class="token punctuation">\</span>--enable-wddx <span class="token punctuation">\</span>--with-libxml-dir <span class="token punctuation">\</span>--with-xsl <span class="token punctuation">\</span>--enable-zip <span class="token punctuation">\</span>--enable-mysqlnd-compression-support <span class="token punctuation">\</span>--with-pear <span class="token punctuation">\</span>--enable-opcache<span class="token comment"># 08ã€ç¼–è¯‘ä¸å®‰è£… ï¼ˆæ­¤å¤„éœ€è¦æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…ï¼‰</span><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3-2. åˆ°è¿™é‡Œå·²ç»ç®—æ˜¯å®‰è£…å®Œæˆäº†ï¼ŒæŸ¥çœ‹ php ç‰ˆæœ¬ï¼Œå°±ä¼šå‡ºç°ç†Ÿæ‚‰çš„php 7.2.0 xxxxxx</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ php ç‰ˆæœ¬</span>/usr/local/php/bin/php <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3-3. ä½†æ˜¯è¿™æ ·,æˆ‘ä»¬æ²¡æœ‰æ·»åŠ ç¯å¢ƒå˜é‡,å¤ªéº»çƒ¦äº†,æ¥ä¸‹æ¥æŠŠ php æ”¾åˆ°ç¯å¢ƒå˜é‡é‡Œé¢</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 01ã€æ‰“å¼€æ–‡ä»¶</span><span class="token function">vim</span> /etc/profile<span class="token comment"># 02ã€åœ¨ profile æ–‡ä»¶æœ€åº•éƒ¨åŠ å…¥</span><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/php/bin<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span><span class="token comment"># 03ã€è®©ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ</span><span class="token builtin class-name">source</span> /etc/profile  æˆ–è€…  ./etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3-3. æ­¤æ—¶æˆ‘ä»¬æŸ¥çœ‹ PHP ç‰ˆæœ¬ php -v å°±è¡Œäº†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†php.iniå¤åˆ¶åˆ°/etc/ä¸‹é¢</span><span class="token function">cp</span> php.ini-production /etc/php.ini<span class="token function">cp</span> /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf<span class="token function">cp</span> /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf<span class="token function">cp</span> sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm<span class="token function">chmod</span> +x /etc/init.d/php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3-4. å¯åŠ¨ php-fpm</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/etc/init.d/php-fpm start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="4-é…ç½®-nginx-ï¼Œä½¿å¾—-nginx-èƒ½å¤Ÿè§£æ-php"><a href="#4-é…ç½®-nginx-ï¼Œä½¿å¾—-nginx-èƒ½å¤Ÿè§£æ-php" class="headerlink" title="4. é…ç½® nginx ï¼Œä½¿å¾— nginx èƒ½å¤Ÿè§£æ php"></a>4. é…ç½® nginx ï¼Œä½¿å¾— nginx èƒ½å¤Ÿè§£æ php</h2><p>4-1. æ‰“å¼€ nginx é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/nginx/conf.d/default.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é»˜è®¤é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"> <span class="token directive"><span class="token keyword">1</span> server</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">2</span>     listen       <span class="token number">80</span></span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">3</span>     server_name  localhost</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">4</span>  <span class="token number">5</span>     <span class="token comment">#charset koi8-r;</span> <span class="token number">6</span>     <span class="token comment">#access_log  /var/log/nginx/host.access.log  main;</span> <span class="token number">7</span>  <span class="token number">8</span>     location /</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">9</span>         root   /usr/share/nginx/html</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">10</span>         index  index.html index.htm</span><span class="token punctuation">;</span>11     <span class="token punctuation">}</span><span class="token directive"><span class="token keyword">12</span> <span class="token number">13</span>     <span class="token comment">#error_page  404              /404.html;</span><span class="token number">14</span> <span class="token number">15</span>     <span class="token comment"># redirect server error pages to the static page /50x.html</span><span class="token number">16</span>     <span class="token comment">#</span><span class="token number">17</span>     error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">18</span>     location = /50x.html</span> <span class="token punctuation">{</span><span class="token directive"><span class="token keyword">19</span>         root   /usr/share/nginx/html</span><span class="token punctuation">;</span>20     <span class="token punctuation">}</span>21 22     <span class="token comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>23     <span class="token comment">#</span>24     <span class="token comment">#location ~ \.php$ {</span>25     <span class="token comment">#    proxy_pass   http://127.0.0.1;</span>26     <span class="token comment">#}</span>27 28     <span class="token comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>29     <span class="token comment">#</span>30     <span class="token comment">#location ~ \.php$ {</span>31     <span class="token comment">#    root           html;</span>32     <span class="token comment">#    fastcgi_pass   127.0.0.1:9000;</span>33     <span class="token comment">#    fastcgi_index  index.php;</span>34     <span class="token comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>35     <span class="token comment">#    include        fastcgi_params;</span>36     <span class="token comment">#}</span>37 38     <span class="token comment"># deny access to .htaccess files, if Apache's document root</span>39     <span class="token comment"># concurs with nginx's one</span>40     <span class="token comment">#</span>41     <span class="token comment">#location ~ /\.ht {</span>42     <span class="token comment">#    deny  all;</span>43     <span class="token comment">#}</span>44 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4-2. å¤åˆ¶ nginx é»˜è®¤é…ç½®æ–‡ä»¶ default.conf ï¼Œå†™è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ <code>www.drling.xin.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/www.drling.xin.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4-3. å°†ä»¥ä¸‹å†…å®¹å†™è¿› <code>www.drling.xin.conf</code> é…ç½®æ–‡ä»¶ä¸­å»</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>  www.drling.xin</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>           /usr/share/nginx/html</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_pass</span>   127.0.0.1:9000</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_index</span>  index.php</span><span class="token punctuation">;</span>        <span class="token comment">#fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>        <span class="token directive"><span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">include</span>        fastcgi_params</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4-4. æŸ¥çœ‹ nginx é…ç½®å†™å…¥æ˜¯å¦æ­£ç¡®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nginx <span class="token parameter variable">-t</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4-5. é‡å¯ nginx</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4-6. åœ¨ <code>/usr/share/nginx/html</code> ä¸‹é¢æ–°å»ºä¸€ä¸ª index.php æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>4-7. åœ¨æµè§ˆå™¨ä¸­è®¿é—®é…ç½®æ–‡ä»¶ä¸­ server_name åå†™çš„åŸŸåï¼Œå°±å¯ä»¥çœ‹åˆ° phpinfo ä¿¡æ¯äº†ï¼Œæˆ‘è¿™é‡Œæ˜¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>www.drling.xin</code></p><p>4-8. åç»­</p><p>è¿™é‡Œæä¾› tp5 çš„ nginx é…ç½®æ–‡ä»¶å†™æ³•</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>  www.drling.xin</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span>    /var/log/nginx/www.drling.xin_access.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span>    /var/log/nginx/www.drling.xin_error.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>   /var/www/my_cake_test/public</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">if</span> (!-e <span class="token variable">$request_filename</span>)</span> <span class="token punctuation">{</span>                <span class="token directive"><span class="token keyword">rewrite</span> ^(.*)$ /index.php?s=<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">break</span></span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>           /var/www/my_cake_test/public</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_pass</span>   127.0.0.1:9000</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_index</span>  index.php</span><span class="token punctuation">;</span>        <span class="token comment">#fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>        <span class="token directive"><span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">include</span>        fastcgi_params</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸‹ä¸º laravel5.5 çš„ nginx é…ç½®æ–‡ä»¶å†™æ³•</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>  sample.drling.xin</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span>    /var/log/nginx/sample.drling.xin_access.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span>    /var/log/nginx/sample.drling.xin_error.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">root</span>   /var/www/sample/public</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php?<span class="token variable">$query_string</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>                       <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">root</span>           /var/www/sample/public</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_pass</span>   127.0.0.1:9000</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">fastcgi_index</span>  index.php</span><span class="token punctuation">;</span>        <span class="token comment">#fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>        <span class="token directive"><span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">include</span>        fastcgi_params</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CentOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> LNMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 æ­å»ºå®å¡”é¢æ¿å¹¶æ­å»º LNMP ç¯å¢ƒ</title>
      <link href="posts/199b0f07.html"/>
      <url>posts/199b0f07.html</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS-7-æ­å»ºå®å¡”é¢æ¿å¹¶æ­å»º-LNMP-ç¯å¢ƒ"><a href="#CentOS-7-æ­å»ºå®å¡”é¢æ¿å¹¶æ­å»º-LNMP-ç¯å¢ƒ" class="headerlink" title="CentOS 7 æ­å»ºå®å¡”é¢æ¿å¹¶æ­å»º LNMP ç¯å¢ƒ"></a>CentOS 7 æ­å»ºå®å¡”é¢æ¿å¹¶æ­å»º LNMP ç¯å¢ƒ</h1><h2 id="æœ¬åœ°ç¯å¢ƒä¸ºï¼š"><a href="#æœ¬åœ°ç¯å¢ƒä¸ºï¼š" class="headerlink" title="æœ¬åœ°ç¯å¢ƒä¸ºï¼š"></a>æœ¬åœ°ç¯å¢ƒä¸ºï¼š</h2><blockquote><p>Linux ç³»ç»Ÿç¯å¢ƒä¸ºï¼šCentOS Linux release 7.4.1708 (Core)</p></blockquote><h2 id="å¸¸è§-Web-é¢æ¿"><a href="#å¸¸è§-Web-é¢æ¿" class="headerlink" title="å¸¸è§ Web é¢æ¿"></a>å¸¸è§ Web é¢æ¿</h2><p>ç›®å‰å¸‚é¢ä¸Šæµè¡Œçš„é¢æ¿å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š</p><ul><li><a href="http://amh.sh/">AMH</a></li><li><a href="https://www.appnode.com/">AppNode</a></li><li><a href="https://www.bt.cn/">å®å¡”</a></li><li><a href="https://www.wdlinux.cn/wdcp/">WDCP</a></li></ul><h2 id="å®‰è£…å‰å‡†å¤‡"><a href="#å®‰è£…å‰å‡†å¤‡" class="headerlink" title="å®‰è£…å‰å‡†å¤‡"></a>å®‰è£…å‰å‡†å¤‡</h2><ul><li>æœåŠ¡å™¨æ”¾è¡Œ 8888 ç«¯å£</li><li>å†…å­˜ï¼š512M ä»¥ä¸Šï¼Œæ¨è 768M ä»¥ä¸Šï¼ˆçº¯é¢æ¿çº¦å ç³»ç»Ÿ 60M å†…å­˜ï¼‰</li><li>ç¡¬ç›˜ï¼š100M ä»¥ä¸Šå¯ç”¨ç¡¬ç›˜ç©ºé—´ï¼ˆçº¯é¢æ¿çº¦å  20M ç£ç›˜ç©ºé—´ï¼‰</li><li>ç³»ç»Ÿï¼šCentOS 7.1+ (Ubuntu16.04+.ã€Debian9.0+)ï¼Œç¡®ä¿æ˜¯å¹²å‡€çš„æ“ä½œç³»ç»Ÿï¼Œæ²¡æœ‰å®‰è£…è¿‡å…¶å®ƒç¯å¢ƒå¸¦çš„ Apache/Nginx/php/MySQLï¼ˆå·²æœ‰ç¯å¢ƒä¸å¯å®‰è£…ï¼‰</li></ul><h2 id="å®‰è£…ï¼š"><a href="#å®‰è£…ï¼š" class="headerlink" title="å®‰è£…ï¼š"></a>å®‰è£…ï¼š</h2><ul><li>Linux é¢æ¿ 6.9.2 å®‰è£…å‘½ä»¤ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">wget</span> <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> <span class="token parameter variable">-O</span> install.sh http://download.bt.cn/install/install_6.0.sh <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>Linux é¢æ¿ 6.9.2 å‡çº§å‘½ä»¤ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://download.bt.cn/install/update6.sh<span class="token operator">|</span><span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6323d664eb6f8b3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Do you want to <span class="token function">install</span> Bt-Panel to the /www directory now?<span class="token punctuation">(</span>y/n<span class="token punctuation">)</span>:<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„ä¸ºè¯¢é—®ä½ æ˜¯å¦ç°åœ¨å®‰è£…å®å¡”é¢æ¿åˆ° /www ç›®å½•ï¼Ÿè¯·è¾“å…¥ y ç»§ç»­ã€‚</p><p>éšåå¤§æ¦‚éœ€è¦ 2 åˆ†é’Ÿå·¦å³å®‰è£…ï¼Œä¼šæœ‰ä¸€å¤§å †è¾“å‡ºï¼Œæˆ‘ä»¬ä¸å¿…å…³æ³¨ã€‚</p><p>è‹¥å®‰è£…æˆåŠŸï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>Congratulations<span class="token operator">!</span> Installed successfully<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>Bt-Panel: <span class="token punctuation">[</span>ç®¡ç†é¢æ¿ URL<span class="token punctuation">]</span>username: <span class="token punctuation">[</span>å®å¡”é¢æ¿ç”¨æˆ·å<span class="token punctuation">]</span>password: <span class="token punctuation">[</span>å®å¡”é¢æ¿å¯†ç <span class="token punctuation">]</span>Warning:If you cannot access the panel,release the following port <span class="token punctuation">(</span><span class="token number">8888</span><span class="token operator">|</span><span class="token number">888</span><span class="token operator">|</span><span class="token number">80</span><span class="token operator">|</span><span class="token number">443</span><span class="token operator">|</span><span class="token number">20</span><span class="token operator">|</span><span class="token number">21</span><span class="token punctuation">)</span> <span class="token keyword">in</span> the security group<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯·åŠ¡å¿…è®°ä½å®å¡”é¢æ¿çš„ç”¨æˆ·åå’Œé¢æ¿å¯†ç ï¼åŒ…æ‹¬ç®¡ç†é¢æ¿ url ä¸­ 8888 ç«¯å£åçš„å®‰å…¨æ ¡éªŒç </strong></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-55813fdc1bae8e78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-975046119cade6ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¦‚æœæ²¡æœ‰æ ¡éªŒç ç›´æ¥å¸¦ 8888 ç«¯å£è®¿é—®åä¼šå‡ºç°å¦‚ä¸Šæç¤º"></p><p>è®¿é—®å®Œæ•´é¢æ¿ URL ä¹‹åï¼Œè¾“å…¥åˆšåˆšè®°å½•çš„è´¦å·å’Œå¯†ç ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°ç¯å¢ƒæ­å»ºé¢æ¿ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8944b65ff6942fe3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>æˆ‘é€‰æ‹©çš„ LNMP<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1c0393ac5d90113d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»¥ä¸Šæ˜¯æˆ‘è‡ªå·±çš„é…ç½®æƒ…å†µ"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3a9bb80ba533e012.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…è½¯ä»¶æ—¶ï¼Œå¯ä»¥çœ‹åˆ° CPU ä½¿ç”¨ç‡ä¼šé£™å‡ï¼Œè¿™ä¸ªæ˜¯å±äºæ­£å¸¸æƒ…å†µ"></p><p>ç­‰ä»»åŠ¡åœæ­¢åï¼ŒåŸºæœ¬ä¸Š LNMP ç¯å¢ƒå°±å·²ç»æ­å»ºå¥½äº†ï¼Œå¯èƒ½ä¼šèŠ±æ•°åˆ†é’Ÿã€‚</p><h2 id="æ„Ÿè°¢ï¼š"><a href="#æ„Ÿè°¢ï¼š" class="headerlink" title="æ„Ÿè°¢ï¼š"></a>æ„Ÿè°¢ï¼š</h2><blockquote><p><a href="https://learnku.com/articles/24917">æ¥æºäº laravel ç¤¾åŒºã€Šè½»æ¾éƒ¨ç½²å®å¡”é¢æ¿ã€‹ä¸€æ–‡</a><br><a href="https://www.bt.cn/bbs/thread-19376-1-1.html">æ¥æºäºå®å¡”ç¤¾åŒºã€Šå®å¡” Linux é¢æ¿å®‰è£…æ•™ç¨‹ - 4æœˆ28æ—¥æ›´æ–° - 6.9.2æ­£å¼ç‰ˆã€‹</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CentOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰“é€ ä¸ªæ€§åŒ–çš„ GitHub ä¸»é¡µï¼Œè®©åˆ«äººçœ‹äº†çœ¼å‰ä¸€äº®ï¼</title>
      <link href="posts/bd18a856.html"/>
      <url>posts/bd18a856.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ‰“é€ ä¸ªæ€§åŒ–çš„-GitHub-ä¸»é¡µï¼Œè®©åˆ«äººçœ‹äº†çœ¼å‰ä¸€äº®ï¼"><a href="#æ‰“é€ ä¸ªæ€§åŒ–çš„-GitHub-ä¸»é¡µï¼Œè®©åˆ«äººçœ‹äº†çœ¼å‰ä¸€äº®ï¼" class="headerlink" title="æ‰“é€ ä¸ªæ€§åŒ–çš„ GitHub ä¸»é¡µï¼Œè®©åˆ«äººçœ‹äº†çœ¼å‰ä¸€äº®ï¼"></a>æ‰“é€ ä¸ªæ€§åŒ–çš„ GitHub ä¸»é¡µï¼Œè®©åˆ«äººçœ‹äº†çœ¼å‰ä¸€äº®ï¼</h1><blockquote><p>é¦–å…ˆå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„ <a href="https://github.com/pudongping">GitHub é¦–é¡µ</a></p></blockquote><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e33225263f52d150.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µ1"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e938fade8ae7a1c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µ2"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3570ccfce03fb0cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µ3"></p><h2 id="å¦‚ä½•æ„å»ºå±äºè‡ªå·±ä¸ªæ€§åŒ–çš„-GitHub-é¦–é¡µï¼Ÿ"><a href="#å¦‚ä½•æ„å»ºå±äºè‡ªå·±ä¸ªæ€§åŒ–çš„-GitHub-é¦–é¡µï¼Ÿ" class="headerlink" title="å¦‚ä½•æ„å»ºå±äºè‡ªå·±ä¸ªæ€§åŒ–çš„ GitHub é¦–é¡µï¼Ÿ"></a>å¦‚ä½•æ„å»ºå±äºè‡ªå·±ä¸ªæ€§åŒ–çš„ GitHub é¦–é¡µï¼Ÿ</h2><ul><li>å…ˆåˆ›å»ºä¸€ä¸ªå’Œè‡ªå·± GitHub åŒç”¨æˆ·åçš„ä»“åº“ï¼Œæ¯”å¦‚æˆ‘çš„ GitHub è´¦å·ä¸º <code>pudongping</code> ï¼Œæˆ‘çš„ GitHub åœ°å€ä¸ºï¼š<code>https://github/pudongping</code> é‚£ä¹ˆæˆ‘å°±éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º <code>pudongping</code> çš„ä»“åº“ï¼Œå¦‚æœä½ å¡«å†™çš„æ˜¯æ­£ç¡®çš„ï¼Œä¼šå‡ºç°ç»¿è‰²çš„æç¤ºæ¡†ï¼Œæç¤ºä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª GitHub profileï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9b4928a3dc53bbd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å½“ä»“åº“åç§°å’Œè‡ªå·±çš„ GitHub åŒåæ—¶ï¼Œä¼šæç¤ºè¿™æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„ä»“åº“"></p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»“åº“çš„è®¿é—®æƒé™ä¸€å®šè¦è®¾ç½®ä¸º <code>public</code> ï¼Œåˆ›å»ºä»“åº“çš„æ—¶å€™ï¼Œä½ å¯ä»¥å‹¾é€‰ä¸€ä¸‹ <code>Add a README file</code> ä¹Ÿå¯ä»¥ä¸å‹¾é€‰ï¼Œç„¶åè‡ªå·±é‡æ–°åˆ›å»ºä¸€ä¸ª <code>README.md</code> æ–‡ä»¶ï¼Œå¦‚æœæ˜¯å‹¾é€‰äº†çš„è¯ï¼Œåˆ™é»˜è®¤çš„ <code>README.md</code> æ–‡ä»¶ä¸­ä¼šæœ‰å¦‚ä¸‹ä»£ç ï¼š</p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">### Hi there ğŸ‘‹ <span class="token comment">&lt;!--**pudongping/pudongping** is a âœ¨ _special_ âœ¨ repository because its `README.md` (this file) appears on your GitHub profile.Here are some ideas to get you started:- ğŸ”­ Iâ€™m currently working on ...- ğŸŒ± Iâ€™m currently learning ...- ğŸ‘¯ Iâ€™m looking to collaborate on ...- ğŸ¤” Iâ€™m looking for help with ...- ğŸ’¬ Ask me about ...- ğŸ“« How to reach me: ...- ğŸ˜„ Pronouns: ...- âš¡ Fun fact: ...--&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-91e84d1a05fa4228.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»“åº“åç§°éœ€è¦è®¾ç½®æˆå’Œè‡ªå·± GitHub è´¦å·åŒå"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-eb2d92510ffa6cb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¿é—®å’Œè‡ªå·± GitHub è´¦å·åŒåçš„ä»“åº“æ—¶å†…å®¹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e93baf911b63ba8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é»˜è®¤çš„ GitHub profile README.md æ–‡ä»¶"></p><p>è¿™æ—¶å€™ä½ å¯ä»¥è®¿é—®ä¸€ä¸‹ä½ è‡ªå·±çš„ GitHub é¦–é¡µï¼Œå°±å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ä¸ªæ€§åŒ– <code>GitHub profile</code> äº†ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å• âœŒï¸</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8da90386857abfe2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹è‡ªå·±çš„ GitHub profile"></p><h2 id="æ¥ä¸‹æ¥è¯´ä¸€è¯´ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œæ‰“é€ æ›´åŠ -ç‚«é…·-çš„-GitHub-profile"><a href="#æ¥ä¸‹æ¥è¯´ä¸€è¯´ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œæ‰“é€ æ›´åŠ -ç‚«é…·-çš„-GitHub-profile" class="headerlink" title="æ¥ä¸‹æ¥è¯´ä¸€è¯´ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œæ‰“é€ æ›´åŠ  ç‚«é…· çš„ GitHub profile"></a>æ¥ä¸‹æ¥è¯´ä¸€è¯´ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œæ‰“é€ æ›´åŠ  <code>ç‚«é…·</code> çš„ GitHub profile</h2><h3 id="æ¯å‘¨ä»£ç ç»Ÿè®¡"><a href="#æ¯å‘¨ä»£ç ç»Ÿè®¡" class="headerlink" title="æ¯å‘¨ä»£ç ç»Ÿè®¡"></a>æ¯å‘¨ä»£ç ç»Ÿè®¡</h3><p>å¦‚æœä½ éœ€è¦ç»Ÿè®¡ä½ æ¯å‘¨çš„ä»£ç çš„è¯ï¼Œä½ å¯ä»¥å…ˆå» <a href="https://wakatime.com/">WakaTime</a> ç½‘ç«™ï¼Œä½¿ç”¨ GitHub æˆæƒç™»å½•ä¸€ä¸‹ï¼Œè·å– <code>wakatime</code> çš„å¯†é’¥ï¼Œç„¶åè®¿é—® <a href="https://github.com/athul/waka-readme">waka-readme</a>  æ’ä»¶é¡µé¢ï¼Œæ ¹æ®è¯´æ˜æ–‡æ¡£è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><blockquote><p>ä»£ç ç»Ÿè®¡éœ€è¦è¿è¡Œ <code>GitHub Action</code> ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ <code>GitHub Action</code> ï¼Œé‚£ä¹ˆä½ å¯ä»¥å‚è€ƒä¸€ä¸‹é˜®ä¸€å³°çš„ <a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">GitHub Actions å…¥é—¨æ•™ç¨‹</a> ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°ä¸Šé¢è·å–çš„ <code>wakatime</code> çš„å¯†é’¥ã€‚</p></blockquote><p>å±•ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">Week: 19 June, 2021 - 25 June, 2021Markdown   1 hr 38 mins    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–‘â–‘â–‘â–‘â–‘   79.03 % CSS        17 mins         â–ˆâ–ˆâ–ˆâ–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   14.17 % YAML       7 mins          â–ˆâ–’â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   05.74 % <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸‹ä»¥æˆªå›¾çš„å½¢å¼å±•ç¤ºå¦‚ä½•ä½¿ç”¨ï¼š<a href="https://wakatime.com/">WakaTime</a></p><p>å…ˆå» wakatime ä¸­ä½¿ç”¨ github æ³¨å†Œä¸€ä¸ªè´¦å·</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-992eeba288611344.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ³¨å†Œè´¦å·"></p><p>ç›´æ¥ä½¿ç”¨ GitHub æˆæƒç™»å½•</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-edc612cf27e4b612.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç›´æ¥ä½¿ç”¨ GitHub æˆæƒç™»å½•"></p><p>è®¿é—® <a href="https://wakatime.com/settings/account">https://wakatime.com/settings/account</a> è·å– wakatime çš„å¯†é’¥</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9b34e7147d31b4ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è·å– wakatime çš„å¯†é’¥"></p><p>åœ¨ GitHub ä¸­è®¾ç½®åˆšåˆšè·å–åˆ°çš„ wakatime secretï¼Œæ³¨æ„å¯†é’¥çš„åç§°è®¾ç½®ä¸º WAKATIME_API_KEY</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1995498683c19ab5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®å¯†é’¥"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0659cec75b88f8c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®æˆåŠŸå¦‚ä¸‹æ‰€ç¤º"></p><p>ç„¶ååœ¨è‡ªå·±çš„ä»“åº“ä¸‹é¢åˆ›å»º <code>.github/workflows/waka-time.yml</code> æ–‡ä»¶ï¼Œå¡«å…¥å¯¹åº”çš„é…ç½®ä¿¡æ¯ï¼Œè¿™äº›é…ç½®å¯ä»¥åœ¨ <a href="https://github.com/athul/waka-readme">waka-time</a> ä»“åº“ä¸­æ‰¾åˆ°ç¤ºä¾‹ã€‚</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e1a749790225578a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¡«å…¥é…ç½®ä¿¡æ¯"></p><p>æ­¤æ—¶ï¼Œä¿®æ”¹å¥½é…ç½®ä¿¡æ¯åï¼Œæˆ‘ä»¬å°†ä»£ç æ¨é€åˆ° GitHubï¼Œç„¶åç‚¹å‡» <code>Action</code> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å·¥ä½œæµï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ° <code>Waka Readme </code> è¿™ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹ä¸€ä¸‹ <code>Run workflow</code> æŒ‰é’®æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-84d0a1130196df10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹ä¸€ä¸‹ GitHub Action"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7b11660f35badf18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰ä¸­æŒ‡å®šçš„å·¥ä½œæµç¨‹"></p><p>æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ—¥å¿—è®°å½•</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-762a711dcb3abda1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯ä»¥æŸ¥çœ‹åˆ°æ‰§è¡Œæ—¥å¿—è®°å½•"></p><p>æ­¤æ—¶æˆ‘ä»¬å†å›åˆ°è‡ªå·±çš„ GitHub é¦–é¡µï¼ŒæŸ¥çœ‹ä»£ç ç»Ÿè®¡ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°çº¢è‰²æ¡†ä¸­çš„å†…å®¹ï¼ˆæ­¤æ—¶è¿˜æ²¡æœ‰ç»Ÿè®¡ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„ä»£ç ç¼–è¾‘å™¨ä¸‹è½½å¯¹åº”çš„ <code>wakatime</code> æ’ä»¶ï¼Œä¸çŸ¥é“å¦‚ä½•ä¸‹è½½æ’ä»¶çš„è¯ï¼Œå¯ä»¥<a href="https://wakatime.com/plugins">ç‚¹å‡»è¿™é‡Œ</a>ï¼‰</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6a20665d519221fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹ç»“æœ"></p><p><a href="https://wakatime.com/">WakaTime</a> æ˜¯ä¸€æ¬¾å¾ˆæœ‰ç”¨çš„ä»£ç ç»Ÿè®¡å·¥å…·ï¼Œå®ƒä¸ä»…ä»…å¯ä»¥ç»Ÿè®¡ä»£ç ç¼–è¾‘å™¨ä¸Šé¢çš„æ´»åŠ¨çŠ¶æ€ï¼Œè¿˜å¯ä»¥ç»Ÿè®¡å…¶ä»–çš„è½¯ä»¶ä¸Šé¢çš„æ´»åŠ¨ï¼Œæ¯”å¦‚ <code>WPS Office</code> ã€<code>Chrome</code> ç­‰ç­‰ï¼Œæˆ‘è¿™é‡Œå°±ç»Ÿè®¡äº† <code>WebStorm</code> å’Œ <code>PhpStorm</code> ç­‰å‡ ä¸ªç¼–è¾‘å™¨</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bd50fe828ce3c2bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ´»åŠ¨ç»Ÿè®¡"></p><h3 id="å…¶ä»–å¥½ç©ä¸”æœ‰ç”¨çš„ä¸ªæ€§åŒ–å®šåˆ¶"><a href="#å…¶ä»–å¥½ç©ä¸”æœ‰ç”¨çš„ä¸ªæ€§åŒ–å®šåˆ¶" class="headerlink" title="å…¶ä»–å¥½ç©ä¸”æœ‰ç”¨çš„ä¸ªæ€§åŒ–å®šåˆ¶"></a>å…¶ä»–å¥½ç©ä¸”æœ‰ç”¨çš„ä¸ªæ€§åŒ–å®šåˆ¶</h3><ul><li><a href="https://github.com/anuraghazra/github-readme-stats">å±•ç¤º GitHub Stats</a></li><li><a href="https://github.com/ashutosh00710/github-readme-activity-graph">å±•ç¤ºæœ€è¿‘ä¸€ä¸ªæœˆçš„è´¡çŒ®ç»Ÿè®¡æ•°æ®</a></li><li><a href="https://shields.io/">å¾½ç« åˆ¶ä½œå·¥å…·</a></li><li><a href="https://www.dute.org/weird-fonts">æ€ªå¼‚è‹±æ–‡ç”Ÿæˆå™¨</a> - ç”Ÿæˆæ¯”è¾ƒå¥½çœ‹çš„è‹±æ–‡å­—ä½“ï¼Œæ”¯æŒå¤åˆ¶ç²˜è´´</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>å¦‚æœä½ å–œæ¬¢æˆ‘çš„ <a href="https://github.com/pudongping/pudongping">GitHub profile</a> ä½ å¯ä»¥å…‹éš†ä»£ç ä¹‹åï¼Œè‡ªå·±è‡ªå®šä¹‰ä¿®æ”¹ã€‚</li><li>åˆ¶ä½œä¸æ˜“ï¼Œå¾ˆå¤šå†…å®¹éƒ½æ˜¯æˆ‘ä¸€æ­¥ä¸€æ­¥é€šè¿‡æœç´¢å¼•æ“è·å–åˆ°çš„ï¼Œæ¯”å¦‚è¯´å¾½ç« çš„èƒŒæ™¯è‰²ï¼Œæˆ‘éƒ½æ˜¯æ‰“å¼€å„å¤§å®˜ç½‘å¸å–çš„èƒŒæ™¯è‰²ã€‚å¦‚æœä½ å–œæ¬¢çš„è¯ï¼Œéº»çƒ¦ç»™ä¸ª Star å“‡ï¼</li></ul>]]></content>
      
      
      <categories>
          
          <category> å¼€æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>samba å®ç° windows å’Œ centos7 æ–‡ä»¶å…±äº«</title>
      <link href="posts/7c9f7082.html"/>
      <url>posts/7c9f7082.html</url>
      
        <content type="html"><![CDATA[<h1 id="samba-å®ç°-windows-å’Œ-centos7-æ–‡ä»¶å…±äº«"><a href="#samba-å®ç°-windows-å’Œ-centos7-æ–‡ä»¶å…±äº«" class="headerlink" title="samba å®ç° windows å’Œ centos7 æ–‡ä»¶å…±äº«"></a>samba å®ç° windows å’Œ centos7 æ–‡ä»¶å…±äº«</h1><ul><li>å®‰è£… samba</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> samba<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-edbeb855b86ab130.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£… samba æœåŠ¡"></p><ul><li>æŸ¥çœ‹ samba ä¸»é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹ä¸»é…ç½®æ–‡ä»¶æ„Ÿè§‰å†…å®¹å¤ªå¤šæ—¶ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿‡æ»¤æ‰æ³¨é‡Šä¿¡æ¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…ˆå°†ä¸»é…ç½®æ–‡ä»¶åšä¸€ä¸ªå¤‡ä»½</span><span class="token function">mv</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak<span class="token comment"># è¿‡æ»¤æ‰ä»¥äº•å· ã€Œ#ã€ã€åˆ†å· ã€Œ;ã€ ã€ç©ºè¡Œï¼Œå¹¶è¦†ç›–ä¸»é…ç½®æ–‡ä»¶</span><span class="token function">cat</span> /etc/samba/smb.conf.bak <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"#"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">";"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^$"</span> <span class="token operator">&gt;</span> /etc/samba/smb.conf<span class="token comment"># å†æ¬¡æŸ¥çœ‹ä¸»é…ç½®æ–‡ä»¶</span><span class="token function">cat</span> /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-eb2ca8538712d808.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹ samba ä¸»é…ç½®æ–‡ä»¶"></p><ul><li>é…ç½®å…±äº«èµ„æº</li></ul><ol><li>åˆ›å»ºç”¨äºè®¿é—®å…±äº«èµ„æºçš„è´¦æˆ·ä¿¡æ¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…ˆåˆ›å»ºä¸€ä¸ªç³»ç»Ÿç”¨æˆ· ï¼ˆç”¨æˆ·åå¯ä»¥éšæ„å†™ï¼Œåªè¦è‡ªå·±è®°å¾—å°±å¥½ï¼Œè¿™é‡Œä¸º sambauserï¼‰</span><span class="token comment"># SambaæœåŠ¡ç¨‹åºçš„æ•°æ®åº“è¦æ±‚è´¦æˆ·å¿…é¡»åœ¨å½“å‰ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨ï¼Œå¦åˆ™æ—¥ååˆ›å»ºæ–‡ä»¶æ—¶å°†å¯¼è‡´æ–‡ä»¶çš„æƒé™å±æ€§æ··ä¹±ä¸å ªï¼Œç”±æ­¤å¼•å‘é”™è¯¯ã€‚</span><span class="token function">useradd</span> sambauser<span class="token comment"># åˆ›å»º samba æœåŠ¡ç¨‹åºçš„ç”¨æˆ· ï¼ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œè¿™é‡Œçš„å¯†ç ç”¨äºåˆ›å»ºå…±äº«æ—¶éªŒè¯ï¼Œå› æ­¤éœ€è¦ç‰¢è®°ï¼‰</span>pdbedit <span class="token parameter variable">-a</span> <span class="token parameter variable">-u</span> sambauser<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c69f38676209f8fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ›å»ºç”¨äºå…±äº«èµ„æºçš„è´¦æˆ·ä¿¡æ¯"></p><ol start="2"><li>åˆ›å»ºç”¨äºå…±äº«èµ„æºçš„æ–‡ä»¶ç›®å½•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºå…±äº«èµ„æºçš„æ–‡ä»¶ç›®å½•ï¼Œè¿™é‡Œåˆ›å»ºçš„æ–‡ä»¶åä¸º smb-shareï¼Œæ–‡ä»¶åå¯ä»¥è‡ªç”±åˆ›å»º</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/smb-share<span class="token comment"># è®¾ç½®æ–‡ä»¶å¤¹æƒé™</span><span class="token function">chown</span> <span class="token parameter variable">-Rf</span> sambauser:sambauser /mnt/smb-share<span class="token comment"># è®¾ç½®è¯¥ç›®å½•çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡</span>semanage fcontext <span class="token parameter variable">-a</span> <span class="token parameter variable">-t</span> samba_share_t /mnt/smb-share<span class="token comment"># æ‰§è¡Œ restorecon å‘½ä»¤ï¼Œè®©åº”ç”¨äºç›®å½•çš„æ–° SELinux å®‰å…¨ä¸Šä¸‹æ–‡ç«‹å³ç”Ÿæ•ˆã€‚</span>restorecon <span class="token parameter variable">-Rv</span> /mnt/smb-share<span class="token comment"># è®¾ç½® SELinux æœåŠ¡ä¸ç­–ç•¥</span><span class="token comment"># å…ˆç­›é€‰å‡ºæ‰€æœ‰ä¸SambaæœåŠ¡ç¨‹åºç›¸å…³çš„SELinuxåŸŸç­–ç•¥</span>getsebool <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">grep</span> samba<span class="token comment"># æ ¹æ®ç­–ç•¥çš„åç§°ï¼ˆå’Œç»éªŒï¼‰é€‰æ‹©å‡ºæ­£ç¡®çš„ç­–ç•¥æ¡ç›®è¿›è¡Œå¼€å¯å³å¯ï¼š</span><span class="token comment"># egï¼šå¦‚æœä½ çš„å…±äº«ç›®å½•åœ¨å®¶ç›®å½• /home ä¸‹ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼€å¯</span>setsebool <span class="token parameter variable">-P</span> samba_enable_home_dirs on<span class="token comment"># è¿™é‡Œæˆ‘ä½¿ç”¨çš„å…±äº«ç›®å½•åœ¨ /mnt ç›®å½•ä¸‹ï¼Œå› æ­¤æš‚æ—¶ä¸éœ€è¦è®¾ç½®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fa8568d3e863ecbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ›å»ºç”¨äºå…±äº«èµ„æºçš„æ–‡ä»¶ç›®å½•"></p><ol start="3"><li>åœ¨ Samba æœåŠ¡ç¨‹åºçš„ä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œå†™å…±äº«é…ç½®ä¿¡æ¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†™å…¥ä»¥ä¸‹å†…å®¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…±äº«åç§°ä¸º smb-share</span><span class="token punctuation">[</span>smb-share<span class="token punctuation">]</span><span class="token comment"># å…±äº«ä¿¡æ¯</span>comment <span class="token operator">=</span> smb-share<span class="token comment"># å…±äº«ç›®å½•ä¸º /mnt/smb-share</span>path <span class="token operator">=</span> /mnt/smb-share<span class="token comment"># å…³é—­â€œæ‰€æœ‰äººå¯è§â€</span>public <span class="token operator">=</span> no<span class="token comment"># å…è®¸å†™å…¥æ“ä½œ</span>writable <span class="token operator">=</span> <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a6be19d4ad79f97c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å†™å…±äº«é…ç½®ä¿¡æ¯"></p><ol start="4"><li>é‡å¯ samba æœåŠ¡</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é‡å¯ samba æœåŠ¡</span>systemctl restart smb<span class="token comment"># å°† samba æœåŠ¡åŠ å…¥åˆ°å¼€å¯å¯åŠ¨é¡¹ä¸­</span>systemctl <span class="token builtin class-name">enable</span> smb<span class="token comment"># æ¸…ç©º iptables é˜²ç«å¢™</span>iptables <span class="token parameter variable">-F</span><span class="token comment"># ä¿å­˜ iptables é˜²ç«å¢™è®¾ç½®ä¿¡æ¯</span><span class="token function">service</span> iptables save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼Œsamba æœåŠ¡å™¨å·²ç»é…ç½®å®Œæ¯•</p><ul><li>Windows æŒ‚è½½å…±äº«</li></ul><ol><li>æ‰“å¼€ <code>è¿è¡Œ</code>ï¼Œå¹¶è¾“å…¥ samba æœåŠ¡å™¨çš„ ip åœ°å€</li></ol><pre class="line-numbers language-none"><code class="language-none"># è¿™é‡Œæˆ‘çš„è™šæ‹Ÿæœºçš„ ip åœ°å€ä¸º 192.168.127.3ï¼Œè¯·æ¢æˆä½ è‡ªå·±çš„ samba æœåŠ¡å™¨çš„ ip åœ°å€\\192.168.127.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-dd44e0b89a8bf325.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰“å¼€è¿è¡Œï¼Œå¹¶è®¿é—® samba æœåŠ¡å™¨ ip"></p><ol start="2"><li><p>è¾“å…¥å®Œæ¯•ä¹‹åï¼Œç›´æ¥ç‚¹å‡» <code>ç¡®å®š</code>ï¼Œå°±ä¼šè·³å‡ºéœ€è¦ä½ è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œè¿™é‡Œçš„è´¦å·éœ€è¦å¡«å†™ä½  samba æœåŠ¡ç¨‹åºçš„è´¦å·å’Œå¯†ç ï¼Œæˆ‘è¿™é‡Œå·²ç»åˆšåˆšè¾“å…¥ä¸€æ¬¡äº†ï¼Œå› æ­¤ç¬¬äºŒæ¬¡æ‰“å¼€çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰æç¤ºè¦æˆ‘è¾“å…¥è´¦å·å’Œå¯†ç ã€‚æˆ‘è¿™é‡Œåº”è¯¥è¾“å…¥çš„è´¦å·ä¸ºï¼šsambauser</p></li><li><p>æµ‹è¯•</p></li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-42493846e7cac55b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è´¦å·å’Œå¯†ç é€šè¿‡ä¹‹åå³å¯çœ‹åˆ° centos ä¸Šé¢çš„å…±äº«æ–‡ä»¶å¤¹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e38dea0acf233162.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="windows ä¸­éšä¾¿å†™å…¥ä¸€ä¸ªæ–‡ä»¶"></p><p>è¿›å…¥ <code>/mnt/smb-share</code> ç›®å½•æŸ¥çœ‹æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">more</span> /mnt/smb-share/fad.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e5f789ab12d4f1a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="centos æŸ¥çœ‹æ–‡ä»¶"></p><p>è¿˜å¯ä»¥å°†å…±äº«æ–‡ä»¶å¤¹æ˜ å°„ä¸ºç½‘ç»œé©±åŠ¨å™¨ï¼Œè¿™æ ·ä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥åœ¨ <code>æˆ‘çš„ç”µè„‘</code> ä¸­æ‰“å¼€äº†ã€‚<br>æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨çš„æ–¹æ³•ä¸ºï¼Œç›´æ¥å¯¹ç€å…±äº«æ–‡ä»¶å¤¹ï¼Œå³é”® =&gt; æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ =&gt; ç›´æ¥ç¡®å®š å³å¯</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b88434639aae9732.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ˜ å°„ç½‘ç»œé©±åŠ¨"></p>]]></content>
      
      
      <categories>
          
          <category> CentOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Samba </tag>
            
            <tag> æ–‡ä»¶å…±äº« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS é…ç½® yum ä»“åº“</title>
      <link href="posts/139571b4.html"/>
      <url>posts/139571b4.html</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS-é…ç½®-yum-ä»“åº“"><a href="#CentOS-é…ç½®-yum-ä»“åº“" class="headerlink" title="CentOS é…ç½® yum ä»“åº“"></a>CentOS é…ç½® yum ä»“åº“</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/yum.repos.d/redhat.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¡«å†™ä»¥ä¸‹å†…å®¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>redhat<span class="token punctuation">]</span><span class="token assign-left variable">name</span><span class="token operator">=</span>redhatyum<span class="token assign-left variable">baseurl</span><span class="token operator">=</span> yumä»“åº“åœ°å€<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ç›´æ¥æ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum-config-manager --add-repo<span class="token operator">=</span><span class="token string">"yumä»“åº“åœ°å€"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é˜¿é‡Œæº</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®é˜¿é‡Œæºåœ°å€ï¼Œä¸‹è½½ Centos-7.repo æ–‡ä»¶ï¼Œç„¶åæ”¾åˆ° /etc/yum.repos.d ç›®å½•ä¸­</span>http://mirrors.aliyun.com/repo/Centos-7.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é…ç½®å®Œä¹‹åéœ€è¦æ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¸…é™¤æ‰€æœ‰ç¼“å­˜</span>yum clean all<span class="token comment"># å»ºç«‹ç¼“å­˜</span>yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CentOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos 7 å¼€æ”¾åŠæŸ¥çœ‹ç«¯å£</title>
      <link href="posts/32500f0d.html"/>
      <url>posts/32500f0d.html</url>
      
        <content type="html"><![CDATA[<h1 id="Centos-7-å¼€æ”¾åŠæŸ¥çœ‹ç«¯å£"><a href="#Centos-7-å¼€æ”¾åŠæŸ¥çœ‹ç«¯å£" class="headerlink" title="Centos 7 å¼€æ”¾åŠæŸ¥çœ‹ç«¯å£"></a>Centos 7 å¼€æ”¾åŠæŸ¥çœ‹ç«¯å£</h1><ul><li>å¼€æ”¾ 5200 tcp ç«¯å£</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">5200</span>/tcp <span class="token parameter variable">--permanent</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å…³é—­ 5200 tcp ç«¯å£</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --remove-port<span class="token operator">=</span><span class="token number">5200</span>/tcp <span class="token parameter variable">--permanent</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>é…ç½®ç«‹å³ç”Ÿæ•ˆ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token parameter variable">--reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹é˜²ç«å¢™æ‰€æœ‰å¼€æ”¾çš„ç«¯å£</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --list-ports<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å…³é—­é˜²ç«å¢™ï¼ˆæ…é‡ï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl stop firewalld.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token parameter variable">--state</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰çš„ç«¯å£ç›‘å¬æƒ…å†µ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-lnpt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CentOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS å®‰è£… homebrew</title>
      <link href="posts/6fa24dc0.html"/>
      <url>posts/6fa24dc0.html</url>
      
        <content type="html"><![CDATA[<h1 id="MacOS-å®‰è£…-homebrew"><a href="#MacOS-å®‰è£…-homebrew" class="headerlink" title="MacOS å®‰è£… homebrew"></a>MacOS å®‰è£… homebrew</h1><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>brew update</td><td>æ›´æ–° Homebrew è‡ªèº«</td></tr><tr><td>brew outdated</td><td>æŸ¥çœ‹å“ªäº›å®‰è£…åŒ…éœ€è¦æ›´æ–°</td></tr><tr><td>brew upgrade</td><td>æ›´æ–°æ‰€æœ‰çš„åŒ…</td></tr><tr><td>brew upgrade $FORMULA</td><td>æ›´æ–°æŒ‡å®šçš„åŒ…</td></tr><tr><td>brew cleanup</td><td>æ¸…ç†æ‰€æœ‰åŒ…çš„æ—§ç‰ˆæœ¬</td></tr><tr><td>brew cleanup $FORMULA</td><td>æ¸…ç†æŒ‡å®šåŒ…çš„æ—§ç‰ˆæœ¬</td></tr><tr><td>brew cleanup -n</td><td>æŸ¥çœ‹å¯æ¸…ç†çš„æ—§ç‰ˆæœ¬åŒ…ï¼Œä¸æ‰§è¡Œå®é™…æ“ä½œ</td></tr><tr><td>brew pin $FORMULA</td><td>é”å®šæŸä¸ªåŒ…</td></tr><tr><td>brew unpin $FORMULA</td><td>å–æ¶ˆé”å®š</td></tr><tr><td>brew info $FORMULA</td><td>æ˜¾ç¤ºæŸä¸ªåŒ…çš„ä¿¡æ¯</td></tr><tr><td>brew info</td><td>æ˜¾ç¤ºå®‰è£…äº†åŒ…æ•°é‡ï¼Œæ–‡ä»¶æ•°é‡ï¼Œå’Œæ€»å ç”¨ç©ºé—´</td></tr><tr><td>brew deps â€“installed â€“tree</td><td>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çš„ä¾èµ–ï¼Œæ ‘å½¢æ˜¾ç¤º</td></tr><tr><td>brew list</td><td>åˆ—å‡ºå·²å®‰è£…çš„åŒ…</td></tr><tr><td>brew rm $FORMULA</td><td>åˆ é™¤æŸä¸ªåŒ…</td></tr><tr><td>brew uninstall â€“force $FORMULA</td><td>åˆ é™¤æ‰€æœ‰ç‰ˆæœ¬</td></tr></tbody></table><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><blockquote><p><a href="https://brew.sh/">Homebrew å®˜ç½‘åœ°å€</a><br><a href="https://github.com/homebrew/install#uninstall-homebrew">Homebrew GitHub åœ°å€</a><br><a href="https://github.com/Homebrew/brew/releases/tag/2.7.3">å®˜ç½‘æºç ä¸‹è½½</a><br><a href="https://github.com/homebrew/install#uninstall-homebrew">å®˜ç½‘ GitHub åœ°å€</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/">æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ - å®‰è£… homebrew</a><br><a href="https://www.jianshu.com/p/5822d24a651e">ä½¿ç”¨å›½å†…é•œåƒå®‰è£… homebrew</a>  </p></blockquote><blockquote><p>å¦‚æœä½¿ç”¨å®˜ç½‘æ¨èçš„æ–¹å¼ä¸‹è½½æ—¶æç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯æ—¶ï¼Œåˆ™è¡¨ç¤ºç½‘ç»œè¶…æ—¶ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨æºç åŒ…çš„å½¢å¼å®‰è£…</p></blockquote><p>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">curl: <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> Failed to connect to raw.githubusercontent.com port <span class="token number">443</span>: Connection refused<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…"><a href="#ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…" class="headerlink" title="ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…"></a>ç›´æ¥ä½¿ç”¨åŒ…å®‰è£…</h2><ol><li>è¿›å…¥ <a href="https://github.com/Homebrew/brew/tags">Homebrew çš„ GitHub ä»“åº“ tag åœ°å€</a> ä¸‹è½½æœ€æ–°çš„ tag</li><li>æ ¹æ®ç³»ç»Ÿé€‰æ‹©ä¸‹è½½ï¼šmacã€windows å¯ä»¥ä¸‹è½½ zip æ–‡ä»¶ï¼Œ linux å¯ä»¥ä¸‹è½½ tar.gz çš„æ–‡ä»¶ã€‚</li><li>ä¸‹è½½åè§£å‹ã€‚</li><li>è¿›å…¥æœ¬åœ° <code>Homebrew</code> çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚æœæ‰¾ä¸åˆ°çš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ <code>terminal</code> ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿›å…¥  usr/local ç›®å½•</span><span class="token builtin class-name">cd</span> /usr/local<span class="token comment"># ä½¿ç”¨è®¿è¾¾(finder) æ‰“å¼€å½“å‰ç›®å½•</span><span class="token function">open</span> <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>æŸ¥çœ‹ <code>/usr/local</code> ç›®å½•ä¸‹æ˜¯å¦æœ‰ <code>Homebrew</code> æ–‡ä»¶å¤¹ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰ï¼Œå¦‚æœä½ å‘ç°æ²¡æœ‰ <code>Homebrew</code> æ–‡ä»¶å¤¹ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º <code>Homebrew</code> æ–‡ä»¶å¤¹</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /user/local/Homebrew<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li><p>å°†ç¬¬ä¸‰æ­¥ä¸­è§£å‹åçš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ° <code>/usr/local/Homebrew</code> ç›®å½•</p></li><li><p>é‡å¯å‘½ä»¤è¡Œçª—å£ï¼Œè¾“å…¥ <code>brew</code> å‘½ä»¤ï¼Œå‡ºç° brew ç›¸å…³çš„ help é¡µé¢ï¼Œå³è¡¨ç¤ºå·²ç»å®‰è£…æˆåŠŸ</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /user/local/Homebrew <span class="token operator">&amp;&amp;</span> brew<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ•²å‡» <code>brew</code> å‘½ä»¤æ—¶ï¼Œå‡ºç°ä»¥ä¸‹å†…å®¹æ—¶ï¼Œè¡¨ç¤ºå·²ç»å®‰è£… Homebrew æˆåŠŸ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Example usage:  brew search <span class="token punctuation">[</span>TEXT<span class="token operator">|</span>/REGEX/<span class="token punctuation">]</span>  brew info <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>  brew <span class="token function">install</span> FORMULA<span class="token punctuation">..</span>.  brew update  brew upgrade <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>  brew uninstall FORMULA<span class="token punctuation">..</span>.  brew list <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>Troubleshooting:  brew config  brew doctor  brew <span class="token function">install</span> <span class="token parameter variable">--verbose</span> <span class="token parameter variable">--debug</span> FORMULAContributing:  brew create <span class="token punctuation">[</span>URL <span class="token punctuation">[</span>--no-fetch<span class="token punctuation">]</span><span class="token punctuation">]</span>  brew edit <span class="token punctuation">[</span>FORMULA<span class="token punctuation">..</span>.<span class="token punctuation">]</span>Further help:  brew commands  brew <span class="token builtin class-name">help</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span>  <span class="token function">man</span> brew  https://docs.brew.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>å®‰è£…å®Œæˆåï¼Œä¸€å®šè¦ä¸‹è½½ä¸€ä¸ªè½¯ä»¶æµ‹è¯•ä¸‹ï¼Œæ¯”å¦‚ä¸‹è½½ <code>wget</code></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token function">wget</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="9"><li>æ›´æ¢ brew çš„ä¸‹è½½æº</li></ol><ul><li><p><a href="http://mirrors.ustc.edu.cn/help/brew.git.html">Homebrew æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span><span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/brew.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span><span class="token function">git</span> remote set-url origin https://github.com/Homebrew/brew.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-bottles.html">Homebrew Bottles æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¯·åœ¨è¿è¡Œ brew å‰è®¾ç½®ç¯å¢ƒå˜é‡ HOMEBREW_BOTTLE_DOMAIN ï¼Œå€¼ä¸º https://mirrors.ustc.edu.cn/homebrew-bottles</span><span class="token comment"># å¯¹äº bash ç”¨æˆ·</span><span class="token builtin class-name">echo</span> <span class="token string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> <span class="token operator">&gt;&gt;</span> ~/.bash_profile<span class="token builtin class-name">source</span> ~/.bash_profile<span class="token comment"># å¯¹äº zsh ç”¨æˆ·</span><span class="token builtin class-name">echo</span> <span class="token string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">source</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-core.git.html">Homebrew Core æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>/Library/Taps/homebrew/homebrew-core"</span><span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>/Library/Taps/homebrew/homebrew-core"</span><span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-core<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-cask.git.html">Homebrew Cask æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ä¸º USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask<span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask<span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-cask<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><a href="http://mirrors.ustc.edu.cn/help/homebrew-cask-versions.git.html">Homebrew Cask Versions æº</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›¿æ¢ä¸º USTC é•œåƒ</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask-versions<span class="token function">git</span> remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask-versions.git<span class="token comment"># é‡ç½®ä¸ºå®˜æ–¹åœ°å€</span><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--repo</span><span class="token variable">)</span></span>"</span>/Library/Taps/homebrew/homebrew-cask-versions<span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-cask-versions.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> macOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macOS </tag>
            
            <tag> homebrew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ç®¡ç†è¿œç¨‹ä¼šè¯ screen</title>
      <link href="posts/4fadf1be.html"/>
      <url>posts/4fadf1be.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-ç®¡ç†è¿œç¨‹ä¼šè¯-screen"><a href="#Linux-ç®¡ç†è¿œç¨‹ä¼šè¯-screen" class="headerlink" title="Linux ç®¡ç†è¿œç¨‹ä¼šè¯ screen"></a>Linux ç®¡ç†è¿œç¨‹ä¼šè¯ screen</h1><ol><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯çª—å£ backup</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-S</span> backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æŸ¥çœ‹ä¼šè¯ä¼šå‡ºç° session_id</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>é€€å‡ºä¼šè¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>ç›´æ¥ä½¿ç”¨ screen å‘½ä»¤æ‰§è¡Œè¦è¿è¡Œçš„å‘½ä»¤ï¼Œè¿™æ ·åœ¨å‘½ä»¤ä¸­çš„ä¸€åˆ‡æ“ä½œä¹Ÿéƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå½“å‘½ä»¤æ‰§è¡Œç»“æŸå screen ä¼šè¯ä¹Ÿä¼šè‡ªåŠ¨ç»“æŸã€‚</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token function">vim</span> memo.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>ä¼šè¯å…±äº«åŠŸèƒ½</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç»ˆç«¯ Aï¼šåˆ›å»ºä¼šè¯</span><span class="token function">screen</span> <span class="token parameter variable">-S</span> backup<span class="token comment"># ç»ˆç«¯ Bï¼šåŒæ­¥ç»ˆç«¯ä¿¡æ¯</span><span class="token function">screen</span> <span class="token parameter variable">-x</span><span class="token comment"># æˆ–è€…é€šè¿‡ screen-session-id è¿›å…¥</span><span class="token function">screen</span> <span class="token parameter variable">-x</span> <span class="token operator">&lt;</span>screen-session-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚</span><span class="token function">screen</span> <span class="token parameter variable">-x</span> <span class="token number">364490</span>.backup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>è¿›å…¥ä¼šè¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">screen</span> <span class="token parameter variable">-r</span> backup<span class="token comment"># æœ‰æ—¶å€™screenå¼‚å¸¸é€€å‡ºå¯èƒ½ä¼šæç¤ºçŠ¶æ€ä¸ºAttachedï¼Œå¯ä»¥æ‰§è¡Œï¼šscreen -D -r backup è¿›è¡Œæ¢å¤ã€‚</span><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>screen-name or screen-session-id<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚</span><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-r</span> backup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Screen </tag>
            
            <tag> ä¼šè¯ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Supervisor è¿›ç¨‹ç®¡ç†å·¥å…·ä½¿ç”¨</title>
      <link href="posts/21919295.html"/>
      <url>posts/21919295.html</url>
      
        <content type="html"><![CDATA[<h1 id="Supervisor-è¿›ç¨‹ç®¡ç†å·¥å…·ä½¿ç”¨"><a href="#Supervisor-è¿›ç¨‹ç®¡ç†å·¥å…·ä½¿ç”¨" class="headerlink" title="Supervisor è¿›ç¨‹ç®¡ç†å·¥å…·ä½¿ç”¨"></a>Supervisor è¿›ç¨‹ç®¡ç†å·¥å…·ä½¿ç”¨</h1><ul><li><a href="https://pypi.org/project/supervisor/">pypi æ’ä»¶é“¾æ¥åœ°å€</a></li><li><a href="http://supervisord.org/">å®˜æ–¹æ–‡æ¡£åœ°å€</a></li><li><a href="https://www.jianshu.com/p/3658c963d28b">supervisor ä»å®‰è£…åˆ°ä½¿ç”¨</a></li></ul><blockquote><p>php artisan horizon å’Œ php artisan queue:work å‘½ä»¤ä¸€æ ·ï¼Œéƒ½å¯ä»¥æ­£å¸¸å¤„ç†å¼‚æ­¥ä»»åŠ¡<br>php artisan horizon:terminate =&gt; Horizon è¿›ç¨‹ä¼šç­‰å¾…å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åå†é€€å‡ºè¿›ç¨‹ã€‚</p></blockquote><h2 id="åœ¨é˜¿é‡Œäº‘-CentOS-7-6-ä¸Š"><a href="#åœ¨é˜¿é‡Œäº‘-CentOS-7-6-ä¸Š" class="headerlink" title="åœ¨é˜¿é‡Œäº‘ CentOS 7.6 ä¸Š"></a>åœ¨é˜¿é‡Œäº‘ CentOS 7.6 ä¸Š</h2><ul><li>å®‰è£… supervisor</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> supervisor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹ä¸»é…ç½®ä¿¡æ¯ <code>supervisord.conf</code> ç•™æ„ <code>include</code> é€‰é¡¹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/supervisord.conf<span class="token comment"># è¿™é‡Œå†³å®šäº†ä½ æ‰€éœ€è¦å†™çš„è¿›ç¨‹é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œè¿™é‡Œæ˜¯ ini ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¿…é¡»å†™æˆ ini åç¼€çš„æ–‡ä»¶</span><span class="token punctuation">[</span>include<span class="token punctuation">]</span>files <span class="token operator">=</span> supervisord.d/*.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ·»åŠ è‡ªå®šä¹‰è¿›ç¨‹é…ç½®ä¿¡æ¯</li></ul><p>vim /etc/supervisord.d/larablog.ini</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>program:larablog-horizon<span class="token punctuation">]</span><span class="token assign-left variable">process_name</span><span class="token operator">=</span>%<span class="token punctuation">(</span>program_name<span class="token punctuation">)</span>s<span class="token assign-left variable">command</span><span class="token operator">=</span>php /www/wwwroot/larablog/artisan horizon<span class="token assign-left variable">autostart</span><span class="token operator">=</span>true<span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true<span class="token assign-left variable">user</span><span class="token operator">=</span>www<span class="token assign-left variable">redirect_stderr</span><span class="token operator">=</span>true<span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/www/wwwroot/larablog/storage/logs/worker.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>program:larablog-horizon ä»£è¡¨è¿™ä¸ªé…ç½®çš„åç§°æ˜¯ larablog-horizonï¼›</p></li><li><p>process_name= ä»£è¡¨è¿™ä¸ªè¿›ç¨‹åœ¨ Supervisor å†…éƒ¨çš„å‘½åï¼›</p></li><li><p>command= ä»£è¡¨è¦æ‰§è¡Œçš„å‘½ä»¤ï¼›</p></li><li><p>autostart=true ä»£è¡¨è¿™ä¸ªè¿›ç¨‹è·Ÿéš Supervisorï¼Œåªè¦ Supervisor å¯åŠ¨äº†ï¼Œå°±å¯åŠ¨è¿™ä¸ªè¿›ç¨‹ï¼›</p></li><li><p>autorestart=true ä»£è¡¨è¦æ±‚ Supervisor ç›‘å¬è¿›ç¨‹çŠ¶æ€ï¼Œå‡å¦‚å¼‚å¸¸é€€å‡ºå°±å†æ¬¡å¯åŠ¨ï¼Œé‡å¯æ¬¡æ•°é»˜è®¤æœ‰ 3 æ¬¡é™åˆ¶ï¼›</p></li><li><p>user=www ä»£è¡¨ä»¥ www èº«ä»½å¯åŠ¨è¿›ç¨‹ï¼›</p></li><li><p>redirect_stderr=true ä»£è¡¨è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼›</p></li><li><p>stdout_logfile= ä»£è¡¨å°†è¿›ç¨‹çš„è¾“å‡ºä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p></li><li><p>æ›´æ–°é…ç½®</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> supervisorctl update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœé‡åˆ°æŠ¥é”™ <code>error: &lt;class 'socket.error'&gt;, [Errno 2] No such file or directory: file: /usr/lib64/python2.7/socket.py line: 224</code> åˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> supervisord <span class="token parameter variable">-c</span> /etc/supervisord.conf<span class="token comment"># å†æ¬¡å°è¯•æ‰§è¡Œé‡è½½é…ç½®å‘½ä»¤</span><span class="token function">sudo</span> supervisorctl update<span class="token function">sudo</span> supervisorctl <span class="token parameter variable">-c</span> /etc/supervisord.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> supervisorctl status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="åœ¨-ubuntu-ä¸Š"><a href="#åœ¨-ubuntu-ä¸Š" class="headerlink" title="åœ¨ ubuntu ä¸Š"></a>åœ¨ ubuntu ä¸Š</h2><ul><li>å®‰è£… supervisor</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> supervisor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ·»åŠ è‡ªå®šä¹‰è¿›ç¨‹é…ç½®ä¿¡æ¯</li></ul><p>vim /etc/supervisor/conf.d/larablog.conf</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>program:larablog-horizon<span class="token punctuation">]</span><span class="token assign-left variable">process_name</span><span class="token operator">=</span>%<span class="token punctuation">(</span>program_name<span class="token punctuation">)</span>s<span class="token assign-left variable">command</span><span class="token operator">=</span>php /www/wwwroot/larablog/artisan horizon<span class="token assign-left variable">autostart</span><span class="token operator">=</span>true<span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true<span class="token assign-left variable">user</span><span class="token operator">=</span>www<span class="token assign-left variable">redirect_stderr</span><span class="token operator">=</span>true<span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/www/wwwroot/larablog/storage/logs/worker.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ›´æ–°é…ç½®</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> supervisorctl update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ£€æŸ¥æ˜¯å¦æ­£å¸¸è¿è¡Œ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> supervisorctl status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å•ç‹¬å¯åŠ¨ä¸€ä¸ªæŒ‡å®šåç§°çš„è¿›ç¨‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> supervisorctl start <span class="token operator">&lt;</span>process-name<span class="token operator">&gt;</span><span class="token comment"># æ¯”å¦‚å¯åŠ¨åç§°ä¸º larablog-horizon çš„è¿›ç¨‹</span><span class="token function">sudo</span> supervisorctl start larablog-horizon<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Supervisor </tag>
            
            <tag> è¿›ç¨‹ç®¡ç†å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vmware å®‰è£… macos åŸç‰ˆç³»ç»Ÿ</title>
      <link href="posts/17b85fe6.html"/>
      <url>posts/17b85fe6.html</url>
      
        <content type="html"><![CDATA[<h1 id="VMware-WorkStation-å®‰è£…-macOS-åŸç‰ˆç³»ç»Ÿ"><a href="#VMware-WorkStation-å®‰è£…-macOS-åŸç‰ˆç³»ç»Ÿ" class="headerlink" title="VMware WorkStation å®‰è£… macOS åŸç‰ˆç³»ç»Ÿ"></a>VMware WorkStation å®‰è£… macOS åŸç‰ˆç³»ç»Ÿ</h1><h2 id="æ–‡çŒ®å‚è€ƒ"><a href="#æ–‡çŒ®å‚è€ƒ" class="headerlink" title="æ–‡çŒ®å‚è€ƒ"></a>æ–‡çŒ®å‚è€ƒ</h2><ul><li><a href="https://www.bilibili.com/video/BV1a7411e7Pq">æ‰‹æŠŠæ‰‹æ•™ä½ win 10 VMware 15 å®‰è£… MAC OS 10.15åŸç‰ˆç³»ç»Ÿ</a></li><li><a href="https://github.com/paolo-projects/unlocker/releases">VMware è§£é”å™¨</a></li><li><a href="https://updates.cdn-apple.com/2020/macos/001-48329-20200924-122a4260-eb65-4492-b08e-f69dfa22c2dc/SecUpd2020-005Mojave.dmg">å®˜æ–¹ç³»ç»Ÿä¸‹è½½</a></li><li><a href="https://www.mediafire.com/file/7wm2251an4c2n64/macOS_Catalina_ISO_By_Techbland.iso/file">é•œåƒä¸‹è½½åœ°å€</a></li><li><a href="https://www.applex.net/pages/macos/">æä¾›å„ç‰ˆæœ¬çš„è‹¹æœç”µè„‘macOSç³»ç»Ÿé•œåƒä¸‹è½½ ï¼Œæ”¯æŒç™¾åº¦ç½‘ç›˜/ç‹¬ç«‹æœåŠ¡å™¨/è¿…é›·åœ°å€ä¸‹è½½</a></li></ul><h2 id="å®‰è£…å‰å¿…é¡»è¦å‡†å¤‡çš„è½¯ä»¶"><a href="#å®‰è£…å‰å¿…é¡»è¦å‡†å¤‡çš„è½¯ä»¶" class="headerlink" title="å®‰è£…å‰å¿…é¡»è¦å‡†å¤‡çš„è½¯ä»¶"></a>å®‰è£…å‰å¿…é¡»è¦å‡†å¤‡çš„è½¯ä»¶</h2><ul><li>VMware workstation è™šæ‹Ÿæœº</li><li>VMware è§£é”å™¨</li><li>macOS æ‡’äººåŒ…ç³»ç»Ÿ ï¼ˆ .cdr æ–‡ä»¶ï¼‰</li></ul><p>ä»¥ä¸Šè½¯ä»¶å¯ä»¥é€šè¿‡è®¿é—®æˆ‘çš„ç™¾åº¦ç½‘ç›˜è·å–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸‹è½½ä¸‹æ¥çš„ <code>.cdr</code> æ‡’äººåŒ…ç³»ç»Ÿï¼Œæœ€å¥½è¦é€šè¿‡ <code>md5</code> æ ¡éªŒã€‚</p><p>ä»¥ä¸‹ä¸ºç½‘ç›˜é“¾æ¥</p><pre class="line-numbers language-none"><code class="language-none">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1NMHD6i8FIgYaqcPVljbl8w æå–ç ï¼šjcr3 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>Windows ç³»ç»Ÿä¸‹å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ ¸å¯¹ md5</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">certutil <span class="token parameter variable">-hashfile</span> <span class="token string">"cdræ–‡ä»¶çš„ç»å¯¹è·¯å¾„"</span> md5<span class="token comment"># æ¯”å¦‚</span>certutil <span class="token parameter variable">-hashfile</span> <span class="token string">"F:\Vmware Installer macOS Mojave(18G103).cdr"</span> md5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…æ­¥éª¤å¦‚ä¸‹"><a href="#å®‰è£…æ­¥éª¤å¦‚ä¸‹" class="headerlink" title="å®‰è£…æ­¥éª¤å¦‚ä¸‹"></a>å®‰è£…æ­¥éª¤å¦‚ä¸‹</h2><ul><li>ä¸‹è½½ VMware è§£é”å™¨ <code>unlocker.zip</code> å¹¶è§£å‹ï¼Œå¹¶åˆ‡è®°ä¸€å®šè¦å…³é—­æ‰ VMware çš„æ‰€æœ‰è¿›ç¨‹ï¼Œå¦‚æœä¸çŸ¥é“å¦‚ä½•å…³é—­æ‰ VMware çš„æ‰€æœ‰è¿›ç¨‹ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥å…³æœºé‡å¯ï¼Œç„¶åå†è¿›è¡Œä»¥ä¸‹æ“ä½œ</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5d55ecd7da49b4f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è§£å‹ VMware è§£é”å™¨"></p><ul><li>å¯¹ç€è§£å‹åçš„ <code>win-install.cmd</code> æ–‡ä»¶ï¼Œå³é”® - ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c1094950a7bcb3ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å³é”® - ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"></p><ul><li>æ­¤æ—¶è§£é”å™¨ä¼šè‡ªåŠ¨ä¸‹è½½ç›¸åº”çš„æ–‡ä»¶ï¼Œä¸ç”¨å»ç†ä¼š</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b55be1c48fe20e9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è§£é”å™¨æ­£åœ¨ä¸‹è½½ç›¸åº”çš„è§£é”æ–‡ä»¶"></p><ul><li>å­—æ¡èµ°å®Œä¹‹åä¼šè‡ªåŠ¨å…³é—­æ‰ <code>cmd</code> å‘½ä»¤çª—å£</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1469e628bb22865d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è§£é”å™¨è½¯ä»¶å®‰è£…å®Œæ¯•åï¼Œä¼šè‡ªåŠ¨å…³é—­æ‰ cmd çª—å£"></p><ul><li>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥éªŒè¯è§£é”å™¨æ˜¯å¦å®‰è£…å¥½ï¼Œæ‰“å¼€ VMware è™šæ‹Ÿæœºï¼Œå°è¯•æ–°å»ºä¸€å°è™šæ‹Ÿæœº</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-dc120ff66ee2143f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>é€‰æ‹©ç¨åå®‰è£…ç³»ç»Ÿ</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3bdecc977abad802.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>é€‰æ‹© <code>Apple Mac OS</code> ç›¸åº”çš„é€‰é¡¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿé€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ <strong>å®‰è£…ä»€ä¹ˆç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œå°±è¦é€‰æ‹©ç›¸åº”çš„ç‰ˆæœ¬ï¼Œå¦åˆ™å®‰è£…ç³»ç»Ÿæ—¶ï¼Œé¡µé¢ä¼šç›´æ¥å¡æ­»</strong></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c0383da1fac1d780.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li><p>æ­¤æ—¶æˆ‘ä»¬èƒ½å¤Ÿç¡®å®šè§£é”å™¨å·²ç»å®‰è£…å¥½äº†ï¼Œå¦‚æœæ­¤æ—¶æ— æ³•çœ‹åˆ° <code>macOS</code> ç³»ç»Ÿç›¸å…³çš„é€‰é¡¹ï¼Œé‚£ä¹ˆå°±éœ€è¦è‡ªå·±åå¤å¤šæ¬¡çš„å®‰è£…è§£é”å™¨ï¼Œç›´åˆ°èƒ½å¤Ÿçœ‹åˆ° <code>macOS</code> ç³»ç»Ÿç›¸å…³çš„é€‰é¡¹æ‰ç®—æˆåŠŸï¼æ­¤æ—¶ï¼Œæ­£å¼å¼€å¯å®‰è£… <code>macOS</code> ç³»ç»Ÿä¹‹æ—…ï¼</p></li><li><p>ä»¥ä¸‹æ­¥éª¤æ²¡æœ‰å¤ªå¤šéœ€è¦è¯´çš„ï¼ŒæŒ‰ç…§æˆªå›¾ä¸€æ­¥ä¸€æ­¥çš„æ¥æ“ä½œå°±å¥½äº†ã€‚</p></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0d5e6bb7fcbf5693.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bdf66cfcb46d334f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-470f7e95996b8e95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„ç³»ç»Ÿæ˜¯ <code>.cdr</code> æ ¼å¼çš„æ‡’äººåŒ…ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹© <code>æ‰€æœ‰æ–‡ä»¶</code> æ‰å¯ä»¥çœ‹åˆ° <code>.cdr</code> æ–‡ä»¶ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-82cc62377031414c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-76561873201b4868.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a999d47eac24da6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>æˆ‘è¿™é‡Œè§£é”ä¹‹åæœ€é«˜åªèƒ½è¾¾åˆ° <code>10.14</code> çš„ç‰ˆæœ¬ï¼Œå› æ­¤æœ€ååªèƒ½å®‰è£… <code>macOS 10.14</code> çš„ç³»ç»Ÿï¼Œä½†æ˜¯æ“ä½œæ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘è¿™é‡Œæœ€é«˜åªèƒ½æ˜¯ <code>10.14</code> çš„ç‰ˆæœ¬ï¼Œå¦‚æœä½ çŸ¥é“ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€åˆ†äº«ä¸€ä¸‹ã€‚ä½†æ˜¯ä¸€å®šè¦åˆ‡è®°ï¼Œåœ¨è¿™é‡Œä½ é€‰æ‹©çš„æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œä½ å°±å¿…é¡»å¾—å®‰è£…ä»€ä¹ˆç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œå¦åˆ™æ— æ³•å®‰è£…çš„ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5db13a5dddd5913e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>ä½ ä¹Ÿå¯ä»¥è‡ªå·±é€‰æ‹©å®‰è£…è·¯å¾„ï¼Œè¿™ä¸ªæ²¡æœ‰å¤šå¤§å½±å“çš„ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-32a39bb01028420a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-57a02042db810fe1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-63269f2bf437b483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bd5063e66c347b8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-27ab34b1c5910913.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4e4c3d84cd2d81d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fcd64dfa495db579.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8dec6384e39c5f0a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f6c011453fa32db5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>è¿™é‡Œçš„æˆ‘ä»¬éœ€è¦é€‰æ‹© <code>ç£ç›˜å·¥å…·</code> å…ˆå°†ç£ç›˜æŠ¹æ‰ä¸€ä¸‹</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-18c19147c0287b0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>ä¸€å®šè¦æ³¨æ„ï¼Œåªèƒ½é€‰æ‹©åˆšåˆšæˆ‘ä»¬åˆ†é…ç»™ VMware çš„é‚£å—ç›˜ï¼Œå…¶ä»–çš„ä¸è¦å»åŠ¨</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d6502e6942507cf8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a56f6d65c8af8e66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ç¡¬ç›˜çš„åç§°</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-29182a6ba51f3d14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0bb2fe22c24127fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-dc6da02e40630c46.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>æ¥ä¸‹æ¥å°±å¯ä»¥æ­£å¼å®‰è£…ç³»ç»Ÿäº†</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6b4f9b0dc8dd5f59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-20a8500578e77a4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4a5e4d2f6f873237.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ebf3a3aa95ad9e23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-10f3e63d7698153b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6a29ad902ca42f85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-858e85800375aa9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4f7d8621579f1e35.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6d1be7fab284223e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d91052596f1f6a5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>å®‰è£…åˆ°è¿™é‡Œä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ°ç‰©ç†æœºä¸Šé¢è®¾ç½®ä¸€ä¸‹ç½‘ç»œï¼Œè¿™æ ·æ‰èƒ½å¤Ÿä¿è¯è™šæ‹Ÿæœºèƒ½å¤Ÿè®¿é—®ç½‘ç»œ</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-89c913b1a93e35d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c76b0e8d339fa9b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5a6b3cfa2e4b5ac4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-58f85f0769d2d806.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bb7e63edd1ea925b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f0e5481918b08eae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b8cbaab5b48a8f5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-638a71f2bb30082f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5dc33873f724a835.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0e2db0987876efb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-537f2118a2179f0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0c519f187338c657.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-47342c1c550ac55e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-cc5277d7cdcd2443.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d28b63af01954e7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>æ­¤æ—¶æˆ‘ä»¬åœ¨ VMware ä¸­å°±å·²ç»å°† macOS ç³»ç»Ÿå®‰è£…å®Œæ¯•äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å¼¹å‡ºä¸€ä¸‹æˆ‘ä»¬çš„ç³»ç»Ÿé•œåƒ</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b9b6a3d9fc18f1d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li>ç»§ç»­å®‰è£… VMware tools ï¼Œè¿™æ ·èƒ½å¤Ÿè‡ªåŠ¨é€‚é…æˆ‘ä»¬ç‰©ç†æœºçš„åˆ†è¾¨ç‡</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-cc8ae8f39937e312.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-22bf2dda46ea0caf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-33acc9ad3a16c8cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-faf3da4dd22cb119.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-20f5ee8ff0c04453.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0e0e12068dce26c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>æŒ‰ç…§ä»¥ä¸Šçš„æˆªå›¾ä¸€æ­¥ä¸€æ­¥æ“ä½œï¼Œæˆ‘ç›¸ä¿¡é—®é¢˜åº”è¯¥ä¸ä¼šå¾ˆå¤§çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> macOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macOS </tag>
            
            <tag> è™šæ‹Ÿæœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx/Tengine æœåŠ¡å™¨å®‰è£… SSL è¯ä¹¦</title>
      <link href="posts/2078b83a.html"/>
      <url>posts/2078b83a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Nginx-Tengine-æœåŠ¡å™¨å®‰è£…-SSL-è¯ä¹¦"><a href="#Nginx-Tengine-æœåŠ¡å™¨å®‰è£…-SSL-è¯ä¹¦" class="headerlink" title="Nginx/Tengine æœåŠ¡å™¨å®‰è£… SSL è¯ä¹¦"></a>Nginx/Tengine æœåŠ¡å™¨å®‰è£… SSL è¯ä¹¦</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><blockquote><p>ä½¿ç”¨é˜¿é‡Œäº‘ä¸‹è½½å…è´¹ç‰ˆ DigiCert Inc è¯ä¹¦ï¼Œå¹¶åŸºäº Nginx web æœåŠ¡å™¨å®‰è£… SSL è¯ä¹¦</p></blockquote><h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><p>åœ¨è¯ä¹¦æ§åˆ¶å°ä¸‹è½½ Nginx ç‰ˆæœ¬è¯ä¹¦ã€‚ä¸‹è½½åˆ°æœ¬åœ°çš„å‹ç¼©æ–‡ä»¶åŒ…è§£å‹ååŒ…å«ï¼š</p><ul><li><code>.crt</code> æ–‡ä»¶ï¼šæ˜¯è¯ä¹¦æ–‡ä»¶ï¼Œcrt æ˜¯ pem æ–‡ä»¶çš„æ‰©å±•åã€‚</li><li><code>.key</code> æ–‡ä»¶ï¼šè¯ä¹¦çš„ç§é’¥æ–‡ä»¶ï¼ˆç”³è¯·è¯ä¹¦æ—¶å¦‚æœæ²¡æœ‰é€‰æ‹©<code>è‡ªåŠ¨åˆ›å»º CSR</code>ï¼Œåˆ™æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ã€‚</li></ul><p><code>å‹æƒ…æç¤ºï¼š</code>  <code>.pem</code> æ‰©å±•åçš„è¯ä¹¦æ–‡ä»¶é‡‡ç”¨ Base64-encoded çš„ PEM æ ¼å¼<code>æ–‡æœ¬æ–‡ä»¶</code>ï¼Œå¯æ ¹æ®éœ€è¦ä¿®æ”¹æ‰©å±•åã€‚</p><p>ä»¥ Nginx æ ‡å‡†é…ç½®ä¸ºä¾‹ï¼Œå‡å¦‚è¯ä¹¦æ–‡ä»¶åæ˜¯ a.pemï¼Œç§é’¥æ–‡ä»¶æ˜¯ a.keyã€‚</p><p>åœ¨ Nginx çš„å®‰è£…ç›®å½•ä¸‹åˆ›å»º cert ç›®å½•ï¼Œå¹¶ä¸”å°†ä¸‹è½½çš„å…¨éƒ¨æ–‡ä»¶æ‹·è´åˆ° cert ç›®å½•ä¸­ã€‚å¦‚æœç”³è¯·è¯ä¹¦æ—¶æ˜¯è‡ªå·±åˆ›å»ºçš„ CSR æ–‡ä»¶ï¼Œè¯·å°†å¯¹åº”çš„ç§é’¥æ–‡ä»¶æ”¾åˆ° cert ç›®å½•ä¸‹å¹¶ä¸”å‘½åä¸º a.keyï¼›</p><p>æ‰“å¼€ Nginx å®‰è£…ç›®å½•ä¸‹ conf ç›®å½•ä¸­çš„ nginx.conf æ–‡ä»¶ï¼Œæ‰¾åˆ°ï¼š</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># HTTPS server</span><span class="token comment"># #server {</span><span class="token comment"># listen 443;</span><span class="token comment"># server_name localhost;</span><span class="token comment"># ssl on;</span><span class="token comment"># ssl_certificate cert.pem;</span><span class="token comment"># ssl_certificate_key cert.key;</span><span class="token comment"># ssl_session_timeout 5m;</span><span class="token comment"># ssl_protocols SSLv2 SSLv3 TLSv1;</span><span class="token comment"># ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span><span class="token comment"># ssl_prefer_server_ciphers on;</span><span class="token comment"># location / {</span><span class="token comment">#</span><span class="token comment">#</span><span class="token comment">#}</span><span class="token comment">#}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†å…¶ä¿®æ”¹ä¸º (ä»¥ä¸‹å±æ€§ä¸­ ssl å¼€å¤´çš„å±æ€§ä¸è¯ä¹¦é…ç½®æœ‰ç›´æ¥å…³ç³»ï¼Œå…¶å®ƒå±æ€§è¯·ç»“åˆè‡ªå·±çš„å®é™…æƒ…å†µå¤åˆ¶æˆ–è°ƒæ•´) :</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span></span><span class="token punctuation">;</span> <span class="token comment"># åœ¨ä½¿ç”¨å®å¡”é¢æ¿æ­å»ºçš„ LNMP ç¯å¢ƒä¸­ï¼Œæ¨è `listen 443 ssl http2;` è¿™ä¹ˆå†™</span> <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">ssl</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">ssl_certificate</span>   cert/a.pem</span><span class="token punctuation">;</span> <span class="token comment"># è¿™é‡Œæ¨èå†™ç»å¯¹è·¯å¾„</span> <span class="token directive"><span class="token keyword">ssl_certificate_key</span>  cert/a.key</span><span class="token punctuation">;</span> <span class="token comment"># è¿™é‡Œæ¨èå†™ç»å¯¹è·¯å¾„</span> <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">5m</span></span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>     <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>     <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªå·±ä½¿ç”¨å®å¡”é¢æ¿-6-9-8-å…è´¹ç‰ˆï¼Œæ­å»º-LNMP-ç¯å¢ƒæ—¶çš„-nginx-é…ç½®æ–‡ä»¶"><a href="#è‡ªå·±ä½¿ç”¨å®å¡”é¢æ¿-6-9-8-å…è´¹ç‰ˆï¼Œæ­å»º-LNMP-ç¯å¢ƒæ—¶çš„-nginx-é…ç½®æ–‡ä»¶" class="headerlink" title="è‡ªå·±ä½¿ç”¨å®å¡”é¢æ¿ 6.9.8 å…è´¹ç‰ˆï¼Œæ­å»º LNMP ç¯å¢ƒæ—¶çš„ nginx é…ç½®æ–‡ä»¶"></a>è‡ªå·±ä½¿ç”¨å®å¡”é¢æ¿ 6.9.8 å…è´¹ç‰ˆï¼Œæ­å»º LNMP ç¯å¢ƒæ—¶çš„ nginx é…ç½®æ–‡ä»¶</h2><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>         <span class="token comment"># å®å¡”ä¸­å»ºè®®è¿™ä¹ˆå†™ç›‘å¬ 443 ç«¯å£</span><span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">server_name</span> www.drling.xin</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm default.php default.htm default.html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">root</span> /www/wwwroot/larablog/public</span><span class="token punctuation">;</span>            <span class="token comment"># å¼ºåˆ¶å¼€å¯ https ï¼Œå½“è®¿é—® http æ—¶ï¼Œç›´æ¥å¼ºåˆ¶è·³è½¬åˆ° https</span>    <span class="token comment">#HTTP_TO_HTTPS_START</span>    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$server_port</span> !~ 443)</span><span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">rewrite</span> ^(/.*)$ https://<span class="token variable">$host</span><span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">#HTTP_TO_HTTPS_END</span>    <span class="token directive"><span class="token keyword">limit_conn</span> perserver <span class="token number">3000</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">limit_conn</span> perip <span class="token number">25</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">512k</span></span><span class="token punctuation">;</span>            <span class="token comment"># è¿™é‡Œç›´æ¥é‡‡ç”¨å®å¡”é¢æ¿ï¼Œå°† ssl ä¿¡æ¯é€šè¿‡ [å…¶ä»–è¯ä¹¦] æ ï¼Œå¯¼å…¥è¿›å»ï¼Œå› æ­¤ nginx é…ç½®æ–‡ä»¶ç”±å®å¡”é¢æ¿è‡ªè¡Œå†™å…¥ã€‚</span>    <span class="token comment"># è‹¥éœ€è¦è‡ªå·±å†™å…¥é…ç½®æ–‡ä»¶ï¼Œä»¥ä¸‹å‚æ•°å¯ä»¥è¿™æ ·å†™ï¼Œå¦‚ä¸‹ï¼š</span>    <span class="token comment"># ssl_certificate    /www/server/panel/vhost/aliyun-ssl/1939426_drling.xin.pem;</span>    <span class="token comment"># ssl_certificate_key    /www/server/panel/vhost/aliyun-ssl/1939426_drling.xin.key;    </span>        <span class="token comment">#SSL-START SSLç›¸å…³é…ç½®ï¼Œè¯·å‹¿åˆ é™¤æˆ–ä¿®æ”¹ä¸‹ä¸€è¡Œå¸¦æ³¨é‡Šçš„404è§„åˆ™</span>    <span class="token comment">#error_page 404/404.html;    </span>    <span class="token directive"><span class="token keyword">ssl_certificate</span>    /www/server/panel/vhost/cert/www.drling.xin/fullchain.pem</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span>    /www/server/panel/vhost/cert/www.drling.xin/privkey.pem</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2 TLSv1.3</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:10m</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">497</span>  https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>    <span class="token comment">#SSL-END</span>            <span class="token comment">#ERROR-PAGE-START  é”™è¯¯é¡µé…ç½®ï¼Œå¯ä»¥æ³¨é‡Šã€åˆ é™¤æˆ–ä¿®æ”¹</span>    <span class="token comment">#error_page 404 /404.html;</span>    <span class="token comment">#error_page 502 /502.html;</span>    <span class="token comment">#ERROR-PAGE-END</span>        <span class="token comment">#PHP-INFO-START  PHPå¼•ç”¨é…ç½®ï¼Œå¯ä»¥æ³¨é‡Šæˆ–ä¿®æ”¹</span>    <span class="token directive"><span class="token keyword">include</span> enable-php-73.conf</span><span class="token punctuation">;</span>    <span class="token comment">#PHP-INFO-END</span>        <span class="token comment">#REWRITE-START URLé‡å†™è§„åˆ™å¼•ç”¨,ä¿®æ”¹åå°†å¯¼è‡´é¢æ¿è®¾ç½®çš„ä¼ªé™æ€è§„åˆ™å¤±æ•ˆ</span>    <span class="token directive"><span class="token keyword">include</span> /www/server/panel/vhost/rewrite/www.drling.xin.conf</span><span class="token punctuation">;</span>    <span class="token comment">#REWRITE-END</span>        <span class="token comment">#ç¦æ­¢è®¿é—®çš„æ–‡ä»¶æˆ–ç›®å½•</span>    <span class="token directive"><span class="token keyword">location</span> ~ ^/(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md)</span>    <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">#ä¸€é”®ç”³è¯·SSLè¯ä¹¦éªŒè¯ç›®å½•ç›¸å…³è®¾ç½®</span>    <span class="token directive"><span class="token keyword">location</span> ~ \.well-known</span><span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">location</span> ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span>    <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">expires</span>      <span class="token number">30d</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">error_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">access_log</span> /dev/null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token directive"><span class="token keyword">location</span> ~ .*\.(js|css)?$</span>    <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">expires</span>      <span class="token number">12h</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">error_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">access_log</span> /dev/null</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">access_log</span>  /www/wwwlogs/www.drling.xin.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">error_log</span>  /www/wwwlogs/www.drling.xin.error.log</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>å®‰è£…å®Œæ¯•ä¹‹åä½ å¯ä»¥ä½¿ç”¨<a href="https://www.ssllabs.com/ssltest/index.html">SSL Server Test â€“ å®‰å…¨æµ‹è¯•å·¥å…·</a> å»æµ‹è¯•ä¸‹ä½ çš„ HTTPS æ˜¯å¦å¤Ÿå®‰å…¨</p><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><blockquote><p><a href="https://help.aliyun.com/knowledge_detail/95491.html">é˜¿é‡Œäº‘å®˜æ–¹ä»‹ç» Nginx æœåŠ¡å™¨å®‰è£… SSL è¯ä¹¦</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœåŠ¡å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> å…è´¹ HTTPS è¯ä¹¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡ Certbot å®‰è£… Let&#39;s Encrypt è¯ä¹¦ï¼Œå®ç°å…è´¹çš„å…¨ç«™ HTTPS è®¿é—®</title>
      <link href="posts/6c6ec7d4.html"/>
      <url>posts/6c6ec7d4.html</url>
      
        <content type="html"><![CDATA[<h1 id="é€šè¿‡-Certbot-å®‰è£…-Letâ€™s-Encrypt-è¯ä¹¦ï¼Œå®ç°å…è´¹çš„å…¨ç«™-HTTPS-è®¿é—®"><a href="#é€šè¿‡-Certbot-å®‰è£…-Letâ€™s-Encrypt-è¯ä¹¦ï¼Œå®ç°å…è´¹çš„å…¨ç«™-HTTPS-è®¿é—®" class="headerlink" title="é€šè¿‡ Certbot å®‰è£… Letâ€™s Encrypt è¯ä¹¦ï¼Œå®ç°å…è´¹çš„å…¨ç«™ HTTPS è®¿é—®"></a>é€šè¿‡ Certbot å®‰è£… Letâ€™s Encrypt è¯ä¹¦ï¼Œå®ç°å…è´¹çš„å…¨ç«™ HTTPS è®¿é—®</h1><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><blockquote><p><a href="https://xueyuanjun.com/post/9695">é€šè¿‡ Certbot å®‰è£… Letâ€™s Encrypt è¯ä¹¦ï¼Œæ¥å®ç°å…¨ç«™çš„ HTTPS è®¿é—®</a></p><p><a href="https://xueyuanjun.com/post/9755">å­¦é™¢å†› - å°†åšå®¢åº”ç”¨ä» HTTP åè®®å…è´¹å‡çº§åˆ° HTTPS</a></p><p><a href="https://certbot.eff.org/">certbotå®˜ç½‘åœ°å€</a></p></blockquote><ul><li>æ‰“å¼€é¦–é¡µå…ˆé€‰æ‹©è‡ªå·±çš„ç³»ç»Ÿç‰ˆæœ¬ ï¼ˆæˆ‘è¿™é‡Œé‡‡ç”¨çš„ web æœåŠ¡å™¨æ˜¯ nginxï¼Œç³»ç»Ÿæ˜¯ centos7 ï¼‰<a href="https://certbot.eff.org/lets-encrypt/centosrhel7-nginx">ä¼ è¾“é—¨</a></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fb5a52f6ae876089.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="certboté¡µé¢é€‰æ‹©è‡ªå·±çš„ç³»ç»Ÿç‰ˆæœ¬"></p><ul><li>å¯ä»¥æŒ‰ç…§å®˜ç½‘æä¾›çš„æ“ä½œæ–‡æ¡£æ‰§è¡Œå‘½ä»¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… certbot å®¢æˆ·ç«¯å·¥å…·</span><span class="token function">sudo</span> yum <span class="token function">install</span> certbot python2-certbot-nginx<span class="token comment"># è‡ªåŠ¨æ£€æµ‹ nginx é…ç½®ä»¥åŠç¡®å®šå“ªäº›ç½‘ç«™éœ€è¦é…ç½® ssl ï¼ˆä¼šåˆ—å‡ºå…¨éƒ¨çš„ nginx é…ç½®ä¿¡æ¯ï¼‰</span><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span><span class="token comment"># è®¾ç½® crontab è®¡åˆ’ä»»åŠ¡ï¼Œè‡ªåŠ¨æ›´æ–° ssl è¯ä¹¦</span><span class="token builtin class-name">echo</span> <span class="token string">"0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random() * 3600)' &amp;&amp; certbot renew -q"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/crontab <span class="token operator">&gt;</span> /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»¥ä¸‹è®°å½•æœ¬äººå®‰è£…-certbot-çš„æ•´ä¸ªè¿‡ç¨‹"><a href="#ä»¥ä¸‹è®°å½•æœ¬äººå®‰è£…-certbot-çš„æ•´ä¸ªè¿‡ç¨‹" class="headerlink" title="ä»¥ä¸‹è®°å½•æœ¬äººå®‰è£… certbot çš„æ•´ä¸ªè¿‡ç¨‹"></a>ä»¥ä¸‹è®°å½•æœ¬äººå®‰è£… certbot çš„æ•´ä¸ªè¿‡ç¨‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><blockquote><p>æœåŠ¡å™¨ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨<br>ç³»ç»Ÿï¼š  centos 7<br>web æœåŠ¡å™¨ï¼š nginx<br>å®‰è£…è¿‡å®å¡” ï¼ˆå®‰è£…è¿‡å®å¡”åï¼Œnginx çš„ä¸»é…ç½®æ–‡ä»¶ä½äº <code>/www/server/nginx/conf/</code>ï¼‰</p></blockquote><p>æ•´ä½“æµç¨‹æ˜¯æŒ‰ç…§å®˜ç½‘çš„æµç¨‹æ¥æ“ä½œçš„ï¼Œä½†æ˜¯å…¶ä¸­ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼Œå‡ºç°çš„é—®é¢˜å¦‚ä¸‹ï¼š</p><ol><li>å®‰è£… certbot å®¢æˆ·ç«¯å·¥å…· ï¼ˆæ­¤æµç¨‹æ­£å¸¸ï¼‰ï¼Œå®‰è£…è¿‡ç¨‹ä¸­ï¼Œè¯¥ç›´æ¥å›è½¦çš„å°±å›è½¦ï¼Œè¯¥ç›´æ¥é€‰ Yes çš„è¾“å…¥ Y ç„¶åå›è½¦</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> certbot python2-certbot-nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>é…ç½® ssl æ—¶ï¼Œä¸€è·¯å‡ºé”™ï¼Œå¦‚ä¸‹ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é‡è¦é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pkg_resources.ContextualVersionConflict: <span class="token punctuation">(</span>cryptography <span class="token number">2.1</span> <span class="token punctuation">(</span>/usr/lib64/python2.7/site-packages<span class="token punctuation">)</span>, Requirement.parse<span class="token punctuation">(</span><span class="token string">'cryptography&gt;=2.3'</span><span class="token punctuation">)</span>, set<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'PyOpenSSL'</span><span class="token punctuation">]</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ae7750063ab78d51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="PyOpenSSLç›¸å…³æŠ¥é”™ä¿¡æ¯"></p><p>æŸ¥çœ‹ PyOpenSSL ç‰ˆæœ¬ä¿¡æ¯ï¼Œå‘ç°ç¡®å®æ˜¯ç‰ˆæœ¬è¿‡ä½çš„åŸå› </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip show PyOpenSSL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ¡ˆï¼šæ›´æ–°ç›¸åº”çš„ python åŒ…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> <span class="token parameter variable">-U</span> PyOpenSSLpip <span class="token function">install</span> <span class="token parameter variable">-U</span> cryptography<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å†æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å†æ¬¡å‘ç°æŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ImportError: cannot <span class="token function">import</span> name UnrewindableBodyError<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ¡ˆï¼šå®‰è£…ç›¸åº”çš„ python åŒ…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›´æ–° pip</span>pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip<span class="token comment"># å¸è½½ urllib3</span>pip uninstall urllib3<span class="token comment"># é‡æ–°å†æ¬¡ä¸‹è½½</span>pip <span class="token function">install</span> urllib3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å†æ¬¡å‘ç°æŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ImportError: No module named urllib3.exceptions  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ¡ˆï¼šç›´æ¥æš´åŠ›ä¸‹è½½ç›¸åº”çš„ pyOpenSSL åŒ…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> http://cbs.centos.org/kojifiles/packages/pyOpenSSL/16.2.0/3.el7/noarch/python2-pyOpenSSL-16.2.0-3.el7.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å†æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç»§ç»­æŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Error <span class="token keyword">while</span> running nginx <span class="token parameter variable">-c</span> /etc/nginx/nginx.conf -t.nginx: <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> open<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token string">"/etc/nginx/nginx.conf"</span> failed <span class="token punctuation">(</span><span class="token number">2</span>: No such <span class="token function">file</span> or directory<span class="token punctuation">)</span>nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> failedThe nginx plugin is not working<span class="token punctuation">;</span> there may be problems with your existing configuration.The error was: MisconfigurationError<span class="token punctuation">(</span><span class="token string">'Error while running nginx -c /etc/nginx/nginx.conf -t.\n\nnginx: [emerg] open() "/etc/nginx/nginx.conf" failed (2: No such file or directory)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n'</span>,<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-faa86a2b9f2c5d14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="nginx ä¸»é…ç½®æ–‡ä»¶ /etc/nginx/nginx.conf  æ²¡æœ‰æ£€æµ‹åˆ°"></p><p>åŸå› æ˜¯ï¼šå®å¡”å°† nginx çš„ä¸»é…ç½®æ–‡ä»¶å®‰è£…åœ¨ <code>/www/server/nginx/conf/</code> ç›®å½•ä¸‹ï¼Œç„¶è€Œ <code>certbot</code> é»˜è®¤åœ¨æ‰«æ <code>/etc/nginx/nginx.conf</code> æ–‡ä»¶ï¼Œæ•…è€Œæ‰¾ä¸åˆ° nginx çš„é…ç½®æ–‡ä»¶</p><p>è§£å†³æ–¹æ¡ˆï¼šæŒ‡å®š nginx çš„é…ç½®ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span> --nginx-server-root<span class="token operator">=</span>/www/server/nginx/conf/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼Œä¾ç„¶è¿˜æ˜¯æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">An unexpected error occurred:TypeError: from_buffer<span class="token punctuation">(</span><span class="token punctuation">)</span> cannot <span class="token builtin class-name">return</span> the address of the raw string within a str or unicode or bytearray object<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0b79353af7a03ea3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>è§£å†³æ–¹æ¡ˆï¼šæ›´æ–° cffi åŒ…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> cffi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®‰è£…å®Œæ¯•ä¹‹åï¼Œå†æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span> --nginx-server-root<span class="token operator">=</span>/www/server/nginx/conf/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-41ff13f2b481d3c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5a8be80376cba339.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>å‘ç°è¿˜æ˜¯æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">An unexpected error occurred:UnicodeEncodeError: <span class="token string">'ascii'</span> codec can't encode characters <span class="token keyword">in</span> position <span class="token number">310</span>-328: ordinal not <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å…³äº ascii æŠ¥é”™ï¼Œè¿™ç¯‡æ–‡ç« æœ‰è¯¦ç»†çš„ä»‹ç» <a href="https://xueyuanjun.com/post/9695">é€šè¿‡ Certbot å®‰è£… Letâ€™s Encrypt è¯ä¹¦ï¼Œæ¥å®ç°å…¨ç«™çš„ HTTPS è®¿é—®</a></p><p>è§£å†³æ–¹æ¡ˆæ˜¯ï¼šæ£€æŸ¥ä½ é€‰æ‹©çš„éœ€è¦é…ç½®çš„ nginx é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å«æœ‰ä¸­æ–‡ï¼Œå°†æ‰€æœ‰çš„ä¸­æ–‡å»æ‰å°±å¥½äº†</p><p>å»æ‰ä¹‹åï¼Œå†æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot <span class="token parameter variable">--nginx</span> --nginx-server-root<span class="token operator">=</span>/www/server/nginx/conf/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f400a34f94d751c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>å¤§åŠŸå‘Šæˆï¼</p><h3 id="å¯¹æ¯”ä¸€ä¸‹æ²¡æœ‰é…ç½®-ssl-ä¹‹å‰çš„-nginx-é…ç½®"><a href="#å¯¹æ¯”ä¸€ä¸‹æ²¡æœ‰é…ç½®-ssl-ä¹‹å‰çš„-nginx-é…ç½®" class="headerlink" title="å¯¹æ¯”ä¸€ä¸‹æ²¡æœ‰é…ç½® ssl ä¹‹å‰çš„ nginx é…ç½®"></a>å¯¹æ¯”ä¸€ä¸‹æ²¡æœ‰é…ç½® ssl ä¹‹å‰çš„ nginx é…ç½®</h3><p>æ²¡æœ‰é…ç½® ssl ä¹‹å‰çš„ nginx ä¿¡æ¯</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">server_name</span> www.pudongping.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm default.php default.htm default.html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">root</span> /www/wwwroot/www.pudongping.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> ~ ^/(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md)</span>    <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½® ssl ä¹‹åçš„é…ç½®ä¿¡æ¯ ï¼ˆç°åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé»˜è®¤å¼ºåˆ¶æ€§é‡å®šå‘äº† httpsï¼‰</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">server_name</span> www.pudongping.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm default.php default.htm default.html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">root</span> /www/wwwroot/www.pudongping.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> ~ ^/(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md)</span>    <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/letsencrypt/live/www.pudongping.com/fullchain.pem</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/letsencrypt/live/www.pudongping.com/privkey.pem</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>    <span class="token directive"><span class="token keyword">include</span> /etc/letsencrypt/options-ssl-nginx.conf</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>    <span class="token directive"><span class="token keyword">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span><span class="token punctuation">}</span><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$host</span> = www.pudongping.com)</span> <span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token comment"># managed by Certbot</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span> www.pudongping.com</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªåŠ¨æ›´æ–°è¯ä¹¦"><a href="#è‡ªåŠ¨æ›´æ–°è¯ä¹¦" class="headerlink" title="è‡ªåŠ¨æ›´æ–°è¯ä¹¦"></a>è‡ªåŠ¨æ›´æ–°è¯ä¹¦</h3><p>ç”±äº Letâ€™s Encrypt é»˜è®¤çš„æœ‰æ•ˆæœŸæ˜¯ 90 å¤©ï¼Œæ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒé•¿æœŸæä¾›æœåŠ¡ï¼Œè¿˜è¦åœ¨è¯ä¹¦åˆ°æœŸä¹‹åæ›´æ–°è¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>certbot renew</code> å‘½ä»¤æ¥æ›´æ–°è¯ä¹¦ï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥æµ‹è¯•è¯¥å‘½ä»¤æ˜¯å¦ç”Ÿæ•ˆï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> certbot renew --dry-run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœåœ¨è¾“å‡ºä¸­çœ‹åˆ°å¦‚ä¸‹å­—æ ·ï¼Œåˆ™è¡¨ç¤ºç”Ÿæ•ˆï¼š</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2da74afeee104f94.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Congratulations"></p><p>å½“ç„¶ï¼ŒçœŸå®ç¯å¢ƒä¸­é€šè¿‡æ‰‹åŠ¨ç»´æŠ¤æ˜¯ä¸ç°å®çš„ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Crontab æ¥ç¼–å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯ä¸ªæœˆéƒ½å¼ºåˆ¶æ›´æ–°ä¸€ä¸ªè¿™ä¸ªè¯ä¹¦ï¼Œç„¶åé‡å¯ Nginxï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> * * certbot renew<span class="token number">5</span> <span class="token number">0</span> <span class="token number">1</span> * * <span class="token function">service</span> nginx restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ç›´æ¥æ‰§è¡Œå®˜æ–¹æä¾›çš„å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random() * 3600)' &amp;&amp; certbot renew -q"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/crontab <span class="token operator">&gt;</span> /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å…³äºç›®å½•"><a href="#å…³äºç›®å½•" class="headerlink" title="å…³äºç›®å½•"></a>å…³äºç›®å½•</h3><ul><li>Certbot çš„é…ç½®æ–‡ä»¶ç›®å½•åœ¨ <code>/etc/letsencrypt</code></li><li>Certbot çš„ log é¢„è®¾è·¯å¾„åœ¨ <code>/var/log/letsencrypt</code></li><li>ç½‘ç«™å¯¹åº”çš„ <code>.pem </code> æ–‡ä»¶è·¯å¾„åœ¨ <code>/etc/letsencrypt/live/ç½‘ç«™åç§°/privkey.pem</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> æœåŠ¡å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Linux </tag>
            
            <tag> å…è´¹ HTTPS è¯ä¹¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ngrok å†…ç½‘ç©¿é€ç¥å™¨</title>
      <link href="posts/5bd7101b.html"/>
      <url>posts/5bd7101b.html</url>
      
        <content type="html"><![CDATA[<h1 id="Ngrok-çš„ä½¿ç”¨"><a href="#Ngrok-çš„ä½¿ç”¨" class="headerlink" title="Ngrok çš„ä½¿ç”¨"></a>Ngrok çš„ä½¿ç”¨</h1><ul><li><a href="https://dashboard.ngrok.com/user/signup">ngrok æ³¨å†Œåœ°å€</a></li><li><a href="https://dashboard.ngrok.com/get-started/setup">ngrok å®‰è£…æ–¹æ³•</a> è¿™é‡Œæˆ‘æ˜¯ç›´æ¥ä½¿ç”¨çš„ GitHub è´¦å·æ³¨å†Œçš„ã€‚</li></ul><h2 id="ngrok-å®‰è£…æ–¹æ³•"><a href="#ngrok-å®‰è£…æ–¹æ³•" class="headerlink" title="ngrok å®‰è£…æ–¹æ³•"></a>ngrok å®‰è£…æ–¹æ³•</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½ zip å®‰è£…åŒ…ï¼ˆè¿™é‡Œæˆ‘æ˜¯ mac ç¯å¢ƒï¼Œå› æ­¤ä¸‹è½½çš„ä¸º mac ç‰ˆæœ¬çš„è½¯ä»¶ï¼Œå…¶ä»–ç¯å¢ƒéœ€è¦ä¸‹è½½å¯¹åº”ç¯å¢ƒç‰ˆæœ¬çš„è½¯ä»¶ï¼‰</span><span class="token function">wget</span> https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-darwin-amd64.zip<span class="token comment"># è§£å‹ zip åŒ…</span><span class="token function">unzip</span> ngrok-stable-darwin-amd64.zip<span class="token comment"># å°†è§£å‹åçš„æ‰§è¡Œæ–‡ä»¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­</span><span class="token function">mv</span> ./ngrok /usr/local/bin<span class="token comment"># æµ‹è¯•ç¯å¢ƒå˜é‡æ˜¯å¦æ·»åŠ æˆåŠŸ</span>ngrok <span class="token builtin class-name">help</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ngrok-ä½¿ç”¨æ–¹æ³•"><a href="#ngrok-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ngrok ä½¿ç”¨æ–¹æ³•"></a>ngrok ä½¿ç”¨æ–¹æ³•</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½® authtoken</span><span class="token comment"># æŸ¥çœ‹ä½ çš„ authtoken åœ°å€ä¸ºï¼šhttps://dashboard.ngrok.com/get-started/your-authtoken</span>ngrok authtoken <span class="token operator">&lt;</span>your-authtoken<span class="token operator">&gt;</span><span class="token comment"># æŸ¥çœ‹æ˜¯å¦å·²ç»è®¾ç½®å¥½äº†</span><span class="token function">cat</span> ~/.ngrok2/ngrok.yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¯åŠ¨-ngrok-å®¢æˆ·ç«¯"><a href="#å¯åŠ¨-ngrok-å®¢æˆ·ç«¯" class="headerlink" title="å¯åŠ¨ ngrok å®¢æˆ·ç«¯"></a>å¯åŠ¨ ngrok å®¢æˆ·ç«¯</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ngrok http -host-header<span class="token operator">=</span>larablog.test <span class="token parameter variable">-region</span> us <span class="token number">80</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><code>http</code> ä»£è¡¨æˆ‘ä»¬è¦æ˜ å°„çš„æ˜¯ http åè®®</li><li><code>-host-header</code> ä»£è¡¨æœ¬åœ°ç«™ç‚¹çš„åŸŸå</li><li><code>- region us</code> ä»£è¡¨æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯ç¾å›½çš„å…¬å…±èŠ‚ç‚¹ï¼Œau =&gt; æ¾³å¤§åˆ©äºšï¼Œeu =&gt; æ¬§æ´²</li><li><code>80</code> ä»£è¡¨æ˜ å°„åˆ°æˆ‘ä»¬æœ¬æœºçš„ 80 ç«¯å£</li></ul><p>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åï¼Œä¼šå‡ºç°å¦‚ä¸‹å†…å®¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Session Status                onlineAccount                       pudongping <span class="token punctuation">(</span>Plan: Free<span class="token punctuation">)</span>Version                       <span class="token number">2.3</span>.37Region                        Europe <span class="token punctuation">(</span>eu<span class="token punctuation">)</span>Web Interface                 http://127.0.0.1:4040Forwarding                    http://fff1bccb7070.eu.ngrok.io -<span class="token operator">&gt;</span> http://localhost:80Forwarding                    https://fff1bccb7070.eu.ngrok.io -<span class="token operator">&gt;</span> http://localhost:80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>Forwarding</code> ä»£è¡¨ ngrok åˆ†é…ç»™ä½ çš„åŸŸåï¼Œå¯¹äºå…è´¹è´¦å·æ¥è¯´ï¼Œæ¯æ¬¡å¯åŠ¨ ngrok éƒ½ä¼šé‡æ–°åˆ†é…ä¸€ä¸ªéšæœºçš„åŸŸåï¼Œæ— æ³•å›ºå®š</li><li><code>Web Interface</code> æ˜¯ ngrok å†…ç½®çš„ä¸€ä¸ªç®¡ç†é¢æ¿ï¼Œå®ƒå¯ä»¥å±•ç¤ºæ‰€æœ‰é€šè¿‡ ngrok è¿›æ¥çš„è¯·æ±‚ä¿¡æ¯ä»¥åŠè¿”å›çš„æ•°æ®</li></ul><p>æ­¤æ—¶å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://fff1bccb7070.eu.ngrok.io</code> å³å¯çœ‹åˆ°å’Œè®¿é—® <code>larablog.test</code> æ˜¯ä¸€æ ·çš„å†…å®¹ï¼Œæ­¤å¤–è¿˜å¯ä»¥æ‰“å¼€ <code>http://127.0.0.1:4040</code> ngrok é¢æ¿æŸ¥çœ‹è¯·æ±‚ä¿¡æ¯</p>]]></content>
      
      
      <categories>
          
          <category> Ngrok </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘ç©¿é€ </tag>
            
            <tag> æœ¬åœ°è°ƒè¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RHEL 7 é‡ç½® root å¯†ç </title>
      <link href="posts/f41190ff.html"/>
      <url>posts/f41190ff.html</url>
      
        <content type="html"><![CDATA[<h1 id="RHEL-7-é‡ç½®-root-å¯†ç "><a href="#RHEL-7-é‡ç½®-root-å¯†ç " class="headerlink" title="RHEL 7 é‡ç½® root å¯†ç "></a>RHEL 7 é‡ç½® root å¯†ç </h1><ul><li>æŸ¥çœ‹æ˜¯å¦ä¸º RHEL7 ç³»ç»Ÿ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</span><span class="token function">cat</span> /etc/redhat-release<span class="token comment"># å¦‚æœä¿¡æ¯ä¸ºä»¥ä¸‹å†…å®¹ï¼Œåˆ™å¯ä»¥é‡‡ç”¨æ­¤æ–¹æ³•é‡ç½® root å¯†ç </span>Red Hat Enterprise Linux Server release <span class="token number">7.0</span> <span class="token punctuation">(</span>Maipo<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é‡å¯ Linux ç³»ç»Ÿä¸»æœºï¼Œå¹¶å‡ºç°å¼•å¯¼ç•Œé¢æ—¶ï¼ŒæŒ‰ä¸‹é”®ç›˜ä¸Šçš„ <code>e</code> é”®è¿›å…¥å†…æ ¸ç¼–è¾‘ç•Œé¢</li></ul><p><img src="/medias/loading.gif" data-original="https://www.linuxprobe.com/wp-content/uploads/2015/02/%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%BC%80%E6%9C%BA%E5%90%8E%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%8A%E6%95%B2%E5%87%BB%E2%80%9Ce%E2%80%9D.png" alt="å›¾ç‰‡æ¥æºäº www.linuxprobe.com ç½‘ç«™"></p><ul><li>åœ¨ <code>linux16</code> å‚æ•°è¿™è¡Œçš„æœ€åé¢ï¼ˆå³<code>LANG=en_US.UTF-8</code>å°¾éƒ¨ï¼‰å…ˆæ•²ä¸€ä¸ª <code>ç©ºæ ¼</code> ç„¶åæ·»åŠ  <code>\rd.break</code> å‚æ•°ï¼Œç„¶åæŒ‰ä¸‹ <code>Ctrl + X</code> ç»„åˆé”®æ¥è¿è¡Œä¿®æ”¹è¿‡çš„å†…æ ¸ç¨‹åº</li></ul><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>é¡µé¢å†…å®¹ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ˜¾ç¤ºä¸å…¨çš„ï¼Œéœ€è¦æŒ‰ä½ä¸Šä¸‹ç®­å¤´æ»šåŠ¨ã€‚</li><li>æ·»åŠ  \rd.break å‚æ•°çš„æ—¶å€™ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨æ·»åŠ  â€˜\åæ–œæ â€™ ä½†æ˜¯å¿…é¡»è¦å…ˆåœ¨ linux16 æœ«å°¾å¤„æ•²å‡»ä¸€ä¸ªç©ºæ ¼ä¹‹åå†™å…¥ rd.break å‚æ•°</li></ol></blockquote><p><img src="/medias/loading.gif" data-original="https://www.linuxprobe.com/wp-content/uploads/2015/02/%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E5%9C%A8linux16%E8%BF%99%E8%A1%8C%E7%9A%84%E5%90%8E%E9%9D%A2%E8%BE%93%E5%85%A5%E2%80%9Crd.break%E2%80%9D%E5%B9%B6%E6%95%B2%E5%87%BB%E2%80%9Cctrl-x%E2%80%9C.png" alt="å›¾ç‰‡æ¥æºäº www.linuxprobe.com ç½‘ç«™"></p><ul><li>ç¨åå³å¯è¿›å…¥ç³»ç»Ÿçš„ç´§æ€¥æ•‘æ´æ¨¡å¼</li></ul><p><img src="/medias/loading.gif" data-original="https://www.linuxprobe.com/wp-content/uploads/2015/02/%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E8%BF%9B%E5%85%A5%E5%88%B0%E4%BA%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%B4%A7%E6%80%A5%E6%B1%82%E6%8F%B4%E6%A8%A1%E5%BC%8F.png" alt="å›¾ç‰‡æ¥æºäº www.linuxprobe.com ç½‘ç«™"></p><ul><li>ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç­‰å¾…ç³»ç»Ÿé‡å¯æ“ä½œå®Œæ¯•ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨æ–°å¯†ç æ¥ç™»å½• Linux ç³»ç»Ÿäº†ã€‚</li></ul><ol><li>ä»¥å¯è¯»å†™çš„æƒé™é‡æ–°æŒ‚è½½ç¡¬ç›˜ä¸ŠçœŸå®ç³»ç»Ÿæ ¹ç›®å½•ï¼ˆ /sysroot ï¼‰ç›®å½•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># -o remountï¼šå°†ä¸€ä¸ªå·²ç»æŒ‚ä¸‹çš„æ¡£æ¡ˆç³»ç»Ÿé‡æ–°ç”¨ä¸åŒçš„æ–¹å¼æŒ‚ä¸Šã€‚</span><span class="token comment"># ä¾‹å¦‚åŸå…ˆæ˜¯å”¯è¯»çš„ç³»ç»Ÿï¼Œç°åœ¨ç”¨å¯è¯»å†™çš„æ¨¡å¼é‡æ–°æŒ‚ä¸Šã€‚</span><span class="token comment"># -o rwï¼šç”¨å¯è¯»å†™æ¨¡å¼æŒ‚ä¸Šã€‚</span><span class="token comment"># å¯ä»¥åˆå¹¶å‚æ•°å†™ï¼Œå³ mount -o remount,rw</span><span class="token function">mount</span> <span class="token parameter variable">-o</span> remount,rw / /sysroot<span class="token comment"># åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥å†™æˆè¿™æ · ï¼ˆç›´æ¥çœç•¥æ‰æ ¹ç›®å½• / ï¼‰</span><span class="token function">mount</span> <span class="token parameter variable">-o</span> remount,rw /sysroot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æŠŠç¯å¢ƒåˆ‡æ¢åˆ°çœŸå®ç³»ç»Ÿæ ¹ç›®å½• /sysroot</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chroot</span> /sysroot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>ä¿®æ”¹ root è´¦æˆ·å¯†ç </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¾“å…¥ passwd å‘½ä»¤æ—¶ï¼Œæ˜¯äº¤äº’å¼ç•Œé¢ã€‚  </span><span class="token comment"># åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥ echo "redhat" | passwd --stdin root å‘½ä»¤ï¼Œç›´æ¥å°† root å¯†ç ï¼Œä¿®æ”¹ä¸º redhat</span><span class="token function">passwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å‘Šè¯‰ç³»ç»Ÿä¸‹æ¬¡å¯åŠ¨å°†å¯¹æ–‡ä»¶è¿›è¡Œ selinux ä¸Šä¸‹æ–‡é‡æ–°æ‰“æ ‡ã€‚è¿™ä¹Ÿå°±é€ æˆäº†ä¸‹æ¬¡é‡å¯çš„æ—¶å€™æ—¶é—´ä¼šå¾ˆé•¿ï¼Œautorelabel æ˜¯ä¸€ä¸ªéšè—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å‰é¢æœ‰ä¸€ä¸ªç‚¹</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> /.autorelabel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>é€€å‡ºçœŸå®ç³»ç»Ÿæ ¹ç›®å½•ç¯å¢ƒ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>é‡å¯ç³»ç»Ÿ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://www.linuxprobe.com/wp-content/uploads/2015/02/%E7%AC%AC4%E6%AD%A5%EF%BC%9A%E4%BE%9D%E6%AC%A1%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4.png"></p><ul><li>ä¿®æ”¹å¯†ç åï¼Œé¦–æ¬¡é‡å¯çš„æ—¶é—´å°†ä¼šæ¯”è¾ƒé•¿ï¼Œå› ä¸ºç³»ç»Ÿå°†å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œ SeLinux æ‰“æ ‡ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œæ•´ä¸ªè¿‡ç¨‹å¹¶éæ­»æœºï¼Œè¯·å‹¿åœ¨æ‰“æ ‡è¿‡ç¨‹ä¸­æ‰‹åŠ¨å¼ºåˆ¶å†æ¬¡é‡å¯ï¼Œå¦åˆ™ç³»ç»Ÿå°†ä¼šæ°¸ä¹…æ€§æŸåå¯¼è‡´æ— æ³•å¼€æœºã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hyperf ä½¿ç”¨æ¨¡å‹å†™è¾ƒä¸ºå¤æ‚ union å­æŸ¥è¯¢å¹¶åšåˆ†é¡µ</title>
      <link href="posts/7dec67c2.html"/>
      <url>posts/7dec67c2.html</url>
      
        <content type="html"><![CDATA[<h1 id="hyperf-ä½¿ç”¨æ¨¡å‹å†™-union-å­æŸ¥è¯¢å¹¶åšåˆ†é¡µ"><a href="#hyperf-ä½¿ç”¨æ¨¡å‹å†™-union-å­æŸ¥è¯¢å¹¶åšåˆ†é¡µ" class="headerlink" title="hyperf ä½¿ç”¨æ¨¡å‹å†™ union å­æŸ¥è¯¢å¹¶åšåˆ†é¡µ"></a>hyperf ä½¿ç”¨æ¨¡å‹å†™ union å­æŸ¥è¯¢å¹¶åšåˆ†é¡µ</h1><h2 id="æœ€ç»ˆéœ€è¦å®ç°çš„-sql-è¯­å¥ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#æœ€ç»ˆéœ€è¦å®ç°çš„-sql-è¯­å¥ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="æœ€ç»ˆéœ€è¦å®ç°çš„ sql è¯­å¥ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š"></a>æœ€ç»ˆéœ€è¦å®ç°çš„ sql è¯­å¥ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span><span class="token identifier"><span class="token punctuation">`</span>dfo_al<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>log_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>change_time<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>pay_points<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>change_type<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>u_user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>head_pic<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>vip_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>dfo_users<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span><span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">3649</span> <span class="token operator">AND</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>pay_points<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token operator">OR</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">UNION</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>log_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>change_time<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>pay_points<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>change_type<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>u_user_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>head_pic<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>vip_time<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>dfo_users<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>u<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span><span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">3649</span> <span class="token operator">AND</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>pay_points<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">OR</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>from_user_id<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> dfo_al <span class="token keyword">ORDER</span> <span class="token keyword">BY</span><span class="token identifier"><span class="token punctuation">`</span>log_id<span class="token punctuation">`</span></span> <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">2</span> <span class="token keyword">OFFSET</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="hyperf-ä»£ç ä¸º"><a href="#hyperf-ä»£ç ä¸º" class="headerlink" title="hyperf ä»£ç ä¸º"></a>hyperf ä»£ç ä¸º</h2><blockquote><p>ä»¥ä¸‹ä»£ç ä»…ä¸ºç¤ºä¾‹ä»£ç ï¼Œä»…æä¾›å‚è€ƒä½¿ç”¨ï¼Œå…·ä½“å®ç°è¯·æ ¹æ®ä½ è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å®ç°ã€‚</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token string single-quoted-string">'a.user_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">user_id</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string single-quoted-string">'a.pay_points'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$fields</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'a.log_id'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'a.change_time'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'a.user_id'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'a.pay_points'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'a.change_type'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'a.from_user_id'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'u.user_id AS u_user_id'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'u.username'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'u.head_pic'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'u.vip_time'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$table1</span> <span class="token operator">=</span> <span class="token class-name static-context">AccountLog</span><span class="token operator">::</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'account_log as a'</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users as u'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'a.user_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'u.user_id'</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$fields</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">whereNull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a.from_user_id'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a.from_user_id'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table2</span> <span class="token operator">=</span> <span class="token class-name static-context">AccountLog</span><span class="token operator">::</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'account_log as a'</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users as u'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'a.from_user_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'u.user_id'</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$fields</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">whereNotNull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a.from_user_id'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a.from_user_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$table1</span><span class="token operator">-&gt;</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token variable">$table2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tablePrefix</span> <span class="token operator">=</span> <span class="token class-name static-context">Db</span><span class="token operator">::</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTablePrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–æ•°æ®è¡¨å‰ç¼€ =&gt; æˆ–è€…ä½¿ç”¨  $tablePrefix = Db::getConfig('prefix'); éƒ½å¯ä»¥</span><span class="token variable">$model</span> <span class="token operator">=</span> <span class="token class-name static-context">AccountLog</span><span class="token operator">::</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">mergeBindings</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'al.*'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name static-context">Db</span><span class="token operator">::</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"(<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">toSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>) as <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$tablePrefix</span><span class="token punctuation">}</span></span>"</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'al'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'log_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'desc'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperf </tag>
            
            <tag> Swoole </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é’ˆå¯¹ hyperf æ¡†æ¶å®ç°ç®€å•é™æµå™¨ï¼Œç±»ä¼¼ laravel æ¡†æ¶ throttle ä¸­é—´ä»¶åŠŸèƒ½</title>
      <link href="posts/f2f7e2ee.html"/>
      <url>posts/f2f7e2ee.html</url>
      
        <content type="html"><![CDATA[<h1 id="é’ˆå¯¹-hyperf-æ¡†æ¶å®ç°ç®€å•é™æµå™¨ï¼Œç±»ä¼¼-laravel-æ¡†æ¶-throttle-ä¸­é—´ä»¶åŠŸèƒ½"><a href="#é’ˆå¯¹-hyperf-æ¡†æ¶å®ç°ç®€å•é™æµå™¨ï¼Œç±»ä¼¼-laravel-æ¡†æ¶-throttle-ä¸­é—´ä»¶åŠŸèƒ½" class="headerlink" title="é’ˆå¯¹ hyperf æ¡†æ¶å®ç°ç®€å•é™æµå™¨ï¼Œç±»ä¼¼ laravel æ¡†æ¶ throttle ä¸­é—´ä»¶åŠŸèƒ½"></a>é’ˆå¯¹ hyperf æ¡†æ¶å®ç°ç®€å•é™æµå™¨ï¼Œç±»ä¼¼ laravel æ¡†æ¶ throttle ä¸­é—´ä»¶åŠŸèƒ½</h1><p><strong>æ³¨æ„</strong>ï¼šä»¥ä¸‹åŠŸèƒ½å·²ç»å•ç‹¬è¿ç§»åˆ° <a href="https://github.com/pudongping/hyperf-throttle-requests">pudongping/hyperf-throttle-requests</a> æ’ä»¶åŒ…ä¸­ï¼Œå¹¶æ”¯æŒäº† hyperf 2.2 å’Œ 3.0 ç‰ˆæœ¬ã€‚</p><h2 id="é™æµå™¨çš„æ¦‚å¿µ"><a href="#é™æµå™¨çš„æ¦‚å¿µ" class="headerlink" title="é™æµå™¨çš„æ¦‚å¿µ"></a>é™æµå™¨çš„æ¦‚å¿µ</h2><p>æ‰€è°“é™æµå™¨ï¼ŒæŒ‡çš„æ˜¯é™åˆ¶è®¿é—®æŒ‡å®šæœåŠ¡/è·¯ç”±çš„æµé‡ï¼Œé€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯é™åˆ¶å•ä½æ—¶é—´å†…è®¿é—®æŒ‡å®šæœåŠ¡/è·¯ç”±çš„æ¬¡æ•°ï¼ˆé¢‘ç‡ï¼‰ï¼Œ<br>ä»ç³»ç»Ÿæ¶æ„è§’åº¦çœ‹ï¼Œé€šè¿‡é™æµå™¨å¯ä»¥æœ‰æ•ˆé¿å…çŸ­æ—¶é—´å†…çš„å¼‚å¸¸é«˜å¹¶å‘è¯·æ±‚å¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ç›®çš„ï¼Œ<br>å¦å¤–å¯¹äºä¸€äº›æ—¥å¸¸çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é™æµå™¨é¿å…åƒåœ¾æµé‡ï¼Œæ¯”å¦‚å‘é€çŸ­ä¿¡æœåŠ¡ã€ç”¨æˆ·æ³¨å†Œã€æ–‡ç« å‘å¸ƒã€ç”¨æˆ·è¯„è®ºç­‰ï¼Œ<br>é€šè¿‡é™æµå¯ä»¥æœ‰æ•ˆé˜»æ­¢åƒåœ¾ç”¨æˆ·çš„æ‰¹é‡æ³¨å†Œå’Œå‘å¸ƒã€‚</p><h2 id="ç®€å•å®ç°æ–¹æ¡ˆ"><a href="#ç®€å•å®ç°æ–¹æ¡ˆ" class="headerlink" title="ç®€å•å®ç°æ–¹æ¡ˆ"></a>ç®€å•å®ç°æ–¹æ¡ˆ</h2><blockquote><p>è¿™é‡Œé‡‡ç”¨äº† <code>redis</code> ä½œä¸ºå­˜å‚¨å™¨ï¼Œä»¥ä¸‹å†…å®¹å…¨éƒ¨åŸºäº <code>redis</code> è€Œè¨€ã€‚</p></blockquote><ul><li>é€šè¿‡ <code>setex</code> æŒ‡ä»¤åˆå§‹åŒ–é™æµå™¨çš„é”®ï¼ˆåŸºäºç”¨æˆ· IDã€IP åœ°å€ç­‰æ ‡è¯†æ¥æºçš„å˜é‡è¿›è¡Œæ‹¼æ¥ï¼‰ã€å¹¶è®¾ç½®æœ‰æ•ˆæœŸï¼ˆä½œä¸ºä¸€ä¸ªè®¡æ—¶å™¨ï¼‰ï¼›</li><li>é¦–æ¬¡è®¿é—®æŸä¸ªæœåŠ¡/è·¯ç”±æ—¶ï¼Œé€šè¿‡ <code>increment</code> æŒ‡ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ç»Ÿè®¡é”®å€¼å¯¹ï¼ˆä½œä¸ºä¸€ä¸ªè®¡æ•°å™¨ï¼‰ï¼Œåç»­åœ¨è®¡æ—¶å™¨æœ‰æ•ˆæœŸå†…è®¿é—®åŒä¸€ä¸ªæœåŠ¡/è·¯ç”±ï¼Œé€šè¿‡ <code>increment</code> æŒ‡ä»¤å¯¹é”®å€¼åšè‡ªå¢æ“ä½œï¼›</li><li>å½“è¯¥æœåŠ¡/è·¯ç”±çš„è®¿é—®æ¬¡æ•°è¶…è¿‡é™æµå™¨è®¾ç½®çš„è®¿é—®ä¸Šé™ï¼Œåˆ™æ‹’ç»åç»­è®¿é—®ã€‚</li></ul><h2 id="æ³¨æ„-âš ï¸"><a href="#æ³¨æ„-âš ï¸" class="headerlink" title="æ³¨æ„ âš ï¸"></a>æ³¨æ„ âš ï¸</h2><blockquote><p>ä»¥ä¸‹åŠŸèƒ½å®ç°ä»£ç ä¸­ä½¿ç”¨åˆ°äº†å¾ˆå¤šåŠ©æ‰‹å‡½æ•°ï¼Œå»ºè®®é¦–å…ˆå‚è€ƒæˆ‘çš„ <a href="https://pudongping.github.io/posts/79e7b1a4.html">hyperf æ¡†æ¶å¸¸ç”¨çš„åŠ©æ‰‹å‡½æ•°</a> ä¸€æ–‡ï¼ŒæŸ¥çœ‹å…·ä½“çš„åŠ©æ‰‹å‡½æ•°ã€‚<br>å…¶ä¸­ <code>auth()</code> æ–¹æ³•ä¸ºè·å–å½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p></blockquote><h2 id="Talk-is-cheap-show-me-the-code-ğŸ˜œ"><a href="#Talk-is-cheap-show-me-the-code-ğŸ˜œ" class="headerlink" title="Talk is cheap, show me the code. ğŸ˜œ"></a>Talk is cheap, show me the code. ğŸ˜œ</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * èŠ‚æµå¤„ç† * ç”¨é€”ï¼šé™åˆ¶è®¿é—®é¢‘ç‡ * åšæ³•ï¼šé™åˆ¶å•ä½æ—¶é—´å†…è®¿é—®æŒ‡å®šæœåŠ¡/è·¯ç”±çš„æ¬¡æ•°ï¼ˆé¢‘ç‡ï¼‰ */</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Helper</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ResponseInterface</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Utils<span class="token punctuation">\</span>Context</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ApiException</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Constants<span class="token punctuation">\</span>ErrorCode</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ThrottleRequestsHelper</span><span class="token punctuation">{</span>    <span class="token comment">/**     * ç”¨äºåšè®¡æ—¶å™¨çš„ç¼“å­˜keyåç¼€     *     * @var string     */</span>    <span class="token keyword">protected</span> <span class="token variable">$keySuffix</span> <span class="token operator">=</span> <span class="token string single-quoted-string">':timer'</span><span class="token punctuation">;</span>    <span class="token comment">/**     * å¤„ç†èŠ‚æµ     *     * @param int $maxAttempts  åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°     * @param int $decaySeconds  å•ä½æ—¶é—´ï¼ˆsï¼‰     * @param string $prefix  è®¡æ•°å™¨ç¼“å­˜keyå‰ç¼€     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$maxAttempts</span> <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$decaySeconds</span> <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$prefix</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'dfo:throttle'</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$prefix</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveRequestSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®¡æ•°å™¨çš„ç¼“å­˜key</span>        <span class="token comment">// å•ä½æ—¶é—´å†…å·²ç»è¶…è¿‡äº†è®¿é—®æ¬¡æ•°æ—¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">tooManyAttempts</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">buildException</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">hit</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$decaySeconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç”Ÿæˆç¼“å­˜ key     *     * @return string     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">resolveRequestSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'|'</span> <span class="token operator">.</span> <span class="token function">getClientIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$str</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'|'</span> <span class="token operator">.</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åœ¨æŒ‡å®šæ—¶é—´å†…å¢åŠ æŒ‡å®šé”®çš„è®¡æ•°å™¨     *     * @param string $key  è®¡æ•°å™¨çš„ç¼“å­˜key     * @param int $decaySeconds  æŒ‡å®šæ—¶é—´ï¼ˆSï¼‰     * @return int  è®¡æ•°å™¨å…·ä½“å¢åŠ åˆ°å¤šå°‘å€¼     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">hit</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$decaySeconds</span> <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span>    <span class="token punctuation">{</span>        <span class="token variable">$timerKey</span> <span class="token operator">=</span> <span class="token variable">$key</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">keySuffix</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡æ—¶å™¨çš„æœ‰æ•ˆæœŸæ—¶é—´æˆ³</span>        <span class="token variable">$expirationTime</span> <span class="token operator">=</span> <span class="token class-name static-context">Carbon</span><span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addRealSeconds</span><span class="token punctuation">(</span><span class="token variable">$decaySeconds</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡æ—¶å™¨</span>        <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$timerKey</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$expirationTime</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'EX'</span> <span class="token operator">=&gt;</span> <span class="token variable">$decaySeconds</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'NX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡æ•°å™¨</span>        <span class="token variable">$added</span> <span class="token operator">=</span> <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'EX'</span> <span class="token operator">=&gt;</span> <span class="token variable">$decaySeconds</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'NX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è‡ªå¢ï¼ˆè¿”å›å¢åŠ åˆ°å¤šå°‘çš„å…·ä½“æ•°å­—ï¼‰</span>        <span class="token variable">$hits</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$added</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$hits</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è¯æ˜æ˜¯åˆå§‹åŒ–</span>            <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span> <span class="token variable">$decaySeconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$hits</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦å·²ç»è¾¾åˆ°äº†ä¸´ç•Œå€¼     *     * @param string $key  è®¡æ•°å™¨çš„ç¼“å­˜key     * @param int $maxAttempts  åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°     * @return bool     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">tooManyAttempts</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// è·å–è®¡æ•°å™¨çš„å€¼ï¼Œå¦‚æœè®¡æ•°å™¨ä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–è®¡æ•°å™¨çš„å€¼ä¸º 0</span>        <span class="token comment">// è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®æ—¶ï¼Œä¼šç›´æ¥è¿”å› false</span>        <span class="token variable">$counterNumber</span> <span class="token operator">=</span> <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­è®¡æ—¶å™¨æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœè®¡æ—¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™å¯¹åº”çš„è®¡æ•°å™¨æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ï¼ˆå­˜åœ¨è¿‡å¤šçš„è®¡æ•°å™¨ä¼šå ç”¨ redis ç©ºé—´ï¼‰</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token variable">$key</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">keySuffix</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// å­˜åœ¨ç¼“å­˜keyæ—¶è¿”å› int =&gt; 1ï¼Œä¸å­˜åœ¨æ—¶è¿”å› int =&gt; 0</span>            <span class="token comment">// æœ‰è¯¥é”®åä¸”åˆ é™¤æˆåŠŸè¿”å› int =&gt; 1ï¼Œæ— è¯¥é”®åæ—¶è¿”å› int =&gt; 0</span>            <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åˆ é™¤è®¡æ•°å™¨ç¼“å­˜ï¼Œé˜²æ­¢è®¡æ—¶å™¨å¤±æ•ˆåï¼Œä¸‹ä¸€æ¬¡ç”¨æˆ·è®¿é—®æ—¶ä¸æ˜¯ä» 1 å¼€å§‹è®¡æ•°</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$counterNumber</span> <span class="token operator">&gt;=</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// åˆ¤æ–­è®¡æ•°å™¨åœ¨å•ä½æ—¶é—´å†…æ˜¯å¦è¾¾åˆ°äº†ä¸´ç•Œå€¼</span>                <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¶…è¿‡è®¿é—®æ¬¡æ•°é™åˆ¶æ—¶ï¼Œæ„å»ºå¼‚å¸¸ä¿¡æ¯     *     * @param string $key  è®¡æ•°å™¨çš„ç¼“å­˜key     * @param int $maxAttempts  åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°     * @return ApiException     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">buildException</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// è·ç¦»å…è®¸ä¸‹ä¸€æ¬¡è¯·æ±‚è¿˜æœ‰å¤šå°‘ç§’</span>        <span class="token variable">$retryAfter</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getTimeUntilNextRetry</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span> <span class="token variable">$retryAfter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 429 Too Many Requests</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span><span class="token class-name static-context">ErrorCode</span><span class="token operator">::</span><span class="token constant">REQUEST_FREQUENTLY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®è¿”å›å¤´æ•°æ®     *     * @param string $key  è®¡æ•°å™¨çš„ç¼“å­˜key     * @param int $maxAttempts  åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°     * @param int|null $retryAfter  è·ç¦»ä¸‹æ¬¡é‡è¯•è¯·æ±‚éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼ˆsï¼‰     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">setHeaders</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token keyword type-hint">int</span> <span class="token variable">$retryAfter</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// è®¾ç½®è¿”å›å¤´æ•°æ®</span>        <span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getHeaders</span><span class="token punctuation">(</span>            <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span>            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">calculateRemainingAttempts</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span> <span class="token variable">$retryAfter</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// è®¡ç®—å‰©ä½™è®¿é—®æ¬¡æ•°</span>            <span class="token variable">$retryAfter</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ·»åŠ è¿”å›å¤´æ•°æ®åˆ°è¯·æ±‚å¤´ä¸­</span>        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addHeaders</span><span class="token punctuation">(</span><span class="token variable">$headers</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–è¿”å›å¤´æ•°æ®     *     * @param int $maxAttempts  åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°     * @param int $remainingAttempts  åœ¨æŒ‡å®šæ—¶é—´æ®µå†…å‰©ä¸‹çš„è¯·æ±‚æ¬¡æ•°     * @param int|null $retryAfter  è·ç¦»ä¸‹æ¬¡é‡è¯•è¯·æ±‚éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼ˆsï¼‰     * @return int[]     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getHeaders</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$remainingAttempts</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token keyword type-hint">int</span> <span class="token variable">$retryAfter</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string single-quoted-string">'X-RateLimit-Limit'</span> <span class="token operator">=&gt;</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span>  <span class="token comment">// åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°</span>            <span class="token string single-quoted-string">'X-RateLimit-Remaining'</span> <span class="token operator">=&gt;</span> <span class="token variable">$remainingAttempts</span><span class="token punctuation">,</span>  <span class="token comment">// åœ¨æŒ‡å®šæ—¶é—´æ®µå†…å‰©ä¸‹çš„è¯·æ±‚æ¬¡æ•°</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$retryAfter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// åªæœ‰å½“ç”¨æˆ·è®¿é—®é¢‘æ¬¡è¶…è¿‡äº†æœ€å¤§é¢‘æ¬¡ä¹‹åæ‰ä¼šè¿”å›ä»¥ä¸‹ä¸¤ä¸ªè¿”å›å¤´å­—æ®µ</span>            <span class="token variable">$headers</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Retry-After'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$retryAfter</span><span class="token punctuation">;</span>  <span class="token comment">// è·ç¦»ä¸‹æ¬¡é‡è¯•è¯·æ±‚éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼ˆsï¼‰</span>            <span class="token variable">$headers</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'X-RateLimit-Reset'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name static-context">Carbon</span><span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addRealSeconds</span><span class="token punctuation">(</span><span class="token variable">$retryAfter</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·ç¦»ä¸‹æ¬¡é‡è¯•è¯·æ±‚éœ€è¦ç­‰å¾…çš„æ—¶é—´æˆ³ï¼ˆsï¼‰</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$headers</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ·»åŠ è¯·æ±‚å¤´æ•°æ®     *     * @param array $headers     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">addHeaders</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token class-name static-context">Context</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">ResponseInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$headers</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$header</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">withHeader</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$header</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name static-context">Context</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name static-context">ResponseInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¡ç®—è·ç¦»å…è®¸ä¸‹ä¸€æ¬¡è¯·æ±‚è¿˜æœ‰å¤šå°‘ç§’     *     * @param string $key     * @return false|int|mixed|string     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getTimeUntilNextRetry</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment">// åœ¨ $this-&gt;tooManyAttempts() æ–¹æ³•ä¸­å·²ç»åˆ¤æ–­äº†è®¡æ—¶å™¨çš„ç¼“å­˜ key æ˜¯å¦å­˜åœ¨ï¼Œå› æ­¤åœ¨è¿™é‡Œæ¯‹éœ€å†æ¬¡ç´¯èµ˜åˆ¤æ–­</span>        <span class="token comment">// è®¡æ—¶å™¨çš„æœ‰æ•ˆæœŸå‡å»å½“å‰æ—¶é—´æˆ³</span>        <span class="token keyword">return</span> <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">keySuffix</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name static-context">Carbon</span><span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¡ç®—å‰©ä½™è®¿é—®æ¬¡æ•°     *     * @param string $key è®¡æ•°å™¨çš„ç¼“å­˜key     * @param int $maxAttempts  åœ¨æŒ‡å®šæ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°     * @param int|null $retryAfter  è·ç¦»ä¸‹æ¬¡é‡è¯•è¯·æ±‚éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼ˆsï¼‰     * @return false|int|mixed|string     */</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">calculateRemainingAttempts</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$maxAttempts</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token keyword type-hint">int</span> <span class="token variable">$retryAfter</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$retryAfter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®æ—¶ï¼Œä¼šç›´æ¥è¿”å› false</span>            <span class="token variable">$counterNumber</span> <span class="token operator">=</span> <span class="token function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$maxAttempts</span> <span class="token operator">-</span> <span class="token variable">$counterNumber</span><span class="token punctuation">;</span>  <span class="token comment">// å‰©ä½™è®¿é—®æ¬¡æ•°</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperf </tag>
            
            <tag> Swoole </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hyperf æ¡†æ¶å¸¸ç”¨çš„åŠ©æ‰‹å‡½æ•°</title>
      <link href="posts/79e7b1a4.html"/>
      <url>posts/79e7b1a4.html</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹åˆ—å‡ºéƒ¨åˆ† hyperf å¸¸ç”¨çš„åŠ©æ‰‹å‡½æ•°</p><blockquote><p>å…¶ä¸­è¦æ˜¯æƒ³è·å–å½“å‰è¯·æ±‚çš„è·¯ç”±æ‰€å¯¹åº”çš„æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼Œè¯·ç›´æ¥è°ƒç”¨ <code>get_current_action()</code> æ–¹æ³•</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/** * è‡ªå®šä¹‰åŠ©æ‰‹å‡½æ•° */</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Utils<span class="token punctuation">\</span>ApplicationContext</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Redis<span class="token punctuation">\</span>Redis</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Contract<span class="token punctuation">\</span>StdoutLoggerInterface</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Logger<span class="token punctuation">\</span>LoggerFactory</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Contract<span class="token punctuation">\</span>RequestInterface</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Contract<span class="token punctuation">\</span>ResponseInterface</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>HttpServer<span class="token punctuation">\</span>Router<span class="token punctuation">\</span>Dispatched</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>ServerFactory</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Swoole<span class="token punctuation">\</span>Websocket<span class="token punctuation">\</span>Frame</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Swoole<span class="token punctuation">\</span>WebSocket<span class="token punctuation">\</span>Server</span> <span class="token keyword">as</span> WebSocketServer<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>SimpleCache<span class="token punctuation">\</span>CacheInterface</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * è·å–å®¹å™¨å¯¹è±¡     *     * @return \Psr\Container\ContainerInterface     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name static-context">ApplicationContext</span><span class="token operator">::</span><span class="token function">getContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     *  è·å– Redis åç¨‹å®¢æˆ·ç«¯     *     * @return Redis|mixed     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">Redis</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'std_out_log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ§åˆ¶å°æ—¥å¿—     *     * @return StdoutLoggerInterface|mixed     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">std_out_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">StdoutLoggerInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'logger'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ–‡ä»¶æ—¥å¿—     *     * @return \Psr\Log\LoggerInterface     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">LoggerFactory</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * request å®ä¾‹     *     * @return RequestInterface|mixed     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">RequestInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'response'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * response å®ä¾‹     *     * @return ResponseInterface|mixed     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">ResponseInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'server'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åŸºäº swoole server çš„ server å®ä¾‹     *     * @return \Swoole\Coroutine\Server|\Swoole\Server     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">server</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">ServerFactory</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'frame'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * websocket frame å®ä¾‹     *     * @return mixed|Frame     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">frame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">Frame</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'websocket'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * websocket å®ä¾‹     *     * @return mixed|WebSocketServer     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">websocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">WebSocketServer</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * ç®€å•çš„ç¼“å­˜å®ä¾‹     *     * @return mixed|CacheInterface     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name static-context">CacheInterface</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get_current_action'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * è·å–å½“å‰è¯·æ±‚çš„æ§åˆ¶å™¨å’Œæ–¹æ³•     *     * @return array     */</span>    <span class="token keyword">function</span> <span class="token function-definition function">get_current_action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span>    <span class="token punctuation">{</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name static-context">Dispatched</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">property_exists</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'handler'</span><span class="token punctuation">)</span>            <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token operator">-&gt;</span><span class="token property">handler</span><span class="token punctuation">)</span>            <span class="token operator">&amp;&amp;</span> <span class="token function">property_exists</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token operator">-&gt;</span><span class="token property">handler</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'callback'</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token variable">$obj</span><span class="token operator">-&gt;</span><span class="token property">handler</span><span class="token operator">-&gt;</span><span class="token property">callback</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'The route is undifined! Please check!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$errMsg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'The controller and method are not found! Please check!'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$action</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'::'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::'</span><span class="token punctuation">,</span> <span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'@'</span><span class="token punctuation">,</span> <span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$errMsg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">std_out_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$errMsg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$controller</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$errMsg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">std_out_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$errMsg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'controller'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'method'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperf </tag>
            
            <tag> Swoole </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨äºšé©¬é€Šäº‘ AWS é…ç½®æœåŠ¡å™¨å¹¶ä½¿ç”¨ xshell è¿œç¨‹è¿æ¥</title>
      <link href="posts/34efcb18.html"/>
      <url>posts/34efcb18.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨äºšé©¬é€Šäº‘-AWS-é…ç½®æœåŠ¡å™¨å¹¶ä½¿ç”¨-xshell-è¿œç¨‹è¿æ¥"><a href="#ä½¿ç”¨äºšé©¬é€Šäº‘-AWS-é…ç½®æœåŠ¡å™¨å¹¶ä½¿ç”¨-xshell-è¿œç¨‹è¿æ¥" class="headerlink" title="ä½¿ç”¨äºšé©¬é€Šäº‘ AWS é…ç½®æœåŠ¡å™¨å¹¶ä½¿ç”¨ xshell è¿œç¨‹è¿æ¥"></a>ä½¿ç”¨äºšé©¬é€Šäº‘ AWS é…ç½®æœåŠ¡å™¨å¹¶ä½¿ç”¨ xshell è¿œç¨‹è¿æ¥</h1><h2 id="å¦‚æœä¹‹å‰ä½¿ç”¨äºšé©¬é€Šäº‘é…ç½®æœåŠ¡å™¨æ²¡æœ‰é…ç½®æˆåŠŸï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼åˆ é™¤æ‰å®ä¾‹"><a href="#å¦‚æœä¹‹å‰ä½¿ç”¨äºšé©¬é€Šäº‘é…ç½®æœåŠ¡å™¨æ²¡æœ‰é…ç½®æˆåŠŸï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼åˆ é™¤æ‰å®ä¾‹" class="headerlink" title="å¦‚æœä¹‹å‰ä½¿ç”¨äºšé©¬é€Šäº‘é…ç½®æœåŠ¡å™¨æ²¡æœ‰é…ç½®æˆåŠŸï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼åˆ é™¤æ‰å®ä¾‹"></a>å¦‚æœä¹‹å‰ä½¿ç”¨äºšé©¬é€Šäº‘é…ç½®æœåŠ¡å™¨æ²¡æœ‰é…ç½®æˆåŠŸï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼åˆ é™¤æ‰å®ä¾‹</h2><ul><li><a href="https://us-east-2.console.aws.amazon.com/ec2/home?region=us-east-2#Instances:">æ‰“å¼€å½“å‰å®ä¾‹åˆ—è¡¨</a></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bd64bb68e37736b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½ è‡ªå·±çš„å®ä¾‹åˆ—è¡¨"></p><ul><li>ç»ˆæ­¢ä½ æƒ³è¦åˆ é™¤çš„å®ä¾‹ï¼ˆæˆ‘çœ‹æ–‡æ¡£è¯´çš„æ˜¯ï¼Œç»ˆæ­¢å®ä¾‹å…¶å®å°±è¡¨ç¤ºåˆ é™¤äº†å®ä¾‹ï¼Œç»ˆæ­¢å®ä¾‹ä¼šåˆ é™¤æ‰æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶ï¼Œä½†æ˜¯åœæ­¢å®ä¾‹ä¸ä¼šï¼‰</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fa7c851c14f1977f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»ˆæ­¢å®ä¾‹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-688dde3c0f03d746.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»ˆæ­¢å®ä¾‹ä¼šåˆ é™¤æ‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6d0c8540ccaaf4e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»ˆæ­¢åçš„çŠ¶æ€"></p><ul><li>å¦‚æœæƒ³å½»åº•åˆ é™¤æ‰å®ä¾‹ï¼Œè¿˜éœ€è¦åˆ é™¤æ‰ ã€Œå·ã€ï¼ˆä¸æ‰‹åŠ¨åˆ é™¤çš„è¯ï¼Œäºšé©¬é€Šäº‘ä¹Ÿä¼šè¿‡ä¸€æ®µæ—¶é—´è‡ªåŠ¨åˆ é™¤ï¼‰</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-16fbeb3feda581a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©å·ç»„"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8273f1d73ddf2641.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®ä¾‹åˆ—è¡¨ä¹Ÿä¼šè¿‡ä¸€æ®µæ—¶é—´è‡ªåŠ¨åˆ é™¤"></p><h2 id="æ¥ä¸‹æ¥å¼€å§‹é…ç½®æ–°çš„æœåŠ¡å™¨"><a href="#æ¥ä¸‹æ¥å¼€å§‹é…ç½®æ–°çš„æœåŠ¡å™¨" class="headerlink" title="æ¥ä¸‹æ¥å¼€å§‹é…ç½®æ–°çš„æœåŠ¡å™¨"></a>æ¥ä¸‹æ¥å¼€å§‹é…ç½®æ–°çš„æœåŠ¡å™¨</h2><ul><li><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-94887efe4899baba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç›´æ¥åœ¨å®ä¾‹æ§åˆ¶å°ä¸Šé¢å¯åŠ¨ä¸€ä¸ªæ–°çš„å®ä¾‹"></p></li><li><p>é…ç½®æœåŠ¡å™¨<br><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a0a7f77087175125.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŒ‰ç…§è¿™äº›æ­¥éª¤ä¸€æ­¥ä¸€æ­¥çš„æ¥ï¼Œé€‰æ‹©ä½ è‡ªå·±çš„è‡ªå®šä¹‰é…ç½®å°±å¯ä»¥äº†"></p></li><li><p>é€‰æ‹©ç¡¬ç›˜ç©ºé—´å¤§å°ï¼ˆæŒ‰éœ€é€‰æ‹©å°±å¥½ï¼Œå¦‚æœè¶…è¿‡äº†å¥—é¤å¤–çš„ç¡¬ç›˜ç©ºé—´ä¼šæ”¶è´¹ï¼Œå»ºè®®è¿˜æ˜¯å…ˆæ£€æŸ¥è‡ªå·±çš„å¥—é¤æœ€å¤§ç¡¬ç›˜ç©ºé—´ï¼‰</p></li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-15d94915c460e4bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®ç¡¬ç›˜ç©ºé—´å¤§å°"></p><ul><li>æœ€æœ€æœ€é‡è¦çš„æ­¥éª¤å°±æ˜¯ï¼Œä¸€å®šè¦é€‰æ‹©å¯†é’¥å¯¹æˆ–è€…ç›´æ¥åœ¨è¿™é‡Œç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶ä¸”ä¸€å®šè¦ä¸‹è½½å¯†é’¥å¯¹ï¼Œå› ä¸ºå¯†é’¥å¯¹åªå…è®¸ä¸‹è½½ä¸€æ¬¡ï¼Œé”™è¿‡äº†ï¼Œç­‰äºä½ è¿™ä¸ªå®ä¾‹å°±æ— æ³•ç™»å½•äº†ã€‚äºšé©¬é€Šäº‘é»˜è®¤å…³é—­äº†è´¦å·å¯†ç è¿æ¥ ssh æœåŠ¡ï¼Œåˆæ¬¡è¿æ¥åªå…è®¸å¯†é’¥å¯¹ã€‚</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e95c5b055cfa982b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©å·²ç”Ÿæˆçš„å¯†é’¥å¯¹æˆ–è€…ç›´æ¥åœ¨è¿™é‡Œç”Ÿæˆ"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b0479e4003995376.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æˆ‘æ²¡æœ‰æå‰ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå› æ­¤æˆ‘åœ¨è¿™é‡Œç›´æ¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7a22bfdf90b62c72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½å¯†é’¥å¯¹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b4845a5e820c5f57.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰“å¼€å®ä¾‹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-bc31ca359b59438a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å·²ç»å®‰è£…å¥½äº†æœåŠ¡å™¨"></p><h2 id="æ¥ä¸‹æ¥è®²è§£ä½¿ç”¨-xshell-è¿æ¥äºšé©¬é€Šäº‘æœåŠ¡å™¨"><a href="#æ¥ä¸‹æ¥è®²è§£ä½¿ç”¨-xshell-è¿æ¥äºšé©¬é€Šäº‘æœåŠ¡å™¨" class="headerlink" title="æ¥ä¸‹æ¥è®²è§£ä½¿ç”¨ xshell è¿æ¥äºšé©¬é€Šäº‘æœåŠ¡å™¨"></a>æ¥ä¸‹æ¥è®²è§£ä½¿ç”¨ xshell è¿æ¥äºšé©¬é€Šäº‘æœåŠ¡å™¨</h2><blockquote><p>å»ºè®®è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹æ–‡æ¡£ï¼š<a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/managing-users.html">https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/managing-users.html</a></p></blockquote><ul><li>æ ¹æ®ä½ é€‰æ‹©çš„ç³»ç»Ÿå¯»æ‰¾åˆ°äºšé©¬é€Šäº‘é»˜è®¤ç»™ä½ åˆ›å»ºçš„è´¦æˆ·å</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1bfd9833871ee335.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æˆ‘é€‰æ‹©çš„æ˜¯ redhat ç³»ç»Ÿï¼Œå› æ­¤ç”¨æˆ·åæ˜¯ ec2-user æˆ– root"></p><ul><li>æ‰“å¼€ xshell ï¼Œé…ç½®ç”¨æˆ·èº«ä»½éªŒè¯</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a62480d370da6f50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®ç”¨æˆ·èº«ä»½éªŒè¯"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-7823047ee33c0a5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯¼å…¥å¯†é’¥å¯¹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d8f8286d1d98330a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰ä¸­å¯†é’¥å¯¹"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-78459d37d9fa3827.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ•ˆæœå¦‚ä¸‹"></p><ul><li>é…ç½®è¿æ¥</li></ul><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-46b2bcf9a3277ade.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤åˆ¶å…±æœ‰ DNS"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3125ba8d0bec81fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®è¿æ¥"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6eee19e6b21804b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿æ¥æˆåŠŸ"></p><h2 id="äºšé©¬é€Šäº‘é»˜è®¤å…³é—­äº†-root-è¿æ¥-sshï¼Œæ¥ä¸‹æ¥è®²è§£å¦‚ä½•ä½¿ç”¨-root-ç”¨æˆ·ç™»å½•-ssh"><a href="#äºšé©¬é€Šäº‘é»˜è®¤å…³é—­äº†-root-è¿æ¥-sshï¼Œæ¥ä¸‹æ¥è®²è§£å¦‚ä½•ä½¿ç”¨-root-ç”¨æˆ·ç™»å½•-ssh" class="headerlink" title="äºšé©¬é€Šäº‘é»˜è®¤å…³é—­äº† root è¿æ¥ sshï¼Œæ¥ä¸‹æ¥è®²è§£å¦‚ä½•ä½¿ç”¨ root ç”¨æˆ·ç™»å½• ssh"></a>äºšé©¬é€Šäº‘é»˜è®¤å…³é—­äº† root è¿æ¥ sshï¼Œæ¥ä¸‹æ¥è®²è§£å¦‚ä½•ä½¿ç”¨ root ç”¨æˆ·ç™»å½• ssh</h2><ol><li>æ›´æ”¹ root ç”¨æˆ·å¯†ç </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">passwd</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>åˆ‡æ¢åˆ° root ç”¨æˆ·</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">su</span> - æˆ–è€…<span class="token function">su</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-31aaa46c330d2e75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¿®æ”¹ root ç”¨æˆ·å¯†ç "></p><ol start="3"><li>ä¿®æ”¹ sshd_config é…ç½®æ–‡ä»¶</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/ssh/sshd_config<span class="token comment"># å¦‚æœæç¤ºæ²¡æœ‰ vim ç¼–è¾‘å™¨ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ vi ç¼–è¾‘å™¨</span><span class="token function">vi</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2e587674dfadf7b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¼–è¾‘ sshd æœåŠ¡ä¸»é…ç½®æ–‡ä»¶"></p><ol start="4"><li>å¼€å¯å¯†ç éªŒè¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PasswordAuthentication <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0cd7175dbad6da90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹æ˜¯å¦å…è®¸å¯†ç éªŒè¯"></p><ol start="5"><li>è®¾å®šæ˜¯å¦å…è®¸rootç®¡ç†å‘˜ç›´æ¥ç™»å½•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PermitRootLogin <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-76801d3921d2d1b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹æ˜¯å¦å…è®¸ root ç®¡ç†å‘˜ç›´æ¥ç™»å½•"></p><ol start="6"><li>é‡å¯ sshd æœåŠ¡</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é‡å¯ sshd æœåŠ¡</span>systemctl restart sshd<span class="token comment"># å°† sshd æœåŠ¡åŠ å…¥åˆ°å¼€æœºå¯åŠ¨é¡¹ä¸­</span>systemctl <span class="token builtin class-name">enable</span> sshd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="7"><li>æµ‹è¯•è¿æ¥</li></ol><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-096bb85b62b21053.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨å…¬ç½‘ ip å’Œ root ç”¨æˆ·è¿æ¥ ssh"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-8bdb83fbbe69a83e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨ root è´¦å·å¯†ç è¿æ¥ ssh"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d29f7e82e877c3e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è‡³æ­¤ï¼Œä½¿ç”¨ root ç”¨æˆ·è¿æ¥æˆåŠŸ"></p>]]></content>
      
      
      <categories>
          
          <category> æœåŠ¡å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ python3 å†™çš„æ–‡æ¡£æ ¼å¼è½¬æ¢å°å·¥å…·</title>
      <link href="posts/6cc526bb.html"/>
      <url>posts/6cc526bb.html</url>
      
        <content type="html"><![CDATA[<h1 id="document-converter-ï¼ˆæ–‡æ¡£æ ¼å¼äº’è½¬å·¥å…·ï¼‰"><a href="#document-converter-ï¼ˆæ–‡æ¡£æ ¼å¼äº’è½¬å·¥å…·ï¼‰" class="headerlink" title="document-converter ï¼ˆæ–‡æ¡£æ ¼å¼äº’è½¬å·¥å…·ï¼‰"></a>document-converter ï¼ˆæ–‡æ¡£æ ¼å¼äº’è½¬å·¥å…·ï¼‰</h1><h2 id="é¡¹ç›®å‘èµ·åˆè¡·"><a href="#é¡¹ç›®å‘èµ·åˆè¡·" class="headerlink" title="é¡¹ç›®å‘èµ·åˆè¡·"></a>é¡¹ç›®å‘èµ·åˆè¡·</h2><p>è¿‘æœŸæœ‰æœ‹å‹è¦æˆ‘å¸®å¿™å°† pdf æ ¼å¼æ–‡æ¡£æ•°æ®æå–æˆ docx æ ¼å¼ï¼Œå¹³æ—¶æˆ‘è‡ªå·±è¦ä¹ˆå°±é€šè¿‡ç¼–è¾‘å™¨è½¬æ¢äº†ï¼Œè¦ä¹ˆå°±é€šè¿‡å‘½ä»¤è¡Œè½¬æ¢ï¼Œä½†è¿™ç§æ–¹å¼å¯¹äºä¸€äº›æœ‹å‹æ¥è¯´ä¸æ˜¯å¾ˆå‹å¥½ï¼Œæ•…æ­¤æœ‰æ­¤é¡¹ç›®ã€‚</p><p>ç›®å‰åªæ”¯æŒ docx å’Œ pdf äº’è½¬ï¼Œåç»­æœ‰æ—¶é—´äº†ï¼Œä¼šè€ƒè™‘æ”¯æŒå¤šç§å¸¸ç”¨æ–‡æ¡£æ ¼å¼äº’è½¬ï¼Œå¦‚æœä½ å¯¹è¿™æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ PR ï¼</p><h2 id="é¡¹ç›®ç‰¹æ€§"><a href="#é¡¹ç›®ç‰¹æ€§" class="headerlink" title="é¡¹ç›®ç‰¹æ€§"></a>é¡¹ç›®ç‰¹æ€§</h2><ul><li>ä½¿ç”¨ python3 ç¼–å†™çš„ docxã€pdf äº’è½¬å·¥å…·ã€‚</li><li>æ”¯æŒå¤šçº¿ç¨‹ã€‚</li><li>æ”¯æŒè·¨å¹³å°ï¼ˆmacOSã€Windowsã€Linuxï¼‰ã€‚</li><li>æ‰¹é‡ docx æ–‡æ¡£è½¬ pdf æ ¼å¼ï¼ˆæ•ˆæœè‰¯å¥½ï¼‰ã€‚</li><li>æ‰¹é‡ pdf æ–‡æ¡£è½¬ docx æ ¼å¼ï¼ˆå°è¯•è¿‡å¤šä¸ªæ‰©å±•åº“ï¼Œé—æ†¾çš„æ˜¯å‡ä¸æ”¯æŒå›¾ç‰‡æå–ï¼‰ã€‚</li><li>åç»­æœ‰æ—¶é—´äº†ï¼Œä¼šè€ƒè™‘æ”¯æŒå¤šç§å¸¸ç”¨çš„æ–‡æ¡£æ ¼å¼äº’è½¬ã€‚</li></ul><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><p>å‘½ä»¤è¡Œæç¤º</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-155e22f797a6ee6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡æ¡£ç®€ä»‹"></p><p>æ‰¹é‡ docx è½¬ pdf</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3df6914674c7e060.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="docxè½¬pdf"></p><p>æ‰¹é‡ pdf è½¬ docx</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-800ff9980abdb59a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pdfè½¬docx"></p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ol><li>å…‹éš†æºä»£ç </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># GitHub</span><span class="token function">git</span> clone https://github.com/pudongping/document-converter.git<span class="token comment"># gitee</span><span class="token function">git</span> clone https://gitee.com/pudongping/document-converter.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œå¹¶å®‰è£…ç›¸å…³ä¾èµ–æ‰©å±•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> document-converter <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>ä½¿ç”¨æ–‡æ¡£æ ¼å¼è½¬æ¢</li></ol><p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœæ­¤æ—¶æˆ‘æƒ³å°† <code>n</code> ä¸ª <code>.docx</code> æ ¼å¼çš„æ–‡æ¡£è½¬æ¢æˆ <code>.pdf</code> æ ¼å¼çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦è¿™ä¹ˆæ“ä½œï¼š</p><ul><li>å°†è¿™ <code>n</code> ä¸ª <code>.docx</code> æ–‡æ¡£å¤åˆ¶åˆ°æ­¤é¡¹ç›®çš„ <code>data/input/docxs</code> ç›®å½•ï¼ˆå¦‚æœæƒ³è½¬ <code>.pdf</code> æ ¼å¼çš„æ–‡æ¡£ï¼Œåˆ™éœ€è¦å°†æ–‡æ¡£å¤åˆ¶åˆ° <code>data/input/pdfs</code> ç›®å½•ï¼‰</li><li>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ <code>python3 main.py --docx-to-pdf</code> å‘½ä»¤ï¼Œä¸”ç­‰å¾…å‘½ä»¤æ‰§è¡Œç»“æŸï¼ˆä½ å¯ä»¥å»æ³¡æ¯å’–å•¡ï¼Œä¹‹åé™é™ç­‰å¾…ï¼Œä¸€èˆ¬æ¥è¯´ä¼šå¾ˆå¿«ï¼Œå› ä¸ºæ”¯æŒå¤šçº¿ç¨‹ï¼‰</li><li>ä¹‹ååœ¨ <code>data/output/pdfs</code> ç›®å½•æŸ¥çœ‹å·²ç»è½¬æ¢å¥½çš„æ–‡æ¡£ã€‚è‡³æ­¤ï¼Œå®Œæ¯•ï¼</li></ul><ol start="4"><li>å‘½ä»¤ä»‹ç»</li></ol><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>python3 main.py â€“version</td><td>æ˜¾ç¤ºå½“å‰åº”ç”¨çš„ç‰ˆæœ¬å·</td></tr><tr><td>python3 main.py â€“help æˆ–è€… python3 main.py -h</td><td>æ˜¾ç¤ºå¸®åŠ©æ–‡æ¡£</td></tr><tr><td>python3 main.py â€“docx-to-pdf</td><td>æ‰§è¡Œ docx æ–‡æ¡£è½¬æˆ pdf æ ¼å¼çš„æ–‡æ¡£</td></tr><tr><td>python3 main.py â€“pdf-to-docx</td><td>æ‰§è¡Œ pdf æ–‡æ¡£è½¬æˆ docx æ ¼å¼çš„æ–‡æ¡£</td></tr></tbody></table><h2 id="é¡¹ç›®ç›®å½•ä»‹ç»"><a href="#é¡¹ç›®ç›®å½•ä»‹ç»" class="headerlink" title="é¡¹ç›®ç›®å½•ä»‹ç»"></a>é¡¹ç›®ç›®å½•ä»‹ç»</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”œâ”€â”€ LICENSEâ”œâ”€â”€ Pipfileâ”œâ”€â”€ README.md  é¡¹ç›®ä»‹ç»æ–‡æ¡£â”œâ”€â”€ app  ä»£ç ç›®å½•â”‚   â”œâ”€â”€ __init__.pyâ”‚   â”œâ”€â”€ config  é…ç½®æ–‡ä»¶ç›®å½•â”‚   â”‚   â”œâ”€â”€ __init__.pyâ”‚   â”‚   â””â”€â”€ app.py  é…ç½®ç›¸å…³â”‚   â”œâ”€â”€ converter  è½¬æ¢ç›¸å…³ä»£ç ç›®å½•â”‚   â”‚   â”œâ”€â”€ __init__.pyâ”‚   â”‚   â”œâ”€â”€ converter_docx.py  *æ–‡æ¡£è½¬ docx æ ¼å¼ç›¸å…³ä»£ç â”‚   â”‚   â””â”€â”€ converter_pdf.py   *æ–‡æ¡£è½¬ pdf æ ¼å¼ç›¸å…³ä»£ç â”‚   â””â”€â”€ helper.py  åŠ©æ‰‹å‡½æ•°â”œâ”€â”€ data  æ•°æ®ç›¸å…³â”‚   â”œâ”€â”€ input  éœ€è¦è½¬æ¢çš„æ–‡æ¡£ç›®å½•â”‚   â”‚   â”œâ”€â”€ docxs  å¦‚æœéœ€è¦å°† docx æ–‡æ¡£è½¬æ¢æˆå…¶ä»–æ ¼å¼ï¼Œåˆ™é»˜è®¤éœ€è¦å°†æ–‡æ¡£æ”¾å…¥æ­¤ç›®å½•ä¸‹â”‚   â”‚   â”‚   â”œâ”€â”€ æ–‡æ¡£1.docxâ”‚   â”‚   â”‚   â””â”€â”€ æ–‡æ¡£2.docxâ”‚   â”‚   â””â”€â”€ pdfs  å¦‚æœéœ€è¦å°† pdf æ–‡æ¡£è½¬æ¢æˆå…¶ä»–æ ¼å¼ï¼Œåˆ™é»˜è®¤éœ€è¦å°†æ–‡æ¡£æ”¾å…¥æ­¤ç›®å½•ä¸‹â”‚   â”‚       â”œâ”€â”€ alex1.pdfâ”‚   â”‚       â””â”€â”€ sample.pdfâ”‚   â””â”€â”€ output  æ–‡æ¡£è½¬æ¢åå­˜æ”¾çš„æ–‡æ¡£ç›®å½•â”‚       â”œâ”€â”€ docxs  æ‰€æœ‰ç»è¿‡è½¬æ¢åçš„ docx æ–‡æ¡£é»˜è®¤ä¼šæ”¾åˆ°æ­¤ç›®å½•ä¸‹â”‚       â”‚   â”œâ”€â”€ alex1.pdf.docxâ”‚       â”‚   â””â”€â”€ sample.pdf.docxâ”‚       â””â”€â”€ pdfs  æ‰€æœ‰ç»è¿‡è½¬æ¢åçš„ pdf æ–‡æ¡£é»˜è®¤ä¼šæ”¾åˆ°æ­¤ç›®å½•ä¸‹â”‚           â”œâ”€â”€ æ–‡æ¡£1.docx.pdfâ”‚           â””â”€â”€ æ–‡æ¡£2.docx.pdfâ”œâ”€â”€ main.py  é¡¹ç›®å…¥å£æ–‡ä»¶â”œâ”€â”€ requirements.txt  é¡¹ç›®ä¾èµ–å…³ç³»æ¸…å•â””â”€â”€ runtime  é¡¹ç›®è¿è¡Œç›¸å…³    â””â”€â”€ logs  æ—¥å¿—ç›®å½•        â””â”€â”€ <span class="token number">202104</span>            â””â”€â”€ converter-2021-04-24.log  ä»¥å¤©ä¸ºå•ä½è®°å½•çš„æ“ä½œæ—¥å¿—<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>æºä»£ç åŸºäº <a href="https://opensource.org/licenses/MIT">MIT</a> åè®®å‘å¸ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubiquitous-nodejs</title>
      <link href="posts/6b5490ac.html"/>
      <url>posts/6b5490ac.html</url>
      
        <content type="html"><![CDATA[<p align="center">    </p><h1 align="center"><a href="https://pudodngping.com">ubiquitous-nodejs</a></h1>    <p align="center">âš¡ ubiquity-nodejs æ˜¯ä¸€ä¸ªåŸºäº node.js çš„ web è„šæ‰‹æ¶ã€‚ğŸ˜˜ æ”¯æŒæ¨¡ç‰ˆæ¸²æŸ“ã€Restful APIã€ORM ç­‰ç‰¹æ€§ï¼Œéµå¾ª MVC æ¶æ„ã€‚</p><p></p><h2 id="å¦‚ä½•éƒ¨ç½²é¡¹ç›®ï¼Ÿ"><a href="#å¦‚ä½•éƒ¨ç½²é¡¹ç›®ï¼Ÿ" class="headerlink" title="å¦‚ä½•éƒ¨ç½²é¡¹ç›®ï¼Ÿ"></a>å¦‚ä½•éƒ¨ç½²é¡¹ç›®ï¼Ÿ</h2><p>ä»“åº“åœ°å€ï¼š</p><ul><li><a href="https://github.com/pudongping/ubiquitous-nodejs.git">GitHub</a></li><li><a href="https://gitee.com/pudongping/ubiquitous-nodejs.git">Gitee</a></li></ul><p>æœ¬åœ°éƒ¨ç½²</p><ol><li>ç›´æ¥ä½¿ç”¨ git æ‹‰å–é¡¹ç›®æºç ï¼Œå¹¶è¿›å…¥é¡¹ç›®æ ¹ç›®å½•</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://gitee.com/pudongping/ubiquitous-nodejs.git ubiquitous <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> ./ubiquitous<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>å®‰è£…é¡¹ç›®ä¾èµ–åŒ…</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>å¡«å†™é…ç½®ä¿¡æ¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¤åˆ¶å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶</span><span class="token function">cp</span> ./config/development.js.example ./config/development.js<span class="token comment"># å¤åˆ¶ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶</span><span class="token function">cp</span> ./config/production.js.example ./config/production.js<span class="token comment"># å¤åˆ¶æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶</span><span class="token function">cp</span> ./config/test.js.example ./config/test.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>å¯¼å…¥åˆå§‹æ•°æ®è¡¨<blockquote><p>è¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤º restful api çš„ CRUD åŠŸèƒ½ï¼Œæ•…æ­¤åˆ›å»ºäº†ä¸€ä¸ªåˆå§‹æ•°æ®åº“ã€‚</p></blockquote></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿æ¥æ•°æ®åº“</span>mysql <span class="token parameter variable">-h</span> <span class="token operator">&lt;</span>your-mysql-host<span class="token operator">&gt;</span> <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>your-mysql-account<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span>your-mysql-password<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token comment"># å¯¼å…¥åˆå§‹æ•°æ®è¡¨</span><span class="token builtin class-name">source</span> ./database/ubiquitous.sql<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>å¯åŠ¨é¡¹ç›®<blockquote><p>ä»¥ä¸‹æ–¹å¼æ‰§è¡Œä»»æ„ä¸€æ¡å‘½ä»¤å³å¯</p></blockquote></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥ä½¿ç”¨ node æ‰§è¡Œé¡¹ç›®å…¥å£æ–‡ä»¶çš„æ–¹å¼</span><span class="token function">node</span> <span class="token parameter variable">--use_strict</span> app.js<span class="token comment"># ä½¿ç”¨ npm æ‰§è¡Œ</span><span class="token comment"># è¿è¡Œå¼€å‘ç¯å¢ƒ</span><span class="token function">npm</span> start<span class="token comment"># æˆ–è€…</span><span class="token function">npm</span> run dev<span class="token comment"># è¿è¡Œç”Ÿäº§ç¯å¢ƒ</span><span class="token function">npm</span> run prod<span class="token comment"># è¿è¡Œæµ‹è¯•ç¯å¢ƒ</span><span class="token function">npm</span> run <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>æ­å»ºå®Œæ¯•ï¼enjoy it! âœŒï¸<blockquote><p>å¯ä»¥æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>localhost:9500</code> æˆ–è€… <code>127.0.0.1:9500</code> è¿›è¡Œè®¿é—®ï¼Œå³å¯çœ‹åˆ°é¦–é¡µæ¬¢è¿è¯­ã€‚</p></blockquote></li></ol><h2 id="å…³äºé¡¹ç›®ç›®å½•"><a href="#å…³äºé¡¹ç›®ç›®å½•" class="headerlink" title="å…³äºé¡¹ç›®ç›®å½•"></a>å…³äºé¡¹ç›®ç›®å½•</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”œâ”€â”€ LICENSE  Licenseâ”œâ”€â”€ README.md  é¡¹ç›®è¯´æ˜æ–‡æ¡£â”œâ”€â”€ app.js  é¡¹ç›®å…¥å£æ–‡ä»¶â”œâ”€â”€ bootstrap  é¡¹ç›®å¯åŠ¨ç›®å½•â”‚   â”œâ”€â”€ boot.js  å¯åŠ¨æ–‡ä»¶â”‚   â”œâ”€â”€ db.js  æ•°æ®åº“å°è£…â”‚   â”œâ”€â”€ rest.js  restful api æ–¹æ³•å°è£…â”‚   â”œâ”€â”€ static-files.js  é™æ€æ–‡ä»¶å¤„ç†æ–¹æ³•å°è£…â”‚   â””â”€â”€ templating.js  æ¨¡ç‰ˆå¤„ç†æ–¹æ³•å°è£…â”œâ”€â”€ config  é…ç½®æ–‡ä»¶ç›®å½•â”‚   â”œâ”€â”€ development.js  å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶â”‚   â”œâ”€â”€ development.js.example  å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶æ¨¡ç‰ˆâ”‚   â”œâ”€â”€ production.js.example  ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶æ¨¡ç‰ˆâ”‚   â””â”€â”€ test.js.example  æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶æ¨¡æ¿â”œâ”€â”€ constants  å¸¸é‡æ–‡ä»¶â”‚   â””â”€â”€ ErrorCode.js  api é”™è¯¯ç å¸¸é‡â”œâ”€â”€ controllers  æ§åˆ¶å™¨ç›®å½•â”‚   â”œâ”€â”€ auth  auth æ¨¡å—ç›®å½•â”‚   â”‚   â””â”€â”€ user_controller.js  ç”¨æˆ·æ§åˆ¶å™¨ï¼ˆè¿™é‡Œä½œä¸ºæ¼”ç¤º restful api å†™çš„ demoï¼‰â”‚   â””â”€â”€ home_controller.js  é¦–é¡µæ§åˆ¶å™¨ ï¼ˆè¿™é‡Œä½œä¸ºæ¼”ç¤ºæ¨¡ç‰ˆè°ƒç”¨å†™çš„ demoï¼‰â”œâ”€â”€ database  æ•°æ®æ–‡ä»¶ç›®å½•â”‚   â””â”€â”€ ubiquitous.sql  åˆå§‹åŒ–æ•°æ®åº“æ–‡ä»¶â”œâ”€â”€ lib  å·¥å…·ç›®å½•â”‚   â”œâ”€â”€ api_error.js  è‡ªå®šä¹‰é”™è¯¯å¼‚å¸¸ç±»â”‚   â””â”€â”€ helper.js  åŠ©æ‰‹å‡½æ•°â”œâ”€â”€ loader.js  é¡¹ç›®åŠ è½½æ–‡ä»¶ï¼ˆè¿™é‡Œå®šä¹‰é¡¹ç›®å…¨å±€å˜é‡ï¼‰â”œâ”€â”€ models  æ¨¡å‹ç›®å½•â”‚   â”œâ”€â”€ WebSite.js  ç«™ç‚¹æ¨¡å‹æ–‡ä»¶â”‚   â”œâ”€â”€ auth  auth æ¨¡å—æ¨¡å‹ç›®å½•â”‚   â”‚   â””â”€â”€ User.js  ç”¨æˆ·æ¨¡å‹æ–‡ä»¶â”‚   â””â”€â”€ model.js  è‡ªåŠ¨åŒ–æ‰«æåŠ è½½æ‰€æœ‰çš„æ¨¡å‹â”œâ”€â”€ package-lock.json  æ’ä»¶åŒ…æè¿°é”æ–‡ä»¶â”œâ”€â”€ package.json  æ’ä»¶åŒ…æè¿°æ–‡ä»¶â”œâ”€â”€ routes  è·¯ç”±ç›®å½•â”‚   â”œâ”€â”€ api.js  restful api è·¯ç”±ç›®å½•â”‚   â””â”€â”€ web.js  web è·¯ç”±ç›®å½•â”œâ”€â”€ services  æœåŠ¡å±‚ç›®å½•â”‚   â””â”€â”€ auth  auth æ¨¡å—æœåŠ¡å±‚ç›®å½•â”‚       â””â”€â”€ user_service.js  ç”¨æˆ·æœåŠ¡å±‚æ–‡ä»¶â”œâ”€â”€ static  é™æ€æ–‡ä»¶ç›®å½•â”‚   â”œâ”€â”€ css  æ ·å¼æ–‡ä»¶ç›®å½•â”‚   â”‚   â”œâ”€â”€ googleapis-fonts.cssâ”‚   â”‚   â””â”€â”€ iview.cssâ”‚   â”œâ”€â”€ fonts  å­—ä½“æ–‡ä»¶ç›®å½•â”‚   â””â”€â”€ js  js æ–‡ä»¶ç›®å½•â”‚       â”œâ”€â”€ iview.min.jsâ”‚       â””â”€â”€ vue.min.jsâ””â”€â”€ views  è§†å›¾å±‚æ–‡ä»¶ç›®å½•    â”œâ”€â”€ base.html  è§†å›¾åŸºç¡€æ–‡ä»¶    â”œâ”€â”€ home  home æ¨¡å—è§†å›¾æ–‡ä»¶ç›®å½•    â”‚   â””â”€â”€ hello.html    â””â”€â”€ home.html  é¦–é¡µè§†å›¾æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é¡¹ç›®æ‰€ä½¿ç”¨ä¾èµ–åŒ…"><a href="#é¡¹ç›®æ‰€ä½¿ç”¨ä¾èµ–åŒ…" class="headerlink" title="é¡¹ç›®æ‰€ä½¿ç”¨ä¾èµ–åŒ…"></a>é¡¹ç›®æ‰€ä½¿ç”¨ä¾èµ–åŒ…</h2><table><thead><tr><th>æ’ä»¶åŒ…</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><a href="https://koa.bootcss.com/">koa</a></td><td>ä½¿ç”¨ Koa2 ä½œä¸º web æ¡†æ¶</td></tr><tr><td><a href="https://github.com/koajs/router">koa-router</a></td><td>å¤„ç† url</td></tr><tr><td><a href="https://github.com/koajs/bodyparser">koa-bodyparser</a></td><td>è§£æåŸå§‹ request çš„ body</td></tr><tr><td><a href="https://mozilla.github.io/nunjucks/cn/templating.html">nunjucks</a></td><td>æ¨¡ç‰ˆå¼•æ“</td></tr><tr><td><a href="https://github.com/kentcdodds/cross-env#readme">cross-env</a></td><td>ç¯å¢ƒè„šæœ¬çš„è·¨å¹³å°è®¾ç½®</td></tr><tr><td><a href="https://github.com/normalize/mz#readme">mz</a></td><td>æ”¯æŒ Promise çš„ fs æ¨¡å—</td></tr><tr><td><a href="https://github.com/broofa/mime#readme">mime</a></td><td>è¯»å–æ–‡ä»¶çš„ mime</td></tr><tr><td><a href="https://github.com/sidorares/node-mysql2#readme">mysql2</a></td><td>Node.js çš„ mysql é©±åŠ¨ç¨‹åº</td></tr><tr><td><a href="https://www.sequelize.com.cn/">sequelize</a></td><td>Node.js çš„ ORM æ¡†æ¶</td></tr><tr><td><a href="http://momentjs.cn/">moment</a></td><td>æ—¥æœŸå¤„ç†</td></tr></tbody></table><h2 id="ä½¿ç”¨æ¼”ç¤º"><a href="#ä½¿ç”¨æ¼”ç¤º" class="headerlink" title="ä½¿ç”¨æ¼”ç¤º"></a>ä½¿ç”¨æ¼”ç¤º</h2><ul><li>å¦‚æœéœ€è¦ä½¿ç”¨æ¨¡ç‰ˆå¼•æ“çš„æ–¹å¼ï¼Œè¯·æŸ¥çœ‹ <code>controllers/home_controller.js</code> æ–‡ä»¶ã€‚</li><li>å¦‚æœéœ€è¦ä½¿ç”¨ api çš„æ–¹å¼ï¼Œè¯·æŸ¥çœ‹ <code>controllers/auth/user_controller.js</code> æ–‡ä»¶ã€‚</li></ul><h2 id="æ„Ÿè°¢æ”¯æŒ"><a href="#æ„Ÿè°¢æ”¯æŒ" class="headerlink" title="æ„Ÿè°¢æ”¯æŒ"></a>æ„Ÿè°¢æ”¯æŒ</h2><p>å¦‚æœä½ è§‰å¾—æœ¬é¡¹ç›®å¯¹ä½ æœ‰æ‰€å¸®åŠ©,è¯·å¸®å¿™ç»™ä¸ª <code>Star</code>ã€‚<br>å¦‚æœä½ æƒ³è´¡çŒ®ä¸€ä»½åŠ›é‡,æ¬¢è¿æäº¤ <code>Pull Request</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¼€æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weather composer æ’ä»¶</title>
      <link href="posts/d2a0cef0.html"/>
      <url>posts/d2a0cef0.html</url>
      
        <content type="html"><![CDATA[<h1 align="center">Weather</h1><p align="center"><span class="github-emoji"><span>ğŸŒˆ</span><img src="/medias/loading.gif" data-original="https://github.githubassets.com/images/icons/emoji/unicode/1f308.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸºäºé«˜å¾·å¼€æ”¾å¹³å°çš„ PHP å¤©æ°”ä¿¡æ¯ç»„ä»¶ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">composer</span> require pudongping/weather <span class="token parameter variable">-vvv</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>åœ¨ä½¿ç”¨æœ¬æ‰©å±•ä¹‹å‰ï¼Œä½ éœ€è¦å» <a href="https://lbs.amap.com/dev/id/newuser">é«˜å¾·å¼€æ”¾å¹³å°</a> æ³¨å†Œè´¦å·ï¼Œç„¶ååˆ›å»ºåº”ç”¨ï¼Œè·å–åº”ç”¨çš„ API Keyã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">Pudongping<span class="token punctuation">\</span>Weather<span class="token punctuation">\</span>Weather</span><span class="token punctuation">;</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'xxxxxxxxxxxxxxxxxxxxxxxxxxx'</span><span class="token punctuation">;</span><span class="token variable">$weather</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Weather</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–å®æ—¶å¤©æ°”"><a href="#è·å–å®æ—¶å¤©æ°”" class="headerlink" title="è·å–å®æ—¶å¤©æ°”"></a>è·å–å®æ—¶å¤©æ°”</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$weather</span><span class="token operator">-&gt;</span><span class="token function">getLiveWeather</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä¸Šæµ·'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿”å›å€¼ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>    <span class="token property">"info"</span><span class="token operator">:</span> <span class="token string">"OK"</span><span class="token punctuation">,</span>    <span class="token property">"infocode"</span><span class="token operator">:</span> <span class="token string">"10000"</span><span class="token punctuation">,</span>    <span class="token property">"lives"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token property">"province"</span><span class="token operator">:</span> <span class="token string">"ä¸Šæµ·"</span><span class="token punctuation">,</span>            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"ä¸Šæµ·å¸‚"</span><span class="token punctuation">,</span>            <span class="token property">"adcode"</span><span class="token operator">:</span> <span class="token string">"310000"</span><span class="token punctuation">,</span>            <span class="token property">"weather"</span><span class="token operator">:</span> <span class="token string">"é˜´"</span><span class="token punctuation">,</span>            <span class="token property">"temperature"</span><span class="token operator">:</span> <span class="token string">"10"</span><span class="token punctuation">,</span>            <span class="token property">"winddirection"</span><span class="token operator">:</span> <span class="token string">"ä¸œ"</span><span class="token punctuation">,</span>            <span class="token property">"windpower"</span><span class="token operator">:</span> <span class="token string">"â‰¤3"</span><span class="token punctuation">,</span>            <span class="token property">"humidity"</span><span class="token operator">:</span> <span class="token string">"73"</span><span class="token punctuation">,</span>            <span class="token property">"reporttime"</span><span class="token operator">:</span> <span class="token string">"2021-03-17 09:31:44"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–è¿‘æœŸå¤©æ°”é¢„æŠ¥"><a href="#è·å–è¿‘æœŸå¤©æ°”é¢„æŠ¥" class="headerlink" title="è·å–è¿‘æœŸå¤©æ°”é¢„æŠ¥"></a>è·å–è¿‘æœŸå¤©æ°”é¢„æŠ¥</h3><pre class="line-numbers language-none"><code class="language-none">$response = $weather-&gt;getForecastsWeather('ä¸Šæµ·');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿”å›å€¼ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>    <span class="token property">"info"</span><span class="token operator">:</span> <span class="token string">"OK"</span><span class="token punctuation">,</span>    <span class="token property">"infocode"</span><span class="token operator">:</span> <span class="token string">"10000"</span><span class="token punctuation">,</span>    <span class="token property">"forecasts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"ä¸Šæµ·å¸‚"</span><span class="token punctuation">,</span>            <span class="token property">"adcode"</span><span class="token operator">:</span> <span class="token string">"310000"</span><span class="token punctuation">,</span>            <span class="token property">"province"</span><span class="token operator">:</span> <span class="token string">"ä¸Šæµ·"</span><span class="token punctuation">,</span>            <span class="token property">"reporttime"</span><span class="token operator">:</span> <span class="token string">"2021-03-17 10:03:15"</span><span class="token punctuation">,</span>            <span class="token property">"casts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">{</span>                    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2021-03-17"</span><span class="token punctuation">,</span>                    <span class="token property">"week"</span><span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>                    <span class="token property">"dayweather"</span><span class="token operator">:</span> <span class="token string">"å°é›¨"</span><span class="token punctuation">,</span>                    <span class="token property">"nightweather"</span><span class="token operator">:</span> <span class="token string">"å°é›¨"</span><span class="token punctuation">,</span>                    <span class="token property">"daytemp"</span><span class="token operator">:</span> <span class="token string">"12"</span><span class="token punctuation">,</span>                    <span class="token property">"nighttemp"</span><span class="token operator">:</span> <span class="token string">"9"</span><span class="token punctuation">,</span>                    <span class="token property">"daywind"</span><span class="token operator">:</span> <span class="token string">"ä¸œåŒ—"</span><span class="token punctuation">,</span>                    <span class="token property">"nightwind"</span><span class="token operator">:</span> <span class="token string">"ä¸œåŒ—"</span><span class="token punctuation">,</span>                    <span class="token property">"daypower"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>                    <span class="token property">"nightpower"</span><span class="token operator">:</span> <span class="token string">"4"</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span>                    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2021-03-18"</span><span class="token punctuation">,</span>                    <span class="token property">"week"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>                    <span class="token property">"dayweather"</span><span class="token operator">:</span> <span class="token string">"å°é›¨"</span><span class="token punctuation">,</span>                    <span class="token property">"nightweather"</span><span class="token operator">:</span> <span class="token string">"å°é›¨"</span><span class="token punctuation">,</span>                    <span class="token property">"daytemp"</span><span class="token operator">:</span> <span class="token string">"13"</span><span class="token punctuation">,</span>                    <span class="token property">"nighttemp"</span><span class="token operator">:</span> <span class="token string">"10"</span><span class="token punctuation">,</span>                    <span class="token property">"daywind"</span><span class="token operator">:</span> <span class="token string">"ä¸œ"</span><span class="token punctuation">,</span>                    <span class="token property">"nightwind"</span><span class="token operator">:</span> <span class="token string">"ä¸œ"</span><span class="token punctuation">,</span>                    <span class="token property">"daypower"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>                    <span class="token property">"nightpower"</span><span class="token operator">:</span> <span class="token string">"4"</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span>                    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2021-03-19"</span><span class="token punctuation">,</span>                    <span class="token property">"week"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span>                    <span class="token property">"dayweather"</span><span class="token operator">:</span> <span class="token string">"å°é›¨"</span><span class="token punctuation">,</span>                    <span class="token property">"nightweather"</span><span class="token operator">:</span> <span class="token string">"å°é›¨"</span><span class="token punctuation">,</span>                    <span class="token property">"daytemp"</span><span class="token operator">:</span> <span class="token string">"14"</span><span class="token punctuation">,</span>                    <span class="token property">"nighttemp"</span><span class="token operator">:</span> <span class="token string">"9"</span><span class="token punctuation">,</span>                    <span class="token property">"daywind"</span><span class="token operator">:</span> <span class="token string">"åŒ—"</span><span class="token punctuation">,</span>                    <span class="token property">"nightwind"</span><span class="token operator">:</span> <span class="token string">"åŒ—"</span><span class="token punctuation">,</span>                    <span class="token property">"daypower"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>                    <span class="token property">"nightpower"</span><span class="token operator">:</span> <span class="token string">"4"</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span>                    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2021-03-20"</span><span class="token punctuation">,</span>                    <span class="token property">"week"</span><span class="token operator">:</span> <span class="token string">"6"</span><span class="token punctuation">,</span>                    <span class="token property">"dayweather"</span><span class="token operator">:</span> <span class="token string">"é˜´"</span><span class="token punctuation">,</span>                    <span class="token property">"nightweather"</span><span class="token operator">:</span> <span class="token string">"é˜´"</span><span class="token punctuation">,</span>                    <span class="token property">"daytemp"</span><span class="token operator">:</span> <span class="token string">"15"</span><span class="token punctuation">,</span>                    <span class="token property">"nighttemp"</span><span class="token operator">:</span> <span class="token string">"8"</span><span class="token punctuation">,</span>                    <span class="token property">"daywind"</span><span class="token operator">:</span> <span class="token string">"è¥¿åŒ—"</span><span class="token punctuation">,</span>                    <span class="token property">"nightwind"</span><span class="token operator">:</span> <span class="token string">"è¥¿åŒ—"</span><span class="token punctuation">,</span>                    <span class="token property">"daypower"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>                    <span class="token property">"nightpower"</span><span class="token operator">:</span> <span class="token string">"4"</span>                <span class="token punctuation">}</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–-XML-æ ¼å¼è¿”å›å€¼"><a href="#è·å–-XML-æ ¼å¼è¿”å›å€¼" class="headerlink" title="è·å– XML æ ¼å¼è¿”å›å€¼"></a>è·å– XML æ ¼å¼è¿”å›å€¼</h3><p>ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›å€¼ç±»å‹ï¼Œå¯é€‰ <code>json</code> ä¸ <code>xml</code>ï¼Œé»˜è®¤ <code>json</code>ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$weather</span><span class="token operator">-&gt;</span><span class="token function">getLiveWeather</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä¸Šæµ·'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿”å›å€¼ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>response</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>status</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>status</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>count</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>count</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>info</span><span class="token punctuation">&gt;</span></span>OK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>info</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>infocode</span><span class="token punctuation">&gt;</span></span>10000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>infocode</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lives</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>live</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>province</span><span class="token punctuation">&gt;</span></span>ä¸Šæµ·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>province</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>city</span><span class="token punctuation">&gt;</span></span>ä¸Šæµ·å¸‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>city</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>adcode</span><span class="token punctuation">&gt;</span></span>310000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>adcode</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>weather</span><span class="token punctuation">&gt;</span></span>å°é›¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>weather</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>temperature</span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>temperature</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>winddirection</span><span class="token punctuation">&gt;</span></span>ä¸œåŒ—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>winddirection</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>windpower</span><span class="token punctuation">&gt;</span></span>â‰¤3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>windpower</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>humidity</span><span class="token punctuation">&gt;</span></span>73<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>humidity</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reporttime</span><span class="token punctuation">&gt;</span></span>2021-03-17 10:03:15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reporttime</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>live</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lives</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>response</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h3><pre class="line-numbers language-none"><code class="language-none">array | string   getLiveWeather(string $city, string $format = 'json')array | string   getForecastsWeather(string $city, string $format = 'json')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><ul><li><code>$city</code> - åŸå¸‚å/<a href="https://lbs.amap.com/api/webservice/guide/api/district">é«˜å¾·åœ°å€ä½ç½® adcode</a>ï¼Œæ¯”å¦‚ï¼šâ€œä¸Šæµ·â€ æˆ–è€…ï¼ˆadcodeï¼š310000ï¼‰ï¼›</li><li><code>$format</code>  - è¾“å‡ºçš„æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸º json æ ¼å¼ï¼Œå½“ format è®¾ç½®ä¸º â€œ<code>xml</code>â€ æ—¶ï¼Œè¾“å‡ºçš„ä¸º XML æ ¼å¼çš„æ•°æ®ã€‚</li></ul></blockquote><h3 id="åœ¨-Laravel-ä¸­ä½¿ç”¨"><a href="#åœ¨-Laravel-ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨ Laravel ä¸­ä½¿ç”¨"></a>åœ¨ Laravel ä¸­ä½¿ç”¨</h3><blockquote><p>laravel version &gt;= 8.x æˆ–è€…ç›´æ¥ä½¿ç”¨ä»¥ä¸Šé€šç”¨æ–¹æ³•ï¼Œä»¥ä¸Šæ–¹æ³•é€‚ç”¨äºä»»æ„ php æ¡†æ¶</p></blockquote><p>æ‰§è¡Œ <code>artisan</code> å‘½ä»¤ï¼Œå‘å¸ƒé…ç½®æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan vendor:publish <span class="token parameter variable">--provider</span><span class="token operator">=</span><span class="token string">"Pudongping\Weather\ServiceProvider"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ Laravel ä¸­ä½¿ç”¨ä¹Ÿæ˜¯åŒæ ·çš„å®‰è£…æ–¹å¼ï¼Œé…ç½®å†™åœ¨ <code>config/weather.php</code> ä¸­ï¼Œæˆ–è€…è‡ªå·±åœ¨ <code>config</code> ç›®å½•ä¸‹æ–°å»º <code>weather.php</code> æ–‡ä»¶ï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹äº¦å¯ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">return</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'key'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'WEATHER_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨ <code>.env</code> ä¸­é…ç½® <code>WEATHER_API_KEY</code> ï¼š</p><pre class="line-numbers language-env" data-language="env"><code class="language-env">WEATHER_API_KEY=xxxxxxxxxxxxxxxxxxxxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¥è·å– <code>Pudongping\Weather\Weather</code> å®ä¾‹ï¼š</p><h4 id="æ–¹æ³•å‚æ•°æ³¨å…¥"><a href="#æ–¹æ³•å‚æ•°æ³¨å…¥" class="headerlink" title="æ–¹æ³•å‚æ•°æ³¨å…¥"></a>æ–¹æ³•å‚æ•°æ³¨å…¥</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showWeather</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Weather</span> <span class="token variable">$weather</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$weather</span><span class="token operator">-&gt;</span><span class="token function">getLiveWeather</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä¸Šæµ·'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æˆ–è€…ç›´æ¥ä½¿ç”¨åŸå¸‚çš„ adcode ä¼ å‚</span>    <span class="token comment">// $response = $weather-&gt;getLiveWeather('310000');</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœåŠ¡åè®¿é—®"><a href="#æœåŠ¡åè®¿é—®" class="headerlink" title="æœåŠ¡åè®¿é—®"></a>æœåŠ¡åè®¿é—®</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">showWeather</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'weather'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getLiveWeather</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä¸Šæµ·'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æˆ–è€…ç›´æ¥ä½¿ç”¨åŸå¸‚çš„ adcode ä¼ å‚</span>    <span class="token comment">// $response = app('weather')-&gt;getLiveWeather('310000');</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://lbs.amap.com/api/webservice/guide/api/weatherinfo/">é«˜å¾·å¼€æ”¾å¹³å°å¤©æ°”æ¥å£</a></li></ul><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>MIT</p>]]></content>
      
      
      <categories>
          
          <category> å¼€æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
            <tag> Composer </tag>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>larablog åšå®¢å¼€æº</title>
      <link href="posts/b6f184c0.html"/>
      <url>posts/b6f184c0.html</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºäº-Laravel6-x-æ„å»ºçš„åšå®¢åº”ç”¨ï¼Œæ”¯æŒ-Markdownï¼Œæ”¯æŒå›¾ç‰‡æ‹–æ‹½ä¸Šä¼ ï¼ŒåŸºäº-RBAC-æƒé™ç®¡ç†ç³»ç»Ÿ"><a href="#åŸºäº-Laravel6-x-æ„å»ºçš„åšå®¢åº”ç”¨ï¼Œæ”¯æŒ-Markdownï¼Œæ”¯æŒå›¾ç‰‡æ‹–æ‹½ä¸Šä¼ ï¼ŒåŸºäº-RBAC-æƒé™ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="åŸºäº Laravel6.x æ„å»ºçš„åšå®¢åº”ç”¨ï¼Œæ”¯æŒ Markdownï¼Œæ”¯æŒå›¾ç‰‡æ‹–æ‹½ä¸Šä¼ ï¼ŒåŸºäº RBAC æƒé™ç®¡ç†ç³»ç»Ÿ"></a>åŸºäº Laravel6.x æ„å»ºçš„åšå®¢åº”ç”¨ï¼Œæ”¯æŒ Markdownï¼Œæ”¯æŒå›¾ç‰‡æ‹–æ‹½ä¸Šä¼ ï¼ŒåŸºäº RBAC æƒé™ç®¡ç†ç³»ç»Ÿ</h1><p>é¦–é¡µ</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f32ef21d42b702c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µ.png"></p><p>åŸºäº RBAC çš„æƒé™ç®¡ç†åå°ï¼ŒDashboard é¡µé¢ç»Ÿè®¡äº†ç”¨æˆ·æ€»æ•°ã€æ–‡ç« å‘å¸ƒæ€»æ•°ã€è¯„è®ºç‡ã€è¯„è®ºæ€»æ•°ã€æ–‡ç« æ”¯æŒæŒ‰å¤©ã€æŒ‰æœˆã€æŒ‰å¹´ç»Ÿè®¡ã€æ”¯æŒæŒ‰åˆ†ç±»ã€æŒ‰æ ‡ç­¾ç»Ÿè®¡â€¦â€¦</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-74c132c165d20aae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åå°é¦–é¡µ.png"></p><p>ç™»å½•é¡µé¢</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-93885ee50879719e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç™»å½•é¡µé¢.png"></p><p>æ³¨å†Œé¡µé¢</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a883ff409344f8c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ³¨å†Œé¡µé¢.png"></p><p>æ”¯æŒ GitHub æˆæƒç™»å½•</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f87b0926873bdfd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="GitHubæˆæƒç™»å½•é¡µé¢.png"></p><p>æ”¯æŒé‚®ç®±é‡ç½®å¯†ç </p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-11fbe50ac341bf7e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é‡ç½®å¯†ç é¡µé¢.png"></p><p>åŒæ—¶å…¼å®¹ HTML ç¼–è¾‘å™¨å’Œ Markdown ç¼–è¾‘å™¨</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-537e03bdc254a951.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯Œæ–‡æœ¬ç¼–è¾‘å™¨.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c1c8018845d986ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="markdown ç¼–è¾‘å™¨.png"></p><p>Markdown ç¼–è¾‘å™¨ï¼šæ”¯æŒæ‹–æ‹½ç²˜è´´ä¸Šä¼ å›¾ç‰‡ã€é¢„è§ˆã€å…¨å±ã€åˆ†å±é¢„è§ˆ</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-092682db5e3cec7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="markdown ç¼–è¾‘å™¨é¢„è§ˆæ•ˆæœ.png"></p><p>æ”¯æŒä»£ç é«˜äº®</p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5263abf6268ddf98.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡ç« è¯¦æƒ….png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-9db84df41d52c0a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åå°ç”¨æˆ·.png"></p><h2 id="é¡¹ç›®æ¦‚è¿°"><a href="#é¡¹ç›®æ¦‚è¿°" class="headerlink" title="é¡¹ç›®æ¦‚è¿°"></a>é¡¹ç›®æ¦‚è¿°</h2><ul><li>é¡¹ç›®åç§°ï¼šlarablog</li><li>é¡¹ç›®ç®€ä»‹ï¼šåŸºäº laravel6.x å¼€å‘çš„åšå®¢é¡¹ç›®</li><li>è®¿é—®åœ°å€ï¼š<a href="https://blog.pudongping.com/">https://blog.pudongping.com/</a></li></ul><h2 id="åŠŸèƒ½å¦‚ä¸‹"><a href="#åŠŸèƒ½å¦‚ä¸‹" class="headerlink" title="åŠŸèƒ½å¦‚ä¸‹"></a>åŠŸèƒ½å¦‚ä¸‹</h2><ul><li>ç”¨æˆ·è®¤è¯ â€”â€” æ³¨å†Œã€ç™»å½•ã€é€€å‡ºï¼›</li><li>ä¸ªäººä¸­å¿ƒ â€”â€” ç”¨æˆ·ä¸ªäººä¸­å¿ƒï¼Œç¼–è¾‘èµ„æ–™ï¼›</li><li>ç”¨æˆ·æˆæƒ â€”â€” ä½œè€…æ‰èƒ½åˆ é™¤è‡ªå·±çš„å†…å®¹ï¼›</li><li>ä¸Šä¼ å›¾ç‰‡ â€”â€” ä¿®æ”¹å¤´åƒå’Œç¼–è¾‘æ–‡ç« æ—¶ä¸Šä¼ å›¾ç‰‡ï¼›</li><li>è¡¨å•éªŒè¯ â€”â€” ä½¿ç”¨è¡¨å•éªŒè¯ç±»ï¼›</li><li>é‡ç½®å¯†ç  â€”â€” é€šè¿‡é‚®ç®±æ‰¾å›å¯†ç </li><li>æ–‡ç« æ”¯æŒåˆ†ç±»ã€å¤šæ ‡ç­¾ã€è®¿é—®é‡ç»Ÿè®¡ï¼›</li><li>ç¼–è¾‘æ–‡ç« æ”¯æŒ markdown ç¼–è¾‘å™¨ ã€html ç¼–è¾‘å™¨ï¼›</li><li>markdown ç¼–è¾‘å™¨æ”¯æŒæ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ã€æˆªå±ç²˜è´´ä¸Šä¼ å›¾ç‰‡ã€è¯­æ³•é«˜äº®ã€é¢„è§ˆã€å…¨å±ã€åˆ†å±å®æ—¶é¢„è§ˆï¼›</li><li>æ–‡ç« å‘å¸ƒæ—¶è‡ªåŠ¨ Slug ç¿»è¯‘ï¼Œæ”¯æŒä½¿ç”¨é˜Ÿåˆ—æ–¹å¼ä»¥æé«˜å“åº”ï¼›</li><li>ç«™ç‚¹ã€æ´»è·ƒç”¨æˆ·ã€è®¡ç®—ï¼Œä¸€å°æ—¶è®¡ç®—ä¸€æ¬¡ï¼›</li><li>å¤šè§’è‰²æƒé™ç®¡ç† â€”â€” å…è®¸ç«™é•¿ï¼Œç®¡ç†å‘˜æƒé™çš„å­˜åœ¨ï¼›</li><li>åå°ç®¡ç† â€”â€” åŸºäº RBAC åå°æ•°æ®æ¨¡å‹ç®¡ç†ï¼›</li><li>é‚®ä»¶é€šçŸ¥ â€”â€” å‘é€æ–°å›å¤é‚®ä»¶é€šçŸ¥ï¼Œé˜Ÿåˆ—å‘é€é‚®ä»¶ï¼›</li><li>ç«™å†…é€šçŸ¥ â€”â€” æ–‡ç« æœ‰æ–°å›å¤ï¼›</li><li>è‡ªå®šä¹‰ Artisan å‘½ä»¤è¡Œ â€”â€” è‡ªå®šä¹‰æ´»è·ƒç”¨æˆ·è®¡ç®—å‘½ä»¤ï¼›</li><li>è‡ªå®šä¹‰ Trait â€”â€” æ´»è·ƒç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘å®ç°ï¼›</li><li>è‡ªå®šä¹‰ä¸­é—´ä»¶ â€”â€” è®°å½•ç”¨æˆ·çš„æœ€åç™»å½•æ—¶é—´ï¼›</li><li>XSS å®‰å…¨é˜²å¾¡ï¼›</li><li>ç¬¬ä¸‰æ–¹æˆæƒç™»å½•ï¼Œç›®å‰æ”¯æŒ GitHubï¼Œå…¼å®¹ Facebookï¼ŒTwitterï¼ŒLinkedInï¼ŒGoogleï¼ŒGitHubï¼ŒGitLab å’Œ Bitbucket çš„èº«ä»½éªŒè¯ï¼›</li><li>æ”¯æŒè‡ªå®šä¹‰ meta titleã€descriptionã€keywordsï¼›</li><li>æ”¯æŒå‹é“¾</li><li>ç«™ç‚¹åœ°å›¾</li><li>RSS è®¢é˜…</li></ul><h2 id="è¿è¡Œç¯å¢ƒè¦æ±‚"><a href="#è¿è¡Œç¯å¢ƒè¦æ±‚" class="headerlink" title="è¿è¡Œç¯å¢ƒè¦æ±‚"></a>è¿è¡Œç¯å¢ƒè¦æ±‚</h2><ul><li>Nginx 1.8+</li><li>PHP 7.0+</li><li>Mysql 5.7+</li><li>Redis 3.0+</li></ul><h2 id="å¼€å‘ç¯å¢ƒéƒ¨ç½²å’Œå®‰è£…"><a href="#å¼€å‘ç¯å¢ƒéƒ¨ç½²å’Œå®‰è£…" class="headerlink" title="å¼€å‘ç¯å¢ƒéƒ¨ç½²å’Œå®‰è£…"></a>å¼€å‘ç¯å¢ƒéƒ¨ç½²å’Œå®‰è£…</h2><p>æœ¬é¡¹ç›®ä»£ç ä½¿ç”¨ PHP æ¡†æ¶ laravel6.x å¼€å‘ï¼Œæœ¬åœ°å¼€å‘ç¯å¢ƒä½¿ç”¨ <a href="https://xueyuanjun.com/post/19915.html">Laravel Homestead</a>ã€‚</p><h2 id="åŸºç¡€å®‰è£…"><a href="#åŸºç¡€å®‰è£…" class="headerlink" title="åŸºç¡€å®‰è£…"></a>åŸºç¡€å®‰è£…</h2><ol><li>å…‹éš†æºä»£ç </li></ol><p>å…‹éš† <code>larablog</code> æºä»£ç åˆ°æœ¬åœ°ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// gitee<span class="token function">git</span> clone git@gitee.com:pudongping/larablog.git// GitHub<span class="token function">git</span> clone git@github.com:pudongping/larablog.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å®‰è£…æ‰©å±•åŒ…ä¾èµ–</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// å…ˆåˆ‡æ¢åˆ° larablog é¡¹ç›®æ ¹ç›®å½•<span class="token builtin class-name">cd</span> larablog// æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œå¹¶å¿½ç•¥æ‰å¼€å‘ç¯å¢ƒæ‰éœ€è¦çš„æ’ä»¶åŒ…<span class="token function">composer</span> <span class="token function">install</span> --no-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ç”Ÿæˆé…ç½®æ–‡ä»¶</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> .env.example .env<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½ å¯ä»¥æ ¹æ®æƒ…å†µä¿®æ”¹ .env æ–‡ä»¶é‡Œçš„å†…å®¹ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç¼“å­˜ã€é‚®ä»¶è®¾ç½®ã€ç¬¬ä¸‰æ–¹æˆæƒç™»å½•ç­‰ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span>localhost<span class="token assign-left variable">DB_DATABASE</span><span class="token operator">=</span>larablog<span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span>homestead<span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span>secret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>ç”Ÿæˆæ•°æ®è¡¨åŠç”Ÿæˆæµ‹è¯•æ•°æ®</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// éœ€è¦ç”Ÿæˆæµ‹è¯•æ•°æ®åˆ™æ‰§è¡Œï¼šphp artisan migrate <span class="token parameter variable">--seed</span>// ä¸éœ€è¦ç”Ÿæˆæµ‹è¯•æ•°æ®åˆ™æ‰§è¡Œï¼šphp artisan migrate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>ç”Ÿæˆç§˜é’¥</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan key:generate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6"><li>åˆ›å»º storage è½¯è¿æ¥</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan storage:link<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li>èµ‹äºˆ storage ç›¸åº”æƒé™</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// å»ºè®®åœ¨ Linux ç³»ç»Ÿä¸­æ–°å»ºä¸€ä¸ª www ç”¨æˆ·ï¼Œå¹¶è®¾ç½®è¯¥ç”¨æˆ·ä¸å¯ç™»å½•ç³»ç»Ÿ<span class="token function">useradd</span> <span class="token parameter variable">-s</span> /sbin/nologin www// å°†é¡¹ç›®ç›®å½•æ‰€æœ‰æƒèµ‹äºˆ www ç”¨æˆ·<span class="token function">chown</span> <span class="token parameter variable">-Rf</span> www:www larablog// ç»™ storage ç›®å½•èµ‹æƒé™<span class="token function">chmod</span> <span class="token parameter variable">-Rf</span> 0755 larablog/storage/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="8"><li>é…ç½® hosts æ–‡ä»¶  ï¼ˆå¦‚æœç›´æ¥æƒ³éƒ¨ç½²åœ¨çº¿ä¸Šç¯å¢ƒï¼Œåˆ™è·³è¿‡æ­¤æ­¥éª¤ï¼‰</li></ol><p>å¦‚æœå¼€å‘ç¯å¢ƒæ²¡æœ‰é‡‡ç”¨ Laravel Homestead åˆ™ ip æ˜ å°„ä»¥ä½ å®é™…ä¸ºä¸»ï¼Œä¸€èˆ¬ä¸º 127.0.0.1ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„ Laravel Homestead è™šæ‹Ÿæœºçš„ ip åœ°å€ä¸ºï¼š192.168.10.10</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// Linux æˆ– MacOS ç¯å¢ƒ<span class="token builtin class-name">echo</span> <span class="token string">"192.168.10.10   larablog.test"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts// Windows ç¯å¢ƒéœ€è¦æ‰“å¼€ C:/Windows/System32/Drivers/etc/hosts  æ–‡ä»¶ï¼Œç„¶åæ–°å¢ä¸€è¡Œ<span class="token number">192.168</span>.10.10 larablog.test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‰ç«¯å®‰è£…"><a href="#å‰ç«¯å®‰è£…" class="headerlink" title="å‰ç«¯å®‰è£…"></a>å‰ç«¯å®‰è£…</h2><ol><li>å®‰è£… npm å’Œ yarn</li></ol><p><strong>CentOS / Fedora / RHEL ç¯å¢ƒä¸‹</strong></p><blockquote><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://yarn.bootcss.com/docs/install/#centos-stable">https://yarn.bootcss.com/docs/install/#centos-stable</a></p></blockquote><ul><li>é…ç½®ç›¸åº”çš„ yum æº</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--silent</span> <span class="token parameter variable">--location</span> https://dl.yarnpkg.com/rpm/yarn.repo <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/yum.repos.d/yarn.repo<span class="token function">curl</span> <span class="token parameter variable">--silent</span> <span class="token parameter variable">--location</span> https://rpm.nodesource.com/setup_8.x <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span> -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>ä¹‹åæ‰§è¡Œä»¥ä¸‹ä»»æ„ä¸€æ¡å‘½ä»¤ï¼Œå°±å¯ä»¥äº†</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token function">yarn</span><span class="token comment">## OR ##</span><span class="token function">sudo</span> dnf <span class="token function">install</span> <span class="token function">yarn</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Windows ç¯å¢ƒä¸‹</strong></p><ul><li>å®‰è£… node.js</li></ul><p>ç›´æ¥å»å®˜ç½‘ <a href="https://nodejs.org/en/">https://nodejs.org/en</a> ä¸‹è½½å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚</p><ul><li>å®‰è£… Yarn</li></ul><p>è¯·å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Yarn â€”â€” <a href="https://nodejs.org/en/">http://yarnpkg.cn/zh-Hans/docs/install</a></p><ol start="2"><li>ä¸º NPM å’Œ Yarn é…ç½®æ·˜å®é•œåƒï¼ŒåŠ é€Ÿå®‰è£…åŒ…ä¸‹è½½</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> config <span class="token builtin class-name">set</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span>https://registry.npm.taobao.org<span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>ä½¿ç”¨ Yarn å®‰è£…å‰ç«¯ä¾èµ–åŒ…</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">install</span>æˆ–è€…<span class="token function">npm</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç›‘æ§ resources æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºæ–‡ä»¶æ˜¯å¦æœ‰å‘ç”Ÿæ”¹å˜ã€‚åœ¨ watch-poll å‘½ä»¤è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œä¸€æ—¦èµ„æºæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼ŒWebpack ä¼šè‡ªåŠ¨é‡æ–°ç¼–è¯‘ã€‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run watch-poll// å¦‚æœé‡åˆ°æŠ¥é”™ï¼Œå°è¯•å…ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–° <span class="token function">npm</span> åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä¹‹åå†æ¬¡æ‰§è¡Œç›‘æ§å‘½ä»¤<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> <span class="token function">npm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¼–è¯‘å‰ç«¯å†…å®¹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// è¿è¡Œæ‰€æœ‰ Mix ä»»åŠ¡<span class="token function">npm</span> run dev// è¿è¡Œæ‰€æœ‰ Mix ä»»åŠ¡å¹¶ç¼©å°è¾“å‡º<span class="token function">npm</span> run production// æˆ–è€…æ‰§è¡Œ<span class="token function">yarn</span> production<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è®¿é—®å…¥å£"><a href="#è®¿é—®å…¥å£" class="headerlink" title="è®¿é—®å…¥å£"></a>è®¿é—®å…¥å£</h2><ul><li>é¦–é¡µåœ°å€ï¼š <a href="http://larablog.test/">http://larablog.test</a></li><li>åå°ç®¡ç†ï¼š<a href="http://larablog.test/admin">http://larablog.test/admin</a></li></ul><p>ç®¡ç†å‘˜è´¦å·å¯†ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">username: <span class="token number">1414818093</span>@qq.compassword: <span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é»˜è®¤ç½‘ç«™ç¬¬ä¸€ä½ç”¨æˆ·ä¸ºç«™é•¿è§’è‰²ï¼Œç¬¬äºŒä½ç”¨æˆ·ä¸ºç®¡ç†å‘˜è§’è‰²ã€‚å¦‚æœå¡«å……äº†æµ‹è¯•æ•°æ®ï¼Œåˆ™é»˜è®¤æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ä¸ºï¼š123456</p><p>==è‡³æ­¤ï¼Œå®‰è£…å®Œæˆ^_^ã€‚enjoy yourselfâ€¦â€¦==</p><h2 id="åç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ"><a href="#åç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ" class="headerlink" title="åç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ"></a>åç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ</h2><table><thead><tr><th>æ‰©å±•åŒ…</th><th>ç®€ä»‹æè¿°</th><th>æœ¬é¡¹ç›®åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><a href="https://packagist.org/packages/laravel/ui">laravel/ui</a></td><td>laravel 6.x UI è„šæ‰‹æ¶</td><td>å‰ç«¯é¡µé¢æ¡†æ¶</td></tr><tr><td><a href="https://github.com/barryvdh/laravel-ide-helper">barryvdh/laravel-ide-helper</a></td><td>èƒ½è®©ä½ çš„ IDE (PHPStorm, Sublime) å®ç°è‡ªåŠ¨è¡¥å…¨ã€ä»£ç æ™ºèƒ½æç¤ºå’Œä»£ç è·Ÿè¸ªç­‰åŠŸèƒ½</td><td>ä»£ç è¡¥å…¨å’Œæ™ºèƒ½æç¤º</td></tr><tr><td><a href="https://github.com/barryvdh/laravel-debugbar">barryvdh/laravel-debugbar</a></td><td>é¡µé¢è°ƒè¯•å·¥å…·æ  (å¯¹ phpdebugbar çš„å°è£…)</td><td>å¼€å‘ç¯å¢ƒä¸­çš„ DEBUG</td></tr><tr><td><a href="https://github.com/overtrue/laravel-lang">overtrue/laravel-lang</a></td><td>æ”¯æŒ 52 ä¸ªå›½å®¶çš„è¯­è¨€åŒ…</td><td>ç¿»è¯‘ Laravel è‡ªå¸¦æ¨¡æ¿</td></tr><tr><td><a href="https://github.com/mewebstudio/captcha">mews/captcha</a></td><td>å›¾ç‰‡éªŒè¯ç </td><td>æ³¨å†Œé¡µé¢å›¾ç‰‡éªŒè¯ç </td></tr><tr><td><a href="https://github.com/Intervention/image">intervention/image</a></td><td>å›¾ç‰‡å¤„ç†åŠŸèƒ½åº“</td><td>ç”¨äºå›¾ç‰‡è£å‰ª</td></tr><tr><td><a href="https://github.com/summerblue-ext-forks/active">summerblue/laravel-active</a></td><td>æ–¹ä¾¿è®¾ç½® active ç±»</td><td>æ–‡ç« æ’åºæ·»åŠ  active ç±»</td></tr><tr><td><a href="https://github.com/mewebstudio/Purifier">mews/purifier</a></td><td>ç”¨æˆ·æäº¤çš„ Html ç™½åå•è¿‡æ»¤</td><td>æ–‡ç« å†…å®¹çš„ Html å®‰å…¨è¿‡æ»¤ï¼Œé˜²æ­¢ XSS æ”»å‡»</td></tr><tr><td><a href="https://github.com/guzzle/guzzle">guzzlehttp/guzzle</a></td><td>HTTP è¯·æ±‚å¥—ä»¶</td><td>è¯·æ±‚ç™¾åº¦ç¿»è¯‘ APIï¼Œç¿»è¯‘æ–‡ç« æ ‡é¢˜ï¼Œåš SEO ä¼˜åŒ–</td></tr><tr><td><a href="https://github.com/overtrue/pinyin">overtrue/pinyin</a></td><td>åŸºäº CC-CEDICT è¯å…¸çš„ä¸­æ–‡è½¬æ‹¼éŸ³å·¥å…·</td><td>ç¿»è¯‘æ–‡ç« æ ‡é¢˜çš„å¤‡ç”¨æ–¹æ¡ˆ</td></tr><tr><td><a href="https://github.com/nrk/predis">predis/predis</a></td><td>Redis å®˜æ–¹é¦–æ¨çš„ PHP å®¢æˆ·ç«¯å¼€å‘åŒ…</td><td>ç¼“å­˜é©±åŠ¨ Redis åŸºç¡€æ‰©å±•åŒ…</td></tr><tr><td><a href="https://learnku.com/docs/laravel/6.x/horizon/5190">laravel/horizon</a></td><td>é˜Ÿåˆ—ç›‘æ§</td><td>é˜Ÿåˆ—ç›‘æ§å‘½ä»¤ä¸é¡µé¢æ§åˆ¶å° /horizon</td></tr><tr><td><a href="https://github.com/spatie/laravel-permission">spatie/laravel-permission</a></td><td>è§’è‰²æƒé™ç®¡ç†</td><td>è§’è‰²å’Œæƒé™æ§åˆ¶</td></tr><tr><td><a href="https://github.com/viacreative/sudo-su">viacreative/sudo-su</a></td><td>ç”¨æˆ·åˆ‡æ¢</td><td>è°ƒè¯•ç¯å¢ƒä¸­å¿«é€Ÿåˆ‡æ¢ç™»å½•è´¦å·</td></tr><tr><td><a href="https://github.com/erusev/parsedown">erusev/parsedown</a></td><td>markdown è½¬æ¢ html å·¥å…·</td><td>æ–‡ç« æ¨¡å—è§£æ markdown è¯­æ³•</td></tr><tr><td><a href="https://github.com/thephpleague/html-to-markdown">thephpleague/html-to-markdown</a></td><td>html è½¬æ¢æˆ markdown å·¥å…·</td><td>æ–‡ç« ç¼–è¾‘é‡‡ç”¨ markdown ç¼–è¾‘å™¨æ—¶</td></tr><tr><td><a href="https://socialiteproviders.netlify.com/providers/git-hub.html">laravel/socialite</a></td><td>laravel å®˜æ–¹æ¨èç¤¾ä¼šåŒ–ç™»å½•</td><td>Github ç™»å½•</td></tr><tr><td><a href="https://packagist.org/packages/suin/php-rss-writer">suin/php-rss-writer</a></td><td>rss è®¢é˜…ç”Ÿæˆ</td><td>ç”Ÿæˆ rss è®¢é˜…ä»£ç </td></tr><tr><td><a href="https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md">hhxsv5/laravel-s</a></td><td>LaravelS æ˜¯ Swoole å’Œ Laravel/Lumen ä¹‹é—´å¼€ç®±å³ç”¨çš„é€‚é…å™¨</td><td>ä¼˜åŒ–è®¿é—®é€Ÿåº¦</td></tr></tbody></table><h2 id="å‰ç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ"><a href="#å‰ç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ" class="headerlink" title="å‰ç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ"></a>å‰ç«¯æ‰©å±•åŒ…ä½¿ç”¨æƒ…å†µ</h2><table><thead><tr><th>æ‰©å±•åŒ…</th><th>ç®€ä»‹æè¿°</th><th>æœ¬é¡¹ç›®åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><a href="https://fontawesome.com/">yarn add @fortawesome/fontawesome-free</a></td><td>Font Awesome æä¾›äº†å¯ç¼©æ”¾çš„çŸ¢é‡å›¾æ ‡</td><td>å­—ä½“å›¾æ ‡åº“</td></tr><tr><td><a href="https://github.com/BlackrockDigital/startbootstrap-sb-admin-2">npm i startbootstrap-sb-admin-2</a></td><td>ç•Œé¢ç®€æ´ç¾è§‚çš„çš®è‚¤</td><td>cms åå°æ¨¡æ¿</td></tr><tr><td><a href="https://simplemde.com/">npm install simplemde</a></td><td>markdown ç¼–è¾‘å™¨</td><td>æ–‡ç« ç¼–è¾‘å™¨</td></tr><tr><td><a href="https://highlightjs.org/">npm install highlight.js</a></td><td>è¯­æ³•é«˜äº®å·¥å…·</td><td>markdown ç¼–è¾‘å™¨ä»£ç è¯­æ³•é«˜äº®</td></tr><tr><td><a href="https://github.com/Rovak/InlineAttachment">npm install inline-attachment</a></td><td>æ–‡æœ¬æ¡†æ‹–åŠ¨ä¸Šä¼ å›¾ç‰‡å·¥å…·</td><td>markdown æ–‡æœ¬æ¡†å›¾ç‰‡æ‹–åŠ¨ä¸Šä¼ </td></tr><tr><td><a href="http://loudev.com/">multiselect.js</a></td><td>å¤šé€‰ä¸‹æ‹‰æ¡†</td><td>æ–‡ç« å¤šé€‰æ ‡ç­¾</td></tr><tr><td><a href="https://www.chartjs.org/">chartjs</a></td><td>å›¾è¡¨æ’ä»¶</td><td>åå°ç®¡ç†ç•Œé¢å›¾è¡¨</td></tr></tbody></table><h2 id="é‚®ç®±è®¤è¯"><a href="#é‚®ç®±è®¤è¯" class="headerlink" title="é‚®ç®±è®¤è¯"></a>é‚®ç®±è®¤è¯</h2><ul><li>å¼€å‘ç¯å¢ƒæ—¶å°† <code>.ENV</code> æ–‡ä»¶è®¾ç½®ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼Œå°†é‚®ç®±è®¤è¯é‚®ä»¶å‘é€è‡³å½“å‰æ—¥å¿—ä¸­ï¼Œä»¥ä¾¿è°ƒè¯•  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">MAIL_DRIVER</span><span class="token operator">=</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå»ºè®®å°† <code>.ENV</code> æ–‡ä»¶ä¸­ç›¸å…³é‚®ä»¶è®¾ç½®ä¸ºè‡ªå·±æ‰€éœ€é…ç½®ï¼Œä»¥ä¸‹ä¸ºé»˜è®¤é…ç½®  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">MAIL_DRIVER</span><span class="token operator">=</span>smtp<span class="token assign-left variable">MAIL_HOST</span><span class="token operator">=</span>smtp.mailtrap.io<span class="token assign-left variable">MAIL_PORT</span><span class="token operator">=</span><span class="token number">2525</span><span class="token assign-left variable">MAIL_USERNAME</span><span class="token operator">=</span>null<span class="token assign-left variable">MAIL_PASSWORD</span><span class="token operator">=</span>null<span class="token assign-left variable">MAIL_ENCRYPTION</span><span class="token operator">=</span>null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="ç¿»è¯‘é˜Ÿåˆ—"><a href="#ç¿»è¯‘é˜Ÿåˆ—" class="headerlink" title="ç¿»è¯‘é˜Ÿåˆ—"></a>ç¿»è¯‘é˜Ÿåˆ—</h2><ul><li>ä¿®æ”¹ <code>.ENV</code> æ–‡ä»¶è®¾ç½®ä¸º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒçš„è¯ï¼Œå°±æŠŠé˜Ÿåˆ—é©±åŠ¨æ”¹å› sync åŒæ­¥æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä½¿ç”¨ä»»ä½•é˜Ÿåˆ—ï¼Œå®æ—¶æ‰§è¡Œï¼š</span><span class="token assign-left variable">QUEUE_CONNECTION</span><span class="token operator">=</span>redis<span class="token assign-left variable">REDIS_CLIENT</span><span class="token operator">=</span>predis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨é˜Ÿåˆ—ç³»ç»Ÿï¼Œé˜Ÿåˆ—åœ¨å¯åŠ¨å®Œæˆåä¼šè¿›å…¥ç›‘å¬çŠ¶æ€</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan queue:listenæˆ–è€…ä½¿ç”¨php artisan horizon<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–‡ç« æ ‡é¢˜ç¿»è¯‘"><a href="#æ–‡ç« æ ‡é¢˜ç¿»è¯‘" class="headerlink" title="æ–‡ç« æ ‡é¢˜ç¿»è¯‘"></a>æ–‡ç« æ ‡é¢˜ç¿»è¯‘</h2><blockquote><p><a href="http://api.fanyi.baidu.com/api/trans/product/apidoc">ä½¿ç”¨äº†ç™¾åº¦ç¿»è¯‘ api</a>ï¼Œè¯·å°† <code>.ENV</code>ä¸­çš„ç™¾åº¦ api ç›¸å…³ä¿¡æ¯æ¢æˆä½ è‡ªå·±çš„<a href="http://api.fanyi.baidu.com/api/trans/product/desktop?req=developer">å¼€å‘è€…ä¿¡æ¯</a></p></blockquote><p>å¦‚æœä¸é‡‡ç”¨ç™¾åº¦ç¿»è¯‘ç¿»è¯‘æ–‡ç« æ ‡é¢˜çš„è¯ï¼Œé‚£ä¹ˆä¸ç”¨é…ç½® <code>.ENV</code> æ–‡ä»¶ä¸­ä»¥ä¸‹é…ç½®é¡¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç™¾åº¦ç¿»è¯‘ APP ID</span><span class="token assign-left variable">BAIDU_TRANSLATE_APPID</span><span class="token operator">=</span><span class="token comment"># ç™¾åº¦ç¿»è¯‘å¯†é’¥ KEY</span><span class="token assign-left variable">BAIDU_TRANSLATE_KEY</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¹¶ä¸”ä¹Ÿä¸éœ€è¦æ›´æ”¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">QUEUE_CONNECTION</span><span class="token operator">=</span>redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é»˜è®¤ä¿æŒä¸º</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">QUEUE_CONNECTION</span><span class="token operator">=</span>sync<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™æ ·å°†ä¼šæ¯å‘ä¸€ç¯‡æ–‡ç« æ—¶ï¼Œå°†æ–‡ç« æ ‡é¢˜ç›´æ¥ç¿»è¯‘æˆæ‹¼éŸ³è¾¾åˆ° slug çš„æ•ˆæœã€‚</p><h2 id="é‚®ä»¶é€šçŸ¥"><a href="#é‚®ä»¶é€šçŸ¥" class="headerlink" title="é‚®ä»¶é€šçŸ¥"></a>é‚®ä»¶é€šçŸ¥</h2><blockquote><p>å¦‚æœä¸æƒ³è¦ï¼Œå‘è¡¨æ–‡ç« è¯„è®ºæ—¶æœ‰é‚®ä»¶é€šçŸ¥ï¼Œå¯ä»¥ä¸ç”¨é…ç½®ï¼Œç›´æ¥å¿½ç•¥ï¼ŒåŠŸèƒ½ä¸Šæ²¡æœ‰ä»»ä½•å½±å“</p></blockquote><ol><li>éœ€è¦å…ˆå¼€å¯ QQ é‚®ç®±çš„ SMTP æ”¯æŒ</li></ol><p><a href="https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;id=28&amp;no=166">å¦‚ä½•æ‰“å¼€ POP3/SMTP/IMAP åŠŸèƒ½ï¼Ÿ</a></p><ol start="2"><li>é‚®ç®±å‘é€é…ç½® ï¼ˆè¯·å°†ä»¥ä¸‹é…ç½®æ¢æˆä½ è‡ªå·±çš„é‚®ç®±é…ç½®ï¼‰</li></ol><blockquote><p>å¦‚æœä½ æ˜¯ä½¿ç”¨çš„é˜¿é‡Œäº‘ ECSï¼Œé‚£ä¹ˆä¸€å®šè¦æ³¨æ„ï¼Œé˜¿é‡Œäº‘çš„ ECS é»˜è®¤ç¦ç”¨äº† 25 ç«¯å£ï¼Œéœ€è¦å•ç‹¬ç”³è¯·è§£å°25ç«¯å£ï¼Œ<a href="https://yundun.console.aliyun.com/?spm=5176.2020520101.console-base-top.duser-0.33bf4df5FEFEdS&amp;p=sc#/sc/port">ç‚¹æˆ‘è§£å°é˜¿é‡Œäº‘ ECS 25ç«¯å£</a>ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•è§£å°ï¼Œè¯·æŸ¥çœ‹ <a href="https://help.aliyun.com/knowledge_detail/56130.html">è§£å°æ­¥éª¤</a>ã€‚å½“ç„¶æ›¿ä»£æ–¹æ¡ˆï¼Œä½ å¯ä»¥é‡‡ç”¨ 465 ç«¯å£ï¼Œå¦‚æœä½ æ‰“ç®—é‡‡ç”¨ 465 ç«¯å£ï¼Œé‚£ä¹ˆéœ€è¦å°†ä»¥ä¸‹é…ç½®ä¸­çš„ <code>MAIL_PORT</code> ä¿®æ”¹ä¸º 465,å¹¶ä¸”ä¹Ÿéœ€è¦å°†åŠ å¯†ç±»å‹ <code>MAIL_ENCRYPTION</code> ä¿®æ”¹ä¸º ssl å³å¯ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ qq é‚®ç®±ï¼Œå¯èƒ½å…¶ä»–çš„é‚®ç®±æœåŠ¡æœ‰å·®å¼‚ï¼Œè§†æƒ…å†µè€Œå®šå§ã€‚</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨æ”¯æŒ ESMTP çš„ SMTP æœåŠ¡å™¨å‘é€é‚®ä»¶</span><span class="token assign-left variable">MAIL_DRIVER</span><span class="token operator">=</span>smtp<span class="token comment"># QQ é‚®ç®±çš„ SMTP æœåŠ¡å™¨åœ°å€ï¼Œå¿…é¡»ä¸ºæ­¤å€¼</span><span class="token assign-left variable">MAIL_HOST</span><span class="token operator">=</span>smtp.qq.com<span class="token comment"># QQ é‚®ç®±çš„ SMTP æœåŠ¡å™¨ç«¯å£ï¼Œå¿…é¡»ä¸ºæ­¤å€¼</span><span class="token assign-left variable">MAIL_PORT</span><span class="token operator">=</span><span class="token number">25</span><span class="token comment"># è¯·å°†æ­¤å€¼æ¢ä¸ºä½ çš„ QQ + @qq.com</span><span class="token assign-left variable">MAIL_USERNAME</span><span class="token operator">=</span>xxxxxxxxxxxxxx@qq.com<span class="token comment"># å¯†ç æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥æ‹¿åˆ°çš„æˆæƒç </span><span class="token assign-left variable">MAIL_PASSWORD</span><span class="token operator">=</span>xxxxxxxxx<span class="token comment"># åŠ å¯†ç±»å‹ï¼Œé€‰é¡¹ null è¡¨ç¤ºä¸ä½¿ç”¨ä»»ä½•åŠ å¯†ï¼Œå…¶ä»–é€‰é¡¹è¿˜æœ‰ sslï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ tls å³å¯ï¼Œå¦‚æœå‡ºç°æŠ¥é”™çš„è¯ï¼Œå¤šåŠæ˜¯å› ä¸ºè¿™ä¸ª smtp ä¸»æœºä¸æ”¯æŒ TLSï¼Œé‚£ä¹ˆåªéœ€è¦å°†æ­¤é¡¹è®¾ç½®ä¸º null å³å¯ã€‚</span><span class="token assign-left variable">MAIL_ENCRYPTION</span><span class="token operator">=</span>tls<span class="token comment"># æ­¤å€¼å¿…é¡»åŒ MAIL_USERNAME ä¸€è‡´</span><span class="token assign-left variable">MAIL_FROM_ADDRESS</span><span class="token operator">=</span>xxxxxxxxxxxxxx@qq.com<span class="token comment"># ç”¨æ¥ä½œä¸ºé‚®ä»¶çš„å‘é€è€…åç§°</span><span class="token assign-left variable">MAIL_FROM_NAME</span><span class="token operator">=</span>ç•ªèŒ„ç‚–åœŸè±†çš„ä¸ªäººåšå®¢<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å¦‚æœéœ€è¦æ”¯æŒé˜Ÿåˆ—ï¼Œè¯·å°† <code>.ENV</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®æˆ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">QUEUE_CONNECTION</span><span class="token operator">=</span>redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç”¨æˆ·åˆ‡æ¢è°ƒè¯•"><a href="#ç”¨æˆ·åˆ‡æ¢è°ƒè¯•" class="headerlink" title="ç”¨æˆ·åˆ‡æ¢è°ƒè¯•"></a>ç”¨æˆ·åˆ‡æ¢è°ƒè¯•</h2><p>é»˜è®¤åªåœ¨è°ƒè¯•æ¨¡å¼ <code>.ENV</code> æ–‡ä»¶ä¸­</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">APP_DEBUG</span><span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ—¶å¯ç”¨ï¼Œä¸” <code>config/sudosu.php</code> æ–‡ä»¶ä¸­</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// å…è®¸ä½¿ç”¨çš„é¡¶çº§åŸŸå</span><span class="token string single-quoted-string">'allowed_tlds'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'dev'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'local'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é¡¶çº§åŸŸåï¼ˆTop Level Domainï¼‰åŠ å…¥ä½ åŸŸåçš„é¡¶çº§åŸŸå</p><h2 id="ç¬¬ä¸‰æ–¹æˆæƒç™»å½•"><a href="#ç¬¬ä¸‰æ–¹æˆæƒç™»å½•" class="headerlink" title="ç¬¬ä¸‰æ–¹æˆæƒç™»å½•"></a>ç¬¬ä¸‰æ–¹æˆæƒç™»å½•</h2><p>ç›®å‰é¡¹ç›®ä¸­åªæ”¯æŒ github æˆæƒç™»å½•ï¼Œå› ä¸ºåªç”³è¯·äº† GitHub çš„ OAuth applicationï¼Œå¦‚æœä½ ä¹Ÿéœ€è¦ä½¿ç”¨ GitHub ä½œä¸ºç¬¬ä¸‰æ–¹æˆæƒç™»å½•ï¼Œé‚£ä¹ˆéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</p><ol><li>åœ¨ GitHub ä¸Šæ³¨å†Œä¸€ä¸ª <a href="https://github.com/settings/applications/new">OAuth application</a></li></ol><ul><li>Application nameï¼šä½ å¯ä»¥å¡«å†™ä½ è‡ªå·±çš„åº”ç”¨åç§°ï¼Œæ¯”å¦‚ï¼šmyWebBlog</li><li>Homepage URLï¼šé¦–é¡µè¿æ¥åœ°å€éœ€è¦æ·»åŠ ä½ è‡ªå·±çš„ï¼Œæ¯”å¦‚ï¼š<a href="http://larablog.test/">http://larablog.test</a></li><li>Application descriptionï¼šåº”ç”¨æè¿°å¯ä»¥éšä¾¿å¡«å†™ï¼Œæ¯”å¦‚ï¼šè‡ªå·±çš„åšå®¢</li><li>Authorization callback URLï¼šæˆæƒå›è°ƒåœ°å€ï¼Œä¸€å®šè¦å¡«å†™æˆï¼š <your domain="">/login/github/callback  ï¼Œæ¯”å¦‚ï¼Œæˆ‘è¿™é‡Œåˆ™éœ€è¦å¡«å†™æˆï¼š<a href="http://larablog.test/login/github/callback">http://larablog.test/login/github/callback</a></your></li></ul><ol start="2"><li>æ³¨å†ŒæˆåŠŸä¹‹åï¼Œéœ€è¦åœ¨ <code>.ENV</code> é…ç½®æ–‡ä»¶ä¸­å¡«å†™ç”³è¯·æˆåŠŸçš„ Client ID å’Œ Client Secretã€‚å¡«å†™å¥½ä¹‹åï¼Œç›´æ¥è®¿é—®  <a href="http://larablog.test/login/github">http://larablog.test/login/github</a>  å³å¯æ”¯æŒ GitHub ç¬¬ä¸‰æ–¹æˆæƒç™»å½•ï¼Œå¦‚æœä¸è®¾ç½® <code>.ENV</code> é…ç½®æ–‡ä»¶ï¼Œåˆ™ç™»å½•ã€æ³¨å†Œé¡µé¢ä¸ä¼šæ˜¾ç¤º GitHub ç¬¬ä¸‰æ–¹æˆæƒç™»å½•å…¥å£ã€‚</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Github Client ID</span><span class="token assign-left variable">GITHUB_CLIENT_ID</span><span class="token operator">=</span><span class="token comment"># Github Client Secret</span><span class="token assign-left variable">GITHUB_CLIENT_SECRET</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æ‰©å±•å…¶å®ƒç¬¬ä¸‰æ–¹æˆæƒç™»å½•ã€‚<blockquote><p>Socialite ç›®å‰æ”¯æŒ Facebookï¼ŒTwitterï¼ŒLinkedInï¼ŒGoogleï¼ŒGitHubï¼ŒGitLab å’Œ Bitbucket çš„èº«ä»½éªŒè¯ã€‚æœ¬é¡¹ç›®å·²ç»å¯¹ä»¥ä¸Šæ”¯æŒçš„ç¬¬ä¸‰æ–¹ç™»å½•åšäº†å…¼å®¹æ€§å¤„ç†ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ”¯æŒä»¥ä¸Šé™¤ GitHub ä»¥å¤–çš„åº”ç”¨ï¼ˆå› ä¸ºç›®å‰å·²ç»è®¾ç½®å¥½äº† GitHub ç›¸å…³çš„é…ç½®ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§ä»¥ä¸‹çš„æ­¥éª¤é…ç½®å³å¯ã€‚è¿™é‡Œä»¥ Google ä¸ºä¾‹å­ã€‚</p></blockquote></li></ol><ul><li>ç¬¬ä¸€æ­¥ï¼šç”³è¯· <code>google</code> çš„ Client ID å’Œ Client Secretã€‚</li><li>ç¬¬äºŒæ­¥ï¼šå°†ç”³è¯·çš„ Client ID å’Œ Client Secret å¡«å†™å…¥ <code>.ENV</code> é…ç½®æ–‡ä»¶ä¸­</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">GOOGLE_CLIENT_ID</span><span class="token operator">=</span><span class="token string">"your google client id"</span><span class="token assign-left variable">GOOGLE_CLIENT_SECRET</span><span class="token operator">=</span><span class="token string">"your google client secret"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ç¬¬ä¸‰æ­¥ï¼šé…ç½® app/services.php</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token string">'google'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>    <span class="token string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> env<span class="token punctuation">(</span><span class="token string">'GOOGLE_CLIENT_ID'</span><span class="token punctuation">)</span>,  // google å®¢æˆ·ç«¯æˆæƒ ID    <span class="token string">'client_secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> env<span class="token punctuation">(</span><span class="token string">'GOOGLE_CLIENT_SECRET'</span><span class="token punctuation">)</span>,  // google å®¢æˆ·ç«¯æˆæƒå¯†é’¥    <span class="token string">'redirect'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'/login/google/callback'</span>,  // æˆæƒå›è°ƒé“¾æ¥ å¦‚æœ redirect é…ç½®é¡¹åŒ…å«çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å…¶è½¬åŒ–ä¸ºå®Œæ•´ URL<span class="token punctuation">]</span>,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬å››æ­¥ï¼šå°†ç¬¬ä¸‰æ–¹æœåŠ¡æ·»åŠ åˆ° <code>app/Models/Auth/User.php</code> =&gt; <code>$allowedProviders</code> æ•°ç»„ä¸­</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">public static <span class="token variable">$allowedProviders</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'github'</span>, <span class="token string">'google'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç¬¬äº”æ­¥ï¼šç›´æ¥è®¿é—® <your domain="">/login/google å³å¯</your></li></ul><h2 id="è‡ªå®šä¹‰-Artisan-å‘½ä»¤"><a href="#è‡ªå®šä¹‰-Artisan-å‘½ä»¤" class="headerlink" title="è‡ªå®šä¹‰ Artisan å‘½ä»¤"></a>è‡ªå®šä¹‰ Artisan å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>Cron</th></tr></thead><tbody><tr><td>php artisan larablog:calculate-active-user</td><td>ç”Ÿæˆæ´»è·ƒç”¨æˆ·</td><td>ä¸€ä¸ªå°æ—¶è¿è¡Œä¸€æ¬¡</td></tr><tr><td>php artisan larablog:sync-article-view-count</td><td>åŒæ­¥æ–‡ç« çš„è®¿é—®é‡</td><td>æ¯å¤©æ—©ä¸Š 0 ç‚¹å‡†æ—¶</td></tr><tr><td>php artisan larablog:sync-user-actived-at</td><td>ä» Redis ä¸­åŒæ­¥æœ€åç™»å½•æ—¶é—´åˆ°æ•°æ®åº“ä¸­</td><td>æ¯å¤©æ—©ä¸Š 0 ç‚¹å‡†æ—¶</td></tr></tbody></table><h2 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h2><p>å½“å‰è®¡åˆ’ä»»åŠ¡ä¸»è¦æ˜¯è®¡ç®—ä¸»é¡µå³ä¾§ ã€Œæ´»è·ƒç”¨æˆ·ã€</p><p><code>artisan</code> å‘½ä»¤ä¸ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan larablog:calculate-active-user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åŒæ­¥æ–‡ç« çš„è®¿é—®é‡</p><p><code>artisan</code> å‘½ä»¤ä¸ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan larablog:sync-article-view-count<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å’ŒåŒæ­¥ ã€Œç”¨æˆ·æœ€åæ´»è·ƒæ—¶é—´ã€ åˆ°æ•°æ®åº“</p><p><code>artisan</code> å‘½ä»¤ä¸ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan larablog:sync-user-actived-at<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¹¶ä¸”å·²ç»åœ¨ <code>è°ƒåº¦å™¨</code> ä¸­è®¾ç½®å¥½äº†ç›¸å…³ä»£ç ã€‚ï¼ˆè°ƒåº¦å™¨åœ¨ app/Console/Kernel.php æ–‡ä»¶çš„ schedule æ–¹æ³•ä¸­å®šä¹‰ï¼‰</p><p>ä½¿ç”¨ Linux ç³»ç»Ÿçš„ Cron è®¡åˆ’ä»»åŠ¡éœ€æ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">EDITOR</span><span class="token operator">=</span>vi <span class="token operator">&amp;&amp;</span> <span class="token function">crontab</span> <span class="token parameter variable">-e</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼ˆæ³¨æ„å°†é¡¹ç›®æ ¹ç›®å½•æ¢æˆä½ è‡ªå·±çš„ï¼‰<br>è¿™é‡Œæˆ‘çš„é¡¹ç›®æ ¹ç›®å½•ä¸ºï¼š<code>/home/vagrant/Code/larablog</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">* * * * * php /home/vagrant/Code/larablog/artisan schedule:run <span class="token operator">&gt;&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>å¦‚æœä¸è®¾å®šè®¡åˆ’ä»»åŠ¡çš„è¯ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸Š Artisan å‘½ä»¤çš„è¯ä¼šæ˜¯å¦‚ä¸‹æƒ…å†µï¼š<br>ã€Œæ´»è·ƒç”¨æˆ·ã€å°†æ¯ 65 åˆ†é’Ÿé‡æ–°ç”Ÿæˆä¸€æ¬¡ï¼Œè®¾å®šè®¡åˆ’ä»»åŠ¡çš„è¯ï¼Œé»˜è®¤ä¸€ä¸ªå°æ—¶é‡æ–°ç”Ÿæˆä¸€æ¬¡ã€‚<br>ã€Œç”¨æˆ·æœ€åæ´»è·ƒæ—¶é—´ã€å°†ä¸ä¼šåŒæ­¥åˆ°æ•°æ®åº“ä¸­ï¼Œå°†ä¼šç›´æ¥ä» Redis ä¸­è·å–ï¼Œå¦‚æœ Redis ä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä»¥ç”¨æˆ·æ³¨å†Œæ—¶é—´æ›¿ä»£ã€‚</p></blockquote><h2 id="é˜Ÿåˆ—æ¸…å•"><a href="#é˜Ÿåˆ—æ¸…å•" class="headerlink" title="é˜Ÿåˆ—æ¸…å•"></a>é˜Ÿåˆ—æ¸…å•</h2><table><thead><tr><th>æ–‡ä»¶è·¯å¾„</th><th>è¯´æ˜</th><th>è°ƒç”¨æ—¶æœº</th></tr></thead><tbody><tr><td>app\Notifications\ArticleReplied.php</td><td>é€šçŸ¥æ–‡ç« ä½œè€…æœ‰æ–°è¯„è®ºå›å¤</td><td>æ–‡ç« è¢«è¯„è®ºä»¥å App\Observers\Portal\Article\ReplyObserver@created</td></tr><tr><td>app\Jobs\TranslateSlug.php</td><td>å°†æ–‡ç« æ ‡é¢˜ç¿»è¯‘ä¸º Slug</td><td>æ–‡ç« ä¿å­˜æ—¶ App\Observers\Portal\Article\ArticleObserver@saved</td></tr></tbody></table><h2 id="çº¿ä¸Šéƒ¨ç½²"><a href="#çº¿ä¸Šéƒ¨ç½²" class="headerlink" title="çº¿ä¸Šéƒ¨ç½²"></a>çº¿ä¸Šéƒ¨ç½²</h2><p>å¦‚æœéœ€è¦ä¼˜åŒ–ç½‘ç«™æ‰“å¼€é€Ÿåº¦ï¼Œå¯ä¾æ¬¡è¿›è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š</p><ul><li>å‹ç¼©å‰ç«¯ä»£ç </li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run prod<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç¼“å­˜è·¯ç”±</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼“å­˜è·¯ç”±</span>php artisan route:cache<span class="token comment"># æ¸…ç©ºè·¯ç”±ç¼“å­˜</span>php artisan route:clear<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¼“å­˜é…ç½®æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼“å­˜é…ç½®æ–‡ä»¶</span>php artisan config:cache<span class="token comment"># æ¸…ç©ºé…ç½®æ–‡ä»¶ç¼“å­˜</span>php artisan cache:clear<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>composer ä¼˜åŒ–</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">composer</span> dump-autoload <span class="token parameter variable">--optimize</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç±»æ˜ å°„åŠ è½½ä¼˜åŒ–</li></ul><p>åœ¨ <code>laravel 6.x</code> ä¸­ï¼Œä¼šç”Ÿæˆ <code>bootstrap/cache/config.php</code> å’Œ <code>bootstrap/cache/packages.php</code> å’Œ <code>bootstrap/cache/routes.php</code> å’Œ <code>bootstrap/cache/services.php</code> è¿™å››ä¸ªæ–‡ä»¶ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php artisan optimize<span class="token comment"># æ¸…ç©ºç±»æ˜ å°„</span>php artisan optimize:clear<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨ swoole åŠ é€Ÿç½‘ç«™</li></ul><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ <a href="https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md">laravelS</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php bin/laravels start <span class="token parameter variable">-d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚è€ƒä»¥ä¸‹å†…å®¹é…ç½® nginx é…ç½®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">upstream swoole <span class="token punctuation">{</span>    <span class="token comment"># å¦‚æœæ˜¯ä½¿ç”¨ laradock ï¼Œè¯·å°† 127.0.0.1 æ›´æ”¹ä¸º workspace</span>    server <span class="token number">127.0</span>.0.1:5200 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">5</span> <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>30s<span class="token punctuation">;</span>    keepalive <span class="token number">16</span><span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>    listen <span class="token number">80</span><span class="token punctuation">;</span>    server_name pudongping.com blog.pudongping.com<span class="token punctuation">;</span>    root /www/wwwroot/larablog/public<span class="token punctuation">;</span>    index index.html index.htm index.php<span class="token punctuation">;</span>    charset utf-8<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        try_files <span class="token variable">$uri</span> @laravels<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    location <span class="token operator">=</span> /favicon.ico <span class="token punctuation">{</span> access_log off<span class="token punctuation">;</span> log_not_found off<span class="token punctuation">;</span> <span class="token punctuation">}</span>    location <span class="token operator">=</span> /robots.txt  <span class="token punctuation">{</span> access_log off<span class="token punctuation">;</span> log_not_found off<span class="token punctuation">;</span> <span class="token punctuation">}</span>    access_log  /www/wwwlogs/pudongping.com.log<span class="token punctuation">;</span>    error_log  /www/wwwlogs/pudongping.com.error.log<span class="token punctuation">;</span>    sendfile off<span class="token punctuation">;</span>    client_max_body_size 100m<span class="token punctuation">;</span>    location @laravels <span class="token punctuation">{</span>        <span class="token comment"># proxy_connect_timeout 60s;</span>        <span class="token comment"># proxy_send_timeout 60s;</span>        <span class="token comment"># proxy_read_timeout 120s;</span>        proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>        proxy_set_header Connection <span class="token string">""</span><span class="token punctuation">;</span>        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        proxy_set_header X-Real-PORT <span class="token variable">$remote_port</span><span class="token punctuation">;</span>        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>        proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>        proxy_set_header Scheme <span class="token variable">$scheme</span><span class="token punctuation">;</span>        proxy_set_header Server-Protocol <span class="token variable">$server_protocol</span><span class="token punctuation">;</span>        proxy_set_header Server-Name <span class="token variable">$server_name</span><span class="token punctuation">;</span>        proxy_set_header Server-Addr <span class="token variable">$server_addr</span><span class="token punctuation">;</span>        proxy_set_header Server-Port <span class="token variable">$server_port</span><span class="token punctuation">;</span>        <span class="token comment"># â€œswooleâ€æ˜¯æŒ‡upstream</span>        proxy_pass http://swoole<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    location ~ /<span class="token punctuation">\</span>.ht <span class="token punctuation">{</span>        deny all<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯ä½¿ç”¨ laradock çš„è¯ï¼Œè¿˜éœ€è¦å°† <code>.env</code> æ·»åŠ ç›‘å¬åœ°å€ä¸º <code>workspace</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">LARAVELS_LISTEN_IP</span><span class="token operator">=</span>workspace<span class="token comment"># è®¾ç½®åå°å¯åŠ¨ laravelS æœåŠ¡ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹åˆ™æ‰§è¡Œ ps -ef|grep laravels å‘½ä»¤</span><span class="token assign-left variable">LARAVELS_DAEMONIZE</span><span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»£ç è§„èŒƒ"><a href="#ä»£ç è§„èŒƒ" class="headerlink" title="ä»£ç è§„èŒƒ"></a>ä»£ç è§„èŒƒ</h2><p>éµå¾ª <a href="https://www.php-fig.org/psr/psr-2/">PSR-2</a> ç¼–ç é£æ ¼è§„èŒƒ<br>éµå¾ª <a href="https://learnku.com/docs/psr/psr-12-extended-coding-style-guide/5789">PSR-12</a> ç¼–ç è§„èŒƒæ‰©å……</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>ä»£ç ä¸­æ¶µç›–äº†ä¸°å¯Œçš„æ³¨é‡Šï¼Œå¦‚æœä»æœ‰ä¸æ¸…æ¥šä¹‹å¤„ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ã€‚<br>å¦‚æœä½ è§‰å¾—è¿˜ä¸é”™ï¼Œè¯·å¸®æˆ‘ç‚¹ä¸€ä¸‹  Starï¼Œä¸èƒœæ„Ÿæ¿€ ï¼â¤(â¤Â´è‰¸ï½€â¤)</p><p><a href="https://github.com/pudongping/larablog">GitHub</a> åœ°å€<br><a href="https://gitee.com/pudongping/larablog">ç äº‘</a> åœ°å€</p><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>æºä»£ç åŸºäº <a href="https://opensource.org/licenses/MIT">MIT</a> åè®®å‘å¸ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¼€æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Laravel </tag>
            
            <tag> GitHub </tag>
            
            <tag> åšå®¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨ gitbook å¿«é€Ÿç¼–å†™ä¸ªäººä¹¦ç±æˆ–ç¬”è®°ï¼Ÿ</title>
      <link href="posts/b00f410f.html"/>
      <url>posts/b00f410f.html</url>
      
        <content type="html"><![CDATA[<h1 id="GitBook-ä½¿ç”¨"><a href="#GitBook-ä½¿ç”¨" class="headerlink" title="GitBook ä½¿ç”¨"></a><a href="https://github.com/GitbookIO">GitBook</a> ä½¿ç”¨</h1><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><blockquote><p><a href="https://www.gitbook.com/">GitBook å®˜ç½‘</a><br><a href="https://github.com/GitbookIO/gitbook">GitBook æ–‡æ¡£</a><br><a href="https://blankj.com/gitbook/gitbook/">GitBook ä½¿ç”¨æ•™ç¨‹</a><br><a href="https://juejin.im/post/6844903865146441741">æ¨è12ä¸ªå®ç”¨çš„gitbookæ’ä»¶</a><br><a href="http://jartto.wang/2020/02/02/about-gitbook/">GitBook å’Œå®ƒæœ‰è¶£çš„æ’ä»¶</a></p></blockquote><h2 id="ç¤ºä¾‹å›¾"><a href="#ç¤ºä¾‹å›¾" class="headerlink" title="ç¤ºä¾‹å›¾"></a>ç¤ºä¾‹å›¾</h2><p><img src="/medias/loading.gif" data-original="https://pudongping.github.io/notes/resources/images/sample/page.png" alt="é¡µé¢æˆªå›¾"></p><h2 id="åœ¨çº¿è®¿é—®"><a href="#åœ¨çº¿è®¿é—®" class="headerlink" title="åœ¨çº¿è®¿é—®"></a>åœ¨çº¿è®¿é—®</h2><p><a href="https://pudongping.github.io/notes">è’²ä¸œå¹³çš„ç¼–ç¨‹ç¬”è®°</a> æˆ–è€… <a href="https://pudongping.github.io/notes">è’²ä¸œå¹³çš„ç¼–ç¨‹ç¬”è®°-GitHub Pages</a></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><ul><li>å®‰è£…</li></ul><blockquote><p>å®‰è£… GitBook ä¹‹å‰éœ€è¦å®‰è£… <code>Node.js</code> ï¼Œ <code>GitBook</code> æ˜¯ä¸€ä¸ªåŸºäº <code>Node.js</code> çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå› æ­¤éœ€è¦å…ˆä¸‹è½½å®‰è£… <a href="https://nodejs.org/en">Node.js</a></p></blockquote><pre class="line-numbers language-none"><code class="language-none"># æŸ¥çœ‹ node.js æ˜¯å¦å®‰è£…æˆåŠŸnode -v# å®‰è£… GitBook npm install gitbook-cli -g# æŸ¥çœ‹ GitBook æ˜¯å¦å®‰è£…æˆåŠŸgitbook -V ï¼ˆå¤§å†™çš„ V ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://github.com/GitbookIO/gitbook/blob/master/docs/setup.md">GitBook å®˜æ–¹å®‰è£…æ–‡æ¡£</a> æ¥å®‰è£… GitBook</p><ul><li>åˆ›å»ºé¡¹ç›®</li></ul><pre class="line-numbers language-none"><code class="language-none"># åˆ‡æ¢åˆ°é¡¹ç›®æ–‡ä»¶å¤¹å¹¶åˆ›å»ºé¡¹ç›®mkdir project-directory &amp;&amp; cd project-directory &amp;&amp; gitbook init# æˆ–è€…ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤gitbook init ./project-directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨é¡¹ç›®</li></ul><pre class="line-numbers language-none"><code class="language-none">cd project-directory &amp;&amp; gitbook serve// å¦‚æœä¸æƒ³ä½¿ç”¨ 4000 ç«¯å£ï¼Œæƒ³è¦ä½¿ç”¨ 9520 ç«¯å£æ—¶gitbook serve -p 9520<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ <code>http://localhost:4000</code> ä¾¿å¯é¢„è§ˆä¹¦ç±ï¼Œè‡³æ­¤ï¼Œgitbook å®‰è£…å®Œæ¯•ã€‚</p><ul><li>ç¼–è¯‘é¡¹ç›® ï¼ˆç”Ÿæˆç½‘é¡µè€Œä¸å¼€å¯æœåŠ¡å™¨ï¼‰</li></ul><pre class="line-numbers language-none"><code class="language-none">cd project-directory &amp;&amp; gitbook build<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ gitbook ç‰ˆæœ¬</li></ul><pre class="line-numbers language-none"><code class="language-none">gitbook ls-remote<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å®‰è£…æŒ‡å®šçš„ gitbook ç‰ˆæœ¬</li></ul><pre class="line-numbers language-none"><code class="language-none">gitbook fetch betaï¼ˆç‰ˆæœ¬å·ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ç¼–è¯‘æ—¶ï¼Œè¾“å‡ºç›®å½•è¯¦ç»†çš„è®°å½•åŒ…æ‹¬ debug</li></ul><pre class="line-numbers language-none"><code class="language-none">gitbook build ./ --log=debug --debug<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å…³äºé…ç½®"><a href="#å…³äºé…ç½®" class="headerlink" title="å…³äºé…ç½®"></a>å…³äºé…ç½®</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»º <code>book.json</code> æˆ–è€… <code>book.js</code> æ–‡ä»¶</p><h3 id="é…ç½®æ–‡ä»¶å˜é‡"><a href="#é…ç½®æ–‡ä»¶å˜é‡" class="headerlink" title="é…ç½®æ–‡ä»¶å˜é‡"></a>é…ç½®æ–‡ä»¶å˜é‡</h3><p>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ä¸­çš„ä»‹ç»ï¼š<a href="https://chrisniael.gitbooks.io/gitbook-documentation/content/format/templating.html">GitBookæ–‡æ¡£ï¼ˆä¸­æ–‡ç‰ˆï¼‰</a></p><h3 id="å¦‚æœéœ€è¦å¯¼å‡º-pdf-ç­‰æ–‡ä»¶"><a href="#å¦‚æœéœ€è¦å¯¼å‡º-pdf-ç­‰æ–‡ä»¶" class="headerlink" title="å¦‚æœéœ€è¦å¯¼å‡º pdf ç­‰æ–‡ä»¶"></a>å¦‚æœéœ€è¦å¯¼å‡º pdf ç­‰æ–‡ä»¶</h3><p>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ä¸­çš„ä»‹ç»ï¼š <a href="https://snowdreams1006.github.io/myGitbook/advance/export.html">å¯¼å‡ºç”µå­ä¹¦</a></p><h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h2><p>å®‰è£…æ’ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼š <a href="https://www.npmjs.com/search?q=gitbook-plugin">ç‚¹æˆ‘æœç´¢æ›´å¤š gitbook æ’ä»¶</a></p><ol><li>åœ¨ <code>/book.json</code> é…ç½®æ–‡ä»¶ä¸­å†™å…¥ç›¸åº”çš„æ’ä»¶å’Œé…ç½®åï¼Œä½¿ç”¨ <code>gitbook install</code> å‘½ä»¤å®‰è£…æ’ä»¶</li><li>ç›´æ¥ä½¿ç”¨ <code>npm install gitbook-plugin-pluginname</code> å‘½ä»¤å®‰è£…æŒ‡å®šçš„æ’ä»¶ï¼Œç„¶ååœ¨ <code>/book.json</code> é…ç½®æ–‡ä»¶ä¸­å†™å…¥é…ç½®ï¼Œæ¯”å¦‚å®‰è£… <code>highlight</code> æ’ä»¶æ—¶ï¼Œéœ€è¦æ‰§è¡Œ <code>npm install gitbook-plugin-highlight</code></li></ol><pre class="line-numbers language-npm" data-language="npm"><code class="language-npm">npm install gitbook-plugin-search-pro --registry=https://registry.npm.taobao.org/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="GitBook-åˆå§‹åŒ–æ—¶ï¼Œä¼šé»˜è®¤è‡ªåŠ¨ä¸‹è½½-7-ä¸ªæ’ä»¶"><a href="#GitBook-åˆå§‹åŒ–æ—¶ï¼Œä¼šé»˜è®¤è‡ªåŠ¨ä¸‹è½½-7-ä¸ªæ’ä»¶" class="headerlink" title="GitBook åˆå§‹åŒ–æ—¶ï¼Œä¼šé»˜è®¤è‡ªåŠ¨ä¸‹è½½ 7 ä¸ªæ’ä»¶"></a>GitBook åˆå§‹åŒ–æ—¶ï¼Œä¼šé»˜è®¤è‡ªåŠ¨ä¸‹è½½ 7 ä¸ªæ’ä»¶</h3><ol><li><a href="https://github.com/GitbookIO/plugin-highlight">highlight</a>  ï¼š ä»£ç é«˜äº®</li><li><a href="https://github.com/GitbookIO/plugin-search">search</a>  ï¼š å¯¼èˆªæ æŸ¥è¯¢åŠŸèƒ½ ï¼ˆä¸æ”¯æŒä¸­æ–‡ï¼‰</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-lunr">lunr</a>  ï¼š  ä¸º <code>search</code> æ’ä»¶æä¾›åç«¯æ”¯æŒ</li><li><a href="https://github.com/GitbookIO/plugin-sharing">sharing</a>  ï¼š å³ä¸Šè§’åˆ†äº«åŠŸèƒ½</li><li><a href="https://github.com/GitbookIO/plugin-fontsettings">fontsettings</a>  ï¼š å­—ä½“è®¾ç½®ï¼ˆæœ€ä¸Šæ–¹çš„ â€œAâ€ ç¬¦å·ï¼‰</li><li><a href="https://github.com/GitbookIO/plugin-livereload">livereload</a>  ï¼š ä¸º GitBook å®æ—¶é‡æ–°åŠ è½½</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-theme-default">theme-default</a>  ï¼š  é»˜è®¤çš„ 3.0.0 ç‰ˆæœ¬ä¹‹åçš„ä¸»é¢˜æ’ä»¶</li></ol><h3 id="æ¨èæ’ä»¶"><a href="#æ¨èæ’ä»¶" class="headerlink" title="æ¨èæ’ä»¶"></a>æ¨èæ’ä»¶</h3><ul><li><a href="https://github.com/codeclou/gitbook-plugin-advanced-emoji">advanced-emoji</a>  ï¼š æ”¯æŒ emoji è¡¨æƒ…åŒ…  <a href="https://www.webfx.com/tools/emoji-cheat-sheet/">emoji è¡¨æƒ…åŒ…åœ°å€</a></li><li><a href="https://github.com/zq99299/gitbook-plugin-anchor-navigation-ex/blob/master/doc/config.md">anchor-navigation-ex</a>  ï¼š æ‚¬æµ®æŒ‰é’®ç›®å½•  ï¼ˆåœ¨é¡µé¢ä¸­å¢åŠ  <extoc></extoc> æ ‡ç­¾ï¼Œä¼šåœ¨æ­¤å¤„ç”Ÿæˆ TOC ç›®å½•ï¼‰ã€è¿˜ä¼šå¢åŠ æ ‡é¢˜é”š</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-auto-scroll-table">auto-scroll-table</a>  ï¼š  è¡¨æ ¼æ»šåŠ¨æ¡</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-audio_image">audio_image</a>  ï¼š æ’­æ”¾éŸ³é¢‘</li><li><a href="https://github.com/stuebersystems/gitbook-plugin-back-to-top-button">back-to-top-button</a> ï¼š è¿”å›é¡¶éƒ¨</li><li><a href="https://snowdreams1006.github.io/gitbook-plugin-baidu-tongji-with-multiple-channel/">baidu-tongji-with-multiple-channel</a>  ï¼š  ç™¾åº¦ç»Ÿè®¡æ’ä»¶,æ”¯æŒå¤šæ¸ é“ç‹¬ç«‹ç»Ÿè®¡,ä¸€ä»½æºç å¤šå¤„éƒ¨ç½²ç‹¬ç«‹ç»Ÿè®¡</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-chapter-fold">chapter-fold</a>  ï¼š å·¦ä¾§ç›®å½•å¯æŠ˜å ï¼Œå»ºè®®å’Œ <code>expandable-chapters</code> æ’ä»¶ä¸€èµ·ä½¿ç”¨å¯ä»¥äº’è¡¥ç›¸äº’çš„ bug</li><li><a href="https://github.com/TGhoul/gitbook-plugin-code">code</a> ï¼š ä»£ç æ·»åŠ è¡Œå·å’Œå¤åˆ¶æŒ‰é’®</li><li><a href="https://github.com/zhenchao125/gitbook-plugin-change_girls">change_girls</a>  ï¼š å¯è‡ªåŠ¨åˆ‡æ¢èƒŒæ™¯</li><li><a href="https://github.com/c4software/gitbook-plugin-click-reveal">click-reveal</a>  ï¼š ç‚¹å‡»æ˜¾ç¤ºå†…å®¹ï¼Œé»˜è®¤æŠŠå†…å®¹å·²ç»éšè—</li><li><a href="https://github.com/Bandwidth/gitbook-plugin-custom-favicon">custom-favicon</a>  ï¼š  ä¿®æ”¹æ ‡é¢˜æ å›¾æ ‡</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-copyright">copyright</a>  ï¼š  ç”¨äºå¤åˆ¶å†…å®¹æ—¶è¿½åŠ ç‰ˆæƒä¿¡æ¯ä»¥åŠæ–‡ç« æœ«å°¾æ·»åŠ ç‰ˆæƒå°å°¾å·´</li><li><a href="https://github.com/willin/gitbook-plugin-donate">donate</a> ï¼š æ‰“èµåŠŸèƒ½</li><li><a href="https://github.com/snowdreams1006/gitbook-plugin-diff/blob/HEAD/README_zh.md">diff</a>  ï¼š åœ¨ markdown æ–‡æ¡£ä¸­æ˜¾ç¤ºä»£ç ä¹‹é—´çš„å·®å¼‚</li><li><a href="https://github.com/chrisjake/gitbook-plugin-expandable-chapters-small">expandable-chapters</a>  ï¼š å·¦ä¾§ç›®å½•å¯æŠ˜å ï¼Œå’Œ <code>expandable-chapters-small</code> çš„åŒºåˆ«æ˜¯ï¼š <code>expandable-chapters-small</code> çš„æŠ˜å å›¾æ ‡è¦å°ä¸€äº› ï¼ˆå»ºè®®å’Œ <code>chapter-fold</code> æ’ä»¶ä¸€èµ·ä½¿ç”¨å¯ä»¥äº’è¡¥ç›¸äº’çš„ bugï¼‰</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-edit-link-plus">edit-link-plus</a>  ï¼š åœ¨çº¿ç¼–è¾‘æ–‡ä»¶</li><li><a href="https://github.com/fzankl/gitbook-plugin-flexible-alerts">flexible-alerts</a> ï¼šè­¦å‘Šæç¤ºæ¡†</li><li><a href="https://github.com/menduo/gitbook-plugin-favicon">favicon</a>  ï¼š ä¿®æ”¹ç½‘ç«™çš„ favicon.ico  <a href="http://www.bitbug.net/">ç‚¹æˆ‘åœ¨çº¿åˆ¶ä½œicoå›¾æ ‡ï¼Œå»ºè®®å°ºå¯¸32*32</a></li><li><a href="https://www.npmjs.com/package/gitbook-plugin-ga">ga</a> ï¼š Google åˆ†æ</li><li><a href="https://github.com/GitbookIO/plugin-github">github</a> ï¼š å³ä¸Šè§’æ·»åŠ  Github å›¾æ ‡</li><li><a href="https://github.com/azu/gitbook-plugin-github-buttons">github-buttons</a>  ï¼š å³ä¸Šè§’æ·»åŠ  GitHub çš„æŒ‰é’®</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-charts">gitbook-plugin-charts</a>  ï¼š  åœ¨ gitbook ä¸­ä½¿ç”¨å›¾è¡¨æ’ä»¶ï¼Œç›®å‰æ”¯æŒ echarts</li><li><a href="https://github.com/snowdreams1006/gitbook-plugin-google-tongji-with-multiple-channel">google-tongji-with-multiple-channel</a>  ï¼š  Google ç»Ÿè®¡æ’ä»¶,æ”¯æŒå¤šæ¸ é“ç‹¬ç«‹ç»Ÿè®¡,ä¸€ä»½æºç å¤šå¤„éƒ¨ç½²ç‹¬ç«‹ç»Ÿè®¡</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-hide-element">hide-element</a>  ï¼š  éšè—å…ƒç´ </li><li><a href="https://github.com/todvora/gitbook-plugin-image-captions">image-captions</a> ï¼š å°†å›¾ç‰‡çš„ alt æˆ– title å±æ€§è½¬æ¢ä¸ºæ ‡é¢˜</li><li><a href="https://github.com/matusnovak/gitbook-plugin-insert-logo">insert-logo</a> ï¼š æ’å…¥ Logo</li><li><a href="https://github.com/snowdreams1006/gitbook-plugin-icp/blob/HEAD/README_zh.md">icp</a>  ï¼š  åœ¨é¦–é¡µé¡µè„šåŒºåŸŸæ·»åŠ  icp ç½‘ç«™å¤‡æ¡ˆä¿¡æ¯</li><li><a href="https://github.com/brian-dawn/gitbook-plugin-klipse">klipse</a>  ï¼š åµŒå…¥ç±»ä¼¼ IDE çš„åŠŸèƒ½</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-lightbox">lightbox</a>  ï¼š  é¡µé¢å¼¹çª—æŸ¥çœ‹å›¾ç‰‡ ï¼ˆæ”¯æŒåœ¨å¼¹å±‚åˆ‡æ¢ä¸Šä¸‹å›¾ï¼‰</li><li><a href="https://github.com/PacktPublishing/gitbook-local-video">local-video</a>  ï¼š  æ’­æ”¾æœ¬åœ°è§†é¢‘ï¼Œ<a href="http://gitbook.zhangjikai.com/plugins.html#local-video">ç‚¹æˆ‘æŸ¥çœ‹ä½¿ç”¨æ•™ç¨‹</a></li><li><a href="https://www.npmjs.com/package/gitbook-plugin-multipart">multipart</a> ï¼š å°†å·¦ä¾§çš„ç›®å½•åˆ†ç« èŠ‚å±•ç¤º</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-mygitalk">mygitalk</a>  ï¼š  é€šè¿‡ GitHub issues æ·»åŠ è¯„è®ºæ¡†</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-mermaid-gb3">mermaid-gb3</a>  ï¼š æ”¯æŒ markdown çš„æµç¨‹å›¾</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-meta">meta</a>  ï¼š æ·»åŠ  meta å¤´éƒ¨ä¿¡æ¯</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-page-copyright">page-copyright</a> ï¼š é¡µè„šç‰ˆæƒ</li><li><a href="https://github.com/tinys/gitbook-plugin-pageview-count#readme">pageview-count</a> ï¼š é˜…è¯»ç»Ÿè®¡</li><li><a href="https://github.com/somax/gitbook-plugin-popup#readme">popup</a>  ï¼š  æ‰“å¼€æ–°çš„é¡µé¢æŸ¥çœ‹å›¾ç‰‡</li><li><a href="https://github.com/gaearon/gitbook-plugin-prism">prism</a>  ï¼š  ä»£ç å—é¢œè‰²æ’ä»¶ ï¼ˆä½¿ç”¨çš„æ—¶å€™éœ€è¦ç¦ç”¨æ‰ gitbook è‡ªå¸¦çš„ <code>highlight</code> æ’ä»¶å¹¶ä¸”å’Œ <code>code</code> æ’ä»¶ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ”¾åˆ° <code>code</code> æ’ä»¶åï¼Œå¦åˆ™æ ·å¼ä¼šè¢«è¦†ç›–æ‰ï¼‰</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-rss">rss</a>  ï¼š ç”Ÿæˆ rss <a href="https://www.ruanyifeng.com/blog/2006/01/rss.html">å¦‚ä½•ä½¿ç”¨ RSS </a></li><li><a href="https://www.npmjs.com/package/gitbook-plugin-readmore">readmore</a>  ï¼š å®ç°åšå®¢çš„æ¯ä¸€ç¯‡æ–‡ç« è‡ªåŠ¨å¢åŠ é˜…è¯»æ›´å¤šæ•ˆæœ,å…³æ³¨å…¬ä¼—å·åæ–¹å¯è§£é”å…¨ç«™æ–‡ç« </li><li><a href="https://github.com/GitbookIO/plugin-sharing">sharing-plus</a> ï¼š åˆ†äº«å½“å‰é¡µé¢</li><li><a href="https://github.com/yoshidax/gitbook-plugin-splitter">splitter</a> ï¼š ä¾§è¾¹æ å®½åº¦å¯è°ƒèŠ‚</li><li><a href="https://github.com/gitbook-plugins/gitbook-plugin-search-pro">search-pro</a> ï¼š é«˜çº§æœç´¢ï¼Œæ”¯æŒä¸­æ–‡ ï¼ˆä½¿ç”¨çš„æ—¶å€™éœ€è¦ç¦ç”¨æ‰ <code>lunr</code> å’Œ <code>search</code> æ’ä»¶ï¼‰</li><li><a href="https://github.com/manchiyiu/gitbook-plugin-sectionx">sectionx</a>  ï¼š æŠ˜å æ¨¡å—(é¡µé¢å†…å®¹å¯æŠ˜å )</li><li><a href="https://github.com/CyberZHG/gitbook-plugin-sitemap-general">sitemap-general</a>  ï¼š ç”Ÿæˆç«™ç‚¹åœ°å›¾</li><li><a href="https://snowdreams1006.github.io/gitbook-plugin-simple-mind-map/zh/">simple-mind-map</a>  ï¼š  åœ¨ markdown ä¸­ç”Ÿæˆå¹¶å¯¼å‡ºæ€ç»´å¯¼å›¾</li><li><a href="https://github.com/ly-tools/gitbook-plugin-todo">todo</a> ï¼š å¾…åšé¡¹</li><li><a href="https://github.com/tonyyls/gitbook-plugin-theme-fexa">theme-fexa</a>  :  ç½‘ç«™ä¸»é¢˜ï¼Œä½¿ç”¨è¿™ä¸ªä¸»é¢˜ä¹‹åä¸èƒ½å¤Ÿåœ¨é¡µé¢ä¸Šè¿›è¡Œä¸Šä¸‹æ–‡ç¿»é¡µ</li><li><a href="https://www.npmjs.com/package/gitbook-plugin-theme-comscore">theme-comscore</a>  ï¼š æ ‡é¢˜å’Œæ­£æ–‡é¢œè‰²æœ‰æ‰€åŒºåˆ†çš„ä¸»é¢˜ï¼Œè¡¨æ ¼ä¹Ÿæœ‰é¢œè‰²</li><li><a href="https://github.com/zhj3618/gitbook-plugin-tbfed-pagefooter">tbfed-pagefooter</a>  ï¼š æ·»åŠ é¡µè„šç‰ˆæƒä¿¡æ¯ï¼Œè¿™ä¸ªæ„Ÿè§‰æ²¡æœ‰ <code>page-copyright</code> å¥½ç”¨</li></ul><h2 id="æˆ‘è‡ªå·±çš„-book-json-é…ç½®ä¿¡æ¯"><a href="#æˆ‘è‡ªå·±çš„-book-json-é…ç½®ä¿¡æ¯" class="headerlink" title="æˆ‘è‡ªå·±çš„ book.json é…ç½®ä¿¡æ¯"></a>æˆ‘è‡ªå·±çš„ book.json é…ç½®ä¿¡æ¯</h2><blockquote><p>æ³¨æ„ï¼šéœ€è¦åˆ é™¤æ‰æ‰€æœ‰çš„æ³¨é‡Šä¿¡æ¯</p></blockquote><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Alex's Notes"</span><span class="token punctuation">,</span>  <span class="token comment">// è®¾ç½®ä¹¦æœ¬çš„æ ‡é¢˜</span>    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span>  <span class="token comment">// ä½œè€…çš„ç›¸å…³ä¿¡æ¯</span>    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"live and learn"</span><span class="token punctuation">,</span>  <span class="token comment">// æœ¬ä¹¦çš„ç®€å•æè¿°</span>    <span class="token property">"language"</span><span class="token operator">:</span> <span class="token string">"zh-hans"</span><span class="token punctuation">,</span>  <span class="token comment">// å¯ä½¿ç”¨çš„è¯­è¨€ï¼šen, ar, bn, cs, de, en, es, fa, fi, fr, he, it, ja, ko, no, pl, pt, ro, ru, sv, uk, vi, zh-hans, zh-tw è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ç®€ä½“ä¸­æ–‡ zh-hans</span>    <span class="token property">"gitbook"</span><span class="token operator">:</span> <span class="token string">"3.2.3"</span><span class="token punctuation">,</span>  <span class="token comment">// æŒ‡å®šä½¿ç”¨çš„ gitbook ç‰ˆæœ¬</span>    <span class="token property">"styles"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// è‡ªå®šä¹‰é¡µé¢æ ·å¼</span>        <span class="token property">"website"</span><span class="token operator">:</span> <span class="token string">"./resources/styles/website.css"</span><span class="token punctuation">,</span>  <span class="token comment">// å½“æ­¤æ—¶çš„ gitbook è¾“å‡ºä¸ºç«™ç‚¹æ¨¡å¼æ—¶ä½¿ç”¨çš„ css æ ·å¼</span>        <span class="token comment">// "ebook": "styles/ebook.css",  // å½“æ­¤æ—¶çš„ gitbook è¾“å‡ºä¸º ebook æ—¶ä½¿ç”¨çš„ css æ ·å¼</span>        <span class="token comment">// "pdf": "styles/pdf.css",  // å½“æ­¤æ—¶çš„ gitbook è¾“å‡ºä¸º pdf æ—¶ä½¿ç”¨çš„ css æ ·å¼</span>        <span class="token comment">// "mobi": "styles/mobi.css",</span>        <span class="token comment">// "epub": "styles/epub.css"        </span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"structure"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// æŒ‡å®š Readmeã€Summaryã€Glossary å’Œ Languages å¯¹åº”çš„æ–‡ä»¶å</span>        <span class="token property">"readme"</span><span class="token operator">:</span> <span class="token string">"README.md"</span><span class="token punctuation">,</span>  <span class="token comment">// è¯¥ä¹¦çš„ä»‹ç» ï¼ˆé»˜è®¤ä¼šåˆ›å»ºï¼‰</span>        <span class="token property">"summary"</span><span class="token operator">:</span> <span class="token string">"SUMMARY.md"</span><span class="token punctuation">,</span>  <span class="token comment">// è¯¥ä¹¦çš„ç« èŠ‚ç»“æ„ ï¼ˆé»˜è®¤ä¼šåˆ›å»ºï¼‰</span>        <span class="token comment">// "glossary": "GLOSSARY.md",  // å¤šè¯­è¨€ä¹¦ç±</span>        <span class="token comment">// "languages": "LANGS.md",  // æœ¯è¯­æè¿°çš„æ¸…å•</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"links"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// åœ¨å·¦ä¾§å¯¼èˆªæ æ·»åŠ é“¾æ¥ä¿¡æ¯</span>        <span class="token property">"sidebar"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"æˆ‘çš„åšå®¢"</span><span class="token operator">:</span> <span class="token string">"https://drling.xin/"</span><span class="token punctuation">,</span>            <span class="token property">"GitHub"</span><span class="token operator">:</span> <span class="token string">"https://github.com/pudongping"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token comment">// éœ€è¦ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ï¼Œæ³¨é‡Šæ’ä»¶çš„æ—¶å€™ç›´æ¥åœ¨æ’ä»¶åç§°å‰åŠ  â€œæ¨ªæ  -â€ï¼Œæ¯”å¦‚æ³¨é‡Š â€œhighlightâ€ æ’ä»¶ä¸º â€œ-highlightâ€</span>        <span class="token string">"-highlight"</span><span class="token punctuation">,</span>        <span class="token string">"-lunr"</span><span class="token punctuation">,</span>        <span class="token string">"-search"</span><span class="token punctuation">,</span>        <span class="token string">"search-pro"</span><span class="token punctuation">,</span>        <span class="token string">"-sharing"</span><span class="token punctuation">,</span>        <span class="token string">"sharing-plus"</span><span class="token punctuation">,</span>        <span class="token string">"fontsettings"</span><span class="token punctuation">,</span>        <span class="token string">"livereload"</span><span class="token punctuation">,</span>        <span class="token string">"expandable-chapters-small"</span><span class="token punctuation">,</span>        <span class="token string">"chapter-fold"</span><span class="token punctuation">,</span>        <span class="token string">"splitter"</span><span class="token punctuation">,</span>        <span class="token string">"hide-element"</span><span class="token punctuation">,</span>        <span class="token string">"back-to-top-button"</span><span class="token punctuation">,</span>        <span class="token string">"favicon"</span><span class="token punctuation">,</span>        <span class="token string">"insert-logo"</span><span class="token punctuation">,</span>        <span class="token string">"pageview-count"</span><span class="token punctuation">,</span>        <span class="token string">"code"</span><span class="token punctuation">,</span>        <span class="token string">"prism"</span><span class="token punctuation">,</span>        <span class="token string">"lightbox"</span><span class="token punctuation">,</span>        <span class="token string">"github"</span><span class="token punctuation">,</span>        <span class="token string">"github-buttons"</span><span class="token punctuation">,</span>        <span class="token string">"donate"</span><span class="token punctuation">,</span>        <span class="token string">"anchor-navigation-ex"</span><span class="token punctuation">,</span>        <span class="token string">"meta"</span><span class="token punctuation">,</span>        <span class="token string">"mygitalk"</span><span class="token punctuation">,</span>        <span class="token string">"change_girls"</span><span class="token punctuation">,</span>        <span class="token string">"simple-mind-map"</span><span class="token punctuation">,</span>        <span class="token string">"image-captions"</span><span class="token punctuation">,</span>        <span class="token string">"todo"</span><span class="token punctuation">,</span>        <span class="token string">"edit-link-plus"</span><span class="token punctuation">,</span>        <span class="token string">"sitemap-general"</span><span class="token punctuation">,</span>        <span class="token string">"rss"</span><span class="token punctuation">,</span>        <span class="token string">"icp"</span><span class="token punctuation">,</span>        <span class="token string">"theme-comscore"</span><span class="token punctuation">,</span>        <span class="token string">"page-copyright"</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"pluginsConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"sharing"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"douban"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"facebook"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"google"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"hatenaBookmark"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"instapaper"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"line"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"linkedin"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"messenger"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"pocket"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"qq"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"qzone"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"stumbleupon"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"twitter"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"viber"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"vk"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"weibo"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"whatsapp"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"all"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"douban"</span><span class="token punctuation">,</span>                <span class="token string">"facebook"</span><span class="token punctuation">,</span>                <span class="token string">"google"</span><span class="token punctuation">,</span>                <span class="token string">"hatenaBookmark"</span><span class="token punctuation">,</span>                <span class="token string">"instapaper"</span><span class="token punctuation">,</span>                <span class="token string">"line"</span><span class="token punctuation">,</span>                <span class="token string">"linkedin"</span><span class="token punctuation">,</span>                <span class="token string">"messenger"</span><span class="token punctuation">,</span>                <span class="token string">"pocket"</span><span class="token punctuation">,</span>                <span class="token string">"qq"</span><span class="token punctuation">,</span>                <span class="token string">"qzone"</span><span class="token punctuation">,</span>                <span class="token string">"stumbleupon"</span><span class="token punctuation">,</span>                <span class="token string">"twitter"</span><span class="token punctuation">,</span>                <span class="token string">"viber"</span><span class="token punctuation">,</span>                <span class="token string">"vk"</span><span class="token punctuation">,</span>                <span class="token string">"weibo"</span><span class="token punctuation">,</span>                <span class="token string">"whatsapp"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"hide-element"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"elements"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"a.gitbook-link[href='https://www.gitbook.com']"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"favicon"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"shortcut"</span><span class="token operator">:</span> <span class="token string">"./resources/images/favicon.ico"</span><span class="token punctuation">,</span>            <span class="token property">"bookmark"</span><span class="token operator">:</span> <span class="token string">"./resources/images/favicon.ico"</span><span class="token punctuation">,</span>            <span class="token property">"appleTouch"</span><span class="token operator">:</span> <span class="token string">"./resources/images/favicon.png"</span><span class="token punctuation">,</span>            <span class="token property">"appleTouchMore"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token property">"120x120"</span><span class="token operator">:</span> <span class="token string">"./resources/images/apple-touch-icon-120x120.png"</span><span class="token punctuation">,</span>                <span class="token property">"180x180"</span><span class="token operator">:</span> <span class="token string">"./resources/images/apple-touch-icon-180x180.png"</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"insert-logo"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/resources/images/favicon.png"</span><span class="token punctuation">,</span>            <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"background: none; max-height: 30px; min-height: 30px"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"prism"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"css"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"prismjs/themes/prism-solarizedlight.css"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"lang"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token property">"shell"</span><span class="token operator">:</span> <span class="token string">"bash"</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"lightbox"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"sameUuid"</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// å¼€å¯äº†è¿™ä¸ªå±æ€§ä¹‹åæ”¯æŒåœ¨å¼¹å±‚ï¼Œå·¦å³åˆ‡æ¢å›¾ç‰‡</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"github"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/pudongping"</span>  <span class="token comment">// åœ¨å³ä¸Šè§’ä¼šæ˜¾ç¤ºå¾ˆå°çš„ github çš„å®˜æ–¹å›¾æ ‡</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"github-buttons"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// åœ¨å³ä¸Šè§’ä¼šæ˜¾ç¤º github å›¾æ ‡çš„ button</span>            <span class="token property">"buttons"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">{</span>                    <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"pudongping"</span><span class="token punctuation">,</span>                    <span class="token property">"repo"</span><span class="token operator">:</span> <span class="token string">"glory"</span><span class="token punctuation">,</span>                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"star"</span><span class="token punctuation">,</span>                    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                    <span class="token property">"size"</span><span class="token operator">:</span> <span class="token string">"small"</span>                <span class="token punctuation">}</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"donate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"alipay"</span><span class="token operator">:</span> <span class="token string">"/resources/images/donate.png"</span><span class="token punctuation">,</span>            <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"\"è‹¥æœ‰å…±é¸£ï¼Œç•™è¨€è¶³çŸ£ï¼Œè‹¥æœ‰èµèµï¼Œä½•ä»¥å¤åŠ ï¼Ÿ\""</span><span class="token punctuation">,</span>            <span class="token property">"button"</span><span class="token operator">:</span> <span class="token string">"èµèµ"</span><span class="token punctuation">,</span>            <span class="token property">"alipayText"</span><span class="token operator">:</span> <span class="token string">"å¾®ä¿¡/æ”¯ä»˜å®/QQ"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"anchor-navigation-ex"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"showLevel"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// å³ä¸Šè§’æµ®å±‚ç›®å½•æ˜¾ç¤ºåºå·</span>            <span class="token property">"showGoTop"</span><span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token comment">// ä¸æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨çš„å›¾æ ‡ï¼Œä¸å»ºè®®å¼€å¯è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºè¿™ä¸ªå›¾æ ‡æ€»æ˜¯æ˜¾ç¤ºï¼Œä¸åƒ â€œback-to-top-buttonâ€ æ’ä»¶è¿˜å¯ä»¥è‡ªåŠ¨æ˜¾ç¤ºå’Œéšè—</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"meta"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">{</span>                    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"referrer"</span><span class="token punctuation">,</span>                    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"never"</span>                <span class="token punctuation">}</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"mygitalk"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"clientID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// GitHub å¼€å‘è€…è®¾ç½®ï¼Œå®¢æˆ·ç«¯è¿æ¥æ ‡è¯†</span>            <span class="token property">"clientSecret"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// GitHub å¼€å‘è€…è®¾ç½®ï¼Œå®¢æˆ·ç«¯ç§˜é’¥</span>            <span class="token property">"repo"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// GitHub ä»“åº“å</span>            <span class="token property">"owner"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// GitHub ä»“åº“æ‰€æœ‰è€…</span>            <span class="token property">"admin"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token comment">// GitHub ä»“åº“ç®¡ç†è€…ï¼Œæ”¯æŒå¤šä¸ªç®¡ç†è€…</span>                <span class="token string">"admin-1"</span><span class="token punctuation">,</span>                <span class="token string">"admin-2"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"distractionFreeMode"</span><span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token comment">// ç±»ä¼¼ Facebook è¯„è®ºæ¡†çš„å…¨å±é®ç½©æ•ˆæœ,é»˜è®¤å€¼: false</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"change_girls"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"time"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">// æ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡èƒŒæ™¯</span>            <span class="token property">"urls"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1605033246957&amp;di=d6170f1a9f0466f270ad1baee847eab9&amp;imgtype=0&amp;src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2Fe%2F55f26f55e9138.jpg"</span><span class="token punctuation">,</span>                <span class="token string">"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1605033334002&amp;di=4ef73db6c98fb737f5a3068670160056&amp;imgtype=0&amp;src=http%3A%2F%2Fww3.sinaimg.cn%2Flarge%2Fd2e27164gw1fbmwbgf0mij21hc0u0487.jpg"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"simple-mind-map"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"markdown"</span><span class="token punctuation">,</span>            <span class="token property">"preset"</span><span class="token operator">:</span> <span class="token string">"colorful"</span><span class="token punctuation">,</span>            <span class="token property">"linkShape"</span><span class="token operator">:</span> <span class="token string">"diagonal"</span><span class="token punctuation">,</span>            <span class="token property">"autoFit"</span><span class="token operator">:</span> <span class="token boolean">true</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"image-captions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"sugaryesp çš„ç¬”è®° - _PAGE_LEVEL_._PAGE_IMAGE_NUMBER_ - _CAPTION_"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"edit-link-plus"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"base"</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token property">"edit-link-name-1"</span><span class="token operator">:</span> <span class="token string">"edit-link-1"</span><span class="token punctuation">,</span>                <span class="token property">"edit-link-name-2"</span><span class="token operator">:</span> <span class="token string">"edit-link-2"</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token property">"defaultBase"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// è¿™é‡Œå¡«å†™é“¾æ¥åœ°å€</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"ç¼–è¾‘æœ¬é¡µ"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"sitemap-general"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"prefix"</span><span class="token operator">:</span> <span class="token string">"http://notes.drling.xin/"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"rss"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"sugaryesp çš„ç¬”è®°"</span><span class="token punctuation">,</span>            <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"å‰Šä¸ªæ¤°å­çš®_ç»™ä¸ªæ¢¨çš„ç¬”è®°"</span><span class="token punctuation">,</span>            <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span>            <span class="token property">"site_url"</span><span class="token operator">:</span> <span class="token string">"http://notes.drling.xin"</span><span class="token punctuation">,</span>            <span class="token property">"feed_url"</span><span class="token operator">:</span> <span class="token string">"http://notes.drling.xin/rss"</span><span class="token punctuation">,</span>            <span class="token property">"managingEditor"</span><span class="token operator">:</span> <span class="token string">"276558492@qq.com (Alex Pu)"</span><span class="token punctuation">,</span>            <span class="token property">"webMaster"</span><span class="token operator">:</span> <span class="token string">"276558492@qq.com (Alex Pu)"</span><span class="token punctuation">,</span>            <span class="token property">"categories"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"markdown"</span><span class="token punctuation">,</span>                <span class="token string">"git"</span><span class="token punctuation">,</span>                <span class="token string">"gitee"</span><span class="token punctuation">,</span>                <span class="token string">"github"</span><span class="token punctuation">,</span>                <span class="token string">"php"</span><span class="token punctuation">,</span>                <span class="token string">"python"</span><span class="token punctuation">,</span>                <span class="token string">"vue.js"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"icp"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"number"</span><span class="token operator">:</span> <span class="token string">"é„‚ICPå¤‡18004705å·"</span><span class="token punctuation">,</span>            <span class="token property">"link"</span><span class="token operator">:</span> <span class="token string">"https://beian.miit.gov.cn/"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"page-copyright"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"modified at:"</span><span class="token punctuation">,</span>            <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span>            <span class="token property">"wisdom"</span><span class="token operator">:</span> <span class="token string">"Artisan, Backend Developer &amp; overall web enthusiast"</span><span class="token punctuation">,</span>            <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"YYYY-MM-dd hh:mm:ss"</span><span class="token punctuation">,</span>            <span class="token property">"copyright"</span><span class="token operator">:</span> <span class="token string">"Copyright &amp;#169; Alex"</span><span class="token punctuation">,</span>            <span class="token property">"timeColor"</span><span class="token operator">:</span> <span class="token string">"#666"</span><span class="token punctuation">,</span>            <span class="token property">"copyrightColor"</span><span class="token operator">:</span> <span class="token string">"#666"</span><span class="token punctuation">,</span>            <span class="token property">"utcOffset"</span><span class="token operator">:</span> <span class="token string">"8"</span><span class="token punctuation">,</span>            <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"normal"</span><span class="token punctuation">,</span>            <span class="token property">"noPowered"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"baseUri"</span><span class="token operator">:</span> <span class="token string">"http://notes.drling.xin/"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚æœä½¿ç”¨-gitbook-install-å®‰è£…æ’ä»¶å¤ªæ…¢ï¼Œå¯ä»¥ä½¿ç”¨-npm-init-åˆå§‹åŒ–é¡¹ç›®ï¼Œç„¶åå†ä½¿ç”¨-npm-install-å®‰è£…æ’ä»¶"><a href="#å¦‚æœä½¿ç”¨-gitbook-install-å®‰è£…æ’ä»¶å¤ªæ…¢ï¼Œå¯ä»¥ä½¿ç”¨-npm-init-åˆå§‹åŒ–é¡¹ç›®ï¼Œç„¶åå†ä½¿ç”¨-npm-install-å®‰è£…æ’ä»¶" class="headerlink" title="å¦‚æœä½¿ç”¨ gitbook install å®‰è£…æ’ä»¶å¤ªæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ npm init åˆå§‹åŒ–é¡¹ç›®ï¼Œç„¶åå†ä½¿ç”¨ npm install å®‰è£…æ’ä»¶"></a>å¦‚æœä½¿ç”¨ gitbook install å®‰è£…æ’ä»¶å¤ªæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ npm init åˆå§‹åŒ–é¡¹ç›®ï¼Œç„¶åå†ä½¿ç”¨ npm install å®‰è£…æ’ä»¶</h2><pre class="line-numbers language-none"><code class="language-none">cd project-directory &amp;&amp; npm init// æ¯”å¦‚å®‰è£… livereload æ’ä»¶npm install gitbook-plugin-livereload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿™æ˜¯æˆ‘çš„-package-json"><a href="#è¿™æ˜¯æˆ‘çš„-package-json" class="headerlink" title="è¿™æ˜¯æˆ‘çš„ package.json"></a>è¿™æ˜¯æˆ‘çš„ package.json</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"glory"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Alex's notes"</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">" "</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"gitbook-plugin-anchor-navigation-ex"</span><span class="token operator">:</span> <span class="token string">"^1.0.14"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-back-to-top-button"</span><span class="token operator">:</span> <span class="token string">"^0.1.4"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-change_girls"</span><span class="token operator">:</span> <span class="token string">"^2.2.1"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-chapter-fold"</span><span class="token operator">:</span> <span class="token string">"^0.0.4"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-code"</span><span class="token operator">:</span> <span class="token string">"^0.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-donate"</span><span class="token operator">:</span> <span class="token string">"^1.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-edit-link-plus"</span><span class="token operator">:</span> <span class="token string">"^0.1.1"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-expandable-chapters-small"</span><span class="token operator">:</span> <span class="token string">"^0.1.7"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-favicon"</span><span class="token operator">:</span> <span class="token string">"^0.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-fontsettings"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-github"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-github-buttons"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-hide-element"</span><span class="token operator">:</span> <span class="token string">"^0.0.4"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-icp"</span><span class="token operator">:</span> <span class="token string">"^0.1.2"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-image-captions"</span><span class="token operator">:</span> <span class="token string">"^3.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-insert-logo"</span><span class="token operator">:</span> <span class="token string">"^0.1.5"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-lightbox"</span><span class="token operator">:</span> <span class="token string">"^1.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-livereload"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-meta"</span><span class="token operator">:</span> <span class="token string">"^0.1.12"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-mygitalk"</span><span class="token operator">:</span> <span class="token string">"^0.2.6"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-page-copyright"</span><span class="token operator">:</span> <span class="token string">"^1.0.8"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-pageview-count"</span><span class="token operator">:</span> <span class="token string">"^1.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-prism"</span><span class="token operator">:</span> <span class="token string">"^2.4.0"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-rss"</span><span class="token operator">:</span> <span class="token string">"^3.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-search-pro"</span><span class="token operator">:</span> <span class="token string">"^2.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-sharing-plus"</span><span class="token operator">:</span> <span class="token string">"^0.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-simple-mind-map"</span><span class="token operator">:</span> <span class="token string">"^0.2.4"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-sitemap-general"</span><span class="token operator">:</span> <span class="token string">"^0.1.1"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-splitter"</span><span class="token operator">:</span> <span class="token string">"^0.0.8"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-theme-comscore"</span><span class="token operator">:</span> <span class="token string">"0.0.3"</span><span class="token punctuation">,</span>    <span class="token property">"gitbook-plugin-todo"</span><span class="token operator">:</span> <span class="token string">"^0.1.3"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">" "</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"git+https://github.com/pudongping/glory.git"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"Artisan"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>  <span class="token property">"bugs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/pudongping/glory/issues"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"homepage"</span><span class="token operator">:</span> <span class="token string">"https://github.com/pudongping/glory#readme"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¼€æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
            <tag> åšå®¢ </tag>
            
            <tag> GitBook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 å¹´ 9 æœˆ 6 æ—¥é­”éƒ½ä¸Šæµ·é™å®‰è€ƒçº¢å¸½ rhcsaã€rhce è®°å½•</title>
      <link href="posts/8dcd0c17.html"/>
      <url>posts/8dcd0c17.html</url>
      
        <content type="html"><![CDATA[<h1 id="2019-09-06-é­”éƒ½ä¸Šæµ·é™å®‰è€ƒçº¢å¸½rhceè®°å½•"><a href="#2019-09-06-é­”éƒ½ä¸Šæµ·é™å®‰è€ƒçº¢å¸½rhceè®°å½•" class="headerlink" title="2019-09-06 é­”éƒ½ä¸Šæµ·é™å®‰è€ƒçº¢å¸½rhceè®°å½•"></a>2019-09-06 é­”éƒ½ä¸Šæµ·é™å®‰è€ƒçº¢å¸½rhceè®°å½•</h1><h3 id="å‘æ–‡ç”³æ˜"><a href="#å‘æ–‡ç”³æ˜" class="headerlink" title="å‘æ–‡ç”³æ˜"></a>å‘æ–‡ç”³æ˜</h3><blockquote><ol><li>æœ¬æ–‡ä»…å¯¹è‡ªå·±ç»ƒä¹  rhce é¢˜ç›®åšä¸€ä¸ªè®°å½•ï¼ŒåŒæ—¶çºªå¿µè‡ªå·±è€ƒè¯•ç»å†ã€‚ä¸æ¶‰åŠä»»ä½•æ¨å¹¿æˆ–å¹¿å‘Šã€‚</li><li>æ–‡ä¸­é¢˜åº“æ¥æºäºâ€œæ·˜å®ç¯å¢ƒâ€ï¼ˆä¸€èˆ¬å‚è€ƒæœ‹å‹éƒ½æ˜ç™½æŒ‡çš„æ˜¯å“ªä¸€å¥—ç¯å¢ƒï¼Œå¦‚æœç¡®å®ä¸çŸ¥é“ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘å¯ä»¥è´¡çŒ®ä¸€ä»½ã€‚å½“å¤©å»è€ƒåœºçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨é™å®‰è€ƒåœºå‘ç°è€ƒåœºä½¿ç”¨çš„ç»ƒä¹ ç¯å¢ƒä¹Ÿæ˜¯â€œæ·˜å®ç¯å¢ƒâ€ï¼Œä¸å¾—ä¸è¯´é¢˜åº“è¿˜æ˜¯æ¯”è¾ƒå‡†ç¡®çš„ï¼‰</li><li>â€œæ·˜å®ç¯å¢ƒâ€å‰ 1-6 é¢˜ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å¯ä»¥ç›´æ¥ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢ç­”é¢˜ï¼Œé¿å…é€šç¯‡éƒ½æ˜¯å›¾ç‰‡ï¼Œå‰ 1-6 é¢˜ï¼Œåªä¼šç½—åˆ—å‡ºå…³é”®æ­¥éª¤ï¼Œå…·ä½“æ­¥éª¤è¯·å‚è€ƒâ€œæ·˜å®ç¯å¢ƒâ€é…å¥—æä¾›çš„æ•™å­¦è§†é¢‘è§£é¢˜ã€‚æœ¬æ–‡å°†ä»ç¬¬ 7 é¢˜å¼€å§‹è¯¦ç»†æä¾›å‚è€ƒè§£ç­”æ–¹æ¡ˆã€‚</li></ol></blockquote><h3 id="å…³äºç»ƒé¢˜å¿ƒæ€"><a href="#å…³äºç»ƒé¢˜å¿ƒæ€" class="headerlink" title="å…³äºç»ƒé¢˜å¿ƒæ€"></a>å…³äºç»ƒé¢˜å¿ƒæ€</h3><ul><li>åˆšå¼€å§‹ç»ƒé¢˜çš„æ—¶å€™ï¼Œè‚¯å®šä¼šæœ‰å¾ˆå¤šä¸ç†Ÿæ‚‰çš„åœ°æ–¹ï¼Œå»ºè®®å¯ä»¥é’ˆå¯¹æ€§çš„ç»ƒä¹ ï¼Œå¯ä»¥å…ˆé’ˆå¯¹è‡ªå·±è§‰å¾—æ¯”è¾ƒéš¾çš„é¢˜ç›®ç»ƒä¹ ï¼Œä½†ä¸€å®šè¦åˆ‡è®°æ³¨æ„é¢˜ä¸é¢˜ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li><li>ä¸€å®šè¦æ³¨æ„ï¼Œå‘ä»–äººè¯·æ•™è§£é¢˜çš„æ–¹æ³•ä»…ä¾›è‡ªå·±å‚è€ƒï¼Œå¯»æ‰¾é€‚åˆè‡ªå·±çš„æ–¹å¼æ–¹æ³•ï¼Œæœ€ä¸ºé‡è¦ï¼</li><li>å°‘å¬ä¸€äº›è€ƒç”ŸæŠ±æ€¨è€ƒåœºç¯å¢ƒä¹‹ç±»çš„ï¼Œä½ è¦ç›¸ä¿¡ï¼Œåªè¦æ˜¯ä½ è‡ªå·±ç»ƒçš„å¥½ï¼Œå†åƒåœ¾çš„ç¯å¢ƒï¼Œä½ éƒ½èƒ½å¤Ÿä¿è¯ä½ å¯ä»¥è€ƒè¿‡ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥å‘ç°ï¼Œå–œæ¬¢æŠ±æ€¨çš„è€ƒç”Ÿè‡ªèº«æœ¬æ¥å°±ç»ƒçš„ä¸æ€ä¹ˆæ ·ã€‚</li><li>CE ç»ƒé¢˜ï¼Œä¸€å®šè¦è®©è‡ªå·±è¾¾åˆ°æ‰«ä¸€çœ¼é¢˜ç›®å°±çŸ¥é“è¯¥é¢˜ç›®çš„è§£é¢˜æ­¥éª¤è¿™æ ·çš„å¢ƒç•Œï¼Œå…ˆåœ¨è„‘æµ·ä¸­æ€è€ƒä¸€ä¸‹ç­”é¢˜æ­¥éª¤ï¼Œå†ç­”é¢˜ã€‚</li><li>è€ƒè¯•æ—¶ä¸€æ¡å‘½ä»¤æ•²å®Œä¹‹åï¼Œå¼ºçƒˆå»ºè®®ä¸è¦é©¬ä¸Šå°±æ•²å›è½¦ï¼Œå†æ£€æŸ¥ä¸€ä¸‹è‡ªå·±æ•²çš„å‘½ä»¤ï¼Œç¡®è®¤æ— è¯¯ä¹‹åå†å›è½¦ã€‚ä½ è¦ç›¸ä¿¡æ’é”™æ¯”ä½ æ£€æŸ¥è¦èŠ±æ—¶é—´å¤šå¾—å¤šï¼Œå¹¶ä¸”æœ‰æ—¶å€™ä½ ä¸€æ—¦å‘½ä»¤æ•²é”™äº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å‰©ä¸‹çš„é¢˜ç›®æ— æ³•ç»§ç»­ä¸‹å»ã€‚æ¯”å¦‚ï¼šåˆ†åŒºæ—¶ï¼Œä½ ä¸€ä¸å°å¿ƒåˆ†äº† 4 ä¸ªä¸»åˆ†åŒºï¼Œç„¶è€Œä½ åˆä¸ä¼šåˆ é™¤åˆ†åŒºï¼Œè¿™æ ·å°±ç›´æ¥å¯¼è‡´ä½ åé¢å…³äºåˆ†åŒºçš„é¢˜ç›®æ— æ³•è¿›è¡Œã€‚å¾—ä¸å¿å¤±ï¼</li><li>è€ƒè¯•åšå®Œä¹‹åï¼Œå¼ºçƒˆå»ºè®®å…ˆæ•²å‡» <code>sync</code> å‘½ä»¤å¼ºåˆ¶åŒæ­¥æ•°æ®åˆ°ç¡¬ç›˜ä¸­ï¼Œç„¶åå…ˆå…³é—­ system2 ï¼ˆå®¢æˆ·ç«¯ï¼‰å†å…³é—­ system1ï¼ˆæœåŠ¡ç«¯ï¼‰ï¼Œå¼€æœºçš„æ—¶å€™å…ˆå¼€å¯ system1 ï¼ˆæœåŠ¡ç«¯ï¼‰å†å¼€å¯ system2 ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼ŒåŸå› ï¼šsystem1 æä¾›æœåŠ¡ï¼Œsystem2 æŒ‚è½½æœåŠ¡ï¼Œå¼€å…³æœºé¡ºåºä¸æ­£ç¡®ï¼Œæå¤§å¯èƒ½æ€§ä¼šå¯¼è‡´æŒ‚è½½å¤±è´¥ï¼</li><li>å¦å¤–ï¼ŒæŒ‚è½½ iscsi ç½‘ç»œå­˜å‚¨æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ·»åŠ  <code>_netdev</code> å‚æ•°ï¼Œé˜²æ­¢å› ä¸ºç½‘ç»œåŸå› ï¼Œå¯¼è‡´æŒ‚è½½å¤±è´¥ï¼</li><li>ä¹ æ­¦ä¹‹äººï¼Œä¸æ€•ç»ƒåƒä¸‡æ‹›ï¼Œå°±æ€•ä¸€æ‹›ç»ƒåƒä¸‡éï¼ç¥å¤§å®¶è€ƒè¯•é¡ºåˆ©ï¼</li></ul><h3 id="è€ƒè¯•èƒŒæ™¯"><a href="#è€ƒè¯•èƒŒæ™¯" class="headerlink" title="è€ƒè¯•èƒŒæ™¯"></a>è€ƒè¯•èƒŒæ™¯</h3><blockquote><p>è€ƒè¯•åœ°ç‚¹ï¼šä¸Šæµ·é™å®‰è€ƒåœºï¼ˆä¸Šæµ·é™å®‰åŒºä¹Ÿå°±é‚£ä¹ˆä¸€ä¸ªè€ƒåœºï¼Œä¸ºé¿å…å¹¿å‘Šä¹‹å«Œï¼Œå…·ä½“ä½ç½®è¯·è‡ªå·±æŸ¥è¯¢ï¼Œæˆ–ç›´æ¥ç»™æˆ‘ç•™è¨€ï¼‰<br>è€ƒåœºç¯å¢ƒï¼šç³»ç»Ÿä¸º redhat 7.0 64 ä½ï¼Œä½¿ç”¨ kvm è™šæ‹Ÿæœºï¼Œå› æ­¤éœ€æ³¨æ„ç¡¬ç›˜ä¸º <code>/dev/vd*</code><br>è€ƒè¯•æ—¶é—´ï¼š2019 å¹´ 9 æœˆ 6 æ—¥</p></blockquote><h3 id="é¢˜åº“åˆ†ç±»"><a href="#é¢˜åº“åˆ†ç±»" class="headerlink" title="é¢˜åº“åˆ†ç±»"></a>é¢˜åº“åˆ†ç±»</h3><p>å¦‚æœæŠŠ RHCE é¢˜åº“åšä¸€ä¸ªåˆ†ç±»ï¼Œé‚£ä¹ˆæˆ‘åšçš„åˆ†ç±»å¦‚ä¸‹ï¼š</p><ul><li>postfix é‚®ä»¶æœåŠ¡ç±»</li><li>samba å…±äº«æœåŠ¡ç±»</li><li>nfs å…±äº«æœåŠ¡ç±»</li><li>Apache web æœåŠ¡ç±»</li><li>è„šæœ¬ç±»</li><li>iscsi ç½‘ç»œå­˜å‚¨ç±»</li><li>MariaDB æ•°æ®åº“ç±»</li></ul><h3 id="æœ¬äººè§£é¢˜æ•´ä½“æ­¥éª¤ä¸º"><a href="#æœ¬äººè§£é¢˜æ•´ä½“æ­¥éª¤ä¸º" class="headerlink" title="æœ¬äººè§£é¢˜æ•´ä½“æ­¥éª¤ä¸º"></a>æœ¬äººè§£é¢˜æ•´ä½“æ­¥éª¤ä¸º</h3><ol><li>éœ€è¦å®‰è£…æœåŠ¡ï¼Œåˆ™ä¼˜å…ˆå®‰è£…æœåŠ¡</li><li>å¦‚æœéœ€è¦åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œåˆ™ä¼˜å…ˆåˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆå¹¶ä¸”è®¾ç½® selinux ä¸Šä¸‹æ–‡ï¼‰</li><li>å¦‚æœéœ€è¦åˆ›å»ºæœåŠ¡è´¦å·ï¼Œåˆ™ä¼˜å…ˆåˆ›å»ºæœåŠ¡è´¦å·</li><li>å†™é…ç½®æ–‡ä»¶</li><li>é‡å¯æœåŠ¡ï¼Œå¹¶å°†æœåŠ¡åŠ å…¥å¼€æœºå¯åŠ¨é¡¹</li><li>è®¾ç½®ç›¸åº”çš„é˜²ç«å¢™ï¼ˆä¼˜å…ˆä½¿ç”¨é˜²ç«å¢™ä¸­çš„å¯Œè§„åˆ™è¿‡æ»¤ï¼Œå› ä¸ºå¯Œè§„åˆ™çš„ä¼˜å…ˆçº§æœ€é«˜ï¼‰</li><li>ç®€å•æµ‹è¯•ä¸€ä¸‹</li></ol><p>RHCE è€ƒè¯•æ­¥éª¤è¾ƒå¤šï¼Œå¦‚æœå®Œå…¨é è‡ªå·±æ­»è®°ç¡¬èƒŒï¼ŒåŸºæœ¬ä¸Šå¾ˆéš¾é€šè¿‡è€ƒè¯•ï¼Œä½†æ˜¯å¦‚æœèƒ½å¤ŸæŒ‰ç…§ä»¥ä¸Šçš„è§£é¢˜æ­¥éª¤æ¥ï¼Œå¤šåŠæƒ…å†µä¸‹ä¸ä¼šå¿˜è®°æ­¥éª¤ï¼Œä¸‹æ–‡æˆ‘å°†æä¾›æœ¬äººçš„è§£é¢˜æ­¥éª¤ï¼Œä»¥ä¾›å„ä½å‚è€ƒã€‚</p><h2 id="æ·˜å®é¢˜åº“"><a href="#æ·˜å®é¢˜åº“" class="headerlink" title="æ·˜å®é¢˜åº“"></a>æ·˜å®é¢˜åº“</h2><p>ç¯å¢ƒè¯´æ˜ï¼š</p><blockquote><p>system1.group8.example.com ï¼š 172.24.8.11/24   ä½œä¸ºæœåŠ¡å™¨<br>system2.group8.example.com ï¼š 172.24.8.12/24   ä½œä¸ºå®¢æˆ·ç«¯<br>server.group8.example.com æä¾›äº†YUMè½¯ä»¶ä»“åº“ï¼ŒURLæ˜¯ <a href="http://server.group8.example.com/yum">http://server.group8.example.com/yum</a></p></blockquote><ul><li><h5 id="system1-å’Œ-system2-éœ€è¦å…ˆé…ç½®-yum-ä»“åº“"><a href="#system1-å’Œ-system2-éœ€è¦å…ˆé…ç½®-yum-ä»“åº“" class="headerlink" title="system1 å’Œ system2 éœ€è¦å…ˆé…ç½® yum ä»“åº“"></a>system1 å’Œ system2 éœ€è¦å…ˆé…ç½® yum ä»“åº“</h5></li></ul><p><code>system1</code> å’Œ <code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# vim /etc/yum.repos.d/rhce.repo[root@system1 Desktop]# yum clean all[root@system1 Desktop]# yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2b14dc0d49d4280f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>rhce.repo æ–‡ä»¶ä¸­å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">[rhce]name=rhcebaseurl=http://server.group8.example.com/yumenabled=1gpgcheck=0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-0b49bcdc721261dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬ä¸€é¢˜ï¼šè®¾å®š-SELinux"><a href="#ç¬¬ä¸€é¢˜ï¼šè®¾å®š-SELinux" class="headerlink" title="ç¬¬ä¸€é¢˜ï¼šè®¾å®š SELinux"></a>ç¬¬ä¸€é¢˜ï¼šè®¾å®š SELinux</h5></li></ul><p>åœ¨ system1 å’Œ system2 ä¸Šè¦æ±‚ SELinux çš„å·¥ä½œæ¨¡å¼ä¸º enforcing :<br>1.è¦æ±‚ç³»ç»Ÿé‡å¯åä¾ç„¶ç”Ÿæ•ˆã€‚</p><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code> å’Œ <code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# vim /etc/selinux/config <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><ul><li><h5 id="ç¬¬äºŒé¢˜ï¼šé…ç½®é˜²ç«å¢™"><a href="#ç¬¬äºŒé¢˜ï¼šé…ç½®é˜²ç«å¢™" class="headerlink" title="ç¬¬äºŒé¢˜ï¼šé…ç½®é˜²ç«å¢™"></a>ç¬¬äºŒé¢˜ï¼šé…ç½®é˜²ç«å¢™</h5></li></ul><p>è¯·æŒ‰ä¸‹åˆ—è¦æ±‚åœ¨ system1 å’Œ system2 ä¸Šè®¾å®šé˜²ç«å¢™ç³»ç»Ÿï¼š</p><ol><li>å…è®¸ group8.example.com åŸŸçš„å®¢æˆ·å¯¹ system1 å’Œ system2 è¿›è¡Œ ssh è®¿é—®ã€‚</li><li>ç¦æ­¢ my133t.org åŸŸçš„å®¢æˆ·å¯¹ system1 å’Œ system2 è¿›è¡Œ ssh è®¿é—®ã€‚</li><li>å¤‡æ³¨ï¼š my133t.org æ˜¯åœ¨ 172.13.8.0/24 ç½‘ç»œ</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code> å’Œ <code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# firewall-config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-685c1f39cb89e302.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬ä¸‰é¢˜ï¼šè‡ªå®šä¹‰ç”¨æˆ·ç¯å¢ƒ"><a href="#ç¬¬ä¸‰é¢˜ï¼šè‡ªå®šä¹‰ç”¨æˆ·ç¯å¢ƒ" class="headerlink" title="ç¬¬ä¸‰é¢˜ï¼šè‡ªå®šä¹‰ç”¨æˆ·ç¯å¢ƒ"></a>ç¬¬ä¸‰é¢˜ï¼šè‡ªå®šä¹‰ç”¨æˆ·ç¯å¢ƒ</h5></li></ul><p>åœ¨ç³»ç»Ÿsystem1å’Œsystem2ä¸Šåˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ä¸ºqstat ï¼Œè¦æ±‚ï¼š</p><ol><li>æ­¤è‡ªå®šä¹‰å‘½ä»¤å°†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š/bin/ps -Ao pid,tt,user,fname,rsz</li><li>æ­¤å‘½ä»¤å¯¹ç³»ç»Ÿä¸­çš„æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆ</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code> å’Œ <code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# vim /etc/profile[root@system1 Desktop]# source /etc/profile[root@system1 Desktop]# qstat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>/etc/profile é…ç½®æ–‡ä»¶ä¸­å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">alias qstat='/bin/ps -Ao pid,tt,user,fname,rsz'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-d5e1ff3426c65c08.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬å››é¢˜ï¼šé…ç½®ç«¯å£è½¬å‘"><a href="#ç¬¬å››é¢˜ï¼šé…ç½®ç«¯å£è½¬å‘" class="headerlink" title="ç¬¬å››é¢˜ï¼šé…ç½®ç«¯å£è½¬å‘"></a>ç¬¬å››é¢˜ï¼šé…ç½®ç«¯å£è½¬å‘</h5></li></ul><p>åœ¨ç³»ç»Ÿ system1 è®¾å®šç«¯å£è½¬å‘ï¼Œè¦æ±‚ï¼š</p><ol><li>åœ¨ 172.24.8.0/24 ç½‘ç»œä¸­çš„ç³»ç»Ÿï¼Œè®¿é—® system1 çš„æœ¬åœ°ç«¯å£ 5423 å°†è¢«è½¬å‘åˆ° 80</li><li>æ­¤è®¾ç½®å¿…é¡»æ°¸ä¹…æœ‰æ•ˆ</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-263777cf2f595092.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ffcd889ca6555d28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e3b7e7f525b14f0a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬äº”é¢˜ï¼šé…ç½®é“¾è·¯èšåˆ"><a href="#ç¬¬äº”é¢˜ï¼šé…ç½®é“¾è·¯èšåˆ" class="headerlink" title="ç¬¬äº”é¢˜ï¼šé…ç½®é“¾è·¯èšåˆ"></a>ç¬¬äº”é¢˜ï¼šé…ç½®é“¾è·¯èšåˆ</h5></li></ul><p>åœ¨ system2 å’Œ system1 ä¹‹é—´æŒ‰ä»¥ä¸‹è¦æ±‚è®¾å®šä¸€ä¸ªé“¾è·¯ï¼š</p><ol><li>æ­¤é“¾è·¯ä½¿ç”¨æ¥å£ eth1 å’Œ eth2</li><li>æ­¤é“¾è·¯åœ¨ä¸€ä¸ªæ¥å£å¤±æ•ˆæ—¶ä»ç„¶èƒ½å·¥ä½œ</li><li>æ­¤é“¾è·¯åœ¨ system1 ä½¿ç”¨ä¸‹é¢çš„åœ°å€ 172.16.3.40/255.255.255.0</li><li>æ­¤é“¾è·¯åœ¨ system2 ä½¿ç”¨ä¸‹é¢çš„åœ°å€ 172.16.3.45/255.255.255.0</li><li>æ­¤é“¾è·¯åœ¨ç³»ç»Ÿé‡å¯ä¹‹åä¾ç„¶ä¿æŒæ­£å¸¸çŠ¶æ€</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# nm-connection-editor[root@system1 Desktop]# systemctl restart network[root@system1 Desktop]# ping 172.16.3.40[root@system1 Desktop]# ping 172.16.3.45<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2d8890e00f7e7a04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-938e1da1dc07f101.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><code>system2</code></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-e7b8bebe398a150b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><pre class="line-numbers language-none"><code class="language-none">[root@system2 Desktop]# nm-connection-editor[root@system2 Desktop]# systemctl restart network[root@system2 Desktop]# ping 172.16.3.45[root@system2 Desktop]# ping 172.16.3.40<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">{"runner":{"name":"activebackup"}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><ul><li><h5 id="ç¬¬å…­é¢˜ï¼šé…ç½®-IPV6-åœ°å€"><a href="#ç¬¬å…­é¢˜ï¼šé…ç½®-IPV6-åœ°å€" class="headerlink" title="ç¬¬å…­é¢˜ï¼šé…ç½® IPV6 åœ°å€"></a>ç¬¬å…­é¢˜ï¼šé…ç½® IPV6 åœ°å€</h5></li></ul><p>åœ¨è€ƒè¯•ç³»ç»Ÿä¸Šè®¾å®šæ¥å£ eth0 ä½¿ç”¨ä¸‹åˆ— IPV6 åœ°å€ï¼š</p><ol><li>system1 ä¸Šçš„åœ°å€åº”è¯¥æ˜¯ 2003:ac18::305/64</li><li>system2 ä¸Šçš„åœ°å€åº”è¯¥æ˜¯ 2003:ac18::30a/64</li><li>ä¸¤ä¸ªç³»ç»Ÿå¿…é¡»èƒ½ä¸ç½‘ç»œ 2003:ac18/64 å†…çš„ç³»ç»Ÿé€šä¿¡</li><li>åœ°å€å¿…é¡»åœ¨é‡å¯åä¾ç„¶ç”Ÿæ•ˆ</li><li>ä¸¤ä¸ªç³»ç»Ÿå¿…é¡»ä¿æŒå½“å‰çš„ IPV4 åœ°å€å¹¶èƒ½é€šä¿¡</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# nm-connection-editor[root@system1 Desktop]# systemctl restart network[root@system1 Desktop]# ping6 2003:ac18::305[root@system1 Desktop]# ping6 2003:ac18::30a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-77f2dedf4521b751.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ba079898f48dc40d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system2 Desktop]# nm-connection-editor[root@system2 Desktop]# systemctl restart network[root@system2 Desktop]# ping6 2003:ac18::30a[root@system2 Desktop]# ping6 2003:ac18::305<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-96fb85bc8b4f6eb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬ä¸ƒé¢˜ï¼šé…ç½®æœ¬åœ°é‚®ä»¶æœåŠ¡"><a href="#ç¬¬ä¸ƒé¢˜ï¼šé…ç½®æœ¬åœ°é‚®ä»¶æœåŠ¡" class="headerlink" title="ç¬¬ä¸ƒé¢˜ï¼šé…ç½®æœ¬åœ°é‚®ä»¶æœåŠ¡"></a>ç¬¬ä¸ƒé¢˜ï¼šé…ç½®æœ¬åœ°é‚®ä»¶æœåŠ¡</h5></li></ul><p>åœ¨ç³»ç»Ÿ system2 å’Œ system1 ä¸Šé…ç½®é‚®ä»¶æœåŠ¡ï¼Œè¦æ±‚ï¼š</p><ol><li>è¿™äº›ç³»ç»Ÿä¸æ¥å—å¤–éƒ¨å‘é€æ¥çš„é‚®ä»¶</li><li>åœ¨è¿™äº›ç³»ç»Ÿä¸Šæœ¬åœ°å‘é€çš„ä»»ä½•é‚®ä»¶éƒ½ä¼šè‡ªåŠ¨è·¯ç”±åˆ° mail.group8.example.com<br>ä»è¿™äº›ç³»ç»Ÿä¸Šå‘é€çš„é‚®ä»¶æ˜¾ç¤ºæ¥è‡ªäº server.group8.example.com</li><li>æ‚¨å¯ä»¥é€šè¿‡å‘é€é‚®ä»¶åˆ°æœ¬åœ°ç”¨æˆ· dave æ¥æµ‹è¯•æ‚¨çš„é…ç½®,ç³»ç»Ÿ server.group8.example.com å·²ç»é…ç½®æŠŠæ­¤ç”¨æˆ·çš„é‚®ä»¶è½¬åˆ°URL <a href="http://server.group8.example.com/pub/received_mail/8">http://server.group8.example.com/pub/received_mail/8</a></li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code> å’Œ <code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# vim /etc/postfix/main.cf [root@system1 Desktop]# systemctl restart postfix[root@system1 Desktop]# systemctl enable postfix[root@system1 Desktop]# firewall-cmd --permanent --add-service=smtp[root@system1 Desktop]# firewall-cmd --reload[root@system1 Desktop]# echo "test content" | mail -s "testobject" dave[root@system1 Desktop]# curl http://server.group8.example.com/pub/received_mail/8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">98 local_transport = error:local    ï¼ˆéœ€å•ç‹¬æ·»åŠ ï¼‰99 myorigin = server.group8.example.com314 relayhost = mail.group8.example.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-39805ba385d89d4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-63dc4393dec4e855.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-6b036d5df79504c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><ul><li><h5 id="ç¬¬å…«é¢˜ï¼šé€šè¿‡-SMB-å…±äº«ç›®å½•"><a href="#ç¬¬å…«é¢˜ï¼šé€šè¿‡-SMB-å…±äº«ç›®å½•" class="headerlink" title="ç¬¬å…«é¢˜ï¼šé€šè¿‡ SMB å…±äº«ç›®å½•"></a>ç¬¬å…«é¢˜ï¼šé€šè¿‡ SMB å…±äº«ç›®å½•</h5></li></ul><p>åœ¨ system1 ä¸Šé…ç½® SMB æœåŠ¡ ï¼Œè¦æ±‚ï¼š</p><ol><li>æ‚¨çš„ SMB æœåŠ¡å™¨å¿…é¡»æ˜¯ STAFF å·¥ä½œç»„çš„ä¸€ä¸ªæˆå‘˜</li><li>å…±äº« /common ç›®å½•ï¼Œå…±äº«åå¿…é¡»ä¸º common</li><li>åªæœ‰ group8.example.com åŸŸå†…çš„å®¢æˆ·ç«¯å¯ä»¥è®¿é—® common å…±äº«</li><li>common å¿…é¡»æ˜¯å¯ä»¥æµè§ˆçš„</li><li>ç”¨æˆ· andy å¿…é¡»èƒ½å¤Ÿè¯»å–å…±äº«ä¸­çš„å†…å®¹ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼ŒéªŒè¯å¯†ç æ˜¯ redhat</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# yum -y install samba samba-client[root@system1 Desktop]# mkdir /common[root@system1 Desktop]# chcon -R -t samba_share_t /common[root@system1 Desktop]# id andy[root@system1 Desktop]# smbpasswd -a andy[root@system1 Desktop]# vim /etc/samba/smb.conf [root@system1 Desktop]# setsebool -P samba_enable_home_dirs on[root@system1 Desktop]# systemctl restart smb nmb[root@system1 Desktop]# systemctl enable smb nmb[root@system1 Desktop]# firewall-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¾ç½®é˜²ç«å¢™</p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# firewall-cmd --permanent --add-service=samba[root@system1 Desktop]# firewall-cmd --permanent --add-service=mountd[root@system1 Desktop]# firewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é…ç½®æ–‡ä»¶å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none"> 89         workgroup = STAFF321 [common]322 path = /common323 hosts allow = 172.24.8.324 browseable = yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3e11066974a205bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f1e0a54d16e2d6e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fb8ea5538214efd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f24588e22d80a04a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>éªŒè¯ï¼š</p><p><code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system2 Desktop]# yum -y install samba-client cifs-utils[root@system2 Desktop]# smbclient -L //172.24.8.11 -U andy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b16cc12affa9a5a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬ä¹é¢˜ï¼šé…ç½®å¤šç”¨æˆ·-SMB-æŒ‚è½½"><a href="#ç¬¬ä¹é¢˜ï¼šé…ç½®å¤šç”¨æˆ·-SMB-æŒ‚è½½" class="headerlink" title="ç¬¬ä¹é¢˜ï¼šé…ç½®å¤šç”¨æˆ· SMB æŒ‚è½½"></a>ç¬¬ä¹é¢˜ï¼šé…ç½®å¤šç”¨æˆ· SMB æŒ‚è½½</h5></li></ul><p>åœ¨ system1 é€šè¿‡ SMB å…±äº«ç›®å½• /devops ,å¹¶æ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š</p><ol><li>å…±äº«åä¸º devops</li><li>å…±äº«ç›®å½• devops åªèƒ½ group8.example.com åŸŸä¸­çš„å®¢æˆ·ç«¯ä½¿ç”¨</li><li>å…±äº«ç›®å½• devops å¿…é¡»å¯ä»¥è¢«æµè§ˆ</li><li>ç”¨æˆ· silene å¿…é¡»èƒ½ä»¥è¯»çš„æ–¹å¼è®¿é—®æ­¤å…±äº«ï¼Œè®¿é—®å¯†ç æ˜¯redhat</li><li>ç”¨æˆ· akira å¿…é¡»èƒ½ä»¥è¯»å†™çš„æ–¹å¼è®¿é—®æ­¤å…±äº«ï¼Œè®¿é—®å¯†ç æ˜¯redhat</li><li>æ­¤å…±äº«æ°¸ä¹…æŒ‚è½½åœ¨ system2.group8.example.com ä¸Šçš„ /mnt/dev ç›®å½•ï¼Œå¹¶ä½¿ç”¨ç”¨æˆ· silene ä½œä¸ºè®¤è¯ä»»ä½•ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡ç”¨æˆ· akira æ¥ä¸´æ—¶è·å–å†™çš„æƒé™</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# ls -ald /devops[root@system1 Desktop]# mkdir /devops[root@system1 Desktop]# chmod o+w /devops[root@system1 Desktop]# chcon -R -t samba_share_t /devops[root@system1 Desktop]# id silene[root@system1 Desktop]# smbpasswd -a silene[root@system1 Desktop]# id akira[root@system1 Desktop]# smbpasswd -a akira[root@system1 Desktop]# vim /etc/samba/smb.conf[root@system1 Desktop]# systemctl restart smb nmb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®æ–‡ä»¶å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">325 [devops]326 path = devops327 hosts allow = 172.24.8.328 browseable = yes329 writable = no330 write list = akira<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-c70f323e9ffbf6fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system2 Desktop]# yum -y install cifs*[root@system2 Desktop]# smbclient -L //172.24.8.11 -U silene[root@system2 Desktop]# smbclient -L //172.24.8.12 -U akira[root@system2 Desktop]# ls -ald /mnt/dev[root@system2 Desktop]# mkdir -p /mnt/dev[root@system2 Desktop]# vim /etc/fstab [root@system2 Desktop]# mount -a[root@system2 Desktop]# df -hT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/fstab æŒ‚è½½é…ç½®æ–‡ä»¶ä¸­å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">//172.24.8.11/devops /mnt/dev cifs defaults,multiuser,username=silene,password=redhat,sec=ntlmssp 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-fb7fd346bbe27159.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-2d02e76c2d839096.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åé¢˜ï¼šé…ç½®-NFS-æœåŠ¡"><a href="#ç¬¬åé¢˜ï¼šé…ç½®-NFS-æœåŠ¡" class="headerlink" title="ç¬¬åé¢˜ï¼šé…ç½® NFS æœåŠ¡"></a>ç¬¬åé¢˜ï¼šé…ç½® NFS æœåŠ¡</h5></li></ul><p>åœ¨ system1 é…ç½® NFS æœåŠ¡ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p><ol><li>ä»¥åªè¯»çš„æ–¹å¼å…±äº«ç›®å½• /public ï¼ŒåŒæ—¶åªèƒ½è¢« group8.example.com åŸŸä¸­çš„ç³»ç»Ÿè®¿é—®</li><li>ä»¥è¯»å†™çš„æ–¹å¼å…±äº«ç›®å½• /protected ï¼ŒåŒæ—¶åªèƒ½è¢« group8.example.com åŸŸä¸­çš„ç³»ç»Ÿè®¿é—®</li><li>è®¿é—® /protected éœ€è¦é€šè¿‡ Kerberos å®‰å…¨åŠ å¯†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢ URL æä¾›çš„å¯†é’¥<br><a href="http://server.group8.example.com/pub/keytabs/system1.keytab">http://server.group8.example.com/pub/keytabs/system1.keytab</a></li><li>ç›®å½• /protected åº”è¯¥åŒ…å«åä¸º project æ‹¥æœ‰äººä¸º andres çš„å­ç›®å½•</li><li>ç”¨æˆ· andres èƒ½ä»¥è¯»å†™æ–¹å¼è®¿é—® /protected/project</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# ls -ald /public[root@system1 Desktop]# mkdir /public[root@system1 Desktop]# ls -ald /protected[root@system1 Desktop]# mkdir -p /protected/project[root@system1 Desktop]# chown andres /protected/project[root@system1 Desktop]# ls -ald /protected/project[root@system1 Desktop]# chcon -R -t public_content_t /public[root@system1 Desktop]# chcon -R -t public_content_t /protected[root@system1 Desktop]# wget -O /etc/krb5.keytab http://server.group8.example.com/pub/keytabs/system1.keytab[root@system1 Desktop]# vim /etc/sysconfig/nfs [root@system1 Desktop]# vim /etc/exports[root@system1 Desktop]# systemctl restart nfs-server nfs-secure-server[root@system1 Desktop]# systemctl enable nfs-server nfs-secure-server[root@system1 Desktop]# firewall-config [root@system1 Desktop]# exportfs -r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/sysconfig/nfs é…ç½®æ–‡ä»¶ä¸­å¡«å†™çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">13 RPCNFSDARGS="-V 4.2"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-4913def5d21efda0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>/etc/exports é…ç½®æ–‡ä»¶ä¸­å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">1 /public 172.24.8.0/24(ro)2 /protected 172.24.8.0/24(rw,sec=krb5p)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è®¾ç½®é˜²ç«å¢™</p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# firewall-cmd --permanent --add-service=nfs[root@system1 Desktop]# firewall-cmd --permanent --add-service=rpc-bind[root@system1 Desktop]# firewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><ul><li><h5 id="ç¬¬åä¸€é¢˜ï¼šæŒ‚è½½ä¸€ä¸ª-NFS-å…±äº«"><a href="#ç¬¬åä¸€é¢˜ï¼šæŒ‚è½½ä¸€ä¸ª-NFS-å…±äº«" class="headerlink" title="ç¬¬åä¸€é¢˜ï¼šæŒ‚è½½ä¸€ä¸ª NFS å…±äº«"></a>ç¬¬åä¸€é¢˜ï¼šæŒ‚è½½ä¸€ä¸ª NFS å…±äº«</h5></li></ul><p>åœ¨ system2 ä¸ŠæŒ‚è½½ä¸€ä¸ªæ¥è‡ª system1.group8.example.com çš„ NFS å…±äº«,å¹¶ç¬¦åˆä¸‹åˆ—è¦æ±‚ï¼š</p><ol><li>/public æŒ‚è½½åœ¨ä¸‹é¢çš„ç›®å½•ä¸Š /mnt/nfsmount</li><li>/protected æŒ‚è½½åœ¨ä¸‹é¢çš„ç›®å½•ä¸Š /mnt/nfssecure å¹¶ä½¿ç”¨å®‰å…¨çš„æ–¹å¼ï¼Œå¯†é’¥ä¸‹è½½ URL å¦‚ä¸‹ï¼š<a href="http://server.group8.example.com/pub/keytabs/system2.keytab">http://server.group8.example.com/pub/keytabs/system2.keytab</a></li><li>ç”¨æˆ· andres èƒ½å¤Ÿåœ¨ /mnt/nfssecure/project ä¸Šåˆ›å»ºæ–‡ä»¶</li><li>è¿™äº›æ–‡ä»¶ç³»ç»Ÿåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system2 Desktop]# showmount -e 172.24.8.11[root@system2 Desktop]# systemctl restart nfs-secure[root@system2 Desktop]# systemctl enable nfs-secure[root@system2 Desktop]# ls -ald /mnt/nfsmount[root@system2 Desktop]# mkdir -p /mnt/nfsmount[root@system2 Desktop]# ls -ald /mnt/nfssecure[root@system2 Desktop]# mkdir -p /mnt/nfssecure[root@system2 Desktop]# wget -O /etc/krb5.keytab http://server.group8.example.com/pub/keytabs/system2.keytab[root@system2 Desktop]# vim /etc/fstab [root@system2 Desktop]# mount -a[root@system2 Desktop]# df -hT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/fstab æŒ‚è½½é…ç½®æ–‡ä»¶å¡«å†™çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">172.24.8.11:/public /mnt/nfsmount nfs defaults 0 0172.24.8.11:/protected /mnt/nfssecure nfs defaults,sec=krb5p,v4.2 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-24db5060b6f9e1e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åäºŒé¢˜ï¼šå®ç°ä¸€ä¸ª-web-æœåŠ¡å™¨"><a href="#ç¬¬åäºŒé¢˜ï¼šå®ç°ä¸€ä¸ª-web-æœåŠ¡å™¨" class="headerlink" title="ç¬¬åäºŒé¢˜ï¼šå®ç°ä¸€ä¸ª web æœåŠ¡å™¨"></a>ç¬¬åäºŒé¢˜ï¼šå®ç°ä¸€ä¸ª web æœåŠ¡å™¨</h5></li></ul><p>åœ¨ system1 ä¸Šé…ç½®ä¸€ä¸ªç«™ç‚¹ <a href="http://system1.group8.example.com/%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%8B%E8%BF%B0%E6%AD%A5%E9%AA%A4%EF%BC%9A">http://system1.group8.example.com/ï¼Œç„¶åæ‰§è¡Œä¸‹è¿°æ­¥éª¤ï¼š</a></p><ol><li>ä» <a href="http://server.group8.example.com/pub/system1.html">http://server.group8.example.com/pub/system1.html</a> ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶ä¸”å°†æ–‡ä»¶é‡åä¸º index.html ä¸è¦ä¿®æ”¹æ­¤æ–‡ä»¶çš„å†…å®¹</li><li>å°†æ–‡ä»¶ index.html æ‹·è´åˆ°æ‚¨çš„ web æœåŠ¡å™¨çš„ DocumentRoot ç›®å½•ä¸‹</li><li>æ¥è‡ªäº group8.example.com åŸŸçš„å®¢æˆ·ç«¯å¯ä»¥è®¿é—®æ­¤ web æœåŠ¡</li><li>æ¥è‡ªäº my133t.org åŸŸçš„å®¢æˆ·ç«¯æ‹’ç»è®¿é—®æ­¤ web æœåŠ¡</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# yum -y install httpd[root@system1 Desktop]# cp /usr/share/doc/httpd-2.4.6/httpd-vhosts.conf /etc/httpd/conf.d/[root@system1 Desktop]# cd /var/www/html[root@system1 html]# wget -O index.html http://server.group8.example.com/pub/system1.html[root@system1 html]# vim /etc/httpd/conf.d/httpd-vhosts.conf[root@system1 html]# systemctl restart httpd[root@system1 html]# systemctl enable httpd[root@system1 html]# firewall-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1dfde17bdf2ad2be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>/etc/httpd/conf.d/httpd-vhosts.conf ç½‘ç«™é…ç½®æ–‡ä»¶ä¸­åº”è¯¥å†™çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">&lt;VirtualHost *:80&gt;    DocumentRoot "/var/www/html"    ServerName system1.group8.example.com&lt;/VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-ee2ee212b0c01df7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b369ae9ea1b88007.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åä¸‰é¢˜ï¼šé…ç½®å®‰å…¨-web-æœåŠ¡"><a href="#ç¬¬åä¸‰é¢˜ï¼šé…ç½®å®‰å…¨-web-æœåŠ¡" class="headerlink" title="ç¬¬åä¸‰é¢˜ï¼šé…ç½®å®‰å…¨ web æœåŠ¡"></a>ç¬¬åä¸‰é¢˜ï¼šé…ç½®å®‰å…¨ web æœåŠ¡</h5></li></ul><p>ä¸ºç«™ç‚¹ <a href="http://system1.group8.example.com/">http://system1.group8.example.com</a> é…ç½® TLS åŠ å¯†ï¼š</p><ol><li>ä¸€ä¸ªå·²ç­¾åè¯ä¹¦ä» <a href="http://server.group8.example.com/pub/tls/certs/system1.crt">http://server.group8.example.com/pub/tls/certs/system1.crt</a> è·å–</li><li>æ­¤è¯ä¹¦çš„å¯†é’¥ä» <a href="http://server.group8.example.com/pub/tls/private/system1.key">http://server.group8.example.com/pub/tls/private/system1.key</a> è·å–</li><li>æ­¤è¯ä¹¦çš„ç­¾åæˆæƒä¿¡æ¯ä» <a href="http://server.group8.example.com/pub/tls/certs/ssl-ca.crt">http://server.group8.example.com/pub/tls/certs/ssl-ca.crt</a> è·å–</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# yum -y install mod_ssl[root@system1 Desktop]# cd /var/www/html[root@system1 html]# wget http://server.group8.example.com/pub/tls/certs/system1.crt[root@system1 html]# wget http://server.group8.example.com/pub/tls/private/system1.key[root@system1 html]# wget http://server.group8.example.com/pub/tls/certs/ssl-ca.crt[root@system1 html]# vim /etc/httpd/conf.d/ssl.conf    ï¼ˆç”¨äºå‚è€ƒçš„é…ç½®æ–‡ä»¶ï¼‰[root@system1 html]# vim /etc/httpd/conf.d/httpd-vhosts.conf[root@system1 html]# setsebool -P httpd_read_user_content=on[root@system1 html]# systemctl restart httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/httpd/conf.d/httpd-vhosts.conf ç½‘ç«™é…ç½®æ–‡ä»¶ä¸­åº”è¯¥å†™çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">&lt;VirtualHost *:443&gt;SSLEngine onSSLProtocol all -SSLv2SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5SSLHonorCipherOrder on    DocumentRoot "/var/www/html"    ServerName system1.group8.example.comSSLCertificateFile /var/www/html/system1.crtSSLCertificateKeyFile /var/www/html/system1.keySSLCACertificateFile /var/www/html/ssl-ca.crt&lt;/VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-99e658186dfb348a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="/etc/httpd/conf.d/ssl.conf å‚è€ƒçš„é…ç½®æ–‡ä»¶"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-1368eb4ebabcab95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åå››é¢˜ï¼šé…ç½®è™šæ‹Ÿä¸»æœº"><a href="#ç¬¬åå››é¢˜ï¼šé…ç½®è™šæ‹Ÿä¸»æœº" class="headerlink" title="ç¬¬åå››é¢˜ï¼šé…ç½®è™šæ‹Ÿä¸»æœº"></a>ç¬¬åå››é¢˜ï¼šé…ç½®è™šæ‹Ÿä¸»æœº</h5></li></ul><p>åœ¨ system1 ä¸Šæ‰©å±•æ‚¨çš„ web æœåŠ¡å™¨ï¼Œä¸ºç«™ç‚¹ <a href="http://www8.group8.example.com/">http://www8.group8.example.com</a> åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œç„¶åæ‰§è¡Œä¸‹è¿°æ­¥éª¤ï¼š</p><ol><li>è®¾ç½® DocumentRoot ä¸º /var/www/virtual</li><li>ä» <a href="http://server.group8.example.com/pub/www8.html">http://server.group8.example.com/pub/www8.html</a> ä¸‹è½½æ–‡ä»¶é‡åä¸º index.html ,ä¸è¦å¯¹æ–‡ä»¶ index.html çš„å†…å®¹åšä»»ä½•ä¿®æ”¹</li><li>å°†æ–‡ä»¶ index.html æ”¾åˆ°è™šæ‹Ÿä¸»æœºçš„ DocumentRoot ç›®å½•ä¸‹</li><li>ç¡®ä¿ andy ç”¨æˆ·èƒ½å¤Ÿåœ¨ /var/www/virtual ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶</li></ol><p>æ³¨æ„ï¼šåŸç«™ç‚¹ <a href="http://system1.group8.example.com/">http://system1.group8.example.com</a> å¿…é¡»ä»ç„¶èƒ½å¤Ÿè®¿é—®ï¼Œåç§°æœåŠ¡å™¨ server.group8.example.com å·²ç»æä¾›å¯¹ä¸»æœºå www8.group8.example.com çš„åŸŸåè§£æ</p><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 Desktop]# mkdir /var/www/virtual[root@system1 Desktop]# cd /var/www/virtual[root@system1 virtual]# getfacl /var/www/virtual[root@system1 virtual]# setfacl -Rm u:andy:rwx /var/www/virtual[root@system1 virtual]# getfacl /var/www/virtual[root@system1 virtual]# wget -O index.html http://server.group8.example.com/pub/www8.html[root@system1 virtual]# vim /etc/httpd/conf.d/httpd-vhosts.conf[root@system1 virtual]# systemctl restart httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/httpd/conf.d/httpd-vhosts.conf é…ç½®æ–‡ä»¶ä¸­å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">&lt;VirtualHost *:80&gt;    DocumentRoot "/var/www/virtual"    ServerName www8.group8.example.com&lt;/VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-a5cc2d08a9cba270.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åäº”é¢˜ï¼šé…ç½®-web-å†…å®¹çš„è®¿é—®"><a href="#ç¬¬åäº”é¢˜ï¼šé…ç½®-web-å†…å®¹çš„è®¿é—®" class="headerlink" title="ç¬¬åäº”é¢˜ï¼šé…ç½® web å†…å®¹çš„è®¿é—®"></a>ç¬¬åäº”é¢˜ï¼šé…ç½® web å†…å®¹çš„è®¿é—®</h5></li></ul><p>åœ¨æ‚¨çš„ system1 ä¸Šçš„ web æœåŠ¡å™¨çš„ DocumentRoot ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º private çš„ç›®å½•ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p><ol><li>ä» <a href="http://server.group8.example.com/pub/private.html">http://server.group8.example.com/pub/private.html</a> ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶å‰¯æœ¬åˆ°è¿™ä¸ªç›®å½•ï¼Œå¹¶ä¸”é‡å‘½åä¸º index.html</li><li>ä¸è¦å¯¹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹åšä»»ä½•ä¿®æ”¹</li><li>ä» system1 ä¸Šï¼Œä»»ä½•äººéƒ½å¯ä»¥æµè§ˆ private çš„å†…å®¹ï¼Œä½†æ˜¯ä»å…¶å®ƒç³»ç»Ÿä¸èƒ½è®¿é—®è¿™ä¸ªç›®å½•çš„å†…å®¹ã€‚</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 virtual]# cd /var/www/html[root@system1 html]# mkdir private[root@system1 html]# cd private/[root@system1 private]# wget -O index.html http://server.group8.example.com/pub/private.html[root@system1 private]# vim /etc/httpd/conf/httpd.conf  ï¼ˆç”¨äºå‚è€ƒçš„é…ç½®æ–‡ä»¶ï¼‰[root@system1 private]# vim /etc/httpd/conf.d/httpd-vhosts.conf[root@system1 private]# systemctl restart httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/httpd/conf.d/httpd-vhosts.conf é…ç½®æ–‡ä»¶ä¸­å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">&lt;Directory "/var/www/html/private"&gt;    AllowOverride none    Require all denied    Require local&lt;/Directory&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-45144d1a5ab0c065.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åå…­é¢˜ï¼šå®ç°åŠ¨æ€-WEB-å†…å®¹"><a href="#ç¬¬åå…­é¢˜ï¼šå®ç°åŠ¨æ€-WEB-å†…å®¹" class="headerlink" title="ç¬¬åå…­é¢˜ï¼šå®ç°åŠ¨æ€ WEB å†…å®¹"></a>ç¬¬åå…­é¢˜ï¼šå®ç°åŠ¨æ€ WEB å†…å®¹</h5></li></ul><p>åœ¨ system1 ä¸Šé…ç½®æä¾›åŠ¨æ€ web å†…å®¹ï¼Œè¦æ±‚ï¼š</p><ol><li>åŠ¨æ€å†…å®¹ç”±åä¸º wsgi.group8.example.com çš„è™šæ‹Ÿä¸»æœºæä¾›</li><li>è™šæ‹Ÿä¸»æœºä¾¦å¬åœ¨ç«¯å£ 8909</li><li>ä» <a href="http://server.group8.example.com/pub/webinfo.wsgi">http://server.group8.example.com/pub/webinfo.wsgi</a> ä¸‹è½½ä¸€ä¸ªè„šæœ¬ï¼Œç„¶åæ”¾åœ¨é€‚å½“çš„ä½ç½®ï¼Œæ— è®ºå¦‚ä½•ä¸è¦æ±‚ä¿®æ”¹æ­¤æ–‡ä»¶çš„å†…å®¹</li><li>å®¢æˆ·ç«¯è®¿é—® <a href="http://wsgi.group8.example.com:8909/">http://wsgi.group8.example.com:8909/</a> æ—¶ï¼Œåº”è¯¥æ¥æ”¶åˆ°åŠ¨æ€ç”Ÿæˆçš„ web é¡µé¢</li><li>æ­¤ <a href="http://wsgi.group8.example.com:8909/">http://wsgi.group8.example.com:8909/</a> å¿…é¡»èƒ½è¢« group8.example.com åŸŸå†…çš„æ‰€æœ‰ç³»ç»Ÿè®¿é—®</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 private]# cd /var/www/html[root@system1 html]# yum -y install mod_wsgi[root@system1 html]# wget http://server.group8.example.com/pub/webinfo.wsgi[root@system1 html]#  vim /etc/httpd/conf.d/httpd-vhosts.conf[root@system1 html]# semanage port -a -t http_port_t -p tcp 8909[root@system1 html]# systemctl restart httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/httpd/conf.d/httpd-vhosts.conf é…ç½®æ–‡ä»¶ä¸­å¡«å†™å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">listen 8909&lt;VirtualHost *:8909&gt;    WSGIScriptAlias / /var/www/html/webinfo.wsgi    ServerName wsgi.group8.example.com&lt;/VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5c83ffa719496429.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-f9ba955a92c22aed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åä¸ƒé¢˜ï¼šåˆ›å»ºä¸€ä¸ªè„šæœ¬"><a href="#ç¬¬åä¸ƒé¢˜ï¼šåˆ›å»ºä¸€ä¸ªè„šæœ¬" class="headerlink" title="ç¬¬åä¸ƒé¢˜ï¼šåˆ›å»ºä¸€ä¸ªè„šæœ¬"></a>ç¬¬åä¸ƒé¢˜ï¼šåˆ›å»ºä¸€ä¸ªè„šæœ¬</h5></li></ul><p>åœ¨ system1 ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º /root/foo.sh çš„è„šæœ¬ï¼Œè®©å…¶æä¾›ä¸‹åˆ—ç‰¹æ€§ï¼š</p><ol><li>å½“è¿è¡Œ /root/foo.sh redhat ,è¾“å‡ºä¸º fedora</li><li>å½“è¿è¡Œ /root/foo.sh fedora ,è¾“å‡ºä¸º redhat</li><li>å½“æ²¡æœ‰ä»»ä½•å‚æ•°æˆ–è€…å‚æ•°ä¸æ˜¯ redhat æˆ–è€… fedora æ—¶ï¼Œå…¶é”™è¯¯è¾“å‡ºäº§ç”Ÿä»¥ä¸‹çš„ä¿¡æ¯ï¼š<br>/root/foo.sh redhat | fedora</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 html]# cd ~[root@system1 ~]# vim /root/foo.sh[root@system1 ~]# chmod a+x /root/foo.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>/root/foo.sh æ–‡ä»¶ä¸­éœ€è¦å¡«å†™çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">case $1 inredhat)echo 'fedora';;fedora)echo 'redhat';;*)echo '/root/foo.sh redhat | fedora';;esac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b8c4cc35ec38c4da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬åå…«é¢˜ï¼šåˆ›å»ºä¸€ä¸ªæ·»åŠ ç”¨æˆ·çš„è„šæœ¬"><a href="#ç¬¬åå…«é¢˜ï¼šåˆ›å»ºä¸€ä¸ªæ·»åŠ ç”¨æˆ·çš„è„šæœ¬" class="headerlink" title="ç¬¬åå…«é¢˜ï¼šåˆ›å»ºä¸€ä¸ªæ·»åŠ ç”¨æˆ·çš„è„šæœ¬"></a>ç¬¬åå…«é¢˜ï¼šåˆ›å»ºä¸€ä¸ªæ·»åŠ ç”¨æˆ·çš„è„šæœ¬</h5></li></ul><p>åœ¨ system1 ä¸Šåˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œåä¸º /root/batchusers ,æ­¤è„šæœ¬èƒ½å®ç°ä¸ºç³»ç»Ÿ system1 åˆ›å»ºæœ¬åœ°ç”¨æˆ·ï¼Œå¹¶ä¸”è¿™äº›ç”¨æˆ·çš„ç”¨æˆ·åæ¥è‡ªä¸€ä¸ªåŒ…å«ç”¨æˆ·ååˆ—è¡¨çš„æ–‡ä»¶ï¼ŒåŒæ—¶æ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š</p><ol><li>æ­¤è„šæœ¬è¦æ±‚æä¾›ä¸€ä¸ªå‚æ•°ï¼Œæ­¤å‚æ•°å°±æ˜¯åŒ…å«ç”¨æˆ·ååˆ—è¡¨çš„çš„æ–‡ä»¶</li><li>å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œæ­¤è„šæœ¬åº”è¯¥ç»™å‡ºä¸‹é¢çš„æç¤ºä¿¡æ¯ Usage: /root/batchusers userfile ç„¶åé€€å‡ºå¹¶è¿”å›ç›¸åº”çš„å€¼</li><li>å¦‚æœæä¾›ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œæ­¤è„šæœ¬åº”è¯¥ç»™å‡ºä¸‹é¢çš„æç¤ºä¿¡æ¯ Input file not found ç„¶åé€€å‡ºå¹¶è¿”å›ç›¸åº”çš„å€¼</li><li>åˆ›å»ºçš„ç”¨æˆ·ç™»å½• shell ä¸º /bin/false</li><li>æ­¤è„šæœ¬ä¸éœ€è¦ä¸ºç”¨æˆ·è®¾ç½®å¯†ç </li><li>æ‚¨å¯ä»¥ä»ä¸‹é¢çš„ URL è·å–ç”¨æˆ·ååˆ—è¡¨ä½œä¸ºæµ‹è¯•ç”¨ <a href="http://server.group8.example.com/pub/userlist">http://server.group8.example.com/pub/userlist</a></li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 ~]# cd ~[root@system1 ~]# wget http://server.group8.example.com/pub/userlist[root@system1 ~]# more userlist[root@system1 ~]# vim /root/batchusers[root@system1 ~]# chmod a+x /root/batchusers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/root/batchusers æ–‡ä»¶ä¸­éœ€è¦å¡«å†™çš„å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">if [ $# -eq 0 ];thenecho 'Usage: /root/batchusers userfile'exit 1fiif [ ! -f $1 ];thenecho 'Input file not found'exit 1fiwhile read linedouseradd -s /bin/false $linedone &lt; $1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><ul><li><h5 id="ç¬¬åä¹é¢˜ï¼šé…ç½®-ISCSI-æœåŠ¡ç«¯"><a href="#ç¬¬åä¹é¢˜ï¼šé…ç½®-ISCSI-æœåŠ¡ç«¯" class="headerlink" title="ç¬¬åä¹é¢˜ï¼šé…ç½® ISCSI æœåŠ¡ç«¯"></a>ç¬¬åä¹é¢˜ï¼šé…ç½® ISCSI æœåŠ¡ç«¯</h5></li></ul><p>é…ç½® system1 æä¾›ä¸€ä¸ª ISCSI æœåŠ¡ ç£ç›˜åä¸º iqn.2014-08.com.example.group8:system1 ï¼Œå¹¶ç¬¦åˆä¸‹åˆ—è¦æ±‚ï¼š</p><ol><li>æœåŠ¡ç«¯å£ä¸º 3260</li><li>ä½¿ç”¨ iscsi_store ä½œå…¶åç«¯é€»è¾‘å·åç§°ï¼Œå…¶å¤§å°ä¸º 3G</li><li>æ­¤æœåŠ¡åªèƒ½è¢« system2.group8.example.com è®¿é—®</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 ~]# yum -y install target*[root@system1 ~]# ls -ald /dev/sd*[root@system1 ~]# fdisk /dev/sda[root@system1 ~]# partprobe[root@system1 ~]# partprobe[root@system1 ~]# ls -ald /dev/sd*[root@system1 ~]# pvcreate /dev/sda3[root@system1 ~]# vgcreate rhce /dev/sda3[root@system1 ~]# lvcreate -l 100%VG -n iscsi_store rhce[root@system1 ~]# lvscan[root@system1 ~]# targetcli[root@system1 ~]# systemctl restart target[root@system1 ~]# systemctl enable target[root@system1 ~]# firewall-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-57e18e04cca64462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-763a51805201d72d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5814e618608d527d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>targetcli é…ç½®å‘½ä»¤å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">/&gt; ls/&gt; cd /backstores/block/backstores/block&gt; create disk0 /dev/rhce/iscsi_store/backstores/block&gt; cd /iscsi /iscsi&gt; ls/iscsi&gt; create iqn.2014-08.com.example.group8:system1/iscsi&gt; ls/iscsi&gt; cd iqn.2014-08.com.example.group8:system1/tpg1/acls /iscsi/iqn.20...em1/tpg1/acls&gt; create iqn.2014-08.com.example.group8:system2/iscsi/iqn.20...em1/tpg1/acls&gt; cd ../luns /iscsi/iqn.20...em1/tpg1/luns&gt; create /backstores/block/disk0/iscsi/iqn.20...em1/tpg1/luns&gt; cd ../portals//iscsi/iqn.20.../tpg1/portals&gt; create 172.24.8.11 3260/iscsi/iqn.20.../tpg1/portals&gt; ls/iscsi/iqn.20.../tpg1/portals&gt; delete 0.0.0.0 3260/iscsi/iqn.20.../tpg1/portals&gt; create 172.24.8.11 3260/iscsi/iqn.20.../tpg1/portals&gt; ls/iscsi/iqn.20.../tpg1/portals&gt; exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-b42054fbaadaadd4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬äºŒåé¢˜ï¼šé…ç½®-iSCISI-çš„å®¢æˆ·ç«¯"><a href="#ç¬¬äºŒåé¢˜ï¼šé…ç½®-iSCISI-çš„å®¢æˆ·ç«¯" class="headerlink" title="ç¬¬äºŒåé¢˜ï¼šé…ç½® iSCISI çš„å®¢æˆ·ç«¯"></a>ç¬¬äºŒåé¢˜ï¼šé…ç½® iSCISI çš„å®¢æˆ·ç«¯</h5></li></ul><p>é…ç½® system2 ä½¿å…¶èƒ½è¿æ¥åœ¨ system1 ä¸Šæä¾›çš„ iqn.2014-08.com.example.group8:system1,å¹¶ç¬¦åˆä»¥ä¸‹è¦æ±‚ï¼š</p><ol><li>iSCISI è®¾å¤‡åœ¨ç³»ç»Ÿå¯åŠ¨çš„æœŸé—´è‡ªåŠ¨åŠ è½½</li><li>å—è®¾å¤‡ iSCISI ä¸ŠåŒ…å«ä¸€ä¸ªå¤§å°ä¸º 2100 MiB çš„åˆ†åŒºï¼Œå¹¶æ ¼å¼åŒ–ä¸º ext4</li><li>æ­¤åˆ†åŒºæŒ‚è½½åœ¨ /mnt/data ä¸Šï¼ŒåŒæ—¶åœ¨ç³»ç»Ÿå¯åŠ¨çš„æœŸé—´è‡ªåŠ¨æŒ‚è½½</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system2</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system2 Desktop]# yum -y install iscsi-*[root@system2 Desktop]# vim /etc/iscsi/initiatorname.iscsi [root@system2 Desktop]# systemctl restart iscsi iscsid[root@system2 Desktop]# systemctl enable iscsi iscsid[root@system2 Desktop]# lsblk[root@system2 Desktop]# iscsiadm -m discovery -t st -p 172.24.8.11[root@system2 Desktop]# iscsiadm -m node -T iqn.2014-08.com.example.group8:system1 -l[root@system2 Desktop]# lsblk[root@system2 Desktop]# ls -ald /dev/sd*[root@system2 Desktop]# fdisk /dev/sdb[root@system2 Desktop]# ls -ald /dev/sd*[root@system2 Desktop]# mkfs   ï¼ˆè¿ç»­æŒ‰ä¸¤æ¬¡ type é”®ï¼‰[root@system2 Desktop]# mkfs.ext4 /dev/sdb1[root@system2 Desktop]# blkid /dev/sdb1[root@system2 Desktop]# ls -ald /mnt/data[root@system2 Desktop]# mkdir -p /mnt/data[root@system2 Desktop]# vim /etc/fstab [root@system2 Desktop]# mount -a[root@system2 Desktop]# df -hT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/etc/iscsi/initiatorname.iscsi é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">InitiatorName=iqn.2014-08.com.example.group8:system2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>/etc/fstab æŒ‚è½½é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">UUID="82e0d1be-f690-45e2-8dfc-7aa548df3fff" /mnt/data ext4 defaults,_netdev 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-720bb16f0fdc7c93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-3cba38302ca24aeb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><hr><ul><li><h5 id="ç¬¬äºŒåä¸€é¢˜ï¼šé…ç½®ä¸€ä¸ªæ•°æ®åº“"><a href="#ç¬¬äºŒåä¸€é¢˜ï¼šé…ç½®ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="ç¬¬äºŒåä¸€é¢˜ï¼šé…ç½®ä¸€ä¸ªæ•°æ®åº“"></a>ç¬¬äºŒåä¸€é¢˜ï¼šé…ç½®ä¸€ä¸ªæ•°æ®åº“</h5></li></ul><p>åœ¨ system1ä¸Šåˆ›å»ºä¸€ä¸ª Maria DB æ•°æ®åº“ï¼Œåä¸º Contactsï¼Œè¦æ±‚ï¼š</p><ol><li>æ•°æ®åº“åº”è¯¥åŒ…å«æ¥è‡ªæ•°æ®åº“å¤åˆ¶çš„å†…å®¹ï¼Œå¤åˆ¶æ–‡ä»¶çš„URLä¸º <a href="http://server.group8.example.com/pub/users.mdb">http://server.group8.example.com/pub/users.mdb</a> ï¼Œæ•°æ®åº“åªèƒ½è¢« localhost è®¿é—®</li><li>é™¤äº† root ç”¨æˆ·ï¼Œæ­¤æ•°æ®åº“åªèƒ½è¢«ç”¨æˆ· Mary æŸ¥è¯¢ï¼Œæ­¤ç”¨æˆ·å¯†ç ä¸º redhat</li><li>root ç”¨æˆ·çš„æ•°æ®åº“å¯†ç ä¸º redhat ï¼ŒåŒæ—¶ä¸å…è®¸ç©ºå¯†ç ç™»å½•</li></ol><p><code>å‚è€ƒè§£é¢˜æ­¥éª¤ï¼š</code></p><p><code>system1</code></p><pre class="line-numbers language-none"><code class="language-none">[root@system1 ~]# yum -y install mariadb mariadb-client mariadb-server[root@system1 ~]# wget http://server.group8.example.com/pub/users.mdb[root@system1 ~]# vim /etc/my.cnf[root@system1 ~]# systemctl restart mariadb [root@system1 ~]# systemctl enable mariadb[root@system1 ~]# mysql_secure_installation      ï¼ˆäº¤äº’ç•Œé¢å…¨éƒ¨é€‰æ‹© y ï¼‰[root@system1 ~]# mysql -u root -p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">19 skip-networking=1    ï¼ˆè¯·è‡ªè¡Œæ·»åŠ ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/medias/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/14623749-5b4118b997756732.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>è¿›å…¥ MariaDB æ•°æ®åº“ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">MariaDB [(none)]&gt; show databases;MariaDB [(none)]&gt; create database Contacts;MariaDB [(none)]&gt; use Contacts;MariaDB [Contacts]&gt; source users.mdb;MariaDB [Contacts]&gt; show tables;MariaDB [Contacts]&gt; grant select on Contacts.* to Mary@'localhost' identified by 'redhat';MariaDB [Contacts]&gt; exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><ul><li><h5 id="ç¬¬äºŒåä¸€é¢˜ï¼šæ•°æ®åº“æŸ¥è¯¢"><a href="#ç¬¬äºŒåä¸€é¢˜ï¼šæ•°æ®åº“æŸ¥è¯¢" class="headerlink" title="ç¬¬äºŒåä¸€é¢˜ï¼šæ•°æ®åº“æŸ¥è¯¢"></a>ç¬¬äºŒåä¸€é¢˜ï¼šæ•°æ®åº“æŸ¥è¯¢</h5></li></ul><p>åœ¨ system1 ä¸Šä½¿ç”¨æ•°æ®åº“ Contacts ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„ SQL æŸ¥è¯¢ä»¥å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol><li>å¯†ç æ˜¯ fadora çš„äººçš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>æœ‰å¤šå°‘äººçš„å§“åæ˜¯ John ï¼ŒåŒæ—¶å±…ä½åœ¨ Santa Clara ï¼Ÿ</li></ol><p>ç›´æ¥è´´å‡º sql è¯­å¥å¦‚ä¸‹ï¼Œä»…ä¾›å‚è€ƒï¼Œè€ƒè¯•æ—¶åœ¨è¿™é‡Œçš„å˜æ•°è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œå»ºè®®ä¸è¦æ­»è®°ç¡¬èƒŒã€‚</p><pre class="line-numbers language-none"><code class="language-none">select n.firstname,n.lastname from u_name  as n left join u_passwd as p where n.userid = p.uid and p.password = 'fedora';select count(*) from u_name as n left join u_loc as l where n.userid = l.uid and n.firstname = 'John' and l.location = 'Santa Clara';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> çº¢å¸½è®¤è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-blog åšå®¢å¼€æº</title>
      <link href="posts/e3e08109.html"/>
      <url>posts/e3e08109.html</url>
      
        <content type="html"><![CDATA[<h1 id="åšå®¢å¼€æº"><a href="#åšå®¢å¼€æº" class="headerlink" title="åšå®¢å¼€æº"></a>åšå®¢å¼€æº</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æŠ˜è…¾äº†ä¸€ä¸ªæ˜ŸæœŸå·¦å³ï¼Œæ€»ç®—æ˜¯æŠŠæˆ‘çš„ä¸ªäººåšå®¢ç»™å®Œå–„äº†ï¼Œä¸ºäº†å›é¦ˆå¼€æºï¼Œæˆ‘ä¼šæŠŠæˆ‘è‡ªå·±ä¿®æ”¹åçš„ä¸”å®Œå–„çš„ <code>blog</code> ç½‘ç«™æºç å¼€æºã€‚<br>ä»£ç éƒ½æ˜¯æºç ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä¸‹è½½æˆ‘çš„åšå®¢æºç ï¼Œç„¶åå°†æ ¹ç›®å½•ä¸‹çš„ <code>/_config.yml</code> å’Œ <code>/themes/hexo-theme-matery/_config.yml</code><br>è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ä¿®æ”¹æˆæ‚¨çš„ä¿¡æ¯å°±å¯ä»¥éƒ¨ç½²æˆå’Œæˆ‘ä¸€æ‘¸ä¸€æ ·çš„åšå®¢äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿè¿™å¯¹äºä¸€äº›æƒ³å†™åšå®¢ï¼Œä½†æ˜¯åˆä¸æƒ³å¤ªæŠ˜è…¾ï¼Œ<br>å¹¶ä¸”å¯¹ç¾è§‚æœ‰ä¸€å®šè¦æ±‚çš„æœ‹å‹æ¥è¯´ï¼Œç®€ç›´æ˜¯çˆ½çš„ä¸è¦ä¸è¦çš„ã€‚ğŸ˜œ <a href="https://github.com/pudongping/pudongping.github.io">ç‚¹æˆ‘ç«‹å³ä¸‹è½½æˆ‘çš„åšå®¢æºç </a></p><h2 id="å…³äºæˆ‘çš„åšå®¢é¡¹ç›®"><a href="#å…³äºæˆ‘çš„åšå®¢é¡¹ç›®" class="headerlink" title="å…³äºæˆ‘çš„åšå®¢é¡¹ç›®"></a>å…³äºæˆ‘çš„åšå®¢é¡¹ç›®</h2><p>è¿™ä¸ªåšå®¢ï¼Œæˆ‘æ˜¯åŸºäº <strong><a href="https://hexo.io/zh-cn/docs/">Hexo</a></strong> æ¡†æ¶æ­å»ºï¼Œå¹¶ä¸”ç”¨åˆ° <strong><a href="https://github.com/blinkfox/hexo-theme-matery">hexo-theme-matery</a></strong> ä¸»é¢˜ï¼Œ<br>åœ¨æ­¤åŸºç¡€ä¸Šåšäº†ä¸å°‘çš„ä¿®æ”¹ï¼Œå¢åŠ äº†ä¸€äº›æ–°çš„ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚æˆ‘çš„åšå®¢è®¿é—®åœ°å€ä¸ºï¼š<a href="http://pudongping.github.io/">http://pudongping.github.io</a> æˆ–è€…è®¿é—® <a href="https://pudongping.github.io/">https://pudongping.github.io</a></p><h2 id="åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå„ä¸ªè½¯ä»¶ç‰ˆæœ¬ä»‹ç»"><a href="#åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå„ä¸ªè½¯ä»¶ç‰ˆæœ¬ä»‹ç»" class="headerlink" title="åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå„ä¸ªè½¯ä»¶ç‰ˆæœ¬ä»‹ç»"></a>åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå„ä¸ªè½¯ä»¶ç‰ˆæœ¬ä»‹ç»</h2><ul><li>ä¿®æ”¹é¡¹ç›®æ—¶é—´ä¸º 2021 å¹´ 6 æœˆ 5 æ—¥</li><li>ä½¿ç”¨çš„ node.js ç‰ˆæœ¬ä¸ºï¼šv16.2.0</li><li>ä½¿ç”¨çš„ npm ç‰ˆæœ¬ä¸ºï¼š7.13.0</li><li>ä½¿ç”¨çš„ hexo ç‰ˆæœ¬ä¸ºï¼š5.4.0</li><li>ä½¿ç”¨çš„ hexo-theme-matery çš®è‚¤ç‰ˆæœ¬ä¸ºï¼šv2.0.0</li><li>å…¶ä»–çš„ä¾èµ–åŒ…è§ package.json æ–‡ä»¶ï¼Œå…·ä½“ç‰ˆæœ¬å·è§ package-lock.json æ–‡ä»¶ã€‚</li></ul><h2 id="å¦‚ä½•æ­å»ºå’Œæˆ‘ä¸€æ‘¸ä¸€æ ·çš„åšå®¢ï¼Ÿ"><a href="#å¦‚ä½•æ­å»ºå’Œæˆ‘ä¸€æ‘¸ä¸€æ ·çš„åšå®¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ­å»ºå’Œæˆ‘ä¸€æ‘¸ä¸€æ ·çš„åšå®¢ï¼Ÿ"></a>å¦‚ä½•æ­å»ºå’Œæˆ‘ä¸€æ‘¸ä¸€æ ·çš„åšå®¢ï¼Ÿ</h2><blockquote><p>å‰æä½ éœ€è¦å…ˆå®‰è£… <code>git</code> å’Œ <code>node.js</code> ï¼ˆå®‰è£…å¥½ node.js ä¹‹åï¼Œä¼šè‡ªåŠ¨å®‰è£… npmï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ <a href="https://github.com/nvm-sh/nvm">nvm</a> å®‰è£… node.js ä»¥æ–¹ä¾¿ç®¡ç†å¤šä¸ªç‰ˆæœ¬çš„ node.jsï¼‰</p></blockquote><ul><li>å®‰è£… <code>hexo-cli</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…¨å±€å®‰è£… hexo</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> hexo-cli<span class="token comment"># å±€éƒ¨å®‰è£… hexo</span><span class="token function">npm</span> <span class="token function">install</span> hexo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç›´æ¥ä½¿ç”¨ <code>git</code> æ‹‰å–é¡¹ç›®å¹¶è¿›å…¥ç›¸åº”çš„æ–‡ä»¶ç›®å½•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ GitHub åœ°å€</span><span class="token function">git</span> clone https://github.com/pudongping/pudongping.github.io.git blog<span class="token comment"># ä½¿ç”¨ gitee åœ°å€ ï¼ˆè¦æ˜¯ä»£ç æ‹‰å–ä¸ä¸‹æ¥çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ gitee åœ°å€ï¼‰</span><span class="token function">git</span> clone https://gitee.com/pudongping/pudongping.git blog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ‡æ¢åˆ†æ”¯</li></ul><p>å»ºè®®åˆ‡æ¢åˆ° <code>hexo</code> åˆ†æ”¯ï¼Œæ–¹ä¾¿ä½ è‡ªå®šä¹‰ä½ çš„åšå®¢ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœä½ æƒ³å®ç°å’Œæˆ‘ä¸€æ‘¸ä¸€æ ·çš„åšå®¢çš„è¯ï¼Œä½ å¯ä»¥ç›´æ¥åˆ‡æ¢åˆ° `main` åˆ†æ”¯ï¼Œè¿™æ˜¯æˆ‘è‡ªå·±å®Œæ•´çš„åšå®¢æºç åˆ†æ”¯ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘æ‰€æœ‰çš„åšå®¢æ–‡ç« </span><span class="token function">git</span> checkout main<span class="token comment"># å¦‚æœä½ åªæƒ³è·å–æˆ‘æ‰€æœ‰çš„ä¿®æ”¹ï¼Œå¹¶åŸºäºæ­¤åŸºç¡€ä¹‹ä¸Šæ”¹æˆè‡ªå·±çš„åšå®¢çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åˆ‡æ¢åˆ° `hexo` åˆ†æ”¯ï¼Œè¿™ä¸ªåˆ†æ”¯ä¸Šæ˜¯æˆ‘åšå®¢ä¿®æ”¹çš„åŸºç¡€åˆ†æ”¯ï¼Œ</span><span class="token comment"># åœ¨æ­¤åˆ†æ”¯åŸºç¡€ä¹‹ä¸Šä½ å¯ä»¥æ·»åŠ ä½ è‡ªå·±çš„ä»»ä½•ä¿®æ”¹ã€‚ï¼ˆä¸åŒ…å«æˆ‘æ‰€æœ‰çš„åšå®¢æ–‡ç« å’Œæˆ‘è‡ªå®šä¹‰çš„å…¶ä»–ä¿®æ”¹ï¼‰</span><span class="token function">git</span> checkout hexo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£…ä¾èµ–æ’ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ <code>/_config.yml</code> å’Œ <code>/themes/hexo-theme-matery/_config.yml</code> çš„è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ”¹æˆè‡ªå·±çš„ä¿¡æ¯</p></li><li><p>ç¼–è¯‘æºä»£ç </p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ¸…é™¤ç”Ÿæˆçš„é™æ€æ–‡ä»¶</span>hexo cl<span class="token comment"># ç”Ÿæˆé™æ€é¡µé¢è‡³ public é¡µé¢ ï¼ˆå¦‚æœåªæ˜¯æœ¬åœ°é¢„è§ˆï¼Œå¯ä¸è¿›è¡Œæ­¤æ­¥éª¤ï¼‰</span>hexo g<span class="token comment"># ç”Ÿæˆæœ¬åœ°é¢„è§ˆ</span>hexo s<span class="token comment"># å¦‚æœéœ€è¦ç”Ÿæˆ github-pages çš„è¯ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ ï¼ˆéœ€è¦å®‰è£… npm install hexo-deployer-git --save æ’ä»¶åŒ…ï¼‰</span>hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æœ¬åœ°è®¿é—®é¡¹ç›®</li></ul><p>ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® <a href="http://localhost:4000/]">http://localhost:4000/</a> å³å¯ã€‚éƒ¨ç½²å®Œæ¯•ï¼</p><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><h3 id="hexo-theme-matery-ä¸»é¢˜ç‰¹æ€§"><a href="#hexo-theme-matery-ä¸»é¢˜ç‰¹æ€§" class="headerlink" title="hexo-theme-matery ä¸»é¢˜ç‰¹æ€§"></a>hexo-theme-matery ä¸»é¢˜ç‰¹æ€§</h3><ul><li>ç®€å•æ¼‚äº®ï¼Œæ–‡ç« å†…å®¹ç¾è§‚æ˜“è¯»</li><li><a href="https://material.io/">Material Design</a> è®¾è®¡</li><li>å“åº”å¼è®¾è®¡ï¼Œåšå®¢åœ¨æ¡Œé¢ç«¯ã€å¹³æ¿ã€æ‰‹æœºç­‰è®¾å¤‡ä¸Šå‡èƒ½å¾ˆå¥½çš„å±•ç°</li><li>é¦–é¡µè½®æ’­æ–‡ç« åŠæ¯å¤©åŠ¨æ€åˆ‡æ¢ <code>Banner</code> å›¾ç‰‡</li><li>ç€‘å¸ƒæµå¼çš„åšå®¢æ–‡ç« åˆ—è¡¨ï¼ˆæ–‡ç« æ— ç‰¹è‰²å›¾ç‰‡æ—¶ä¼šæœ‰ <code>24</code> å¼ æ¼‚äº®çš„å›¾ç‰‡ä»£æ›¿ï¼‰</li><li>æ—¶é—´è½´å¼çš„å½’æ¡£é¡µ</li><li><strong>è¯äº‘</strong>çš„æ ‡ç­¾é¡µå’Œ<strong>é›·è¾¾å›¾</strong>çš„åˆ†ç±»é¡µ</li><li>ä¸°å¯Œçš„å…³äºæˆ‘é¡µé¢ï¼ˆåŒ…æ‹¬å…³äºæˆ‘ã€æ–‡ç« ç»Ÿè®¡å›¾ã€æˆ‘çš„é¡¹ç›®ã€æˆ‘çš„æŠ€èƒ½ã€ç›¸å†Œç­‰ï¼‰</li><li>å¯è‡ªå®šä¹‰çš„æ•°æ®çš„å‹æƒ…é“¾æ¥é¡µé¢</li><li>æ”¯æŒæ–‡ç« ç½®é¡¶å’Œæ–‡ç« æ‰“èµ</li><li>æ”¯æŒ <code>MathJax</code></li><li><code>TOC</code> ç›®å½•</li><li>å¯è®¾ç½®å¤åˆ¶æ–‡ç« å†…å®¹æ—¶è¿½åŠ ç‰ˆæƒä¿¡æ¯</li><li>å¯è®¾ç½®é˜…è¯»æ–‡ç« æ—¶åšå¯†ç éªŒè¯</li><li><a href="https://gitalk.github.io/">Gitalk</a>ã€<a href="https://imsun.github.io/gitment/">Gitment</a>ã€<a href="https://valine.js.org/">Valine</a> å’Œ <a href="https://disqus.com/">Disqus</a> è¯„è®ºæ¨¡å—ï¼ˆæ¨èä½¿ç”¨ <code>Gitalk</code>ï¼‰</li><li>é›†æˆäº†<a href="http://busuanzi.ibruce.info/">ä¸è’œå­ç»Ÿè®¡</a>ã€è°·æ­Œåˆ†æï¼ˆ<code>Google Analytics</code>ï¼‰å’Œæ–‡ç« å­—æ•°ç»Ÿè®¡ç­‰åŠŸèƒ½</li><li>æ”¯æŒåœ¨é¦–é¡µçš„éŸ³ä¹æ’­æ”¾å’Œè§†é¢‘æ’­æ”¾åŠŸèƒ½</li><li>æ”¯æŒ<code>emoji</code>è¡¨æƒ…ï¼Œç”¨<code>markdown emoji</code>è¯­æ³•ä¹¦å†™ç›´æ¥ç”Ÿæˆå¯¹åº”çš„èƒ½<strong>è·³è·ƒ</strong>çš„è¡¨æƒ…ã€‚</li><li>æ”¯æŒ <a href="http://www.daovoice.io/">DaoVoice</a>ã€<a href="https://www.tidio.com/">Tidio</a> åœ¨çº¿èŠå¤©åŠŸèƒ½ã€‚</li></ul><h3 id="ä¿®æ”¹æˆ–å¢åŠ çš„ç‰¹æ€§åŠŸèƒ½"><a href="#ä¿®æ”¹æˆ–å¢åŠ çš„ç‰¹æ€§åŠŸèƒ½" class="headerlink" title="ä¿®æ”¹æˆ–å¢åŠ çš„ç‰¹æ€§åŠŸèƒ½"></a>ä¿®æ”¹æˆ–å¢åŠ çš„ç‰¹æ€§åŠŸèƒ½</h3><ul><li>æ·»åŠ  emoji è¡¨æƒ…æ”¯æŒ</li><li>æ·»åŠ  RSS è®¢é˜…æ”¯æŒ</li><li>æ·»åŠ ç«™ç‚¹åœ°å›¾æ”¯æŒ</li><li>cssã€jsèµ„æºå¢åŠ  cdn åŠ é€Ÿ</li><li>åº•éƒ¨å¢åŠ å¤‡æ¡ˆå·ä¿¡æ¯</li><li>ä¿®æ”¹äº†ä¸»é¢˜é¢œè‰²</li><li>å¤„ç†äº†å›¾ç‰‡å› é˜²ç›—é“¾æ— æ³•æ˜¾ç¤ºé—®é¢˜</li><li>æ·»åŠ äº†åŠ¨æ€æ”¹å˜é¡µé¢æ ‡ç­¾çš„åŠŸèƒ½</li><li>æ·»åŠ äº†é¼ æ ‡ç‚¹å‡»çƒŸèŠ±çˆ†ç‚¸ç‰¹æ•ˆ</li><li>æ·»åŠ äº†é¼ æ ‡ç‚¹å‡»å‡ºç°è‡ªå®šä¹‰æ–‡å­—æµ®å±‚ç‰¹æ•ˆ</li><li>æ·»åŠ äº†é¡µé¢æ¨±èŠ±é£˜è½åŠ¨æ€ç‰¹æ•ˆ</li><li>æ·»åŠ äº†é¡µé¢é›ªèŠ±é£˜è½åŠ¨æ€ç‰¹æ•ˆ</li><li>ä¼˜åŒ–æ–‡ç« çš„ url</li><li>å›¾ç‰‡æ‡’åŠ è½½</li><li>æ·»åŠ äº†åœ¨<strong>å…³äºæˆ‘</strong>é¡µé¢å†™ç®€å†åŠŸèƒ½</li><li>ä¿®æ”¹äº† banner å›¾éšæœºè½®æ’­</li></ul><h2 id="åšå®¢æˆªå›¾"><a href="#åšå®¢æˆªå›¾" class="headerlink" title="åšå®¢æˆªå›¾"></a>åšå®¢æˆªå›¾</h2><p><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/page.png" alt="é¦–é¡µ"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/articles-list.png" alt="æ–‡ç« åˆ—è¡¨"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/articles-list-1.png" alt="æ–‡ç« åˆ—è¡¨"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/article-detail.png" alt="æ–‡ç« è¯¦æƒ…"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/article-detail-1.png" alt="æ–‡ç« è¯¦æƒ…"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/tags.png" alt="æ ‡ç­¾é¡µ"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/categories.png" alt="åˆ†ç±»é¡µ"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/archives.png" alt="å½’æ¡£é¡µ"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/about-me.png" alt="å…³äºæˆ‘é¡µ"><br><img src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/sample/contact.png" alt="ç•™è¨€æ¿é¡µ"></p><h2 id="æ„Ÿè°¢æ”¯æŒ"><a href="#æ„Ÿè°¢æ”¯æŒ" class="headerlink" title="æ„Ÿè°¢æ”¯æŒ"></a>æ„Ÿè°¢æ”¯æŒ</h2><p>å¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©,è¯·å¸®å¿™ç»™ä¸ª <code>Star</code>ã€‚<br>å¦‚æœä½ æƒ³è´¡çŒ®ä¸€ä»½åŠ›é‡,æ¬¢è¿æäº¤ <code>Pull Request</code>ã€‚</p><h2 id="èµèµæåŠ©"><a href="#èµèµæåŠ©" class="headerlink" title="èµèµæåŠ©"></a>èµèµæåŠ©</h2><p>æœ‰é—®é¢˜å¯ä»¥åœ¨æ–‡ç« æœ€åè¯„è®ºåŒºè¿›è¡Œ <strong>ç•™è¨€å’Œè¯„è®º</strong> ï¼Œå¦‚æœä½ å–œæ¬¢æˆ‘çš„åšå®¢ï¼Œè¯·åšä¸»å–ä¸€æ¯å†°é˜”ä¹å‘€^_^ ğŸ˜˜</p><table>  <tbody><tr>    <td>        <img width="100" src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/reward/alipay.png" alt="alipay">    </td>    <td>        <img width="100" src="/medias/loading.gif" data-original="https://pudongping.github.io/medias/reward/wechat.png" alt="wechat">    </td>  </tr></tbody></table><blockquote><p>ğŸ˜˜ è‹¥æœ‰å…±é¸£ï¼Œç•™è¨€è¶³çŸ£ï¼Œè‹¥æœ‰èµèµï¼Œä½•ä»¥å¤åŠ ï¼Ÿ ğŸ¤</p></blockquote><h2 id="LICENSE"><a href="#LICENSE" class="headerlink" title="LICENSE"></a>LICENSE</h2><p>MIT</p>]]></content>
      
      
      <categories>
          
          <category> å¼€æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
            <tag> åšå®¢ </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
